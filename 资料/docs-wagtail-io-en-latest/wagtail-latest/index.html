
<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="docsearch:name" content="Wagtail Documentation" />
    <meta name="docsearch:package_type" content="" />
    <meta name="docsearch:release" content="2.15a0" />
    <meta name="docsearch:version" content="2.15" />
    
        <title>Wagtail Documentation 2.15a0 documentation</title>
    
        <link rel="shortcut icon" href="_static/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="_static/dist/theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/dist/webfonts.css" />
    <link rel="stylesheet" type="text/css" href="_static/dist/fontawesome.css" />
            <link rel="search" title="Search" href="search.html" />
            <link rel="top" title="None" href="index.html#document-index" />
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/>
<link rel="stylesheet" href="_static/css/docsearch.overrides.css" />
</head>
<body>
    <header class="container-fluid bg-primary">
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="/"
                        title="Wagtail"
                        class="logo navbar-brand"
                    >
                        <img src="_static/img/wagtail-logo-new.svg" width="45" height="59" alt="Wagtail"
                            class="logo-img"
                        />
                        Wagtail Documentation
                    </a>
                
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="navbar-toggler-text">Menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3">
                <div id="collapseSidebar" class="collapse d-lg-block pt-5">
                    <div class="site-toc">
                        <nav class="toc mt-3" aria-label="Main menu">
                                <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-getting_started/index">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-getting_started/tutorial">Your first Wagtail site</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-getting_started/demo_site">Demo site</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-getting_started/integrating_into_django">Integrating Wagtail into a Django project</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-getting_started/the_zen_of_wagtail">The Zen of Wagtail</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-topics/index">Usage guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/pages">Page models</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/writing_templates">Writing templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/images">How to use images in templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/search/index">Search</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-topics/search/indexing">Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-topics/search/searching">Searching</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-topics/search/backends">Backends</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/snippets">Snippets</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/streamfield">How to use StreamField for mixed content</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/permissions">Permissions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-advanced_topics/index">Advanced topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/images/index">Images</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/images/renditions">Generating renditions in Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/images/animated_gifs">Animated GIF support</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/images/image_file_formats">Image file formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/images/custom_image_model">Custom image models</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/images/changing_rich_text_representation">Changing rich text representation</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/images/feature_detection">Feature Detection</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/images/image_serve_view">Dynamic image serve view</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/images/focal_points">Focal points</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/documents/index">Documents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/documents/custom_document_model">Custom document model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/embeds">Embedded content</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/add_to_django_project">How to add Wagtail into an existing Django project</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/deploying">Deploying Wagtail</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/performance">Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/i18n">Internationalisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/privacy">Private pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/customisation/index">Customising Wagtail</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/customisation/page_editing_interface">Customising the editing interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/customisation/admin_templates">Customising admin templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/customisation/custom_user_models">Custom user models</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/customisation/streamfield_blocks">How to build custom StreamField blocks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/third_party_tutorials">Third-party tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/testing">Testing your Wagtail site</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/api/index">Wagtail API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/api/v2/configuration">Wagtail API v2 Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-advanced_topics/api/v2/usage">Wagtail API v2 Usage Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/amp">How to build a site with AMP support</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/accessibility_considerations">Accessibility considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/boundblocks_and_values">About StreamField BoundBlocks and values</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/multi_site_multi_instance_multi_tenancy">Multi-site, multi-instance and multi-tenancy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-extending/index">Extending Wagtail</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/admin_views">Creating admin views</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/template_components">Template components</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/adding_reports">Adding reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/custom_tasks">Adding new Task types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/audit_log">Audit log</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/custom_account_settings">Customising the user account settings form</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/customising_group_views">Customising group edit/create views</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/rich_text_internals">Rich text internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/extending_draftail">Extending the Draftail Editor</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/extending_hallo">Extending the Hallo Editor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-reference/index">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/pages/index">Pages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/pages/theory">Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/pages/model_recipes">Recipes</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/pages/panels">Panel types</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/pages/model_reference">Model Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/pages/queryset_reference">Page QuerySet reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/streamfield/index">StreamField reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/streamfield/blocks">StreamField block reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/streamfield/widget_api">Form widget client-side API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/contrib/index">Contrib modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/contrib/settings">Site settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/contrib/forms/index">Form builder</a><ul>
<li class="toctree-l4"><a class="reference internal" href="index.html#document-reference/contrib/forms/customisation">Form builder customisation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/contrib/sitemaps">Sitemap generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/contrib/frontendcache">Frontend cache invalidator</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/contrib/routablepage"><code class="docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/contrib/modeladmin/index"><code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="index.html#document-reference/contrib/modeladmin/primer"><code class="docutils literal notranslate"><span class="pre">modeladmin</span></code> customisation primer</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#document-reference/contrib/modeladmin/menu_item">Customising the menu item</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#document-reference/contrib/modeladmin/indexview">Customising <code class="docutils literal notranslate"><span class="pre">IndexView</span></code> - the listing view</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#document-reference/contrib/modeladmin/create_edit_delete_views">Customising <code class="docutils literal notranslate"><span class="pre">CreateView</span></code>, <code class="docutils literal notranslate"><span class="pre">EditView</span></code> and <code class="docutils literal notranslate"><span class="pre">DeleteView</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#document-reference/contrib/modeladmin/inspectview">Enabling &amp; customising <code class="docutils literal notranslate"><span class="pre">InspectView</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#document-reference/contrib/modeladmin/chooseparentview">Customising <code class="docutils literal notranslate"><span class="pre">ChooseParentView</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#document-reference/contrib/modeladmin/tips_and_tricks/index">Additional tips and tricks</a><ul>
<li class="toctree-l5"><a class="reference internal" href="index.html#document-reference/contrib/modeladmin/tips_and_tricks/reversing_urls">Reversing ModelAdmin URLs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/contrib/postgres_search">PostgreSQL search engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/contrib/searchpromotions">Promoted search results</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/contrib/simple_translation">Simple translation</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/contrib/table_block">TableBlock</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/contrib/redirects">Redirects</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-reference/contrib/legacy_richtext">Legacy richtext</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/management_commands">Management commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/hooks">Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/signals">Signals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/settings">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/project_template">The project template</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/jinja2">Jinja2 template support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-support">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-editor_manual/index">Using Wagtail: an Editor’s guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/intro">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/getting_started">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/finding_your_way_around/index">Finding your way around</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/finding_your_way_around/the_dashboard">The Dashboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/finding_your_way_around/the_explorer_menu">The Explorer menu</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/finding_your_way_around/using_search">Using search</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/finding_your_way_around/the_explorer_page">The Explorer page</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/new_pages/index">Creating new pages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/new_pages/selecting_a_page_type">Selecting a page type</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/new_pages/creating_body_content">Creating page body content</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/new_pages/inserting_images">Inserting images in a page</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/new_pages/inserting_links">Inserting links in a page</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/new_pages/inserting_videos">Inserting videos into body content</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/new_pages/inserting_documents">Inserting links to documents into body text</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/new_pages/adding_multiple_items">Adding multiple items</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/new_pages/required_fields">Required fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/new_pages/the_promote_tab">Edit Page tabs</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/new_pages/previewing_and_submitting_for_moderation">Previewing and submitting pages for moderation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/editing_existing_pages">Editing existing pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/copying_aliasing_existing_pages">Copying and creating aliases to existing pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/documents_images_snippets/index">Managing documents, images, snippets and collections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/documents_images_snippets/documents">Documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/documents_images_snippets/images">Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/documents_images_snippets/snippets">Snippets</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/documents_images_snippets/collections">Collections</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/managing_redirects">Managing Redirects</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/administrator_tasks/index">Administrator tasks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/administrator_tasks/managing_users">Managing users and roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/administrator_tasks/managing_workflows">Managing Workflows</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#document-editor_manual/administrator_tasks/promoted_search_results">Promoted search results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/browser_issues">Browser issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-contributing/index">Contributing to Wagtail</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/issue_tracking">Issue tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/developing">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/committing">Committing code</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/styleguide">UI Styleguide</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/general_guidelines">General coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/python_guidelines">Python coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/html_guidelines">HTML coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/css_guidelines">CSS coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/javascript_guidelines">JavaScript coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/documentation_guidelines">Documentation guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/documentation-modes">Writing documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/security">Reporting security issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/release_process">Wagtail’s release process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-releases/index">Release notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/upgrading">Upgrading Wagtail</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.15">Wagtail 2.15 release notes - IN DEVELOPMENT</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.14.1">Wagtail 2.14.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.14">Wagtail 2.14 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.13.4">Wagtail 2.13.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.13.3">Wagtail 2.13.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.13.2">Wagtail 2.13.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.13.1">Wagtail 2.13.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.13">Wagtail 2.13 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12.6">Wagtail 2.12.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12.5">Wagtail 2.12.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12.4">Wagtail 2.12.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12.3">Wagtail 2.12.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12.2">Wagtail 2.12.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12.1">Wagtail 2.12.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12">Wagtail 2.12 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.8">Wagtail 2.11.8 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.7">Wagtail 2.11.7 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.6">Wagtail 2.11.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.5">Wagtail 2.11.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.4">Wagtail 2.11.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.3">Wagtail 2.11.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.2">Wagtail 2.11.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.1">Wagtail 2.11.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11">Wagtail 2.11 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.10.2">Wagtail 2.10.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.10.1">Wagtail 2.10.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.10">Wagtail 2.10 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.9.3">Wagtail 2.9.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.9.2">Wagtail 2.9.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.9.1">Wagtail 2.9.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.9">Wagtail 2.9 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.8.2">Wagtail 2.8.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.8.1">Wagtail 2.8.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.8">Wagtail 2.8 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.7.4">Wagtail 2.7.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.7.3">Wagtail 2.7.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.7.2">Wagtail 2.7.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.7.1">Wagtail 2.7.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.7">Wagtail 2.7 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.6.3">Wagtail 2.6.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.6.2">Wagtail 2.6.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.6.1">Wagtail 2.6.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.6">Wagtail 2.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.5.2">Wagtail 2.5.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.5.1">Wagtail 2.5.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.5">Wagtail 2.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.4">Wagtail 2.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.3">Wagtail 2.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.2.2">Wagtail 2.2.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.2.1">Wagtail 2.2.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.2">Wagtail 2.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.1.3">Wagtail 2.1.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.1.2">Wagtail 2.1.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.1.1">Wagtail 2.1.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.1">Wagtail 2.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.0.2">Wagtail 2.0.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.0.1">Wagtail 2.0.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.0">Wagtail 2.0 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.13.4">Wagtail 1.13.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.13.3">Wagtail 1.13.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.13.2">Wagtail 1.13.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.13.1">Wagtail 1.13.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.13">Wagtail 1.13 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12.6">Wagtail 1.12.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12.5">Wagtail 1.12.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12.4">Wagtail 1.12.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12.3">Wagtail 1.12.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12.2">Wagtail 1.12.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12.1">Wagtail 1.12.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12">Wagtail 1.12 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.11.1">Wagtail 1.11.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.11">Wagtail 1.11 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.10.1">Wagtail 1.10.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.10">Wagtail 1.10 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.9.1">Wagtail 1.9.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.9">Wagtail 1.9 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.8.2">Wagtail 1.8.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.8.1">Wagtail 1.8.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.8">Wagtail 1.8 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.7">Wagtail 1.7 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.6.3">Wagtail 1.6.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.6.2">Wagtail 1.6.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.6.1">Wagtail 1.6.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.6">Wagtail 1.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.5.3">Wagtail 1.5.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.5.2">Wagtail 1.5.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.5.1">Wagtail 1.5.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.5">Wagtail 1.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4.6">Wagtail 1.4.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4.5">Wagtail 1.4.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4.4">Wagtail 1.4.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4.3">Wagtail 1.4.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4.2">Wagtail 1.4.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4.1">Wagtail 1.4.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4">Wagtail 1.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.3.1">Wagtail 1.3.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.3">Wagtail 1.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.2">Wagtail 1.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.1">Wagtail 1.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.0">Wagtail 1.0 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.10">Wagtail 0.8.10 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.8">Wagtail 0.8.8 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.7">Wagtail 0.8.7 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.6">Wagtail 0.8.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.5">Wagtail 0.8.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.4">Wagtail 0.8.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.3">Wagtail 0.8.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.1">Wagtail 0.8.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8">Wagtail 0.8 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.7">Wagtail 0.7 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.6">Wagtail 0.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.5">Wagtail 0.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.4.1">Wagtail 0.4.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.4">Wagtail 0.4 release notes</a></li>
</ul>
</li>
</ul>

                        </nav>
                    </div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <main class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="index.html#document-index">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">Wagtail Documentation 2.15a0 documentation</li>
    </ol>
</nav>
                    </div><div class="col-auto d-none d-lg-block">
                            <div>
        <a class="btn btn-sm btn-light" href="https://github.com/wagtail/wagtail/blob/main/docs/index" rel="nofollow">
            <span class="btn-icon"><span class="fab fa-github"></span></span>
            <span class="btn-text">Edit on GitHub</span>
        </a>
</div>
                        </div>
                    
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <article class="col-12 col-lg-9 order-last order-lg-first">
    <div class="section" id="welcome-to-wagtail-s-documentation">
<h1>Welcome to Wagtail’s documentation<a class="headerlink" href="#welcome-to-wagtail-s-documentation" title="Permalink to this headline">¶</a></h1>
<p>Wagtail is an open source CMS written in <a class="reference external" href="https://www.python.org/">Python</a> and built on the <a class="reference external" href="https://www.djangoproject.com/">Django web framework</a>.</p>
<p>Below are some useful links to help you get started with Wagtail.</p>
<p>If you’d like to get a quick feel for Wagtail, try spinning up a <a class="reference external" href="https://gitpod.io/#https://github.com/wagtail/wagtail-gitpod">temporary developer environment</a> in your browser (running on Gitpod - here’s <a class="reference external" href="https://wagtail.io/blog/gitpod/">how it works</a>).</p>
<ul class="simple">
<li><strong>First steps</strong><ul>
<li><a class="reference internal" href="index.html#document-getting_started/index"><span class="doc">Getting started</span></a></li>
<li><a class="reference internal" href="index.html#document-getting_started/tutorial"><span class="doc">Your first Wagtail site</span></a></li>
<li><a class="reference internal" href="index.html#document-getting_started/demo_site"><span class="doc">Demo site</span></a></li>
</ul>
</li>
<li><strong>Using Wagtail</strong><ul>
<li><a class="reference internal" href="index.html#document-topics/pages"><span class="doc">Page models</span></a></li>
<li><a class="reference internal" href="index.html#document-topics/writing_templates"><span class="doc">Writing templates</span></a></li>
<li><a class="reference internal" href="index.html#document-topics/images"><span class="doc">How to use images in templates</span></a></li>
<li><a class="reference internal" href="index.html#document-topics/search/index"><span class="doc">Search</span></a></li>
<li><a class="reference internal" href="index.html#document-advanced_topics/third_party_tutorials"><span class="doc">Third-party tutorials</span></a></li>
</ul>
</li>
<li><strong>For editors</strong><ul>
<li><a class="reference internal" href="index.html#document-editor_manual/index"><span class="doc">Editors guide</span></a></li>
</ul>
</li>
</ul>
<div class="section" id="index">
<h2>Index<a class="headerlink" href="#index" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-getting_started/index"></span><div class="section" id="getting-started">
<h3>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These instructions assume familiarity with virtual environments and the
<a class="reference external" href="https://www.djangoproject.com/">Django web framework</a>.
For more detailed instructions, see <a class="reference internal" href="index.html#document-getting_started/tutorial"><span class="doc">Your first Wagtail site</span></a>.
To add Wagtail to an existing Django project, see <a class="reference internal" href="index.html#document-getting_started/integrating_into_django"><span class="doc">Integrating Wagtail into a Django project</span></a>.</p>
</div>
<div class="section" id="dependencies-needed-for-installation">
<h4>Dependencies needed for installation<a class="headerlink" href="#dependencies-needed-for-installation" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.python.org/downloads/">Python 3</a></li>
<li><strong>libjpeg</strong> and <strong>zlib</strong>, libraries required for Django’s <strong>Pillow</strong> library.
See Pillow’s <a class="reference external" href="https://pillow.readthedocs.org/en/latest/installation.html#external-libraries">platform-specific installation instructions</a>.</li>
</ul>
</div>
<div class="section" id="quick-install">
<h4>Quick install<a class="headerlink" href="#quick-install" title="Permalink to this headline">¶</a></h4>
<p>Run the following in a virtual environment of your choice:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ pip install wagtail
</pre></div>
</div>
<p>(Installing outside a virtual environment may require <code class="docutils literal notranslate"><span class="pre">sudo</span></code>.)</p>
<p>Once installed, Wagtail provides a command similar to Django’s <code class="docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">startproject</span></code> to generate a new site/project:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ wagtail start mysite
</pre></div>
</div>
<p>This will create a new folder <code class="docutils literal notranslate"><span class="pre">mysite</span></code>, based on a template containing everything you need to get started.
More information on that template is available in
<a class="reference internal" href="index.html#document-reference/project_template"><span class="doc">the project template reference</span></a>.</p>
<p>Inside your <code class="docutils literal notranslate"><span class="pre">mysite</span></code> folder, run the setup steps necessary for any Django project:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ pip install -r requirements.txt
$ ./manage.py migrate
$ ./manage.py createsuperuser
$ ./manage.py runserver
</pre></div>
</div>
<p>Your site is now accessible at <code class="docutils literal notranslate"><span class="pre">http://localhost:8000</span></code>, with the admin backend available at <code class="docutils literal notranslate"><span class="pre">http://localhost:8000/admin/</span></code>.</p>
<p>This will set you up with a new stand-alone Wagtail project.
If you’d like to add Wagtail to an existing Django project instead, see <a class="reference internal" href="index.html#document-getting_started/integrating_into_django"><span class="doc">Integrating Wagtail into a Django project</span></a>.</p>
<p>There are a few optional packages which are not installed by default but are recommended to improve performance or add features to Wagtail, including:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="index.html#document-advanced_topics/performance"><span class="doc">Elasticsearch</span></a>.</li>
<li><a class="reference internal" href="index.html#image-feature-detection"><span class="std std-ref">Feature Detection</span></a>.</li>
</ul>
</div></blockquote>
<div class="toctree-wrapper compound">
<span id="document-getting_started/tutorial"></span><div class="section" id="your-first-wagtail-site">
<h5>Your first Wagtail site<a class="headerlink" href="#your-first-wagtail-site" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This tutorial covers setting up a brand new Wagtail project.
If you’d like to add Wagtail to an existing Django project instead, see <a class="reference internal" href="index.html#document-getting_started/integrating_into_django"><span class="doc">Integrating Wagtail into a Django project</span></a>.</p>
</div>
<div class="section" id="install-and-run-wagtail">
<h6>Install and run Wagtail<a class="headerlink" href="#install-and-run-wagtail" title="Permalink to this headline">¶</a></h6>
<div class="section" id="install-dependencies">
<h7>Install dependencies<a class="headerlink" href="#install-dependencies" title="Permalink to this headline">¶</a></h7>
<p>Wagtail supports Python 3.6, 3.7, 3.8 and 3.9.</p>
<p>To check whether you have an appropriate version of Python 3:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3 --version
</pre></div>
</div>
<p>If this does not return a version number or returns a version lower than 3.6, you will need to <a class="reference external" href="https://www.python.org/downloads/">install Python 3</a>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Before installing Wagtail, it is necessary to install the <strong>libjpeg</strong> and <strong>zlib</strong> libraries, which provide support for working with JPEG, PNG and GIF images (via the Python <strong>Pillow</strong> library).
The way to do this varies by platform—see Pillow’s
<a class="reference external" href="https://pillow.readthedocs.org/en/latest/installation.html#external-libraries">platform-specific installation instructions</a>.</p>
</div>
</div>
<div class="section" id="create-and-activate-a-virtual-environment">
<h7>Create and activate a virtual environment<a class="headerlink" href="#create-and-activate-a-virtual-environment" title="Permalink to this headline">¶</a></h7>
<p>We recommend using a virtual environment, which isolates installed dependencies from other projects.
This tutorial uses <a class="reference external" href="https://docs.python.org/3/tutorial/venv.html"><code class="docutils literal notranslate"><span class="pre">venv</span></code></a>, which is packaged with Python 3.</p>
<p><strong>On Windows</strong> (cmd.exe):</p>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> python3 -m venv mysite\env
<span class="gp">&gt;</span> mysite\env\Scripts\activate.bat
</pre></div>
</div>
<p><strong>On GNU/Linux or MacOS</strong> (bash):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3 -m venv mysite/env
<span class="gp">$ </span><span class="nb">source</span> mysite/env/bin/activate
</pre></div>
</div>
<p><strong>For other shells</strong> see the <a class="reference external" href="https://docs.python.org/3/library/venv.html"><code class="docutils literal notranslate"><span class="pre">venv</span></code> documentation</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you’re using version control (e.g. git), <code class="docutils literal notranslate"><span class="pre">mysite</span></code> will be the directory for your project.
The <code class="docutils literal notranslate"><span class="pre">env</span></code> directory inside of it should be excluded from any version control.</p>
</div>
</div>
<div class="section" id="install-wagtail">
<h7>Install Wagtail<a class="headerlink" href="#install-wagtail" title="Permalink to this headline">¶</a></h7>
<p>Use pip, which is packaged with Python, to install Wagtail and its dependencies:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip install wagtail
</pre></div>
</div>
</div>
<div class="section" id="generate-your-site">
<h7>Generate your site<a class="headerlink" href="#generate-your-site" title="Permalink to this headline">¶</a></h7>
<p>Wagtail provides a <code class="docutils literal notranslate"><span class="pre">start</span></code> command similar to <code class="docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">startproject</span></code>.
Running <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">start</span> <span class="pre">mysite</span></code> in your project will generate a new <code class="docutils literal notranslate"><span class="pre">mysite</span></code> folder with a few Wagtail-specific extras, including
the required project settings,
a “home” app with a blank <code class="docutils literal notranslate"><span class="pre">HomePage</span></code> model and basic templates,
and a sample “search” app.</p>
<p>Because the folder <code class="docutils literal notranslate"><span class="pre">mysite</span></code> was already created by <code class="docutils literal notranslate"><span class="pre">venv</span></code>, run <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">start</span></code> with an additional argument to specify the destination directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>wagtail start mysite mysite
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Generally, in Wagtail, each page type, or content type, is represented by a single app. However, different apps can be aware of each other and   access each other’s data. All of the apps need to be registered within the <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> section of the <code class="docutils literal notranslate"><span class="pre">settings</span></code> file. Look at this file to see how the <code class="docutils literal notranslate"><span class="pre">start</span></code> command has listed them in there.</p>
</div>
</div>
<div class="section" id="install-project-dependencies">
<h7>Install project dependencies<a class="headerlink" href="#install-project-dependencies" title="Permalink to this headline">¶</a></h7>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span> mysite
<span class="gp">$ </span>pip install -r requirements.txt
</pre></div>
</div>
<p>This ensures that you have the relevant versions of
Wagtail,
Django,
and any other dependencies for the project you have just created.</p>
</div>
<div class="section" id="create-the-database">
<h7>Create the database<a class="headerlink" href="#create-the-database" title="Permalink to this headline">¶</a></h7>
<p>If you haven’t updated the project settings, this will be a SQLite database file in the project directory.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python manage.py migrate
</pre></div>
</div>
<p>This command ensures that the tables in your database are matched to the models in your project. Every time you alter your model (eg. you may add a field to a model) you will need to run this command in order to update the database.</p>
</div>
<div class="section" id="create-an-admin-user">
<h7>Create an admin user<a class="headerlink" href="#create-an-admin-user" title="Permalink to this headline">¶</a></h7>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python manage.py createsuperuser
</pre></div>
</div>
<p>When logged into the admin site, a superuser has full permissions and is able to view/create/manage the database.</p>
</div>
<div class="section" id="start-the-server">
<h7>Start the server<a class="headerlink" href="#start-the-server" title="Permalink to this headline">¶</a></h7>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python manage.py runserver
</pre></div>
</div>
<p>If everything worked, <a class="reference external" href="http://127.0.0.1:8000">http://127.0.0.1:8000</a> will show you a welcome page:</p>
<p><img alt="_images/tutorial_1.png" src="_images/tutorial_1.png" /></p>
<p>You can now access the administrative area at <a class="reference external" href="http://127.0.0.1:8000/admin">http://127.0.0.1:8000/admin</a></p>
<p><img alt="_images/tutorial_2.png" src="_images/tutorial_2.png" /></p>
</div>
</div>
<div class="section" id="extend-the-homepage-model">
<h6>Extend the HomePage model<a class="headerlink" href="#extend-the-homepage-model" title="Permalink to this headline">¶</a></h6>
<p>Out of the box, the “home” app defines a blank <code class="docutils literal notranslate"><span class="pre">HomePage</span></code> model in <code class="docutils literal notranslate"><span class="pre">models.py</span></code>, along with a migration that creates a homepage and configures Wagtail to use it.</p>
<p>Edit <code class="docutils literal notranslate"><span class="pre">home/models.py</span></code> as follows, to add a <code class="docutils literal notranslate"><span class="pre">body</span></code> field to the model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">FieldPanel</span>


<span class="k">class</span> <span class="nc">HomePage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">body</span></code> is defined as <code class="docutils literal notranslate"><span class="pre">RichTextField</span></code>, a special Wagtail field. When <code class="docutils literal notranslate"><span class="pre">blank=True</span></code>,
it means that this field is not required and can be empty. You
can use any of the <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/fields">Django core fields</a>. <code class="docutils literal notranslate"><span class="pre">content_panels</span></code> define the
capabilities and the layout of the editing interface. When you add fields to <code class="docutils literal notranslate"><span class="pre">content_panels</span></code>, it enables them to be edited on the Wagtail interface. <a class="reference internal" href="index.html#document-topics/pages"><span class="doc">More on creating Page models</span></a>.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">makemigrations</span></code> (this will create the migrations file), then
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></code> (this executes the migrations and updates the database with your model
changes). You must run the above commands each time you make changes to
the model definition.</p>
<p>You can now edit the homepage within the Wagtail admin area (go to Pages, Homepage, then Edit) to see the new body field. Enter some text into the body field, and publish
the page by selecting <em>Publish</em> at the bottom of the page editor, rather than <em>Save Draft</em>.</p>
<p>The page template now needs to be updated to reflect the changes made
to the model. Wagtail uses normal Django templates to render each page
type. By default, it will look for a template filename formed from the app and model name,
separating capital letters with underscores (e.g. HomePage within the ‘home’ app becomes
<code class="docutils literal notranslate"><span class="pre">home/home_page.html</span></code>). This template file can exist in any location recognised by
<a class="reference external" href="https://docs.djangoproject.com/en/stable/intro/tutorial03/#write-views-that-actually-do-something">Django’s template rules</a>; conventionally it is placed under a <code class="docutils literal notranslate"><span class="pre">templates</span></code> folder within the app.</p>
<p>Edit <code class="docutils literal notranslate"><span class="pre">home/templates/home/home_page.html</span></code> to contain the following:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body_class</span> <span class="cp">%}</span>template-homepage<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="cp">{{</span> <span class="nv">page.body</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">base.html</span></code> refers to a parent template and must always be the first template tag used in a template. Extending from this template saves you from rewriting code and allows pages across your app to share a similar frame (by using block tags in the child template, you are able to override specific content within the parent template).</p>
<p><code class="docutils literal notranslate"><span class="pre">wagtailcore_tags</span></code> must also be loaded at the top of the template and provide additional tags to those provided by Django.</p>
<p><img alt="_images/tutorial_3.png" src="_images/tutorial_3.png" /></p>
<div class="section" id="wagtail-template-tags">
<h7>Wagtail template tags<a class="headerlink" href="#wagtail-template-tags" title="Permalink to this headline">¶</a></h7>
<p>In addition to Django’s <a class="reference external" href="https://docs.djangoproject.com/en/3.1/ref/templates/builtins/">template tags and filters</a>,
Wagtail provides a number of its own <a class="reference internal" href="index.html#template-tags-and-filters"><span class="std std-ref">template tags &amp; filters</span></a>
which can be loaded by including <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">wagtailcore_tags</span> <span class="pre">%}</span></code> at the top of
your template file.</p>
<p>In this tutorial, we use the <em>richtext</em> filter to escape and print the contents
of a <code class="docutils literal notranslate"><span class="pre">RichTextField</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">page.body</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>Produces:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Welcome<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span> to our new site!
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><strong>Note:</strong> You’ll need to include <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">wagtailcore_tags</span> <span class="pre">%}</span></code> in each
template that uses Wagtail’s tags. Django will throw a <code class="docutils literal notranslate"><span class="pre">TemplateSyntaxError</span></code>
if the tags aren’t loaded.</p>
</div>
</div>
<div class="section" id="a-basic-blog">
<h6>A basic blog<a class="headerlink" href="#a-basic-blog" title="Permalink to this headline">¶</a></h6>
<p>We are now ready to create a blog. To do so, run
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">startapp</span> <span class="pre">blog</span></code> to create a new app in your Wagtail site.</p>
<p>Add the new <code class="docutils literal notranslate"><span class="pre">blog</span></code> app to <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> in <code class="docutils literal notranslate"><span class="pre">mysite/settings/base.py</span></code>.</p>
<div class="section" id="blog-index-and-posts">
<h7>Blog Index and Posts<a class="headerlink" href="#blog-index-and-posts" title="Permalink to this headline">¶</a></h7>
<p>Lets start with a simple index page for our blog. In <code class="docutils literal notranslate"><span class="pre">blog/models.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">FieldPanel</span>


<span class="k">class</span> <span class="nc">BlogIndexPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">)</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">makemigrations</span></code> and <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></code>.</p>
<p>Since the model is called <code class="docutils literal notranslate"><span class="pre">BlogIndexPage</span></code>, the default template name
(unless we override it) will be <code class="docutils literal notranslate"><span class="pre">blog/templates/blog/blog_index_page.html</span></code>. Create this file
with the following content:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body_class</span> <span class="cp">%}</span>template-blogindexpage<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;intro&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">page.intro</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">page.get_children</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">post</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
        <span class="cp">{{</span> <span class="nv">post.specific.intro</span> <span class="cp">}}</span>
        <span class="cp">{{</span> <span class="nv">post.specific.body</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Most of this should be familiar, but we’ll explain <code class="docutils literal notranslate"><span class="pre">get_children</span></code> a bit later.
Note the <code class="docutils literal notranslate"><span class="pre">pageurl</span></code> tag, which is similar to Django’s <code class="docutils literal notranslate"><span class="pre">url</span></code> tag but
takes a Wagtail Page object as an argument.</p>
<p>In the Wagtail admin, create a <code class="docutils literal notranslate"><span class="pre">BlogIndexPage</span></code> as a child of the Homepage,
make sure it has the slug “blog” on the Promote tab, and publish it.
You should now be able to access the url <code class="docutils literal notranslate"><span class="pre">/blog</span></code> on your site
(note how the slug from the Promote tab defines the page URL).</p>
<p>Now we need a model and template for our blog posts. In <code class="docutils literal notranslate"><span class="pre">blog/models.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">FieldPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.search</span> <span class="kn">import</span> <span class="n">index</span>


<span class="c1"># Keep the definition of BlogIndexPage, and add:</span>


<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="s2">&quot;Post date&quot;</span><span class="p">)</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">search_fields</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">),</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>In the model above, we import <code class="docutils literal notranslate"><span class="pre">index</span></code> as this makes the model searchable. You can then list fields that you want to be searchable for the user.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">makemigrations</span></code> and <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></code>.</p>
<p>Create a template at <code class="docutils literal notranslate"><span class="pre">blog/templates/blog/blog_page.html</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body_class</span> <span class="cp">%}</span>template-blogpage<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;meta&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">page.date</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;intro&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">page.intro</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="cp">{{</span> <span class="nv">page.body</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span>

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">page.get_parent.url</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>Return to blog<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Note the use of Wagtail’s built-in <code class="docutils literal notranslate"><span class="pre">get_parent()</span></code> method to obtain the
URL of the blog this post is a part of.</p>
<p>Now create a few blog posts as children of <code class="docutils literal notranslate"><span class="pre">BlogIndexPage</span></code>.
Be sure to select type “Blog Page” when creating your posts.</p>
<p><img alt="_images/tutorial_4a.png" src="_images/tutorial_4a.png" /></p>
<p><img alt="_images/tutorial_4b.png" src="_images/tutorial_4b.png" /></p>
<p>Wagtail gives you full control over what kinds of content can be created under
various parent content types. By default, any page type can be a child of any
other page type.</p>
<p><img alt="_images/tutorial_5.png" src="_images/tutorial_5.png" /></p>
<p>Publish each blog post when you are done editing.</p>
<p>You should now have the very beginnings of a working blog.
Access the <code class="docutils literal notranslate"><span class="pre">/blog</span></code> URL and you should see something like this:</p>
<p><img alt="_images/tutorial_7.png" src="_images/tutorial_7.png" /></p>
<p>Titles should link to post pages, and a link back to the blog’s
homepage should appear in the footer of each post page.</p>
</div>
<div class="section" id="parents-and-children">
<h7>Parents and Children<a class="headerlink" href="#parents-and-children" title="Permalink to this headline">¶</a></h7>
<p>Much of the work you’ll be doing in Wagtail revolves around the concept of hierarchical
“tree” structures consisting of nodes and leaves (see <a class="reference internal" href="index.html#document-reference/pages/theory"><span class="doc">Theory</span></a>).
In this case, the <code class="docutils literal notranslate"><span class="pre">BlogIndexPage</span></code> is a “node” and individual <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> instances
are the “leaves”.</p>
<p>Take another look at the guts of <code class="docutils literal notranslate"><span class="pre">blog_index_page.html</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">page.get_children</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">post</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">post.specific.intro</span> <span class="cp">}}</span>
    <span class="cp">{{</span> <span class="nv">post.specific.body</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Every “page” in Wagtail can call out to its parent or children
from its own position in the hierarchy. But why do we have to
specify <code class="docutils literal notranslate"><span class="pre">post.specific.intro</span></code> rather than <code class="docutils literal notranslate"><span class="pre">post.intro</span></code>?
This has to do with the way we defined our model:</p>
<p><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">BlogPage(Page):</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">get_children()</span></code> method gets us a list of instances of the <code class="docutils literal notranslate"><span class="pre">Page</span></code> base class.
When we want to reference properties of the instances that inherit from the base class,
Wagtail provides the <code class="docutils literal notranslate"><span class="pre">specific</span></code> method that retrieves the actual <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> record.
While the “title” field is present on the base <code class="docutils literal notranslate"><span class="pre">Page</span></code> model, “intro” is only present
on the <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> model, so we need <code class="docutils literal notranslate"><span class="pre">.specific</span></code> to access it.</p>
<p>To tighten up template code like this, we could use Django’s <code class="docutils literal notranslate"><span class="pre">with</span></code> tag:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">page.get_children</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">with</span> <span class="nv">post</span><span class="o">=</span><span class="nv">post.specific</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">post</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">post.intro</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="cp">{{</span> <span class="nv">post.body</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>When you start writing more customized Wagtail code, you’ll find a whole set of QuerySet
modifiers to help you navigate the hierarchy.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Given a page object &#39;somepage&#39;:</span>
<span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">descendant_of</span><span class="p">(</span><span class="n">somepage</span><span class="p">)</span>
<span class="n">child_of</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> <span class="o">/</span> <span class="n">not_child_of</span><span class="p">(</span><span class="n">somepage</span><span class="p">)</span>
<span class="n">ancestor_of</span><span class="p">(</span><span class="n">somepage</span><span class="p">)</span> <span class="o">/</span> <span class="n">not_ancestor_of</span><span class="p">(</span><span class="n">somepage</span><span class="p">)</span>
<span class="n">parent_of</span><span class="p">(</span><span class="n">somepage</span><span class="p">)</span> <span class="o">/</span> <span class="n">not_parent_of</span><span class="p">(</span><span class="n">somepage</span><span class="p">)</span>
<span class="n">sibling_of</span><span class="p">(</span><span class="n">somepage</span><span class="p">)</span> <span class="o">/</span> <span class="n">not_sibling_of</span><span class="p">(</span><span class="n">somepage</span><span class="p">)</span>
<span class="c1"># ... and ...</span>
<span class="n">somepage</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span>
<span class="n">somepage</span><span class="o">.</span><span class="n">get_ancestors</span><span class="p">()</span>
<span class="n">somepage</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">()</span>
<span class="n">somepage</span><span class="o">.</span><span class="n">get_siblings</span><span class="p">()</span>
</pre></div>
</div>
<p>For more information, see: <a class="reference internal" href="index.html#document-reference/pages/queryset_reference"><span class="doc">Page QuerySet reference</span></a></p>
</div>
<div class="section" id="overriding-context">
<h7>Overriding Context<a class="headerlink" href="#overriding-context" title="Permalink to this headline">¶</a></h7>
<p>There are a couple of problems with our blog index view:</p>
<ol class="simple">
<li>Blogs generally display content in <em>reverse</em> chronological order</li>
<li>We want to make sure we’re only displaying <em>published</em> content.</li>
</ol>
<p>To accomplish these things, we need to do more than just grab the index
page’s children in the template. Instead, we’ll want to modify the
QuerySet in the model definition. Wagtail makes this possible via
the overridable <code class="docutils literal notranslate"><span class="pre">get_context()</span></code> method. Modify your <code class="docutils literal notranslate"><span class="pre">BlogIndexPage</span></code>
model like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogIndexPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># Update context to include only published posts, ordered by reverse-chron</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">blogpages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-first_published_at&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogpages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blogpages</span>
        <span class="k">return</span> <span class="n">context</span>
</pre></div>
</div>
<p>All we’ve done here is retrieve the original context, create a custom QuerySet,
add it to the retrieved context, and return the modified context back to the view.
You’ll also need to modify your <code class="docutils literal notranslate"><span class="pre">blog_index_page.html</span></code> template slightly.
Change:</p>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">post</span> <span class="pre">in</span> <span class="pre">page.get_children</span> <span class="pre">%}</span></code> to <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">post</span> <span class="pre">in</span> <span class="pre">blogpages</span> <span class="pre">%}</span></code></p>
<p>Now try unpublishing one of your posts - it should disappear from the blog index
page. The remaining posts should now be sorted with the most recently published
posts first.</p>
</div>
<div class="section" id="images">
<h7>Images<a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h7>
<p>Let’s add the ability to attach an image gallery to our blog posts. While it’s possible to simply insert images into the <code class="docutils literal notranslate"><span class="pre">body</span></code> rich text field, there are several advantages to setting up our gallery images as a new dedicated object type within the database - this way, you have full control of the layout and styling of the images on the template, rather than having to lay them out in a particular way within the rich text field. It also makes it possible for the images to be used elsewhere, independently of the blog text - for example, displaying a thumbnail on the blog index page.</p>
<p>Add a new <code class="docutils literal notranslate"><span class="pre">BlogPageGalleryImage</span></code> model to <code class="docutils literal notranslate"><span class="pre">models.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1"># New imports added for ParentalKey, Orderable, InlinePanel, ImageChooserPanel</span>

<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span><span class="p">,</span> <span class="n">Orderable</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">InlinePanel</span>
<span class="kn">from</span> <span class="nn">wagtail.images.edit_handlers</span> <span class="kn">import</span> <span class="n">ImageChooserPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.search</span> <span class="kn">import</span> <span class="n">index</span>


<span class="c1"># ... (Keep the definition of BlogIndexPage, and update BlogPage:)</span>


<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="s2">&quot;Post date&quot;</span><span class="p">)</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">search_fields</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">),</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;gallery_images&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gallery images&quot;</span><span class="p">),</span>
    <span class="p">]</span>


<span class="k">class</span> <span class="nc">BlogPageGalleryImage</span><span class="p">(</span><span class="n">Orderable</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="n">BlogPage</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;gallery_images&#39;</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;wagtailimages.Image&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span>
    <span class="p">)</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ImageChooserPanel</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;caption&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">makemigrations</span></code> and <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></code>.</p>
<p>There are a few new concepts here, so let’s take them one at a time:</p>
<p>Inheriting from <code class="docutils literal notranslate"><span class="pre">Orderable</span></code> adds a <code class="docutils literal notranslate"><span class="pre">sort_order</span></code> field to the model, to keep track of the ordering of images in the gallery.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ParentalKey</span></code> to <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> is what attaches the gallery images to a specific page. A <code class="docutils literal notranslate"><span class="pre">ParentalKey</span></code> works similarly to a <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code>, but also defines <code class="docutils literal notranslate"><span class="pre">BlogPageGalleryImage</span></code> as a “child” of the <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> model, so that it’s treated as a fundamental part of the page in operations like submitting for moderation, and tracking revision history.</p>
<p><code class="docutils literal notranslate"><span class="pre">image</span></code> is a <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> to Wagtail’s built-in <code class="docutils literal notranslate"><span class="pre">Image</span></code> model, where the images themselves are stored. This comes with a dedicated panel type, <code class="docutils literal notranslate"><span class="pre">ImageChooserPanel</span></code>, which provides a pop-up interface for choosing an existing image or uploading a new one. This way, we allow an image to exist in multiple galleries - effectively, we’ve created a many-to-many relationship between pages and images.</p>
<p>Specifying <code class="docutils literal notranslate"><span class="pre">on_delete=models.CASCADE</span></code> on the foreign key means that if the image is deleted from the system, the gallery entry is deleted as well. (In other situations, it might be appropriate to leave the entry in place - for example, if an “our staff” page included a list of people with headshots, and one of those photos was deleted, we’d rather leave the person in place on the page without a photo. In this case, we’d set the foreign key to <code class="docutils literal notranslate"><span class="pre">blank=True,</span> <span class="pre">null=True,</span> <span class="pre">on_delete=models.SET_NULL</span></code>.)</p>
<p>Finally, adding the <code class="docutils literal notranslate"><span class="pre">InlinePanel</span></code> to <code class="docutils literal notranslate"><span class="pre">BlogPage.content_panels</span></code> makes the gallery images available on the editing interface for <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code>.</p>
<p>Adjust your blog page template to include the images:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="nv">wagtailimages_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body_class</span> <span class="cp">%}</span>template-blogpage<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;meta&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">page.date</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;intro&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">page.intro</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="cp">{{</span> <span class="nv">page.body</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span>

    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">item</span> <span class="k">in</span> <span class="nv">page.gallery_images.all</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;float: left; margin: 10px&quot;</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">image</span> <span class="nv">item.image</span> <span class="nv">fill-320x240</span> <span class="cp">%}</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">item.caption</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">page.get_parent.url</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>Return to blog<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Here we use the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag (which exists in the <code class="docutils literal notranslate"><span class="pre">wagtailimages_tags</span></code> library, imported at the top of the template) to insert an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> element, with a <code class="docutils literal notranslate"><span class="pre">fill-320x240</span></code> parameter to indicate that the image should be resized and cropped to fill a 320x240 rectangle. You can read more about using images in templates in the <a class="reference internal" href="index.html#document-topics/images"><span class="doc">docs</span></a>.</p>
<p><img alt="_images/tutorial_6.jpg" src="_images/tutorial_6.jpg" /></p>
<p>Since our gallery images are database objects in their own right, we can now query and re-use them independently of the blog post body. Let’s define a <code class="docutils literal notranslate"><span class="pre">main_image</span></code> method, which returns the image from the first gallery item (or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no gallery items exist):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="s2">&quot;Post date&quot;</span><span class="p">)</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">main_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gallery_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gallery_images</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">gallery_item</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gallery_item</span><span class="o">.</span><span class="n">image</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">search_fields</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">),</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;gallery_images&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gallery images&quot;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>This method is now available from our templates. Update <code class="docutils literal notranslate"><span class="pre">blog_index_page.html</span></code> to include the main image as a thumbnail alongside each post:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="nv">wagtailimages_tags</span> <span class="cp">%}</span>

...

<span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">blogpages</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">with</span> <span class="nv">post</span><span class="o">=</span><span class="nv">post.specific</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">post</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

        <span class="cp">{%</span> <span class="k">with</span> <span class="nv">post.main_image</span> <span class="k">as</span> <span class="nv">main_image</span> <span class="cp">%}</span>
            <span class="cp">{%</span> <span class="k">if</span> <span class="nv">main_image</span> <span class="cp">%}{%</span> <span class="k">image</span> <span class="nv">main_image</span> <span class="nv">fill-160x100</span> <span class="cp">%}{%</span> <span class="k">endif</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>

        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">post.intro</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="cp">{{</span> <span class="nv">post.body</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="tagging-posts">
<h7>Tagging Posts<a class="headerlink" href="#tagging-posts" title="Permalink to this headline">¶</a></h7>
<p>Let’s say we want to let editors “tag” their posts, so that readers can, e.g.,
view all bicycle-related content together. For this, we’ll need to invoke
the tagging system bundled with Wagtail, attach it to the <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code>
model and content panels, and render linked tags on the blog post template.
Of course, we’ll need a working tag-specific URL view as well.</p>
<p>First, alter <code class="docutils literal notranslate"><span class="pre">models.py</span></code> once more:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1"># New imports added for ClusterTaggableManager, TaggedItemBase, MultiFieldPanel</span>

<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">modelcluster.contrib.taggit</span> <span class="kn">import</span> <span class="n">ClusterTaggableManager</span>
<span class="kn">from</span> <span class="nn">taggit.models</span> <span class="kn">import</span> <span class="n">TaggedItemBase</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span><span class="p">,</span> <span class="n">Orderable</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">InlinePanel</span><span class="p">,</span> <span class="n">MultiFieldPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.images.edit_handlers</span> <span class="kn">import</span> <span class="n">ImageChooserPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.search</span> <span class="kn">import</span> <span class="n">index</span>


<span class="c1"># ... (Keep the definition of BlogIndexPage)</span>


<span class="k">class</span> <span class="nc">BlogPageTag</span><span class="p">(</span><span class="n">TaggedItemBase</span><span class="p">):</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span>
        <span class="s1">&#39;BlogPage&#39;</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;tagged_items&#39;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span>
    <span class="p">)</span>


<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="s2">&quot;Post date&quot;</span><span class="p">)</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">ClusterTaggableManager</span><span class="p">(</span><span class="n">through</span><span class="o">=</span><span class="n">BlogPageTag</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ... (Keep the main_image method and search_fields definition)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">MultiFieldPanel</span><span class="p">([</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="n">heading</span><span class="o">=</span><span class="s2">&quot;Blog information&quot;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;gallery_images&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gallery images&quot;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">makemigrations</span></code> and <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></code>.</p>
<p>Note the new <code class="docutils literal notranslate"><span class="pre">modelcluster</span></code> and <code class="docutils literal notranslate"><span class="pre">taggit</span></code> imports, the addition of a new
<code class="docutils literal notranslate"><span class="pre">BlogPageTag</span></code> model, and the addition of a <code class="docutils literal notranslate"><span class="pre">tags</span></code> field on <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code>.
We’ve also taken the opportunity to use a <code class="docutils literal notranslate"><span class="pre">MultiFieldPanel</span></code> in <code class="docutils literal notranslate"><span class="pre">content_panels</span></code>
to group the date and tags fields together for readability.</p>
<p>Edit one of your <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> instances, and you should now be able to tag posts:</p>
<p><img alt="_images/tutorial_8.png" src="_images/tutorial_8.png" /></p>
<p>To render tags on a <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code>, add this to <code class="docutils literal notranslate"><span class="pre">blog_page.html</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page.tags.all.count</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;tags&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Tags<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">tag</span> <span class="k">in</span> <span class="nv">page.tags.all</span> <span class="cp">%}</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">slugurl</span> <span class="s1">&#39;tags&#39;</span> <span class="cp">%}</span><span class="s">?tag=</span><span class="cp">{{</span> <span class="nv">tag</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">tag</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Notice that we’re linking to pages here with the builtin <code class="docutils literal notranslate"><span class="pre">slugurl</span></code>
tag rather than <code class="docutils literal notranslate"><span class="pre">pageurl</span></code>, which we used earlier. The difference is that <code class="docutils literal notranslate"><span class="pre">slugurl</span></code> takes a
Page slug (from the Promote tab) as an argument. <code class="docutils literal notranslate"><span class="pre">pageurl</span></code> is more commonly used because it
is unambiguous and avoids extra database lookups. But in the case of this loop, the Page object
isn’t readily available, so we fall back on the less-preferred <code class="docutils literal notranslate"><span class="pre">slugurl</span></code> tag.</p>
<p>Visiting a blog post with tags should now show a set of linked
buttons at the bottom - one for each tag. However, clicking a button
will get you a 404, since we haven’t yet defined a “tags” view. Add to <code class="docutils literal notranslate"><span class="pre">models.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogTagIndexPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

        <span class="c1"># Filter by tag</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tag&#39;</span><span class="p">)</span>
        <span class="n">blogpages</span> <span class="o">=</span> <span class="n">BlogPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tags__name</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>

        <span class="c1"># Update template context</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogpages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blogpages</span>
        <span class="k">return</span> <span class="n">context</span>
</pre></div>
</div>
<p>Note that this Page-based model defines no fields of its own.
Even without fields, subclassing <code class="docutils literal notranslate"><span class="pre">Page</span></code> makes it a part of the
Wagtail ecosystem, so that you can give it a title and URL in the
admin, and so that you can manipulate its contents by returning
a QuerySet from its <code class="docutils literal notranslate"><span class="pre">get_context()</span></code> method.</p>
<p>Migrate this in, then create a new <code class="docutils literal notranslate"><span class="pre">BlogTagIndexPage</span></code> in the admin.
You’ll probably want to create the new page/view as a child of Homepage,
parallel to your Blog index. Give it the slug “tags” on the Promote tab.</p>
<p>Access <code class="docutils literal notranslate"><span class="pre">/tags</span></code> and Django will tell you what you probably already knew:
you need to create a template <code class="docutils literal notranslate"><span class="pre">blog/blog_tag_index_page.html</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">request.GET.tag</span><span class="o">|</span><span class="nf">length</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;</span>Showing pages tagged &quot;<span class="cp">{{</span> <span class="nv">request.GET.tag</span> <span class="cp">}}</span>&quot;<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">blogpage</span> <span class="k">in</span> <span class="nv">blogpages</span> <span class="cp">%}</span>

          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">blogpage</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">blogpage.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">strong</span><span class="p">&gt;&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
              <span class="p">&lt;</span><span class="nt">small</span><span class="p">&gt;</span>Revised: <span class="cp">{{</span> <span class="nv">blogpage.latest_revision_created_at</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
              <span class="cp">{%</span> <span class="k">if</span> <span class="nv">blogpage.author</span> <span class="cp">%}</span>
                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>By <span class="cp">{{</span> <span class="nv">blogpage.author.profile</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
              <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
          <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

    <span class="cp">{%</span> <span class="k">empty</span> <span class="cp">%}</span>
        No pages found with that tag.
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>We’re calling the built-in <code class="docutils literal notranslate"><span class="pre">latest_revision_created_at</span></code> field on the <code class="docutils literal notranslate"><span class="pre">Page</span></code>
model - handy to know this is always available.</p>
<p>We haven’t yet added an “author” field to our <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> model, nor do we have
a Profile model for authors - we’ll leave those as an exercise for the reader.</p>
<p>Clicking the tag button at the bottom of a BlogPost should now render a page
something like this:</p>
<p><img alt="_images/tutorial_9.png" src="_images/tutorial_9.png" /></p>
</div>
<div class="section" id="categories">
<span id="tutorial-categories"></span><h7>Categories<a class="headerlink" href="#categories" title="Permalink to this headline">¶</a></h7>
<p>Let’s add a category system to our blog. Unlike tags, where a page author can bring a tag into existence simply by using it on a page, our categories will be a fixed list, managed by the site owner through a separate area of the admin interface.</p>
<p>First, we define a <code class="docutils literal notranslate"><span class="pre">BlogCategory</span></code> model. A category is not a page in its own right, and so we define it as a standard Django <code class="docutils literal notranslate"><span class="pre">models.Model</span></code> rather than inheriting from <code class="docutils literal notranslate"><span class="pre">Page</span></code>. Wagtail introduces the concept of “snippets” for reusable pieces of content that need to be managed through the admin interface, but do not exist as part of the page tree themselves; a model can be registered as a snippet by adding the <code class="docutils literal notranslate"><span class="pre">&#64;register_snippet</span></code> decorator. All the field types we’ve used so far on pages can be used on snippets too - here we’ll give each category an icon image as well as a name. Add to <code class="docutils literal notranslate"><span class="pre">blog/models.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.snippets.models</span> <span class="kn">import</span> <span class="n">register_snippet</span>


<span class="nd">@register_snippet</span>
<span class="k">class</span> <span class="nc">BlogCategory</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">icon</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;wagtailimages.Image&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span>
    <span class="p">)</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
        <span class="n">ImageChooserPanel</span><span class="p">(</span><span class="s1">&#39;icon&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s1">&#39;blog categories&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that we are using <code class="docutils literal notranslate"><span class="pre">panels</span></code> rather than <code class="docutils literal notranslate"><span class="pre">content_panels</span></code> here - since snippets generally have no need for fields such as slug or publish date, the editing interface for them is not split into separate ‘content’ / ‘promote’ / ‘settings’ tabs as standard, and so there is no need to distinguish between ‘content panels’ and ‘promote panels’.</p>
</div>
<p>Migrate this change in, and create a few categories through the Snippets area which now appears in the admin menu.</p>
<p>We can now add categories to the <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> model, as a many-to-many field. The field type we use for this is <code class="docutils literal notranslate"><span class="pre">ParentalManyToManyField</span></code> - this is a variant of the standard Django <code class="docutils literal notranslate"><span class="pre">ManyToManyField</span></code> which ensures that the chosen objects are correctly stored against the page record in the revision history, in much the same way that <code class="docutils literal notranslate"><span class="pre">ParentalKey</span></code> replaces <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> for one-to-many relations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># New imports added for forms and ParentalManyToManyField</span>
<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span><span class="p">,</span> <span class="n">ParentalManyToManyField</span>
<span class="kn">from</span> <span class="nn">modelcluster.contrib.taggit</span> <span class="kn">import</span> <span class="n">ClusterTaggableManager</span>
<span class="kn">from</span> <span class="nn">taggit.models</span> <span class="kn">import</span> <span class="n">TaggedItemBase</span>

<span class="c1"># ...</span>

<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="s2">&quot;Post date&quot;</span><span class="p">)</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">ClusterTaggableManager</span><span class="p">(</span><span class="n">through</span><span class="o">=</span><span class="n">BlogPageTag</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">categories</span> <span class="o">=</span> <span class="n">ParentalManyToManyField</span><span class="p">(</span><span class="s1">&#39;blog.BlogCategory&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ... (Keep the main_image method and search_fields definition)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">MultiFieldPanel</span><span class="p">([</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;categories&#39;</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">CheckboxSelectMultiple</span><span class="p">),</span>
        <span class="p">],</span> <span class="n">heading</span><span class="o">=</span><span class="s2">&quot;Blog information&quot;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;gallery_images&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gallery images&quot;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Here we’re making use of the <code class="docutils literal notranslate"><span class="pre">widget</span></code> keyword argument on the <code class="docutils literal notranslate"><span class="pre">FieldPanel</span></code> definition to specify a checkbox-based widget instead of the default multiple select box, as this is often considered more user-friendly.</p>
<p>Finally, we can update the <code class="docutils literal notranslate"><span class="pre">blog_page.html</span></code> template to display the categories:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;meta&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">page.date</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cp">{%</span> <span class="k">with</span> <span class="nv">categories</span><span class="o">=</span><span class="nv">page.categories.all</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">categories</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Posted in:<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">for</span> <span class="nv">category</span> <span class="k">in</span> <span class="nv">categories</span> <span class="cp">%}</span>
                <span class="p">&lt;</span><span class="nt">li</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display: inline&quot;</span><span class="p">&gt;</span>
                    <span class="cp">{%</span> <span class="k">image</span> <span class="nv">category.icon</span> <span class="nv">fill-32x32</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;vertical-align: middle&quot;</span> <span class="cp">%}</span>
                    <span class="cp">{{</span> <span class="nv">category.name</span> <span class="cp">}}</span>
                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><img alt="_images/tutorial_10.jpg" src="_images/tutorial_10.jpg" /></p>
</div>
</div>
<div class="section" id="where-next">
<h6>Where next<a class="headerlink" href="#where-next" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Read the Wagtail <a class="reference internal" href="index.html#document-topics/index"><span class="doc">topics</span></a> and <a class="reference internal" href="index.html#document-reference/index"><span class="doc">reference</span></a> documentation</li>
<li>Learn how to implement <a class="reference internal" href="index.html#document-topics/streamfield"><span class="doc">StreamField</span></a> for freeform page content</li>
<li>Browse through the <a class="reference internal" href="index.html#document-advanced_topics/index"><span class="doc">advanced topics</span></a> section and read <a class="reference internal" href="index.html#document-advanced_topics/third_party_tutorials"><span class="doc">third-party tutorials</span></a></li>
</ul>
</div>
</div>
<span id="document-getting_started/demo_site"></span><div class="section" id="demo-site">
<h5>Demo site<a class="headerlink" href="#demo-site" title="Permalink to this headline">¶</a></h5>
<p>To create a new site on Wagtail we recommend the <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">start</span></code> command in <a class="reference internal" href="index.html#document-index"><span class="doc">Getting started</span></a>. We also have a demo site, The Wagtail Bakery, which contains example page types and models. We recommend you use the demo site for testing during development of Wagtail itself.</p>
<p>The source code and installation instructions can be found at <a class="reference external" href="https://github.com/wagtail/bakerydemo">https://github.com/wagtail/bakerydemo</a></p>
</div>
<span id="document-getting_started/integrating_into_django"></span><div class="section" id="integrating-wagtail-into-a-django-project">
<span id="integrating-into-django"></span><h5>Integrating Wagtail into a Django project<a class="headerlink" href="#integrating-wagtail-into-a-django-project" title="Permalink to this headline">¶</a></h5>
<p>Wagtail provides the <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">start</span></code> command and project template to get you started with a new Wagtail project as quickly as possible, but it’s easy to integrate Wagtail into an existing Django project too.</p>
<p>Wagtail is currently compatible with Django 3.0, 3.1 and 3.2. First, install the <code class="docutils literal notranslate"><span class="pre">wagtail</span></code> package from PyPI:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ pip install wagtail
</pre></div>
</div>
<p>or add the package to your existing requirements file. This will also install the <strong>Pillow</strong> library as a dependency, which requires libjpeg and zlib - see Pillow’s <a class="reference external" href="https://pillow.readthedocs.org/en/latest/installation.html#external-libraries">platform-specific installation instructions</a>.</p>
<div class="section" id="settings">
<h6>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h6>
<p>In your settings file, add the following apps to <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;wagtail.contrib.forms&#39;</span><span class="p">,</span>
<span class="s1">&#39;wagtail.contrib.redirects&#39;</span><span class="p">,</span>
<span class="s1">&#39;wagtail.embeds&#39;</span><span class="p">,</span>
<span class="s1">&#39;wagtail.sites&#39;</span><span class="p">,</span>
<span class="s1">&#39;wagtail.users&#39;</span><span class="p">,</span>
<span class="s1">&#39;wagtail.snippets&#39;</span><span class="p">,</span>
<span class="s1">&#39;wagtail.documents&#39;</span><span class="p">,</span>
<span class="s1">&#39;wagtail.images&#39;</span><span class="p">,</span>
<span class="s1">&#39;wagtail.search&#39;</span><span class="p">,</span>
<span class="s1">&#39;wagtail.admin&#39;</span><span class="p">,</span>
<span class="s1">&#39;wagtail.core&#39;</span><span class="p">,</span>

<span class="s1">&#39;modelcluster&#39;</span><span class="p">,</span>
<span class="s1">&#39;taggit&#39;</span><span class="p">,</span>
</pre></div>
</div>
<p>Add the following entry to <code class="docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;wagtail.contrib.redirects.middleware.RedirectMiddleware&#39;</span><span class="p">,</span>
</pre></div>
</div>
<p>Add a <code class="docutils literal notranslate"><span class="pre">STATIC_ROOT</span></code> setting, if your project does not have one already:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;static&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Add <code class="docutils literal notranslate"><span class="pre">MEDIA_ROOT</span></code> and <code class="docutils literal notranslate"><span class="pre">MEDIA_URL</span></code> settings, if your project does not have these already:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;media&#39;</span><span class="p">)</span>
<span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s1">&#39;/media/&#39;</span>
</pre></div>
</div>
<p>Add a <code class="docutils literal notranslate"><span class="pre">WAGTAIL_SITE_NAME</span></code> - this will be displayed on the main dashboard of the Wagtail admin backend:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_SITE_NAME</span> <span class="o">=</span> <span class="s1">&#39;My Example Site&#39;</span>
</pre></div>
</div>
<p>Various other settings are available to configure Wagtail’s behaviour - see <a class="reference internal" href="index.html#document-reference/settings"><span class="doc">Settings</span></a>.</p>
</div>
<div class="section" id="url-configuration">
<h6>URL configuration<a class="headerlink" href="#url-configuration" title="Permalink to this headline">¶</a></h6>
<p>Now make the following additions to your <code class="docutils literal notranslate"><span class="pre">urls.py</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>

<span class="kn">from</span> <span class="nn">wagtail.admin</span> <span class="kn">import</span> <span class="n">urls</span> <span class="k">as</span> <span class="n">wagtailadmin_urls</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">urls</span> <span class="k">as</span> <span class="n">wagtail_urls</span>
<span class="kn">from</span> <span class="nn">wagtail.documents</span> <span class="kn">import</span> <span class="n">urls</span> <span class="k">as</span> <span class="n">wagtaildocs_urls</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;cms/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtailadmin_urls</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;documents/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtaildocs_urls</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;pages/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtail_urls</span><span class="p">)),</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The URL paths here can be altered as necessary to fit your project’s URL scheme.</p>
<p><code class="docutils literal notranslate"><span class="pre">wagtailadmin_urls</span></code> provides the admin interface for Wagtail. This is separate from the Django admin interface (<code class="docutils literal notranslate"><span class="pre">django.contrib.admin</span></code>); Wagtail-only projects typically host the Wagtail admin at <code class="docutils literal notranslate"><span class="pre">/admin/</span></code>, but if this would clash with your project’s existing admin backend then an alternative path can be used, such as <code class="docutils literal notranslate"><span class="pre">/cms/</span></code> here.</p>
<p><code class="docutils literal notranslate"><span class="pre">wagtaildocs_urls</span></code> is the location from where document files will be served. This can be omitted if you do not intend to use Wagtail’s document management features.</p>
<p><code class="docutils literal notranslate"><span class="pre">wagtail_urls</span></code> is the base location from where the pages of your Wagtail site will be served. In the above example, Wagtail will handle URLs under <code class="docutils literal notranslate"><span class="pre">/pages/</span></code>, leaving the root URL and other paths to be handled as normal by your Django project. If you want Wagtail to handle the entire URL space including the root URL, this can be replaced with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtail_urls</span><span class="p">)),</span>
</pre></div>
</div>
<p>In this case, this should be placed at the end of the <code class="docutils literal notranslate"><span class="pre">urlpatterns</span></code> list, so that it does not override more specific URL patterns.</p>
<p>Finally, your project needs to be set up to serve user-uploaded files from <code class="docutils literal notranslate"><span class="pre">MEDIA_ROOT</span></code>. Your Django project may already have this in place, but if not, add the following snippet to <code class="docutils literal notranslate"><span class="pre">urls.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.conf.urls.static</span> <span class="kn">import</span> <span class="n">static</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ... the rest of your URLconf goes here ...</span>
<span class="p">]</span> <span class="o">+</span> <span class="n">static</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_URL</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this only works in development mode (<code class="docutils literal notranslate"><span class="pre">DEBUG</span> <span class="pre">=</span> <span class="pre">True</span></code>); in production, you will need to configure your web server to serve files from <code class="docutils literal notranslate"><span class="pre">MEDIA_ROOT</span></code>. For further details, see the Django documentation: <a class="reference external" href="https://docs.djangoproject.com/en/stable/howto/static-files/#serving-files-uploaded-by-a-user-during-development">Serving files uploaded by a user during development</a> and <a class="reference external" href="https://docs.djangoproject.com/en/stable/howto/static-files/deployment/">Deploying static files</a>.</p>
<p>With this configuration in place, you are ready to run <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">migrate</span></code> to create the database tables used by Wagtail.</p>
</div>
<div class="section" id="user-accounts">
<h6>User accounts<a class="headerlink" href="#user-accounts" title="Permalink to this headline">¶</a></h6>
<p>Superuser accounts receive automatic access to the Wagtail admin interface; use <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">createsuperuser</span></code> if you don’t already have one. Custom user models are supported, with some restrictions; Wagtail uses an extension of Django’s permissions framework, so your user model must at minimum inherit from <code class="docutils literal notranslate"><span class="pre">AbstractBaseUser</span></code> and <code class="docutils literal notranslate"><span class="pre">PermissionsMixin</span></code>.</p>
</div>
<div class="section" id="start-developing">
<h6>Start developing<a class="headerlink" href="#start-developing" title="Permalink to this headline">¶</a></h6>
<p>You’re now ready to add a new app to your Django project (via <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">startapp</span></code> - remember to add it to <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>) and set up page models, as described in <a class="reference internal" href="index.html#document-getting_started/tutorial"><span class="doc">Your first Wagtail site</span></a>.</p>
<p>Note that there’s one small difference when not using the Wagtail project template: Wagtail creates an initial homepage of the basic type <code class="docutils literal notranslate"><span class="pre">Page</span></code>, which does not include any content fields beyond the title. You’ll probably want to replace this with your own <code class="docutils literal notranslate"><span class="pre">HomePage</span></code> class - when you do so, ensure that you set up a site record (under Settings / Sites in the Wagtail admin) to point to the new homepage.</p>
</div>
</div>
<span id="document-getting_started/the_zen_of_wagtail"></span><div class="section" id="the-zen-of-wagtail">
<h5>The Zen of Wagtail<a class="headerlink" href="#the-zen-of-wagtail" title="Permalink to this headline">¶</a></h5>
<p>Wagtail has been born out of many years of experience building websites, learning approaches that work and ones that don’t, and striking a balance between power and simplicity, structure and flexibility. We hope you’ll find that Wagtail is in that sweet spot. However, as a piece of software, Wagtail can only take that mission so far - it’s now up to you to create a site that’s beautiful and a joy to work with. So, while it’s tempting to rush ahead and start building, it’s worth taking a moment to understand the design principles that Wagtail is built on.</p>
<p>In the spirit of <a class="reference external" href="https://www.python.org/dev/peps/pep-0020/">“The Zen of Python”</a>, The Zen of Wagtail is a set of guiding principles, both for building websites in Wagtail, and for the ongoing development of Wagtail itself.</p>
<div class="section" id="wagtail-is-not-an-instant-website-in-a-box">
<h6>Wagtail is not an instant website in a box.<a class="headerlink" href="#wagtail-is-not-an-instant-website-in-a-box" title="Permalink to this headline">¶</a></h6>
<p>You can’t make a beautiful website by plugging off-the-shelf modules together - expect to write code.</p>
</div>
<div class="section" id="always-wear-the-right-hat">
<h6>Always wear the right hat.<a class="headerlink" href="#always-wear-the-right-hat" title="Permalink to this headline">¶</a></h6>
<p>The key to using Wagtail effectively is to recognise that there are multiple roles involved in creating a website: the content author, site administrator, developer and designer. These may well be different people, but they don’t have to be - if you’re using Wagtail to build your personal blog, you’ll probably find yourself hopping between those different roles. Either way, it’s important to be aware of which of those hats you’re wearing at any moment, and to use the right tools for that job. A content author or site administrator will do the bulk of their work through the Wagtail admin interface; a developer or designer will spend most of their time writing Python, HTML or CSS code. This is a good thing: Wagtail isn’t designed to replace the job of programming. Maybe one day someone will come up with a drag-and-drop UI for building websites that’s as powerful as writing code, but Wagtail is not that tool, and does not try to be.</p>
<p>A common mistake is to push too much power and responsibility into the hands of the content author and site administrator - indeed, if those people are your clients, they’ll probably be loudly clamouring for exactly that. The success of your site depends on your ability to say no. The real power of content management comes not from handing control over to CMS users, but from setting clear boundaries between the different roles. Amongst other things, this means not having editors doing design and layout within the content editing interface, and not having site administrators building complex interaction workflows that would be better achieved in code.</p>
</div>
<div class="section" id="a-cms-should-get-information-out-of-an-editor-s-head-and-into-a-database-as-efficiently-and-directly-as-possible">
<h6>A CMS should get information out of an editor’s head and into a database, as efficiently and directly as possible.<a class="headerlink" href="#a-cms-should-get-information-out-of-an-editor-s-head-and-into-a-database-as-efficiently-and-directly-as-possible" title="Permalink to this headline">¶</a></h6>
<p>Whether your site is about cars, cats, cakes or conveyancing, your content authors will be arriving at the Wagtail admin interface with some domain-specific information they want to put up on the website. Your aim as a site builder is to extract and store this information in its raw form - not one particular author’s idea of how that information should look.</p>
<p>Keeping design concerns out of page content has numerous advantages. It ensures that the design remains consistent across the whole site, not subject to the whims of editors from one day to the next. It allows you to make full use of the informational content of the pages - for example, if your pages are about events, then having a dedicated “Event” page type with data fields for the event date and location will let you present the events in a calendar view or filtered listing, which wouldn’t be possible if those were just implemented as different styles of heading on a generic page. Finally, if you redesign the site at some point in the future, or move it to a different platform entirely, you can be confident that the site content will work in its new setting, and not be reliant on being formatted a particular way.</p>
<p>Suppose a content author comes to you with a request: “We need this text to be in bright pink Comic Sans”. Your question to them should be “Why? What’s special about this particular bit of text?” If the reply is “I just like the look of it”, then you’ll have to gently persuade them that it’s not up to them to make design choices. (Sorry.) But if the answer is “it’s for our Children’s section”, then that gives you a way to divide the editorial and design concerns: give your editors the ability to designate certain pages as being “the Children’s section” (through tagging, different page models, or the site hierarchy) and let designers decide how to apply styles based on that.</p>
</div>
<div class="section" id="the-best-user-interface-for-a-programmer-is-usually-a-programming-language">
<h6>The best user interface for a programmer is usually a programming language.<a class="headerlink" href="#the-best-user-interface-for-a-programmer-is-usually-a-programming-language" title="Permalink to this headline">¶</a></h6>
<p>A common sight in content management systems is a point-and-click interface to let you define the data model that makes up a page:</p>
<p><img alt="_images/drupal_content_type.png" src="_images/drupal_content_type.png" /></p>
<p>It looks nice in the sales pitch, but in reality, no CMS end-user can realistically make that kind of fundamental change - on a live site, no less - unless they have a programmer’s insight into how the site is built, and what impact the change will have. As such, it will always be the programmer’s job to negotiate that point-and-click interface - all you’ve done is taken them away from the comfortable world of writing code, where they have a whole ecosystem of tools, from text editors to version control systems, to help them develop, test and deploy their code changes.</p>
<p>Wagtail recognises that most programming tasks are best done by writing code, and does not try to turn them into box-filling exercises when there’s no good reason to. Likewise, when building functionality for your site, you should keep in mind that some features are destined to be maintained by the programmer rather than a content editor, and consider whether making them configurable through the Wagtail admin is going to be more of a hindrance than a convenience. For example, Wagtail provides a form builder to allow content authors to create general-purpose data collection forms. You might be tempted to use this as the basis for more complex forms that integrate with (for example) a CRM system or payment processor - however, in this case there’s no way to edit the form fields without rewriting the backend logic, so making them editable through Wagtail has limited value. More likely, you’d be better off building these using Django’s form framework, where the form fields are defined entirely in code.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-topics/index"></span><div class="section" id="usage-guide">
<h3>Usage guide<a class="headerlink" href="#usage-guide" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-topics/pages"></span><div class="section" id="page-models">
<h4>Page models<a class="headerlink" href="#page-models" title="Permalink to this headline">¶</a></h4>
<p>Each page type (a.k.a. content type) in Wagtail is represented by a Django model. All page models must inherit from the <a class="reference internal" href="index.html#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">wagtail.core.models.Page</span></code></a> class.</p>
<p>As all page types are Django models, you can use any field type that Django provides. See <a class="reference external" href="https://docs.djangoproject.com/en/3.1/ref/models/fields/">Model field reference</a> for a complete list of field types you can use. Wagtail also provides <code class="docutils literal notranslate"><span class="pre">wagtail.core.fields.RichTextField</span></code> which provides a WYSIWYG editor for editing rich-text content.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you’re not yet familiar with Django models, have a quick look at the following links to get you started:</p>
<ul class="last simple">
<li><a class="reference external" href="https://docs.djangoproject.com/en/stable/intro/tutorial02/#creating-models" title="(in Django v3.2)"><span class="xref std std-ref">Creating models</span></a></li>
<li><a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/db/models/" title="(in Django v3.2)"><span class="xref std std-doc">Model syntax</span></a></li>
</ul>
</div>
<div class="section" id="an-example-wagtail-page-model">
<h5>An example Wagtail page model<a class="headerlink" href="#an-example-wagtail-page-model" title="Permalink to this headline">¶</a></h5>
<p>This example represents a typical blog post:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span><span class="p">,</span> <span class="n">Orderable</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">MultiFieldPanel</span><span class="p">,</span> <span class="n">InlinePanel</span>
<span class="kn">from</span> <span class="nn">wagtail.images.edit_handlers</span> <span class="kn">import</span> <span class="n">ImageChooserPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.search</span> <span class="kn">import</span> <span class="n">index</span>


<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>

    <span class="c1"># Database fields</span>

    <span class="n">body</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="s2">&quot;Post date&quot;</span><span class="p">)</span>
    <span class="n">feed_image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;wagtailimages.Image&#39;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span>
    <span class="p">)</span>


    <span class="c1"># Search index configuration</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">search_fields</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
        <span class="n">index</span><span class="o">.</span><span class="n">FilterField</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
    <span class="p">]</span>


    <span class="c1"># Editor panels configuration</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;related_links&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Related links&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">promote_panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">MultiFieldPanel</span><span class="p">(</span><span class="n">Page</span><span class="o">.</span><span class="n">promote_panels</span><span class="p">,</span> <span class="s2">&quot;Common page configuration&quot;</span><span class="p">),</span>
        <span class="n">ImageChooserPanel</span><span class="p">(</span><span class="s1">&#39;feed_image&#39;</span><span class="p">),</span>
    <span class="p">]</span>


    <span class="c1"># Parent page / subpage type rules</span>

    <span class="n">parent_page_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blog.BlogIndex&#39;</span><span class="p">]</span>
    <span class="n">subpage_types</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">class</span> <span class="nc">BlogPageRelatedLink</span><span class="p">(</span><span class="n">Orderable</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="n">BlogPage</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;related_links&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">()</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ensure that none of your field names are the same as your class names. This will cause errors due to the way Django handles relations (<a class="reference external" href="https://github.com/wagtail/wagtail/issues/503">read more</a>). In our examples we have avoided this by appending “Page” to each model name.</p>
</div>
</div>
<div class="section" id="writing-page-models">
<h5>Writing page models<a class="headerlink" href="#writing-page-models" title="Permalink to this headline">¶</a></h5>
<p>Here we’ll describe each section of the above example to help you create your own page models.</p>
<div class="section" id="database-fields">
<h6>Database fields<a class="headerlink" href="#database-fields" title="Permalink to this headline">¶</a></h6>
<p>Each Wagtail page type is a Django model, represented in the database as a separate table.</p>
<p>Each page type can have its own set of fields. For example, a news article may have body text and a published date, whereas an event page may need separate fields for venue and start/finish times.</p>
<p>In Wagtail, you can use any Django field class. Most field classes provided by third party apps should work as well.</p>
<p>Wagtail also provides a couple of field classes of its own:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">RichTextField</span></code> - For rich text content</li>
<li><code class="docutils literal notranslate"><span class="pre">StreamField</span></code> - A block-based content field (see: <a class="reference external" href="./streamfield">Freeform page content using StreamField</a>)</li>
</ul>
<p>For tagging, Wagtail fully supports <a class="reference external" href="https://django-taggit.readthedocs.org/en/latest/">django-taggit</a> so we recommend using that.</p>
</div>
<div class="section" id="search">
<h6>Search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> attribute defines which fields are added to the search index and how they are indexed.</p>
<p>This should be a list of <code class="docutils literal notranslate"><span class="pre">SearchField</span></code> and <code class="docutils literal notranslate"><span class="pre">FilterField</span></code> objects. <code class="docutils literal notranslate"><span class="pre">SearchField</span></code> adds a field for full-text search. <code class="docutils literal notranslate"><span class="pre">FilterField</span></code> adds a field for filtering the results. A field can be indexed with both <code class="docutils literal notranslate"><span class="pre">SearchField</span></code> and <code class="docutils literal notranslate"><span class="pre">FilterField</span></code> at the same time (but only one instance of each).</p>
<p>In the above example, we’ve indexed <code class="docutils literal notranslate"><span class="pre">body</span></code> for full-text search and <code class="docutils literal notranslate"><span class="pre">date</span></code> for filtering.</p>
<p>The arguments that these field types accept are documented in <a class="reference internal" href="index.html#wagtailsearch-indexing-fields"><span class="std std-ref">indexing extra fields</span></a>.</p>
</div>
<div class="section" id="editor-panels">
<h6>Editor panels<a class="headerlink" href="#editor-panels" title="Permalink to this headline">¶</a></h6>
<p>There are a few attributes for defining how the page’s fields will be arranged in the page editor interface:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">content_panels</span></code> - For content, such as main body text</li>
<li><code class="docutils literal notranslate"><span class="pre">promote_panels</span></code> - For metadata, such as tags, thumbnail image and SEO title</li>
<li><code class="docutils literal notranslate"><span class="pre">settings_panels</span></code> - For settings, such as publish date</li>
</ul>
<p>Each of these attributes is set to a list of <code class="docutils literal notranslate"><span class="pre">EditHandler</span></code> objects, which defines which fields appear on which tabs and how they are structured on each tab.</p>
<p>Here’s a summary of the <code class="docutils literal notranslate"><span class="pre">EditHandler</span></code> classes that Wagtail provides out of the box. See <a class="reference internal" href="index.html#document-reference/pages/panels"><span class="doc">Panel types</span></a> for full descriptions.</p>
<p><strong>Basic</strong></p>
<p>These allow editing of model fields. The <code class="docutils literal notranslate"><span class="pre">FieldPanel</span></code> class will choose the correct widget based on the type of the field, though <code class="docutils literal notranslate"><span class="pre">StreamField</span></code> fields need to use a specialised panel class.</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#wagtail.admin.edit_handlers.FieldPanel" title="wagtail.admin.edit_handlers.FieldPanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">FieldPanel</span></code></a></li>
<li><a class="reference internal" href="index.html#wagtail.admin.edit_handlers.StreamFieldPanel" title="wagtail.admin.edit_handlers.StreamFieldPanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamFieldPanel</span></code></a></li>
</ul>
<p><strong>Structural</strong></p>
<p>These are used for structuring fields in the interface.</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#wagtail.admin.edit_handlers.MultiFieldPanel" title="wagtail.admin.edit_handlers.MultiFieldPanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiFieldPanel</span></code></a></li>
<li><a class="reference internal" href="index.html#wagtail.admin.edit_handlers.InlinePanel" title="wagtail.admin.edit_handlers.InlinePanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">InlinePanel</span></code></a></li>
<li><a class="reference internal" href="index.html#wagtail.admin.edit_handlers.FieldRowPanel" title="wagtail.admin.edit_handlers.FieldRowPanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">FieldRowPanel</span></code></a></li>
</ul>
<p><strong>Chooser</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> fields to certain models can use one of the below <code class="docutils literal notranslate"><span class="pre">ChooserPanel</span></code> classes. These add a nice modal chooser interface, and the image/document choosers also allow uploading new files without leaving the page editor.</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#wagtail.admin.edit_handlers.PageChooserPanel" title="wagtail.admin.edit_handlers.PageChooserPanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PageChooserPanel</span></code></a></li>
<li><a class="reference internal" href="index.html#wagtail.images.edit_handlers.ImageChooserPanel" title="wagtail.images.edit_handlers.ImageChooserPanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImageChooserPanel</span></code></a></li>
<li><a class="reference internal" href="index.html#wagtail.documents.edit_handlers.DocumentChooserPanel" title="wagtail.documents.edit_handlers.DocumentChooserPanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocumentChooserPanel</span></code></a></li>
<li><a class="reference internal" href="index.html#wagtail.snippets.edit_handlers.SnippetChooserPanel" title="wagtail.snippets.edit_handlers.SnippetChooserPanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">SnippetChooserPanel</span></code></a></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In order to use one of these choosers, the model being linked to must either be a page, image, document or snippet.</p>
<p class="last">Linking to any other model type is currently unsupported, you will need to use <code class="docutils literal notranslate"><span class="pre">FieldPanel</span></code> which will create a dropdown box.</p>
</div>
<div class="section" id="customising-the-page-editor-interface">
<h7>Customising the page editor interface<a class="headerlink" href="#customising-the-page-editor-interface" title="Permalink to this headline">¶</a></h7>
<p>The page editor can be customised further. See <a class="reference internal" href="index.html#document-advanced_topics/customisation/page_editing_interface"><span class="doc">Customising the editing interface</span></a>.</p>
</div>
</div>
<div class="section" id="parent-page-subpage-type-rules">
<span id="page-type-business-rules"></span><h6>Parent page / subpage type rules<a class="headerlink" href="#parent-page-subpage-type-rules" title="Permalink to this headline">¶</a></h6>
<p>These two attributes allow you to control where page types may be used in your site. It allows you to define rules like “blog entries may only be created under a blog index”.</p>
<p>Both take a list of model classes or model names. Model names are of the format <code class="docutils literal notranslate"><span class="pre">app_label.ModelName</span></code>. If the <code class="docutils literal notranslate"><span class="pre">app_label</span></code> is omitted, the same app is assumed.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">parent_page_types</span></code> limits which page types this type can be created under</li>
<li><code class="docutils literal notranslate"><span class="pre">subpage_types</span></code> limits which page types can be created under this type</li>
</ul>
<p>By default, any page type can be created under any page type and it is not necessary to set these attributes if that’s the desired behaviour.</p>
<p>Setting <code class="docutils literal notranslate"><span class="pre">parent_page_types</span></code> to an empty list is a good way of preventing a particular page type from being created in the editor interface.</p>
</div>
<div class="section" id="page-urls">
<span id="id1"></span><h6>Page URLs<a class="headerlink" href="#page-urls" title="Permalink to this headline">¶</a></h6>
<p>The most common method of retrieving page URLs is by using the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">pageurl</span> <span class="pre">%}</span></code> template tag. Since it’s called from a template, <code class="docutils literal notranslate"><span class="pre">pageurl</span></code> automatically includes the optimizations mentioned below. For more information, see <a class="reference internal" href="index.html#pageurl-tag"><span class="std std-ref">pageurl</span></a>.</p>
<p>Page models also include several low-level methods for overriding or accessing page URLs.</p>
<div class="section" id="customising-url-patterns-for-a-page-model">
<h7>Customising URL patterns for a page model<a class="headerlink" href="#customising-url-patterns-for-a-page-model" title="Permalink to this headline">¶</a></h7>
<p>The <code class="docutils literal notranslate"><span class="pre">Page.get_url_parts(request)</span></code> method will not typically be called directly, but may be overridden to define custom URL routing for a given page model. It should return a tuple of <code class="docutils literal notranslate"><span class="pre">(site_id,</span> <span class="pre">root_url,</span> <span class="pre">page_path)</span></code>, which are used by <code class="docutils literal notranslate"><span class="pre">get_url</span></code> and <code class="docutils literal notranslate"><span class="pre">get_full_url</span></code> (see below) to construct the given type of page URL.</p>
<p>When overriding <code class="docutils literal notranslate"><span class="pre">get_url_parts()</span></code>, you should accept <code class="docutils literal notranslate"><span class="pre">*args,</span> <span class="pre">**kwargs</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_url_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</pre></div>
</div>
<p>and pass those through at the point where you are calling <code class="docutils literal notranslate"><span class="pre">get_url_parts</span></code> on <code class="docutils literal notranslate"><span class="pre">super</span></code> (if applicable), e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_url_parts</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>While you could pass only the <code class="docutils literal notranslate"><span class="pre">request</span></code> keyword argument, passing all arguments as-is ensures compatibility with any
future changes to these method signatures.</p>
<p>For more information, please see <a class="reference internal" href="index.html#wagtail.core.models.Page.get_url_parts" title="wagtail.core.models.Page.get_url_parts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wagtail.core.models.Page.get_url_parts()</span></code></a>.</p>
</div>
<div class="section" id="obtaining-urls-for-page-instances">
<h7>Obtaining URLs for page instances<a class="headerlink" href="#obtaining-urls-for-page-instances" title="Permalink to this headline">¶</a></h7>
<p>The <code class="docutils literal notranslate"><span class="pre">Page.get_url(request)</span></code> method can be called whenever a page URL is needed. It defaults to returning local URLs (not including the protocol or domain) if it determines that the page is on the current site (via the hostname in <code class="docutils literal notranslate"><span class="pre">request</span></code>); otherwise, a full URL including the protocol and domain is returned. Whenever possible, the optional <code class="docutils literal notranslate"><span class="pre">request</span></code> argument should be included to enable per-request caching of site-level URL information and facilitate the generation of local URLs.</p>
<p>A common use case for <code class="docutils literal notranslate"><span class="pre">get_url(request)</span></code> is in any custom template tag your project may include for generating navigation menus. When writing such a custom template tag, ensure that it includes <code class="docutils literal notranslate"><span class="pre">takes_context=True</span></code> and use <code class="docutils literal notranslate"><span class="pre">context.get('request')</span></code> to safely pass the
request or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no request exists in the context.</p>
<p>For more information, please see <a class="reference internal" href="index.html#wagtail.core.models.Page.get_url" title="wagtail.core.models.Page.get_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wagtail.core.models.Page.get_url()</span></code></a>.</p>
<p>In the event a full URL (including the protocol and domain) is needed, <code class="docutils literal notranslate"><span class="pre">Page.get_full_url(request)</span></code> can be used instead. Whenever possible, the optional <code class="docutils literal notranslate"><span class="pre">request</span></code> argument should be included to enable per-request caching of site-level URL information.</p>
<p>For more information, please see <a class="reference internal" href="index.html#wagtail.core.models.Page.get_full_url" title="wagtail.core.models.Page.get_full_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wagtail.core.models.Page.get_full_url()</span></code></a>.</p>
</div>
</div>
</div>
<div class="section" id="template-rendering">
<h5>Template rendering<a class="headerlink" href="#template-rendering" title="Permalink to this headline">¶</a></h5>
<p>Each page model can be given an HTML template which is rendered when a user browses to a page on the site frontend. This is the simplest and most common way to get Wagtail content to end users (but not the only way).</p>
<div class="section" id="adding-a-template-for-a-page-model">
<h6>Adding a template for a page model<a class="headerlink" href="#adding-a-template-for-a-page-model" title="Permalink to this headline">¶</a></h6>
<p>Wagtail automatically chooses a name for the template based on the app label and model class name.</p>
<p>Format: <code class="docutils literal notranslate"><span class="pre">&lt;app_label&gt;/&lt;model_name</span> <span class="pre">(snake</span> <span class="pre">cased)&gt;.html</span></code></p>
<p>For example, the template for the above blog page will be: <code class="docutils literal notranslate"><span class="pre">blog/blog_page.html</span></code></p>
<p>You just need to create a template in a location where it can be accessed with this name.</p>
</div>
<div class="section" id="template-context">
<h6>Template context<a class="headerlink" href="#template-context" title="Permalink to this headline">¶</a></h6>
<p>Wagtail renders templates with the <code class="docutils literal notranslate"><span class="pre">page</span></code> variable bound to the page instance being rendered. Use this to access the content of the page. For example, to get the title of the current page, use <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">page.title</span> <span class="pre">}}</span></code>. All variables provided by <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/templates/api/#subclassing-context-requestcontext">context processors</a> are also available.</p>
<div class="section" id="customising-template-context">
<h7>Customising template context<a class="headerlink" href="#customising-template-context" title="Permalink to this headline">¶</a></h7>
<p>All pages have a <code class="docutils literal notranslate"><span class="pre">get_context</span></code> method that is called whenever the template is rendered and returns a dictionary of variables to bind into the template.</p>
<p>To add more variables to the template context, you can override this method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogIndexPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Add extra variables and return the updated context</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_entries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">child_of</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">live</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">context</span>
</pre></div>
</div>
<p>The variables can then be used in the template:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span>

<span class="cp">{%</span> <span class="k">for</span> <span class="nv">entry</span> <span class="k">in</span> <span class="nv">blog_entries</span> <span class="cp">%}</span>
    <span class="cp">{{</span> <span class="nv">entry.title</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="changing-the-template">
<h6>Changing the template<a class="headerlink" href="#changing-the-template" title="Permalink to this headline">¶</a></h6>
<p>Set the <code class="docutils literal notranslate"><span class="pre">template</span></code> attribute on the class to use a different template file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;other_template.html&#39;</span>
</pre></div>
</div>
<div class="section" id="dynamically-choosing-the-template">
<h7>Dynamically choosing the template<a class="headerlink" href="#dynamically-choosing-the-template" title="Permalink to this headline">¶</a></h7>
<p>The template can be changed on a per-instance basis by defining a <code class="docutils literal notranslate"><span class="pre">get_template</span></code> method on the page class. This method is called every time the page is rendered:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">use_other_template</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_other_template</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;blog/other_blog_page.html&#39;</span>

        <span class="k">return</span> <span class="s1">&#39;blog/blog_page.html&#39;</span>
</pre></div>
</div>
<p>In this example, pages that have the <code class="docutils literal notranslate"><span class="pre">use_other_template</span></code> boolean field set will use the <code class="docutils literal notranslate"><span class="pre">blog/other_blog_page.html</span></code> template. All other pages will use the default <code class="docutils literal notranslate"><span class="pre">blog/blog_page.html</span></code>.</p>
</div>
<div class="section" id="ajax-templates">
<h7>Ajax Templates<a class="headerlink" href="#ajax-templates" title="Permalink to this headline">¶</a></h7>
<p>If you want to add AJAX functionality to a page, such as a paginated listing that updates in-place on the page rather than triggering a full page reload, you can set the <code class="docutils literal notranslate"><span class="pre">ajax_template</span></code> attribute to specify an alternative template to be used when the page is requested via an AJAX call (as indicated by the <code class="docutils literal notranslate"><span class="pre">X-Requested-With:</span> <span class="pre">XMLHttpRequest</span></code> HTTP header):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">ajax_template</span> <span class="o">=</span> <span class="s1">&#39;other_template_fragment.html&#39;</span>
    <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;other_template.html&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="more-control-over-page-rendering">
<h6>More control over page rendering<a class="headerlink" href="#more-control-over-page-rendering" title="Permalink to this headline">¶</a></h6>
<p>All page classes have a <code class="docutils literal notranslate"><span class="pre">serve()</span></code> method that internally calls the <code class="docutils literal notranslate"><span class="pre">get_context</span></code> and <code class="docutils literal notranslate"><span class="pre">get_template</span></code> methods and renders the template. This method is similar to a Django view function, taking a Django <code class="docutils literal notranslate"><span class="pre">Request</span></code> object and returning a Django <code class="docutils literal notranslate"><span class="pre">Response</span></code> object.</p>
<p>This method can also be overridden for complete control over page rendering.</p>
<p>For example, here’s a way to make a page respond with a JSON representation of itself:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>


<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">serve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span>
            <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>

            <span class="c1"># Resizes the image to 300px width and gets a URL to it</span>
            <span class="s1">&#39;feed_image&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed_image</span><span class="o">.</span><span class="n">get_rendition</span><span class="p">(</span><span class="s1">&#39;width-300&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
        <span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="inline-models">
<h5>Inline models<a class="headerlink" href="#inline-models" title="Permalink to this headline">¶</a></h5>
<p>Wagtail can nest the content of other models within the page. This is useful for creating repeated fields, such as related links or items to display in a carousel. Inline model content is also versioned with the rest of the page content.</p>
<p>Each inline model requires the following:</p>
<ul class="simple">
<li>It must inherit from <a class="reference internal" href="index.html#wagtail.core.models.Orderable" title="wagtail.core.models.Orderable"><code class="xref py py-class docutils literal notranslate"><span class="pre">wagtail.core.models.Orderable</span></code></a></li>
<li>It must have a <cite>ParentalKey</cite> to the parent model</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>django-modelcluster and ParentalKey</p>
<p>The model inlining feature is provided by <a class="reference external" href="https://github.com/torchbox/django-modelcluster">django-modelcluster</a> and the <code class="docutils literal notranslate"><span class="pre">ParentalKey</span></code> field type must be imported from there:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
</pre></div>
</div>
<p class="last"><code class="docutils literal notranslate"><span class="pre">ParentalKey</span></code> is a subclass of Django’s <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code>, and takes the same arguments.</p>
</div>
<p>For example, the following inline model can be used to add related links (a list of name, url pairs) to the <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Orderable</span>


<span class="k">class</span> <span class="nc">BlogPageRelatedLink</span><span class="p">(</span><span class="n">Orderable</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="n">BlogPage</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;related_links&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">()</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>To add this to the admin interface, use the <a class="reference internal" href="index.html#wagtail.admin.edit_handlers.InlinePanel" title="wagtail.admin.edit_handlers.InlinePanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">InlinePanel</span></code></a> edit panel class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">content_panels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>

    <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;related_links&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Related links&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The first argument must match the value of the <code class="docutils literal notranslate"><span class="pre">related_name</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">ParentalKey</span></code>.</p>
</div>
<div class="section" id="working-with-pages">
<h5>Working with pages<a class="headerlink" href="#working-with-pages" title="Permalink to this headline">¶</a></h5>
<p>Wagtail uses Django’s <a class="reference external" href="https://docs.djangoproject.com/en/3.1/topics/db/models/#multi-table-inheritance">multi-table inheritance</a> feature to allow multiple page models to be used in the same tree.</p>
<p>Each page is added to both Wagtail’s builtin <a class="reference internal" href="index.html#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a> model as well as its user-defined model (such as the <cite>BlogPage</cite> model created earlier).</p>
<p>Pages can exist in Python code in two forms, an instance of <code class="docutils literal notranslate"><span class="pre">Page</span></code> or an instance of the page model.</p>
<p>When working with multiple page types together, you will typically use instances of Wagtail’s <code class="docutils literal notranslate"><span class="pre">Page</span></code> model, which don’t give you access to any fields specific to their type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get all pages in the database</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Page</span><span class="p">:</span> <span class="n">Homepage</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Page</span><span class="p">:</span> <span class="n">About</span> <span class="n">us</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Page</span><span class="p">:</span> <span class="n">Blog</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Page</span><span class="p">:</span> <span class="n">A</span> <span class="n">Blog</span> <span class="n">post</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Page</span><span class="p">:</span> <span class="n">Another</span> <span class="n">Blog</span> <span class="n">post</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>When working with a single page type, you can work with instances of the user-defined model. These give access to all the fields available in <code class="docutils literal notranslate"><span class="pre">Page</span></code>, along with any user-defined fields for that type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get all blog entries in the database</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">BlogPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">BlogPage</span><span class="p">:</span> <span class="n">A</span> <span class="n">Blog</span> <span class="n">post</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">BlogPage</span><span class="p">:</span> <span class="n">Another</span> <span class="n">Blog</span> <span class="n">post</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>You can convert a <code class="docutils literal notranslate"><span class="pre">Page</span></code> object to its more specific user-defined equivalent using the <code class="docutils literal notranslate"><span class="pre">.specific</span></code> property. This may cause an additional database lookup.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;A Blog post&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span>
<span class="go">&lt;Page: A Blog post&gt;</span>

<span class="go"># Note: the blog post is an instance of Page so we cannot access body, date or feed_image</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span><span class="o">.</span><span class="n">specific</span>
<span class="go">&lt;BlogPage: A Blog post&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="tips">
<h5>Tips<a class="headerlink" href="#tips" title="Permalink to this headline">¶</a></h5>
<div class="section" id="friendly-model-names">
<h6>Friendly model names<a class="headerlink" href="#friendly-model-names" title="Permalink to this headline">¶</a></h6>
<p>You can make your model names more friendly to users of Wagtail by using Django’s internal <code class="docutils literal notranslate"><span class="pre">Meta</span></code> class with a <code class="docutils literal notranslate"><span class="pre">verbose_name</span></code>, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HomePage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;homepage&quot;</span>
</pre></div>
</div>
<p>When users are given a choice of pages to create, the list of page types is generated by splitting your model names on each of their capital letters. Thus a <code class="docutils literal notranslate"><span class="pre">HomePage</span></code> model would be named “Home Page” which is a little clumsy. Defining <code class="docutils literal notranslate"><span class="pre">verbose_name</span></code> as in the example above would change this to read “Homepage”, which is slightly more conventional.</p>
</div>
<div class="section" id="page-queryset-ordering">
<h6>Page QuerySet ordering<a class="headerlink" href="#page-queryset-ordering" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">Page</span></code>-derived models <em>cannot</em> be given a default ordering by using the standard Django approach of adding an <code class="docutils literal notranslate"><span class="pre">ordering</span></code> attribute to the internal <code class="docutils literal notranslate"><span class="pre">Meta</span></code> class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NewsItemPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">publication_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="o">...</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-publication_date&#39;</span><span class="p">,</span> <span class="p">)</span>  <span class="c1"># will not work</span>
</pre></div>
</div>
<p>This is because <code class="docutils literal notranslate"><span class="pre">Page</span></code> enforces ordering QuerySets by path. Instead, you must apply the ordering explicitly when constructing a QuerySet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">news_items</span> <span class="o">=</span> <span class="n">NewsItemPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-publication_date&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-page-managers">
<span id="id2"></span><h6>Custom Page managers<a class="headerlink" href="#custom-page-managers" title="Permalink to this headline">¶</a></h6>
<p>You can add a custom <code class="docutils literal notranslate"><span class="pre">Manager</span></code> to your <code class="docutils literal notranslate"><span class="pre">Page</span></code> class. Any custom Managers should inherit from <code class="docutils literal notranslate"><span class="pre">wagtail.core.models.PageManager</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span><span class="p">,</span> <span class="n">PageManager</span>

<span class="k">class</span> <span class="nc">EventPageManager</span><span class="p">(</span><span class="n">PageManager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Custom manager for Event pages &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">EventPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">EventPageManager</span><span class="p">()</span>
</pre></div>
</div>
<p>Alternately, if you only need to add extra <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> methods, you can inherit from <code class="docutils literal notranslate"><span class="pre">wagtail.core.models.PageQuerySet</span></code> to build a custom <code class="docutils literal notranslate"><span class="pre">Manager</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span><span class="p">,</span> <span class="n">PageManager</span><span class="p">,</span> <span class="n">PageQuerySet</span>

<span class="k">class</span> <span class="nc">EventPageQuerySet</span><span class="p">(</span><span class="n">PageQuerySet</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">future</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">today</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">start_date__gte</span><span class="o">=</span><span class="n">today</span><span class="p">)</span>

<span class="n">EventPageManager</span> <span class="o">=</span> <span class="n">PageManager</span><span class="o">.</span><span class="n">from_queryset</span><span class="p">(</span><span class="n">EventPageQuerySet</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">EventPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">EventPageManager</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-topics/writing_templates"></span><div class="section" id="writing-templates">
<span id="id1"></span><h4>Writing templates<a class="headerlink" href="#writing-templates" title="Permalink to this headline">¶</a></h4>
<p>Wagtail uses Django’s templating language. For developers new to Django, start with Django’s own template documentation:
<a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/templates/" title="(in Django v3.2)"><span>Templates</span></a></p>
<p>Python programmers new to Django/Wagtail may prefer more technical documentation:
<a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/templates/api/" title="(in Django v3.2)"><span>The Django template language: for Python programmers</span></a></p>
<p>You should be familiar with Django templating basics before continuing with this documentation.</p>
<div class="section" id="templates">
<h5>Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h5>
<p>Every type of page or “content type” in Wagtail is defined as a “model” in a file called <code class="docutils literal notranslate"><span class="pre">models.py</span></code>. If your site has a blog, you might have a <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code>  model and another called <code class="docutils literal notranslate"><span class="pre">BlogPageListing</span></code>. The names of the models are up to the Django developer.</p>
<p>For each page model in <code class="docutils literal notranslate"><span class="pre">models.py</span></code>, Wagtail assumes an HTML template file exists of (almost) the same name. The Front End developer may need to create these templates themselves by referring to <code class="docutils literal notranslate"><span class="pre">models.py</span></code> to infer template names from the models defined therein.</p>
<p>To find a suitable template, Wagtail converts CamelCase names to snake_case. So for a <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code>, a template <code class="docutils literal notranslate"><span class="pre">blog_page.html</span></code> will be expected. The name of the template file can be overridden per model if necessary.</p>
<p>Template files are assumed to exist here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name_of_project</span><span class="o">/</span>
    <span class="n">name_of_app</span><span class="o">/</span>
        <span class="n">templates</span><span class="o">/</span>
            <span class="n">name_of_app</span><span class="o">/</span>
                <span class="n">blog_page</span><span class="o">.</span><span class="n">html</span>
        <span class="n">models</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>For more information, see the Django documentation for the <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/templates/api/" title="(in Django v3.2)"><span class="xref std std-doc">application directories template loader</span></a>.</p>
<div class="section" id="page-content">
<h6>Page content<a class="headerlink" href="#page-content" title="Permalink to this headline">¶</a></h6>
<p>The data/content entered into each page is accessed/output through Django’s <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">double-brace</span> <span class="pre">}}</span></code> notation. Each field from the model must be accessed by prefixing <code class="docutils literal notranslate"><span class="pre">page.</span></code>. e.g the page title <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">page.title</span> <span class="pre">}}</span></code> or another field <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">page.author</span> <span class="pre">}}</span></code>.</p>
<p>A custom variable name can be <a class="reference internal" href="index.html#wagtail.core.models.Page.context_object_name" title="wagtail.core.models.Page.context_object_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">configured</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">page</span> <span class="pre">model</span></code></a>. If a custom name is defined, <code class="docutils literal notranslate"><span class="pre">page</span></code> is still available for use in shared templates.</p>
<p>Additionally <code class="docutils literal notranslate"><span class="pre">request.</span></code> is available and contains Django’s request object.</p>
</div>
</div>
<div class="section" id="static-assets">
<h5>Static assets<a class="headerlink" href="#static-assets" title="Permalink to this headline">¶</a></h5>
<p>Static files e.g CSS, JS and images are typically stored here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name_of_project</span><span class="o">/</span>
    <span class="n">name_of_app</span><span class="o">/</span>
        <span class="n">static</span><span class="o">/</span>
            <span class="n">name_of_app</span><span class="o">/</span>
                <span class="n">css</span><span class="o">/</span>
                <span class="n">js</span><span class="o">/</span>
                <span class="n">images</span><span class="o">/</span>
        <span class="n">models</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>(The names “css”, “js” etc aren’t important, only their position within the tree.)</p>
<p>Any file within the static folder should be inserted into your HTML using the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">static</span> <span class="pre">%}</span></code> tag. More about it: <a class="reference internal" href="#static-tag"><span class="std std-ref">Static files (tag)</span></a>.</p>
<div class="section" id="user-images">
<h6>User images<a class="headerlink" href="#user-images" title="Permalink to this headline">¶</a></h6>
<p>Images uploaded to a Wagtail site by its users (as opposed to a developer’s static files, mentioned above) go into the image library and from there are added to pages via the <a class="reference internal" href="index.html#document-editor_manual/new_pages/inserting_images"><span class="doc">page editor interface</span></a>.</p>
<p>Unlike other CMSs, adding images to a page does not involve choosing a “version” of the image to use. Wagtail has no predefined image “formats” or “sizes”. Instead the template developer defines image manipulation to occur <em>on the fly</em> when the image is requested, via a special syntax within the template.</p>
<p>Images from the library must be requested using this syntax, but a developer’s static images can be added via conventional means e.g <code class="docutils literal notranslate"><span class="pre">img</span></code> tags. Only images from the library can be manipulated on the fly.</p>
<p>Read more about the image manipulation syntax here <a class="reference internal" href="index.html#image-tag"><span class="std std-ref">How to use images in templates</span></a>.</p>
</div>
</div>
<div class="section" id="template-tags-filters">
<span id="template-tags-and-filters"></span><h5>Template tags &amp; filters<a class="headerlink" href="#template-tags-filters" title="Permalink to this headline">¶</a></h5>
<p>In addition to Django’s standard tags and filters, Wagtail provides some of its own, which can be <code class="docutils literal notranslate"><span class="pre">load</span></code>-ed <a class="reference external" href="https://docs.djangoproject.com/en/stable/howto/custom-template-tags/" title="(in Django v3.2)"><span class="xref std std-doc">just like any other</span></a>.</p>
<div class="section" id="images-tag">
<h6>Images (tag)<a class="headerlink" href="#images-tag" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">image</span></code> tag inserts an XHTML-compatible <code class="docutils literal notranslate"><span class="pre">img</span></code> element into the page, setting its <code class="docutils literal notranslate"><span class="pre">src</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">height</span></code> and <code class="docutils literal notranslate"><span class="pre">alt</span></code>. See also <a class="reference internal" href="index.html#image-tag-alt"><span class="std std-ref">More control over the img tag</span></a>.</p>
<p>The syntax for the <code class="docutils literal notranslate"><span class="pre">image</span></code> tag is thus:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="o">[</span><span class="nv">image</span><span class="o">]</span> <span class="o">[</span><span class="nv">resize-rule</span><span class="o">]</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailimages_tags</span> <span class="cp">%}</span>
...

<span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">width-400</span> <span class="cp">%}</span>

<span class="c">&lt;!-- or a square thumbnail: --&gt;</span>
<span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">fill-80x80</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#image-tag"><span class="std std-ref">How to use images in templates</span></a> for full documentation.</p>
</div>
<div class="section" id="rich-text-filter">
<span id="id2"></span><h6>Rich text (filter)<a class="headerlink" href="#rich-text-filter" title="Permalink to this headline">¶</a></h6>
<p>This filter takes a chunk of HTML content and renders it as safe HTML in the page. Importantly, it also expands internal shorthand references to embedded images, and links made in the Wagtail editor, into fully-baked HTML ready for display.</p>
<p>Only fields using <code class="docutils literal notranslate"><span class="pre">RichTextField</span></code> need this applied in the template.</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>
...
<span class="cp">{{</span> <span class="nv">page.body</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="section" id="responsive-embeds">
<span id="id3"></span><h7>Responsive Embeds<a class="headerlink" href="#responsive-embeds" title="Permalink to this headline">¶</a></h7>
<p>As Wagtail does not impose any styling of its own on templates, images and embedded media will be displayed at a fixed width as determined by the HTML. Images can be made to resize to fit their container using a CSS rule such as the following:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">body</span> <span class="nt">img</span> <span class="p">{</span>
    <span class="k">max-width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">body</span></code> is a container element in your template surrounding the images.</p>
<p>Making embedded media resizable is also possible, but typically requires custom style rules matching the media’s aspect ratio. To assist in this, Wagtail provides built-in support for responsive embeds, which can be enabled by setting <code class="docutils literal notranslate"><span class="pre">WAGTAILEMBEDS_RESPONSIVE_HTML</span> <span class="pre">=</span> <span class="pre">True</span></code> in your project settings. This adds a CSS class of <code class="docutils literal notranslate"><span class="pre">responsive-object</span></code> and an inline <code class="docutils literal notranslate"><span class="pre">padding-bottom</span></code> style to the embed, to be used in conjunction with the following CSS:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">responsive-object</span> <span class="p">{</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">responsive-object</span> <span class="nt">iframe</span><span class="o">,</span>
<span class="p">.</span><span class="nc">responsive-object</span> <span class="nt">object</span><span class="o">,</span>
<span class="p">.</span><span class="nc">responsive-object</span> <span class="nt">embed</span> <span class="p">{</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="internal-links-tag">
<h6>Internal links (tag)<a class="headerlink" href="#internal-links-tag" title="Permalink to this headline">¶</a></h6>
<div class="section" id="pageurl">
<span id="pageurl-tag"></span><h7><code class="docutils literal notranslate"><span class="pre">pageurl</span></code><a class="headerlink" href="#pageurl" title="Permalink to this headline">¶</a></h7>
<p>Takes a Page object and returns a relative URL (<code class="docutils literal notranslate"><span class="pre">/foo/bar/</span></code>) if within the same Site as the current page, or absolute (<code class="docutils literal notranslate"><span class="pre">http://example.com/foo/bar/</span></code>) if not.</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>
...
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">page.get_parent</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>Back to index<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">fallback</span></code> keyword argument can be provided - this can be a URL string, a named URL route that can be resolved with no parameters, or an object with a <code class="docutils literal notranslate"><span class="pre">get_absolute_url</span></code> method, and will be used as a substitute URL when the passed page is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">for</span> <span class="nv">publication</span> <span class="k">in</span> <span class="nv">page.related_publications.all</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">publication.detail_page</span> <span class="nv">fallback</span><span class="o">=</span><span class="s1">&#39;coming_soon&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>
            <span class="cp">{{</span> <span class="nv">publication.title</span> <span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="slugurl">
<span id="slugurl-tag"></span><h7><code class="docutils literal notranslate"><span class="pre">slugurl</span></code><a class="headerlink" href="#slugurl" title="Permalink to this headline">¶</a></h7>
<p>Takes any <code class="docutils literal notranslate"><span class="pre">slug</span></code> as defined in a page’s “Promote” tab and returns the URL for the matching Page. If multiple pages exist with the same slug, the page chosen is undetermined.</p>
<p>Like <code class="docutils literal notranslate"><span class="pre">pageurl</span></code>, this will try to provide a relative link if possible, but will default to an absolute link if the Page is on a different Site. This is most useful when creating shared page furniture, e.g. top level navigation or site-wide links.</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>
...
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">slugurl</span> <span class="s1">&#39;news&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>News index<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="static-files-tag">
<span id="static-tag"></span><h6>Static files (tag)<a class="headerlink" href="#static-files-tag" title="Permalink to this headline">¶</a></h6>
<p>Used to load anything from your static files directory. Use of this tag avoids rewriting all static paths if hosting arrangements change, as they might between development and live environments.</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>
...
<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s2">&quot;name_of_app/myimage.jpg&quot;</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;My image&quot;</span><span class="p">/&gt;</span>
</pre></div>
</div>
<p>Notice that the full path name is not required and the path snippet you enter only need begin with the parent app’s directory name.</p>
</div>
<div class="section" id="multi-site-support">
<h6>Multi-site support<a class="headerlink" href="#multi-site-support" title="Permalink to this headline">¶</a></h6>
<div class="section" id="wagtail-site">
<span id="wagtail-site-tag"></span><h7><code class="docutils literal notranslate"><span class="pre">wagtail_site</span></code><a class="headerlink" href="#wagtail-site" title="Permalink to this headline">¶</a></h7>
<p>Returns the Site object corresponding to the current request.</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">wagtail_site</span> <span class="k">as</span> <span class="nv">current_site</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="wagtail-user-bar">
<span id="wagtailuserbar-tag"></span><h5>Wagtail User Bar<a class="headerlink" href="#wagtail-user-bar" title="Permalink to this headline">¶</a></h5>
<p>This tag provides a contextual flyout menu for logged-in users. The menu gives editors the ability to edit the current page or add a child page, besides the options to show the page in the Wagtail page explorer or jump to the Wagtail admin dashboard. Moderators are also given the ability to accept or reject a page being previewed as part of content moderation.</p>
<p>This tag may be used on standard Django views, without page object. The user bar will contain one item pointing to the admin.</p>
<p>We recommend putting the tag near the top of the <code class="docutils literal notranslate"><span class="pre">&lt;body&gt;</span></code> element so keyboard users can reach it. You should consider putting the tag after any <a class="reference external" href="https://webaim.org/techniques/skipnav/">skip links</a> but before the navigation and main content of your page.</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailuserbar</span> <span class="cp">%}</span>
...
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;#content&quot;</span><span class="p">&gt;</span>Skip to content<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">wagtailuserbar</span> <span class="cp">%}</span> <span class="c">{# This is a good place for the userbar #}</span>
  <span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
  ...
  <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">main</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
  ...
  <span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>By default the User Bar appears in the bottom right of the browser window, inset from the edge. If this conflicts with your design it can be moved by passing a parameter to the template tag. These examples show you how to position the userbar in each corner of the screen:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span>...
<span class="cp">{%</span> <span class="k">wagtailuserbar</span> <span class="s1">&#39;top-left&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">wagtailuserbar</span> <span class="s1">&#39;top-right&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">wagtailuserbar</span> <span class="s1">&#39;bottom-left&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">wagtailuserbar</span> <span class="s1">&#39;bottom-right&#39;</span> <span class="cp">%}</span>
...
</pre></div>
</div>
<p>The userbar can be positioned where it works best with your design. Alternatively, you can position it with a CSS rule in your own CSS files, for example:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">wagtail-userbar</span> <span class="p">{</span>
     <span class="k">top</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span> <span class="cp">!important</span><span class="p">;</span>
     <span class="k">left</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="varying-output-between-preview-and-live">
<h5>Varying output between preview and live<a class="headerlink" href="#varying-output-between-preview-and-live" title="Permalink to this headline">¶</a></h5>
<p>Sometimes you may wish to vary the template output depending on whether the page is being previewed or viewed live. For example, if you have visitor tracking code such as Google Analytics in place on your site, it’s a good idea to leave this out when previewing, so that editor activity doesn’t appear in your analytics reports. Wagtail provides a <code class="docutils literal notranslate"><span class="pre">request.is_preview</span></code> variable to distinguish between preview and live:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="k">not</span> <span class="nv">request.is_preview</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">o</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">m</span><span class="p">){</span><span class="nx">i</span><span class="p">[</span><span class="s1">&#39;GoogleAnalyticsObject&#39;</span><span class="p">]</span><span class="o">=</span><span class="nx">r</span><span class="p">;</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">=</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">||</span><span class="kd">function</span><span class="p">(){</span>
      <span class="p">...</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-topics/images"></span><div class="section" id="how-to-use-images-in-templates">
<span id="image-tag"></span><h4>How to use images in templates<a class="headerlink" href="#how-to-use-images-in-templates" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">image</span></code> tag inserts an XHTML-compatible <code class="docutils literal notranslate"><span class="pre">img</span></code> element into the page, setting its <code class="docutils literal notranslate"><span class="pre">src</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">height</span></code> and <code class="docutils literal notranslate"><span class="pre">alt</span></code>. See also <a class="reference internal" href="#image-tag-alt"><span class="std std-ref">More control over the img tag</span></a>.</p>
<p>The syntax for the tag is thus:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="o">[</span><span class="nv">image</span><span class="o">]</span> <span class="o">[</span><span class="nv">resize-rule</span><span class="o">]</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><strong>Both the image and resize rule must be passed to the template tag.</strong></p>
<p>For example:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailimages_tags</span> <span class="cp">%}</span>
...

<span class="c">&lt;!-- Display the image scaled to a width of 400 pixels: --&gt;</span>
<span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">width-400</span> <span class="cp">%}</span>

<span class="c">&lt;!-- Display it again, but this time as a square thumbnail: --&gt;</span>
<span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">fill-80x80</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>In the above syntax example <code class="docutils literal notranslate"><span class="pre">[image]</span></code> is the Django object referring to the image. If your page model defined a field called “photo” then <code class="docutils literal notranslate"><span class="pre">[image]</span></code> would probably be <code class="docutils literal notranslate"><span class="pre">page.photo</span></code>. The <code class="docutils literal notranslate"><span class="pre">[resize-rule]</span></code> defines how the image is to be resized when inserted into the page. Various resizing methods are supported, to cater to different use cases (e.g. lead images that span the whole width of the page, or thumbnails to be cropped to a fixed size).</p>
<p>Note that a space separates <code class="docutils literal notranslate"><span class="pre">[image]</span></code> and <code class="docutils literal notranslate"><span class="pre">[resize-rule]</span></code>, but the resize rule must not contain spaces. The width is always specified before the height. Resized images will maintain their original aspect ratio unless the <code class="docutils literal notranslate"><span class="pre">fill</span></code> rule is used, which may result in some pixels being cropped.</p>
<p>The available resizing methods are as follows:</p>
<dl class="glossary docutils">
<dt id="term-max"><code class="docutils literal notranslate"><span class="pre">max</span></code></dt>
<dd><p class="first">(takes two dimensions)</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">max-1000x500</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Fit <strong>within</strong> the given dimensions.</p>
<p>The longest edge will be reduced to the matching dimension specified. For example, a portrait image of width 1000 and height 2000, treated with the <code class="docutils literal notranslate"><span class="pre">max-1000x500</span></code> rule (a landscape layout) would result in the image being shrunk so the <em>height</em> was 500 pixels and the width was 250.</p>
<div class="last figure" id="id3">
<img alt="Example of max filter on an image." src="_images/image_filter_max.png" />
<p class="caption"><span class="caption-text">Example: The image will keep its proportions but fit within the max (green line) dimensions provided.</span></p>
</div>
</dd>
<dt id="term-min"><code class="docutils literal notranslate"><span class="pre">min</span></code></dt>
<dd><p class="first">(takes two dimensions)</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">min-500x200</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><strong>Cover</strong> the given dimensions.</p>
<p>This may result in an image slightly <strong>larger</strong> than the dimensions you specify. A square image of width 2000 and height 2000, treated with the <code class="docutils literal notranslate"><span class="pre">min-500x200</span></code> rule would have its height and width changed to 500, i.e matching the <em>width</em> of the resize-rule, but greater than the height.</p>
<div class="last figure" id="id4">
<img alt="Example of min filter on an image." src="_images/image_filter_min.png" />
<p class="caption"><span class="caption-text">Example: The image will keep its proportions while filling at least the min (green line) dimensions provided.</span></p>
</div>
</dd>
<dt id="term-width"><code class="docutils literal notranslate"><span class="pre">width</span></code></dt>
<dd><p class="first">(takes one dimension)</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">width-640</span> <span class="cp">%}</span>
</pre></div>
</div>
<p class="last">Reduces the width of the image to the dimension specified.</p>
</dd>
<dt id="term-height"><code class="docutils literal notranslate"><span class="pre">height</span></code></dt>
<dd><p class="first">(takes one dimension)</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">height-480</span> <span class="cp">%}</span>
</pre></div>
</div>
<p class="last">Reduces the height of the image to the dimension specified.</p>
</dd>
<dt id="term-scale"><code class="docutils literal notranslate"><span class="pre">scale</span></code></dt>
<dd><p class="first">(takes percentage)</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">scale-50</span> <span class="cp">%}</span>
</pre></div>
</div>
<p class="last">Resize the image to the percentage specified.</p>
</dd>
<dt id="term-fill"><code class="docutils literal notranslate"><span class="pre">fill</span></code></dt>
<dd><p class="first">(takes two dimensions and an optional <code class="docutils literal notranslate"><span class="pre">-c</span></code> parameter)</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">fill-200x200</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Resize and <strong>crop</strong> to fill the <strong>exact</strong> dimensions specified.</p>
<p>This can be particularly useful for websites requiring square thumbnails of arbitrary images. For example, a landscape image of width 2000 and height 1000 treated with the <code class="docutils literal notranslate"><span class="pre">fill-200x200</span></code> rule would have its height reduced to 200, then its width (ordinarily 400) cropped to 200.</p>
<p>This resize-rule will crop to the image’s focal point if it has been set. If not, it will crop to the centre of the image.</p>
<div class="figure" id="id5">
<img alt="Example of fill filter on an image." src="_images/image_filter_fill.png" />
<p class="caption"><span class="caption-text">Example: The image is scaled and also cropped (red line) to fit as much of the image as possible within the provided dimensions.</span></p>
</div>
<p><strong>On images that won’t upscale</strong></p>
<p>It’s possible to request an image with <code class="docutils literal notranslate"><span class="pre">fill</span></code> dimensions that the image can’t support without upscaling. e.g. an image of width 400 and height 200 requested with <code class="docutils literal notranslate"><span class="pre">fill-400x400</span></code>. In this situation the <em>ratio of the requested fill</em> will be matched, but the dimension will not. So that example 400x200 image (a 2:1 ratio) could become 200x200 (a 1:1 ratio, matching the resize-rule).</p>
<p><strong>Cropping closer to the focal point</strong></p>
<p>By default, Wagtail will only crop enough to change the aspect ratio of the image to match the ratio in the resize-rule.</p>
<p>In some cases (e.g. thumbnails), it may be preferable to crop closer to the focal point, so that the subject of the image is more prominent.</p>
<p>You can do this by appending <code class="docutils literal notranslate"><span class="pre">-c&lt;percentage&gt;</span></code> at the end of the resize-rule. For example, if you would like the image to be cropped as closely as possible to its focal point, add <code class="docutils literal notranslate"><span class="pre">-c100</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">fill-200x200-c100</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>This will crop the image as much as it can, without cropping into the focal point.</p>
<p>If you find that <code class="docutils literal notranslate"><span class="pre">-c100</span></code> is too close, you can try <code class="docutils literal notranslate"><span class="pre">-c75</span></code> or <code class="docutils literal notranslate"><span class="pre">-c50</span></code>. Any whole number from 0 to 100 is accepted.</p>
<div class="figure" id="id6">
<img alt="Example of fill filter on an image with a focal point set." src="_images/image_filter_fill_focal.png" />
<p class="caption"><span class="caption-text">Example: The focal point is set off centre so the image is scaled and also cropped like fill, however the center point of the crop is positioned closer the focal point.</span></p>
</div>
<div class="last figure" id="id7">
<img alt="Example of fill and closeness filter on an image with a focal point set." src="_images/image_filter_fill_focal_close.png" />
<p class="caption"><span class="caption-text">Example: With <code class="docutils literal notranslate"><span class="pre">-c75</span></code> set, the final crop will be closer to the focal point.</span></p>
</div>
</dd>
<dt id="term-original"><code class="docutils literal notranslate"><span class="pre">original</span></code></dt>
<dd><p class="first">(takes no dimensions)</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">original</span> <span class="cp">%}</span>
</pre></div>
</div>
<p class="last">Renders the image at its original size.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Wagtail does not allow deforming or stretching images. Image dimension ratios will always be kept. Wagtail also <em>does not support upscaling</em>. Small images forced to appear at larger sizes will “max out” at their native dimensions.</p>
</div>
<div class="section" id="more-control-over-the-img-tag">
<span id="image-tag-alt"></span><h5>More control over the <code class="docutils literal notranslate"><span class="pre">img</span></code> tag<a class="headerlink" href="#more-control-over-the-img-tag" title="Permalink to this headline">¶</a></h5>
<p>Wagtail provides two shortcuts to give greater control over the <code class="docutils literal notranslate"><span class="pre">img</span></code> element:</p>
<p><strong>1. Adding attributes to the  {% image %} tag</strong></p>
<p>Extra attributes can be specified with the syntax <code class="docutils literal notranslate"><span class="pre">attribute=&quot;value&quot;</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">width-400</span> <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span> <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>You can set a more relevant <cite>alt</cite> attribute this way, overriding the one automatically generated from the title of the image. The <cite>src</cite>, <cite>width</cite>, and <cite>height</cite> attributes can also be overridden, if necessary.</p>
<p><strong>2. Generating the image “as foo” to access individual properties</strong></p>
<p>Wagtail can assign the image data to another variable using Django’s <code class="docutils literal notranslate"><span class="pre">as</span></code> syntax:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">width-400</span> <span class="k">as</span> <span class="nv">tmp_photo</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">tmp_photo.url</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">tmp_photo.width</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="na">height</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">tmp_photo.height</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">tmp_photo.alt</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;my-custom-class&quot;</span> <span class="p">/&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The image property used for the <code class="docutils literal notranslate"><span class="pre">src</span></code> attribute is <code class="docutils literal notranslate"><span class="pre">image.url</span></code>, not <code class="docutils literal notranslate"><span class="pre">image.src</span></code>.</p>
</div>
<p>This syntax exposes the underlying image Rendition (<code class="docutils literal notranslate"><span class="pre">tmp_photo</span></code>) to the developer. A “Rendition” contains the information specific to the way you’ve requested to format the image using the resize-rule, i.e. dimensions and source URL. The following properties are available:</p>
<dl class="attribute">
<dt id="url">
<code class="descname">url</code><a class="headerlink" href="#url" title="Permalink to this definition">¶</a></dt>
<dd><p>URL to the resized version of the image. This may be a local URL (such as <code class="docutils literal notranslate"><span class="pre">/static/images/example.jpg</span></code>) or a full URL (such as <code class="docutils literal notranslate"><span class="pre">https://assets.example.com/images/example.jpg</span></code>), depending on how static files are configured.</p>
</dd></dl>

<dl class="attribute">
<dt id="width">
<code class="descname">width</code><a class="headerlink" href="#width" title="Permalink to this definition">¶</a></dt>
<dd><p>Image width after resizing.</p>
</dd></dl>

<dl class="attribute">
<dt id="height">
<code class="descname">height</code><a class="headerlink" href="#height" title="Permalink to this definition">¶</a></dt>
<dd><p>Image height after resizing.</p>
</dd></dl>

<dl class="attribute">
<dt id="alt">
<code class="descname">alt</code><a class="headerlink" href="#alt" title="Permalink to this definition">¶</a></dt>
<dd><p>Alternative text for the image, typically taken from the image title.</p>
</dd></dl>

<dl class="attribute">
<dt id="attrs">
<code class="descname">attrs</code><a class="headerlink" href="#attrs" title="Permalink to this definition">¶</a></dt>
<dd><p>A shorthand for outputting the attributes <code class="docutils literal notranslate"><span class="pre">src</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">height</span></code> and <code class="docutils literal notranslate"><span class="pre">alt</span></code> in one go:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="cp">{{</span> <span class="nv">tmp_photo.attrs</span> <span class="cp">}}</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;my-custom-class&quot;</span> <span class="p">/&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="full_url">
<code class="descname">full_url</code><a class="headerlink" href="#full_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as <code class="docutils literal notranslate"><span class="pre">url</span></code>, but always returns a full absolute URL. This requires <code class="docutils literal notranslate"><span class="pre">BASE_URL</span></code> to be set in the project settings.</p>
<p>This is useful for images that will be re-used outside of the current site, such as social share images:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;twitter:image&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">tmp_photo.full_url</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
</dd></dl>

<p>If your site defines a custom image model using <code class="docutils literal notranslate"><span class="pre">AbstractImage</span></code>, any additional fields you add to an image (e.g. a copyright holder) are <strong>not</strong> included in the rendition.</p>
<p>Therefore, if you’d added the field <code class="docutils literal notranslate"><span class="pre">author</span></code> to your AbstractImage in the above example, you’d access it using <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">page.photo.author</span> <span class="pre">}}</span></code> rather than <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">tmp_photo.author</span> <span class="pre">}}</span></code>.</p>
<p>(Due to the links in the database between renditions and their parent image, you <em>could</em> access it as <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">tmp_photo.image.author</span> <span class="pre">}}</span></code>, but that has reduced readability.)</p>
</div>
<div class="section" id="the-attrs-shortcut">
<h5>The <code class="docutils literal notranslate"><span class="pre">attrs</span></code> shortcut<a class="headerlink" href="#the-attrs-shortcut" title="Permalink to this headline">¶</a></h5>
<p>You can also use the <code class="docutils literal notranslate"><span class="pre">attrs</span></code> property as a shorthand to output the attributes <code class="docutils literal notranslate"><span class="pre">src</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">height</span></code> and <code class="docutils literal notranslate"><span class="pre">alt</span></code> in one go:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="cp">{{</span> <span class="nv">tmp_photo.attrs</span> <span class="cp">}}</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;my-custom-class&quot;</span> <span class="p">/&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="alternative-html-tags">
<h5>Alternative HTML tags<a class="headerlink" href="#alternative-html-tags" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">as</span></code> keyword allows alternative HTML image tags (such as <code class="docutils literal notranslate"><span class="pre">&lt;picture&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;amp-img&gt;</span></code>) to be used.
For example, to use the <code class="docutils literal notranslate"><span class="pre">&lt;picture&gt;</span></code> tag:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">picture</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">width-800</span> <span class="k">as</span> <span class="nv">wide_photo</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">source</span> <span class="na">srcset</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">wide_photo.url</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">media</span><span class="o">=</span><span class="s">&quot;(min-width: 800px)&quot;</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">width-400</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">picture</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>And to use the <code class="docutils literal notranslate"><span class="pre">&lt;amp-img&gt;</span></code> tag (based on the <a class="reference external" href="https://amp.dev/documentation/components/amp-img/#example:-specifying-a-fallback-image">Mountains example</a> from the AMP docs):</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">image</span> <span class="nv">width-550</span> <span class="nv">format-webp</span> <span class="k">as</span> <span class="nv">webp_image</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">image</span> <span class="nv">image</span> <span class="nv">width-550</span> <span class="nv">format-jpeg</span> <span class="k">as</span> <span class="nv">jpeg_image</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">amp-img</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">image.alt</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="na">width</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">webp_image.width</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="na">height</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">webp_image.height</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">webp_image.url</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">amp-img</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">image.alt</span> <span class="cp">}}</span><span class="s">&quot;</span>
        <span class="na">fallback</span>
        <span class="na">width</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">jpeg_image.width</span> <span class="cp">}}</span><span class="s">&quot;</span>
        <span class="na">height</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">jpeg_image.height</span> <span class="cp">}}</span><span class="s">&quot;</span>
        <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">jpeg_image.url</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">amp-img</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">amp-img</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="images-embedded-in-rich-text">
<h5>Images embedded in rich text<a class="headerlink" href="#images-embedded-in-rich-text" title="Permalink to this headline">¶</a></h5>
<p>The information above relates to images defined via image-specific fields in your model. However, images can also be embedded arbitrarily in Rich Text fields by the page editor (see <a class="reference internal" href="index.html#rich-text"><span class="std std-ref">Rich Text (HTML)</span></a>).</p>
<p>Images embedded in Rich Text fields can’t be controlled by the template developer as easily. There are no image objects to work with, so the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> template tag can’t be used. Instead, editors can choose from one of a number of image “Formats” at the point of inserting images into their text.</p>
<p>Wagtail comes with three pre-defined image formats, but more can be defined in Python by the developer. These formats are:</p>
<dl class="glossary docutils">
<dt id="term-full-width"><code class="docutils literal notranslate"><span class="pre">Full</span> <span class="pre">width</span></code></dt>
<dd>Creates an image rendition using <code class="docutils literal notranslate"><span class="pre">width-800</span></code>, giving the &lt;img&gt; tag the CSS class <code class="docutils literal notranslate"><span class="pre">full-width</span></code>.</dd>
<dt id="term-left-aligned"><code class="docutils literal notranslate"><span class="pre">Left-aligned</span></code></dt>
<dd>Creates an image rendition using <code class="docutils literal notranslate"><span class="pre">width-500</span></code>, giving the &lt;img&gt; tag the CSS class <code class="docutils literal notranslate"><span class="pre">left</span></code>.</dd>
<dt id="term-right-aligned"><code class="docutils literal notranslate"><span class="pre">Right-aligned</span></code></dt>
<dd>Creates an image rendition using <code class="docutils literal notranslate"><span class="pre">width-500</span></code>, giving the &lt;img&gt; tag the CSS class <code class="docutils literal notranslate"><span class="pre">right</span></code>.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The CSS classes added to images do <strong>not</strong> come with any accompanying stylesheets, or inline styles. e.g. the <code class="docutils literal notranslate"><span class="pre">left</span></code> class will do nothing, by default. The developer is expected to add these classes to their front end CSS files, to define exactly what they want <code class="docutils literal notranslate"><span class="pre">left</span></code>, <code class="docutils literal notranslate"><span class="pre">right</span></code> or <code class="docutils literal notranslate"><span class="pre">full-width</span></code> to mean.</p>
</div>
<p>For more information about image formats, including creating your own, see <a class="reference internal" href="index.html#rich-text-image-formats"><span class="std std-ref">Image Formats in the Rich Text Editor</span></a></p>
</div>
<div class="section" id="output-image-format">
<span id="id1"></span><h5>Output image format<a class="headerlink" href="#output-image-format" title="Permalink to this headline">¶</a></h5>
<p>Wagtail may automatically change the format of some images when they are resized:</p>
<blockquote>
<div><ul class="simple">
<li>PNG and JPEG images don’t change format</li>
<li>GIF images without animation are converted to PNGs</li>
<li>BMP images are converted to PNGs</li>
<li>WebP images are converted to PNGs</li>
</ul>
</div></blockquote>
<p>It is also possible to override the output format on a per-tag basis by using the
<code class="docutils literal notranslate"><span class="pre">format</span></code> filter after the resize rule.</p>
<p>For example, to make the tag always convert the image to a JPEG, use <code class="docutils literal notranslate"><span class="pre">format-jpeg</span></code>:</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">width-400</span> <span class="nv">format-jpeg</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>You may also use <code class="docutils literal notranslate"><span class="pre">format-png</span></code> or <code class="docutils literal notranslate"><span class="pre">format-gif</span></code>.</p>
<div class="section" id="lossless-webp">
<h6>Lossless WebP<a class="headerlink" href="#lossless-webp" title="Permalink to this headline">¶</a></h6>
<p>You can encode the image into lossless WebP format by using the <code class="docutils literal notranslate"><span class="pre">format-webp-lossless</span></code> filter:</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">width-400</span> <span class="nv">format-webp-lossless</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="background-color">
<span id="image-background-color"></span><h5>Background color<a class="headerlink" href="#background-color" title="Permalink to this headline">¶</a></h5>
<p>The PNG and GIF image formats both support transparency, but if you want to
convert images to JPEG format, the transparency will need to be replaced with a
solid background color.</p>
<p>By default, Wagtail will set the background to white. But if a white background
doesn’t fit your design, you can specify a color using the <code class="docutils literal notranslate"><span class="pre">bgcolor</span></code> filter.</p>
<p>This filter takes a single argument, which is a CSS 3 or 6 digit hex code
representing the color you would like to use:</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="c">{# Sets the image background to black #}</span>
<span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">width-400</span> <span class="nv">bgcolor-000</span> <span class="nv">format-jpeg</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="image-quality">
<span id="id2"></span><h5>Image quality<a class="headerlink" href="#image-quality" title="Permalink to this headline">¶</a></h5>
<p>Wagtail’s JPEG and WebP image quality settings default to 85 (which is quite high).
This can be changed either globally or on a per-tag basis.</p>
<div class="section" id="changing-globally">
<h6>Changing globally<a class="headerlink" href="#changing-globally" title="Permalink to this headline">¶</a></h6>
<p>Use the <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_JPEG_QUALITY</span></code> and <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_WEBP_QUALITY</span></code> settings
to change the global defaults of JPEG and WebP quality:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># settings.py</span>

<span class="c1"># Make low-quality but small images</span>
<span class="n">WAGTAILIMAGES_JPEG_QUALITY</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">WAGTAILIMAGES_WEBP_QUALITY</span> <span class="o">=</span> <span class="mi">45</span>
</pre></div>
</div>
<p>Note that this won’t affect any previously generated images so you may want to
delete all renditions so they can regenerate with the new setting. This can be
done from the Django shell:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace this with your custom rendition model if you use one</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">wagtail.images.models</span> <span class="kn">import</span> <span class="n">Rendition</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Rendition</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="changing-per-tag">
<h6>Changing per-tag<a class="headerlink" href="#changing-per-tag" title="Permalink to this headline">¶</a></h6>
<p>It’s also possible to have different JPEG and WebP qualities on individual tags
by using <code class="docutils literal notranslate"><span class="pre">jpegquality</span></code> and <code class="docutils literal notranslate"><span class="pre">webpquality</span></code> filters. This will always override
the default setting:</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo_jpeg</span> <span class="nv">width-400</span> <span class="nv">jpegquality-40</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo_webp</span> <span class="nv">width-400</span> <span class="nv">webpquality-50</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Note that this will have no effect on PNG or GIF files. If you want all images
to be low quality, you can use this filter with <code class="docutils literal notranslate"><span class="pre">format-jpeg</span></code> or <code class="docutils literal notranslate"><span class="pre">format-webp</span></code>
(which forces all images to output in JPEG or WebP format):</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">width-400</span> <span class="nv">format-jpeg</span> <span class="nv">jpegquality-40</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">width-400</span> <span class="nv">format-webp</span> <span class="nv">webpquality-50</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="generating-image-renditions-in-python">
<h6>Generating image renditions in Python<a class="headerlink" href="#generating-image-renditions-in-python" title="Permalink to this headline">¶</a></h6>
<p>All of the image transformations mentioned above can also be used directly in Python code.
See <a class="reference internal" href="index.html#image-renditions"><span class="std std-ref">Generating renditions in Python</span></a>.</p>
</div>
</div>
</div>
<span id="document-topics/search/index"></span><div class="section" id="search">
<span id="wagtailsearch"></span><h4>Search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h4>
<p>Wagtail provides a comprehensive and extensible search interface. In addition, it provides ways to promote search results through “Editor’s Picks”. Wagtail also collects simple statistics on queries made through the search interface.</p>
<div class="toctree-wrapper compound">
<span id="document-topics/search/indexing"></span><div class="section" id="indexing">
<span id="wagtailsearch-indexing"></span><h5>Indexing<a class="headerlink" href="#indexing" title="Permalink to this headline">¶</a></h5>
<p>To make a model searchable, you’ll need to add it into the search index. All pages, images and documents are indexed for you, so you can start searching them right away.</p>
<p>If you have created some extra fields in a subclass of Page or Image, you may want to add these new fields to the search index too so that a user’s search query will match on their content. See <a class="reference internal" href="#wagtailsearch-indexing-fields"><span class="std std-ref">Indexing extra fields</span></a> for info on how to do this.</p>
<p>If you have a custom model that you would like to make searchable, see <a class="reference internal" href="#wagtailsearch-indexing-models"><span class="std std-ref">Indexing custom models</span></a>.</p>
<div class="section" id="updating-the-index">
<span id="wagtailsearch-indexing-update"></span><h6>Updating the index<a class="headerlink" href="#updating-the-index" title="Permalink to this headline">¶</a></h6>
<p>If the search index is kept separate from the database (when using Elasticsearch for example), you need to keep them both in sync. There are two ways to do this: using the search signal handlers, or calling the <code class="docutils literal notranslate"><span class="pre">update_index</span></code> command periodically. For best speed and reliability, it’s best to use both if possible.</p>
<div class="section" id="signal-handlers">
<h7>Signal handlers<a class="headerlink" href="#signal-handlers" title="Permalink to this headline">¶</a></h7>
<p><code class="docutils literal notranslate"><span class="pre">wagtailsearch</span></code> provides some signal handlers which bind to the save/delete signals of all indexed models. This would automatically add and delete them from all backends you have registered in <code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_BACKENDS</span></code>. These signal handlers are automatically registered when the <code class="docutils literal notranslate"><span class="pre">wagtail.search</span></code> app is loaded.</p>
<p>In some cases, you may not want your content to be automatically reindexed and instead rely on the <code class="docutils literal notranslate"><span class="pre">update_index</span></code> command for indexing. If you need to disable these signal handlers, use one of the following methods:</p>
<div class="section" id="disabling-auto-update-signal-handlers-for-a-model">
<h8>Disabling auto update signal handlers for a model<a class="headerlink" href="#disabling-auto-update-signal-handlers-for-a-model" title="Permalink to this headline">¶</a></h8>
<p>You can disable the signal handlers for an individual model by adding <code class="docutils literal notranslate"><span class="pre">search_auto_update</span> <span class="pre">=</span> <span class="pre">False</span></code> as an attribute on the model class.</p>
</div>
<div class="section" id="disabling-auto-update-signal-handlers-for-a-search-backend-whole-site">
<h8>Disabling auto update signal handlers for a search backend/whole site<a class="headerlink" href="#disabling-auto-update-signal-handlers-for-a-search-backend-whole-site" title="Permalink to this headline">¶</a></h8>
<p>You can disable the signal handlers for a whole search backend by setting the <code class="docutils literal notranslate"><span class="pre">AUTO_UPDATE</span></code> setting on the backend to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>If all search backends have <code class="docutils literal notranslate"><span class="pre">AUTO_UPDATE</span></code> set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, the signal handlers will be completely disabled for the whole site.</p>
<p>For documentation on the <code class="docutils literal notranslate"><span class="pre">AUTO_UPDATE</span></code> setting, see <a class="reference internal" href="index.html#wagtailsearch-backends-auto-update"><span class="std std-ref">AUTO_UPDATE</span></a>.</p>
</div>
</div>
<div class="section" id="the-update-index-command">
<h7>The <code class="docutils literal notranslate"><span class="pre">update_index</span></code> command<a class="headerlink" href="#the-update-index-command" title="Permalink to this headline">¶</a></h7>
<p>Wagtail also provides a command for rebuilding the index from scratch.</p>
<p><code class="code docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">update_index</span></code></p>
<p>It is recommended to run this command once a week and at the following times:</p>
<ul class="simple">
<li>whenever any pages have been created through a script (after an import, for example)</li>
<li>whenever any changes have been made to models or search configuration</li>
</ul>
<p>The search may not return any results while this command is running, so avoid running it at peak times.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">update_index</span></code> command is also aliased as <code class="docutils literal notranslate"><span class="pre">wagtail_update_index</span></code>, for use when another installed package (such as <a class="reference external" href="https://haystacksearch.org/">Haystack</a>) provides a conflicting <code class="docutils literal notranslate"><span class="pre">update_index</span></code> command. In this case, the other package’s entry in <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> should appear above <code class="docutils literal notranslate"><span class="pre">wagtail.search</span></code> so that its <code class="docutils literal notranslate"><span class="pre">update_index</span></code> command takes precedence over Wagtail’s.</p>
</div>
</div>
</div>
<div class="section" id="indexing-extra-fields">
<span id="wagtailsearch-indexing-fields"></span><h6>Indexing extra fields<a class="headerlink" href="#indexing-extra-fields" title="Permalink to this headline">¶</a></h6>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Indexing extra fields is only supported by the <a class="reference internal" href="index.html#wagtailsearch-backends-elasticsearch"><span class="std std-ref">Elasticsearch Backend</span></a> and <a class="reference internal" href="index.html#wagtailsearch-backends-postgresql"><span class="std std-ref">PostgreSQL Backend</span></a>.  Indexing extra fields is not supported by the <a class="reference internal" href="index.html#wagtailsearch-backends-database"><span class="std std-ref">Database Backend (default)</span></a>. If you’re using the database backend, any other fields you define via <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> will be ignored.</p>
</div>
<p>Fields must be explicitly added to the <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> property of your <code class="docutils literal notranslate"><span class="pre">Page</span></code>-derived model, in order for you to be able to search/filter on them. This is done by overriding <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> to append a list of extra <code class="docutils literal notranslate"><span class="pre">SearchField</span></code>/<code class="docutils literal notranslate"><span class="pre">FilterField</span></code> objects to it.</p>
<div class="section" id="example">
<h7>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h7>
<p>This creates an <code class="docutils literal notranslate"><span class="pre">EventPage</span></code> model with two fields: <code class="docutils literal notranslate"><span class="pre">description</span></code> and <code class="docutils literal notranslate"><span class="pre">date</span></code>. <code class="docutils literal notranslate"><span class="pre">description</span></code> is indexed as a <code class="docutils literal notranslate"><span class="pre">SearchField</span></code> and <code class="docutils literal notranslate"><span class="pre">date</span></code> is indexed as a <code class="docutils literal notranslate"><span class="pre">FilterField</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.search</span> <span class="kn">import</span> <span class="n">index</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="k">class</span> <span class="nc">EventPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">search_fields</span> <span class="o">+</span> <span class="p">[</span> <span class="c1"># Inherit search_fields from Page</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">),</span>
        <span class="n">index</span><span class="o">.</span><span class="n">FilterField</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
    <span class="p">]</span>


<span class="c1"># Get future events which contain the string &quot;Christmas&quot; in the title or description</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">date__gt</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Christmas&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="index-searchfield">
<span id="wagtailsearch-index-searchfield"></span><h7><code class="docutils literal notranslate"><span class="pre">index.SearchField</span></code><a class="headerlink" href="#index-searchfield" title="Permalink to this headline">¶</a></h7>
<p>These are used for performing full-text searches on your models, usually for text fields.</p>
<div class="section" id="options">
<h8>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h8>
<ul class="simple">
<li><strong>partial_match</strong> (<code class="docutils literal notranslate"><span class="pre">boolean</span></code>) - Setting this to true allows results to be matched on parts of words. For example, this is set on the title field by default, so a page titled <code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">World!</span></code> will be found if the user only types <code class="docutils literal notranslate"><span class="pre">Hel</span></code> into the search box.</li>
<li><strong>boost</strong> (<code class="docutils literal notranslate"><span class="pre">int/float</span></code>) - This allows you to set fields as being more important than others. Setting this to a high number on a field will cause pages with matches in that field to be ranked higher. By default, this is set to 2 on the Page title field and 1 on all other fields.</li>
<li><strong>es_extra</strong> (<code class="docutils literal notranslate"><span class="pre">dict</span></code>) - This field is to allow the developer to set or override any setting on the field in the Elasticsearch mapping. Use this if you want to make use of any Elasticsearch features that are not yet supported in Wagtail.</li>
</ul>
</div>
</div>
<div class="section" id="index-filterfield">
<span id="wagtailsearch-index-filterfield"></span><h7><code class="docutils literal notranslate"><span class="pre">index.FilterField</span></code><a class="headerlink" href="#index-filterfield" title="Permalink to this headline">¶</a></h7>
<p>These are added to the search index but are not used for full-text searches. Instead, they allow you to run filters on your search results.</p>
</div>
<div class="section" id="index-relatedfields">
<span id="wagtailsearch-index-relatedfields"></span><h7><code class="docutils literal notranslate"><span class="pre">index.RelatedFields</span></code><a class="headerlink" href="#index-relatedfields" title="Permalink to this headline">¶</a></h7>
<p>This allows you to index fields from related objects. It works on all types of related fields, including their reverse accessors.</p>
<p>For example, if we have a book that has a <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> to its author, we can nest the author’s <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">date_of_birth</span></code> fields inside the book:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.search</span> <span class="kn">import</span> <span class="n">index</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">Indexed</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
        <span class="n">index</span><span class="o">.</span><span class="n">FilterField</span><span class="p">(</span><span class="s1">&#39;published_date&#39;</span><span class="p">),</span>

        <span class="n">index</span><span class="o">.</span><span class="n">RelatedFields</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
            <span class="n">index</span><span class="o">.</span><span class="n">FilterField</span><span class="p">(</span><span class="s1">&#39;date_of_birth&#39;</span><span class="p">),</span>
        <span class="p">]),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>This will allow you to search for books by their author’s name.</p>
<p>It works the other way around as well. You can index an author’s books, allowing an author to be searched for by the titles of books they’ve published:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.search</span> <span class="kn">import</span> <span class="n">index</span>

<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">Indexed</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
        <span class="n">index</span><span class="o">.</span><span class="n">FilterField</span><span class="p">(</span><span class="s1">&#39;date_of_birth&#39;</span><span class="p">),</span>

        <span class="n">index</span><span class="o">.</span><span class="n">RelatedFields</span><span class="p">(</span><span class="s1">&#39;books&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
            <span class="n">index</span><span class="o">.</span><span class="n">FilterField</span><span class="p">(</span><span class="s1">&#39;published_date&#39;</span><span class="p">),</span>
        <span class="p">]),</span>
    <span class="p">]</span>
</pre></div>
</div>
<div class="topic">
<p class="topic-title">Filtering on <code class="docutils literal notranslate"><span class="pre">index.RelatedFields</span></code></p>
<p>It’s not possible to filter on any <code class="docutils literal notranslate"><span class="pre">index.FilterFields</span></code> within <code class="docutils literal notranslate"><span class="pre">index.RelatedFields</span></code> using the <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> API. However, the fields are indexed, so it should be possible to use them by querying Elasticsearch manually.</p>
<p>Filtering on <code class="docutils literal notranslate"><span class="pre">index.RelatedFields</span></code> with the <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> API is planned for a future release of Wagtail.</p>
</div>
</div>
<div class="section" id="indexing-callables-and-other-attributes">
<span id="wagtailsearch-indexing-callable-fields"></span><h7>Indexing callables and other attributes<a class="headerlink" href="#indexing-callables-and-other-attributes" title="Permalink to this headline">¶</a></h7>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is not supported in the <a class="reference internal" href="index.html#wagtailsearch-backends-database"><span class="std std-ref">Database Backend (default)</span></a></p>
</div>
<p>Search/filter fields do not need to be Django model fields. They can also be any method or attribute on your model class.</p>
<p>One use for this is indexing the <code class="docutils literal notranslate"><span class="pre">get_*_display</span></code> methods Django creates automatically for fields with choices.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.search</span> <span class="kn">import</span> <span class="n">index</span>

<span class="k">class</span> <span class="nc">EventPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">IS_PRIVATE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Public&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Private&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">is_private</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">IS_PRIVATE_CHOICES</span><span class="p">)</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">search_fields</span> <span class="o">+</span> <span class="p">[</span>
        <span class="c1"># Index the human-readable string for searching.</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;get_is_private_display&#39;</span><span class="p">),</span>

        <span class="c1"># Index the boolean value for filtering.</span>
        <span class="n">index</span><span class="o">.</span><span class="n">FilterField</span><span class="p">(</span><span class="s1">&#39;is_private&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Callables also provide a way to index fields from related models. In the example from <a class="reference internal" href="index.html#inline-panels"><span class="std std-ref">Inline Panels and Model Clusters</span></a>, to index each BookPage by the titles of its related_links:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">def</span> <span class="nf">get_related_link_titles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Get list of titles and concatenate them</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">related_links</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">search_fields</span> <span class="o">+</span> <span class="p">[</span>
        <span class="c1"># ...</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;get_related_link_titles&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="indexing-custom-models">
<span id="wagtailsearch-indexing-models"></span><h6>Indexing custom models<a class="headerlink" href="#indexing-custom-models" title="Permalink to this headline">¶</a></h6>
<p>Any Django model can be indexed and searched.</p>
<p>To do this, inherit from <code class="docutils literal notranslate"><span class="pre">index.Indexed</span></code> and add some <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> to the model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.search</span> <span class="kn">import</span> <span class="n">index</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">Indexed</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">genre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">GENRE_CHOICES</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">published_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">partial_match</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">boost</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;get_genre_display&#39;</span><span class="p">),</span>

        <span class="n">index</span><span class="o">.</span><span class="n">FilterField</span><span class="p">(</span><span class="s1">&#39;genre&#39;</span><span class="p">),</span>
        <span class="n">index</span><span class="o">.</span><span class="n">FilterField</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">),</span>
        <span class="n">index</span><span class="o">.</span><span class="n">FilterField</span><span class="p">(</span><span class="s1">&#39;published_date&#39;</span><span class="p">),</span>
    <span class="p">]</span>

<span class="c1"># As this model doesn&#39;t have a search method in its QuerySet, we have to call search directly on the backend</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">wagtail.search.backends</span> <span class="kn">import</span> <span class="n">get_search_backend</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">get_search_backend</span><span class="p">()</span>

<span class="c1"># Run a search for a book by Roald Dahl</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">roald_dahl</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Roald Dahl&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;chocolate factory&quot;</span><span class="p">,</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">roald_dahl</span><span class="p">))</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Book</span><span class="p">:</span> <span class="n">Charlie</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">chocolate</span> <span class="n">factory</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<span id="document-topics/search/searching"></span><div class="section" id="searching">
<span id="wagtailsearch-searching"></span><h5>Searching<a class="headerlink" href="#searching" title="Permalink to this headline">¶</a></h5>
<div class="section" id="searching-querysets">
<span id="wagtailsearch-searching-pages"></span><h6>Searching QuerySets<a class="headerlink" href="#searching-querysets" title="Permalink to this headline">¶</a></h6>
<p>Wagtail search is built on Django’s <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/querysets/">QuerySet API</a>. You should be able to search any Django QuerySet provided the model and the fields being filtered on have been added to the search index.</p>
<div class="section" id="searching-pages">
<h7>Searching Pages<a class="headerlink" href="#searching-pages" title="Permalink to this headline">¶</a></h7>
<p>Wagtail provides a shortcut for searching pages: the <code class="docutils literal notranslate"><span class="pre">.search()</span></code> <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> method. You can call this on any <code class="docutils literal notranslate"><span class="pre">PageQuerySet</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Search future EventPages</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">EventPage</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">date__gt</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Hello world!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>All other methods of <code class="docutils literal notranslate"><span class="pre">PageQuerySet</span></code> can be used with <code class="docutils literal notranslate"><span class="pre">search()</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Search all live EventPages that are under the events index</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">descendant_of</span><span class="p">(</span><span class="n">events_index</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Event&quot;</span><span class="p">)</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">EventPage</span><span class="p">:</span> <span class="n">Event</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">EventPage</span><span class="p">:</span> <span class="n">Event</span> <span class="mi">2</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">search()</span></code> method will convert your <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> into an instance of one of Wagtail’s <code class="docutils literal notranslate"><span class="pre">SearchResults</span></code> classes (depending on backend). This means that you must perform filtering before calling <code class="docutils literal notranslate"><span class="pre">search()</span></code>.</p>
</div>
</div>
<div class="section" id="searching-images-documents-and-custom-models">
<span id="wagtailsearch-images-documents-custom-models"></span><h7>Searching Images, Documents and custom models<a class="headerlink" href="#searching-images-documents-and-custom-models" title="Permalink to this headline">¶</a></h7>
<p>Wagtail’s document and image models provide a <code class="docutils literal notranslate"><span class="pre">search</span></code> method on their QuerySets, just as pages do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wagtail.images.models</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Image</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">uploaded_by_user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="go">[&lt;Image: Hello&gt;, &lt;Image: Hello world!&gt;]</span>
</pre></div>
</div>
<p><a class="reference internal" href="index.html#wagtailsearch-indexing-models"><span class="std std-ref">Custom models</span></a> can be searched by using the <code class="docutils literal notranslate"><span class="pre">search</span></code> method on the search backend directly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.models</span> <span class="kn">import</span> <span class="n">Book</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wagtail.search.backends</span> <span class="kn">import</span> <span class="n">get_search_backend</span>

<span class="go"># Search books</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">get_search_backend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Great&quot;</span><span class="p">,</span> <span class="n">Book</span><span class="p">)</span>
<span class="go">[&lt;Book: Great Expectations&gt;, &lt;Book: The Great Gatsby&gt;]</span>
</pre></div>
</div>
<p>You can also pass a QuerySet into the <code class="docutils literal notranslate"><span class="pre">search</span></code> method which allows you to add filters to your search results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.models</span> <span class="kn">import</span> <span class="n">Book</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wagtail.search.backends</span> <span class="kn">import</span> <span class="n">get_search_backend</span>

<span class="go"># Search books</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">get_search_backend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Great&quot;</span><span class="p">,</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">published_date__year__lt</span><span class="o">=</span><span class="mi">1900</span><span class="p">))</span>
<span class="go">[&lt;Book: Great Expectations&gt;]</span>
</pre></div>
</div>
</div>
<div class="section" id="specifying-the-fields-to-search">
<span id="wagtailsearch-specifying-fields"></span><h7>Specifying the fields to search<a class="headerlink" href="#specifying-the-fields-to-search" title="Permalink to this headline">¶</a></h7>
<p>By default, Wagtail will search all fields that have been indexed using <code class="docutils literal notranslate"><span class="pre">index.SearchField</span></code>.</p>
<p>This can be limited to a certain set of fields by using the <code class="docutils literal notranslate"><span class="pre">fields</span></code> keyword argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Search just the title field</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">EventPage</span><span class="p">:</span> <span class="n">Event</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">EventPage</span><span class="p">:</span> <span class="n">Event</span> <span class="mi">2</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="faceted-search">
<span id="wagtailsearch-faceted-search"></span><h7>Faceted search<a class="headerlink" href="#faceted-search" title="Permalink to this headline">¶</a></h7>
<p>Wagtail supports faceted search which is a kind of filtering based on a taxonomy
field (such as category or page type).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.facet(field_name)</span></code> method returns an <code class="docutils literal notranslate"><span class="pre">OrderedDict</span></code>. The keys are
the IDs of the related objects that have been referenced by the specified field, and the
values are the number of references found for each ID. The results are ordered by number
of references descending.</p>
<p>For example, to find the most common page types in the search results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;content_type_id&quot;</span><span class="p">)</span>

<span class="go"># Note: The keys correspond to the ID of a ContentType object; the values are the</span>
<span class="go"># number of pages returned for that type</span>
<span class="go">OrderedDict([</span>
<span class="go">    (&#39;2&#39;, 4),  # 4 pages have content_type_id == 2</span>
<span class="go">    (&#39;1&#39;, 2),  # 2 pages have content_type_id == 1</span>
<span class="go">])</span>
</pre></div>
</div>
</div>
<div class="section" id="changing-search-behaviour">
<h7>Changing search behaviour<a class="headerlink" href="#changing-search-behaviour" title="Permalink to this headline">¶</a></h7>
<div class="section" id="search-operator">
<h8>Search operator<a class="headerlink" href="#search-operator" title="Permalink to this headline">¶</a></h8>
<p>The search operator specifies how search should behave when the user has typed in multiple search terms. There are two possible values:</p>
<ul class="simple">
<li>“or” - The results must match at least one term (default for Elasticsearch)</li>
<li>“and” - The results must match all terms (default for database search)</li>
</ul>
<p>Both operators have benefits and drawbacks. The “or” operator will return many more results but will likely contain a lot of results that aren’t relevant. The “and” operator only returns results that contain all search terms, but require the user to be more precise with their query.</p>
<p>We recommend using the “or” operator when ordering by relevance and the “and” operator when ordering by anything else (note: the database backend doesn’t currently support ordering by relevance).</p>
<p>Here’s an example of using the <code class="docutils literal notranslate"><span class="pre">operator</span></code> keyword argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The database contains a &quot;Thing&quot; model with the following items:</span>
<span class="c1"># - Hello world</span>
<span class="c1"># - Hello</span>
<span class="c1"># - World</span>


<span class="c1"># Search with the &quot;or&quot; operator</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">get_search_backend</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">,</span> <span class="n">Things</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;or&quot;</span><span class="p">)</span>

<span class="c1"># All records returned as they all contain either &quot;hello&quot; or &quot;world&quot;</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Thing</span><span class="p">:</span> <span class="n">Hello</span> <span class="n">World</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Thing</span><span class="p">:</span> <span class="n">Hello</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Thing</span><span class="p">:</span> <span class="n">World</span><span class="o">&gt;</span><span class="p">]</span>


<span class="c1"># Search with the &quot;and&quot; operator</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">get_search_backend</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">,</span> <span class="n">Things</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;and&quot;</span><span class="p">)</span>

<span class="c1"># Only &quot;hello world&quot; returned as that&#39;s the only item that contains both terms</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Thing</span><span class="p">:</span> <span class="n">Hello</span> <span class="n">world</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>For page, image and document models, the <code class="docutils literal notranslate"><span class="pre">operator</span></code> keyword argument is also supported on the QuerySet’s <code class="docutils literal notranslate"><span class="pre">search</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;or&quot;</span><span class="p">)</span>

<span class="go"># All pages containing either &quot;hello&quot; or &quot;world&quot; are returned</span>
<span class="go">[&lt;Page: Hello World&gt;, &lt;Page: Hello&gt;, &lt;Page: World&gt;]</span>
</pre></div>
</div>
</div>
<div class="section" id="phrase-searching">
<h8>Phrase searching<a class="headerlink" href="#phrase-searching" title="Permalink to this headline">¶</a></h8>
<p>Phrase searching is used for finding whole sentence or phrase rather than individual terms.
The terms must appear together and in the same order.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wagtail.search.query</span> <span class="kn">import</span> <span class="n">Phrase</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Phrase</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">))</span>
<span class="go">[&lt;Page: Hello World&gt;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Phrase</span><span class="p">(</span><span class="s2">&quot;World hello&quot;</span><span class="p">))</span>
<span class="go">[&lt;Page: World Hello day&gt;]</span>
</pre></div>
</div>
<p>If you are looking to implement phrase queries using the double-quote syntax, see <a class="reference internal" href="#wagtailsearch-query-string-parsing"><span class="std std-ref">Query string parsing</span></a>.</p>
</div>
<div class="section" id="complex-search-queries">
<span id="wagtailsearch-complex-queries"></span><h8>Complex search queries<a class="headerlink" href="#complex-search-queries" title="Permalink to this headline">¶</a></h8>
<p>Through the use of search query classes, Wagtail also supports building search queries as Python
objects which can be wrapped by and combined with other search queries. The following classes are
available:</p>
<p><code class="docutils literal notranslate"><span class="pre">PlainText(query_string,</span> <span class="pre">operator=None,</span> <span class="pre">boost=1.0)</span></code></p>
<p>This class wraps a string of separate terms. This is the same as searching without query classes.</p>
<p>It takes a query string, operator and boost.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wagtail.search.query</span> <span class="kn">import</span> <span class="n">PlainText</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">PlainText</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">))</span>

<span class="go"># Multiple plain text queries can be combined. This example will match both &quot;hello world&quot; and &quot;Hello earth&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">PlainText</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">PlainText</span><span class="p">(</span><span class="s2">&quot;world&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="n">PlainText</span><span class="p">(</span><span class="s2">&quot;earth&quot;</span><span class="p">)))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Phrase(query_string)</span></code></p>
<p>This class wraps a string containing a phrase. See previous section for how this works.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This example will match both the phrases &quot;hello world&quot; and &quot;Hello earth&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Phrase</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="n">Phrase</span><span class="p">(</span><span class="s2">&quot;Hello earth&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Boost(query,</span> <span class="pre">boost)</span></code></p>
<p>This class boosts the score of another query.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wagtail.search.query</span> <span class="kn">import</span> <span class="n">PlainText</span><span class="p">,</span> <span class="n">Boost</span>

<span class="go"># This example will match both the phrases &quot;hello world&quot; and &quot;Hello earth&quot; but matches for &quot;hello world&quot; will be ranked higher</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Boost</span><span class="p">(</span><span class="n">Phrase</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">),</span> <span class="mf">10.0</span><span class="p">)</span> <span class="o">|</span> <span class="n">Phrase</span><span class="p">(</span><span class="s2">&quot;Hello earth&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that this isn’t supported by the PostgreSQL or database search backends.</p>
</div>
<div class="section" id="query-string-parsing">
<span id="wagtailsearch-query-string-parsing"></span><h8>Query string parsing<a class="headerlink" href="#query-string-parsing" title="Permalink to this headline">¶</a></h8>
<p>The previous sections show how to construct a phrase search query manually, but a lot of search engines (Wagtail admin included, try it!)
support writing phrase queries by wrapping the phrase with double-quotes. In addition to phrases, you might also want to allow users to
add filters into the query using the colon syntax (<code class="docutils literal notranslate"><span class="pre">hello</span> <span class="pre">world</span> <span class="pre">published:yes</span></code>).</p>
<p>These two features can be implemented using the <code class="docutils literal notranslate"><span class="pre">parse_query_string</span></code> utility function. This function takes a query string that a user
typed and returns a query object and dictionary of filters:</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wagtail.search.utils</span> <span class="kn">import</span> <span class="n">parse_query_string</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filters</span><span class="p">,</span> <span class="n">query</span> <span class="o">=</span> <span class="n">parse_query_string</span><span class="p">(</span><span class="s1">&#39;my query string &quot;this is a phrase&quot; this-is-a:filter&#39;</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s1">&#39;and&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">filters</span>
<span class="go">{</span>
<span class="go">    &#39;this-is-a&#39;: &#39;filter&#39;,</span>
<span class="go">}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span>
<span class="go">And([</span>
<span class="go">    PlainText(&quot;my query string&quot;, operator=&#39;and&#39;),</span>
<span class="go">    Phrase(&quot;this is a phrase&quot;),</span>
<span class="go">])</span>
</pre></div>
</div>
<p>Here’s an example of how this function can be used in a search view:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.search.utils</span> <span class="kn">import</span> <span class="n">parse_query_string</span>

<span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">query_string</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span>

    <span class="c1"># Parse query</span>
    <span class="n">filters</span><span class="p">,</span> <span class="n">query</span> <span class="o">=</span> <span class="n">parse_query_string</span><span class="p">(</span><span class="n">query_string</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s1">&#39;and&#39;</span><span class="p">)</span>

    <span class="c1"># Published filter</span>
    <span class="c1"># An example filter that accepts either `published:yes` or `published:no` and filters the pages accordingly</span>
    <span class="n">published_filter</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">)</span>
    <span class="n">published_filter</span> <span class="o">=</span> <span class="n">published_filter</span> <span class="ow">and</span> <span class="n">published_filter</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">published_filter</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">]:</span>
        <span class="n">pages</span> <span class="o">=</span> <span class="n">pages</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">live</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">published_filter</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">]:</span>
        <span class="n">pages</span> <span class="o">=</span> <span class="n">pages</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">live</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Search</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="n">pages</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;search_results.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;pages&#39;</span><span class="p">:</span> <span class="n">pages</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-ordering">
<h8>Custom ordering<a class="headerlink" href="#custom-ordering" title="Permalink to this headline">¶</a></h8>
<p>By default, search results are ordered by relevance, if the backend supports it. To preserve the QuerySet’s existing ordering, the <code class="docutils literal notranslate"><span class="pre">order_by_relevance</span></code> keyword argument needs to be set to <code class="docutils literal notranslate"><span class="pre">False</span></code> on the <code class="docutils literal notranslate"><span class="pre">search()</span></code> method.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a list of events ordered by date</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="n">order_by_relevance</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Events ordered by date</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">EventPage</span><span class="p">:</span> <span class="n">Easter</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">EventPage</span><span class="p">:</span> <span class="n">Halloween</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">EventPage</span><span class="p">:</span> <span class="n">Christmas</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="annotating-results-with-score">
<span id="wagtailsearch-annotating-results-with-score"></span><h8>Annotating results with score<a class="headerlink" href="#annotating-results-with-score" title="Permalink to this headline">¶</a></h8>
<p>For each matched result, Elasticsearch calculates a “score”, which is a number
that represents how relevant the result is based on the user’s query. The
results are usually ordered based on the score.</p>
<p>There are some cases where having access to the score is useful (such as
programmatically combining two queries for different models). You can add the
score to each result by calling the <code class="docutils literal notranslate"><span class="pre">.annotate_score(field)</span></code> method on the
<code class="docutils literal notranslate"><span class="pre">SearchQuerySet</span></code>.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">events</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Event&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate_score</span><span class="p">(</span><span class="s2">&quot;_score&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
<span class="gp">... </span>   <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">_score</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">(&quot;Easter&quot;, 2.5),</span>
<span class="go">(&quot;Halloween&quot;, 1.7),</span>
<span class="go">(&quot;Christmas&quot;, 1.5),</span>
</pre></div>
</div>
<p>Note that the score itself is arbitrary and it is only useful for comparison
of results for the same query.</p>
</div>
</div>
</div>
<div class="section" id="an-example-page-search-view">
<span id="wagtailsearch-frontend-views"></span><h6>An example page search view<a class="headerlink" href="#an-example-page-search-view" title="Permalink to this headline">¶</a></h6>
<p>Here’s an example Django view that could be used to add a “search” page to your site:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># views.py</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>
<span class="kn">from</span> <span class="nn">wagtail.search.models</span> <span class="kn">import</span> <span class="n">Query</span>


<span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Search</span>
    <span class="n">search_query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">search_query</span><span class="p">:</span>
        <span class="n">search_results</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">search_query</span><span class="p">)</span>

        <span class="c1"># Log the query so Wagtail can suggest promoted results</span>
        <span class="n">Query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">search_query</span><span class="p">)</span><span class="o">.</span><span class="n">add_hit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">search_results</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>

    <span class="c1"># Render template</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;search_results.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;search_query&#39;</span><span class="p">:</span> <span class="n">search_query</span><span class="p">,</span>
        <span class="s1">&#39;search_results&#39;</span><span class="p">:</span> <span class="n">search_results</span><span class="p">,</span>
    <span class="p">})</span>
</pre></div>
</div>
<p>And here’s a template to go with it:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Search<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;search&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;get&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;query&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">search_query</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Search&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">search_results</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">for</span> <span class="nv">result</span> <span class="k">in</span> <span class="nv">search_results</span> <span class="cp">%}</span>
                <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">result</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">result</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
                    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">result.search_description</span> <span class="cp">%}</span>
                        <span class="cp">{{</span> <span class="nv">result.search_description</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span>
                    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">elif</span> <span class="nv">search_query</span> <span class="cp">%}</span>
        No results found
    <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        Please type something into the search box
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="promoted-search-results">
<h6>Promoted search results<a class="headerlink" href="#promoted-search-results" title="Permalink to this headline">¶</a></h6>
<p>“Promoted search results” allow editors to explicitly link relevant content to search terms, so results pages can contain curated content in addition to results from the search engine.</p>
<p>This functionality is provided by the <a class="reference internal" href="index.html#module-wagtail.contrib.search_promotions" title="wagtail.contrib.search_promotions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">search_promotions</span></code></a> contrib module.</p>
</div>
</div>
<span id="document-topics/search/backends"></span><div class="section" id="backends">
<span id="wagtailsearch-backends"></span><h5>Backends<a class="headerlink" href="#backends" title="Permalink to this headline">¶</a></h5>
<p>Wagtailsearch has support for multiple backends, giving you the choice between using the database for search or an external service such as Elasticsearch. The database backend is enabled by default.</p>
<p>You can configure which backend to use with the <code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_BACKENDS</span></code> setting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.search.backends.db&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="auto-update">
<span id="wagtailsearch-backends-auto-update"></span><h6><code class="docutils literal notranslate"><span class="pre">AUTO_UPDATE</span></code><a class="headerlink" href="#auto-update" title="Permalink to this headline">¶</a></h6>
<p>By default, Wagtail will automatically keep all indexes up to date. This could impact performance when editing content, especially if your index is hosted on an external service.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">AUTO_UPDATE</span></code> setting allows you to disable this on a per-index basis:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
        <span class="s1">&#39;AUTO_UPDATE&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you have disabled auto update, you must run the <a class="reference internal" href="index.html#update-index"><span class="std std-ref">update_index</span></a> command on a regular basis to keep the index in sync with the database.</p>
</div>
<div class="section" id="atomic-rebuild">
<span id="wagtailsearch-backends-atomic-rebuild"></span><h6><code class="docutils literal notranslate"><span class="pre">ATOMIC_REBUILD</span></code><a class="headerlink" href="#atomic-rebuild" title="Permalink to this headline">¶</a></h6>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This option may not work on Elasticsearch version 5.4.x, due to <a class="reference external" href="https://github.com/elastic/elasticsearch/issues/24644">a bug in the handling of aliases</a> - please upgrade to 5.5 or later.</p>
</div>
<p>By default (when using the Elasticsearch backend), when the <code class="docutils literal notranslate"><span class="pre">update_index</span></code> command is run, Wagtail deletes the index and rebuilds it from scratch. This causes the search engine to not return results until the rebuild is complete and is also risky as you can’t rollback if an error occurs.</p>
<p>Setting the <code class="docutils literal notranslate"><span class="pre">ATOMIC_REBUILD</span></code> setting to <code class="docutils literal notranslate"><span class="pre">True</span></code> makes Wagtail rebuild into a separate index while keep the old index active until the new one is fully built. When the rebuild is finished, the indexes are swapped atomically and the old index is deleted.</p>
</div>
<div class="section" id="backend">
<h6><code class="docutils literal notranslate"><span class="pre">BACKEND</span></code><a class="headerlink" href="#backend" title="Permalink to this headline">¶</a></h6>
<p>Here’s a list of backends that Wagtail supports out of the box.</p>
<div class="section" id="database-backend-default">
<span id="wagtailsearch-backends-database"></span><h7>Database Backend (default)<a class="headerlink" href="#database-backend-default" title="Permalink to this headline">¶</a></h7>
<p><code class="docutils literal notranslate"><span class="pre">wagtail.search.backends.db</span></code></p>
<p>The database backend is very basic and is intended only to be used in development and on small sites. It cannot order results by relevance, severely hampering its usefulness when searching a large collection of pages.</p>
<p>It also doesn’t support:</p>
<ul class="simple">
<li>Searching on fields in subclasses of <code class="docutils literal notranslate"><span class="pre">Page</span></code> (unless the class is being searched directly)</li>
<li><a class="reference internal" href="index.html#wagtailsearch-indexing-callable-fields"><span class="std std-ref">Indexing callables and other attributes</span></a></li>
<li>Converting accented characters to ASCII</li>
</ul>
<p>If any of these features are important to you, we recommend using Elasticsearch instead.</p>
</div>
<div class="section" id="postgresql-backend">
<span id="wagtailsearch-backends-postgresql"></span><h7>PostgreSQL Backend<a class="headerlink" href="#postgresql-backend" title="Permalink to this headline">¶</a></h7>
<p><code class="docutils literal notranslate"><span class="pre">wagtail.contrib.postgres_search.backend</span></code></p>
<p>If you use PostgreSQL for your database and your site has less than
a million pages, you probably want to use this backend.</p>
<p>See <a class="reference internal" href="index.html#postgres-search"><span class="std std-ref">PostgreSQL search engine</span></a> for more detail.</p>
</div>
<div class="section" id="elasticsearch-backend">
<span id="wagtailsearch-backends-elasticsearch"></span><h7>Elasticsearch Backend<a class="headerlink" href="#elasticsearch-backend" title="Permalink to this headline">¶</a></h7>
<p>Elasticsearch versions 5, 6 and 7 are supported. Use the appropriate backend for your version:</p>
<p><code class="docutils literal notranslate"><span class="pre">wagtail.search.backends.elasticsearch5</span></code> (Elasticsearch 5.x)</p>
<p><code class="docutils literal notranslate"><span class="pre">wagtail.search.backends.elasticsearch6</span></code> (Elasticsearch 6.x)</p>
<p><code class="docutils literal notranslate"><span class="pre">wagtail.search.backends.elasticsearch7</span></code> (Elasticsearch 7.x)</p>
<p>Prerequisites are the <a class="reference external" href="https://www.elastic.co/downloads/elasticsearch">Elasticsearch</a> service itself and, via pip, the <a class="reference external" href="https://elasticsearch-py.readthedocs.org">elasticsearch-py</a> package. The major version of the package must match the installed version of Elasticsearch:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip install <span class="s2">&quot;elasticsearch&gt;=5.0.0,&lt;6.0.0&quot;</span>  <span class="c1"># for Elasticsearch 5.x</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip install <span class="s2">&quot;elasticsearch&gt;=6.4.0,&lt;7.0.0&quot;</span>  <span class="c1"># for Elasticsearch 6.x</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip install <span class="s2">&quot;elasticsearch&gt;=7.0.0,&lt;8.0.0&quot;</span>  <span class="c1"># for Elasticsearch 7.x</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<div class="last line-block">
<div class="line">Version 6.3.1 of the Elasticsearch client library is incompatible with Wagtail. Use 6.4.0 or above.</div>
</div>
</div>
<p>The backend is configured in settings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.search.backends.elasticsearch5&#39;</span><span class="p">,</span>
        <span class="s1">&#39;URLS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;http://localhost:9200&#39;</span><span class="p">],</span>
        <span class="s1">&#39;INDEX&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail&#39;</span><span class="p">,</span>
        <span class="s1">&#39;TIMEOUT&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;INDEX_SETTINGS&#39;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Other than <code class="docutils literal notranslate"><span class="pre">BACKEND</span></code>, the keys are optional and default to the values shown. Any defined key in <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> is passed directly to the Elasticsearch constructor as case-sensitive keyword argument (e.g. <code class="docutils literal notranslate"><span class="pre">'max_retries':</span> <span class="pre">1</span></code>).</p>
<p>A username and password may be optionally be supplied to the <code class="docutils literal notranslate"><span class="pre">URL</span></code> field to provide authentication credentials for the Elasticsearch service:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="o">...</span>
        <span class="s1">&#39;URLS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;http://username:password@localhost:9200&#39;</span><span class="p">],</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">INDEX_SETTINGS</span></code> is a dictionary used to override the default settings to create the index. The default settings are defined inside the <code class="docutils literal notranslate"><span class="pre">ElasticsearchSearchBackend</span></code> class in the module <code class="docutils literal notranslate"><span class="pre">wagtail/wagtail/search/backends/elasticsearch7.py</span></code>. Any new key is added, any existing key, if not a dictionary, is replaced with the new value. Here’s a sample on how to configure the number of shards and setting the Italian LanguageAnalyzer as the default analyzer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="s1">&#39;INDEX_SETTINGS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;settings&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;number_of_shards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s1">&#39;analysis&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;analyzer&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;italian&#39;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>If you prefer not to run an Elasticsearch server in development or production, there are many hosted services available, including <a class="reference external" href="https://bonsai.io/">Bonsai</a>, who offer a free account suitable for testing and development. To use Bonsai:</p>
<ul class="simple">
<li>Sign up for an account at <a class="reference external" href="https://bonsai.io/">Bonsai</a></li>
<li>Use your Bonsai dashboard to create a Cluster.</li>
<li>Configure <code class="docutils literal notranslate"><span class="pre">URLS</span></code> in the Elasticsearch entry in <code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_BACKENDS</span></code> using the Cluster URL from your Bonsai dashboard</li>
<li>Run <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">update_index</span></code></li>
</ul>
<div class="section" id="amazon-aws-elasticsearch">
<h8>Amazon AWS Elasticsearch<a class="headerlink" href="#amazon-aws-elasticsearch" title="Permalink to this headline">¶</a></h8>
<p>The Elasticsearch backend is compatible with <a class="reference external" href="https://aws.amazon.com/elasticsearch-service/">Amazon Elasticsearch Service</a>, but requires additional configuration to handle IAM based authentication. This can be done with the <a class="reference external" href="https://pypi.python.org/pypi/requests-aws4auth">requests-aws4auth</a> package along with the following configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">elasticsearch</span> <span class="kn">import</span> <span class="n">RequestsHttpConnection</span>
<span class="kn">from</span> <span class="nn">requests_aws4auth</span> <span class="kn">import</span> <span class="n">AWS4Auth</span>

<span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.search.backends.elasticsearch5&#39;</span><span class="p">,</span>
        <span class="s1">&#39;INDEX&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail&#39;</span><span class="p">,</span>
        <span class="s1">&#39;TIMEOUT&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s1">&#39;HOSTS&#39;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="s1">&#39;host&#39;</span><span class="p">:</span> <span class="s1">&#39;YOURCLUSTER.REGION.es.amazonaws.com&#39;</span><span class="p">,</span>
            <span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
            <span class="s1">&#39;use_ssl&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;verify_certs&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;http_auth&#39;</span><span class="p">:</span> <span class="n">AWS4Auth</span><span class="p">(</span><span class="s1">&#39;ACCESS_KEY&#39;</span><span class="p">,</span> <span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">,</span> <span class="s1">&#39;REGION&#39;</span><span class="p">,</span> <span class="s1">&#39;es&#39;</span><span class="p">),</span>
        <span class="p">}],</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;connection_class&#39;</span><span class="p">:</span> <span class="n">RequestsHttpConnection</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="rolling-your-own">
<h7>Rolling Your Own<a class="headerlink" href="#rolling-your-own" title="Permalink to this headline">¶</a></h7>
<p>Wagtail search backends implement the interface defined in <code class="docutils literal notranslate"><span class="pre">wagtail/wagtail/wagtailsearch/backends/base.py</span></code>. At a minimum, the backend’s <code class="docutils literal notranslate"><span class="pre">search()</span></code> method must return a collection of objects or <code class="docutils literal notranslate"><span class="pre">model.objects.none()</span></code>. For a fully-featured search backend, examine the Elasticsearch backend code in <code class="docutils literal notranslate"><span class="pre">elasticsearch.py</span></code>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="indexing">
<h5>Indexing<a class="headerlink" href="#indexing" title="Permalink to this headline">¶</a></h5>
<p>To make objects searchable, they must first be added to the search index. This involves configuring the models and fields that you would like to index (which is done for you for Pages, Images and Documents), and then actually inserting them into the index.</p>
<p>See <a class="reference internal" href="index.html#wagtailsearch-indexing-update"><span class="std std-ref">Updating the index</span></a> for information on how to keep the objects in your search index in sync with the objects in your database.</p>
<p>If you have created some extra fields in a subclass of <code class="docutils literal notranslate"><span class="pre">Page</span></code> or <code class="docutils literal notranslate"><span class="pre">Image</span></code>, you may want to add these new fields to the search index, so a user’s search query can match the Page or Image’s extra content. See <a class="reference internal" href="index.html#wagtailsearch-indexing-fields"><span class="std std-ref">Indexing extra fields</span></a>.</p>
<p>If you have a custom model which doesn’t derive from <code class="docutils literal notranslate"><span class="pre">Page</span></code> or <code class="docutils literal notranslate"><span class="pre">Image</span></code> that you would like to make searchable, see <a class="reference internal" href="index.html#wagtailsearch-indexing-models"><span class="std std-ref">Indexing custom models</span></a>.</p>
</div>
<div class="section" id="searching">
<h5>Searching<a class="headerlink" href="#searching" title="Permalink to this headline">¶</a></h5>
<p>Wagtail provides an API for performing search queries on your models. You can also perform search queries on Django QuerySets.</p>
<p>See <a class="reference internal" href="index.html#wagtailsearch-searching"><span class="std std-ref">Searching</span></a>.</p>
</div>
<div class="section" id="backends">
<h5>Backends<a class="headerlink" href="#backends" title="Permalink to this headline">¶</a></h5>
<p>Wagtail provides three backends for storing the search index and performing search queries: Elasticsearch, the database, and PostgreSQL (Django &gt;=1.10 required). It’s also possible to roll your own search backend.</p>
<p>See <a class="reference internal" href="index.html#wagtailsearch-backends"><span class="std std-ref">Backends</span></a></p>
</div>
</div>
<span id="document-topics/snippets"></span><div class="section" id="snippets">
<span id="id1"></span><h4>Snippets<a class="headerlink" href="#snippets" title="Permalink to this headline">¶</a></h4>
<p>Snippets are pieces of content which do not necessitate a full webpage to render. They could be used for making secondary content, such as headers, footers, and sidebars, editable in the Wagtail admin. Snippets are Django models which do not inherit the <code class="docutils literal notranslate"><span class="pre">Page</span></code> class and are thus not organized into the Wagtail tree. However, they can still be made editable by assigning panels and identifying the model as a snippet with the <code class="docutils literal notranslate"><span class="pre">register_snippet</span></code> class decorator.</p>
<p>Snippets lack many of the features of pages, such as being orderable in the Wagtail admin or having a defined URL. Decide carefully if the content type you would want to build into a snippet might be more suited to a page.</p>
<div class="section" id="snippet-models">
<h5>Snippet Models<a class="headerlink" href="#snippet-models" title="Permalink to this headline">¶</a></h5>
<p>Here’s an example snippet model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">FieldPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.snippets.models</span> <span class="kn">import</span> <span class="n">register_snippet</span>

<span class="o">...</span>

<span class="nd">@register_snippet</span>
<span class="k">class</span> <span class="nc">Advert</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Advert</span></code> model uses the basic Django model class and defines two properties: text and URL. The editing interface is very close to that provided for <code class="docutils literal notranslate"><span class="pre">Page</span></code>-derived models, with fields assigned in the <code class="docutils literal notranslate"><span class="pre">panels</span></code> property. Snippets do not use multiple tabs of fields, nor do they provide the “save as draft” or “submit for moderation” features.</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;register_snippet</span></code> tells Wagtail to treat the model as a snippet. The <code class="docutils literal notranslate"><span class="pre">panels</span></code> list defines the fields to show on the snippet editing page. It’s also important to provide a string representation of the class through <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">__str__(self):</span></code> so that the snippet objects make sense when listed in the Wagtail admin.</p>
</div>
<div class="section" id="including-snippets-in-template-tags">
<h5>Including Snippets in Template Tags<a class="headerlink" href="#including-snippets-in-template-tags" title="Permalink to this headline">¶</a></h5>
<p>The simplest way to make your snippets available to templates is with a template tag. This is mostly done with vanilla Django, so perhaps reviewing Django’s documentation for <a class="reference external" href="https://docs.djangoproject.com/en/stable/howto/custom-template-tags/" title="(in Django v3.2)"><span class="xref std std-doc">django custom template tags</span></a> will be more helpful. We’ll go over the basics, though, and point out any considerations to make for Wagtail.</p>
<p>First, add a new python file to a <code class="docutils literal notranslate"><span class="pre">templatetags</span></code> folder within your app - for example, <code class="docutils literal notranslate"><span class="pre">myproject/demo/templatetags/demo_tags.py</span></code>. We’ll need to load some Django modules and our app’s models, and ready the <code class="docutils literal notranslate"><span class="pre">register</span></code> decorator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>
<span class="kn">from</span> <span class="nn">demo.models</span> <span class="kn">import</span> <span class="n">Advert</span>

<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>

<span class="o">...</span>

<span class="c1"># Advert snippets</span>
<span class="nd">@register</span><span class="o">.</span><span class="n">inclusion_tag</span><span class="p">(</span><span class="s1">&#39;demo/tags/adverts.html&#39;</span><span class="p">,</span> <span class="n">takes_context</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">adverts</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;adverts&#39;</span><span class="p">:</span> <span class="n">Advert</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="s1">&#39;request&#39;</span><span class="p">:</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">],</span>
    <span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&#64;register.inclusion_tag()</span></code> takes two variables: a template and a boolean on whether that template should be passed a request context. It’s a good idea to include request contexts in your custom template tags, since some Wagtail-specific template tags like <code class="docutils literal notranslate"><span class="pre">pageurl</span></code> need the context to work properly. The template tag function could take arguments and filter the adverts to return a specific instance of the model, but for brevity we’ll just use <code class="docutils literal notranslate"><span class="pre">Advert.objects.all()</span></code>.</p>
<p>Here’s what’s in the template used by this template tag:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">advert</span> <span class="k">in</span> <span class="nv">adverts</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">advert.url</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
            <span class="cp">{{</span> <span class="nv">advert.text</span> <span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Then, in your own page templates, you can include your snippet template tag with:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="nv">demo_tags</span> <span class="cp">%}</span>

...

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

    ...

    <span class="cp">{%</span> <span class="k">adverts</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="binding-pages-to-snippets">
<h5>Binding Pages to Snippets<a class="headerlink" href="#binding-pages-to-snippets" title="Permalink to this headline">¶</a></h5>
<p>In the above example, the list of adverts is a fixed list that is displayed via the custom template tag independent of any other content on the page. This might be what you want for a common panel in a sidebar, but, in another scenario, you might wish to display just one specific instance of a snippet on a particular page. This can be accomplished by defining a foreign key to the snippet model within your page model and adding a <code class="docutils literal notranslate"><span class="pre">SnippetChooserPanel</span></code> to the page’s <code class="docutils literal notranslate"><span class="pre">content_panels</span></code> list. For example, if you wanted to display a specific advert on a  <code class="docutils literal notranslate"><span class="pre">BookPage</span></code> instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.snippets.edit_handlers</span> <span class="kn">import</span> <span class="n">SnippetChooserPanel</span>
<span class="c1"># ...</span>
<span class="k">class</span> <span class="nc">BookPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">advert</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;demo.Advert&#39;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span>
    <span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">SnippetChooserPanel</span><span class="p">(</span><span class="s1">&#39;advert&#39;</span><span class="p">),</span>
        <span class="c1"># ...</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>The snippet could then be accessed within your template as <code class="docutils literal notranslate"><span class="pre">page.advert</span></code>.</p>
<p>To attach multiple adverts to a page, the <code class="docutils literal notranslate"><span class="pre">SnippetChooserPanel</span></code> can be placed on an inline child object of <code class="docutils literal notranslate"><span class="pre">BookPage</span></code> rather than on <code class="docutils literal notranslate"><span class="pre">BookPage</span></code> itself. Here, this child model is named <code class="docutils literal notranslate"><span class="pre">BookPageAdvertPlacement</span></code> (so called because there is one such object for each time that an advert is placed on a BookPage):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span><span class="p">,</span> <span class="n">Orderable</span>
<span class="kn">from</span> <span class="nn">wagtail.snippets.edit_handlers</span> <span class="kn">import</span> <span class="n">SnippetChooserPanel</span>

<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>

<span class="o">...</span>

<span class="k">class</span> <span class="nc">BookPageAdvertPlacement</span><span class="p">(</span><span class="n">Orderable</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;demo.BookPage&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;advert_placements&#39;</span><span class="p">)</span>
    <span class="n">advert</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;demo.Advert&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">Orderable</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;advert placement&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;advert placements&quot;</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">SnippetChooserPanel</span><span class="p">(</span><span class="s1">&#39;advert&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s2">&quot; -&gt; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">advert</span><span class="o">.</span><span class="n">text</span>


<span class="k">class</span> <span class="nc">BookPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;advert_placements&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Adverts&quot;</span><span class="p">),</span>
        <span class="c1"># ...</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>These child objects are now accessible through the page’s <code class="docutils literal notranslate"><span class="pre">advert_placements</span></code> property, and from there we can access the linked Advert snippet as <code class="docutils literal notranslate"><span class="pre">advert</span></code>. In the template for <code class="docutils literal notranslate"><span class="pre">BookPage</span></code>, we could include the following:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">advert_placement</span> <span class="k">in</span> <span class="nv">page.advert_placements.all</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">advert_placement.advert.url</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
            <span class="cp">{{</span> <span class="nv">advert_placement.advert.text</span> <span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="making-snippets-searchable">
<span id="wagtailsnippets-making-snippets-searchable"></span><h5>Making Snippets Searchable<a class="headerlink" href="#making-snippets-searchable" title="Permalink to this headline">¶</a></h5>
<p>If a snippet model inherits from <code class="docutils literal notranslate"><span class="pre">wagtail.search.index.Indexed</span></code>, as described in <a class="reference internal" href="index.html#wagtailsearch-indexing-models"><span class="std std-ref">Indexing custom models</span></a>, Wagtail will automatically add a search box to the chooser interface for that snippet type. For example, the <code class="docutils literal notranslate"><span class="pre">Advert</span></code> snippet could be made searchable as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="kn">from</span> <span class="nn">wagtail.search</span> <span class="kn">import</span> <span class="n">index</span>

<span class="o">...</span>

<span class="nd">@register_snippet</span>
<span class="k">class</span> <span class="nc">Advert</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">Indexed</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">partial_match</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="tagging-snippets">
<h5>Tagging snippets<a class="headerlink" href="#tagging-snippets" title="Permalink to this headline">¶</a></h5>
<p>Adding tags to snippets is very similar to adding tags to pages. The only difference is that <code class="xref py py-class docutils literal notranslate"><span class="pre">taggit.manager.TaggableManager</span></code> should be used in the place of <code class="xref py py-class docutils literal notranslate"><span class="pre">ClusterTaggableManager</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">modelcluster.models</span> <span class="kn">import</span> <span class="n">ClusterableModel</span>
<span class="kn">from</span> <span class="nn">taggit.models</span> <span class="kn">import</span> <span class="n">TaggedItemBase</span>
<span class="kn">from</span> <span class="nn">taggit.managers</span> <span class="kn">import</span> <span class="n">TaggableManager</span>

<span class="k">class</span> <span class="nc">AdvertTag</span><span class="p">(</span><span class="n">TaggedItemBase</span><span class="p">):</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;demo.Advert&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;tagged_items&#39;</span><span class="p">)</span>

<span class="nd">@register_snippet</span>
<span class="k">class</span> <span class="nc">Advert</span><span class="p">(</span><span class="n">ClusterableModel</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">TaggableManager</span><span class="p">(</span><span class="n">through</span><span class="o">=</span><span class="n">AdvertTag</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="o">...</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="index.html#tagging"><span class="std std-ref">documentation on tagging pages</span></a> has more information on how to use tags in views.</p>
</div>
</div>
<span id="document-topics/streamfield"></span><div class="section" id="how-to-use-streamfield-for-mixed-content">
<span id="streamfield"></span><h4>How to use StreamField for mixed content<a class="headerlink" href="#how-to-use-streamfield-for-mixed-content" title="Permalink to this headline">¶</a></h4>
<p>StreamField provides a content editing model suitable for pages that do not follow a fixed structure – such as blog posts or news stories – where the text may be interspersed with subheadings, images, pull quotes and video. It’s also suitable for more specialised content types, such as maps and charts (or, for a programming blog, code snippets). In this model, these different content types are represented as a sequence of ‘blocks’, which can be repeated and arranged in any order.</p>
<p>For further background on StreamField, and why you would use it instead of a rich text field for the article body, see the blog post <a class="reference external" href="https://torchbox.com/blog/rich-text-fields-and-faster-horses/">Rich text fields and faster horses</a>.</p>
<p>StreamField also offers a rich API to define your own block types, ranging from simple collections of sub-blocks (such as a ‘person’ block consisting of first name, surname and photograph) to completely custom components with their own editing interface. Within the database, the StreamField content is stored as JSON, ensuring that the full informational content of the field is preserved, rather than just an HTML representation of it.</p>
<div class="section" id="using-streamfield">
<h5>Using StreamField<a class="headerlink" href="#using-streamfield" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">StreamField</span></code> is a model field that can be defined within your page model like any other field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">StreamField</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">blocks</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">StreamFieldPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.images.blocks</span> <span class="kn">import</span> <span class="n">ImageChooserBlock</span>

<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="s2">&quot;Post date&quot;</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;paragraph&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
        <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
    <span class="p">])</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
        <span class="n">StreamFieldPanel</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>In this example, the body field of <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> is defined as a <code class="docutils literal notranslate"><span class="pre">StreamField</span></code> where authors can compose content from three different block types: headings, paragraphs, and images, which can be used and repeated in any order. The block types available to authors are defined as a list of <code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">block_type)</span></code> tuples: ‘name’ is used to identify the block type within templates, and should follow the standard Python conventions for variable names: lower-case and underscores, no spaces.</p>
<p>You can find the complete list of available block types in the <a class="reference internal" href="index.html#streamfield-block-reference"><span class="std std-ref">StreamField block reference</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">StreamField is not a direct replacement for other field types such as RichTextField. If you need to migrate an existing field to StreamField, refer to <a class="reference internal" href="#streamfield-migrating-richtext"><span class="std std-ref">Migrating RichTextFields to StreamField</span></a>.</p>
</div>
</div>
<div class="section" id="template-rendering">
<span id="streamfield-template-rendering"></span><h5>Template rendering<a class="headerlink" href="#template-rendering" title="Permalink to this headline">¶</a></h5>
<p>StreamField provides an HTML representation for the stream content as a whole, as well as for each individual block. To include this HTML into your page, use the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> tag:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

 ...

<span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">page.body</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>In the default rendering, each block of the stream is wrapped in a <code class="docutils literal notranslate"><span class="pre">&lt;div</span> <span class="pre">class=&quot;block-my_block_name&quot;&gt;</span></code> element (where <code class="docutils literal notranslate"><span class="pre">my_block_name</span></code> is the block name given in the StreamField definition). If you wish to provide your own HTML markup, you can instead iterate over the field’s value, and invoke <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> on each block in turn:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

 ...

<span class="p">&lt;</span><span class="nt">article</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nb">block</span> <span class="k">in</span> <span class="nv">page.body</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">section</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">include_block</span> <span class="nb">block</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">article</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>For more control over the rendering of specific block types, each block object provides <code class="docutils literal notranslate"><span class="pre">block_type</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> properties:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

 ...

<span class="p">&lt;</span><span class="nt">article</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nb">block</span> <span class="k">in</span> <span class="nv">page.body</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">if</span> <span class="nb">block</span><span class="nv">.block_type</span> <span class="o">==</span> <span class="s1">&#39;heading&#39;</span> <span class="cp">%}</span>
            <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nb">block</span><span class="nv">.value</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
            <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;block-</span><span class="cp">{{</span> <span class="nb">block</span><span class="nv">.block_type</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
                <span class="cp">{%</span> <span class="k">include_block</span> <span class="nb">block</span> <span class="cp">%}</span>
            <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">article</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="combining-blocks">
<h5>Combining blocks<a class="headerlink" href="#combining-blocks" title="Permalink to this headline">¶</a></h5>
<p>In addition to using the built-in block types directly within StreamField, it’s possible to construct new block types by combining sub-blocks in various ways. Examples of this could include:</p>
<ul class="simple">
<li>An “image with caption” block consisting of an image chooser and a text field</li>
<li>A “related links” section, where an author can provide any number of links to other pages</li>
<li>A slideshow block, where each slide may be an image, text or video, arranged in any order</li>
</ul>
<p>Once a new block type has been built up in this way, you can use it anywhere where a built-in block type would be used - including using it as a component for yet another block type. For example, you could define an image gallery block where each item is an “image with caption” block.</p>
<div class="section" id="structblock">
<h6>StructBlock<a class="headerlink" href="#structblock" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> allows you to group several ‘child’ blocks together to be presented as a single block. The child blocks are passed to <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> as a list of <code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">block_type)</span></code> tuples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
<span class="hll">     <span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">([</span>
</span><span class="hll">         <span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
</span><span class="hll">         <span class="p">(</span><span class="s1">&#39;surname&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
</span><span class="hll">         <span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
</span><span class="hll">         <span class="p">(</span><span class="s1">&#39;biography&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
</span><span class="hll">     <span class="p">])),</span>
</span>     <span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)),</span>
     <span class="p">(</span><span class="s1">&#39;paragraph&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
     <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
 <span class="p">])</span>
</pre></div>
</div>
<p>When reading back the content of a StreamField (such as when rendering a template), the value of a StructBlock is a dict-like object with keys corresponding to the block names given in the definition:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">article</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nb">block</span> <span class="k">in</span> <span class="nv">page.body</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">if</span> <span class="nb">block</span><span class="nv">.block_type</span> <span class="o">==</span> <span class="s1">&#39;person&#39;</span> <span class="cp">%}</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;person&quot;</span><span class="p">&gt;</span>
                <span class="cp">{%</span> <span class="k">image</span> <span class="nb">block</span><span class="nv">.value.photo</span> <span class="nv">width-400</span> <span class="cp">%}</span>
                <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nb">block</span><span class="nv">.value.first_name</span> <span class="cp">}}</span> <span class="cp">{{</span> <span class="nb">block</span><span class="nv">.value.surname</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
                <span class="cp">{{</span> <span class="nb">block</span><span class="nv">.value.biography</span> <span class="cp">}}</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
            (rendering for other block types)
        <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">article</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="subclassing-structblock">
<h6>Subclassing <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code><a class="headerlink" href="#subclassing-structblock" title="Permalink to this headline">¶</a></h6>
<p>Placing a StructBlock’s list of child blocks inside a <code class="docutils literal notranslate"><span class="pre">StreamField</span></code> definition can often be hard to read, and makes it difficult for the same block to be reused in multiple places. As an alternative, <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> can be subclassed, with the child blocks defined as attributes on the subclass. The ‘person’ block in the above example could be rewritten as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PersonBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">surname</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">ImageChooserBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">biography</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">PersonBlock</span></code> can then be used in a <code class="docutils literal notranslate"><span class="pre">StreamField</span></code> definition in the same way as the built-in block types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">PersonBlock</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;paragraph&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="block-icons">
<h6>Block icons<a class="headerlink" href="#block-icons" title="Permalink to this headline">¶</a></h6>
<p>In the menu that content authors use to add new blocks to a StreamField, each block type has an associated icon. For StructBlock and other structural block types, a placeholder icon is used, since the purpose of these blocks is specific to your project. To set a custom icon, pass the option <code class="docutils literal notranslate"><span class="pre">icon</span></code> as either a keyword argument to <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code>, or an attribute on a <code class="docutils literal notranslate"><span class="pre">Meta</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
     <span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">([</span>
         <span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
         <span class="p">(</span><span class="s1">&#39;surname&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
         <span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
         <span class="p">(</span><span class="s1">&#39;biography&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
<span class="hll">     <span class="p">],</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)),</span>
</span>     <span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)),</span>
     <span class="p">(</span><span class="s1">&#39;paragraph&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
     <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
 <span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="k">class</span> <span class="nc">PersonBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
     <span class="n">first_name</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
     <span class="n">surname</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
     <span class="n">photo</span> <span class="o">=</span> <span class="n">ImageChooserBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
     <span class="n">biography</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()</span>

<span class="hll">     <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class="hll">         <span class="n">icon</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
</span></pre></div>
</div>
<p>For a list of the recognised icon identifiers, see the <a class="reference internal" href="index.html#styleguide"><span class="std std-ref">UI Styleguide</span></a>.</p>
</div>
<div class="section" id="listblock">
<h6>ListBlock<a class="headerlink" href="#listblock" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">ListBlock</span></code> defines a repeating block, allowing content authors to insert as many instances of a particular block type as they like. For example, a ‘gallery’ block consisting of multiple images can be defined as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
<span class="hll">     <span class="p">(</span><span class="s1">&#39;gallery&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">ListBlock</span><span class="p">(</span><span class="n">ImageChooserBlock</span><span class="p">())),</span>
</span>     <span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)),</span>
     <span class="p">(</span><span class="s1">&#39;paragraph&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
     <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
 <span class="p">])</span>
</pre></div>
</div>
<p>When reading back the content of a StreamField (such as when rendering a template), the value of a ListBlock is a list of child values:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">article</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nb">block</span> <span class="k">in</span> <span class="nv">page.body</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">if</span> <span class="nb">block</span><span class="nv">.block_type</span> <span class="o">==</span> <span class="s1">&#39;gallery&#39;</span> <span class="cp">%}</span>
            <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;gallery&quot;</span><span class="p">&gt;</span>
                <span class="cp">{%</span> <span class="k">for</span> <span class="nv">img</span> <span class="k">in</span> <span class="nb">block</span><span class="nv">.value</span> <span class="cp">%}</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">img</span> <span class="nv">width-400</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
            <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
            (rendering for other block types)
        <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">article</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="streamblock">
<h6>StreamBlock<a class="headerlink" href="#streamblock" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> defines a set of child block types that can be mixed and repeated in any sequence, via the same mechanism as StreamField itself. For example, a carousel that supports both image and video slides could be defined as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
<span class="hll">     <span class="p">(</span><span class="s1">&#39;carousel&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">StreamBlock</span><span class="p">([</span>
</span><span class="hll">         <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
</span><span class="hll">         <span class="p">(</span><span class="s1">&#39;video&#39;</span><span class="p">,</span> <span class="n">EmbedBlock</span><span class="p">()),</span>
</span><span class="hll">     <span class="p">])),</span>
</span>     <span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)),</span>
     <span class="p">(</span><span class="s1">&#39;paragraph&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
     <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
 <span class="p">])</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> can also be subclassed in the same way as <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code>, with the child blocks being specified as attributes on the class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PersonBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StreamBlock</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChooserBlock</span><span class="p">()</span>
    <span class="n">video</span> <span class="o">=</span> <span class="n">EmbedBlock</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s1">&#39;image&#39;</span>
</pre></div>
</div>
<p>A StreamBlock subclass defined in this way can also be passed to a <code class="docutils literal notranslate"><span class="pre">StreamField</span></code> definition, instead of passing a list of block types. This allows setting up a common set of block types to be used on multiple page types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CommonContentBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StreamBlock</span><span class="p">):</span>
    <span class="n">heading</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)</span>
    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChooserBlock</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">(</span><span class="n">CommonContentBlock</span><span class="p">())</span>
</pre></div>
</div>
<p>When reading back the content of a StreamField, the value of a StreamBlock is a sequence of block objects with <code class="docutils literal notranslate"><span class="pre">block_type</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> properties, just like the top-level value of the StreamField itself.</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">article</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nb">block</span> <span class="k">in</span> <span class="nv">page.body</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">if</span> <span class="nb">block</span><span class="nv">.block_type</span> <span class="o">==</span> <span class="s1">&#39;carousel&#39;</span> <span class="cp">%}</span>
            <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;carousel&quot;</span><span class="p">&gt;</span>
                <span class="cp">{%</span> <span class="k">for</span> <span class="nv">slide</span> <span class="k">in</span> <span class="nb">block</span><span class="nv">.value</span> <span class="cp">%}</span>
                    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">slide.block_type</span> <span class="o">==</span> <span class="s1">&#39;image&#39;</span> <span class="cp">%}</span>
                        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;image&quot;</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">slide.value</span> <span class="nv">width-200</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
                        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span> class=&quot;video&quot;&gt;<span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">slide</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
                <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
            <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
            (rendering for other block types)
        <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">article</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="limiting-block-counts">
<h6>Limiting block counts<a class="headerlink" href="#limiting-block-counts" title="Permalink to this headline">¶</a></h6>
<p>By default, a StreamField can contain an unlimited number of blocks. The <code class="docutils literal notranslate"><span class="pre">min_num</span></code> and <code class="docutils literal notranslate"><span class="pre">max_num</span></code> options on <code class="docutils literal notranslate"><span class="pre">StreamField</span></code> or <code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> allow you to set a minimum or maximum number of blocks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;paragraph&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
<span class="p">],</span> <span class="n">min_num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_num</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Or equivalently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CommonContentBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StreamBlock</span><span class="p">):</span>
    <span class="n">heading</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)</span>
    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChooserBlock</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">min_num</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">max_num</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">block_counts</span></code> option can be used to set a minimum or maximum count for specific block types. This accepts a dict, mapping block names to a dict containing either or both of <code class="docutils literal notranslate"><span class="pre">min_num</span></code> and <code class="docutils literal notranslate"><span class="pre">max_num</span></code>. For example, to permit between 1 and 3 ‘heading’ blocks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;paragraph&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
<span class="p">],</span> <span class="n">block_counts</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;heading&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;min_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;max_num&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
<span class="p">})</span>
</pre></div>
</div>
<p>Or equivalently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CommonContentBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StreamBlock</span><span class="p">):</span>
    <span class="n">heading</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)</span>
    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChooserBlock</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">block_counts</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;heading&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;min_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;max_num&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="per-block-templates">
<span id="streamfield-per-block-templates"></span><h5>Per-block templates<a class="headerlink" href="#per-block-templates" title="Permalink to this headline">¶</a></h5>
<p>By default, each block is rendered using simple, minimal HTML markup, or no markup at all. For example, a CharBlock value is rendered as plain text, while a ListBlock outputs its child blocks in a <code class="docutils literal notranslate"><span class="pre">&lt;ul&gt;</span></code> wrapper. To override this with your own custom HTML rendering, you can pass a <code class="docutils literal notranslate"><span class="pre">template</span></code> argument to the block, giving the filename of a template file to be rendered. This is particularly useful for custom block types derived from StructBlock:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
        <span class="p">(</span><span class="s1">&#39;surname&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
        <span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;biography&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
    <span class="p">],</span>
    <span class="n">template</span><span class="o">=</span><span class="s1">&#39;myapp/blocks/person.html&#39;</span><span class="p">,</span>
    <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;user&#39;</span>
<span class="p">))</span>
</pre></div>
</div>
<p>Or, when defined as a subclass of StructBlock:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PersonBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">surname</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">ImageChooserBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">biography</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;myapp/blocks/person.html&#39;</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
</pre></div>
</div>
<p>Within the template, the block value is accessible as the variable <code class="docutils literal notranslate"><span class="pre">value</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailimages_tags</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;person&quot;</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">image</span> <span class="nv">value.photo</span> <span class="nv">width-400</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">value.first_name</span> <span class="cp">}}</span> <span class="cp">{{</span> <span class="nv">value.surname</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">value.biography</span> <span class="cp">}}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">first_name</span></code>, <code class="docutils literal notranslate"><span class="pre">surname</span></code>, <code class="docutils literal notranslate"><span class="pre">photo</span></code> and <code class="docutils literal notranslate"><span class="pre">biography</span></code> are defined as blocks in their own right, this could also be written as:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="nv">wagtailimages_tags</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;person&quot;</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">image</span> <span class="nv">value.photo</span> <span class="nv">width-400</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">value.first_name</span> <span class="cp">%}</span> <span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">value.surname</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">value.biography</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Writing <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">my_block</span> <span class="pre">}}</span></code> is roughly equivalent to <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">my_block</span> <span class="pre">%}</span></code>, but the short form is more restrictive, as it does not pass variables from the calling template such as <code class="docutils literal notranslate"><span class="pre">request</span></code> or <code class="docutils literal notranslate"><span class="pre">page</span></code>; for this reason, it is recommended that you only use it for simple values that do not render HTML of their own. For example, if our PersonBlock used the template:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailimages_tags</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;person&quot;</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">image</span> <span class="nv">value.photo</span> <span class="nv">width-400</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">value.first_name</span> <span class="cp">}}</span> <span class="cp">{{</span> <span class="nv">value.surname</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">request.user.is_authenticated</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span><span class="p">&gt;</span>Contact this person<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

    <span class="cp">{{</span> <span class="nv">value.biography</span> <span class="cp">}}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>then the <code class="docutils literal notranslate"><span class="pre">request.user.is_authenticated</span></code> test would not work correctly when rendering the block through a <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">...</span> <span class="pre">}}</span></code> tag:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="c">{# Incorrect: #}</span>

<span class="cp">{%</span> <span class="k">for</span> <span class="nb">block</span> <span class="k">in</span> <span class="nv">page.body</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nb">block</span><span class="nv">.block_type</span> <span class="o">==</span> <span class="s1">&#39;person&#39;</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="cp">{{</span> <span class="nb">block</span> <span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="c">{# Correct: #}</span>

<span class="cp">{%</span> <span class="k">for</span> <span class="nb">block</span> <span class="k">in</span> <span class="nv">page.body</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nb">block</span><span class="nv">.block_type</span> <span class="o">==</span> <span class="s1">&#39;person&#39;</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">include_block</span> <span class="nb">block</span> <span class="cp">%}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Like Django’s <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">%}</span></code> tag, <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> also allows passing additional variables to the included template, through the syntax <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">my_block</span> <span class="pre">with</span> <span class="pre">foo=&quot;bar&quot;</span> <span class="pre">%}</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="c">{# In page template: #}</span>

<span class="cp">{%</span> <span class="k">for</span> <span class="nb">block</span> <span class="k">in</span> <span class="nv">page.body</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nb">block</span><span class="nv">.block_type</span> <span class="o">==</span> <span class="s1">&#39;person&#39;</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">include_block</span> <span class="nb">block</span> <span class="k">with</span> <span class="nv">classname</span><span class="o">=</span><span class="s2">&quot;important&quot;</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="c">{# In PersonBlock template: #}</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">classname</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
    ...
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The syntax <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">my_block</span> <span class="pre">with</span> <span class="pre">foo=&quot;bar&quot;</span> <span class="pre">only</span> <span class="pre">%}</span></code> is also supported, to specify that no variables from the parent template other than <code class="docutils literal notranslate"><span class="pre">foo</span></code> will be passed to the child template.</p>
<p id="streamfield-get-context">As well as passing variables from the parent template, block subclasses can pass additional template variables of their own by overriding the <code class="docutils literal notranslate"><span class="pre">get_context</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">class</span> <span class="nc">EventBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">DateBlock</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parent_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">parent_context</span><span class="o">=</span><span class="n">parent_context</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;is_happening_today&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">context</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;myapp/blocks/event.html&#39;</span>
</pre></div>
</div>
<p>In this example, the variable <code class="docutils literal notranslate"><span class="pre">is_happening_today</span></code> will be made available within the block template. The <code class="docutils literal notranslate"><span class="pre">parent_context</span></code> keyword argument is available when the block is rendered through an <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> tag, and is a dict of variables passed from the calling template.</p>
<p>All block types, not just <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code>, support the <code class="docutils literal notranslate"><span class="pre">template</span></code> property. However, for blocks that handle basic Python data types, such as <code class="docutils literal notranslate"><span class="pre">CharBlock</span></code> and <code class="docutils literal notranslate"><span class="pre">IntegerBlock</span></code>, there are some limitations on where the template will take effect. For further details, see <a class="reference internal" href="index.html#boundblocks-and-values"><span class="std std-ref">About StreamField BoundBlocks and values</span></a>.</p>
</div>
<div class="section" id="customisations">
<h5>Customisations<a class="headerlink" href="#customisations" title="Permalink to this headline">¶</a></h5>
<p>All block types implement a common API for rendering their front-end and form representations, and storing and retrieving values to and from the database. By subclassing the various block classes and overriding these methods, all kinds of customisations are possible, from modifying the layout of StructBlock form fields to implementing completely new ways of combining blocks. For further details, see <a class="reference internal" href="index.html#custom-streamfield-blocks"><span class="std std-ref">How to build custom StreamField blocks</span></a>.</p>
</div>
<div class="section" id="modifying-streamfield-data">
<span id="id1"></span><h5>Modifying StreamField data<a class="headerlink" href="#modifying-streamfield-data" title="Permalink to this headline">¶</a></h5>
<p>A StreamField’s value behaves as a list, and blocks can be inserted, overwritten and deleted before saving the instance back to the database. A new item can be written to the list as a tuple of <em>(block_type, value)</em> - when read back, it will be returned as a <code class="docutils literal notranslate"><span class="pre">BoundBlock</span></code> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace the first block with a new block of type &#39;heading&#39;</span>
<span class="n">my_page</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span> <span class="s2">&quot;My story&quot;</span><span class="p">)</span>

<span class="c1"># Delete the last block</span>
<span class="k">del</span> <span class="n">my_page</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Append a block to the stream</span>
<span class="n">my_page</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;paragraph&#39;</span><span class="p">,</span> <span class="s2">&quot;&lt;p&gt;And they all lived happily ever after.&lt;/p&gt;&quot;</span><span class="p">))</span>

<span class="c1"># Save the updated data back to the database</span>
<span class="n">my_page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="migrating-richtextfields-to-streamfield">
<span id="streamfield-migrating-richtext"></span><h5>Migrating RichTextFields to StreamField<a class="headerlink" href="#migrating-richtextfields-to-streamfield" title="Permalink to this headline">¶</a></h5>
<p>If you change an existing RichTextField to a StreamField, the database migration will complete with no errors, since both fields use a text column within the database. However, StreamField uses a JSON representation for its data, so the existing text requires an extra conversion step in order to become accessible again. For this to work, the StreamField needs to include a RichTextBlock as one of the available block types. (When updating the model, don’t forget to change <code class="docutils literal notranslate"><span class="pre">FieldPanel</span></code> to <code class="docutils literal notranslate"><span class="pre">StreamFieldPanel</span></code> too.) Create the migration as normal using <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">makemigrations</span></code>, then edit it as follows (in this example, the ‘body’ field of the <code class="docutils literal notranslate"><span class="pre">demo.BlogPage</span></code> model is being converted to a StreamField with a RichTextBlock named <code class="docutils literal notranslate"><span class="pre">rich_text</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">migrations</span>
<span class="kn">from</span> <span class="nn">wagtail.core.rich_text</span> <span class="kn">import</span> <span class="n">RichText</span>


<span class="k">def</span> <span class="nf">convert_to_streamfield</span><span class="p">(</span><span class="n">apps</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">):</span>
    <span class="n">BlogPage</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;demo&quot;</span><span class="p">,</span> <span class="s2">&quot;BlogPage&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">BlogPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">page</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">raw_text</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">page</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="n">page</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;rich_text&#39;</span><span class="p">,</span> <span class="n">RichText</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">raw_text</span><span class="p">))]</span>
            <span class="n">page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">convert_to_richtext</span><span class="p">(</span><span class="n">apps</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">):</span>
    <span class="n">BlogPage</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;demo&quot;</span><span class="p">,</span> <span class="s2">&quot;BlogPage&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">BlogPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">page</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">raw_text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">raw_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="n">child</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">source</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">body</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">block_type</span> <span class="o">==</span> <span class="s1">&#39;rich_text&#39;</span>
            <span class="p">])</span>
            <span class="n">page</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">raw_text</span>
            <span class="n">page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Migration</span><span class="p">(</span><span class="n">migrations</span><span class="o">.</span><span class="n">Migration</span><span class="p">):</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># leave the dependency line from the generated migration intact!</span>
        <span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">,</span> <span class="s1">&#39;0001_initial&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># leave the generated AlterField intact!</span>
        <span class="n">migrations</span><span class="o">.</span><span class="n">AlterField</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;BlogPage&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;body&#39;</span><span class="p">,</span>
            <span class="n">field</span><span class="o">=</span><span class="n">wagtail</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">StreamField</span><span class="p">([(</span><span class="s1">&#39;rich_text&#39;</span><span class="p">,</span> <span class="n">wagtail</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">())]),</span>
        <span class="p">),</span>

        <span class="n">migrations</span><span class="o">.</span><span class="n">RunPython</span><span class="p">(</span>
            <span class="n">convert_to_streamfield</span><span class="p">,</span>
            <span class="n">convert_to_richtext</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Note that the above migration will work on published Page objects only. If you also need to migrate draft pages and page revisions, then edit the migration as in the following example instead:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">django.core.serializers.json</span> <span class="kn">import</span> <span class="n">DjangoJSONEncoder</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">migrations</span><span class="p">,</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">wagtail.core.rich_text</span> <span class="kn">import</span> <span class="n">RichText</span>


<span class="k">def</span> <span class="nf">page_to_streamfield</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">page</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">raw_text</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">page</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
        <span class="n">page</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;rich_text&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;rich_text&#39;</span><span class="p">:</span> <span class="n">RichText</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">raw_text</span><span class="p">)})]</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">page</span><span class="p">,</span> <span class="n">changed</span>


<span class="k">def</span> <span class="nf">pagerevision_to_streamfield</span><span class="p">(</span><span class="n">revision_data</span><span class="p">):</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">revision_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">body</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">revision_data</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="p">[{</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;rich_text&quot;</span><span class="p">:</span> <span class="n">body</span><span class="p">},</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rich_text&quot;</span>
                <span class="p">}],</span>
                <span class="bp">cls</span><span class="o">=</span><span class="n">DjangoJSONEncoder</span><span class="p">)</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># It&#39;s already valid JSON. Leave it.</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">revision_data</span><span class="p">,</span> <span class="n">changed</span>


<span class="k">def</span> <span class="nf">page_to_richtext</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">page</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">raw_text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">raw_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="n">child</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;rich_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">source</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">body</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">block_type</span> <span class="o">==</span> <span class="s1">&#39;rich_text&#39;</span>
        <span class="p">])</span>
        <span class="n">page</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">raw_text</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">page</span><span class="p">,</span> <span class="n">changed</span>


<span class="k">def</span> <span class="nf">pagerevision_to_richtext</span><span class="p">(</span><span class="n">revision_data</span><span class="p">):</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">revision_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;definitely non-JSON string&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">body</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">body_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># It&#39;s not apparently a StreamField. Leave it.</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">raw_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="n">child</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="s1">&#39;rich_text&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">body_data</span>
                <span class="k">if</span> <span class="n">child</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rich_text&#39;</span>
            <span class="p">])</span>
            <span class="n">revision_data</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_text</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">revision_data</span><span class="p">,</span> <span class="n">changed</span>


<span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">apps</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">,</span> <span class="n">page_converter</span><span class="p">,</span> <span class="n">pagerevision_converter</span><span class="p">):</span>
    <span class="n">BlogPage</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;demo&quot;</span><span class="p">,</span> <span class="s2">&quot;BlogPage&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">BlogPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>

        <span class="n">page</span><span class="p">,</span> <span class="n">changed</span> <span class="o">=</span> <span class="n">page_converter</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
            <span class="n">page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">revision</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">revisions</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">revision_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">revision</span><span class="o">.</span><span class="n">content_json</span><span class="p">)</span>
            <span class="n">revision_data</span><span class="p">,</span> <span class="n">changed</span> <span class="o">=</span> <span class="n">pagerevision_converter</span><span class="p">(</span><span class="n">revision_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
                <span class="n">revision</span><span class="o">.</span><span class="n">content_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">revision_data</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">DjangoJSONEncoder</span><span class="p">)</span>
                <span class="n">revision</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">convert_to_streamfield</span><span class="p">(</span><span class="n">apps</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">convert</span><span class="p">(</span><span class="n">apps</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">,</span> <span class="n">page_to_streamfield</span><span class="p">,</span> <span class="n">pagerevision_to_streamfield</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">convert_to_richtext</span><span class="p">(</span><span class="n">apps</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">convert</span><span class="p">(</span><span class="n">apps</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">,</span> <span class="n">page_to_richtext</span><span class="p">,</span> <span class="n">pagerevision_to_richtext</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Migration</span><span class="p">(</span><span class="n">migrations</span><span class="o">.</span><span class="n">Migration</span><span class="p">):</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># leave the dependency line from the generated migration intact!</span>
        <span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">,</span> <span class="s1">&#39;0001_initial&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># leave the generated AlterField intact!</span>
        <span class="n">migrations</span><span class="o">.</span><span class="n">AlterField</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;BlogPage&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;body&#39;</span><span class="p">,</span>
            <span class="n">field</span><span class="o">=</span><span class="n">wagtail</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">StreamField</span><span class="p">([(</span><span class="s1">&#39;rich_text&#39;</span><span class="p">,</span> <span class="n">wagtail</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">())]),</span>
        <span class="p">),</span>

        <span class="n">migrations</span><span class="o">.</span><span class="n">RunPython</span><span class="p">(</span>
            <span class="n">convert_to_streamfield</span><span class="p">,</span>
            <span class="n">convert_to_richtext</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<span id="document-topics/permissions"></span><div class="section" id="permissions">
<span id="id1"></span><h4>Permissions<a class="headerlink" href="#permissions" title="Permalink to this headline">¶</a></h4>
<p>Wagtail adapts and extends <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/auth/default/#topic-authorization" title="(in Django v3.2)"><span class="xref std std-ref">the Django permission system</span></a> to cater for the needs of website content creation, such as moderation workflows, and multiple teams working on different areas of a site (or multiple sites within the same Wagtail installation). Permissions can be configured through the ‘Groups’ area of the Wagtail admin interface, under ‘Settings’.</p>
<div class="section" id="page-permissions">
<h5>Page permissions<a class="headerlink" href="#page-permissions" title="Permalink to this headline">¶</a></h5>
<p>Permissions can be attached at any point in the page tree, and propagate down the tree. For example, if a site had the page tree:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MegaCorp</span><span class="o">/</span>
    <span class="n">About</span> <span class="n">us</span>
    <span class="n">Offices</span><span class="o">/</span>
        <span class="n">UK</span>
        <span class="n">France</span>
        <span class="n">Germany</span>
</pre></div>
</div>
<p>then a group with ‘edit’ permissions on the ‘Offices’ page would automatically receive the ability to edit the ‘UK’, ‘France’ and ‘Germany’ pages. Permissions can be set globally for the entire tree by assigning them on the ‘root’ page - since all pages must exist underneath the root node, and the root cannot be deleted, this permission will cover all pages that exist now and in future.</p>
<p>Whenever a user creates a page through the Wagtail admin, that user is designated as the owner of that page. Any user with ‘add’ permission has the ability to edit pages they own, as well as adding new ones. This is in recognition of the fact that creating pages is typically an iterative process involving creating a number of draft versions - giving a user the ability to create a draft but not letting them subsequently edit it would not be very useful. Ability to edit a page also implies the ability to delete it; unlike Django’s standard permission model, there is no distinct ‘delete’ permission.</p>
<p>The full set of available permission types is as follows:</p>
<ul class="simple">
<li><strong>Add</strong> - grants the ability to create new subpages underneath this page (provided the page model permits this - see <a class="reference internal" href="index.html#page-type-business-rules"><span class="std std-ref">Parent page / subpage type rules</span></a>), and to edit and delete pages owned by the current user. Published pages cannot be deleted unless the user also has ‘publish’ permission.</li>
<li><strong>Edit</strong> - grants the ability to edit and delete this page, and any pages underneath it, regardless of ownership. A user with only ‘edit’ permission may not create new pages, only edit existing ones. Published pages cannot be deleted unless the user also has ‘publish’ permission.</li>
<li><strong>Publish</strong> - grants the ability to publish and unpublish this page and/or its children. A user without publish permission cannot directly make changes that are visible to visitors of the website; instead, they must submit their changes for moderation. Publish permission is independent of edit permission; a user with only publish permission will not be able to make any edits of their own.</li>
<li><strong>Bulk delete</strong> - allows a user to delete pages that have descendants, in a single operation. Without this permission, a user has to delete the descendant pages individually before deleting the parent. This is a safeguard against accidental deletion. This permission must be used in conjunction with ‘add’ / ‘edit’ permission, as it does not provide any deletion rights of its own; it only provides a ‘shortcut’ for the permissions the user has already. For example, a user with just ‘add’ and ‘bulk delete’ permissions will only be able to bulk-delete if all the affected pages are owned by that user, and are unpublished.</li>
<li><strong>Lock</strong> - grants the ability to lock or unlock this page (and any pages underneath it) for editing, preventing users from making any further edits to it.</li>
</ul>
<p>Drafts can be viewed only if the user has either Edit or Publish permission.</p>
</div>
<div class="section" id="image-document-permissions">
<span id="id2"></span><h5>Image / document permissions<a class="headerlink" href="#image-document-permissions" title="Permalink to this headline">¶</a></h5>
<p>The permission rules for images and documents work on a similar basis to pages. Images and documents are considered to be ‘owned’ by the user who uploaded them; a user with ‘add’ permission also has the ability to edit items they own; and deletion is considered equivalent to editing rather than having a specific permission type.</p>
<p>Access to specific sets of images and documents can be controlled by setting up <em>collections</em>. By default all images and documents belong to the ‘root’ collection, but new collections can be created through the Settings -&gt; Collections area of the admin interface. Permissions set on ‘root’ apply to all collections, so a user with ‘edit’ permission for images on root can edit all images; permissions set on other collections apply to that collection only.</p>
<p>The ‘choose’ permission for images and documents determines which collections are visible within the chooser interface used to select images and document links for insertion into pages (and other models, such as snippets). Typically, all users are granted choose permission for all collections, allowing them to use any uploaded image or document on pages they create, but this permission can be limited to allow creating collections that are only available for use by specific groups.</p>
</div>
</div>
</div>
</div>
<span id="document-advanced_topics/index"></span><div class="section" id="advanced-topics">
<h3>Advanced topics<a class="headerlink" href="#advanced-topics" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-advanced_topics/images/index"></span><div class="section" id="images">
<h4>Images<a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-advanced_topics/images/renditions"></span><div class="section" id="generating-renditions-in-python">
<span id="image-renditions"></span><h5>Generating renditions in Python<a class="headerlink" href="#generating-renditions-in-python" title="Permalink to this headline">¶</a></h5>
<p>Rendered versions of original images generated by the Wagtail <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> template tag are called “renditions”,
and are stored as new image files in the site’s <code class="docutils literal notranslate"><span class="pre">[media]/images</span></code> directory on the first invocation.</p>
<p>Image renditions can also be generated dynamically from Python via the native <code class="docutils literal notranslate"><span class="pre">get_rendition()</span></code> method, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">newimage</span> <span class="o">=</span> <span class="n">myimage</span><span class="o">.</span><span class="n">get_rendition</span><span class="p">(</span><span class="s1">&#39;fill-300x150|jpegquality-60&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">myimage</span></code> had a filename of <code class="docutils literal notranslate"><span class="pre">foo.jpg</span></code>, a new rendition of the image file called
<code class="docutils literal notranslate"><span class="pre">foo.fill-300x150.jpegquality-60.jpg</span></code> would be generated and saved into the site’s <code class="docutils literal notranslate"><span class="pre">[media]/images</span></code> directory.
Argument options are identical to the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> template tag’s filter spec, and should be separated with <code class="docutils literal notranslate"><span class="pre">|</span></code>.</p>
<p>The generated <code class="docutils literal notranslate"><span class="pre">Rendition</span></code> object will have properties specific to that version of the image, such as
<code class="docutils literal notranslate"><span class="pre">url</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code> and <code class="docutils literal notranslate"><span class="pre">height</span></code>, so something like this could be used in an API generator, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="n">myimage</span><span class="o">.</span><span class="n">get_rendition</span><span class="p">(</span><span class="s1">&#39;fill-300x186|jpegquality-60&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">url</span>
</pre></div>
</div>
<p>Properties belonging to the original image from which the generated Rendition was created, such as <code class="docutils literal notranslate"><span class="pre">title</span></code>, can
be accessed through the Rendition’s <code class="docutils literal notranslate"><span class="pre">image</span></code> property:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">newimage</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">title</span>
<span class="go">&#39;Blue Sky&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">newimage</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">is_landscape</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>See also: <a class="reference internal" href="index.html#image-tag"><span class="std std-ref">How to use images in templates</span></a></p>
</div>
<span id="document-advanced_topics/images/animated_gifs"></span><div class="section" id="animated-gif-support">
<h5>Animated GIF support<a class="headerlink" href="#animated-gif-support" title="Permalink to this headline">¶</a></h5>
<p>Pillow, Wagtail’s default image library, doesn’t support animated
GIFs.</p>
<p>To get animated GIF support, you will have to
<a class="reference external" href="http://docs.wand-py.org/en/0.4.2/guide/install.html">install Wand</a>.
Wand is a binding to ImageMagick so make sure that has been installed as well.</p>
<p>When installed, Wagtail will automatically use Wand for resizing GIF
files but continue to resize other images with Pillow.</p>
</div>
<span id="document-advanced_topics/images/image_file_formats"></span><div class="section" id="image-file-formats">
<span id="id1"></span><h5>Image file formats<a class="headerlink" href="#image-file-formats" title="Permalink to this headline">¶</a></h5>
<div class="section" id="using-the-picture-element">
<h6>Using the picture element<a class="headerlink" href="#using-the-picture-element" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/picture">picture element</a>
can be used with the <code class="docutils literal notranslate"><span class="pre">format-&lt;type&gt;</span></code> image operation to specify different
image formats and let the browser choose the one it prefers. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">wagtailimages_tags</span> <span class="o">%</span><span class="p">}</span>

<span class="o">&lt;</span><span class="n">picture</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">%</span> <span class="n">image</span> <span class="n">myimage</span> <span class="n">width</span><span class="o">-</span><span class="mi">1000</span> <span class="nb">format</span><span class="o">-</span><span class="n">webp</span> <span class="k">as</span> <span class="n">image_webp</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">source</span> <span class="n">srcset</span><span class="o">=</span><span class="s2">&quot;{{ image_webp.url }}&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;image/webp&quot;</span><span class="o">&gt;</span>

    <span class="p">{</span><span class="o">%</span> <span class="n">image</span> <span class="n">myimage</span> <span class="n">width</span><span class="o">-</span><span class="mi">1000</span> <span class="nb">format</span><span class="o">-</span><span class="n">png</span> <span class="k">as</span> <span class="n">image_png</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">source</span> <span class="n">srcset</span><span class="o">=</span><span class="s2">&quot;{{ image_png.url }}&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;image/png&quot;</span><span class="o">&gt;</span>

    <span class="p">{</span><span class="o">%</span> <span class="n">image</span> <span class="n">myimage</span> <span class="n">width</span><span class="o">-</span><span class="mi">1000</span> <span class="nb">format</span><span class="o">-</span><span class="n">png</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;/</span><span class="n">picture</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="customizing-output-formats">
<h6>Customizing output formats<a class="headerlink" href="#customizing-output-formats" title="Permalink to this headline">¶</a></h6>
<p>By default all <code class="docutils literal notranslate"><span class="pre">bmp</span></code> and <code class="docutils literal notranslate"><span class="pre">webp</span></code> images are converted to the <code class="docutils literal notranslate"><span class="pre">png</span></code> format
when no image output format is given.</p>
<p>The default conversion mapping can be changed by setting the
<code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_FORMAT_CONVERSIONS</span></code> to a dictionary which maps the input type
to an output type.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILIMAGES_FORMAT_CONVERSIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;bmp&#39;</span><span class="p">:</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;webp&#39;</span><span class="p">:</span> <span class="s1">&#39;webp&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>will convert <code class="docutils literal notranslate"><span class="pre">bmp</span></code> images to <code class="docutils literal notranslate"><span class="pre">jpeg</span></code> and disable the default <code class="docutils literal notranslate"><span class="pre">webp</span></code>
to <code class="docutils literal notranslate"><span class="pre">png</span></code> conversion.</p>
</div>
</div>
<span id="document-advanced_topics/images/custom_image_model"></span><div class="section" id="custom-image-models">
<span id="custom-image-model"></span><h5>Custom image models<a class="headerlink" href="#custom-image-models" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">Image</span></code> model can be customised, allowing additional fields to be added
to images.</p>
<p>To do this, you need to add two models to your project:</p>
<ul class="simple">
<li>The image model itself that inherits from <code class="docutils literal notranslate"><span class="pre">wagtail.images.models.AbstractImage</span></code>. This is where you would add your additional fields</li>
<li>The renditions model that inherits from <code class="docutils literal notranslate"><span class="pre">wagtail.images.models.AbstractRendition</span></code>. This is used to store renditions for the new model.</li>
</ul>
<p>Here’s an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># models.py</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">wagtail.images.models</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">AbstractImage</span><span class="p">,</span> <span class="n">AbstractRendition</span>


<span class="k">class</span> <span class="nc">CustomImage</span><span class="p">(</span><span class="n">AbstractImage</span><span class="p">):</span>
    <span class="c1"># Add any extra fields to image here</span>

    <span class="c1"># eg. To add a caption field:</span>
    <span class="c1"># caption = models.CharField(max_length=255, blank=True)</span>

    <span class="n">admin_form_fields</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">admin_form_fields</span> <span class="o">+</span> <span class="p">(</span>
        <span class="c1"># Then add the field names here to make them appear in the form:</span>
        <span class="c1"># &#39;caption&#39;,</span>
    <span class="p">)</span>


<span class="k">class</span> <span class="nc">CustomRendition</span><span class="p">(</span><span class="n">AbstractRendition</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">CustomImage</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;renditions&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;filter_spec&#39;</span><span class="p">,</span> <span class="s1">&#39;focal_point_key&#39;</span><span class="p">),</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>Then set the <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_IMAGE_MODEL</span></code> setting to point to it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILIMAGES_IMAGE_MODEL</span> <span class="o">=</span> <span class="s1">&#39;images.CustomImage&#39;</span>
</pre></div>
</div>
<div class="topic">
<p class="topic-title">Migrating from the builtin image model</p>
<p>When changing an existing site to use a custom image model, no images will
be copied to the new model automatically. Copying old images to the new
model would need to be done manually with a
<a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/migrations/#data-migrations" title="(in Django v3.2)"><span class="xref std std-ref">data migration</span></a>.</p>
<p>Any templates that reference the builtin image model will still continue to
work as before but would need to be updated in order to see any new images.</p>
</div>
<div class="section" id="module-wagtail.images">
<span id="referring-to-the-image-model"></span><span id="custom-image-model-referring-to-image-model"></span><h6>Referring to the image model<a class="headerlink" href="#module-wagtail.images" title="Permalink to this headline">¶</a></h6>
<dl class="function">
<dt id="wagtail.images.get_image_model">
<code class="descclassname">wagtail.images.</code><code class="descname">get_image_model</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.images.get_image_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the image model from the <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_IMAGE_MODEL</span></code> setting.
Useful for developers making Wagtail plugins that need the image model.
Defaults to the standard <code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code> model
if no custom model is defined.</p>
</dd></dl>

<dl class="function">
<dt id="wagtail.images.get_image_model_string">
<code class="descclassname">wagtail.images.</code><code class="descname">get_image_model_string</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.images.get_image_model_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the dotted <code class="docutils literal notranslate"><span class="pre">app.Model</span></code> name for the image model as a string.
Useful for developers making Wagtail plugins that need to refer to the
image model, such as in foreign keys, but the model itself is not required.</p>
</dd></dl>

</div>
</div>
<span id="document-advanced_topics/images/changing_rich_text_representation"></span><div class="section" id="changing-rich-text-representation">
<span id="id1"></span><h5>Changing rich text representation<a class="headerlink" href="#changing-rich-text-representation" title="Permalink to this headline">¶</a></h5>
<p>The HTML representation of an image in rich text can be customised - for example, to display captions or custom fields.</p>
<p>To do this requires subclassing <code class="docutils literal notranslate"><span class="pre">Format</span></code> (see <a class="reference internal" href="index.html#rich-text-image-formats"><span class="std std-ref">Image Formats in the Rich Text Editor</span></a>), and overriding its <code class="docutils literal notranslate"><span class="pre">image_to_html</span></code> method.</p>
<p>You may then register formats of your subclass using <code class="docutils literal notranslate"><span class="pre">register_image_format</span></code> as usual.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># image_formats.py</span>
<span class="kn">from</span> <span class="nn">wagtail.images.formats</span> <span class="kn">import</span> <span class="n">Format</span><span class="p">,</span> <span class="n">register_image_format</span>


<span class="k">class</span> <span class="nc">SubclassedImageFormat</span><span class="p">(</span><span class="n">Format</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">image_to_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">alt_text</span><span class="p">,</span> <span class="n">extra_attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">custom_html</span> <span class="o">=</span> <span class="c1"># the custom HTML representation of your image here</span>
                      <span class="c1"># in Format, the image&#39;s rendition.img_tag(extra_attributes) is used to generate the HTML</span>
                      <span class="c1"># representation</span>

        <span class="k">return</span> <span class="n">custom_html</span>


<span class="n">register_image_format</span><span class="p">(</span>
    <span class="n">SubclassedImageFormat</span><span class="p">(</span><span class="s1">&#39;subclassed_format&#39;</span><span class="p">,</span> <span class="s1">&#39;Subclassed Format&#39;</span><span class="p">,</span> <span class="n">classnames</span><span class="p">,</span> <span class="n">filter_spec</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>As an example, let’s say you want the alt text to be displayed as a caption for the image as well:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># image_formats.py</span>
<span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>
<span class="kn">from</span> <span class="nn">wagtail.images.formats</span> <span class="kn">import</span> <span class="n">Format</span><span class="p">,</span> <span class="n">register_image_format</span>


<span class="k">class</span> <span class="nc">CaptionedImageFormat</span><span class="p">(</span><span class="n">Format</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">image_to_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">alt_text</span><span class="p">,</span> <span class="n">extra_attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">default_html</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">image_to_html</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">alt_text</span><span class="p">,</span> <span class="n">extra_attributes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&lt;figcaption&gt;</span><span class="si">{}</span><span class="s2">&lt;/figcaption&gt;&quot;</span><span class="p">,</span> <span class="n">default_html</span><span class="p">,</span> <span class="n">alt_text</span><span class="p">)</span>


<span class="n">register_image_format</span><span class="p">(</span>
    <span class="n">CaptionedImageFormat</span><span class="p">(</span><span class="s1">&#39;captioned_fullwidth&#39;</span><span class="p">,</span> <span class="s1">&#39;Full width captioned&#39;</span><span class="p">,</span> <span class="s1">&#39;bodytext-image&#39;</span><span class="p">,</span> <span class="s1">&#39;width-750&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any custom HTML image features will not be displayed in the Draftail editor, only on the published page.</p>
</div>
</div>
<span id="document-advanced_topics/images/feature_detection"></span><div class="section" id="feature-detection">
<span id="image-feature-detection"></span><h5>Feature Detection<a class="headerlink" href="#feature-detection" title="Permalink to this headline">¶</a></h5>
<p>Wagtail has the ability to automatically detect faces and features inside your images and crop the images to those features.</p>
<p>Feature detection uses third-party tools to detect faces/features in an image when the image is uploaded. The detected features are stored internally as a focal point in the <code class="docutils literal notranslate"><span class="pre">focal_point_{x,</span> <span class="pre">y,</span> <span class="pre">width,</span> <span class="pre">height}</span></code> fields on the <code class="docutils literal notranslate"><span class="pre">Image</span></code> model. These fields are used by the <code class="docutils literal notranslate"><span class="pre">fill</span></code> image filter when an image is rendered in a template to crop the image.</p>
<div class="section" id="installation">
<h6>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h6>
<p>Two third-party tools are known to work with Wagtail: One based on <a class="reference external" href="https://opencv.org/">OpenCV</a> for general feature detection and one based on <a class="reference external" href="https://github.com/torchbox/rustface-py/">Rustface</a> for face detection.</p>
<div class="section" id="opencv-on-debian-ubuntu">
<h7>OpenCV on Debian/Ubuntu<a class="headerlink" href="#opencv-on-debian-ubuntu" title="Permalink to this headline">¶</a></h7>
<p>Feature detection requires <a class="reference external" href="https://opencv.org/">OpenCV</a> which can be a bit tricky to install as it’s not currently pip-installable.</p>
<p>There is more than one way to install these components, but in each case you will need to test that both OpenCV itself <em>and</em> the Python interface have been correctly installed.</p>
<div class="section" id="install-opencv-python">
<h8>Install <code class="docutils literal notranslate"><span class="pre">opencv-python</span></code><a class="headerlink" href="#install-opencv-python" title="Permalink to this headline">¶</a></h8>
<p><a class="reference external" href="https://pypi.org/project/opencv-python/">opencv-python</a> is available on PyPI.
It includes a Python interface to OpenCV, as well as the statically-built OpenCV binaries themselves.</p>
<p>To install:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip install opencv-python
</pre></div>
</div>
<p>Depending on what else is installed on your system, this may be all that is required. On lighter-weight Linux systems, you may need to identify and install missing system libraries (for example, a slim version of Debian Stretch requires <code class="docutils literal notranslate"><span class="pre">libsm6</span> <span class="pre">libxrender1</span> <span class="pre">libxext6</span></code> to be installed with <code class="docutils literal notranslate"><span class="pre">apt</span></code>).</p>
</div>
<div class="section" id="install-a-system-level-package">
<h8>Install a system-level package<a class="headerlink" href="#install-a-system-level-package" title="Permalink to this headline">¶</a></h8>
<p>A system-level package can take care of all of the required components. Check what is available for your operating system. For example, <a class="reference external" href="https://packages.debian.org/stretch/python-opencv">python-opencv</a> is available for Debian; it installs OpenCV itself, and sets up Python bindings.</p>
<p>However, it may make incorrect assumptions about how you’re using Python (for example, which version you’re using) - test as described below.</p>
</div>
<div class="section" id="testing-the-installation">
<h8>Testing the installation<a class="headerlink" href="#testing-the-installation" title="Permalink to this headline">¶</a></h8>
<p>Test the installation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">cv2</span>
</pre></div>
</div>
<p>An error such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">ImportError</span><span class="p">:</span> <span class="n">libSM</span><span class="o">.</span><span class="n">so</span><span class="mf">.6</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="nb">object</span> <span class="n">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span>
</pre></div>
</div>
<p>indicates that a required system library (in this case <code class="docutils literal notranslate"><span class="pre">libsm6</span></code>) has not been installed.</p>
<p>On the other hand,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">ModuleNotFoundError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">&#39;cv2&#39;</span>
</pre></div>
</div>
<p>means that the Python components have not been set up correctly in your Python environment.</p>
<p>If you don’t get an import error, installation has probably been successful.</p>
</div>
</div>
<div class="section" id="id1">
<h7>Rustface<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h7>
<p><a class="reference external" href="https://github.com/torchbox/rustface-py/">Rustface</a> is Python library with prebuilt wheel files provided for Linux and macOS. Although implemented in Rust it is pip-installable:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip install wheel
<span class="gp">$ </span>pip install rustface
</pre></div>
</div>
<div class="section" id="registering-with-willow">
<h8>Registering with Willow<a class="headerlink" href="#registering-with-willow" title="Permalink to this headline">¶</a></h8>
<p>Rustface provides a plug-in that needs to be registered with <a class="reference external" href="https://github.com/wagtail/Willow">Willow</a>.</p>
<p>This should be done somewhere that gets run on application startup:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">willow.registry</span> <span class="kn">import</span> <span class="n">registry</span>
<span class="kn">import</span> <span class="nn">rustface.willow</span>

<span class="n">registry</span><span class="o">.</span><span class="n">register_plugin</span><span class="p">(</span><span class="n">rustface</span><span class="o">.</span><span class="n">willow</span><span class="p">)</span>
</pre></div>
</div>
<p>For example, in an app’s <a class="reference external" href="https://docs.djangoproject.com/en/2.2/ref/applications/#django.apps.AppConfig.ready">AppConfig.ready</a>.</p>
</div>
</div>
</div>
<div class="section" id="cropping">
<h6>Cropping<a class="headerlink" href="#cropping" title="Permalink to this headline">¶</a></h6>
<p>The face detection algorithm produces a focal area that is tightly cropped to the face rather than the whole head.</p>
<p>For images with a single face this can be okay in some cases, e.g. thumbnails, it might be overly tight for “headshots”.
Image renditions can encompass more of the head by reducing the crop percentage (<code class="docutils literal notranslate"><span class="pre">-c&lt;percentage&gt;</span></code>), at the end of the resize-rule, down to as low as 0%:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.photo</span> <span class="nv">fill-200x200-c0</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="switching-on-feature-detection-in-wagtail">
<h6>Switching on feature detection in Wagtail<a class="headerlink" href="#switching-on-feature-detection-in-wagtail" title="Permalink to this headline">¶</a></h6>
<p>Once installed, you need to set the <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_FEATURE_DETECTION_ENABLED</span></code> setting to <code class="docutils literal notranslate"><span class="pre">True</span></code> to automatically detect faces/features whenever a new image is uploaded in to Wagtail or when an image without a focal point is saved (this is done via a pre-save signal handler):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># settings.py</span>

<span class="n">WAGTAILIMAGES_FEATURE_DETECTION_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="manually-running-feature-detection">
<h6>Manually running feature detection<a class="headerlink" href="#manually-running-feature-detection" title="Permalink to this headline">¶</a></h6>
<p>If you already have images in your Wagtail site and would like to run feature detection on them, or you want to apply feature detection selectively when the <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_FEATURE_DETECTION_ENABLED</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code> you can run it manually using the <cite>get_suggested_focal_point()</cite> method on the <code class="docutils literal notranslate"><span class="pre">Image</span></code> model.</p>
<p>For example, you can manually run feature detection on all images by running the following code in the python shell:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.images</span> <span class="kn">import</span> <span class="n">get_image_model</span>

<span class="n">Image</span> <span class="o">=</span> <span class="n">get_image_model</span><span class="p">()</span>

<span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">Image</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">image</span><span class="o">.</span><span class="n">has_focal_point</span><span class="p">():</span>
        <span class="n">image</span><span class="o">.</span><span class="n">set_focal_point</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">get_suggested_focal_point</span><span class="p">())</span>
        <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<span id="document-advanced_topics/images/image_serve_view"></span><div class="section" id="dynamic-image-serve-view">
<span id="using-images-outside-wagtail"></span><h5>Dynamic image serve view<a class="headerlink" href="#dynamic-image-serve-view" title="Permalink to this headline">¶</a></h5>
<p>In most cases, developers wanting to generate image renditions in Python should use the <code class="docutils literal notranslate"><span class="pre">get_rendition()</span></code>
method. See <a class="reference internal" href="index.html#image-renditions"><span class="std std-ref">Generating renditions in Python</span></a>.</p>
<p>If you need to be able to generate image versions for an <em>external</em> system such as a blog or mobile app,
Wagtail provides a view for dynamically generating renditions of images by calling a unique URL.</p>
<p>The view takes an image id, filter spec and security signature in the URL. If
these parameters are valid, it serves an image file matching that criteria.</p>
<p>Like the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag, the rendition is generated on the first call and
subsequent calls are served from a cache.</p>
<div class="section" id="setup">
<h6>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h6>
<p>Add an entry for the view into your URLs configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.images.views.serve</span> <span class="kn">import</span> <span class="n">ServeView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>

    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^images/([^/]*)/(\d*)/([^/]*)/[^/]*$&#39;</span><span class="p">,</span> <span class="n">ServeView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;wagtailimages_serve&#39;</span><span class="p">),</span>

    <span class="o">...</span>

    <span class="c1"># Ensure that the wagtailimages_serve line appears above the default Wagtail page serving route</span>
    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtail_urls</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h6>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h6>
<div class="section" id="image-url-generator-ui">
<h7>Image URL generator UI<a class="headerlink" href="#image-url-generator-ui" title="Permalink to this headline">¶</a></h7>
<p>When the dynamic serve view is enabled, an image URL generator in the admin
interface becomes available automatically. This can be accessed through the edit
page of any image by clicking the “URL generator” button on the right hand side.</p>
<p>This interface allows editors to generate URLs to cropped versions of the image.</p>
</div>
<div class="section" id="generating-dynamic-image-urls-in-python">
<h7>Generating dynamic image URLs in Python<a class="headerlink" href="#generating-dynamic-image-urls-in-python" title="Permalink to this headline">¶</a></h7>
<p>Dynamic image URLs can also be generated using Python code and served to a
client over an API or used directly in the template.</p>
<p>One advantage of using dynamic image URLs in the template is that they do not
block the initial response while rendering like the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag does.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">generate_image_url</span></code> function in <code class="docutils literal notranslate"><span class="pre">wagtail.images.views.serve</span></code> is a convenience
method to generate a dynamic image URL.</p>
<p>Here’s an example of this being used in a view:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">display_image</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">image_id</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Image</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">image_id</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;display_image.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;image_url&#39;</span><span class="p">:</span> <span class="n">generate_image_url</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s1">&#39;fill-100x100&#39;</span><span class="p">)</span>
    <span class="p">})</span>
</pre></div>
</div>
<p>Image operations can be chained by joining them with a <code class="docutils literal notranslate"><span class="pre">|</span></code> character:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;display_image.html&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;image_url&#39;</span><span class="p">:</span> <span class="n">generate_image_url</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s1">&#39;fill-100x100|jpegquality-40&#39;</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
</div>
<p>In your templates:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailimages_tags</span> <span class="cp">%}</span>
...

<span class="c">&lt;!-- Get the url for the image scaled to a width of 400 pixels: --&gt;</span>
<span class="cp">{%</span> <span class="k">image_url</span> <span class="nv">page.photo</span> <span class="s2">&quot;width-400&quot;</span> <span class="cp">%}</span>

<span class="c">&lt;!-- Again, but this time as a square thumbnail: --&gt;</span>
<span class="cp">{%</span> <span class="k">image_url</span> <span class="nv">page.photo</span> <span class="s2">&quot;fill-100x100|jpegquality-40&quot;</span> <span class="cp">%}</span>

<span class="c">&lt;!-- This time using our custom image serve view: --&gt;</span>
<span class="cp">{%</span> <span class="k">image_url</span> <span class="nv">page.photo</span> <span class="s2">&quot;width-400&quot;</span> <span class="s2">&quot;mycustomview_serve&quot;</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>You can pass an optional view name that will be used to serve the image through. The default is <code class="docutils literal notranslate"><span class="pre">wagtailimages_serve</span></code></p>
</div>
</div>
<div class="section" id="advanced-configuration">
<h6>Advanced configuration<a class="headerlink" href="#advanced-configuration" title="Permalink to this headline">¶</a></h6>
<div class="section" id="making-the-view-redirect-instead-of-serve">
<span id="image-serve-view-redirect-action"></span><h7>Making the view redirect instead of serve<a class="headerlink" href="#making-the-view-redirect-instead-of-serve" title="Permalink to this headline">¶</a></h7>
<p>By default, the view will serve the image file directly. This behaviour can be
changed to a 301 redirect instead which may be useful if you host your images
externally.</p>
<p>To enable this, pass <code class="docutils literal notranslate"><span class="pre">action='redirect'</span></code> into the <code class="docutils literal notranslate"><span class="pre">ServeView.as_view()</span></code>
method in your urls configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.images.views.serve</span> <span class="kn">import</span> <span class="n">ServeView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>

    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^images/([^/]*)/(\d*)/([^/]*)/[^/]*$&#39;</span><span class="p">,</span> <span class="n">ServeView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;redirect&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;wagtailimages_serve&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="integration-with-django-sendfile">
<span id="image-serve-view-sendfile"></span><h7>Integration with django-sendfile<a class="headerlink" href="#integration-with-django-sendfile" title="Permalink to this headline">¶</a></h7>
<p><a class="reference external" href="https://github.com/johnsensible/django-sendfile">django-sendfile</a> offloads the job of transferring the image data to the web
server instead of serving it directly from the Django application. This could
greatly reduce server load in situations where your site has many images being
downloaded but you’re unable to use a <a class="reference internal" href="index.html#caching-proxy"><span class="std std-ref">Caching proxy</span></a> or a CDN.</p>
<p>You firstly need to install and configure django-sendfile and configure your
web server to use it. If you haven’t done this already, please refer to the
<a class="reference external" href="https://github.com/johnsensible/django-sendfile#django-sendfile">installation docs</a>.</p>
<p>To serve images with django-sendfile, you can use the <code class="docutils literal notranslate"><span class="pre">SendFileView</span></code> class.
This view can be used out of the box:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.images.views.serve</span> <span class="kn">import</span> <span class="n">SendFileView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>

    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^images/([^/]*)/(\d*)/([^/]*)/[^/]*$&#39;</span><span class="p">,</span> <span class="n">SendFileView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;wagtailimages_serve&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>You can customise it to override the backend defined in the <code class="docutils literal notranslate"><span class="pre">SENDFILE_BACKEND</span></code>
setting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.images.views.serve</span> <span class="kn">import</span> <span class="n">SendFileView</span>
<span class="kn">from</span> <span class="nn">project.sendfile_backends</span> <span class="kn">import</span> <span class="n">MyCustomBackend</span>

<span class="k">class</span> <span class="nc">MySendFileView</span><span class="p">(</span><span class="n">SendFileView</span><span class="p">):</span>
    <span class="n">backend</span> <span class="o">=</span> <span class="n">MyCustomBackend</span>
</pre></div>
</div>
<p>You can also customise it to serve private files. For example, if the only need
is to be authenticated (e.g. for Django &gt;= 1.9):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.mixins</span> <span class="kn">import</span> <span class="n">LoginRequiredMixin</span>
<span class="kn">from</span> <span class="nn">wagtail.images.views.serve</span> <span class="kn">import</span> <span class="n">SendFileView</span>

<span class="k">class</span> <span class="nc">PrivateSendFileView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">SendFileView</span><span class="p">):</span>
    <span class="n">raise_exception</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-advanced_topics/images/focal_points"></span><div class="section" id="focal-points">
<h5>Focal points<a class="headerlink" href="#focal-points" title="Permalink to this headline">¶</a></h5>
<p>Focal points are used to indicate to Wagtail the area of an image that contains the subject.
This is used by the <code class="docutils literal notranslate"><span class="pre">fill</span></code> filter to focus the cropping on the subject, and avoid cropping into it.</p>
<p>Focal points can be defined manually by a Wagtail user, or automatically by using face or feature detection.</p>
<div class="section" id="setting-the-background-position-inline-style-based-on-the-focal-point">
<span id="rendition-background-position-style"></span><h6>Setting the <code class="docutils literal notranslate"><span class="pre">background-position</span></code> inline style based on the focal point<a class="headerlink" href="#setting-the-background-position-inline-style-based-on-the-focal-point" title="Permalink to this headline">¶</a></h6>
<p>When using a Wagtail image as the background of an element, you can use the <code class="docutils literal notranslate"><span class="pre">.background_position_style</span></code>
attribute on the rendition to position the rendition based on the focal point in the image:</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">image</span> <span class="nv">page.image</span> <span class="nv">width-1024</span> <span class="k">as</span> <span class="nv">image</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;background-image: url(&#39;</span><span class="cp">{{</span> <span class="nv">image.url</span> <span class="cp">}}</span><span class="s">&#39;); </span><span class="cp">{{</span> <span class="nv">image.background_position_style</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-the-focal-point-in-templates">
<h6>Accessing the focal point in templates<a class="headerlink" href="#accessing-the-focal-point-in-templates" title="Permalink to this headline">¶</a></h6>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.14.</span></p>
</div>
<p>You can access the focal point in the template by accessing the <code class="docutils literal notranslate"><span class="pre">.focal_point</span></code> attribute of a rendition:</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailimages</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">image</span> <span class="nv">myimage</span> <span class="nv">width-800</span> <span class="k">as</span> <span class="nv">myrendition</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">img</span>
    <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">myrendition.url</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="na">alt</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">myimage.title</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">myrendition.focal_point</span> <span class="cp">%}</span>
        <span class="na">data-focus-x</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">myrendition.focal_point.centroid.x</span> <span class="cp">}}</span><span class="s">&quot;</span>
        <span class="na">data-focus-y</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">myrendition.focal_point.centroid.y</span> <span class="cp">}}</span><span class="s">&quot;</span>
        <span class="na">data-focus-width</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">myrendition.focal_point.width</span> <span class="cp">}}</span><span class="s">&quot;</span>
        <span class="na">data-focus-height</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">myrendition.focal_point.height</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="p">/&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-advanced_topics/documents/index"></span><div class="section" id="documents">
<h4>Documents<a class="headerlink" href="#documents" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-advanced_topics/documents/custom_document_model"></span><div class="section" id="custom-document-model">
<span id="id1"></span><h5>Custom document model<a class="headerlink" href="#custom-document-model" title="Permalink to this headline">¶</a></h5>
<p>An alternate <code class="docutils literal notranslate"><span class="pre">Document</span></code> model can be used to add custom behaviour and
additional fields.</p>
<p>You need to complete the following steps in your project to do this:</p>
<ul class="simple">
<li>Create a new document model that inherits from
<code class="docutils literal notranslate"><span class="pre">wagtail.documents.models.AbstractDocument</span></code>. This is where you would
add additional fields.</li>
<li>Point <code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_DOCUMENT_MODEL</span></code> to the new model.</li>
</ul>
<p>Here’s an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># models.py</span>
<span class="kn">from</span> <span class="nn">wagtail.documents.models</span> <span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">AbstractDocument</span>

<span class="k">class</span> <span class="nc">CustomDocument</span><span class="p">(</span><span class="n">AbstractDocument</span><span class="p">):</span>
    <span class="c1"># Custom field example:</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">admin_form_fields</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">admin_form_fields</span> <span class="o">+</span> <span class="p">(</span>
        <span class="c1"># Add all custom fields names to make them appear in the form:</span>
        <span class="s1">&#39;source&#39;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Then in your settings module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ensure that you replace app_label with the app you placed your custom</span>
<span class="c1"># model in.</span>
<span class="n">WAGTAILDOCS_DOCUMENT_MODEL</span> <span class="o">=</span> <span class="s1">&#39;app_label.CustomDocument&#39;</span>
</pre></div>
</div>
<div class="topic">
<p class="topic-title">Migrating from the builtin document model</p>
<p>When changing an existing site to use a custom document model, no documents
will be copied to the new model automatically. Copying old documents to the
new model would need to be done manually with a
<a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/migrations/#data-migrations" title="(in Django v3.2)"><span class="xref std std-ref">data migration</span></a>.</p>
<p>Any templates that reference the builtin document model will still continue
to work as before.</p>
</div>
<div class="section" id="module-wagtail.documents">
<span id="referring-to-the-document-model"></span><h6>Referring to the document model<a class="headerlink" href="#module-wagtail.documents" title="Permalink to this headline">¶</a></h6>
<dl class="function">
<dt id="wagtail.documents.get_document_model">
<code class="descclassname">wagtail.documents.</code><code class="descname">get_document_model</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.documents.get_document_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the document model from the <code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_DOCUMENT_MODEL</span></code> setting.
Defaults to the standard <code class="xref py py-class docutils literal notranslate"><span class="pre">Document</span></code> model
if no custom model is defined.</p>
</dd></dl>

<dl class="function">
<dt id="wagtail.documents.get_document_model_string">
<code class="descclassname">wagtail.documents.</code><code class="descname">get_document_model_string</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.documents.get_document_model_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the dotted <code class="docutils literal notranslate"><span class="pre">app.Model</span></code> name for the document model as a string.
Useful for developers making Wagtail plugins that need to refer to the
document model, such as in foreign keys, but the model itself is not required.</p>
</dd></dl>

</div>
</div>
</div>
</div>
<span id="document-advanced_topics/embeds"></span><div class="section" id="embedded-content">
<span id="id1"></span><h4>Embedded content<a class="headerlink" href="#embedded-content" title="Permalink to this headline">¶</a></h4>
<p>Wagtail supports generating embed code from URLs to content on external
providers such as Youtube or Twitter. By default, Wagtail will fetch the embed
code directly from the relevant provider’s site using the oEmbed protocol.</p>
<p>Wagtail has a built-in list of the most common providers and this list can be
changed <a class="reference internal" href="#customising-embed-providers"><span class="std std-ref">with a setting</span></a>. Wagtail also supports
fetching embed code using <a class="reference internal" href="#embedly">Embedly</a> and <a class="reference internal" href="#custom-embed-finders"><span class="std std-ref">custom embed finders</span></a>.</p>
<div class="section" id="embedding-content-on-your-site">
<h5>Embedding content on your site<a class="headerlink" href="#embedding-content-on-your-site" title="Permalink to this headline">¶</a></h5>
<p>Wagtail’s embeds module should work straight out of the box for most providers.
You can use any of the following methods to call the module:</p>
<div class="section" id="rich-text">
<h6>Rich text<a class="headerlink" href="#rich-text" title="Permalink to this headline">¶</a></h6>
<p>Wagtail’s default rich text editor has a “media” icon that allows embeds to be
placed into rich text. You don’t have to do anything to enable this; just make
sure the rich text field’s content is being passed through the <code class="docutils literal notranslate"><span class="pre">|richtext</span></code>
filter in the template as this is what calls the embeds module to fetch and
nest the embed code.</p>
</div>
<div class="section" id="embedblock-streamfield-block-type">
<h6><code class="docutils literal notranslate"><span class="pre">EmbedBlock</span></code> StreamField block type<a class="headerlink" href="#embedblock-streamfield-block-type" title="Permalink to this headline">¶</a></h6>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">EmbedBlock</span></code> block type allows embeds
to be placed into a <code class="docutils literal notranslate"><span class="pre">StreamField</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">max_width</span></code> and <code class="docutils literal notranslate"><span class="pre">max_height</span></code> arguments are sent to the provider when fetching the embed code.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.embeds.blocks</span> <span class="kn">import</span> <span class="n">EmbedBlock</span>

<span class="k">class</span> <span class="nc">MyStreamField</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StreamBlock</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">embed</span> <span class="o">=</span> <span class="n">EmbedBlock</span><span class="p">(</span><span class="n">max_width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">max_height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="embed-tag">
<h6><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">embed</span> <span class="pre">%}</span></code> tag<a class="headerlink" href="#embed-tag" title="Permalink to this headline">¶</a></h6>
<p>Syntax: <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">embed</span> <span class="pre">&lt;url&gt;</span> <span class="pre">[max_width=&lt;max</span> <span class="pre">width&gt;]</span> <span class="pre">%}</span></code></p>
<p>You can nest embeds into a template by passing the URL and an optional
<code class="docutils literal notranslate"><span class="pre">max_width</span></code> argument to the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">embed</span> <span class="pre">%}</span></code> tag.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">max_width</span></code> argument is sent to the provider when fetching the embed code.</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailembeds_tags</span> <span class="cp">%}</span>

<span class="c">{# Embed a YouTube video #}</span>
<span class="cp">{%</span> <span class="k">embed</span> <span class="s1">&#39;https://www.youtube.com/watch?v=Ffu-2jEdLPw&#39;</span> <span class="cp">%}</span>

<span class="c">{# This tag can also take the URL from a variable #}</span>
<span class="cp">{%</span> <span class="k">embed</span> <span class="nv">page.video_url</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="from-python">
<h6>From Python<a class="headerlink" href="#from-python" title="Permalink to this headline">¶</a></h6>
<p>You can also call the internal <code class="docutils literal notranslate"><span class="pre">get_embed</span></code> function that takes a URL string
and returns an <code class="docutils literal notranslate"><span class="pre">Embed</span></code> object (see model documentation below). This also
takes a <code class="docutils literal notranslate"><span class="pre">max_width</span></code> keyword argument that is sent to the provider when
fetching the embed code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.embeds.embeds</span> <span class="kn">import</span> <span class="n">get_embed</span>
<span class="kn">from</span> <span class="nn">wagtail.embeds.exceptions</span> <span class="kn">import</span> <span class="n">EmbedException</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">embed</span> <span class="o">=</span> <span class="n">get_embed</span><span class="p">(</span><span class="s1">&#39;https://www.youtube.com/watch?v=Ffu-2jEdLPw&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">embed</span><span class="o">.</span><span class="n">html</span><span class="p">)</span>
<span class="k">except</span> <span class="n">EmbedException</span><span class="p">:</span>
    <span class="c1"># Cannot find embed</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuring-embed-finders">
<span id="id2"></span><h5>Configuring embed “finders”<a class="headerlink" href="#configuring-embed-finders" title="Permalink to this headline">¶</a></h5>
<p>Embed finders are the modules within Wagtail that are responsible for producing
embed code from a URL.</p>
<p>Embed finders are configured using the <code class="docutils literal notranslate"><span class="pre">WAGTAILEMBEDS_FINDERS</span></code> setting. This
is a list of finder configurations that are each run in order until one of them
successfully returns an embed:</p>
<p>The default configuration is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILEMBEDS_FINDERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.embeds.finders.oembed&#39;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="oembed-default">
<span id="oembed"></span><h6>oEmbed (default)<a class="headerlink" href="#oembed-default" title="Permalink to this headline">¶</a></h6>
<p>The default embed finder fetches the embed code directly from the content
provider using the oEmbed protocol. Wagtail has a built-in list of providers
which are all enabled by default. You can find that provider list at the
following link:</p>
<p><a class="reference external" href="https://github.com/wagtail/wagtail/blob/main/wagtail/embeds/oembed_providers.py">https://github.com/wagtail/wagtail/blob/main/wagtail/embeds/oembed_providers.py</a></p>
<div class="section" id="customising-the-provider-list">
<span id="customising-embed-providers"></span><h7>Customising the provider list<a class="headerlink" href="#customising-the-provider-list" title="Permalink to this headline">¶</a></h7>
<p>You can limit which providers may be used by specifying the list of providers
in the finder configuration.</p>
<p>For example, this configuration will only allow content to be nested from Vimeo
and Youtube. It also adds a custom provider:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.embeds.oembed_providers</span> <span class="kn">import</span> <span class="n">youtube</span><span class="p">,</span> <span class="n">vimeo</span>

<span class="c1"># Add a custom provider</span>
<span class="c1"># Your custom provider must support oEmbed for this to work. You should be</span>
<span class="c1"># able to find these details in the provider&#39;s documentation.</span>
<span class="c1"># - &#39;endpoint&#39; is the URL of the oEmbed endpoint that Wagtail will call</span>
<span class="c1"># - &#39;urls&#39; specifies which patterns</span>
<span class="n">my_custom_provider</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;endpoint&#39;</span><span class="p">:</span> <span class="s1">&#39;https://customvideosite.com/oembed&#39;</span><span class="p">,</span>
    <span class="s1">&#39;urls&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;^http(?:s)?://(?:www</span><span class="se">\\</span><span class="s1">.)?customvideosite</span><span class="se">\\</span><span class="s1">.com/[^#?/]+/videos/.+$&#39;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">WAGTAILEMBEDS_FINDERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.embeds.finders.oembed&#39;</span><span class="p">,</span>
        <span class="s1">&#39;providers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">youtube</span><span class="p">,</span> <span class="n">vimeo</span><span class="p">,</span> <span class="n">my_custom_provider</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="customising-an-individual-provider">
<h7>Customising an individual provider<a class="headerlink" href="#customising-an-individual-provider" title="Permalink to this headline">¶</a></h7>
<p>Multiple finders can be chained together. This can be used for customising the
configuration for one provider without affecting the others.</p>
<p>For example, this is how you can instruct Youtube to return videos in HTTPS
(which must be done explicitly for YouTube):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.embeds.oembed_providers</span> <span class="kn">import</span> <span class="n">youtube</span>


<span class="n">WAGTAILEMBEDS_FINDERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Fetches YouTube videos but puts ``?scheme=https`` in the GET parameters</span>
    <span class="c1"># when calling YouTube&#39;s oEmbed endpoint</span>
    <span class="p">{</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.embeds.finders.oembed&#39;</span><span class="p">,</span>
        <span class="s1">&#39;providers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">youtube</span><span class="p">],</span>
        <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;scheme&#39;</span><span class="p">:</span> <span class="s1">&#39;https&#39;</span><span class="p">}</span>
    <span class="p">},</span>

    <span class="c1"># Handles all other oEmbed providers the default way</span>
    <span class="p">{</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.embeds.finders.oembed&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="topic">
<p class="topic-title">How Wagtail uses multiple finders</p>
<p>If multiple providers can handle a URL (for example, a YouTube video was
requested using the configuration above), the topmost finder is chosen to
perform the request.</p>
<p>Wagtail will not try to run any other finder, even if the chosen one didn’t
return an embed.</p>
</div>
</div>
</div>
<div class="section" id="facebook-and-instagram">
<span id="facebook-and-instagram-embeds"></span><h6>Facebook and Instagram<a class="headerlink" href="#facebook-and-instagram" title="Permalink to this headline">¶</a></h6>
<p>As of October 2020, Facebook deprecated their public oEmbed APIs. If you would
like to embed Facebook or Instagram posts in your site, you will need to
use the new authenticated APIs. This requires you to set up a Facebook
Developer Account and create a Facebook App that includes the <cite>oEmbed Product</cite>.
Instructions for creating the necessary app are in the requirements sections of the
<a class="reference external" href="https://developers.facebook.com/docs/plugins/oembed">Facebook</a>
and <a class="reference external" href="https://developers.facebook.com/docs/instagram/oembed">Instagram</a> documentation.</p>
<p>As of June 2021, the <cite>oEmbed Product</cite> has been replaced with the <cite>oEmbed Read</cite>
feature. In order to embed Facebook and Instagram posts your app must activate
the <cite>oEmbed Read</cite> feature. Furthermore the app must be reviewed and accepted
by Facebook. You can find the announcement in the <a class="reference external" href="https://developers.facebook.com/docs/graph-api/changelog/version11.0/#oembed">API changelog</a>.</p>
<p>Apps that activated the oEmbed Product before June 8, 2021 need to activate
the oEmbed Read feature and review their app before September 7, 2021.</p>
<p>Once you have your app access tokens (App ID and App Secret), add the Facebook and/or
Instagram finders to your <code class="docutils literal notranslate"><span class="pre">WAGTAILEMBEDS_FINDERS</span></code> setting and configure them with
the App ID and App Secret from your app:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILEMBEDS_FINDERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.embeds.finders.facebook&#39;</span><span class="p">,</span>
        <span class="s1">&#39;app_id&#39;</span><span class="p">:</span> <span class="s1">&#39;YOUR FACEBOOK APP_ID HERE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;app_secret&#39;</span><span class="p">:</span> <span class="s1">&#39;YOUR FACEBOOK APP_SECRET HERE&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.embeds.finders.instagram&#39;</span><span class="p">,</span>
        <span class="s1">&#39;app_id&#39;</span><span class="p">:</span> <span class="s1">&#39;YOUR INSTAGRAM APP_ID HERE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;app_secret&#39;</span><span class="p">:</span> <span class="s1">&#39;YOUR INSTAGRAM APP_SECRET HERE&#39;</span><span class="p">,</span>
    <span class="p">},</span>

    <span class="c1"># Handles all other oEmbed providers the default way</span>
    <span class="p">{</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.embeds.finders.oembed&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>By default, Facebook and Instagram embeds include some JavaScript that is necessary to
fully render the embed. In certain cases, this might not be something you want - for
example, if you have multiple Facebook embeds, this would result in multiple script tags.
By passing <code class="docutils literal notranslate"><span class="pre">'omitscript':</span> <span class="pre">True</span></code> in the configuration, you can indicate that these script
tags should be omitted from the embed HTML. Note that you will then have to take care of
loading this script yourself.</p>
</div>
<div class="section" id="embed-ly">
<span id="embedly"></span><h6>Embed.ly<a class="headerlink" href="#embed-ly" title="Permalink to this headline">¶</a></h6>
<p><a class="reference external" href="https://embed.ly">Embed.ly</a> is a paid-for service that can also provide
embeds for sites that do not implement the oEmbed protocol.</p>
<p>They also provide some helpful features such as giving embeds a consistent look
and a common video playback API which is useful if your site allows videos to
be hosted on different providers and you need to implement custom controls for
them.</p>
<p>Wagtail has built in support for fetching embeds from Embed.ly. To use it,
first pip install the <code class="docutils literal notranslate"><span class="pre">Embedly</span></code> <a class="reference external" href="https://pypi.org/project/Embedly/">python package</a>.</p>
<p>Now add an embed finder to your <code class="docutils literal notranslate"><span class="pre">WAGTAILEMBEDS_FINDERS</span></code> setting that uses the
<code class="docutils literal notranslate"><span class="pre">wagtail.embeds.finders.oembed</span></code> class and pass it your API key:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILEMBEDS_FINDERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.embeds.finders.embedly&#39;</span><span class="p">,</span>
        <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;YOUR EMBED.LY KEY HERE&#39;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-embed-finder-classes">
<span id="custom-embed-finders"></span><h6>Custom embed finder classes<a class="headerlink" href="#custom-embed-finder-classes" title="Permalink to this headline">¶</a></h6>
<p>For complete control, you can create a custom finder class.</p>
<p>Here’s a stub finder class that could be used as a skeleton; please read the
docstrings for details of what each method does:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.embeds.finders.base</span> <span class="kn">import</span> <span class="n">EmbedFinder</span>


<span class="k">class</span> <span class="nc">ExampleFinder</span><span class="p">(</span><span class="n">EmbedFinder</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if this finder knows how to fetch an embed for the URL.</span>

<span class="sd">        This should not have any side effects (no requests to external servers)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">find_embed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes a URL and max width and returns a dictionary of information about the</span>
<span class="sd">        content to be used for embedding it on the site.</span>

<span class="sd">        This is the part that may make requests to external APIs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Perform the request</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Title of the content&quot;</span><span class="p">,</span>
            <span class="s1">&#39;author_name&#39;</span><span class="p">:</span> <span class="s2">&quot;Author name&quot;</span><span class="p">,</span>
            <span class="s1">&#39;provider_name&#39;</span><span class="p">:</span> <span class="s2">&quot;Provider name (eg. YouTube, Vimeo, etc)&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s2">&quot;Either &#39;photo&#39;, &#39;video&#39;, &#39;link&#39; or &#39;rich&#39;&quot;</span><span class="p">,</span>
            <span class="s1">&#39;thumbnail_url&#39;</span><span class="p">:</span> <span class="s2">&quot;URL to thumbnail image&quot;</span><span class="p">,</span>
            <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">width_in_pixels</span><span class="p">,</span>
            <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="n">height_in_pixels</span><span class="p">,</span>
            <span class="s1">&#39;html&#39;</span><span class="p">:</span> <span class="s2">&quot;&lt;h2&gt;The Embed HTML&lt;/h2&gt;&quot;</span><span class="p">,</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Once you’ve implemented all of those methods, you just need to add it to your
<code class="docutils literal notranslate"><span class="pre">WAGTAILEMBEDS_FINDERS</span></code> setting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILEMBEDS_FINDERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;path.to.your.finder.class.here&#39;</span><span class="p">,</span>
        <span class="c1"># Any other options will be passed as kwargs to the __init__ method</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-embed-model">
<h5>The <code class="docutils literal notranslate"><span class="pre">Embed</span></code> model<a class="headerlink" href="#the-embed-model" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="wagtail.embeds.models.Embed">
<em class="property">class </em><code class="descclassname">wagtail.embeds.models.</code><code class="descname">Embed</code><a class="headerlink" href="#wagtail.embeds.models.Embed" title="Permalink to this definition">¶</a></dt>
<dd><p>Embeds are fetched only once and stored in the database so subsequent requests
for an individual embed do not hit the embed finders again.</p>
<dl class="attribute">
<dt id="wagtail.embeds.models.Embed.url">
<code class="descname">url</code><a class="headerlink" href="#wagtail.embeds.models.Embed.url" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The URL of the original content of this embed.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.embeds.models.Embed.max_width">
<code class="descname">max_width</code><a class="headerlink" href="#wagtail.embeds.models.Embed.max_width" title="Permalink to this definition">¶</a></dt>
<dd><p>(integer, nullable)</p>
<p>The max width that was requested.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.embeds.models.Embed.type">
<code class="descname">type</code><a class="headerlink" href="#wagtail.embeds.models.Embed.type" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The type of the embed. This can be either ‘video’, ‘photo’, ‘link’ or ‘rich’.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.embeds.models.Embed.html">
<code class="descname">html</code><a class="headerlink" href="#wagtail.embeds.models.Embed.html" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The HTML content of the embed that should be placed on the page</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.embeds.models.Embed.title">
<code class="descname">title</code><a class="headerlink" href="#wagtail.embeds.models.Embed.title" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The title of the content that is being embedded.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.embeds.models.Embed.author_name">
<code class="descname">author_name</code><a class="headerlink" href="#wagtail.embeds.models.Embed.author_name" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The author name of the content that is being embedded.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.embeds.models.Embed.provider_name">
<code class="descname">provider_name</code><a class="headerlink" href="#wagtail.embeds.models.Embed.provider_name" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The provider name of the content that is being embedded.</p>
<p>For example: YouTube, Vimeo</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.embeds.models.Embed.thumbnail_url">
<code class="descname">thumbnail_url</code><a class="headerlink" href="#wagtail.embeds.models.Embed.thumbnail_url" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>a URL to a thumbnail image of the content that is being embedded.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.embeds.models.Embed.width">
<code class="descname">width</code><a class="headerlink" href="#wagtail.embeds.models.Embed.width" title="Permalink to this definition">¶</a></dt>
<dd><p>(integer, nullable)</p>
<p>The width of the embed (images and videos only).</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.embeds.models.Embed.height">
<code class="descname">height</code><a class="headerlink" href="#wagtail.embeds.models.Embed.height" title="Permalink to this definition">¶</a></dt>
<dd><p>(integer, nullable)</p>
<p>The height of the embed (images and videos only).</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.embeds.models.Embed.last_updated">
<code class="descname">last_updated</code><a class="headerlink" href="#wagtail.embeds.models.Embed.last_updated" title="Permalink to this definition">¶</a></dt>
<dd><p>(datetime)</p>
<p>The Date/time when this embed was last fetched.</p>
</dd></dl>

</dd></dl>

<div class="section" id="deleting-embeds">
<h6>Deleting embeds<a class="headerlink" href="#deleting-embeds" title="Permalink to this headline">¶</a></h6>
<p>As long as your embeds configuration is not broken, deleting items in the
<code class="docutils literal notranslate"><span class="pre">Embed</span></code> model should be perfectly safe to do. Wagtail will automatically
repopulate the records that are being used on the site.</p>
<p>You may want to do this if you’ve changed from oEmbed to Embedly or vice-versa
as the embed code they generate may be slightly different and lead to
inconsistency on your site.</p>
</div>
</div>
</div>
<span id="document-advanced_topics/add_to_django_project"></span><div class="section" id="how-to-add-wagtail-into-an-existing-django-project">
<h4>How to add Wagtail into an existing Django project<a class="headerlink" href="#how-to-add-wagtail-into-an-existing-django-project" title="Permalink to this headline">¶</a></h4>
<p>To install Wagtail completely from scratch, create a new Django project and an app within that project. For instructions on these tasks, see <a class="reference external" href="https://docs.djangoproject.com/en/stable/intro/tutorial01/" title="(in Django v3.2)"><span class="xref std std-doc">Writing your first Django app</span></a>. Your project directory will look like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myproject</span><span class="o">/</span>
    <span class="n">myproject</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">py</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">py</span>
        <span class="n">wsgi</span><span class="o">.</span><span class="n">py</span>
    <span class="n">myapp</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">models</span><span class="o">.</span><span class="n">py</span>
        <span class="n">tests</span><span class="o">.</span><span class="n">py</span>
        <span class="n">admin</span><span class="o">.</span><span class="n">py</span>
        <span class="n">views</span><span class="o">.</span><span class="n">py</span>
    <span class="n">manage</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>From your app directory, you can safely remove <code class="docutils literal notranslate"><span class="pre">admin.py</span></code> and <code class="docutils literal notranslate"><span class="pre">views.py</span></code>, since Wagtail will provide this functionality for your models. Configuring Django to load Wagtail involves adding modules and variables to <code class="docutils literal notranslate"><span class="pre">settings.py</span></code> and URL configuration to <code class="docutils literal notranslate"><span class="pre">urls.py</span></code>. For a more complete view of what’s defined in these files, see <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/settings/" title="(in Django v3.2)"><span class="xref std std-doc">Django Settings</span></a> and <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/http/urls/" title="(in Django v3.2)"><span class="xref std std-doc">Django URL Dispatcher</span></a>.</p>
<p>What follows is a settings reference which skips many boilerplate Django settings. If you just want to get your Wagtail install up quickly without fussing with settings at the moment, see <a class="reference internal" href="#complete-example-config"><span class="std std-ref">Ready to Use Example Configuration Files</span></a>.</p>
<div class="section" id="middleware-settings-py">
<h5>Middleware (<code class="docutils literal notranslate"><span class="pre">settings.py</span></code>)<a class="headerlink" href="#middleware-settings-py" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
  <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
  <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
  <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
  <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
  <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
  <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>

  <span class="s1">&#39;wagtail.contrib.redirects.middleware.RedirectMiddleware&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Wagtail depends on the default set of Django middleware modules, to cover basic security and functionality such as login sessions. One additional middleware module is provided:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">RedirectMiddleware</span></code></dt>
<dd>Wagtail provides a simple interface for adding arbitrary redirects to your site and this module makes it happen.</dd>
</dl>
</div>
<div class="section" id="apps-settings-py">
<h5>Apps (<code class="docutils literal notranslate"><span class="pre">settings.py</span></code>)<a class="headerlink" href="#apps-settings-py" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>

  <span class="s1">&#39;myapp&#39;</span><span class="p">,</span>  <span class="c1"># your own app</span>

  <span class="s1">&#39;wagtail.contrib.forms&#39;</span><span class="p">,</span>
  <span class="s1">&#39;wagtail.contrib.redirects&#39;</span><span class="p">,</span>
  <span class="s1">&#39;wagtail.embeds&#39;</span><span class="p">,</span>
  <span class="s1">&#39;wagtail.sites&#39;</span><span class="p">,</span>
  <span class="s1">&#39;wagtail.users&#39;</span><span class="p">,</span>
  <span class="s1">&#39;wagtail.snippets&#39;</span><span class="p">,</span>
  <span class="s1">&#39;wagtail.documents&#39;</span><span class="p">,</span>
  <span class="s1">&#39;wagtail.images&#39;</span><span class="p">,</span>
  <span class="s1">&#39;wagtail.search&#39;</span><span class="p">,</span>
  <span class="s1">&#39;wagtail.admin&#39;</span><span class="p">,</span>
  <span class="s1">&#39;wagtail.core&#39;</span><span class="p">,</span>

  <span class="s1">&#39;taggit&#39;</span><span class="p">,</span>
  <span class="s1">&#39;modelcluster&#39;</span><span class="p">,</span>

  <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
  <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
  <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
  <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
  <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Wagtail requires several Django app modules, third-party apps, and defines several apps of its own. Wagtail was built to be modular, so many Wagtail apps can be omitted to suit your needs. Your own app (here <code class="docutils literal notranslate"><span class="pre">myapp</span></code>) is where you define your models, templates, static assets, template tags, and other custom functionality for your site.</p>
<div class="section" id="wagtail-apps">
<h6>Wagtail Apps<a class="headerlink" href="#wagtail-apps" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">wagtail.core</span></code></dt>
<dd>The core functionality of Wagtail, such as the <code class="docutils literal notranslate"><span class="pre">Page</span></code> class, the Wagtail tree, and model fields.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wagtail.admin</span></code></dt>
<dd>The administration interface for Wagtail, including page edit handlers.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wagtail.documents</span></code></dt>
<dd>The Wagtail document content type.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wagtail.snippets</span></code></dt>
<dd>Editing interface for non-Page models and objects. See <a class="reference internal" href="index.html#snippets"><span class="std std-ref">Snippets</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wagtail.users</span></code></dt>
<dd>User editing interface.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wagtail.images</span></code></dt>
<dd>The Wagtail image content type.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wagtail.embeds</span></code></dt>
<dd>Module governing oEmbed and Embedly content in Wagtail rich text fields. See <a class="reference internal" href="index.html#inserting-videos"><span class="std std-ref">Inserting videos into body content</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wagtail.search</span></code></dt>
<dd>Search framework for Page content. See <a class="reference internal" href="index.html#wagtailsearch"><span class="std std-ref">Search</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wagtail.sites</span></code></dt>
<dd>Management UI for Wagtail sites.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wagtail.contrib.redirects</span></code></dt>
<dd>Admin interface for creating arbitrary redirects on your site.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wagtail.contrib.forms</span></code></dt>
<dd>Models for creating forms on your pages and viewing submissions. See <a class="reference internal" href="index.html#form-builder"><span class="std std-ref">Form builder</span></a>.</dd>
</dl>
</div>
<div class="section" id="third-party-apps">
<h6>Third-Party Apps<a class="headerlink" href="#third-party-apps" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">taggit</span></code></dt>
<dd>Tagging framework for Django. This is used internally within Wagtail for image and document tagging and is available for your own models as well. See <a class="reference internal" href="index.html#tagging"><span class="std std-ref">Tagging</span></a> for a Wagtail model recipe or the <a class="reference external" href="https://django-taggit.readthedocs.org/en/latest/index.html">Taggit Documentation</a>.</dd>
</dl>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">modelcluster</span></code></dt>
<dd>Extension of Django ForeignKey relation functionality, which is used in Wagtail pages for on-the-fly related object creation. For more information, see <a class="reference internal" href="index.html#inline-panels"><span class="std std-ref">Inline Panels and Model Clusters</span></a> or <a class="reference external" href="https://github.com/torchbox/django-modelcluster">the django-modelcluster github project page</a>.</dd>
</dl>
</div>
</div>
<div class="section" id="url-patterns">
<h5>URL Patterns<a class="headerlink" href="#url-patterns" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">urls</span> <span class="k">as</span> <span class="n">wagtail_urls</span>
<span class="kn">from</span> <span class="nn">wagtail.admin</span> <span class="kn">import</span> <span class="n">urls</span> <span class="k">as</span> <span class="n">wagtailadmin_urls</span>
<span class="kn">from</span> <span class="nn">wagtail.documents</span> <span class="kn">import</span> <span class="n">urls</span> <span class="k">as</span> <span class="n">wagtaildocs_urls</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;django-admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>

    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtailadmin_urls</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;documents/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtaildocs_urls</span><span class="p">)),</span>

    <span class="c1"># Optional URL for including your own vanilla Django urls/views</span>
    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;myapp.urls&#39;</span><span class="p">)),</span>

    <span class="c1"># For anything not caught by a more specific rule above, hand over to</span>
    <span class="c1"># Wagtail&#39;s serving mechanism</span>
    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtail_urls</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This block of code for your project’s <code class="docutils literal notranslate"><span class="pre">urls.py</span></code> does a few things:</p>
<ul class="simple">
<li>Load the vanilla Django admin interface to <code class="docutils literal notranslate"><span class="pre">/django-admin/</span></code></li>
<li>Load the Wagtail admin and its various apps</li>
<li>Dispatch any vanilla Django apps you’re using other than Wagtail which require their own URL configuration (this is optional, since Wagtail might be all you need)</li>
<li>Lets Wagtail handle any further URL dispatching.</li>
</ul>
<p>That’s not everything you might want to include in your project’s URL configuration, but it’s what’s necessary for Wagtail to flourish.</p>
</div>
<div class="section" id="ready-to-use-example-configuration-files">
<span id="complete-example-config"></span><h5>Ready to Use Example Configuration Files<a class="headerlink" href="#ready-to-use-example-configuration-files" title="Permalink to this headline">¶</a></h5>
<p>These two files should reside in your project directory (<code class="docutils literal notranslate"><span class="pre">myproject/myproject/</span></code>).</p>
<div class="section" id="settings-py">
<h6><code class="docutils literal notranslate"><span class="pre">settings.py</span></code><a class="headerlink" href="#settings-py" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">PROJECT_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">PROJECT_DIR</span><span class="p">)</span>

<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Application definition</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;myapp&#39;</span><span class="p">,</span>

    <span class="s1">&#39;wagtail.contrib.forms&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wagtail.contrib.redirects&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wagtail.embeds&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wagtail.sites&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wagtail.users&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wagtail.snippets&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wagtail.documents&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wagtail.images&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wagtail.search&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wagtail.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wagtail.core&#39;</span><span class="p">,</span>

    <span class="s1">&#39;taggit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;modelcluster&#39;</span><span class="p">,</span>

    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>

    <span class="s1">&#39;wagtail.contrib.redirects.middleware.RedirectMiddleware&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s1">&#39;myproject.urls&#39;</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROJECT_DIR</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s1">&#39;myproject.wsgi.application&#39;</span>

<span class="c1"># Database</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.postgresql&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;myprojectdb&#39;</span><span class="p">,</span>
        <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># Set to empty string for localhost.</span>
        <span class="s1">&#39;PORT&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># Set to empty string for default.</span>
        <span class="s1">&#39;CONN_MAX_AGE&#39;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span>  <span class="c1"># number of seconds database connections should persist for</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Internationalization</span>

<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s1">&#39;en-us&#39;</span>
<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s1">&#39;UTC&#39;</span>
<span class="n">USE_I18N</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">USE_L10N</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">USE_TZ</span> <span class="o">=</span> <span class="kc">True</span>


<span class="c1"># Static files (CSS, JavaScript, Images)</span>

<span class="n">STATICFILES_FINDERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.staticfiles.finders.FileSystemFinder&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles.finders.AppDirectoriesFinder&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROJECT_DIR</span><span class="p">,</span> <span class="s1">&#39;static&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;static&#39;</span><span class="p">)</span>
<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;/static/&#39;</span>

<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;media&#39;</span><span class="p">)</span>
<span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s1">&#39;/media/&#39;</span>


<span class="n">ADMINS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># (&#39;Your Name&#39;, &#39;your_email@example.com&#39;),</span>
<span class="p">]</span>
<span class="n">MANAGERS</span> <span class="o">=</span> <span class="n">ADMINS</span>

<span class="c1"># Default to dummy email backend. Configure dev/production/local backend</span>
<span class="c1"># as per https://docs.djangoproject.com/en/stable/topics/email/#email-backends</span>
<span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="s1">&#39;django.core.mail.backends.dummy.EmailBackend&#39;</span>

<span class="c1"># Hosts/domain names that are valid for this site; required if DEBUG is False</span>
<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Make this unique, and don&#39;t share it with anybody.</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;change-me&#39;</span>

<span class="n">EMAIL_SUBJECT_PREFIX</span> <span class="o">=</span> <span class="s1">&#39;[Wagtail] &#39;</span>

<span class="n">INTERNAL_IPS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.2.2&#39;</span><span class="p">)</span>

<span class="c1"># A sample logging configuration. The only tangible logging</span>
<span class="c1"># performed by this configuration is to send an email to</span>
<span class="c1"># the site admins on every HTTP 500 error when DEBUG=False.</span>
<span class="c1"># See https://docs.djangoproject.com/en/stable/topics/logging for</span>
<span class="c1"># more details on how to customize your logging configuration.</span>
<span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;require_debug_false&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;()&#39;</span><span class="p">:</span> <span class="s1">&#39;django.utils.log.RequireDebugFalse&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;mail_admins&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;require_debug_false&#39;</span><span class="p">],</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;django.utils.log.AdminEmailHandler&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;django.request&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mail_admins&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;propagate&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1"># WAGTAIL SETTINGS</span>

<span class="c1"># This is the human-readable name of your Wagtail install</span>
<span class="c1"># which welcomes users upon login to the Wagtail admin.</span>
<span class="n">WAGTAIL_SITE_NAME</span> <span class="o">=</span> <span class="s1">&#39;My Project&#39;</span>

<span class="c1"># Replace the search backend</span>
<span class="c1">#WAGTAILSEARCH_BACKENDS = {</span>
<span class="c1">#  &#39;default&#39;: {</span>
<span class="c1">#    &#39;BACKEND&#39;: &#39;wagtail.search.backends.elasticsearch5&#39;,</span>
<span class="c1">#    &#39;INDEX&#39;: &#39;myapp&#39;</span>
<span class="c1">#  }</span>
<span class="c1">#}</span>

<span class="c1"># Wagtail email notifications from address</span>
<span class="c1"># WAGTAILADMIN_NOTIFICATION_FROM_EMAIL = &#39;wagtail@myhost.io&#39;</span>

<span class="c1"># Wagtail email notification format</span>
<span class="c1"># WAGTAILADMIN_NOTIFICATION_USE_HTML = True</span>

<span class="c1"># Reverse the default case-sensitive handling of tags</span>
<span class="n">TAGGIT_CASE_INSENSITIVE</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="urls-py">
<h6><code class="docutils literal notranslate"><span class="pre">urls.py</span></code><a class="headerlink" href="#urls-py" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">re_path</span>
<span class="kn">from</span> <span class="nn">django.conf.urls.static</span> <span class="kn">import</span> <span class="n">static</span>
<span class="kn">from</span> <span class="nn">django.views.generic.base</span> <span class="kn">import</span> <span class="n">RedirectView</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">urls</span> <span class="k">as</span> <span class="n">wagtail_urls</span>
<span class="kn">from</span> <span class="nn">wagtail.admin</span> <span class="kn">import</span> <span class="n">urls</span> <span class="k">as</span> <span class="n">wagtailadmin_urls</span>
<span class="kn">from</span> <span class="nn">wagtail.documents</span> <span class="kn">import</span> <span class="n">urls</span> <span class="k">as</span> <span class="n">wagtaildocs_urls</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;django-admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>

    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtailadmin_urls</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;documents/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtaildocs_urls</span><span class="p">)),</span>

    <span class="c1"># For anything not caught by a more specific rule above, hand over to</span>
    <span class="c1"># Wagtail&#39;s serving mechanism</span>
    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtail_urls</span><span class="p">)),</span>
<span class="p">]</span>


<span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">django.contrib.staticfiles.urls</span> <span class="kn">import</span> <span class="n">staticfiles_urlpatterns</span>

    <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">staticfiles_urlpatterns</span><span class="p">()</span> <span class="c1"># tell gunicorn where static files are in dev mode</span>
    <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">static</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_URL</span> <span class="o">+</span> <span class="s1">&#39;images/&#39;</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="p">,</span> <span class="s1">&#39;images&#39;</span><span class="p">))</span>
    <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="n">path</span><span class="p">(</span><span class="s1">&#39;favicon.ico&#39;</span><span class="p">,</span> <span class="n">RedirectView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">STATIC_URL</span> <span class="o">+</span> <span class="s1">&#39;myapp/images/favicon.ico&#39;</span><span class="p">))</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-advanced_topics/deploying"></span><div class="section" id="deploying-wagtail">
<h4>Deploying Wagtail<a class="headerlink" href="#deploying-wagtail" title="Permalink to this headline">¶</a></h4>
<div class="section" id="on-your-server">
<h5>On your server<a class="headerlink" href="#on-your-server" title="Permalink to this headline">¶</a></h5>
<p>Wagtail is straightforward to deploy on modern Linux-based distributions, and should run with any of the combinations detailed in Django’s <a class="reference external" href="https://docs.djangoproject.com/en/stable/howto/deployment/" title="(in Django v3.2)"><span class="xref std std-doc">deployment documentation</span></a>. See the section on <a class="reference internal" href="index.html#document-advanced_topics/performance"><span class="doc">performance</span></a> for the non-Python services we recommend.</p>
</div>
<div class="section" id="on-divio-cloud">
<h5>On Divio Cloud<a class="headerlink" href="#on-divio-cloud" title="Permalink to this headline">¶</a></h5>
<p><a class="reference external" href="https://divio.com/">Divio Cloud</a> is a Dockerised cloud hosting platform for Python/Django that allows you to launch and deploy Wagtail projects in minutes. With a free account, you can create a Wagtail project. Choose from a:</p>
<ul class="simple">
<li><a class="reference external" href="https://divio.com/wagtail">site based on the Wagtail Bakery project</a>, or</li>
<li><a class="reference external" href="https://control.divio.com/control/project/create">brand new Wagtail project</a> (see the <a class="reference external" href="https://support.divio.com/project-types/wagtail/get-started-with-wagtail-on-divio-cloud">how to get started notes</a>).</li>
</ul>
<p>Divio Cloud also hosts a <a class="reference external" href="https://divio.com/wagtail">live Wagtail Bakery demo</a> (no account required).</p>
</div>
<div class="section" id="on-pythonanywhere">
<h5>On PythonAnywhere<a class="headerlink" href="#on-pythonanywhere" title="Permalink to this headline">¶</a></h5>
<p><a class="reference external" href="https://www.pythonanywhere.com/">PythonAnywhere</a> is a Platform-as-a-Service (PaaS) focused on Python hosting and development. It allows developers to quickly develop, host, and scale applications in a cloud environment. Starting with a free plan they also provide MySQL and PostgreSQL databases as well as very flexible and affordable paid plans, so there’s all you need to host a Wagtail site. To get quickly up and running you may use the <a class="reference external" href="https://github.com/texperience/wagtail-pythonanywhere-quickstart">wagtail-pythonanywhere-quickstart</a>.</p>
</div>
<div class="section" id="on-google-cloud">
<h5>On Google Cloud<a class="headerlink" href="#on-google-cloud" title="Permalink to this headline">¶</a></h5>
<p><a class="reference external" href="https://cloud.google.com">Google Cloud</a> is an Infrastructure-as-a-Service (IaaS) that offers multiple managed products, supported by Python client libraries, to help you build, deploy, and monitor your applications. You can deploy Wagtail, or any Django application, in a number of ways, including on <a class="reference external" href="https://www.youtube.com/watch?v=uD9PTag2-PQ">App Engine</a>  or <a class="reference external" href="https://codelabs.developers.google.com/codelabs/cloud-run-wagtail/#0">Cloud Run</a>.</p>
</div>
<div class="section" id="on-other-paass-and-iaass">
<h5>On other PAASs and IAASs<a class="headerlink" href="#on-other-paass-and-iaass" title="Permalink to this headline">¶</a></h5>
<p>We know of Wagtail sites running on <a class="reference external" href="https://spapas.github.io/2014/02/13/wagtail-tutorial/">Heroku</a>, Digital Ocean and elsewhere. If you have successfully installed Wagtail on your platform or infrastructure, please <a class="reference internal" href="index.html#document-contributing/index"><span class="doc">contribute</span></a> your notes to this documentation!</p>
</div>
<div class="section" id="deployment-tips">
<h5>Deployment tips<a class="headerlink" href="#deployment-tips" title="Permalink to this headline">¶</a></h5>
<div class="section" id="static-files">
<h6>Static files<a class="headerlink" href="#static-files" title="Permalink to this headline">¶</a></h6>
<p>As with all Django projects, static files are not served by the Django application server in production (i.e. outside of the <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">runserver</span></code> command); these need to be handled separately at the web server level. See <a class="reference external" href="https://docs.djangoproject.com/en/stable/howto/static-files/deployment/" title="(in Django v3.2)"><span class="xref std std-doc">Django’s documentation on deploying static files</span></a>.</p>
<p>The JavaScript and CSS files used by the Wagtail admin frequently change between releases of Wagtail - it’s important to avoid serving outdated versions of these files due to browser or server-side caching, as this can cause hard-to-diagnose issues. We recommend enabling <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/contrib/staticfiles/#django.contrib.staticfiles.storage.ManifestStaticFilesStorage" title="(in Django v3.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code></a> in the <code class="docutils literal notranslate"><span class="pre">STATICFILES_STORAGE</span></code> setting - this ensures that different versions of files are assigned distinct URLs.</p>
</div>
<div class="section" id="cloud-storage">
<h6>Cloud storage<a class="headerlink" href="#cloud-storage" title="Permalink to this headline">¶</a></h6>
<p>Wagtail follows <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/files/" title="(in Django v3.2)"><span class="xref std std-doc">Django’s conventions for managing uploaded files</span></a>, and can be configured to store uploaded images and documents on a cloud storage service such as Amazon S3; this is done through the <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/settings/#std:setting-DEFAULT_FILE_STORAGE">DEFAULT_FILE_STORAGE</a> setting in conjunction with an add-on package such as <a class="reference external" href="https://django-storages.readthedocs.io/">django-storages</a>. Be aware that setting up remote storage will not entirely offload file handling tasks from the application server - some Wagtail functionality requires files to be read back by the application server. In particular, original image files need to be read back whenever a new resized rendition is created, and documents may be configured to be served through a Django view in order to enforce permission checks (see <a class="reference internal" href="index.html#wagtaildocs-serve-method"><span class="std std-ref">WAGTAILDOCS_SERVE_METHOD</span></a>).</p>
<p>Note that the django-storages Amazon S3 backends (<code class="docutils literal notranslate"><span class="pre">storages.backends.s3boto.S3BotoStorage</span></code> and <code class="docutils literal notranslate"><span class="pre">storages.backends.s3boto3.S3Boto3Storage</span></code>) <strong>do not correctly handle duplicate filenames</strong> in their default configuration. When using these backends, <code class="docutils literal notranslate"><span class="pre">AWS_S3_FILE_OVERWRITE</span></code> must be set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>If you are also serving Wagtail’s static files from remote storage (using Django’s <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/settings/#std:setting-STATICFILES_STORAGE">STATICFILES_STORAGE</a> setting), you’ll need to ensure that it is configured to serve <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS HTTP headers</a>, as current browsers will reject remotely-hosted font files that lack a valid header. For Amazon S3, refer to the documentation <a class="reference external" href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/set-permissions.html">Setting Bucket and Object Access Permissions</a>, or (for the <code class="docutils literal notranslate"><span class="pre">storages.backends.s3boto.S3Boto3Storage</span></code> backend only) add the following to your Django settings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">AWS_S3_OBJECT_PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ACL&quot;</span><span class="p">:</span> <span class="s2">&quot;public-read&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ACL</span></code> parameter accepts a list of predefined configurations for Amazon S3. For more information, refer to the documentation <a class="reference external" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl">Canned ACL</a>.</p>
<p>For Google Cloud Storage, create a <code class="docutils literal notranslate"><span class="pre">cors.json</span></code> configuration:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;origin&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
      <span class="nt">&quot;responseHeader&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">],</span>
      <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">],</span>
      <span class="nt">&quot;maxAgeSeconds&quot;</span><span class="p">:</span> <span class="mi">3600</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Then, apply this CORS configuration to the storage bucket:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>gsutil cors <span class="nb">set</span> cors.json gs://<span class="nv">$GS_BUCKET_NAME</span>
</pre></div>
</div>
<p>For other storage services, refer to your provider’s documentation, or the documentation for the Django storage backend library you’re using.</p>
</div>
</div>
</div>
<span id="document-advanced_topics/performance"></span><div class="section" id="performance">
<h4>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h4>
<p>Wagtail is designed for speed, both in the editor interface and on the front-end, but if you want even better performance or you need to handle very high volumes of traffic, here are some tips on eking out the most from your installation.</p>
<div class="section" id="editor-interface">
<h5>Editor interface<a class="headerlink" href="#editor-interface" title="Permalink to this headline">¶</a></h5>
<p>We have tried to minimise external dependencies for a working installation of Wagtail, in order to make it as simple as possible to get going. However, a number of default settings can be configured for better performance:</p>
<div class="section" id="cache">
<h6>Cache<a class="headerlink" href="#cache" title="Permalink to this headline">¶</a></h6>
<p>We recommend <a class="reference external" href="https://redis.io/">Redis</a> as a fast, persistent cache. Install Redis through your package manager (on Debian or Ubuntu: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">redis-server</span></code>), add <code class="docutils literal notranslate"><span class="pre">django-redis</span></code> to your <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>, and enable it as a cache backend:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django_redis.cache.RedisCache&#39;</span><span class="p">,</span>
        <span class="s1">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="s1">&#39;redis://127.0.0.1:6379/dbname&#39;</span><span class="p">,</span>
        <span class="c1"># for django-redis &lt; 3.8.0, use:</span>
        <span class="c1"># &#39;LOCATION&#39;: &#39;127.0.0.1:6379&#39;,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;CLIENT_CLASS&#39;</span><span class="p">:</span> <span class="s1">&#39;django_redis.client.DefaultClient&#39;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="caching-image-renditions">
<h6>Caching image renditions<a class="headerlink" href="#caching-image-renditions" title="Permalink to this headline">¶</a></h6>
<p>If you define a cache named ‘renditions’ (typically alongside your ‘default’ cache),
Wagtail will cache image rendition lookups, which may improve the performance of pages
which include many images.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">},</span>
    <span class="s1">&#39;renditions&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.core.cache.backends.memcached.MemcachedCache&#39;</span><span class="p">,</span>
        <span class="s1">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1:11211&#39;</span><span class="p">,</span>
        <span class="s1">&#39;TIMEOUT&#39;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;MAX_ENTRIES&#39;</span><span class="p">:</span> <span class="mi">1000</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="search">
<h6>Search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h6>
<p>Wagtail has strong support for <a class="reference external" href="https://www.elastic.co">Elasticsearch</a> - both in the editor interface and for users of your site - but can fall back to a database search if Elasticsearch isn’t present. Elasticsearch is faster and more powerful than the Django ORM for text search, so we recommend installing it or using a hosted service like <a class="reference external" href="http://www.searchly.com/">Searchly</a>.</p>
<p>For details on configuring Wagtail for Elasticsearch, see <a class="reference internal" href="index.html#wagtailsearch-backends-elasticsearch"><span class="std std-ref">Elasticsearch Backend</span></a>.</p>
</div>
<div class="section" id="database">
<h6>Database<a class="headerlink" href="#database" title="Permalink to this headline">¶</a></h6>
<p>Wagtail is tested on PostgreSQL, SQLite and MySQL. It may work on some third-party database backends as well, but this is not guaranteed. We recommend PostgreSQL for production use.</p>
</div>
<div class="section" id="templates">
<h6>Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h6>
<p>The overhead from reading and compiling templates adds up. Django wraps its default loaders with <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/templates/api/#django.template.loaders.cached.Loader" title="(in Django v3.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">cached</span> <span class="pre">template</span> <span class="pre">loader</span></code></a>: which stores the compiled <code class="docutils literal notranslate"><span class="pre">Template</span></code> in memory and returns it for subsequent requests. The cached loader is automatically enabled when <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>. If you are using custom loaders, update your settings to use it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[{</span>
    <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)],</span>
    <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;loaders&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;django.template.loaders.cached.Loader&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;django.template.loaders.filesystem.Loader&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.template.loaders.app_directories.Loader&#39;</span><span class="p">,</span>
                <span class="s1">&#39;path.to.custom.Loader&#39;</span><span class="p">,</span>
            <span class="p">]),</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">}]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="public-users">
<h5>Public users<a class="headerlink" href="#public-users" title="Permalink to this headline">¶</a></h5>
<div class="section" id="caching-proxy">
<span id="id1"></span><h6>Caching proxy<a class="headerlink" href="#caching-proxy" title="Permalink to this headline">¶</a></h6>
<p>To support high volumes of traffic with excellent response times, we recommend a caching proxy. Both <a class="reference external" href="https://varnish-cache.org/">Varnish</a> and <a class="reference external" href="http://www.squid-cache.org/">Squid</a> have been tested in production. Hosted proxies like <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a> should also work well.</p>
<blockquote>
<div>Wagtail supports automatic cache invalidation for Varnish/Squid. See <a class="reference internal" href="index.html#frontend-cache-purging"><span class="std std-ref">Frontend cache invalidator</span></a> for more information.</div></blockquote>
</div>
</div>
</div>
<span id="document-advanced_topics/i18n"></span><div class="section" id="internationalisation">
<h4>Internationalisation<a class="headerlink" href="#internationalisation" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#multi-language-content" id="id6">Multi-language content</a><ul>
<li><a class="reference internal" href="#overview" id="id7">Overview</a></li>
<li><a class="reference internal" href="#wagtail-s-approach-to-multi-lingual-content" id="id8">Wagtail’s approach to multi-lingual content</a><ul>
<li><a class="reference internal" href="#page-structure" id="id9">Page structure</a></li>
<li><a class="reference internal" href="#how-locales-and-translations-are-recorded-in-the-database" id="id10">How locales and translations are recorded in the database</a></li>
<li><a class="reference internal" href="#translated-homepages" id="id11">Translated homepages</a></li>
<li><a class="reference internal" href="#language-detection-and-routing" id="id12">Language detection and routing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration" id="id13">Configuration</a><ul>
<li><a class="reference internal" href="#enabling-internationalisation" id="id14">Enabling internationalisation</a></li>
<li><a class="reference internal" href="#configuring-available-languages" id="id15">Configuring available languages</a></li>
<li><a class="reference internal" href="#enabling-the-locale-management-ui-optional" id="id16">Enabling the locale management UI (optional)</a></li>
<li><a class="reference internal" href="#adding-a-language-prefix-to-urls" id="id17">Adding a language prefix to URLs</a></li>
<li><a class="reference internal" href="#user-language-auto-detection" id="id18">User language auto-detection</a></li>
<li><a class="reference internal" href="#custom-routing-language-detection" id="id19">Custom routing/language detection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recipes-for-internationalised-sites" id="id20">Recipes for internationalised sites</a><ul>
<li><a class="reference internal" href="#language-region-selector" id="id21">Language/region selector</a></li>
<li><a class="reference internal" href="#api-filters-for-headless-sites" id="id22">API filters for headless sites</a></li>
<li><a class="reference internal" href="#translatable-snippets" id="id23">Translatable snippets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#translation-workflow" id="id24">Translation workflow</a><ul>
<li><a class="reference internal" href="#id5" id="id25">Wagtail Localize</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#alternative-internationalisation-plugins" id="id26">Alternative internationalisation plugins</a></li>
<li><a class="reference internal" href="#wagtail-admin-translations" id="id27">Wagtail admin translations</a></li>
<li><a class="reference internal" href="#change-wagtail-admin-language-on-a-per-user-basis" id="id28">Change Wagtail admin language on a per-user basis</a></li>
<li><a class="reference internal" href="#changing-the-primary-language-of-your-wagtail-installation" id="id29">Changing the primary language of your Wagtail installation</a></li>
</ul>
</div>
<div class="section" id="multi-language-content">
<span id="id1"></span><h5><a class="toc-backref" href="#id6">Multi-language content</a><a class="headerlink" href="#multi-language-content" title="Permalink to this headline">¶</a></h5>
<div class="section" id="overview">
<h6><a class="toc-backref" href="#id7">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h6>
<p>Out of the box, Wagtail assumes all content will be authored in a single language.
This document describes how to configure Wagtail for authoring content in
multiple languages.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Wagtail provides the infrastructure for creating and serving content in multiple languages.
There are two options for managing translations across different languages in the admin interface:
<a class="reference internal" href="index.html#simple-translation"><span class="std std-ref">wagtail.contrib.simple_translation</span></a> or the more advanced <a class="reference external" href="https://github.com/wagtail/wagtail-localize">wagtail-localize</a> (third-party package).</p>
</div>
<p>This document only covers the internationalisation of content managed by Wagtail.
For information on how to translate static content in template files, JavaScript
code, etc, refer to the <a class="reference external" href="https://docs.djangoproject.com/en/3.1/topics/i18n/translation/">Django internationalisation docs</a>.
Or, if you are building a headless site, refer to the docs of the frontend framework you are using.</p>
</div>
<div class="section" id="wagtail-s-approach-to-multi-lingual-content">
<h6><a class="toc-backref" href="#id8">Wagtail’s approach to multi-lingual content</a><a class="headerlink" href="#wagtail-s-approach-to-multi-lingual-content" title="Permalink to this headline">¶</a></h6>
<p>This section provides an explanation of Wagtail’s internationalisation approach.
If you’re in a hurry, you can skip to <a class="reference internal" href="#configuration">Configuration</a>.</p>
<p>In summary:</p>
<ul class="simple">
<li>Wagtail stores content in a separate page tree for each locale</li>
<li>It has a built-in <code class="docutils literal notranslate"><span class="pre">Locale</span></code> model and all pages are linked to a <code class="docutils literal notranslate"><span class="pre">Locale</span></code> with the <code class="docutils literal notranslate"><span class="pre">locale</span></code> foreign key field</li>
<li>It records which pages are translations of each other using a shared UUID stored in the <code class="docutils literal notranslate"><span class="pre">translation_key</span></code> field</li>
<li>It automatically routes requests through translations of the site’s homepage</li>
<li>It uses Django’s <code class="docutils literal notranslate"><span class="pre">i18n_patterns</span></code> and <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> for language detection</li>
</ul>
<div class="section" id="page-structure">
<h7><a class="toc-backref" href="#id9">Page structure</a><a class="headerlink" href="#page-structure" title="Permalink to this headline">¶</a></h7>
<p>Wagtail stores content in a separate page tree for each locale.</p>
<p>For example, if you have two sites in two locales, then you will see four
homepages at the top level of the page hierarchy in the explorer.</p>
<p>This approach has some advantages for the editor experience as well:</p>
<ul class="simple">
<li>There is no default language for editing, so content can be authored in any
language and then translated to any other.</li>
<li>Translations of a page are separate pages so they can be published at
different times.</li>
<li>Editors can be given permission to edit content in one locale and not others.</li>
</ul>
</div>
<div class="section" id="how-locales-and-translations-are-recorded-in-the-database">
<h7><a class="toc-backref" href="#id10">How locales and translations are recorded in the database</a><a class="headerlink" href="#how-locales-and-translations-are-recorded-in-the-database" title="Permalink to this headline">¶</a></h7>
<p>All pages (and any snippets that have translation enabled) have a <code class="docutils literal notranslate"><span class="pre">locale</span></code> and
<code class="docutils literal notranslate"><span class="pre">translation_key</span></code> field:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">locale</span></code> is a foreign key to the <code class="docutils literal notranslate"><span class="pre">Locale</span></code> model</li>
<li><code class="docutils literal notranslate"><span class="pre">translation_key</span></code> is a UUID that’s used to find translations of a piece of content.
Translations of the same page/snippet share the same value in this field</li>
</ul>
<p>These two fields have a ‘unique together’ constraint so you can’t have more than
one translation in the same locale.</p>
</div>
<div class="section" id="translated-homepages">
<h7><a class="toc-backref" href="#id11">Translated homepages</a><a class="headerlink" href="#translated-homepages" title="Permalink to this headline">¶</a></h7>
<p>When you set up a site in Wagtail, you select the site’s homepage in the ‘root page’
field and all requests to that site’s root URL will be routed to that page.</p>
<p>Multi-lingual sites have a separate homepage for each locale that exist as siblings
in the page tree. Wagtail finds the other homepages by looking for translations of
the site’s ‘root page’.</p>
<p>This means that to make a site available in another locale, you just need to
translate and publish its homepage in that new locale.</p>
<p>If Wagtail can’t find a homepage that matches the user’s language, it will fall back
to the page that is selected as the ‘root page’ on the site record, so you can use
this field to specify the default language of your site.</p>
</div>
<div class="section" id="language-detection-and-routing">
<h7><a class="toc-backref" href="#id12">Language detection and routing</a><a class="headerlink" href="#language-detection-and-routing" title="Permalink to this headline">¶</a></h7>
<p>For detecting the user’s language and adding a prefix to the URLs
(<code class="docutils literal notranslate"><span class="pre">/en/</span></code>, <code class="docutils literal notranslate"><span class="pre">/fr-fr/</span></code>, for example), Wagtail is designed to work with Django’s
builtin internationalisation utilities such as <code class="docutils literal notranslate"><span class="pre">i18n_patterns</span></code> and
<cite>LocaleMiddleware</cite>. This means that Wagtail should work seamlessly with any
other internationalised Django applications on your site.</p>
<div class="section" id="locales">
<h8>Locales<a class="headerlink" href="#locales" title="Permalink to this headline">¶</a></h8>
<p>The locales that are enabled on a site are recorded in the <code class="docutils literal notranslate"><span class="pre">Locale</span></code> model in
<code class="docutils literal notranslate"><span class="pre">wagtailcore</span></code>. This model has just two fields: ID and <code class="docutils literal notranslate"><span class="pre">language_code</span></code> which
stores the <a class="reference external" href="https://en.wikipedia.org/wiki/IETF_language_tag">BCP-47 language tag</a>
that represents this locale.</p>
<p>The locale records can be set up with an <a class="reference internal" href="#enabling-locale-management"><span class="std std-ref">optional management UI</span></a> or created
in the shell. The possible values of the <code class="docutils literal notranslate"><span class="pre">language_code</span></code> field are controlled
by the <code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code> setting.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Read this if you’ve changed <code class="docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code> before enabling internationalisation</p>
<p>On initial migration, Wagtail creates a <code class="docutils literal notranslate"><span class="pre">Locale</span></code> record for the language that
was set in the <code class="docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code> setting at the time the migration was run. All
pages will be assigned to this <code class="docutils literal notranslate"><span class="pre">Locale</span></code> when Wagtail’s internationalisation is disabled.</p>
<p class="last">If you have changed the <code class="docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code> setting since updating to Wagtail 2.11,
you will need to manually update the record in the <code class="docutils literal notranslate"><span class="pre">Locale</span></code> model too before
enabling internationalisation, as your existing content will be assigned to the old code.</p>
</div>
</div>
</div>
</div>
<div class="section" id="configuration">
<h6><a class="toc-backref" href="#id13">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h6>
<p>In this section, we will go through the minimum configuration required to enable
content to be authored in multiple languages.</p>
<div class="contents local topic" id="id2">
<ul class="simple">
<li><a class="reference internal" href="#enabling-internationalisation" id="id30">Enabling internationalisation</a></li>
<li><a class="reference internal" href="#configuring-available-languages" id="id31">Configuring available languages</a></li>
<li><a class="reference internal" href="#enabling-the-locale-management-ui-optional" id="id32">Enabling the locale management UI (optional)</a></li>
<li><a class="reference internal" href="#adding-a-language-prefix-to-urls" id="id33">Adding a language prefix to URLs</a></li>
<li><a class="reference internal" href="#user-language-auto-detection" id="id34">User language auto-detection</a></li>
<li><a class="reference internal" href="#custom-routing-language-detection" id="id35">Custom routing/language detection</a></li>
</ul>
</div>
<div class="section" id="enabling-internationalisation">
<span id="id3"></span><h7><a class="toc-backref" href="#id30">Enabling internationalisation</a><a class="headerlink" href="#enabling-internationalisation" title="Permalink to this headline">¶</a></h7>
<p>To enable internationalisation in both Django and Wagtail, set the following
settings to <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_project/settings.py</span>

<span class="n">USE_I18N</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">WAGTAIL_I18N_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>In addition, you might also want to enable Django’s localisation support. This
will make dates and numbers display in the user’s local format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_project/settings.py</span>

<span class="n">USE_L10N</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-available-languages">
<h7><a class="toc-backref" href="#id31">Configuring available languages</a><a class="headerlink" href="#configuring-available-languages" title="Permalink to this headline">¶</a></h7>
<p>Next we need to configure the available languages. There are two settings
for this that are each used for different purposes:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">LANGUAGES</span></code> - This sets which languages are available on the frontend of the site.</li>
<li><code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code> - This sets which the languages Wagtail content
can be authored in.</li>
</ul>
<p>You can set both of these settings to the exact same value. For example, to
enable English, French, and Spanish:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_project/settings.py</span>

<span class="n">WAGTAIL_CONTENT_LANGUAGES</span> <span class="o">=</span> <span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="s2">&quot;English&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;fr&#39;</span><span class="p">,</span> <span class="s2">&quot;French&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">,</span> <span class="s2">&quot;Spanish&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Whenever <code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code> is changed, the <code class="docutils literal notranslate"><span class="pre">Locale</span></code> model needs
to be updated as well to match.</p>
<p class="last">This can either be done with a data migration or with the optional locale
management UI described in the next section.</p>
</div>
<p>You can also set these to different values. You might want to do this if you
want to have some programmatic localisation (like date formatting or currency,
for example) but use the same Wagtail content in multiple regions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_project/settings.py</span>

<span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;en-GB&#39;</span><span class="p">,</span> <span class="s2">&quot;English (Great Britain)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;en-US&#39;</span><span class="p">,</span> <span class="s2">&quot;English (United States)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;en-CA&#39;</span><span class="p">,</span> <span class="s2">&quot;English (Canada)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;fr-FR&#39;</span><span class="p">,</span> <span class="s2">&quot;French (France)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;fr-CA&#39;</span><span class="p">,</span> <span class="s2">&quot;French (Canada)&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">WAGTAIL_CONTENT_LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;en-GB&#39;</span><span class="p">,</span> <span class="s2">&quot;English&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;fr-FR&#39;</span><span class="p">,</span> <span class="s2">&quot;French&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>When configured like this, the site will be available in all the different
locales in the first list, but there will only be two language trees in
Wagtail.</p>
<p>All the <code class="docutils literal notranslate"><span class="pre">en-</span></code> locales will use the “English” language tree, and the <code class="docutils literal notranslate"><span class="pre">fr-</span></code>
locales will use the “French” language tree. The differences between each locale
in a language would be programmatic. For example: which date/number format to
use, and what currency to display prices in.</p>
</div>
<div class="section" id="enabling-the-locale-management-ui-optional">
<span id="enabling-locale-management"></span><h7><a class="toc-backref" href="#id32">Enabling the locale management UI (optional)</a><a class="headerlink" href="#enabling-the-locale-management-ui-optional" title="Permalink to this headline">¶</a></h7>
<p>An optional locale management app exists to allow a Wagtail administrator to
set up the locales from the Wagtail admin interface.</p>
<p>To enable it, add <code class="docutils literal notranslate"><span class="pre">wagtail.locales</span></code> into <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_project/settings.py</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;wagtail.locales&#39;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-a-language-prefix-to-urls">
<h7><a class="toc-backref" href="#id33">Adding a language prefix to URLs</a><a class="headerlink" href="#adding-a-language-prefix-to-urls" title="Permalink to this headline">¶</a></h7>
<p>To allow all of the page trees to be served at the same domain, we need
to add a URL prefix for each language.</p>
<p>To implement this, we can use Django’s built-in
<a class="reference external" href="https://docs.djangoproject.com/en/3.1/topics/i18n/translation/#language-prefix-in-url-patterns">i18n_patterns</a>
function, which adds a language prefix to all of the URL patterns passed into it.
This activates the language code specified in the URL and Wagtail takes this into
account when it decides how to route the request.</p>
<p>In your project’s <code class="docutils literal notranslate"><span class="pre">urls.py</span></code> add Wagtail’s core URLs (and any other URLs you
want to be translated) into an <code class="docutils literal notranslate"><span class="pre">i18n_patterns</span></code> block:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># /my_project/urls.py</span>

<span class="o">...</span>

<span class="kn">from</span> <span class="nn">django.conf.urls.i18n</span> <span class="kn">import</span> <span class="n">i18n_patterns</span>

<span class="c1"># Non-translatable URLs</span>
<span class="c1"># Note: if you are using the Wagtail API or sitemaps,</span>
<span class="c1"># these should not be added to `i18n_patterns` either</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;django-admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>

    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtailadmin_urls</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;documents/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtaildocs_urls</span><span class="p">)),</span>
<span class="p">]</span>

<span class="c1"># Translatable URLs</span>
<span class="c1"># These will be available under a language code prefix. For example /en/search/</span>
<span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">i18n_patterns</span><span class="p">(</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;search/&#39;</span><span class="p">,</span> <span class="n">search_views</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtail_urls</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="user-language-auto-detection">
<h7><a class="toc-backref" href="#id34">User language auto-detection</a><a class="headerlink" href="#user-language-auto-detection" title="Permalink to this headline">¶</a></h7>
<p>After wrapping your URL patterns with <code class="docutils literal notranslate"><span class="pre">i18n_patterns</span></code>, your site will now
respond on URL prefixes. But now it won’t respond on the root path.</p>
<p>To fix this, we need to detect the user’s browser language and redirect them
to the best language prefix. The recommended approach to do this is with
Django’s <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_project/settings.py</span>

<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;django.middleware.locale.LocaleMiddleware&#39;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-routing-language-detection">
<h7><a class="toc-backref" href="#id35">Custom routing/language detection</a><a class="headerlink" href="#custom-routing-language-detection" title="Permalink to this headline">¶</a></h7>
<p>You don’t strictly have to use <code class="docutils literal notranslate"><span class="pre">i18n_patterns</span></code> or <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> for
this and you can write your own logic if you need to.</p>
<p>All Wagtail needs is the language to be activated (using Django’s
<code class="docutils literal notranslate"><span class="pre">django.utils.translation.activate</span></code> function) before the
<code class="docutils literal notranslate"><span class="pre">wagtail.core.views.serve</span></code> view is called.</p>
</div>
</div>
<div class="section" id="recipes-for-internationalised-sites">
<h6><a class="toc-backref" href="#id20">Recipes for internationalised sites</a><a class="headerlink" href="#recipes-for-internationalised-sites" title="Permalink to this headline">¶</a></h6>
<div class="section" id="language-region-selector">
<h7><a class="toc-backref" href="#id21">Language/region selector</a><a class="headerlink" href="#language-region-selector" title="Permalink to this headline">¶</a></h7>
<p>Perhaps the most important bit of internationalisation-related UI you can add
to your site is a selector to allow users to switch between different
languages.</p>
<p>If you’re not convinced that you need this, have a look at <a class="reference external" href="https://www.w3.org/International/questions/qa-site-conneg#yyyshortcomings">https://www.w3.org/International/questions/qa-site-conneg#yyyshortcomings</a> for some rationale.</p>
<div class="section" id="basic-example">
<h8>Basic example<a class="headerlink" href="#basic-example" title="Permalink to this headline">¶</a></h8>
<p>Here is a basic example of how to add links between translations of a page.</p>
<p>This example, however, will only include languages defined in
<code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code> and not any extra languages that might be defined
in <code class="docutils literal notranslate"><span class="pre">LANGUAGES</span></code>. For more information on what both of these settings mean, see
<a class="reference internal" href="#configuring-available-languages">Configuring available languages</a>.</p>
<p>If both settings are set to the same value, this example should work well for you,
otherwise skip to the next section that has a more complicated example which takes
this into account.</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="c">{# make sure these are at the top of the file #}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">i18n</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">page</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">translation</span> <span class="k">in</span> <span class="nv">page.get_translations.live</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">get_language_info</span> <span class="nv">for</span> <span class="nv">translation.locale.language_code</span> <span class="k">as</span> <span class="nv">lang</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">translation</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;alternate&quot;</span> <span class="na">hreflang</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">language_code</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
            <span class="cp">{{</span> <span class="nv">lang.name_local</span> <span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Let’s break this down:</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page</span> <span class="cp">%}</span>
    ...
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>If this is part of a shared base template it may be used in situations where no page object is available, such as 404 error responses, so check that we have a page before proceeding.</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">translation</span> <span class="k">in</span> <span class="nv">page.get_translations.live</span> <span class="cp">%}</span>
    ...
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">for</span></code> block iterates through all published translations of the current page.</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">get_language_info</span> <span class="nv">for</span> <span class="nv">translation.locale.language_code</span> <span class="k">as</span> <span class="nv">lang</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>This is a Django built-in tag that gets info about the language of the translation.
For more information, see <a class="reference external" href="https://docs.djangoproject.com/en/3.1/topics/i18n/translation/#django.utils.translation.get_language_info">get_language_info() in the Django docs</a>.</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">translation</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;alternate&quot;</span> <span class="na">hreflang</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">language_code</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">lang.name_local</span> <span class="cp">}}</span>
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>This adds a link to the translation. We use <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">lang.name_local</span> <span class="pre">}}</span></code> to display
the name of the locale in its own language. We also add <code class="docutils literal notranslate"><span class="pre">rel</span></code> and <code class="docutils literal notranslate"><span class="pre">hreflang</span></code>
attributes to the <code class="docutils literal notranslate"><span class="pre">&lt;a&gt;</span></code> tag for SEO.</p>
</div>
<div class="section" id="handling-locales-that-share-content">
<h8>Handling locales that share content<a class="headerlink" href="#handling-locales-that-share-content" title="Permalink to this headline">¶</a></h8>
<p>Rather than iterating over pages, this example iterates over all of the configured
languages and finds the page for each one. This works better than the <a class="reference internal" href="#basic-example">Basic example</a>
above on sites that have extra Django <code class="docutils literal notranslate"><span class="pre">LANGUAGES</span></code> that share the same Wagtail content.</p>
<p>For this example to work, you firstly need to add Django’s
<a class="reference external" href="https://docs.djangoproject.com/en/3.1/ref/templates/api/#django-template-context-processors-i18n">django.template.context_processors.i18n</a>
context processor to your <code class="docutils literal notranslate"><span class="pre">TEMPLATES</span></code> setting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># myproject/settings.py</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="c1"># ...</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="c1"># ...</span>
                <span class="s1">&#39;django.template.context_processors.i18n&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Now for the example itself:</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">language_code</span><span class="o">,</span> <span class="nv">language_name</span> <span class="k">in</span> <span class="nv">LANGUAGES</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">get_language_info</span> <span class="nv">for</span> <span class="nv">language_code</span> <span class="k">as</span> <span class="nv">lang</span> <span class="cp">%}</span>

    <span class="cp">{%</span> <span class="k">language</span> <span class="nv">language_code</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">page.localized</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;alternate&quot;</span> <span class="na">hreflang</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">language_code</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
            <span class="cp">{{</span> <span class="nv">lang.name_local</span> <span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endlanguage</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Let’s break this down too:</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">language_code</span><span class="o">,</span> <span class="nv">language_name</span> <span class="k">in</span> <span class="nv">LANGUAGES</span> <span class="cp">%}</span>
    ...
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">for</span></code> block iterates through all of the configured languages on the site.
The <code class="docutils literal notranslate"><span class="pre">LANGUAGES</span></code> variable comes from the <code class="docutils literal notranslate"><span class="pre">django.template.context_processors.i18n</span></code>
context processor.</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">get_language_info</span> <span class="nv">for</span> <span class="nv">language_code</span> <span class="k">as</span> <span class="nv">lang</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Does exactly the same as the previous example.</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">language</span> <span class="nv">language_code</span> <span class="cp">%}</span>
    ...
<span class="cp">{%</span> <span class="k">endlanguage</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">language</span></code> tag comes from Django’s <code class="docutils literal notranslate"><span class="pre">i18n</span></code> tag library. It changes the
active language for just the code contained within it.</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">page.localized</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;alternate&quot;</span> <span class="na">hreflang</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">language_code</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">lang.name_local</span> <span class="cp">}}</span>
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The only difference with the <code class="docutils literal notranslate"><span class="pre">&lt;a&gt;</span></code> tag here from the <code class="docutils literal notranslate"><span class="pre">&lt;a&gt;</span></code> tag in the previous example
is how we’re getting the page’s URL: <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">pageurl</span> <span class="pre">page.localized</span> <span class="pre">%}</span></code>.</p>
<p>All page instances in Wagtail have a <code class="docutils literal notranslate"><span class="pre">.localized</span></code> attribute which fetches the translation
of the page in the current active language. This is why we activated the language previously.</p>
<p>Another difference here is that if the same translated page is shared in two locales, Wagtail
will generate the correct URL for the page based on the current active locale. This is the
key difference between this example and the previous one as the previous one can only get the
URL of the page in its default locale.</p>
</div>
</div>
<div class="section" id="api-filters-for-headless-sites">
<h7><a class="toc-backref" href="#id22">API filters for headless sites</a><a class="headerlink" href="#api-filters-for-headless-sites" title="Permalink to this headline">¶</a></h7>
<p>For headless sites, the Wagtail API supports two extra filters for internationalised sites:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">?locale=</span></code> Filters pages by the given locale</li>
<li><code class="docutils literal notranslate"><span class="pre">?translation_of=</span></code> Filters pages to only include translations of the given page ID</li>
</ul>
</div></blockquote>
<p>For more information, see <a class="reference internal" href="index.html#apiv2-i18n-filters"><span class="std std-ref">Special filters for internationalised sites</span></a>.</p>
</div>
<div class="section" id="translatable-snippets">
<h7><a class="toc-backref" href="#id23">Translatable snippets</a><a class="headerlink" href="#translatable-snippets" title="Permalink to this headline">¶</a></h7>
<p>You can make a snippet translatable by making it inherit from <code class="docutils literal notranslate"><span class="pre">wagtail.core.models.TranslatableMixin</span></code>.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># myapp/models.py</span>

<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">TranslatableMixin</span>
<span class="kn">from</span> <span class="nn">wagtail.snippets.models</span> <span class="kn">import</span> <span class="n">register_snippet</span>


<span class="nd">@register_snippet</span>
<span class="k">class</span> <span class="nc">Advert</span><span class="p">(</span><span class="n">TranslatableMixin</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">TranslatableMixin</span></code> model adds the <code class="docutils literal notranslate"><span class="pre">locale</span></code> and <code class="docutils literal notranslate"><span class="pre">translation_key</span></code> fields to the model.</p>
<div class="section" id="making-snippets-with-existing-data-translatable">
<h8>Making snippets with existing data translatable<a class="headerlink" href="#making-snippets-with-existing-data-translatable" title="Permalink to this headline">¶</a></h8>
<p>For snippets with existing data, it’s not possible to just add <code class="docutils literal notranslate"><span class="pre">TranslatableMixin</span></code>,
make a migration, and run it. This is because the <code class="docutils literal notranslate"><span class="pre">locale</span></code> and <code class="docutils literal notranslate"><span class="pre">translation_key</span></code>
fields are both required and <code class="docutils literal notranslate"><span class="pre">translation_key</span></code> needs a unique value for each
instance.</p>
<p>To migrate the existing data properly, we firstly need to use <code class="docutils literal notranslate"><span class="pre">BootstrapTranslatableMixin</span></code>,
which excludes these constraints, then add a data migration to set the two fields, then
switch to <code class="docutils literal notranslate"><span class="pre">TranslatableMixin</span></code>.</p>
<p>This is only needed if there are records in the database. So if the model is empty, you can
go straight to adding <code class="docutils literal notranslate"><span class="pre">TranslatableMixin</span></code> and skip this.</p>
<div class="section" id="step-1-add-bootstraptranslatablemixin-to-the-model">
<h9>Step 1: Add <code class="docutils literal notranslate"><span class="pre">BootstrapTranslatableMixin</span></code> to the model<a class="headerlink" href="#step-1-add-bootstraptranslatablemixin-to-the-model" title="Permalink to this headline">¶</a></h9>
<p>This will add the two fields without any constraints:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># myapp/models.py</span>

<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">BootstrapTranslatableMixin</span>
<span class="kn">from</span> <span class="nn">wagtail.snippets.models</span> <span class="kn">import</span> <span class="n">register_snippet</span>


<span class="nd">@register_snippet</span>
<span class="k">class</span> <span class="nc">Advert</span><span class="p">(</span><span class="n">BootstrapTranslatableMixin</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>

    <span class="c1"># if the model has a Meta class, ensure it inherits from</span>
    <span class="c1"># BootstrapTranslatableMixin.Meta too</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">BootstrapTranslatableMixin</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;adverts&#39;</span>
</pre></div>
</div>
<p>Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">makemigrations</span> <span class="pre">myapp</span></code> to generate the schema migration.</p>
</div>
<div class="section" id="step-2-create-a-data-migration">
<h9>Step 2: Create a data migration<a class="headerlink" href="#step-2-create-a-data-migration" title="Permalink to this headline">¶</a></h9>
<p>Create a data migration with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python manage.py makemigrations myapp --empty
</pre></div>
</div>
<p>This will generate a new empty migration in the app’s <code class="docutils literal notranslate"><span class="pre">migrations</span></code> folder. Edit
that migration and add a <code class="docutils literal notranslate"><span class="pre">BootstrapTranslatableModel</span></code> for each model to bootstrap
in that app:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">migrations</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">BootstrapTranslatableModel</span>

<span class="k">class</span> <span class="nc">Migration</span><span class="p">(</span><span class="n">migrations</span><span class="o">.</span><span class="n">Migration</span><span class="p">):</span>
    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;myapp&#39;</span><span class="p">,</span> <span class="s1">&#39;0002_bootstraptranslations&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="c1"># Add one operation for each model to bootstrap here</span>
    <span class="c1"># Note: Only include models that are in the same app!</span>
    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">BootstrapTranslatableModel</span><span class="p">(</span><span class="s1">&#39;myapp.Advert&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Repeat this for any other apps that contain a model to be bootstrapped.</p>
</div>
<div class="section" id="step-3-change-bootstraptranslatablemixin-to-translatablemixin">
<h9>Step 3: Change <code class="docutils literal notranslate"><span class="pre">BootstrapTranslatableMixin</span></code> to <code class="docutils literal notranslate"><span class="pre">TranslatableMixin</span></code><a class="headerlink" href="#step-3-change-bootstraptranslatablemixin-to-translatablemixin" title="Permalink to this headline">¶</a></h9>
<p>Now that we have a migration that fills in the required fields, we can swap out
<code class="docutils literal notranslate"><span class="pre">BootstrapTranslatableMixin</span></code> for <code class="docutils literal notranslate"><span class="pre">TranslatableMixin</span></code> that has all the
constraints:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># myapp/models.py</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">TranslatableMixin</span>  <span class="c1"># Change this line</span>

<span class="nd">@register_snippet</span>
<span class="k">class</span> <span class="nc">Advert</span><span class="p">(</span><span class="n">TranslatableMixin</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>  <span class="c1"># Change this line</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">TranslatableMixin</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>  <span class="c1"># Change this line, if present</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;adverts&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4-run-makemigrations-to-generate-schema-migrations-then-migrate">
<h9>Step 4: Run <code class="docutils literal notranslate"><span class="pre">makemigrations</span></code> to generate schema migrations, then migrate!<a class="headerlink" href="#step-4-run-makemigrations-to-generate-schema-migrations-then-migrate" title="Permalink to this headline">¶</a></h9>
<p>Run <code class="docutils literal notranslate"><span class="pre">makemigrations</span></code> to generate the schema migration that adds the
constraints into the database, then run <code class="docutils literal notranslate"><span class="pre">migrate</span></code> to run all of the
migrations:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python manage.py makemigrations myapp
python manage.py migrate
</pre></div>
</div>
<p>When prompted to select a fix for the nullable field ‘locale’ being changed to
non-nullable, select the option “Ignore for now” (as this has been handled by the
data migration).</p>
</div>
</div>
</div>
</div>
<div class="section" id="translation-workflow">
<h6><a class="toc-backref" href="#id24">Translation workflow</a><a class="headerlink" href="#translation-workflow" title="Permalink to this headline">¶</a></h6>
<p>As mentioned at the beginning, Wagtail does supply <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.simple_translation</span></code>.</p>
<p>The simple_translation module provides a user interface that allows users to copy pages and translatable snippets into another language.</p>
<ul class="simple">
<li>Copies are created in the source language (not translated)</li>
<li>Copies of pages are in draft status</li>
</ul>
<p>Content editors need to translate the content and publish the pages.</p>
<p>To enable add <code class="docutils literal notranslate"><span class="pre">&quot;wagtail.contrib.simple_translation&quot;</span></code> to <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>
and run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></code> to create the <code class="docutils literal notranslate"><span class="pre">submit_translation</span></code> permissions.
In the Wagtail admin, go to settings and give some users or groups the “Can submit translations” permission.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Simple Translation is optional. It can be switched out by third-party packages. Like the more advanced <a class="reference external" href="https://github.com/wagtail/wagtail-localize">wagtail-localize</a>.</p>
</div>
<div class="section" id="id5">
<h7><a class="toc-backref" href="#id25">Wagtail Localize</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h7>
<p>As part of the initial work on implementing internationalisation for Wagtail core,
we also created a translation package called <code class="docutils literal notranslate"><span class="pre">wagtail-localize</span></code>. This supports
translating pages within Wagtail, using PO files, machine translation, and external
integration with translation services.</p>
<p>Github: <a class="reference external" href="https://github.com/wagtail/wagtail-localize">https://github.com/wagtail/wagtail-localize</a></p>
</div>
</div>
</div>
<div class="section" id="alternative-internationalisation-plugins">
<h5><a class="toc-backref" href="#id26">Alternative internationalisation plugins</a><a class="headerlink" href="#alternative-internationalisation-plugins" title="Permalink to this headline">¶</a></h5>
<p>Before official multi-language support was added into Wagtail, site implementors
had to use external plugins. These have not been replaced by Wagtail’s own
implementation as they use slightly different approaches, one of them might
fit your use case better:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/wagtail/wagtailtrans">Wagtailtrans</a></li>
<li><a class="reference external" href="https://github.com/infoportugal/wagtail-modeltranslation">wagtail-modeltranslation</a></li>
</ul>
<p>For a comparison of these options, see AccordBox’s blog post
<a class="reference external" href="https://www.accordbox.com/blog/how-support-multi-language-wagtail-cms/">How to support multi-language in Wagtail CMS</a>.</p>
</div>
<div class="section" id="wagtail-admin-translations">
<h5><a class="toc-backref" href="#id27">Wagtail admin translations</a><a class="headerlink" href="#wagtail-admin-translations" title="Permalink to this headline">¶</a></h5>
<p>The Wagtail admin backend has been translated into many different languages. You can find a list of currently available translations on Wagtail’s <a class="reference external" href="https://www.transifex.com/torchbox/wagtail/">Transifex page</a>. (Note: if you’re using an old version of Wagtail, this page may not accurately reflect what languages you have available).</p>
<p>If your language isn’t listed on that page, you can easily contribute new languages or correct mistakes. Sign up and submit changes to <a class="reference external" href="https://www.transifex.com/torchbox/wagtail/">Transifex</a>. Translation updates are typically merged into an official release within one month of being submitted.</p>
</div>
<div class="section" id="change-wagtail-admin-language-on-a-per-user-basis">
<h5><a class="toc-backref" href="#id28">Change Wagtail admin language on a per-user basis</a><a class="headerlink" href="#change-wagtail-admin-language-on-a-per-user-basis" title="Permalink to this headline">¶</a></h5>
<p>Logged-in users can set their preferred language from <code class="docutils literal notranslate"><span class="pre">/admin/account/</span></code>.
By default, Wagtail provides a list of languages that have a &gt;= 90% translation coverage.
It is possible to override this list via the <a class="reference internal" href="index.html#wagtailadmin-permitted-languages"><span class="std std-ref">WAGTAILADMIN_PERMITTED_LANGUAGES</span></a> setting.</p>
<p>In case there is zero or one language permitted, the form will be hidden.</p>
<p>If there is no language selected by the user, the <code class="docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code> will be used.</p>
</div>
<div class="section" id="changing-the-primary-language-of-your-wagtail-installation">
<h5><a class="toc-backref" href="#id29">Changing the primary language of your Wagtail installation</a><a class="headerlink" href="#changing-the-primary-language-of-your-wagtail-installation" title="Permalink to this headline">¶</a></h5>
<p>The default language of Wagtail is <code class="docutils literal notranslate"><span class="pre">en-us</span></code> (American English). You can change this by tweaking a couple of Django settings:</p>
<ul class="simple">
<li>Make sure <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/settings/#use-i18n">USE_I18N</a> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code></li>
<li>Set <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/settings/#std:setting-LANGUAGE_CODE">LANGUAGE_CODE</a> to your websites’ primary language</li>
</ul>
<p>If there is a translation available for your language, the Wagtail admin backend should now be in the language you’ve chosen.</p>
</div>
</div>
<span id="document-advanced_topics/privacy"></span><div class="section" id="private-pages">
<span id="id1"></span><h4>Private pages<a class="headerlink" href="#private-pages" title="Permalink to this headline">¶</a></h4>
<p>Users with publish permission on a page can set it to be private by clicking the ‘Privacy’ control in the top right corner of the page explorer or editing interface. This sets a restriction on who is allowed to view the page and its sub-pages. Several different kinds of restriction are available:</p>
<ul class="simple">
<li><strong>Accessible to logged-in users:</strong> The user must log in to view the page. All user accounts are granted access, regardless of permission level.</li>
<li><strong>Accessible with the following password:</strong> The user must enter the given password to view the page. This is appropriate for situations where you want to share a page with a trusted group of people, but giving them individual user accounts would be overkill. The same password is shared between all users, and this works independently of any user accounts that exist on the site.</li>
<li><strong>Accessible to users in specific groups:</strong> The user must be logged in, and a member of one or more of the specified groups, in order to view the page.</li>
</ul>
<p>Similarly, documents can be made private by placing them in a collection with appropriate privacy settings (see <a class="reference internal" href="index.html#image-document-permissions"><span class="std std-ref">Image / document permissions</span></a>).</p>
<p>Private pages and documents work on Wagtail out of the box - the site implementer does not need to do anything to set them up. However, the default “log in” and “password required” forms are only bare-bones HTML pages, and site implementers may wish to replace them with a page customised to their site design.</p>
<div class="section" id="setting-up-a-login-page">
<span id="login-page"></span><h5>Setting up a login page<a class="headerlink" href="#setting-up-a-login-page" title="Permalink to this headline">¶</a></h5>
<p>The basic login page can be customised by setting <code class="docutils literal notranslate"><span class="pre">WAGTAIL_FRONTEND_LOGIN_TEMPLATE</span></code> to the path of a template you wish to use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_FRONTEND_LOGIN_TEMPLATE</span> <span class="o">=</span> <span class="s1">&#39;myapp/login.html&#39;</span>
</pre></div>
</div>
<p>Wagtail uses Django’s standard <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.views.LoginView</span></code> view here, and so the context variables available on the template are as detailed in <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/auth/default/#django.contrib.auth.views.LoginView" title="(in Django v3.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Django's</span> <span class="pre">login</span> <span class="pre">view</span> <span class="pre">documentation</span></code></a>.</p>
<p>If the stock Django login view is not suitable - for example, you wish to use an external authentication system, or you are integrating Wagtail into an existing Django site that already has a working login view - you can specify the URL of the login view via the <code class="docutils literal notranslate"><span class="pre">WAGTAIL_FRONTEND_LOGIN_URL</span></code> setting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_FRONTEND_LOGIN_URL</span> <span class="o">=</span> <span class="s1">&#39;/accounts/login/&#39;</span>
</pre></div>
</div>
<p>To integrate Wagtail into a Django site with an existing login mechanism, setting <code class="docutils literal notranslate"><span class="pre">WAGTAIL_FRONTEND_LOGIN_URL</span> <span class="pre">=</span> <span class="pre">LOGIN_URL</span></code> will usually be sufficient.</p>
</div>
<div class="section" id="setting-up-a-global-password-required-page">
<h5>Setting up a global “password required” page<a class="headerlink" href="#setting-up-a-global-password-required-page" title="Permalink to this headline">¶</a></h5>
<p>By setting <code class="docutils literal notranslate"><span class="pre">PASSWORD_REQUIRED_TEMPLATE</span></code> in your Django settings file, you can specify the path of a template which will be used for all “password required” forms on the site (except for page types that specifically override it - see below):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PASSWORD_REQUIRED_TEMPLATE</span> <span class="o">=</span> <span class="s1">&#39;myapp/password_required.html&#39;</span>
</pre></div>
</div>
<p>This template will receive the same set of context variables that the blocked page would pass to its own template via <code class="docutils literal notranslate"><span class="pre">get_context()</span></code> - including <code class="docutils literal notranslate"><span class="pre">page</span></code> to refer to the page object itself - plus the following additional variables (which override any of the page’s own context variables of the same name):</p>
<ul class="simple">
<li><strong>form</strong> - A Django form object for the password prompt; this will contain a field named <code class="docutils literal notranslate"><span class="pre">password</span></code> as its only visible field. A number of hidden fields may also be present, so the page must loop over <code class="docutils literal notranslate"><span class="pre">form.hidden_fields</span></code> if not using one of Django’s rendering helpers such as <code class="docutils literal notranslate"><span class="pre">form.as_p</span></code>.</li>
<li><strong>action_url</strong> - The URL that the password form should be submitted to, as a POST request.</li>
</ul>
<p>A basic template suitable for use as <code class="docutils literal notranslate"><span class="pre">PASSWORD_REQUIRED_TEMPLATE</span></code> might look like this:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Password required<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Password required<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You need a password to access this page.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">action_url</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

            <span class="cp">{{</span> <span class="nv">form.non_field_errors</span> <span class="cp">}}</span>

            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="cp">{{</span> <span class="nv">form.password.errors</span> <span class="cp">}}</span>
                <span class="cp">{{</span> <span class="nv">form.password.label_tag</span> <span class="cp">}}</span>
                <span class="cp">{{</span> <span class="nv">form.password</span> <span class="cp">}}</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

            <span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="k">in</span> <span class="nv">form.hidden_fields</span> <span class="cp">%}</span>
                <span class="cp">{{</span> <span class="nv">field</span> <span class="cp">}}</span>
            <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Continue&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>Password restrictions on documents use a separate template, specified through the setting <code class="docutils literal notranslate"><span class="pre">DOCUMENT_PASSWORD_REQUIRED_TEMPLATE</span></code>; this template also receives the context variables <code class="docutils literal notranslate"><span class="pre">form</span></code> and <code class="docutils literal notranslate"><span class="pre">action_url</span></code> as described above.</p>
</div>
<div class="section" id="setting-a-password-required-page-for-a-specific-page-type">
<h5>Setting a “password required” page for a specific page type<a class="headerlink" href="#setting-a-password-required-page-for-a-specific-page-type" title="Permalink to this headline">¶</a></h5>
<p>The attribute <code class="docutils literal notranslate"><span class="pre">password_required_template</span></code> can be defined on a page model to use a custom template for the “password required” view, for that page type only. For example, if a site had a page type for displaying embedded videos along with a description, it might choose to use a custom “password required” template that displays the video description as usual, but shows the password form in place of the video embed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">VideoPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">password_required_template</span> <span class="o">=</span> <span class="s1">&#39;video/password_required.html&#39;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-advanced_topics/customisation/index"></span><div class="section" id="customising-wagtail">
<h4>Customising Wagtail<a class="headerlink" href="#customising-wagtail" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-advanced_topics/customisation/page_editing_interface"></span><div class="section" id="customising-the-editing-interface">
<h5>Customising the editing interface<a class="headerlink" href="#customising-the-editing-interface" title="Permalink to this headline">¶</a></h5>
<div class="section" id="customising-the-tabbed-interface">
<span id="id1"></span><h6>Customising the tabbed interface<a class="headerlink" href="#customising-the-tabbed-interface" title="Permalink to this headline">¶</a></h6>
<p>As standard, Wagtail organises panels for pages into three tabs: ‘Content’, ‘Promote’ and ‘Settings’. For snippets Wagtail puts all panels into one page. Depending on the requirements of your site, you may wish to customise this for specific page types or snippets - for example, adding an additional tab for sidebar content. This can be done by specifying an <code class="docutils literal notranslate"><span class="pre">edit_handler</span></code> attribute on the page or snippet model. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">TabbedInterface</span><span class="p">,</span> <span class="n">ObjectList</span>

<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="c1"># field definitions omitted</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">sidebar_content_panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">SnippetChooserPanel</span><span class="p">(</span><span class="s1">&#39;advert&#39;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;related_links&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Related links&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">edit_handler</span> <span class="o">=</span> <span class="n">TabbedInterface</span><span class="p">([</span>
        <span class="n">ObjectList</span><span class="p">(</span><span class="n">content_panels</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s1">&#39;Content&#39;</span><span class="p">),</span>
        <span class="n">ObjectList</span><span class="p">(</span><span class="n">sidebar_content_panels</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s1">&#39;Sidebar content&#39;</span><span class="p">),</span>
        <span class="n">ObjectList</span><span class="p">(</span><span class="n">Page</span><span class="o">.</span><span class="n">promote_panels</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s1">&#39;Promote&#39;</span><span class="p">),</span>
        <span class="n">ObjectList</span><span class="p">(</span><span class="n">Page</span><span class="o">.</span><span class="n">settings_panels</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s1">&#39;Settings&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;settings&quot;</span><span class="p">),</span>
    <span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="rich-text-html">
<span id="rich-text"></span><h6>Rich Text (HTML)<a class="headerlink" href="#rich-text-html" title="Permalink to this headline">¶</a></h6>
<p>Wagtail provides a general-purpose WYSIWYG editor for creating rich text content (HTML) and embedding media such as images, video, and documents. To include this in your models, use the <code class="xref py py-class docutils literal notranslate"><span class="pre">RichTextField</span></code> function when defining a model field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">FieldPanel</span>


<span class="k">class</span> <span class="nc">BookPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">()</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">RichTextField</span></code> inherits from Django’s basic <code class="docutils literal notranslate"><span class="pre">TextField</span></code> field, so you can pass any field parameters into <code class="xref py py-class docutils literal notranslate"><span class="pre">RichTextField</span></code> as if using a normal Django field. This field does not need a special panel and can be defined with <code class="docutils literal notranslate"><span class="pre">FieldPanel</span></code>.</p>
<p>However, template output from <code class="xref py py-class docutils literal notranslate"><span class="pre">RichTextField</span></code> is special and needs to be filtered in order to preserve embedded content. See <a class="reference internal" href="index.html#rich-text-filter"><span class="std std-ref">Rich text (filter)</span></a>.</p>
<div class="section" id="limiting-features-in-a-rich-text-field">
<span id="rich-text-features"></span><h7>Limiting features in a rich text field<a class="headerlink" href="#limiting-features-in-a-rich-text-field" title="Permalink to this headline">¶</a></h7>
<p>By default, the rich text editor provides users with a wide variety of options for text formatting and inserting embedded content such as images. However, we may wish to restrict a rich text field to a more limited set of features - for example:</p>
<ul class="simple">
<li>The field might be intended for a short text snippet, such as a summary to be pulled out on index pages, where embedded images or videos would be inappropriate;</li>
<li>When page content is defined using <a class="reference internal" href="index.html#streamfield"><span class="std std-ref">StreamField</span></a>, elements such as headings, images and videos are usually given their own block types, alongside a rich text block type used for ordinary paragraph text; in this case, allowing headings and images to also exist within the rich text content is redundant (and liable to result in inconsistent designs).</li>
</ul>
<p>This can be achieved by passing a <code class="docutils literal notranslate"><span class="pre">features</span></code> keyword argument to <code class="docutils literal notranslate"><span class="pre">RichTextField</span></code>, with a list of identifiers for the features you wish to allow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;h2&#39;</span><span class="p">,</span> <span class="s1">&#39;h3&#39;</span><span class="p">,</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="s1">&#39;italic&#39;</span><span class="p">,</span> <span class="s1">&#39;link&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The feature identifiers provided on a default Wagtail installation are as follows:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">h1</span></code>, <code class="docutils literal notranslate"><span class="pre">h2</span></code>, <code class="docutils literal notranslate"><span class="pre">h3</span></code>, <code class="docutils literal notranslate"><span class="pre">h4</span></code>, <code class="docutils literal notranslate"><span class="pre">h5</span></code>, <code class="docutils literal notranslate"><span class="pre">h6</span></code> - heading elements</li>
<li><code class="docutils literal notranslate"><span class="pre">bold</span></code>, <code class="docutils literal notranslate"><span class="pre">italic</span></code> - bold / italic text</li>
<li><code class="docutils literal notranslate"><span class="pre">ol</span></code>, <code class="docutils literal notranslate"><span class="pre">ul</span></code> - ordered / unordered lists</li>
<li><code class="docutils literal notranslate"><span class="pre">hr</span></code> - horizontal rules</li>
<li><code class="docutils literal notranslate"><span class="pre">link</span></code> - page, external and email links</li>
<li><code class="docutils literal notranslate"><span class="pre">document-link</span></code> - links to documents</li>
<li><code class="docutils literal notranslate"><span class="pre">image</span></code> - embedded images</li>
<li><code class="docutils literal notranslate"><span class="pre">embed</span></code> - embedded media (see <a class="reference internal" href="index.html#embedded-content"><span class="std std-ref">Embedded content</span></a>)</li>
</ul>
<p>We have few additional feature identifiers as well. They are not enabled by default, but you can use them in your list of identifiers. These are as follows:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">code</span></code> - inline code</li>
<li><code class="docutils literal notranslate"><span class="pre">superscript</span></code>, <code class="docutils literal notranslate"><span class="pre">subscript</span></code>, <code class="docutils literal notranslate"><span class="pre">strikethrough</span></code> - text formatting</li>
<li><code class="docutils literal notranslate"><span class="pre">blockquote</span></code> - blockquote</li>
</ul>
<p>The process for creating new features is described in the following pages:</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#document-extending/rich_text_internals"><span class="doc">Rich text internals</span></a></li>
<li><a class="reference internal" href="index.html#document-extending/extending_draftail"><span class="doc">Extending the Draftail Editor</span></a></li>
<li><a class="reference internal" href="index.html#document-extending/extending_hallo"><span class="doc">Extending the Hallo Editor</span></a></li>
</ul>
</div>
<div class="section" id="image-formats-in-the-rich-text-editor">
<span id="rich-text-image-formats"></span><h7>Image Formats in the Rich Text Editor<a class="headerlink" href="#image-formats-in-the-rich-text-editor" title="Permalink to this headline">¶</a></h7>
<p>On loading, Wagtail will search for any app with the file <code class="docutils literal notranslate"><span class="pre">image_formats.py</span></code> and execute the contents. This provides a way to customise the formatting options shown to the editor when inserting images in the <code class="xref py py-class docutils literal notranslate"><span class="pre">RichTextField</span></code> editor.</p>
<p>As an example, add a “thumbnail” format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># image_formats.py</span>
<span class="kn">from</span> <span class="nn">wagtail.images.formats</span> <span class="kn">import</span> <span class="n">Format</span><span class="p">,</span> <span class="n">register_image_format</span>

<span class="n">register_image_format</span><span class="p">(</span><span class="n">Format</span><span class="p">(</span><span class="s1">&#39;thumbnail&#39;</span><span class="p">,</span> <span class="s1">&#39;Thumbnail&#39;</span><span class="p">,</span> <span class="s1">&#39;richtext-image thumbnail&#39;</span><span class="p">,</span> <span class="s1">&#39;max-120x120&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>To begin, import the <code class="docutils literal notranslate"><span class="pre">Format</span></code> class, <code class="docutils literal notranslate"><span class="pre">register_image_format</span></code> function, and optionally <code class="docutils literal notranslate"><span class="pre">unregister_image_format</span></code> function. To register a new <code class="docutils literal notranslate"><span class="pre">Format</span></code>, call the <code class="docutils literal notranslate"><span class="pre">register_image_format</span></code> with the <code class="docutils literal notranslate"><span class="pre">Format</span></code> object as the argument. The <code class="docutils literal notranslate"><span class="pre">Format</span></code> class takes the following constructor arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>The unique key used to identify the format. To unregister this format, call <code class="docutils literal notranslate"><span class="pre">unregister_image_format</span></code> with this string as the only argument.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">label</span></code></dt>
<dd>The label used in the chooser form when inserting the image into the <code class="xref py py-class docutils literal notranslate"><span class="pre">RichTextField</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">classnames</span></code></dt>
<dd><p class="first">The string to assign to the <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute of the generated <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> tag.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any class names you provide must have CSS rules matching them written separately, as part of the front end CSS code. Specifying a <code class="docutils literal notranslate"><span class="pre">classnames</span></code> value of <code class="docutils literal notranslate"><span class="pre">left</span></code> will only ensure that class is output in the generated markup, it won’t cause the image to align itself left.</p>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">filter_spec</span></code></dt>
<dd>The string specification to create the image rendition. For more, see the <a class="reference internal" href="index.html#image-tag"><span class="std std-ref">How to use images in templates</span></a>.</dd>
</dl>
<p>To unregister, call <code class="docutils literal notranslate"><span class="pre">unregister_image_format</span></code> with the string of the <code class="docutils literal notranslate"><span class="pre">name</span></code> of the <code class="docutils literal notranslate"><span class="pre">Format</span></code> as the only argument.</p>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Unregistering <code class="docutils literal notranslate"><span class="pre">Format</span></code> objects will cause errors viewing or editing pages that reference them.</p>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="customising-generated-forms">
<span id="custom-edit-handler-forms"></span><h6>Customising generated forms<a class="headerlink" href="#customising-generated-forms" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="wagtail.admin.forms.WagtailAdminModelForm">
<em class="property">class </em><code class="descclassname">wagtail.admin.forms.</code><code class="descname">WagtailAdminModelForm</code><a class="headerlink" href="#wagtail.admin.forms.WagtailAdminModelForm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="wagtail.admin.forms.WagtailAdminPageForm">
<em class="property">class </em><code class="descclassname">wagtail.admin.forms.</code><code class="descname">WagtailAdminPageForm</code><a class="headerlink" href="#wagtail.admin.forms.WagtailAdminPageForm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Wagtail automatically generates forms using the panels configured on the model.
By default, this form subclasses <a class="reference internal" href="#wagtail.admin.forms.WagtailAdminModelForm" title="wagtail.admin.forms.WagtailAdminModelForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">WagtailAdminModelForm</span></code></a>,
or <a class="reference internal" href="#wagtail.admin.forms.WagtailAdminPageForm" title="wagtail.admin.forms.WagtailAdminPageForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">WagtailAdminPageForm</span></code></a> for pages.
A custom base form class can be configured by setting the <code class="xref py py-attr docutils literal notranslate"><span class="pre">base_form_class</span></code> attribute on any model.
Custom forms for snippets must subclass <a class="reference internal" href="#wagtail.admin.forms.WagtailAdminModelForm" title="wagtail.admin.forms.WagtailAdminModelForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">WagtailAdminModelForm</span></code></a>,
and custom forms for pages must subclass <a class="reference internal" href="#wagtail.admin.forms.WagtailAdminPageForm" title="wagtail.admin.forms.WagtailAdminPageForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">WagtailAdminPageForm</span></code></a>.</p>
<p>This can be used to add non-model fields to the form, to automatically generate field content,
or to add custom validation logic for your models:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">import</span> <span class="nn">geocoder</span>  <span class="c1"># not in Wagtail, for example only - https://geocoder.readthedocs.io/</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">FieldPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.forms</span> <span class="kn">import</span> <span class="n">WagtailAdminPageForm</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>


<span class="k">class</span> <span class="nc">EventPageForm</span><span class="p">(</span><span class="n">WagtailAdminPageForm</span><span class="p">):</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cleaned_data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>

        <span class="c1"># Make sure that the event starts before it ends</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">start_date</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="ow">and</span> <span class="n">start_date</span> <span class="o">&gt;</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s1">&#39;end_date&#39;</span><span class="p">,</span> <span class="s1">&#39;The end date must be after the start date&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cleaned_data</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">page</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Update the duration field from the submitted dates</span>
        <span class="n">page</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">end_date</span> <span class="o">-</span> <span class="n">page</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>

        <span class="c1"># Fetch the location by geocoding the address</span>
        <span class="n">page</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">geocoder</span><span class="o">.</span><span class="n">arcgis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">commit</span><span class="p">:</span>
            <span class="n">page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">page</span>


<span class="k">class</span> <span class="nc">EventPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;start_date&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;end_date&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">base_form_class</span> <span class="o">=</span> <span class="n">EventPageForm</span>
</pre></div>
</div>
<p>Wagtail will generate a new subclass of this form for the model,
adding any fields defined in <code class="docutils literal notranslate"><span class="pre">panels</span></code> or <code class="docutils literal notranslate"><span class="pre">content_panels</span></code>.
Any fields already defined on the model will not be overridden by these automatically added fields,
so the form field for a model field can be overridden by adding it to the custom form.</p>
</div>
</div>
<span id="document-advanced_topics/customisation/admin_templates"></span><div class="section" id="customising-admin-templates">
<h5>Customising admin templates<a class="headerlink" href="#customising-admin-templates" title="Permalink to this headline">¶</a></h5>
<p>In your projects with Wagtail, you may wish to replace elements such as the Wagtail logo within the admin interface with your own branding. This can be done through Django’s template inheritance mechanism.</p>
<p>You need to create a <code class="docutils literal notranslate"><span class="pre">templates/wagtailadmin/</span></code> folder within one of your apps - this may be an existing one, or a new one created for this purpose, for example, <code class="docutils literal notranslate"><span class="pre">dashboard</span></code>. This app must be registered in <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> before <code class="docutils literal notranslate"><span class="pre">wagtail.admin</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># ...</span>

    <span class="s1">&#39;dashboard&#39;</span><span class="p">,</span>

    <span class="s1">&#39;wagtail.core&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wagtail.admin&#39;</span><span class="p">,</span>

    <span class="c1"># ...</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="section" id="custom-branding">
<span id="id1"></span><h6>Custom branding<a class="headerlink" href="#custom-branding" title="Permalink to this headline">¶</a></h6>
<p>The template blocks that are available to customise the branding in the admin interface are as follows:</p>
<div class="section" id="branding-logo">
<h7><code class="docutils literal notranslate"><span class="pre">branding_logo</span></code><a class="headerlink" href="#branding-logo" title="Permalink to this headline">¶</a></h7>
<p>To replace the default logo, create a template file <code class="docutils literal notranslate"><span class="pre">dashboard/templates/wagtailadmin/base.html</span></code> that overrides the block <code class="docutils literal notranslate"><span class="pre">branding_logo</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailadmin/base.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">branding_logo</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">&#39;images/custom-logo.svg&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Custom Project&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;80&quot;</span> <span class="p">/&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>The logo also appears on the admin 404 error page; to replace it there too, create a template file <code class="docutils literal notranslate"><span class="pre">dashboard/templates/wagtailadmin/404.html</span></code> that overrides the <code class="docutils literal notranslate"><span class="pre">branding_logo</span></code> block.</p>
<p>The logo also appears on the wagtail userbar; to replace it there too, create a template file <code class="docutils literal notranslate"><span class="pre">dashboard/templates/wagtailadmin/userbar/base.html</span></code> that overwrites the <code class="docutils literal notranslate"><span class="pre">branding_logo</span></code> block.</p>
</div>
<div class="section" id="branding-favicon">
<h7><code class="docutils literal notranslate"><span class="pre">branding_favicon</span></code><a class="headerlink" href="#branding-favicon" title="Permalink to this headline">¶</a></h7>
<p>To replace the favicon displayed when viewing admin pages, create a template file <code class="docutils literal notranslate"><span class="pre">dashboard/templates/wagtailadmin/admin_base.html</span></code> that overrides the block <code class="docutils literal notranslate"><span class="pre">branding_favicon</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailadmin/admin_base.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">branding_favicon</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">&#39;images/favicon.ico&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="p">/&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="branding-title">
<h7><code class="docutils literal notranslate"><span class="pre">branding_title</span></code><a class="headerlink" href="#branding-title" title="Permalink to this headline">¶</a></h7>
<p>To replace the title prefix (which is ‘Wagtail’ by default), create a template file <code class="docutils literal notranslate"><span class="pre">dashboard/templates/wagtailadmin/admin_base.html</span></code> that overrides the block <code class="docutils literal notranslate"><span class="pre">branding_title</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailadmin/admin_base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">branding_title</span> <span class="cp">%}</span>Frank&#39;s CMS<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="branding-login">
<h7><code class="docutils literal notranslate"><span class="pre">branding_login</span></code><a class="headerlink" href="#branding-login" title="Permalink to this headline">¶</a></h7>
<p>To replace the login message, create a template file <code class="docutils literal notranslate"><span class="pre">dashboard/templates/wagtailadmin/login.html</span></code> that overrides the block <code class="docutils literal notranslate"><span class="pre">branding_login</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailadmin/login.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">branding_login</span> <span class="cp">%}</span>Sign in to Frank&#39;s Site<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="branding-welcome">
<h7><code class="docutils literal notranslate"><span class="pre">branding_welcome</span></code><a class="headerlink" href="#branding-welcome" title="Permalink to this headline">¶</a></h7>
<p>To replace the welcome message on the dashboard, create a template file <code class="docutils literal notranslate"><span class="pre">dashboard/templates/wagtailadmin/home.html</span></code> that overrides the block <code class="docutils literal notranslate"><span class="pre">branding_welcome</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailadmin/home.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">branding_welcome</span> <span class="cp">%}</span>Welcome to Frank&#39;s Site<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-user-interface-colors">
<span id="id2"></span><h6>Custom user interface colors<a class="headerlink" href="#custom-user-interface-colors" title="Permalink to this headline">¶</a></h6>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>CSS variables are not supported in Internet Explorer, so the admin will appear with the default colors when viewed in that browser.</p>
<p class="last">The default Wagtail colors conform to the WCAG2.1 AA level color contrast requirements. When customizing the admin colors you should test the contrast using tools like <a class="reference external" href="https://www.deque.com/axe/browser-extensions/">Axe</a>.</p>
</div>
<p>To customize the primary color used in the admin user interface, inject a CSS file using the hook <a class="reference internal" href="index.html#insert-global-admin-css"><span class="std std-ref">insert_global_admin_css</span></a> and override the variables within the <code class="docutils literal notranslate"><span class="pre">:root</span></code> selector:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>:root {
    --color-primary-hue: 25;
}
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">color-primary</span></code> is an <a class="reference external" href="https://en.wikipedia.org/wiki/HSL_and_HSV">hsl color</a> composed of 3 CSS variables - <code class="docutils literal notranslate"><span class="pre">--color-primary-hue</span></code> (0-360 with no unit), <code class="docutils literal notranslate"><span class="pre">--color-primary-saturation</span></code> (a percentage), and <code class="docutils literal notranslate"><span class="pre">--color-primary-lightness</span></code> (also a percentage). Separating the color into 3 allows us to calculate variations on the color to use alongside the primary color. If needed, you can also control those variations manually by setting <code class="docutils literal notranslate"><span class="pre">hue</span></code>, <code class="docutils literal notranslate"><span class="pre">saturation</span></code>, and <code class="docutils literal notranslate"><span class="pre">lightness</span></code> variables for the following colors: <code class="docutils literal notranslate"><span class="pre">color-primary-darker</span></code>, <code class="docutils literal notranslate"><span class="pre">color-primary-dark</span></code>, <code class="docutils literal notranslate"><span class="pre">color-primary-lighter</span></code>, <code class="docutils literal notranslate"><span class="pre">color-primary-light</span></code>, <code class="docutils literal notranslate"><span class="pre">color-input-focus</span></code>, and <code class="docutils literal notranslate"><span class="pre">color-input-focus-border</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>:root {
    --color-primary-hue: 25;
    --color-primary-saturation: 100%;
    --color-primary-lightness: 25%;
    --color-primary-darker-hue: 24;
    --color-primary-darker-saturation: 100%;
    --color-primary-darker-lightness: 20%;
    --color-primary-dark-hue: 23;
    --color-primary-dark-saturation: 100%;
    --color-primary-dark-lightness: 15%;
}
</pre></div>
</div>
<p>If instead you intend to set all available colors, you can use any valid css colors:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>:root {
    --color-primary: mediumaquamarine;
    --color-primary-darker: rebeccapurple;
    --color-primary-dark: hsl(330, 100%, 70%);
    --color-primary-lighter: azure;
    --color-primary-light: aliceblue;
    --color-input-focus: rgb(204, 0, 102);
    --color-input-focus-border: #4d0026;
}
</pre></div>
</div>
</div>
<div class="section" id="specifying-a-site-or-page-in-the-branding">
<h6>Specifying a site or page in the branding<a class="headerlink" href="#specifying-a-site-or-page-in-the-branding" title="Permalink to this headline">¶</a></h6>
<p>The admin interface has a number of variables available to the renderer context that can be used to customize the branding in the admin page. These can be useful for customizing the dashboard on a multitenanted Wagtail installation:</p>
<div class="section" id="root-page">
<h7><code class="docutils literal notranslate"><span class="pre">root_page</span></code><a class="headerlink" href="#root-page" title="Permalink to this headline">¶</a></h7>
<p>Returns the highest explorable page object for the currently logged in user. If the user has no explore rights, this will default to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div>
<div class="section" id="root-site">
<h7><code class="docutils literal notranslate"><span class="pre">root_site</span></code><a class="headerlink" href="#root-site" title="Permalink to this headline">¶</a></h7>
<p>Returns the name on the site record for the above root page.</p>
</div>
<div class="section" id="site-name">
<h7><code class="docutils literal notranslate"><span class="pre">site_name</span></code><a class="headerlink" href="#site-name" title="Permalink to this headline">¶</a></h7>
<p>Returns the value of <code class="docutils literal notranslate"><span class="pre">root_site</span></code>, unless it evaluates to <code class="docutils literal notranslate"><span class="pre">None</span></code>. In that case, it will return the value of <code class="docutils literal notranslate"><span class="pre">settings.WAGTAIL_SITE_NAME</span></code>.</p>
<p>To use these variables, create a template file <code class="docutils literal notranslate"><span class="pre">dashboard/templates/wagtailadmin/home.html</span></code>, just as if you were overriding one of the template blocks in the dashboard, and use them as you would any other Django template variable:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailadmin/home.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">branding_welcome</span> <span class="cp">%}</span>Welcome to the Admin Homepage for <span class="cp">{{</span> <span class="nv">root_site</span> <span class="cp">}}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="extending-the-login-form">
<h6>Extending the login form<a class="headerlink" href="#extending-the-login-form" title="Permalink to this headline">¶</a></h6>
<p>To add extra controls to the login form, create a template file <code class="docutils literal notranslate"><span class="pre">dashboard/templates/wagtailadmin/login.html</span></code>.</p>
<div class="section" id="above-login-and-below-login">
<h7><code class="docutils literal notranslate"><span class="pre">above_login</span></code> and <code class="docutils literal notranslate"><span class="pre">below_login</span></code><a class="headerlink" href="#above-login-and-below-login" title="Permalink to this headline">¶</a></h7>
<p>To add content above or below the login form, override these blocks:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailadmin/login.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">above_login</span> <span class="cp">%}</span> If you are not Frank you should not be here! <span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="fields">
<h7><code class="docutils literal notranslate"><span class="pre">fields</span></code><a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h7>
<p>To add extra fields to the login form, override the <code class="docutils literal notranslate"><span class="pre">fields</span></code> block. You will need to add <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">block.super</span> <span class="pre">}}</span></code> somewhere in your block to include the username and password fields:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailadmin/login.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">fields</span> <span class="cp">%}</span>
    <span class="cp">{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;full&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;field iconfield&quot;</span><span class="p">&gt;</span>
            Two factor auth token
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;input icon-key&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;two-factor-auth&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="submit-buttons">
<h7><code class="docutils literal notranslate"><span class="pre">submit_buttons</span></code><a class="headerlink" href="#submit-buttons" title="Permalink to this headline">¶</a></h7>
<p>To add extra buttons to the login form, override the <code class="docutils literal notranslate"><span class="pre">submit_buttons</span></code> block. You will need to add <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">block.super</span> <span class="pre">}}</span></code> somewhere in your block to include the sign in button:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailadmin/login.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">submit_buttons</span> <span class="cp">%}</span>
    <span class="cp">{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;signup&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button&quot;</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">trans</span> <span class="s1">&#39;Sign up&#39;</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="login-form">
<h7><code class="docutils literal notranslate"><span class="pre">login_form</span></code><a class="headerlink" href="#login-form" title="Permalink to this headline">¶</a></h7>
<p>To completely customise the login form, override the <code class="docutils literal notranslate"><span class="pre">login_form</span></code> block. This block wraps the whole contents of the <code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code> element:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailadmin/login.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">login_form</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Some extra form content<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="extending-client-side-components">
<span id="extending-clientside-components"></span><h6>Extending client-side components<a class="headerlink" href="#extending-client-side-components" title="Permalink to this headline">¶</a></h6>
<p>Some of Wagtail’s admin interface is written as client-side JavaScript with <a class="reference external" href="https://reactjs.org/">React</a>.
In order to customise or extend those components, you may need to use React too, as well as other related libraries.
To make this easier, Wagtail exposes its React-related dependencies as global variables within the admin. Here are the available packages:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// &#39;focus-trap-react&#39;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">FocusTrapReact</span><span class="p">;</span>
<span class="c1">// &#39;react&#39;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">React</span><span class="p">;</span>
<span class="c1">// &#39;react-dom&#39;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">ReactDOM</span><span class="p">;</span>
<span class="c1">// &#39;react-transition-group/CSSTransitionGroup&#39;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">CSSTransitionGroup</span><span class="p">;</span>
</pre></div>
</div>
<p>Wagtail also exposes some of its own React components. You can reuse:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">wagtail</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">Icon</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">wagtail</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">Portal</span><span class="p">;</span>
</pre></div>
</div>
<p>Pages containing rich text editors also have access to:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// &#39;draft-js&#39;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">DraftJS</span><span class="p">;</span>
<span class="c1">// &#39;draftail&#39;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">Draftail</span><span class="p">;</span>

<span class="c1">// Wagtail’s Draftail-related APIs and components.</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">draftail</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">draftail</span><span class="p">.</span><span class="nx">ModalWorkflowSource</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">draftail</span><span class="p">.</span><span class="nx">ImageModalWorkflowSource</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">draftail</span><span class="p">.</span><span class="nx">EmbedModalWorkflowSource</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">draftail</span><span class="p">.</span><span class="nx">LinkModalWorkflowSource</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">draftail</span><span class="p">.</span><span class="nx">DocumentModalWorkflowSource</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">draftail</span><span class="p">.</span><span class="nx">Tooltip</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">draftail</span><span class="p">.</span><span class="nx">TooltipEntity</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-advanced_topics/customisation/custom_user_models"></span><div class="section" id="custom-user-models">
<h5>Custom user models<a class="headerlink" href="#custom-user-models" title="Permalink to this headline">¶</a></h5>
<div class="section" id="custom-user-forms-example">
<h6>Custom user forms example<a class="headerlink" href="#custom-user-forms-example" title="Permalink to this headline">¶</a></h6>
<p>This example shows how to add a text field and foreign key field to a custom user model
and configure Wagtail user forms to allow the fields values to be updated.</p>
<p>Create a custom user model. This must at minimum inherit from <code class="docutils literal notranslate"><span class="pre">AbstractBaseUser</span></code> and <code class="docutils literal notranslate"><span class="pre">PermissionsMixin</span></code>. In this case we extend the <code class="docutils literal notranslate"><span class="pre">AbstractUser</span></code> class and add two fields. The foreign key references another model (not shown).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">AbstractUser</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">MembershipStatus</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Add the app containing your user model to <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> - it must be above the <code class="docutils literal notranslate"><span class="pre">'wagtail.users'</span></code> line,
in order to override Wagtail’s built-in templates - and set <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/auth/customizing/#substituting-a-custom-user-model">AUTH_USER_MODEL</a> to reference
your model. In this example the app is called <code class="docutils literal notranslate"><span class="pre">users</span></code> and the model is <code class="docutils literal notranslate"><span class="pre">User</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">AUTH_USER_MODEL</span> <span class="o">=</span> <span class="s1">&#39;users.User&#39;</span>
</pre></div>
</div>
<p>Create your custom user ‘create’ and ‘edit’ forms in your app:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="kn">from</span> <span class="nn">wagtail.users.forms</span> <span class="kn">import</span> <span class="n">UserEditForm</span><span class="p">,</span> <span class="n">UserCreationForm</span>

<span class="kn">from</span> <span class="nn">users.models</span> <span class="kn">import</span> <span class="n">MembershipStatus</span>


<span class="k">class</span> <span class="nc">CustomUserEditForm</span><span class="p">(</span><span class="n">UserEditForm</span><span class="p">):</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Country&quot;</span><span class="p">))</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">MembershipStatus</span><span class="o">.</span><span class="n">objects</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">CustomUserCreationForm</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Country&quot;</span><span class="p">))</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">MembershipStatus</span><span class="o">.</span><span class="n">objects</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Extend the Wagtail user ‘create’ and ‘edit’ templates. These extended templates should be placed in a
template directory <code class="docutils literal notranslate"><span class="pre">wagtailusers/users</span></code>.</p>
<p>Template create.html:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailusers/users/create.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra_fields</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;wagtailadmin/shared/field_as_li.html&quot;</span> <span class="k">with</span> <span class="nv">field</span><span class="o">=</span><span class="nv">form.country</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;wagtailadmin/shared/field_as_li.html&quot;</span> <span class="k">with</span> <span class="nv">field</span><span class="o">=</span><span class="nv">form.status</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">extra_fields</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Template edit.html:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailusers/users/edit.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra_fields</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;wagtailadmin/shared/field_as_li.html&quot;</span> <span class="k">with</span> <span class="nv">field</span><span class="o">=</span><span class="nv">form.country</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;wagtailadmin/shared/field_as_li.html&quot;</span> <span class="k">with</span> <span class="nv">field</span><span class="o">=</span><span class="nv">form.status</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">extra_fields</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">extra_fields</span></code> block allows fields to be inserted below the <code class="docutils literal notranslate"><span class="pre">last_name</span></code> field
in the default templates. Other block overriding options exist to allow appending
fields to the end or beginning of the existing fields, or to allow all the fields to
be redefined.</p>
<p>Add the wagtail settings to your project to reference the user form additions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_USER_EDIT_FORM</span> <span class="o">=</span> <span class="s1">&#39;users.forms.CustomUserEditForm&#39;</span>
<span class="n">WAGTAIL_USER_CREATION_FORM</span> <span class="o">=</span> <span class="s1">&#39;users.forms.CustomUserCreationForm&#39;</span>
<span class="n">WAGTAIL_USER_CUSTOM_FIELDS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<span id="document-advanced_topics/customisation/streamfield_blocks"></span><div class="section" id="how-to-build-custom-streamfield-blocks">
<span id="custom-streamfield-blocks"></span><h5>How to build custom StreamField blocks<a class="headerlink" href="#how-to-build-custom-streamfield-blocks" title="Permalink to this headline">¶</a></h5>
<div class="section" id="custom-editing-interfaces-for-structblock">
<span id="id1"></span><h6>Custom editing interfaces for <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code><a class="headerlink" href="#custom-editing-interfaces-for-structblock" title="Permalink to this headline">¶</a></h6>
<p>To customise the styling of a <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> as it appears in the page editor, you can specify a <code class="docutils literal notranslate"><span class="pre">form_classname</span></code> attribute (either as a keyword argument to the <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> constructor, or in a subclass’s <code class="docutils literal notranslate"><span class="pre">Meta</span></code>) to override the default value of <code class="docutils literal notranslate"><span class="pre">struct-block</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PersonBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">surname</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">ImageChooserBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">biography</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
        <span class="n">form_classname</span> <span class="o">=</span> <span class="s1">&#39;person-block struct-block&#39;</span>
</pre></div>
</div>
<p>You can then provide custom CSS for this block, targeted at the specified classname, by using the <a class="reference internal" href="index.html#insert-editor-css"><span class="std std-ref">insert_editor_css</span></a> hook.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Wagtail’s editor styling has some built in styling for the <code class="docutils literal notranslate"><span class="pre">struct-block</span></code> class and other related elements. If you specify a value for <code class="docutils literal notranslate"><span class="pre">form_classname</span></code>, it will overwrite the classes that are already applied to <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code>, so you must remember to specify the <code class="docutils literal notranslate"><span class="pre">struct-block</span></code> as well.</p>
</div>
<p>For more extensive customisations that require changes to the HTML markup as well, you can override the <code class="docutils literal notranslate"><span class="pre">form_template</span></code> attribute in <code class="docutils literal notranslate"><span class="pre">Meta</span></code> to specify your own template path. The following variables are available on this template:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">children</span></code></dt>
<dd>An <code class="docutils literal notranslate"><span class="pre">OrderedDict</span></code> of <code class="docutils literal notranslate"><span class="pre">BoundBlock</span></code>s for all of the child blocks making up this <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">help_text</span></code></dt>
<dd>The help text for this block, if specified.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">classname</span></code></dt>
<dd>The class name passed as <code class="docutils literal notranslate"><span class="pre">form_classname</span></code> (defaults to <code class="docutils literal notranslate"><span class="pre">struct-block</span></code>).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">block_definition</span></code></dt>
<dd>The <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> instance that defines this block.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">prefix</span></code></dt>
<dd>The prefix used on form fields for this block instance, guaranteed to be unique across the form.</dd>
</dl>
<p>To add additional variables, you can override the block’s <code class="docutils literal notranslate"><span class="pre">get_form_context</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PersonBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">surname</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">ImageChooserBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">biography</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_form_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_form_context</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;suggested_first_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;Paul&#39;</span><span class="p">,</span> <span class="s1">&#39;George&#39;</span><span class="p">,</span> <span class="s1">&#39;Ringo&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">context</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
        <span class="n">form_template</span> <span class="o">=</span> <span class="s1">&#39;myapp/block_forms/person.html&#39;</span>
</pre></div>
</div>
<p>A form template for a StructBlock must include the output of <code class="docutils literal notranslate"><span class="pre">render_form</span></code> for each child block in the <code class="docutils literal notranslate"><span class="pre">children</span></code> dict, inside a container element with a <code class="docutils literal notranslate"><span class="pre">data-contentpath</span></code> attribute equal to the block’s name. This attribute is used by the commenting framework to attach comments to the correct fields. The StructBlock’s form template is also responsible for rendering labels for each field, but this (and all other HTML markup) can be customised as you see fit. The template below replicates the default StructBlock form rendering:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailadmin_tags</span>  <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">classname</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">help_text</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;help&quot;</span><span class="p">&gt;</span>
                <span class="cp">{%</span> <span class="k">icon</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;help&quot;</span> <span class="nv">class_name</span><span class="o">=</span><span class="s2">&quot;default&quot;</span> <span class="cp">%}</span>
                <span class="cp">{{</span> <span class="nv">help_text</span> <span class="cp">}}</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">child</span> <span class="k">in</span> <span class="nv">children.values</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;field </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">child.block.required</span> <span class="cp">%}</span><span class="s">required</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="na">data-contentpath</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">child.block.name</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">if</span> <span class="nv">child.block.label</span> <span class="cp">%}</span>
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;field__label&quot;</span> <span class="cp">{%</span> <span class="k">if</span> <span class="nv">child.id_for_label</span> <span class="cp">%}</span><span class="na">for</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">child.id_for_label</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">child.block.label</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
            <span class="cp">{{</span> <span class="nv">child.render_form</span> <span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.13: </span>The <code class="docutils literal notranslate"><span class="pre">data-contentpath</span></code> attribute is now required on a containing element around the <code class="docutils literal notranslate"><span class="pre">render_form</span></code> output.</p>
</div>
</div>
<div class="section" id="additional-javascript-on-structblock-forms">
<h6>Additional JavaScript on <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> forms<a class="headerlink" href="#additional-javascript-on-structblock-forms" title="Permalink to this headline">¶</a></h6>
<p>Often it may be desirable to attach custom JavaScript behaviour to a StructBlock form. For example, given a block such as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AddressBlock</span><span class="p">(</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="n">street</span> <span class="o">=</span> <span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">town</span> <span class="o">=</span> <span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">CharBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">ChoiceBlock</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;us&#39;</span><span class="p">,</span> <span class="s1">&#39;United States&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ca&#39;</span><span class="p">,</span> <span class="s1">&#39;Canada&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;mx&#39;</span><span class="p">,</span> <span class="s1">&#39;Mexico&#39;</span><span class="p">),</span>
    <span class="p">])</span>
</pre></div>
</div>
<p>we may wish to disable the ‘state’ field when a country other than United States is selected. Since new blocks can be added dynamically, we need to integrate with StreamField’s own front-end logic to ensure that our custom JavaScript code is executed when a new block is initialised.</p>
<p>StreamField uses the <a class="reference external" href="https://wagtail.github.io/telepath/">telepath</a> library to map Python block classes such as <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> to a corresponding JavaScript implementation. These JavaScript implementations can be accessed through the <code class="docutils literal notranslate"><span class="pre">window.wagtailStreamField.blocks</span></code> namespace, as the following classes:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">FieldBlockDefinition</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ListBlockDefinition</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">StaticBlockDefinition</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">StreamBlockDefinition</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">StructBlockDefinition</span></code></li>
</ul>
<p>First, we define a telepath adapter for <code class="docutils literal notranslate"><span class="pre">AddressBlock</span></code>, so that it uses our own JavaScript class in place of the default <code class="docutils literal notranslate"><span class="pre">StructBlockDefinition</span></code>. This can be done in the same module as the <code class="docutils literal notranslate"><span class="pre">AddressBlock</span></code> definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core.blocks.struct_block</span> <span class="kn">import</span> <span class="n">StructBlockAdapter</span>
<span class="kn">from</span> <span class="nn">wagtail.core.telepath</span> <span class="kn">import</span> <span class="n">register</span>
<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.utils.functional</span> <span class="kn">import</span> <span class="n">cached_property</span>

<span class="k">class</span> <span class="nc">AddressBlockAdapter</span><span class="p">(</span><span class="n">StructBlockAdapter</span><span class="p">):</span>
    <span class="n">js_constructor</span> <span class="o">=</span> <span class="s1">&#39;myapp.blocks.AddressBlock&#39;</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">media</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">structblock_media</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">media</span>
        <span class="k">return</span> <span class="n">forms</span><span class="o">.</span><span class="n">Media</span><span class="p">(</span>
            <span class="n">js</span><span class="o">=</span><span class="n">structblock_media</span><span class="o">.</span><span class="n">_js</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;js/address-block.js&#39;</span><span class="p">],</span>
            <span class="n">css</span><span class="o">=</span><span class="n">structblock_media</span><span class="o">.</span><span class="n">_css</span>
        <span class="p">)</span>

<span class="n">register</span><span class="p">(</span><span class="n">AddressBlockAdapter</span><span class="p">(),</span> <span class="n">AddressBlock</span><span class="p">)</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">'myapp.blocks.AddressBlock'</span></code> is the identifier for our JavaScript class that will be registered with the telepath client-side code, and <code class="docutils literal notranslate"><span class="pre">'js/address-block.js'</span></code> is the file that defines it (as a path within any static file location recognised by Django). This implementation subclasses StructBlockDefinition and adds our custom code to the <code class="docutils literal notranslate"><span class="pre">render</span></code> method:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nx">AddressBlockDefinition</span> <span class="k">extends</span> <span class="nb">window</span><span class="p">.</span><span class="nx">wagtailStreamField</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">StructBlockDefinition</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">,</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">initialError</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">block</span> <span class="o">=</span> <span class="k">super</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">,</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">initialError</span><span class="p">);</span>

        <span class="kd">const</span> <span class="nx">stateField</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39;-state&#39;</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">countryField</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39;-country&#39;</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">updateStateInput</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">countryField</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;us&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">stateField</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">stateField</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">updateStateInput</span><span class="p">();</span>
        <span class="nx">countryField</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">updateStateInput</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">block</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">telepath</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;myapp.blocks.AddressBlock&#39;</span><span class="p">,</span> <span class="nx">AddressBlockDefinition</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that this code makes use of ES6 language features that are unavailable in IE11 - if IE11 support is required, this could be rewritten as:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">AddressBlockDefinition</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">wagtailStreamField</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">StructBlockDefinition</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">AddressBlockDefinition</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">,</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">initialError</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">block</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">wagtailStreamField</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">StructBlockDefinition</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">render</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span>
        <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span>
    <span class="p">);</span>

    <span class="kd">var</span> <span class="nx">stateField</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39;-state&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">countryField</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39;-country&#39;</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">updateStateInput</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">countryField</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;us&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">stateField</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">stateField</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">updateStateInput</span><span class="p">();</span>
    <span class="nx">countryField</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">updateStateInput</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">block</span><span class="p">;</span>
<span class="p">}</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">telepath</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;myapp.blocks.AddressBlock&#39;</span><span class="p">,</span> <span class="nx">AddressBlockDefinition</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="additional-methods-and-properties-on-structblock-values">
<span id="custom-value-class-for-structblock"></span><h6>Additional methods and properties on <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> values<a class="headerlink" href="#additional-methods-and-properties-on-structblock-values" title="Permalink to this headline">¶</a></h6>
<p>When rendering StreamField content on a template, StructBlock values are represented as <code class="docutils literal notranslate"><span class="pre">dict</span></code>-like objects where the keys correspond to the names of the child blocks. Specifically, these values are instances of the class <code class="docutils literal notranslate"><span class="pre">wagtail.core.blocks.StructValue</span></code>.</p>
<p>Sometimes, it’s desirable to make additional methods or properties available on this object. For example, given a StructBlock that represents either an internal or external link:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LinkBlock</span><span class="p">(</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">CharBlock</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;link text&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">PageChooserBlock</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;page&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">external_url</span> <span class="o">=</span> <span class="n">URLBlock</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;external URL&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>you may want to make a <code class="docutils literal notranslate"><span class="pre">url</span></code> property available, that returns either the page URL or external URL depending which one was filled in. A common mistake is to define this property on the block class itself:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LinkBlock</span><span class="p">(</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">CharBlock</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;link text&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">PageChooserBlock</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;page&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">external_url</span> <span class="o">=</span> <span class="n">URLBlock</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;external URL&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># INCORRECT - will not work</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">url</span>
</pre></div>
</div>
<p>This does not work because the value as seen in the template is not an instance of <code class="docutils literal notranslate"><span class="pre">LinkBlock</span></code>. <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> instances only serve as specifications for the block’s behaviour, and do not hold block data in their internal state - in this respect, they are similar to Django’s form widget objects (which provide methods for rendering a given value as a form field, but do not hold on to the value itself).</p>
<p>Instead, you should define a subclass of <code class="docutils literal notranslate"><span class="pre">StructValue</span></code> that implements your custom property or method. Within this method, the block’s data can be accessed as <code class="docutils literal notranslate"><span class="pre">self['page']</span></code> or <code class="docutils literal notranslate"><span class="pre">self.get('page')</span></code>, since <code class="docutils literal notranslate"><span class="pre">StructValue</span></code> is a dict-like object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core.blocks</span> <span class="kn">import</span> <span class="n">StructValue</span>


<span class="k">class</span> <span class="nc">LinkStructValue</span><span class="p">(</span><span class="n">StructValue</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">external_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;external_url&#39;</span><span class="p">)</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">external_url</span> <span class="ow">or</span> <span class="n">page</span><span class="o">.</span><span class="n">url</span>
</pre></div>
</div>
<p>Once this is defined, set the block’s <code class="docutils literal notranslate"><span class="pre">value_class</span></code> option to instruct it to use this class rather than a plain StructValue:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LinkBlock</span><span class="p">(</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">CharBlock</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;link text&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">PageChooserBlock</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;page&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">external_url</span> <span class="o">=</span> <span class="n">URLBlock</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;external URL&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">value_class</span> <span class="o">=</span> <span class="n">LinkStructValue</span>
</pre></div>
</div>
<p>Your extended value class methods will now be available in your template:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nb">block</span> <span class="k">in</span> <span class="nv">page.body</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nb">block</span><span class="nv">.block_type</span> <span class="o">==</span> <span class="s1">&#39;link&#39;</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">link.value.url</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">link.value.text</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-block-types">
<h6>Custom block types<a class="headerlink" href="#custom-block-types" title="Permalink to this headline">¶</a></h6>
<p>If you need to implement a custom UI, or handle a datatype that is not provided by Wagtail’s built-in block types (and cannot be built up as a structure of existing fields), it is possible to define your own custom block types. For further guidance, refer to the source code of Wagtail’s built-in block classes.</p>
<p>For block types that simply wrap an existing Django form field, Wagtail provides an abstract class <code class="docutils literal notranslate"><span class="pre">wagtail.core.blocks.FieldBlock</span></code> as a helper. Subclasses should set a <code class="docutils literal notranslate"><span class="pre">field</span></code> property that returns the form field object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IPAddressBlock</span><span class="p">(</span><span class="n">FieldBlock</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">GenericIPAddressField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">help_text</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>Since the StreamField editing interface needs to create blocks dynamically, certain complex widget types will need additional JavaScript code to define how to render and populate them on the client-side. If a field uses a widget type that does not inherit from one of the classes inheriting from <code class="docutils literal notranslate"><span class="pre">django.forms.widgets.Input</span></code>, <code class="docutils literal notranslate"><span class="pre">django.forms.Textarea</span></code>, <code class="docutils literal notranslate"><span class="pre">django.forms.Select</span></code> or <code class="docutils literal notranslate"><span class="pre">django.forms.RadioSelect</span></code>, or has customised client-side behaviour to the extent where it is not possible to read or write its data simply by accessing the form element’s <code class="docutils literal notranslate"><span class="pre">value</span></code> property, you will need to provide a JavaScript handler object, implementing the methods detailed on <a class="reference internal" href="index.html#streamfield-widget-api"><span class="std std-ref">Form widget client-side API</span></a>.</p>
</div>
<div class="section" id="handling-block-definitions-within-migrations">
<h6>Handling block definitions within migrations<a class="headerlink" href="#handling-block-definitions-within-migrations" title="Permalink to this headline">¶</a></h6>
<p>As with any model field in Django, any changes to a model definition that affect a StreamField will result in a migration file that contains a ‘frozen’ copy of that field definition. Since a StreamField definition is more complex than a typical model field, there is an increased likelihood of definitions from your project being imported into the migration – which would cause problems later on if those definitions are moved or deleted.</p>
<p>To mitigate this, StructBlock, StreamBlock and ChoiceBlock implement additional logic to ensure that any subclasses of these blocks are deconstructed to plain instances of StructBlock, StreamBlock and ChoiceBlock – in this way, the migrations avoid having any references to your custom class definitions. This is possible because these block types provide a standard pattern for inheritance, and know how to reconstruct the block definition for any subclass that follows that pattern.</p>
<p>If you subclass any other block class, such as <code class="docutils literal notranslate"><span class="pre">FieldBlock</span></code>, you will need to either keep that class definition in place for the lifetime of your project, or implement a <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/migrations/#custom-deconstruct-method" title="(in Django v3.2)"><span class="xref std std-ref">custom deconstruct method</span></a> that expresses your block entirely in terms of classes that are guaranteed to remain in place. Similarly, if you customise a StructBlock, StreamBlock or ChoiceBlock subclass to the point where it can no longer be expressed as an instance of the basic block type – for example, if you add extra arguments to the constructor – you will need to provide your own <code class="docutils literal notranslate"><span class="pre">deconstruct</span></code> method.</p>
</div>
</div>
</div>
</div>
<span id="document-advanced_topics/third_party_tutorials"></span><div class="section" id="third-party-tutorials">
<h4>Third-party tutorials<a class="headerlink" href="#third-party-tutorials" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The following list is a collection of tutorials and development notes from third-party developers.
Some of the older links may not apply to the latest Wagtail versions.</p>
</div>
<ul class="simple">
<li><a class="reference external" href="https://mpettersson.com/blog/how-to-add-and-configure-a-mail-service-in-django-or-wagtail/">Add &amp; Configure Mail in Django (or Wagtail) using Sendgrid</a> (28 May 2021)</li>
<li><a class="reference external" href="https://medium.com/engineerx/advanced-django-development-how-to-build-a-professional-cms-for-any-business-part-1-9859cb5b4d24">Advanced Django Development: How to build a professional CMS for any business? (3 part tutorial)</a> (2 April 2021)</li>
<li><a class="reference external" href="https://experiencednovice.dev/blog/matomo-analytics-with-wagtailcms/">Matomo Analytics with WagtailCMS</a> (31 March 2021)</li>
<li><a class="reference external" href="https://www.accordbox.com/blog/dockerizing-wagtail-app/">Dockerizing a Wagtail App</a> (16 March 2021)</li>
<li><a class="reference external" href="https://experiencednovice.dev/blog/deploying-wagtail-on-centos8/">Deploying Wagtail on CentOS8 with MariaDB/Nginx/Gunicorn</a> (7 March 2021)</li>
<li><a class="reference external" href="https://www.coderedcorp.com/blog/how-to-alternate-blocks-in-your-templates/">How To Alternate Blocks in Your Django &amp; Wagtail Templates</a> (19 February 2021)</li>
<li><a class="reference external" href="https://www.accordbox.com/blog/build-blog-wagtail-cms-second-version-available/">Build a Blog With Wagtail CMS (second version)</a> (13 January 2021)</li>
<li><a class="reference external" href="https://www.cnc.io/en/blog/wagtailtrans-to-wagtail-localize-migration">Migrate your Wagtail Website from wagtailtrans to the new wagtail-localize</a> (10 January 2021)</li>
<li><a class="reference external" href="https://steelkiwi.com/blog/how-to-use-the-wagtail-cms-for-django-an-overview/">How to Use the Wagtail CMS for Django: An Overview</a> (21 December 2020)</li>
<li><a class="reference external" href="https://www.theinsidetrade.com/blog/install-and-deploy-wagtail-cms-pythonanywherecom/">Install and Deploy Wagtail CMS on pythonanywhere.com</a> (14 December 2020)</li>
<li><a class="reference external" href="https://www.yellowduck.be/posts/overriding-the-admin-css-in-wagtail/">Overriding the admin CSS in Wagtail</a> (4 December 2020)</li>
<li><a class="reference external" href="https://www.yellowduck.be/posts/migrating-your-wagtail-site-to-a-different-database-engine/">Migrating your Wagtail site to a different database engine</a> (3 December 2020)</li>
<li><a class="reference external" href="https://dev.to/brian101co/wagtail-for-django-devs-create-a-developer-portfolio-5e75">Wagtail for Django Devs: Create a Developer Portfolio</a> (30 November 2020)</li>
<li><a class="reference external" href="https://engineertodeveloper.com/category/wagtail/">Create a Developer Portfolio with Wagtail Tutorial Series</a> (11 November 2020)</li>
<li><a class="reference external" href="https://www.codista.com/en/blog/wagtail-instagram-new-oembed-api/">Wagtail Instagram New oEmbed API</a> (5 November 2020)</li>
<li><a class="reference external" href="https://dev.to/lb/image-uploads-in-wagtail-forms-39pl">Image upload in wagtail forms</a> (21 October 2020)</li>
<li><a class="reference external" href="https://spapas.github.io/2020/09/18/wagtail-add-posts-timeline/">Adding a timeline of your wagtail Posts</a> (18 September 2020)</li>
<li><a class="reference external" href="https://medium.com/&#64;ochieng.grace/migrate-wagtail-application-database-from-sqlite-to-postgresql-32f705f2f5f4">Migrate Wagtail Application Database from SQLite to PostgreSQL</a> (5 June 2020)</li>
<li><a class="reference external" href="https://devs-group.medium.com/why-our-websites-stay-ahead-c608e3f4bea4">How to Build Scalable Websites with Wagtail and Nuxt</a> (14 May 2020)</li>
<li><a class="reference external" href="https://dev.to/codista_/wagtail-multi-language-and-internationalization-2gkf">Wagtail multi-language and internationalization</a> (8 April 2020)</li>
<li><a class="reference external" href="https://www.accordbox.com/blog/wagtail-seo-guide/">Wagtail SEO Guide</a> (30 March 2020)</li>
<li><a class="reference external" href="https://spapas.github.io/2020/03/27/wagtail-add-latest-changes/">Adding a latest-changes list to your Wagtail site</a> (27 March 2020)</li>
<li><a class="reference external" href="https://www.accordbox.com/blog/how-support-multi-language-wagtail-cms/">How to support multi-language in Wagtail CMS</a> (22 February 2020)</li>
<li><a class="reference external" href="https://rosederwelt.com/deploying-my-wagtail-blog-digital-ocean-pt-1/">Deploying my Wagtail blog to Digital Ocean</a> Part 1 of a 2 part series (29 January 2020)</li>
<li><a class="reference external" href="https://www.accordbox.com/blog/wagtail-tutorial-12-how-create-and-manage-menus-wagtail-application/">How to Create and Manage Menus of Wagtail application</a> - An updated overview of implementing menus (22 February 2020)</li>
<li><a class="reference external" href="https://dev.to/lb/adding-a-react-component-in-wagtail-admin-3e">Adding a React component in Wagtail Admin</a> - Shows how to render an interactive timeline of published Pages (30 December 2019)</li>
<li><a class="reference external" href="https://dev.to/wagtail/wagtail-api-how-to-customize-the-detail-url-2j3l">Wagtail API - how to customize the detail URL</a> (19 December 2020)</li>
<li><a class="reference external" href="https://dev.to/revsys/how-to-add-django-models-to-the-wagtail-admin-1mdi">How to Add Django Models to the Wagtail Admin</a> (27 August 2019)</li>
<li><a class="reference external" href="https://foundation.mozilla.org/en/docs/how-do-i-wagtail/">How do I Wagtail</a> - An Editor’s Guide for Mozilla’s usage of Wagtail (25 April 2019)</li>
<li><a class="reference external" href="https://learnwagtail.com/">Learn Wagtail</a> - Regular video tutorials about all aspects of Wagtail (1 March 2019)</li>
<li><a class="reference external" href="https://timonweb.com/tutorials/how-to-add-buttons-to-modeladmin-index-view-in-wagtail-cms/">How to add buttons to ModelAdmin Index View in Wagtail CMS</a> (23 January 2019)</li>
<li><a class="reference external" href="https://www.accordbox.com/blog/wagtail-tutorials/">Wagtail Tutorial Series</a> (20 January 2019)</li>
<li><a class="reference external" href="https://www.youtube.com/watch?v=uD9PTag2-PQ">How to Deploy Wagtail to Google App Engine PaaS (Video)</a> (18 December 2018)</li>
<li><a class="reference external" href="https://timonweb.com/tutorials/prevent-users-from-creating-certain-page-types-in-wagtail-cms/">How To Prevent Users From Creating Pages by Page Type</a> (25 October 2018)</li>
<li><a class="reference external" href="https://jelastic.com/blog/deploy-wagtail-python-cms/">How to Deploy Wagtail to Jelastic PaaS</a> (11 October 2018)</li>
<li><a class="reference external" href="https://medium.com/nonstopio/wagtail-an-open-source-cms-cec6b93706da">Basic Introduction to Setting Up Wagtail</a> (15 August 2018)</li>
<li><a class="reference external" href="https://snipcart.com/blog/django-ecommerce-tutorial-wagtail-cms">E-Commerce for Django developers (with Wagtail shop tutorial)</a> (5 July 2018)</li>
<li><a class="reference external" href="https://wagtail.io/blog/graphql-with-streamfield/">Supporting StreamFields, Snippets and Images in a Wagtail GraphQL API</a> (14 June 2018)</li>
<li><a class="reference external" href="https://jossingram.wordpress.com/2018/04/19/wagtail-and-graphql/">Wagtail and GraphQL</a> (19 April 2018)</li>
<li><a class="reference external" href="https://jossingram.wordpress.com/2017/11/29/wagtail-and-azure-storage-blob-containers/">Wagtail and Azure storage blob containers</a> (29 November 2017)</li>
<li><a class="reference external" href="https://www.twilio.com/blog/2017/11/building-twilioquest-with-twilio-sync-django-and-vue-js.html">Building TwilioQuest with Twilio Sync, Django [incl. Wagtail], and Vue.js</a> (6 November 2017)</li>
<li><a class="reference external" href="https://www.caktusgroup.com/blog/2017/07/19/upgrading-wagtail/">Upgrading from Wagtail 1.0 to Wagtail 1.11</a> (19 July 2017)</li>
<li><a class="reference external" href="https://github.com/cristovao-alves/Wagtail-Multilingual">Wagtail-Multilingual: a simple project to demonstrate how multilingual is implemented</a> (31 January 2017)</li>
<li><a class="reference external" href="https://www.caktusgroup.com/blog/2016/02/15/wagtail-2-steps-adding-pages-outside-cms/">Wagtail: 2 Steps for Adding Pages Outside of the CMS</a> (15 February 2016)</li>
<li><a class="reference external" href="https://jossingram.wordpress.com/2015/04/02/adding-a-twitter-widget-for-wagtails-new-streamfield/">Adding a Twitter Widget for Wagtail’s new StreamField</a> (2 April 2015)</li>
<li><a class="reference external" href="https://www.tivix.com/blog/working-with-wagtail-menus/">Working With Wagtail: Menus</a> (22 January 2015)</li>
<li><a class="reference external" href="https://jossingram.wordpress.com/2014/12/10/upgrading-wagtail-to-use-django-1-7-locally-using-vagrant/">Upgrading Wagtail to use Django 1.7 locally using vagrant</a> (10 December 2014)</li>
<li><a class="reference external" href="https://gist.github.com/alej0varas/e7e334643ceab6e65744">Wagtail redirect page. Can link to page, URL and document</a> (24 September 2014)</li>
<li><a class="reference external" href="https://jossingram.wordpress.com/2014/09/24/outputing-json-for-a-model-with-properties-and-db-fields-in-wagtaildjango/">Outputing JSON for a model with properties and db fields in Wagtail/Django</a> (24 September 2014)</li>
<li><a class="reference external" href="https://jossingram.wordpress.com/2014/09/17/bi-lingual-website-using-wagtail-cms/">Bi-lingual website using Wagtail CMS</a> (17 September 2014)</li>
<li><a class="reference external" href="https://jossingram.wordpress.com/2014/09/12/wagtail-cms-lesser-known-features/">Wagtail CMS – Lesser known features</a> (12 September 2014)</li>
<li><a class="reference external" href="https://www.coactivate.org/projects/ejucovy/blog/2014/08/09/wagtail-notes-stateful-onoff-hallojs-plugins/">Wagtail notes: stateful on/off hallo.js plugins</a> (9 August 2014)</li>
<li><a class="reference external" href="https://jossingram.wordpress.com/2014/07/24/add-some-blockquote-buttons-to-wagtail-cms-wysiwyg-editor/">Add some blockquote buttons to Wagtail CMS’ WYSIWYG Editor</a> (24 July 2014)</li>
<li><a class="reference external" href="https://jossingram.wordpress.com/2014/07/01/adding-bread-crumbs-to-the-front-end-in-wagtail-cms/">Adding Bread Crumbs to the front end in Wagtail CMS</a> (1 July 2014)</li>
<li><a class="reference external" href="https://gist.github.com/jeffrey-hearn/502d0914fa4a930f08ac">Extending hallo.js using Wagtail hooks</a> (9 July 2014)</li>
<li><a class="reference external" href="https://www.coactivate.org/projects/ejucovy/blog/2014/05/10/wagtail-notes-custom-tabs-per-page-type/">Wagtail notes: custom tabs per page type</a> (10 May 2014)</li>
<li><a class="reference external" href="https://www.coactivate.org/projects/ejucovy/blog/2014/05/10/wagtail-notes-managing-redirects-as-pages/">Wagtail notes: managing redirects as pages</a> (10 May 2014)</li>
<li><a class="reference external" href="https://www.coactivate.org/projects/ejucovy/blog/2014/05/10/wagtail-notes-dynamic-templates-per-page/">Wagtail notes: dynamic templates per page</a> (10 May 2014)</li>
<li><a class="reference external" href="https://www.coactivate.org/projects/ejucovy/blog/2014/05/09/wagtail-notes-type-constrained-pagechooserpanel/">Wagtail notes: type-constrained PageChooserPanel</a> (9 May 2014)</li>
</ul>
<p>You can also find more resources from the community on <a class="reference external" href="https://github.com/springload/awesome-wagtail">Awesome Wagtail</a>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">We are working on a collection of Wagtail tutorials and best practices. Please tweet <a class="reference external" href="https://twitter.com/WagtailCMS">&#64;WagtailCMS</a> or <a class="reference external" href="mailto:hello&#37;&#52;&#48;wagtail&#46;io">contact us directly</a> to share your Wagtail HOWTOs, development notes or site launches.</p>
</div>
</div>
<span id="document-advanced_topics/testing"></span><div class="section" id="testing-your-wagtail-site">
<span id="reference"></span><h4>Testing your Wagtail site<a class="headerlink" href="#testing-your-wagtail-site" title="Permalink to this headline">¶</a></h4>
<p>Wagtail comes with some utilities that simplify writing tests for your site.</p>
<span class="target" id="module-wagtail.tests.utils"></span><div class="section" id="wagtailpagetests">
<h5>WagtailPageTests<a class="headerlink" href="#wagtailpagetests" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="wagtail.tests.utils.WagtailPageTests">
<em class="property">class </em><code class="descclassname">wagtail.tests.utils.</code><code class="descname">WagtailPageTests</code><a class="headerlink" href="#wagtail.tests.utils.WagtailPageTests" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">WagtailPageTests</span></code> extends <code class="docutils literal notranslate"><span class="pre">django.test.TestCase</span></code>, adding a few new <code class="docutils literal notranslate"><span class="pre">assert</span></code> methods. You should extend this class to make use of its methods:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.tests.utils</span> <span class="kn">import</span> <span class="n">WagtailPageTests</span>
<span class="kn">from</span> <span class="nn">myapp.models</span> <span class="kn">import</span> <span class="n">MyPage</span>

<span class="k">class</span> <span class="nc">MyPageTests</span><span class="p">(</span><span class="n">WagtailPageTests</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_can_create_a_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<dl class="method">
<dt id="wagtail.tests.utils.WagtailPageTests.assertCanCreateAt">
<code class="descname">assertCanCreateAt</code><span class="sig-paren">(</span><em>parent_model</em>, <em>child_model</em>, <em>msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.tests.utils.WagtailPageTests.assertCanCreateAt" title="Permalink to this definition">¶</a></dt>
<dd><p>Assert a particular child Page type can be created under a parent
Page type. <code class="docutils literal notranslate"><span class="pre">parent_model</span></code> and <code class="docutils literal notranslate"><span class="pre">child_model</span></code> should be the Page
classes being tested.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_can_create_under_home_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># You can create a ContentPage under a HomePage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertCanCreateAt</span><span class="p">(</span><span class="n">HomePage</span><span class="p">,</span> <span class="n">ContentPage</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.tests.utils.WagtailPageTests.assertCanNotCreateAt">
<code class="descname">assertCanNotCreateAt</code><span class="sig-paren">(</span><em>parent_model</em>, <em>child_model</em>, <em>msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.tests.utils.WagtailPageTests.assertCanNotCreateAt" title="Permalink to this definition">¶</a></dt>
<dd><p>Assert a particular child Page type can not be created under a parent
Page type. <code class="docutils literal notranslate"><span class="pre">parent_model</span></code> and <code class="docutils literal notranslate"><span class="pre">child_model</span></code> should be the Page
classes being tested.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_cant_create_under_event_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># You can not create a ContentPage under an EventPage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertCanNotCreateAt</span><span class="p">(</span><span class="n">EventPage</span><span class="p">,</span> <span class="n">ContentPage</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.tests.utils.WagtailPageTests.assertCanCreate">
<code class="descname">assertCanCreate</code><span class="sig-paren">(</span><em>parent</em>, <em>child_model</em>, <em>data</em>, <em>msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.tests.utils.WagtailPageTests.assertCanCreate" title="Permalink to this definition">¶</a></dt>
<dd><p>Assert that a child of the given Page type can be created under the
parent, using the supplied POST data.</p>
<p><code class="docutils literal notranslate"><span class="pre">parent</span></code> should be a Page instance, and <code class="docutils literal notranslate"><span class="pre">child_model</span></code> should be a
Page subclass. <code class="docutils literal notranslate"><span class="pre">data</span></code> should be a dict that will be POSTed at the
Wagtail admin Page creation method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.tests.utils.form_data</span> <span class="kn">import</span> <span class="n">nested_form_data</span><span class="p">,</span> <span class="n">streamfield</span>

<span class="k">def</span> <span class="nf">test_can_create_content_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Get the HomePage</span>
    <span class="n">root_page</span> <span class="o">=</span> <span class="n">HomePage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Assert that a ContentPage can be made here, with this POST data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertCanCreate</span><span class="p">(</span><span class="n">root_page</span><span class="p">,</span> <span class="n">ContentPage</span><span class="p">,</span> <span class="n">nested_form_data</span><span class="p">({</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;About us&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">streamfield</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;Lorem ipsum dolor sit amet&#39;</span><span class="p">),</span>
        <span class="p">])</span>
    <span class="p">}))</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#form-data-test-helpers"><span class="std std-ref">Form data helpers</span></a> for a set of functions useful for constructing POST data.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.tests.utils.WagtailPageTests.assertAllowedParentPageTypes">
<code class="descname">assertAllowedParentPageTypes</code><span class="sig-paren">(</span><em>child_model</em>, <em>parent_models</em>, <em>msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.tests.utils.WagtailPageTests.assertAllowedParentPageTypes" title="Permalink to this definition">¶</a></dt>
<dd><p>Test that the only page types that <code class="docutils literal notranslate"><span class="pre">child_model</span></code> can be created under
are <code class="docutils literal notranslate"><span class="pre">parent_models</span></code>.</p>
<p>The list of allowed parent models may differ from those set in
<code class="docutils literal notranslate"><span class="pre">Page.parent_page_types</span></code>, if the parent models have set
<code class="docutils literal notranslate"><span class="pre">Page.subpage_types</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_content_page_parent_pages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># A ContentPage can only be created under a HomePage</span>
    <span class="c1"># or another ContentPage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertAllowedParentPageTypes</span><span class="p">(</span>
        <span class="n">ContentPage</span><span class="p">,</span> <span class="p">{</span><span class="n">HomePage</span><span class="p">,</span> <span class="n">ContentPage</span><span class="p">})</span>

    <span class="c1"># An EventPage can only be created under an EventIndex</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertAllowedParentPageTypes</span><span class="p">(</span>
        <span class="n">EventPage</span><span class="p">,</span> <span class="p">{</span><span class="n">EventIndex</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.tests.utils.WagtailPageTests.assertAllowedSubpageTypes">
<code class="descname">assertAllowedSubpageTypes</code><span class="sig-paren">(</span><em>parent_model</em>, <em>child_models</em>, <em>msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.tests.utils.WagtailPageTests.assertAllowedSubpageTypes" title="Permalink to this definition">¶</a></dt>
<dd><p>Test that the only page types that can be created under
<code class="docutils literal notranslate"><span class="pre">parent_model</span></code> are <code class="docutils literal notranslate"><span class="pre">child_models</span></code>.</p>
<p>The list of allowed child models may differ from those set in
<code class="docutils literal notranslate"><span class="pre">Page.subpage_types</span></code>, if the child models have set
<code class="docutils literal notranslate"><span class="pre">Page.parent_page_types</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_content_page_subpages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># A ContentPage can only have other ContentPage children</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertAllowedSubpageTypes</span><span class="p">(</span>
        <span class="n">ContentPage</span><span class="p">,</span> <span class="p">{</span><span class="n">ContentPage</span><span class="p">})</span>

    <span class="c1"># A HomePage can have ContentPage and EventIndex children</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertAllowedParentPageTypes</span><span class="p">(</span>
        <span class="n">HomePage</span><span class="p">,</span> <span class="p">{</span><span class="n">ContentPage</span><span class="p">,</span> <span class="n">EventIndex</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-wagtail.tests.utils.form_data">
<span id="form-data-helpers"></span><span id="form-data-test-helpers"></span><h5>Form data helpers<a class="headerlink" href="#module-wagtail.tests.utils.form_data" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">assertCanCreate</span></code> method requires page data to be passed in
the same format that the page edit form would submit. For complex
page types, it can be difficult to construct this data structure by hand;
the <code class="docutils literal notranslate"><span class="pre">wagtail.tests.utils.form_data</span></code> module provides a set of helper
functions to assist with this.</p>
<dl class="function">
<dt id="wagtail.tests.utils.form_data.nested_form_data">
<code class="descclassname">wagtail.tests.utils.form_data.</code><code class="descname">nested_form_data</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.tests.utils.form_data.nested_form_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Translates a nested dict structure into a flat form data dict
with hyphen-separated keys.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nested_form_data</span><span class="p">({</span>
    <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
    <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;child&#39;</span><span class="p">:</span> <span class="s1">&#39;field&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">})</span>
<span class="c1"># Returns: {&#39;foo&#39;: &#39;bar&#39;, &#39;parent-child&#39;: &#39;field&#39;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wagtail.tests.utils.form_data.rich_text">
<code class="descclassname">wagtail.tests.utils.form_data.</code><code class="descname">rich_text</code><span class="sig-paren">(</span><em>value</em>, <em>editor='default'</em>, <em>features=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.tests.utils.form_data.rich_text" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts an HTML-like rich text string to the data format required by
the currently active rich text editor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>editor</strong> – An alternative editor name as defined in <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_RICH_TEXT_EDITORS</span></code></li>
<li><strong>features</strong> – A list of features allowed in the rich text content (see <a class="reference internal" href="index.html#rich-text-features"><span class="std std-ref">Limiting features in a rich text field</span></a>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">assertCanCreate</span><span class="p">(</span><span class="n">root_page</span><span class="p">,</span> <span class="n">ContentPage</span><span class="p">,</span> <span class="n">nested_form_data</span><span class="p">({</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;About us&#39;</span><span class="p">,</span>
    <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">rich_text</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;Lorem ipsum dolor sit amet&lt;/p&gt;&#39;</span><span class="p">),</span>
<span class="p">}))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wagtail.tests.utils.form_data.streamfield">
<code class="descclassname">wagtail.tests.utils.form_data.</code><code class="descname">streamfield</code><span class="sig-paren">(</span><em>items</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.tests.utils.form_data.streamfield" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a list of (block_type, value) tuples and turns it in to
StreamField form data. Use this within a <a class="reference internal" href="#wagtail.tests.utils.form_data.nested_form_data" title="wagtail.tests.utils.form_data.nested_form_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">nested_form_data()</span></code></a>
call, with the field name as the key.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nested_form_data</span><span class="p">({</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">streamfield</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;Hello, world&#39;</span><span class="p">),</span>
<span class="p">])})</span>
<span class="c1"># Returns:</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;content-count&#39;: &#39;1&#39;,</span>
<span class="c1">#     &#39;content-0-type&#39;: &#39;text&#39;,</span>
<span class="c1">#     &#39;content-0-value&#39;: &#39;Hello, world&#39;,</span>
<span class="c1">#     &#39;content-0-order&#39;: &#39;0&#39;,</span>
<span class="c1">#     &#39;content-0-deleted&#39;: &#39;&#39;,</span>
<span class="c1"># }</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wagtail.tests.utils.form_data.inline_formset">
<code class="descclassname">wagtail.tests.utils.form_data.</code><code class="descname">inline_formset</code><span class="sig-paren">(</span><em>items</em>, <em>initial=0</em>, <em>min=0</em>, <em>max=1000</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.tests.utils.form_data.inline_formset" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a list of form data for an InlineFormset and translates
it in to valid POST data. Use this within a <a class="reference internal" href="#wagtail.tests.utils.form_data.nested_form_data" title="wagtail.tests.utils.form_data.nested_form_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">nested_form_data()</span></code></a>
call, with the formset relation name as the key.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nested_form_data</span><span class="p">({</span><span class="s1">&#39;lines&#39;</span><span class="p">:</span> <span class="n">inline_formset</span><span class="p">([</span>
    <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;Hello&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;World&#39;</span><span class="p">},</span>
<span class="p">])})</span>
<span class="c1"># Returns:</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;lines-TOTAL_FORMS&#39;: &#39;2&#39;,</span>
<span class="c1">#     &#39;lines-INITIAL_FORMS&#39;: &#39;0&#39;,</span>
<span class="c1">#     &#39;lines-MIN_NUM_FORMS&#39;: &#39;0&#39;,</span>
<span class="c1">#     &#39;lines-MAX_NUM_FORMS&#39;: &#39;1000&#39;,</span>
<span class="c1">#     &#39;lines-0-text&#39;: &#39;Hello&#39;,</span>
<span class="c1">#     &#39;lines-0-ORDER&#39;: &#39;0&#39;,</span>
<span class="c1">#     &#39;lines-0-DELETE&#39;: &#39;&#39;,</span>
<span class="c1">#     &#39;lines-1-text&#39;: &#39;World&#39;,</span>
<span class="c1">#     &#39;lines-1-ORDER&#39;: &#39;1&#39;,</span>
<span class="c1">#     &#39;lines-1-DELETE&#39;: &#39;&#39;,</span>
<span class="c1"># }</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="fixtures">
<h5>Fixtures<a class="headerlink" href="#fixtures" title="Permalink to this headline">¶</a></h5>
<div class="section" id="using-dumpdata">
<h6>Using <code class="docutils literal notranslate"><span class="pre">dumpdata</span></code><a class="headerlink" href="#using-dumpdata" title="Permalink to this headline">¶</a></h6>
<p>Creating <a class="reference external" href="https://docs.djangoproject.com/en/stable/howto/initial-data/" title="(in Django v3.2)"><span class="xref std std-doc">fixtures</span></a> for tests is best done by creating content in a development
environment, and using Django’s <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/django-admin/#django-admin-dumpdata">dumpdata</a> command.</p>
<p>Note that by default <code class="docutils literal notranslate"><span class="pre">dumpdata</span></code> will represent <code class="docutils literal notranslate"><span class="pre">content_type</span></code> by the primary key; this may cause consistency issues when adding / removing models, as content types are populated separately from fixtures. To prevent this, use the <code class="docutils literal notranslate"><span class="pre">--natural-foreign</span></code> switch, which represents content types by <code class="docutils literal notranslate"><span class="pre">[&quot;app&quot;,</span> <span class="pre">&quot;model&quot;]</span></code> instead.</p>
</div>
<div class="section" id="manual-modification">
<h6>Manual modification<a class="headerlink" href="#manual-modification" title="Permalink to this headline">¶</a></h6>
<p>You could modify the dumped fixtures manually, or even write them all by hand.
Here are a few things to be wary of.</p>
<div class="section" id="custom-page-models">
<h7>Custom Page models<a class="headerlink" href="#custom-page-models" title="Permalink to this headline">¶</a></h7>
<p>When creating customised Page models in fixtures, you will need to add both a
<code class="docutils literal notranslate"><span class="pre">wagtailcore.page</span></code> entry, and one for your custom Page model.</p>
<p>Let’s say you have a <code class="docutils literal notranslate"><span class="pre">website</span></code> module which defines a <code class="docutils literal notranslate"><span class="pre">Homepage(Page)</span></code> class.
You could create such a homepage in a fixture with:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;wagtailcore.page&quot;</span><span class="p">,</span>
    <span class="nt">&quot;pk&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="nt">&quot;fields&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;My Customer&#39;s Homepage&quot;</span><span class="p">,</span>
      <span class="nt">&quot;content_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;website&quot;</span><span class="p">,</span> <span class="s2">&quot;homepage&quot;</span><span class="p">],</span>
      <span class="nt">&quot;depth&quot;</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;website.homepage&quot;</span><span class="p">,</span>
    <span class="nt">&quot;pk&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="nt">&quot;fields&quot;</span><span class="p">:</span> <span class="p">{}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="treebeard-fields">
<h7>Treebeard fields<a class="headerlink" href="#treebeard-fields" title="Permalink to this headline">¶</a></h7>
<p>Filling in the <code class="docutils literal notranslate"><span class="pre">path</span></code> / <code class="docutils literal notranslate"><span class="pre">numchild</span></code> / <code class="docutils literal notranslate"><span class="pre">depth</span></code> fields is necessary in order for tree operations like <code class="docutils literal notranslate"><span class="pre">get_parent()</span></code> to work correctly.
<code class="docutils literal notranslate"><span class="pre">url_path</span></code> is another field that can cause errors in some uncommon cases if it isn’t filled in.</p>
<p>The <a class="reference external" href="https://django-treebeard.readthedocs.io/en/latest/mp_tree.html">Treebeard docs</a> might help in understanding how this works.</p>
</div>
</div>
</div>
</div>
<span id="document-advanced_topics/api/index"></span><div class="section" id="wagtail-api">
<h4>Wagtail API<a class="headerlink" href="#wagtail-api" title="Permalink to this headline">¶</a></h4>
<p>The API module provides a public-facing, JSON-formatted API to allow retrieving
content as raw field data. This is useful for cases like serving content to
non-web clients (such as a mobile phone app) or pulling content out of Wagtail
for use in another site.</p>
<p>See <a class="reference external" href="https://github.com/wagtail/rfcs/blob/main/text/008-wagtail-api.md#12---stable-and-unstable-versions">RFC 8: Wagtail API</a>
for full details on our stabilisation policy.</p>
<div class="toctree-wrapper compound">
<span id="document-advanced_topics/api/v2/configuration"></span><div class="section" id="wagtail-api-v2-configuration-guide">
<span id="api-v2-configuration"></span><h5>Wagtail API v2 Configuration Guide<a class="headerlink" href="#wagtail-api-v2-configuration-guide" title="Permalink to this headline">¶</a></h5>
<p>This section of the docs will show you how to set up a public API for your
Wagtail site.</p>
<p>Even though the API is built on Django REST Framework, you do not need to
install this manually as it is already a dependency of Wagtail.</p>
<div class="section" id="basic-configuration">
<h6>Basic configuration<a class="headerlink" href="#basic-configuration" title="Permalink to this headline">¶</a></h6>
<div class="section" id="enable-the-app">
<h7>Enable the app<a class="headerlink" href="#enable-the-app" title="Permalink to this headline">¶</a></h7>
<p>Firstly, you need to enable Wagtail’s API app so Django can see it.
Add <code class="docutils literal notranslate"><span class="pre">wagtail.api.v2</span></code> to <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> in your Django project settings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># settings.py</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>

    <span class="s1">&#39;wagtail.api.v2&#39;</span><span class="p">,</span>

    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Optionally, you may also want to add <code class="docutils literal notranslate"><span class="pre">rest_framework</span></code> to <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>.
This would make the API browsable when viewed from a web browser but is not
required for basic JSON-formatted output.</p>
</div>
<div class="section" id="configure-endpoints">
<h7>Configure endpoints<a class="headerlink" href="#configure-endpoints" title="Permalink to this headline">¶</a></h7>
<p>Next, it’s time to configure which content will be exposed on the API. Each
content type (such as pages, images and documents) has its own endpoint.
Endpoints are combined by a router, which provides the url configuration you
can hook into the rest of your project.</p>
<p>Wagtail provides three endpoint classes you can use:</p>
<ul class="simple">
<li>Pages <code class="xref py py-class docutils literal notranslate"><span class="pre">wagtail.api.v2.views.PagesAPIViewSet</span></code></li>
<li>Images <code class="xref py py-class docutils literal notranslate"><span class="pre">wagtail.images.api.v2.views.ImagesAPIViewSet</span></code></li>
<li>Documents <code class="xref py py-class docutils literal notranslate"><span class="pre">wagtail.documents.api.v2.views.DocumentsAPIViewSet</span></code></li>
</ul>
<p>You can subclass any of these endpoint classes to customise their functionality.
Additionally, there is a base endpoint class you can use for adding different
content types to the API: <code class="xref py py-class docutils literal notranslate"><span class="pre">wagtail.api.v2.views.BaseAPIViewSet</span></code></p>
<p>For this example, we will create an API that includes all three builtin content
types in their default configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># api.py</span>

<span class="kn">from</span> <span class="nn">wagtail.api.v2.views</span> <span class="kn">import</span> <span class="n">PagesAPIViewSet</span>
<span class="kn">from</span> <span class="nn">wagtail.api.v2.router</span> <span class="kn">import</span> <span class="n">WagtailAPIRouter</span>
<span class="kn">from</span> <span class="nn">wagtail.images.api.v2.views</span> <span class="kn">import</span> <span class="n">ImagesAPIViewSet</span>
<span class="kn">from</span> <span class="nn">wagtail.documents.api.v2.views</span> <span class="kn">import</span> <span class="n">DocumentsAPIViewSet</span>

<span class="c1"># Create the router. &quot;wagtailapi&quot; is the URL namespace</span>
<span class="n">api_router</span> <span class="o">=</span> <span class="n">WagtailAPIRouter</span><span class="p">(</span><span class="s1">&#39;wagtailapi&#39;</span><span class="p">)</span>

<span class="c1"># Add the three endpoints using the &quot;register_endpoint&quot; method.</span>
<span class="c1"># The first parameter is the name of the endpoint (eg. pages, images). This</span>
<span class="c1"># is used in the URL of the endpoint</span>
<span class="c1"># The second parameter is the endpoint class that handles the requests</span>
<span class="n">api_router</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span><span class="s1">&#39;pages&#39;</span><span class="p">,</span> <span class="n">PagesAPIViewSet</span><span class="p">)</span>
<span class="n">api_router</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="n">ImagesAPIViewSet</span><span class="p">)</span>
<span class="n">api_router</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">,</span> <span class="n">DocumentsAPIViewSet</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, register the URLs so Django can route requests into the API:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">api_router</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>

    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/v2/&#39;</span><span class="p">,</span> <span class="n">api_router</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>

    <span class="o">...</span>

    <span class="c1"># Ensure that the api_router line appears above the default Wagtail page serving route</span>
    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtail_urls</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>With this configuration, pages will be available at <code class="docutils literal notranslate"><span class="pre">/api/v2/pages/</span></code>, images
at <code class="docutils literal notranslate"><span class="pre">/api/v2/images/</span></code> and documents at <code class="docutils literal notranslate"><span class="pre">/api/v2/documents/</span></code></p>
</div>
<div class="section" id="adding-custom-page-fields">
<span id="apiv2-page-fields-configuration"></span><h7>Adding custom page fields<a class="headerlink" href="#adding-custom-page-fields" title="Permalink to this headline">¶</a></h7>
<p>It’s likely that you would need to export some custom fields over the API. This
can be done by adding a list of fields to be exported into the <code class="docutils literal notranslate"><span class="pre">api_fields</span></code>
attribute for each page model.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># blog/models.py</span>

<span class="kn">from</span> <span class="nn">wagtail.api</span> <span class="kn">import</span> <span class="n">APIField</span>

<span class="k">class</span> <span class="nc">BlogPageAuthor</span><span class="p">(</span><span class="n">Orderable</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;blog.BlogPage&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;authors&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>

    <span class="n">api_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">APIField</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
    <span class="p">]</span>


<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">published_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">()</span>
    <span class="n">feed_image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;wagtailimages.Image&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="n">private_field</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>

    <span class="c1"># Export fields over the API</span>
    <span class="n">api_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">APIField</span><span class="p">(</span><span class="s1">&#39;published_date&#39;</span><span class="p">),</span>
        <span class="n">APIField</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
        <span class="n">APIField</span><span class="p">(</span><span class="s1">&#39;feed_image&#39;</span><span class="p">),</span>
        <span class="n">APIField</span><span class="p">(</span><span class="s1">&#39;authors&#39;</span><span class="p">),</span>  <span class="c1"># This will nest the relevant BlogPageAuthor objects in the API response</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>This will make <code class="docutils literal notranslate"><span class="pre">published_date</span></code>, <code class="docutils literal notranslate"><span class="pre">body</span></code>, <code class="docutils literal notranslate"><span class="pre">feed_image</span></code> and a list of
<code class="docutils literal notranslate"><span class="pre">authors</span></code> with the <code class="docutils literal notranslate"><span class="pre">name</span></code> field available in the API. But to access these
fields, you must select the <code class="docutils literal notranslate"><span class="pre">blog.BlogPage</span></code> type using the <code class="docutils literal notranslate"><span class="pre">?type</span></code>
<a class="reference internal" href="index.html#apiv2-custom-page-fields"><span class="std std-ref">parameter in the API itself</span></a>.</p>
</div>
<div class="section" id="custom-serialisers">
<h7>Custom serialisers<a class="headerlink" href="#custom-serialisers" title="Permalink to this headline">¶</a></h7>
<p><a class="reference external" href="https://www.django-rest-framework.org/api-guide/fields/">Serialisers</a> are used to convert the database representation of a model into
JSON format. You can override the serialiser for any field using the
<code class="docutils literal notranslate"><span class="pre">serializer</span></code> keyword argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework.fields</span> <span class="kn">import</span> <span class="n">DateField</span>

<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">api_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Change the format of the published_date field to &quot;Thursday 06 April 2017&quot;</span>
        <span class="n">APIField</span><span class="p">(</span><span class="s1">&#39;published_date&#39;</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="n">DateField</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%A </span><span class="si">%d</span><span class="s1"> %B %Y&#39;</span><span class="p">)),</span>
        <span class="o">...</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Django REST framework’s serializers can all take a <a class="reference external" href="https://www.django-rest-framework.org/api-guide/fields/#source">source</a> argument allowing you
to add API fields that have a different field name or no underlying field at all:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework.fields</span> <span class="kn">import</span> <span class="n">DateField</span>

<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">api_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Date in ISO8601 format (the default)</span>
        <span class="n">APIField</span><span class="p">(</span><span class="s1">&#39;published_date&#39;</span><span class="p">),</span>

        <span class="c1"># A separate published_date_display field with a different format</span>
        <span class="n">APIField</span><span class="p">(</span><span class="s1">&#39;published_date_display&#39;</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="n">DateField</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%A $d %B %Y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;published_date&#39;</span><span class="p">)),</span>
        <span class="o">...</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>This adds two fields to the API (other fields omitted for brevity):</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;published_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-04-06&quot;</span><span class="p">,</span>
    <span class="nt">&quot;published_date_display&quot;</span><span class="p">:</span> <span class="s2">&quot;Thursday 06 April 2017&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="images-in-the-api">
<h7>Images in the API<a class="headerlink" href="#images-in-the-api" title="Permalink to this headline">¶</a></h7>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">ImageRenditionField</span></code> serialiser
allows you to add renditions of images into your API. It requires an image
filter string specifying the resize operations to perform on the image. It can
also take the <code class="docutils literal notranslate"><span class="pre">source</span></code> keyword argument described above.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.images.api.fields</span> <span class="kn">import</span> <span class="n">ImageRenditionField</span>

<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">api_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Adds information about the source image (eg, title) into the API</span>
        <span class="n">APIField</span><span class="p">(</span><span class="s1">&#39;feed_image&#39;</span><span class="p">),</span>

        <span class="c1"># Adds a URL to a rendered thumbnail of the image to the API</span>
        <span class="n">APIField</span><span class="p">(</span><span class="s1">&#39;feed_image_thumbnail&#39;</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="n">ImageRenditionField</span><span class="p">(</span><span class="s1">&#39;fill-100x100&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;feed_image&#39;</span><span class="p">)),</span>
        <span class="o">...</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>This would add the following to the JSON:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;feed_image&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">45529</span><span class="p">,</span>
        <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;wagtailimages.Image&quot;</span><span class="p">,</span>
            <span class="nt">&quot;detail_url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://www.example.com/api/v2/images/12/&quot;</span><span class="p">,</span>
            <span class="nt">&quot;download_url&quot;</span><span class="p">:</span> <span class="s2">&quot;/media/images/a_test_image.jpg&quot;</span><span class="p">,</span>
            <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">},</span>
        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;A test image&quot;</span><span class="p">,</span>
        <span class="nt">&quot;width&quot;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="nt">&quot;height&quot;</span><span class="p">:</span> <span class="mi">1125</span>
    <span class="p">},</span>
    <span class="nt">&quot;feed_image_thumbnail&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/media/images/a_test_image.fill-100x100.jpg&quot;</span><span class="p">,</span>
        <span class="nt">&quot;width&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="nt">&quot;height&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="nt">&quot;alt&quot;</span><span class="p">:</span> <span class="s2">&quot;image alt text&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note: <code class="docutils literal notranslate"><span class="pre">download_url</span></code> is the original uploaded file path, whereas
<code class="docutils literal notranslate"><span class="pre">feed_image_thumbnail['url']</span></code> is the url of the rendered image.
When you are using another storage backend, such as S3, <code class="docutils literal notranslate"><span class="pre">download_url</span></code> will return
a URL to the image if your media files are properly configured.</p>
</div>
</div>
<div class="section" id="additional-settings">
<h6>Additional settings<a class="headerlink" href="#additional-settings" title="Permalink to this headline">¶</a></h6>
<div class="section" id="wagtailapi-base-url">
<h7><code class="docutils literal notranslate"><span class="pre">WAGTAILAPI_BASE_URL</span></code><a class="headerlink" href="#wagtailapi-base-url" title="Permalink to this headline">¶</a></h7>
<p>(required when using frontend cache invalidation)</p>
<p>This is used in two places, when generating absolute URLs to document files and
invalidating the cache.</p>
<p>Generating URLs to documents will fall back the the current request’s hostname
if this is not set. Cache invalidation cannot do this, however, so this setting
must be set when using this module alongside the <code class="docutils literal notranslate"><span class="pre">wagtailfrontendcache</span></code> module.</p>
</div>
<div class="section" id="wagtailapi-search-enabled">
<h7><code class="docutils literal notranslate"><span class="pre">WAGTAILAPI_SEARCH_ENABLED</span></code><a class="headerlink" href="#wagtailapi-search-enabled" title="Permalink to this headline">¶</a></h7>
<p>(default: True)</p>
<p>Setting this to false will disable full text search. This applies to all
endpoints.</p>
</div>
<div class="section" id="wagtailapi-limit-max">
<h7><code class="docutils literal notranslate"><span class="pre">WAGTAILAPI_LIMIT_MAX</span></code><a class="headerlink" href="#wagtailapi-limit-max" title="Permalink to this headline">¶</a></h7>
<p>(default: 20)</p>
<p>This allows you to change the maximum number of results a user can request at a
time. This applies to all endpoints. Set to <code class="docutils literal notranslate"><span class="pre">None</span></code> for no limit.</p>
</div>
</div>
</div>
<span id="document-advanced_topics/api/v2/usage"></span><div class="section" id="wagtail-api-v2-usage-guide">
<h5><a class="toc-backref" href="#id1">Wagtail API v2 Usage Guide</a><a class="headerlink" href="#wagtail-api-v2-usage-guide" title="Permalink to this headline">¶</a></h5>
<p>The Wagtail API module exposes a public, read only, JSON-formatted API which
can be used by external clients (such as a mobile app) or the site’s frontend.</p>
<p>This document is intended for developers using the API exposed by Wagtail. For
documentation on how to enable the API module in your Wagtail site, see
<a class="reference internal" href="index.html#document-advanced_topics/api/v2/configuration"><span class="doc">Wagtail API v2 Configuration Guide</span></a></p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#wagtail-api-v2-usage-guide" id="id1">Wagtail API v2 Usage Guide</a><ul>
<li><a class="reference internal" href="#fetching-content" id="id2">Fetching content</a><ul>
<li><a class="reference internal" href="#example-response" id="id3">Example response</a></li>
<li><a class="reference internal" href="#custom-page-fields-in-the-api" id="id4">Custom page fields in the API</a></li>
<li><a class="reference internal" href="#pagination" id="id5">Pagination</a></li>
<li><a class="reference internal" href="#ordering" id="id6">Ordering</a><ul>
<li><a class="reference internal" href="#random-ordering" id="id7">Random ordering</a></li>
</ul>
</li>
<li><a class="reference internal" href="#filtering" id="id8">Filtering</a></li>
<li><a class="reference internal" href="#filtering-by-tree-position-pages-only" id="id9">Filtering by tree position (pages only)</a></li>
<li><a class="reference internal" href="#search" id="id10">Search</a><ul>
<li><a class="reference internal" href="#search-operator" id="id11">Search operator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#special-filters-for-internationalised-sites" id="id12">Special filters for internationalised sites</a><ul>
<li><a class="reference internal" href="#filtering-pages-by-locale" id="id13">Filtering pages by locale</a></li>
<li><a class="reference internal" href="#getting-translations-of-a-page" id="id14">Getting translations of a page</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fields" id="id15">Fields</a><ul>
<li><a class="reference internal" href="#additional-fields" id="id16">Additional fields</a></li>
<li><a class="reference internal" href="#all-fields" id="id17">All fields</a></li>
<li><a class="reference internal" href="#removing-fields" id="id18">Removing fields</a></li>
<li><a class="reference internal" href="#removing-all-default-fields" id="id19">Removing all default fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#detail-views" id="id20">Detail views</a></li>
<li><a class="reference internal" href="#finding-pages-by-html-path" id="id21">Finding pages by HTML path</a></li>
</ul>
</li>
<li><a class="reference internal" href="#default-endpoint-fields" id="id22">Default endpoint fields</a><ul>
<li><a class="reference internal" href="#common-fields" id="id23">Common fields</a></li>
<li><a class="reference internal" href="#pages" id="id24">Pages</a></li>
<li><a class="reference internal" href="#images" id="id25">Images</a></li>
<li><a class="reference internal" href="#documents" id="id26">Documents</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changes-since-v1" id="id27">Changes since v1</a><ul>
<li><a class="reference internal" href="#breaking-changes" id="id28">Breaking changes</a></li>
<li><a class="reference internal" href="#major-features" id="id29">Major features</a></li>
<li><a class="reference internal" href="#minor-features" id="id30">Minor features</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="fetching-content">
<h6><a class="toc-backref" href="#id2">Fetching content</a><a class="headerlink" href="#fetching-content" title="Permalink to this headline">¶</a></h6>
<p>To fetch content over the API, perform a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request against one of the
following endpoints:</p>
<ul class="simple">
<li>Pages <code class="docutils literal notranslate"><span class="pre">/api/v2/pages/</span></code></li>
<li>Images <code class="docutils literal notranslate"><span class="pre">/api/v2/images/</span></code></li>
<li>Documents <code class="docutils literal notranslate"><span class="pre">/api/v2/documents/</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The available endpoints and their URLs may vary from site to site, depending
on how the API has been configured.</p>
</div>
<div class="section" id="example-response">
<h7><a class="toc-backref" href="#id3">Example response</a><a class="headerlink" href="#example-response" title="Permalink to this headline">¶</a></h7>
<p>Each response contains the list of items (<code class="docutils literal notranslate"><span class="pre">items</span></code>) and the total count
(<code class="docutils literal notranslate"><span class="pre">meta.total_count</span></code>). The total count is irrespective of pagination.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GET /api/v2/endpoint_name/

HTTP 200 OK
Content-Type: application/json

{
    &quot;meta&quot;: {
        &quot;total_count&quot;: &quot;total number of results&quot;
    },
    &quot;items&quot;: [
        {
            &quot;id&quot;: 1,
            &quot;meta&quot;: {
                &quot;type&quot;: &quot;app_name.ModelName&quot;,
                &quot;detail_url&quot;: &quot;http://api.example.com/api/v2/endpoint_name/1/&quot;
            },
            &quot;field&quot;: &quot;value&quot;
        },
        {
            &quot;id&quot;: 2,
            &quot;meta&quot;: {
                &quot;type&quot;: &quot;app_name.ModelName&quot;,
                &quot;detail_url&quot;: &quot;http://api.example.com/api/v2/endpoint_name/2/&quot;
            },
            &quot;field&quot;: &quot;different value&quot;
        }
    ]
}
</pre></div>
</div>
</div>
<div class="section" id="custom-page-fields-in-the-api">
<span id="apiv2-custom-page-fields"></span><h7><a class="toc-backref" href="#id4">Custom page fields in the API</a><a class="headerlink" href="#custom-page-fields-in-the-api" title="Permalink to this headline">¶</a></h7>
<p>Wagtail sites contain many page types, each with their own set of fields. The
<code class="docutils literal notranslate"><span class="pre">pages</span></code> endpoint will only expose the common fields by default (such as
<code class="docutils literal notranslate"><span class="pre">title</span></code> and <code class="docutils literal notranslate"><span class="pre">slug</span></code>).</p>
<p>To access custom page fields with the API, select the page type with the
<code class="docutils literal notranslate"><span class="pre">?type</span></code> parameter. This will filter the results to only include pages of that
type but will also make all the exported custom fields for that type available
in the API.</p>
<p>For example, to access the <code class="docutils literal notranslate"><span class="pre">published_date</span></code>, <code class="docutils literal notranslate"><span class="pre">body</span></code> and <code class="docutils literal notranslate"><span class="pre">authors</span></code> fields
on the <code class="docutils literal notranslate"><span class="pre">blog.BlogPage</span></code> model in the <a class="reference internal" href="index.html#apiv2-page-fields-configuration"><span class="std std-ref">configuration docs</span></a>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GET /api/v2/pages/?type=blog.BlogPage&amp;fields=published_date,body,authors(name)

HTTP 200 OK
Content-Type: application/json

{
    &quot;meta&quot;: {
        &quot;total_count&quot;: 10
    },
    &quot;items&quot;: [
        {
            &quot;id&quot;: 1,
            &quot;meta&quot;: {
                &quot;type&quot;: &quot;blog.BlogPage&quot;,
                &quot;detail_url&quot;: &quot;http://api.example.com/api/v2/pages/1/&quot;,
                &quot;html_url&quot;: &quot;http://www.example.com/blog/my-blog-post/&quot;,
                &quot;slug&quot;: &quot;my-blog-post&quot;,
                &quot;first_published_at&quot;: &quot;2016-08-30T16:52:00Z&quot;
            },
            &quot;title&quot;: &quot;Test blog post&quot;,
            &quot;published_date&quot;: &quot;2016-08-30&quot;,
            &quot;authors&quot;: [
                {
                    &quot;id&quot;: 1,
                    &quot;meta&quot;: {
                        &quot;type&quot;: &quot;blog.BlogPageAuthor&quot;,
                    },
                    &quot;name&quot;: &quot;Karl Hobley&quot;
                }
            ]
        },

        ...
    ]
}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only fields that have been explicitly exported by the developer may be used
in the API. This is done by adding a <code class="docutils literal notranslate"><span class="pre">api_fields</span></code> attribute to the page
model. You can read about configuration <a class="reference internal" href="index.html#apiv2-page-fields-configuration"><span class="std std-ref">here</span></a>.</p>
</div>
<p>This doesn’t apply to images/documents as there is only one model exposed in
those endpoints. But for projects that have customised image/document models,
the <code class="docutils literal notranslate"><span class="pre">api_fields</span></code> attribute can be used to export any custom fields into the
API.</p>
</div>
<div class="section" id="pagination">
<h7><a class="toc-backref" href="#id5">Pagination</a><a class="headerlink" href="#pagination" title="Permalink to this headline">¶</a></h7>
<p>The number of items in the response can be changed by using the <code class="docutils literal notranslate"><span class="pre">?limit</span></code>
parameter (default: 20) and the number of items to skip can be changed by using
the <code class="docutils literal notranslate"><span class="pre">?offset</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GET /api/v2/pages/?offset=20&amp;limit=20

HTTP 200 OK
Content-Type: application/json

{
    &quot;meta&quot;: {
        &quot;total_count&quot;: 50
    },
    &quot;items&quot;: [
        pages 20 - 40 will be listed here.
    ]
}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There may be a maximum value for the <code class="docutils literal notranslate"><span class="pre">?limit</span></code> parameter. This can be
modified in your project settings by setting <code class="docutils literal notranslate"><span class="pre">WAGTAILAPI_LIMIT_MAX</span></code> to
either a number (the new maximum value) or <code class="docutils literal notranslate"><span class="pre">None</span></code> (which disables maximum
value check).</p>
</div>
</div>
<div class="section" id="ordering">
<h7><a class="toc-backref" href="#id6">Ordering</a><a class="headerlink" href="#ordering" title="Permalink to this headline">¶</a></h7>
<p>The results can be ordered by any field by setting the <code class="docutils literal notranslate"><span class="pre">?order</span></code> parameter to
the name of the field to order by.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GET /api/v2/pages/?order=title

HTTP 200 OK
Content-Type: application/json

{
    &quot;meta&quot;: {
        &quot;total_count&quot;: 50
    },
    &quot;items&quot;: [
        pages will be listed here in ascending title order (a-z)
    ]
}
</pre></div>
</div>
<p>The results will be ordered in ascending order by default. This can be changed
to descending order by prefixing the field name with a <code class="docutils literal notranslate"><span class="pre">-</span></code> sign.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GET /api/v2/pages/?order=-title

HTTP 200 OK
Content-Type: application/json

{
    &quot;meta&quot;: {
        &quot;total_count&quot;: 50
    },
    &quot;items&quot;: [
        pages will be listed here in descending title order (z-a)
    ]
}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ordering is case-sensitive so lowercase letters are always ordered after
uppercase letters when in ascending order.</p>
</div>
<div class="section" id="random-ordering">
<h8><a class="toc-backref" href="#id7">Random ordering</a><a class="headerlink" href="#random-ordering" title="Permalink to this headline">¶</a></h8>
<p>Passing <code class="docutils literal notranslate"><span class="pre">random</span></code> into the <code class="docutils literal notranslate"><span class="pre">?order</span></code> parameter will make results return in a
random order. If there is no caching, each request will return results in a
different order.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GET /api/v2/pages/?order=random

HTTP 200 OK
Content-Type: application/json

{
    &quot;meta&quot;: {
        &quot;total_count&quot;: 50
    },
    &quot;items&quot;: [
        pages will be listed here in random order
    ]
}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It’s not possible to use <code class="docutils literal notranslate"><span class="pre">?offset</span></code> while ordering randomly because
consistent random ordering cannot be guaranteed over multiple requests
(so requests for subsequent pages may return results that also appeared in
previous pages).</p>
</div>
</div>
</div>
<div class="section" id="filtering">
<h7><a class="toc-backref" href="#id8">Filtering</a><a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h7>
<p>Any field may be used in an exact match filter. Use the filter name as the
parameter and the value to match against.</p>
<p>For example, to find a page with the slug “about”:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GET /api/v2/pages/?slug=about

HTTP 200 OK
Content-Type: application/json

{
    &quot;meta&quot;: {
        &quot;total_count&quot;: 1
    },
    &quot;items&quot;: [
        {
            &quot;id&quot;: 10,
            &quot;meta&quot;: {
                &quot;type&quot;: &quot;standard.StandardPage&quot;,
                &quot;detail_url&quot;: &quot;http://api.example.com/api/v2/pages/10/&quot;,
                &quot;html_url&quot;: &quot;http://www.example.com/about/&quot;,
                &quot;slug&quot;: &quot;about&quot;,
                &quot;first_published_at&quot;: &quot;2016-08-30T16:52:00Z&quot;
            },
            &quot;title&quot;: &quot;About&quot;
        },
    ]
}
</pre></div>
</div>
</div>
<div class="section" id="filtering-by-tree-position-pages-only">
<span id="apiv2-filter-by-tree-position"></span><h7><a class="toc-backref" href="#id9">Filtering by tree position (pages only)</a><a class="headerlink" href="#filtering-by-tree-position-pages-only" title="Permalink to this headline">¶</a></h7>
<p>Pages can additionally be filtered by their relation to other pages in the tree.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">?child_of</span></code> filter takes the id of a page and filters the list of results
to contain only direct children of that page.</p>
<p>For example, this can be useful for constructing the main menu, by passing the
id of the homepage to the filter:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GET /api/v2/pages/?child_of=2&amp;show_in_menus=true

HTTP 200 OK
Content-Type: application/json

{
    &quot;meta&quot;: {
        &quot;total_count&quot;: 5
    },
    &quot;items&quot;: [
        {
            &quot;id&quot;: 3,
            &quot;meta&quot;: {
                &quot;type&quot;: &quot;blog.BlogIndexPage&quot;,
                &quot;detail_url&quot;: &quot;http://api.example.com/api/v2/pages/3/&quot;,
                &quot;html_url&quot;: &quot;http://www.example.com/blog/&quot;,
                &quot;slug&quot;: &quot;blog&quot;,
                &quot;first_published_at&quot;: &quot;2016-09-21T13:54:00Z&quot;
            },
            &quot;title&quot;: &quot;About&quot;
        },
        {
            &quot;id&quot;: 10,
            &quot;meta&quot;: {
                &quot;type&quot;: &quot;standard.StandardPage&quot;,
                &quot;detail_url&quot;: &quot;http://api.example.com/api/v2/pages/10/&quot;,
                &quot;html_url&quot;: &quot;http://www.example.com/about/&quot;,
                &quot;slug&quot;: &quot;about&quot;,
                &quot;first_published_at&quot;: &quot;2016-08-30T16:52:00Z&quot;
            },
            &quot;title&quot;: &quot;About&quot;
        },

        ...
    ]
}
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">?ancestor_of</span></code> filter takes the id of a page and filters the list
to only include ancestors of that page (parent, grandparent etc.) all the
way down to the site’s root page.</p>
<p>For example, when combined with the <code class="docutils literal notranslate"><span class="pre">type</span></code> filter it can be used to
find the particular <code class="docutils literal notranslate"><span class="pre">blog.BlogIndexPage</span></code> a <code class="docutils literal notranslate"><span class="pre">blog.BlogPage</span></code> belongs
to. By itself, it can be used to to construct a breadcrumb trail from
the current page back to the site’s root page.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">?descendant_of</span></code> filter takes the id of a page and filter the list
to only include descendants of that page (children, grandchildren etc.).</p>
</div>
<div class="section" id="search">
<h7><a class="toc-backref" href="#id10">Search</a><a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h7>
<p>Passing a query to the <code class="docutils literal notranslate"><span class="pre">?search</span></code> parameter will perform a full-text search on
the results.</p>
<p>The query is split into “terms” (by word boundary), then each term is normalised
(lowercased and unaccented).</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">?search=James+Joyce</span></code></p>
<div class="section" id="search-operator">
<h8><a class="toc-backref" href="#id11">Search operator</a><a class="headerlink" href="#search-operator" title="Permalink to this headline">¶</a></h8>
<p>The <code class="docutils literal notranslate"><span class="pre">search_operator</span></code> specifies how multiple terms in the query should be
handled. There are two possible values:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">and</span></code> - All terms in the search query (excluding stop words) must exist in
each result</li>
<li><code class="docutils literal notranslate"><span class="pre">or</span></code> - At least one term in the search query must exist in each result</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">or</span></code> operator is generally better than <code class="docutils literal notranslate"><span class="pre">and</span></code> as it allows the user to be
inexact with their query and the ranking algorithm will make sure that
irrelevant results are not returned at the top of the page.</p>
<p>The default search operator depends on whether the search engine being used by
the site supports ranking. If it does (Elasticsearch), the operator will default
to <code class="docutils literal notranslate"><span class="pre">or</span></code>. Otherwise (database), it will default to <code class="docutils literal notranslate"><span class="pre">and</span></code>.</p>
<p>For the same reason, it’s also recommended to use the <code class="docutils literal notranslate"><span class="pre">and</span></code> operator when
using <code class="docutils literal notranslate"><span class="pre">?search</span></code> in conjunction with <code class="docutils literal notranslate"><span class="pre">?order</span></code> (as this disables ranking).</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">?search=James+Joyce&amp;order=-first_published_at&amp;search_operator=and</span></code></p>
</div>
</div>
<div class="section" id="special-filters-for-internationalised-sites">
<span id="apiv2-i18n-filters"></span><h7><a class="toc-backref" href="#id12">Special filters for internationalised sites</a><a class="headerlink" href="#special-filters-for-internationalised-sites" title="Permalink to this headline">¶</a></h7>
<p>When <code class="docutils literal notranslate"><span class="pre">WAGTAIL_I18N_ENABLED</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> (see
<a class="reference internal" href="index.html#enabling-internationalisation"><span class="std std-ref">Enabling internationalisation</span></a> for more details) two new filters are made
available on the pages endpoint.</p>
<div class="section" id="filtering-pages-by-locale">
<h8><a class="toc-backref" href="#id13">Filtering pages by locale</a><a class="headerlink" href="#filtering-pages-by-locale" title="Permalink to this headline">¶</a></h8>
<p>The <code class="docutils literal notranslate"><span class="pre">?locale=</span></code> filter is used to filter the listing to only include pages in
the specified locale. For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GET /api/v2/pages/?locale=en-us

HTTP 200 OK
Content-Type: application/json

{
    &quot;meta&quot;: {
        &quot;total_count&quot;: 5
    },
    &quot;items&quot;: [
        {
            &quot;id&quot;: 10,
            &quot;meta&quot;: {
                &quot;type&quot;: &quot;standard.StandardPage&quot;,
                &quot;detail_url&quot;: &quot;http://api.example.com/api/v2/pages/10/&quot;,
                &quot;html_url&quot;: &quot;http://www.example.com/usa-page/&quot;,
                &quot;slug&quot;: &quot;usa-page&quot;,
                &quot;first_published_at&quot;: &quot;2016-08-30T16:52:00Z&quot;,
                &quot;locale&quot;: &quot;en-us&quot;
            },
            &quot;title&quot;: &quot;American page&quot;
        },

        ...
    ]
}
</pre></div>
</div>
</div>
<div class="section" id="getting-translations-of-a-page">
<h8><a class="toc-backref" href="#id14">Getting translations of a page</a><a class="headerlink" href="#getting-translations-of-a-page" title="Permalink to this headline">¶</a></h8>
<p>The <code class="docutils literal notranslate"><span class="pre">?translation_of</span></code> filter is used to filter the listing to only include
pages that are a translation of the specified page ID. For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GET /api/v2/pages/?translation_of=10

HTTP 200 OK
Content-Type: application/json

{
    &quot;meta&quot;: {
        &quot;total_count&quot;: 2
    },
    &quot;items&quot;: [
        {
            &quot;id&quot;: 11,
            &quot;meta&quot;: {
                &quot;type&quot;: &quot;standard.StandardPage&quot;,
                &quot;detail_url&quot;: &quot;http://api.example.com/api/v2/pages/11/&quot;,
                &quot;html_url&quot;: &quot;http://www.example.com/gb-page/&quot;,
                &quot;slug&quot;: &quot;gb-page&quot;,
                &quot;first_published_at&quot;: &quot;2016-08-30T16:52:00Z&quot;,
                &quot;locale&quot;: &quot;en-gb&quot;
            },
            &quot;title&quot;: &quot;British page&quot;
        },
        {
            &quot;id&quot;: 12,
            &quot;meta&quot;: {
                &quot;type&quot;: &quot;standard.StandardPage&quot;,
                &quot;detail_url&quot;: &quot;http://api.example.com/api/v2/pages/12/&quot;,
                &quot;html_url&quot;: &quot;http://www.example.com/fr-page/&quot;,
                &quot;slug&quot;: &quot;fr-page&quot;,
                &quot;first_published_at&quot;: &quot;2016-08-30T16:52:00Z&quot;,
                &quot;locale&quot;: &quot;fr&quot;
            },
            &quot;title&quot;: &quot;French page&quot;
        },
    ]
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="fields">
<h7><a class="toc-backref" href="#id15">Fields</a><a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h7>
<p>By default, only a subset of the available fields are returned in the response.
The <code class="docutils literal notranslate"><span class="pre">?fields</span></code> parameter can be used to both add additional fields to the
response and remove default fields that you know you won’t need.</p>
<div class="section" id="additional-fields">
<h8><a class="toc-backref" href="#id16">Additional fields</a><a class="headerlink" href="#additional-fields" title="Permalink to this headline">¶</a></h8>
<p>Additional fields can be added to the response by setting <code class="docutils literal notranslate"><span class="pre">?fields</span></code> to a
comma-separated list of field names you want to add.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">?fields=body,feed_image</span></code> will add the <code class="docutils literal notranslate"><span class="pre">body</span></code> and <code class="docutils literal notranslate"><span class="pre">feed_image</span></code>
fields to the response.</p>
<p>This can also be used across relationships. For example,
<code class="docutils literal notranslate"><span class="pre">?fields=body,feed_image(width,height)</span></code> will nest the <code class="docutils literal notranslate"><span class="pre">width</span></code> and <code class="docutils literal notranslate"><span class="pre">height</span></code>
of the image in the response.</p>
</div>
<div class="section" id="all-fields">
<h8><a class="toc-backref" href="#id17">All fields</a><a class="headerlink" href="#all-fields" title="Permalink to this headline">¶</a></h8>
<p>Setting <code class="docutils literal notranslate"><span class="pre">?fields</span></code> to an asterisk (<code class="docutils literal notranslate"><span class="pre">*</span></code>) will add all available fields to the
response. This is useful for discovering what fields have been exported.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">?fields=*</span></code></p>
</div>
<div class="section" id="removing-fields">
<h8><a class="toc-backref" href="#id18">Removing fields</a><a class="headerlink" href="#removing-fields" title="Permalink to this headline">¶</a></h8>
<p>Fields you know that you do not need can be removed by prefixing the name with a
<code class="docutils literal notranslate"><span class="pre">-</span></code> and adding it to <code class="docutils literal notranslate"><span class="pre">?fields</span></code>.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">?fields=-title,body</span></code> will remove <code class="docutils literal notranslate"><span class="pre">title</span></code> and add <code class="docutils literal notranslate"><span class="pre">body</span></code>.</p>
<p>This can also be used with the asterisk. For example, <code class="docutils literal notranslate"><span class="pre">?fields=*,-body</span></code>
adds all fields except for <code class="docutils literal notranslate"><span class="pre">body</span></code>.</p>
</div>
<div class="section" id="removing-all-default-fields">
<h8><a class="toc-backref" href="#id19">Removing all default fields</a><a class="headerlink" href="#removing-all-default-fields" title="Permalink to this headline">¶</a></h8>
<p>To specify exactly the fields you need, you can set the first item in fields to
an underscore (<code class="docutils literal notranslate"><span class="pre">_</span></code>) which removes all default fields.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">?fields=_,title</span></code> will only return the title field.</p>
</div>
</div>
<div class="section" id="detail-views">
<h7><a class="toc-backref" href="#id20">Detail views</a><a class="headerlink" href="#detail-views" title="Permalink to this headline">¶</a></h7>
<p>You can retrieve a single object from the API by appending its id to the end of
the URL. For example:</p>
<ul class="simple">
<li>Pages <code class="docutils literal notranslate"><span class="pre">/api/v2/pages/1/</span></code></li>
<li>Images <code class="docutils literal notranslate"><span class="pre">/api/v2/images/1/</span></code></li>
<li>Documents <code class="docutils literal notranslate"><span class="pre">/api/v2/documents/1/</span></code></li>
</ul>
<p>All exported fields will be returned in the response by default. You can use the
<code class="docutils literal notranslate"><span class="pre">?fields</span></code> parameter to customise which fields are shown.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">/api/v2/pages/1/?fields=_,title,body</span></code> will return just the
<code class="docutils literal notranslate"><span class="pre">title</span></code> and <code class="docutils literal notranslate"><span class="pre">body</span></code> of the page with the id of 1.</p>
</div>
<div class="section" id="finding-pages-by-html-path">
<span id="apiv2-finding-pages-by-path"></span><h7><a class="toc-backref" href="#id21">Finding pages by HTML path</a><a class="headerlink" href="#finding-pages-by-html-path" title="Permalink to this headline">¶</a></h7>
<p>You can find an individual page by its HTML path using the <code class="docutils literal notranslate"><span class="pre">/api/v2/pages/find/?html_path=&lt;path&gt;</span></code> view.</p>
<p>This will return either a <code class="docutils literal notranslate"><span class="pre">302</span></code> redirect response to that page’s detail view, or a <code class="docutils literal notranslate"><span class="pre">404</span></code> not found response.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">/api/v2/pages/find/?html_path=/</span></code> always redirects to the homepage of the site</p>
</div>
</div>
<div class="section" id="default-endpoint-fields">
<h6><a class="toc-backref" href="#id22">Default endpoint fields</a><a class="headerlink" href="#default-endpoint-fields" title="Permalink to this headline">¶</a></h6>
<div class="section" id="common-fields">
<h7><a class="toc-backref" href="#id23">Common fields</a><a class="headerlink" href="#common-fields" title="Permalink to this headline">¶</a></h7>
<p>These fields are returned by every endpoint.</p>
<dl class="glossary docutils">
<dt id="term-id-number"><code class="docutils literal notranslate"><span class="pre">id</span></code>  (number)</dt>
<dd><p class="first">The unique ID of the object</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Except for page types, every other content type has its own id space
so you must combine this with the <code class="docutils literal notranslate"><span class="pre">type</span></code> field in order to get a
unique identifier for an object.</p>
</div>
</dd>
<dt id="term-type-string"><code class="docutils literal notranslate"><span class="pre">type</span></code> (string)</dt>
<dd>The type of the object in <code class="docutils literal notranslate"><span class="pre">app_label.ModelName</span></code> format</dd>
<dt id="term-detail-url-string"><code class="docutils literal notranslate"><span class="pre">detail_url</span></code>  (string)</dt>
<dd>The URL of the detail view for the object</dd>
</dl>
</div>
<div class="section" id="pages">
<h7><a class="toc-backref" href="#id24">Pages</a><a class="headerlink" href="#pages" title="Permalink to this headline">¶</a></h7>
<dl class="glossary docutils">
<dt id="term-title-string"><code class="docutils literal notranslate"><span class="pre">title</span></code>  (string)<dt id="term-meta-slug-string"><code class="docutils literal notranslate"><span class="pre">meta.slug</span></code>  (string)<dt id="term-meta-show-in-menus-boolean"><code class="docutils literal notranslate"><span class="pre">meta.show_in_menus</span></code>  (boolean)<dt id="term-meta-seo-title-string"><code class="docutils literal notranslate"><span class="pre">meta.seo_title</span></code>  (string)<dt id="term-meta-search-description-string"><code class="docutils literal notranslate"><span class="pre">meta.search_description</span></code>  (string)<dt id="term-meta-first-published-at-date-time"><code class="docutils literal notranslate"><span class="pre">meta.first_published_at</span></code>  (date/time)</dt>
<dd>These values are taken from their corresponding fields on the page</dd>
<dt id="term-meta-html-url-string"><code class="docutils literal notranslate"><span class="pre">meta.html_url</span></code>  (string)</dt>
<dd>If the site has an HTML frontend that’s generated by Wagtail, this
field will be set to the URL of this page</dd>
<dt id="term-meta-parent"><code class="docutils literal notranslate"><span class="pre">meta.parent</span></code></dt>
<dd>Nests some information about the parent page (only available on detail
views)</dd>
</dl>
</div>
<div class="section" id="images">
<h7><a class="toc-backref" href="#id25">Images</a><a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h7>
<dl class="glossary docutils">
<dt id="term-11"><code class="docutils literal notranslate"><span class="pre">title</span></code>  (string)</dt>
<dd>The value of the image’s title field. Within Wagtail, this is used in
the image’s <code class="docutils literal notranslate"><span class="pre">alt</span></code> HTML attribute.</dd>
<dt id="term-width-number"><code class="docutils literal notranslate"><span class="pre">width</span></code>  (number)<dt id="term-height-number"><code class="docutils literal notranslate"><span class="pre">height</span></code>  (number)</dt>
<dd>The size of the original image file</dd>
<dt id="term-meta-tags-list-of-strings"><code class="docutils literal notranslate"><span class="pre">meta.tags</span></code>  (list of strings)</dt>
<dd>A list of tags associated with the image</dd>
</dl>
</div>
<div class="section" id="documents">
<h7><a class="toc-backref" href="#id26">Documents</a><a class="headerlink" href="#documents" title="Permalink to this headline">¶</a></h7>
<dl class="glossary docutils">
<dt id="term-15"><code class="docutils literal notranslate"><span class="pre">title</span></code>  (string)</dt>
<dd>The value of the document’s title field</dd>
<dt id="term-16"><code class="docutils literal notranslate"><span class="pre">meta.tags</span></code>  (list of strings)</dt>
<dd>A list of tags associated with the document</dd>
<dt id="term-meta-download-url-string"><code class="docutils literal notranslate"><span class="pre">meta.download_url</span></code>  (string)</dt>
<dd>A URL to the document file</dd>
</dl>
</div>
</div>
<div class="section" id="changes-since-v1">
<h6><a class="toc-backref" href="#id27">Changes since v1</a><a class="headerlink" href="#changes-since-v1" title="Permalink to this headline">¶</a></h6>
<div class="section" id="breaking-changes">
<h7><a class="toc-backref" href="#id28">Breaking changes</a><a class="headerlink" href="#breaking-changes" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>The results list in listing responses has been renamed to <code class="docutils literal notranslate"><span class="pre">items</span></code> (was
previously either <code class="docutils literal notranslate"><span class="pre">pages</span></code>, <code class="docutils literal notranslate"><span class="pre">images</span></code> or <code class="docutils literal notranslate"><span class="pre">documents</span></code>)</li>
</ul>
</div>
<div class="section" id="major-features">
<h7><a class="toc-backref" href="#id29">Major features</a><a class="headerlink" href="#major-features" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">fields</span></code> parameter has been improved to allow removing fields, adding
all fields and customising nested fields</li>
</ul>
</div>
<div class="section" id="minor-features">
<h7><a class="toc-backref" href="#id30">Minor features</a><a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">html_url</span></code>, <code class="docutils literal notranslate"><span class="pre">slug</span></code>, <code class="docutils literal notranslate"><span class="pre">first_published_at</span></code>, <code class="docutils literal notranslate"><span class="pre">expires_at</span></code> and
<code class="docutils literal notranslate"><span class="pre">show_in_menus</span></code> fields have been added to the pages endpoint</li>
<li><code class="docutils literal notranslate"><span class="pre">download_url</span></code> field has been added to the documents endpoint</li>
<li>Multiple page types can be specified in <code class="docutils literal notranslate"><span class="pre">type</span></code> parameter on pages endpoint</li>
<li><code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">false</span></code> may now be used when filtering boolean fields</li>
<li><code class="docutils literal notranslate"><span class="pre">order</span></code> can now be used in conjunction with <code class="docutils literal notranslate"><span class="pre">search</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">search_operator</span></code> parameter was added</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<span id="document-advanced_topics/amp"></span><div class="section" id="how-to-build-a-site-with-amp-support">
<h4>How to build a site with AMP support<a class="headerlink" href="#how-to-build-a-site-with-amp-support" title="Permalink to this headline">¶</a></h4>
<p>This recipe document describes a method for creating an
<a class="reference external" href="https://amp.dev/">AMP</a> version of a Wagtail site and hosting it separately
to the rest of the site on a URL prefix. It also describes how to make Wagtail
render images with the <code class="docutils literal notranslate"><span class="pre">&lt;amp-img&gt;</span></code> tag when a user is visiting a page on the
AMP version of the site.</p>
<div class="section" id="overview">
<h5>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h5>
<p>In the next section, we will add a new URL entry that points at Wagtail’s
internal <code class="docutils literal notranslate"><span class="pre">serve()</span></code> view which will have the effect of rendering the whole
site again under the <code class="docutils literal notranslate"><span class="pre">/amp</span></code> prefix.</p>
<p>Then, we will add some utilities that will allow us to track whether the
current request is in the <code class="docutils literal notranslate"><span class="pre">/amp</span></code> prefixed version of the site without needing
a request object.</p>
<p>After that, we will add a template context processor to allow us to check from
within templates which version of the site is being rendered.</p>
<p>Then, finally, we will modify the behaviour of the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag to make it
render <code class="docutils literal notranslate"><span class="pre">&lt;amp-img&gt;</span></code> tags when rendering the AMP version of the site.</p>
</div>
<div class="section" id="creating-the-second-page-tree">
<h5>Creating the second page tree<a class="headerlink" href="#creating-the-second-page-tree" title="Permalink to this headline">¶</a></h5>
<p>We can render the whole site at a different prefix by duplicating the Wagtail
URL in the project <code class="docutils literal notranslate"><span class="pre">urls.py</span></code> file and giving it a prefix. This must be before
the default URL from Wagtail, or it will try to find <code class="docutils literal notranslate"><span class="pre">/amp</span></code> as a page:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/urls.py</span>

<span class="n">urlpatterns</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="c1"># Add this line just before the default ``include(wagtail_urls)`` line</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;amp/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtail_urls</span><span class="p">)),</span>

    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtail_urls</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>If you now open <code class="docutils literal notranslate"><span class="pre">http://localhost:8000/amp/</span></code> in your browser, you should see
the homepage.</p>
</div>
<div class="section" id="making-pages-aware-of-amp-mode">
<h5>Making pages aware of “AMP mode”<a class="headerlink" href="#making-pages-aware-of-amp-mode" title="Permalink to this headline">¶</a></h5>
<p>All the pages will now render under the <code class="docutils literal notranslate"><span class="pre">/amp</span></code> prefix, but right now there
isn’t any difference between the AMP version and the normal version.</p>
<p>To make changes, we need to add a way to detect which URL was used to render
the page. To do this, we will have to wrap Wagtail’s <code class="docutils literal notranslate"><span class="pre">serve()</span></code> view and
set a thread-local to indicate to all downstream code that AMP mode is active.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Why a thread-local?</p>
<p>(feel free to skip this part if you’re not interested)</p>
<p>Modifying the <code class="docutils literal notranslate"><span class="pre">request</span></code> object would be the most common way to do this.
However, the image tag rendering is performed in a part of Wagtail that
does not have access to the request.</p>
<p>Thread-locals are global variables that can have a different value for each
running thread. As each thread only handles one request at a time, we can
use it as a way to pass around data that is specific to that request
without having to pass the request object everywhere.</p>
<p>Django uses thread-locals internally to track the currently active language
for the request.</p>
<p class="last">Please be aware though: In Django 3.x and above, you will need to use an
<code class="docutils literal notranslate"><span class="pre">asgiref.Local</span></code> instead.
This is because Django 3.x handles multiple requests in a single thread
so thread-locals will no longer be unique to a single request.</p>
</div>
<p>Now let’s create that thread-local and some utility functions to interact with it,
save this module as <code class="docutils literal notranslate"><span class="pre">amp_utils.py</span></code> in an app in your project:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;app&gt;/amp_utils.py</span>

<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">local</span>

<span class="c1"># FIXME: For Django 3.0 support, replace this with asgiref.Local</span>
<span class="n">_amp_mode_active</span> <span class="o">=</span> <span class="n">local</span><span class="p">()</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">activate_amp_mode</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A context manager used to activate AMP mode</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_amp_mode_active</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">_amp_mode_active</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">amp_mode_active</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns True if AMP mode is currently active</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_amp_mode_active</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This module defines two functions:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">activate_amp_mode</span></code> is a context manager which can be invoked using Python’s
<code class="docutils literal notranslate"><span class="pre">with</span></code> syntax. In the body of the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement, AMP mode would be active.</li>
<li><code class="docutils literal notranslate"><span class="pre">amp_mode_active</span></code> is a function that returns <code class="docutils literal notranslate"><span class="pre">True</span></code> when AMP mode is active.</li>
</ul>
</div></blockquote>
<p>Next, we need to define a view that wraps Wagtail’s builtin <code class="docutils literal notranslate"><span class="pre">serve</span></code> view and
invokes the <code class="docutils literal notranslate"><span class="pre">activate_amp_mode</span></code> context manager:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;app&gt;/amp_views.py</span>

<span class="kn">from</span> <span class="nn">django.template.response</span> <span class="kn">import</span> <span class="n">SimpleTemplateResponse</span>
<span class="kn">from</span> <span class="nn">wagtail.core.views</span> <span class="kn">import</span> <span class="n">serve</span> <span class="k">as</span> <span class="n">wagtail_serve</span>

<span class="kn">from</span> <span class="nn">.amp_utils</span> <span class="kn">import</span> <span class="n">activate_amp_mode</span>

<span class="k">def</span> <span class="nf">serve</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">activate_amp_mode</span><span class="p">():</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">wagtail_serve</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

        <span class="c1"># Render template responses now while AMP mode is still active</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">SimpleTemplateResponse</span><span class="p">):</span>
            <span class="n">response</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<p>Then we need to create a <code class="docutils literal notranslate"><span class="pre">amp_urls.py</span></code> file in the same app:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;app&gt;/amp_urls.py</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">re_path</span>
<span class="kn">from</span> <span class="nn">wagtail.core.urls</span> <span class="kn">import</span> <span class="n">serve_pattern</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">amp_views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">re_path</span><span class="p">(</span><span class="n">serve_pattern</span><span class="p">,</span> <span class="n">amp_views</span><span class="o">.</span><span class="n">serve</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;wagtail_amp_serve&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Finally, we need to update the project’s main <code class="docutils literal notranslate"><span class="pre">urls.py</span></code> to use this new URLs
file for the <code class="docutils literal notranslate"><span class="pre">/amp</span></code> prefix:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/urls.py</span>

<span class="kn">from</span> <span class="nn">myapp</span> <span class="kn">import</span> <span class="n">amp_urls</span> <span class="k">as</span> <span class="n">wagtail_amp_urls</span>

<span class="n">urlpatterns</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="c1"># Change this line to point at your amp_urls instead of Wagtail&#39;s urls</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;amp/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtail_amp_urls</span><span class="p">)),</span>

    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtail_urls</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>After this, there shouldn’t be any noticeable difference to the AMP version of
the site.</p>
</div>
<div class="section" id="write-a-template-context-processor-so-that-amp-state-can-be-checked-in-templates">
<h5>Write a template context processor so that AMP state can be checked in templates<a class="headerlink" href="#write-a-template-context-processor-so-that-amp-state-can-be-checked-in-templates" title="Permalink to this headline">¶</a></h5>
<p>This is optional, but worth doing so we can confirm that everything is working
so far.</p>
<p>Add a <code class="docutils literal notranslate"><span class="pre">amp_context_processors.py</span></code> file into your app that contains the
following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;app&gt;/amp_context_processors.py</span>

<span class="kn">from</span> <span class="nn">.amp_utils</span> <span class="kn">import</span> <span class="n">amp_mode_active</span>

<span class="k">def</span> <span class="nf">amp</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;amp_mode_active&#39;</span><span class="p">:</span> <span class="n">amp_mode_active</span><span class="p">(),</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Now add the path to this context processor to the
<code class="docutils literal notranslate"><span class="pre">['OPTIONS']['context_processors']</span></code> key of the <code class="docutils literal notranslate"><span class="pre">TEMPLATES</span></code> setting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Either &lt;project&gt;/settings.py or &lt;project&gt;/settings/base.py</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="o">...</span>

        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="o">...</span>
                <span class="c1"># Add this after other context processors</span>
                <span class="s1">&#39;myapp.amp_context_processors.amp&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
<p>You should now be able to use the <code class="docutils literal notranslate"><span class="pre">amp_mode_active</span></code> variable in templates.
For example:</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">amp_mode_active</span> <span class="cp">%}</span>
    AMP MODE IS ACTIVE!
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="using-a-different-page-template-when-amp-mode-is-active">
<h5>Using a different page template when AMP mode is active<a class="headerlink" href="#using-a-different-page-template-when-amp-mode-is-active" title="Permalink to this headline">¶</a></h5>
<p>You’re probably not going to want to use the same templates on the AMP site as
you do on the normal web site. Let’s add some logic in to make Wagtail use a
separate template whenever a page is served with AMP enabled.</p>
<p>We can use a mixin, which allows us to re-use the logic on different page types.
Add the following to the bottom of the amp_utils.py file that you created earlier:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;app&gt;/amp_utils.py</span>

<span class="kn">import</span> <span class="nn">os.path</span>

<span class="o">...</span>

<span class="k">class</span> <span class="nc">PageAMPTemplateMixin</span><span class="p">:</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">amp_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Get the default template name and insert `_amp` before the extension</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_amp&#39;</span> <span class="o">+</span> <span class="n">ext</span>

    <span class="k">def</span> <span class="nf">get_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">amp_mode_active</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_template</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
<p>Now add this mixin to any page model, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;app&gt;/models.py</span>

<span class="kn">from</span> <span class="nn">.amp_utils</span> <span class="kn">import</span> <span class="n">PageAMPTemplateMixin</span>

<span class="k">class</span> <span class="nc">MyPageModel</span><span class="p">(</span><span class="n">PageAMPTemplateMixin</span><span class="p">,</span> <span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>When AMP mode is active, the template at <code class="docutils literal notranslate"><span class="pre">app_label/mypagemodel_amp.html</span></code>
will be used instead of the default one.</p>
<p>If you have a different naming convention, you can override the
<code class="docutils literal notranslate"><span class="pre">amp_template</span></code> attribute on the model. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;app&gt;/models.py</span>

<span class="kn">from</span> <span class="nn">.amp_utils</span> <span class="kn">import</span> <span class="n">PageAMPTemplateMixin</span>

<span class="k">class</span> <span class="nc">MyPageModel</span><span class="p">(</span><span class="n">PageAMPTemplateMixin</span><span class="p">,</span> <span class="n">Page</span><span class="p">):</span>
    <span class="n">amp_template</span> <span class="o">=</span> <span class="s1">&#39;my_custom_amp_template.html&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="overriding-the-image-tag-to-output-amp-img-tags">
<h5>Overriding the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag to output <code class="docutils literal notranslate"><span class="pre">&lt;amp-img&gt;</span></code> tags<a class="headerlink" href="#overriding-the-image-tag-to-output-amp-img-tags" title="Permalink to this headline">¶</a></h5>
<p>Finally, let’s change Wagtail’s <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag, so it renders an <code class="docutils literal notranslate"><span class="pre">&lt;amp-img&gt;</span></code>
tags when rendering pages with AMP enabled. We’ll make the change on the
<cite>Rendition</cite> model itself so it applies to both images rendered with the
<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag and images rendered in rich text fields as well.</p>
<p>Doing this with a <a class="reference internal" href="index.html#custom-image-model"><span class="std std-ref">Custom image model</span></a> is easier, as
you can override the <code class="docutils literal notranslate"><span class="pre">img_tag</span></code>  method on your custom <code class="docutils literal notranslate"><span class="pre">Rendition</span></code> model to
return a different tag.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.forms.utils</span> <span class="kn">import</span> <span class="n">flatatt</span>
<span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">mark_safe</span>

<span class="kn">from</span> <span class="nn">wagtail.images.models</span> <span class="kn">import</span> <span class="n">AbstractRendition</span>

<span class="o">...</span>

<span class="k">class</span> <span class="nc">CustomRendition</span><span class="p">(</span><span class="n">AbstractRendition</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">img_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_attributes</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extra_attributes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">amp_mode_active</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s1">&#39;&lt;amp-img</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flatatt</span><span class="p">(</span><span class="n">attrs</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s1">&#39;&lt;img</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flatatt</span><span class="p">(</span><span class="n">attrs</span><span class="p">)))</span>

    <span class="o">...</span>
</pre></div>
</div>
<p>Without a custom image model, you will have to monkey-patch the builtin
<code class="docutils literal notranslate"><span class="pre">Rendition</span></code> model.
Add this anywhere in your project where it would be imported on start:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.forms.utils</span> <span class="kn">import</span> <span class="n">flatatt</span>
<span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">mark_safe</span>

<span class="kn">from</span> <span class="nn">wagtail.images.models</span> <span class="kn">import</span> <span class="n">Rendition</span>

<span class="k">def</span> <span class="nf">img_tag</span><span class="p">(</span><span class="n">rendition</span><span class="p">,</span> <span class="n">extra_attributes</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replacement implementation for Rendition.img_tag</span>

<span class="sd">    When AMP mode is on, this returns an &lt;amp-img&gt; tag instead of an &lt;img&gt; tag</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="n">rendition</span><span class="o">.</span><span class="n">attrs_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extra_attributes</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">amp_mode_active</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s1">&#39;&lt;amp-img</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flatatt</span><span class="p">(</span><span class="n">attrs</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s1">&#39;&lt;img</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flatatt</span><span class="p">(</span><span class="n">attrs</span><span class="p">)))</span>

<span class="n">Rendition</span><span class="o">.</span><span class="n">img_tag</span> <span class="o">=</span> <span class="n">img_tag</span>
</pre></div>
</div>
</div>
</div>
<span id="document-advanced_topics/accessibility_considerations"></span><div class="section" id="accessibility-considerations">
<h4>Accessibility considerations<a class="headerlink" href="#accessibility-considerations" title="Permalink to this headline">¶</a></h4>
<p>Accessibility for CMS-driven websites is a matter of <a class="reference internal" href="#content-modeling"><span class="std std-ref">modeling content appropriately</span></a>, <a class="reference internal" href="#accessibility-in-templates"><span class="std std-ref">creating accessible templates</span></a>, and <a class="reference internal" href="#authoring-accessible-content"><span class="std std-ref">authoring content</span></a> with readability and accessibility guidelines in mind.</p>
<p>Wagtail generally puts developers in control of content modeling and front-end markup, but there are a few areas to be aware of nonetheless, and ways to help authors be aware of readability best practices.
Note there is much more to building accessible websites than we cover here – see our list of <a class="reference internal" href="#accessibility-resources"><span class="std std-ref">accessibility resources</span></a> for more information.</p>
<ul class="simple">
<li><a class="reference internal" href="#content-modeling"><span class="std std-ref">Content modeling</span></a></li>
<li><a class="reference internal" href="#accessibility-in-templates"><span class="std std-ref">Accessibility in templates</span></a></li>
<li><a class="reference internal" href="#authoring-accessible-content"><span class="std std-ref">Authoring accessible content</span></a></li>
<li><a class="reference internal" href="#accessibility-resources"><span class="std std-ref">Accessibility resources</span></a></li>
</ul>
<hr class="docutils" />
<div class="section" id="content-modeling">
<span id="id1"></span><h5>Content modeling<a class="headerlink" href="#content-modeling" title="Permalink to this headline">¶</a></h5>
<p>As part of defining your site’s models, here are areas to pay special attention to:</p>
<div class="section" id="alt-text-for-images">
<h6>Alt text for images<a class="headerlink" href="#alt-text-for-images" title="Permalink to this headline">¶</a></h6>
<p>The default behavior for Wagtail images is to use the <code class="docutils literal notranslate"><span class="pre">title</span></code> field as the alt text (<a class="reference external" href="https://github.com/wagtail/wagtail/issues/4945">#4945</a>).
This is inappropriate, as it’s not communicated in the CMS interface, and the image upload form uses the image’s filename as the title by default.</p>
<p>Ideally, always add an optional “alt text” field wherever an image is used, alongside the image field:</p>
<ul class="simple">
<li>For normal fields, add an alt text field to your image’s panel.</li>
<li>For StreamField, add an extra field to your image block.</li>
<li>For rich text – Wagtail already makes it possible to customize alt text for rich text images.</li>
</ul>
<p>When defining the alt text fields, make sure they are optional so editors can choose to not write any alt text for decorative images. Take the time to provide <code class="docutils literal notranslate"><span class="pre">help_text</span></code> with appropriate guidance.
For example, linking to <a class="reference external" href="https://axesslab.com/alt-texts/">established resources on alt text</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Should I add an alt text field on the Image model for my site?</p>
<p>It’s better than nothing to have a dedicated alt field on the Image model (<a class="reference external" href="https://github.com/wagtail/wagtail/pull/5789">#5789</a>), and may be appropriate for some websites, but we recommend to have it inline with the content because ideally alt text should be written for the context the image is used in:</p>
<ul class="last simple">
<li>If the alt text’s content is already part of the rest of the page, ideally the image should not repeat the same content.</li>
<li>Ideally, the alt text should be written based on the context the image is displayed in.</li>
<li>An image might be decorative in some cases but not in others. For example, thumbnails in page listings can often be considered decorative.</li>
</ul>
</div>
<p>See <a class="reference external" href="https://github.com/wagtail/rfcs/pull/51">RFC 51: Contextual alt text</a> for a long-term solution to this problem.</p>
</div>
<div class="section" id="embeds-title">
<h6>Embeds title<a class="headerlink" href="#embeds-title" title="Permalink to this headline">¶</a></h6>
<p>Missing embed titles are common failures in accessibility audits of Wagtail websites. In some cases, Wagtail embeds’ iframe doesn’t have a <code class="docutils literal notranslate"><span class="pre">title</span></code> attribute set. This is generally a problem with OEmbed providers like YouTube (<a class="reference external" href="https://github.com/wagtail/wagtail/issues/5982">#5982</a>).
This is very problematic for screen reader users, who rely on the title to understand what the embed is, and whether to interact with it or not.</p>
<p>If your website relies on embeds that have are missing titles, make sure to either:</p>
<ul class="simple">
<li>Add the OEmbed <cite>title</cite> field as a <code class="docutils literal notranslate"><span class="pre">title</span></code> on the <code class="docutils literal notranslate"><span class="pre">iframe</span></code>.</li>
<li>Add a custom mandatory Title field to your embeds, and add it as the <code class="docutils literal notranslate"><span class="pre">iframe</span></code>’s <code class="docutils literal notranslate"><span class="pre">title</span></code>.</li>
</ul>
</div>
<div class="section" id="available-heading-levels">
<h6>Available heading levels<a class="headerlink" href="#available-heading-levels" title="Permalink to this headline">¶</a></h6>
<p>Wagtail makes it very easy for developers to control which heading levels should be available for any given content, via <a class="reference internal" href="index.html#rich-text-features"><span class="std std-ref">rich text features</span></a> or custom StreamField blocks.
In both cases, take the time to restrict what heading levels are available so the pages’ document outline is more likely to be logical and sequential. Consider using the following restrictions:</p>
<ul class="simple">
<li>Disallow <code class="docutils literal notranslate"><span class="pre">h1</span></code> in rich text. There should only be one <code class="docutils literal notranslate"><span class="pre">h1</span></code> tag per page, which generally maps to the page’s <code class="docutils literal notranslate"><span class="pre">title</span></code>.</li>
<li>Limit heading levels to <code class="docutils literal notranslate"><span class="pre">h2</span></code> for the main content of a page. Add <code class="docutils literal notranslate"><span class="pre">h3</span></code> only if deemed necessary. Avoid other levels as a general rule.</li>
<li>For content that is displayed in a specific section of the page, limit heading levels to those directly below the section’s main heading.</li>
</ul>
<p>If managing headings via StreamField, make sure to apply the same restrictions there.</p>
</div>
<div class="section" id="bold-and-italic-formatting-in-rich-text">
<h6>Bold and italic formatting in rich text<a class="headerlink" href="#bold-and-italic-formatting-in-rich-text" title="Permalink to this headline">¶</a></h6>
<p>By default, Wagtail stores its bold formatting as a <code class="docutils literal notranslate"><span class="pre">b</span></code> tag, and italic as <code class="docutils literal notranslate"><span class="pre">i</span></code> (<a class="reference external" href="https://github.com/wagtail/wagtail/issues/4665">#4665</a>). While those tags don’t necessarily always have correct semantics (<code class="docutils literal notranslate"><span class="pre">strong</span></code> and <code class="docutils literal notranslate"><span class="pre">em</span></code> are more ubiquitous), there isn’t much consequence for screen reader users, as by default screen readers do not announce content differently based on emphasis.</p>
<p>If this is a concern to you, you can change which tags are used when saving content with <a class="reference internal" href="index.html#rich-text-format-converters"><span class="std std-ref">rich text format converters</span></a>. In the future, <a class="reference internal" href="index.html#rich-text-rewrite-handlers"><span class="std std-ref">rich text rewrite handlers</span></a> should also support this being done without altering the storage format (<a class="reference external" href="https://github.com/wagtail/wagtail/issues/4223">#4223</a>).</p>
</div>
<div class="section" id="tableblock">
<h6>TableBlock<a class="headerlink" href="#tableblock" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="index.html#document-reference/contrib/table_block"><span class="doc">TableBlock</span></a> default implementation makes it too easy for end-users to miss they need either row or column headers (<a class="reference external" href="https://github.com/wagtail/wagtail/issues/5989">#5989</a>). Make sure to always have either row headers or column headers set.
Always add a Caption, so screen reader users navigating the site’s tables know where they are.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="accessibility-in-templates">
<span id="id8"></span><h5>Accessibility in templates<a class="headerlink" href="#accessibility-in-templates" title="Permalink to this headline">¶</a></h5>
<p>Here are common gotchas to be aware of to make the site’s templates as accessible as possible,</p>
<div class="section" id="alt-text-in-templates">
<h6>Alt text in templates<a class="headerlink" href="#alt-text-in-templates" title="Permalink to this headline">¶</a></h6>
<p>See the <a class="reference internal" href="#content-modeling"><span class="std std-ref">content modelling</span></a> section above. Additionally, make sure to <a class="reference internal" href="index.html#image-tag-alt"><span class="std std-ref">customise images’ alt text</span></a>, either setting it to the relevant field, or to an empty string for decorative images, or images where the alt text would be a repeat of other content.
Even when your images have alt text coming directly from the image model, you still need to decide whether there should be alt text for the particular context the image is used in. For example, avoid alt text in listings where the alt text just repeats the listing items’ title.</p>
</div>
<div class="section" id="empty-heading-tags">
<h6>Empty heading tags<a class="headerlink" href="#empty-heading-tags" title="Permalink to this headline">¶</a></h6>
<p>In both rich text and custom StreamField blocks, it’s sometimes easy for editors to create a heading block but not add any content to it. If this is a problem for your site,</p>
<ul class="simple">
<li>Add validation rules to those fields, making sure the page can’t be saved with the empty headings, for example by using the <a class="reference internal" href="index.html#document-topics/streamfield"><span class="doc">StreamField</span></a> <code class="docutils literal notranslate"><span class="pre">CharBlock</span></code> which is required by default.</li>
<li>Consider adding similar validation rules for rich text fields (<a class="reference external" href="https://github.com/wagtail/wagtail/issues/6526">#6526</a>).</li>
</ul>
<p>Additionally, you can hide empty heading blocks with CSS:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">h1</span><span class="p">:</span><span class="nd">empty</span><span class="o">,</span> <span class="nt">h2</span><span class="p">:</span><span class="nd">empty</span><span class="o">,</span> <span class="nt">h3</span><span class="p">:</span><span class="nd">empty</span><span class="o">,</span> <span class="nt">h4</span><span class="p">:</span><span class="nd">empty</span><span class="o">,</span> <span class="nt">h5</span><span class="p">:</span><span class="nd">empty</span><span class="o">,</span> <span class="nt">h6</span><span class="p">:</span><span class="nd">empty</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="forms">
<h6>Forms<a class="headerlink" href="#forms" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">wagtailforms</span></code> <a class="reference internal" href="index.html#form-builder"><span class="std std-ref">Form builder</span></a> uses Django’s forms API. Here are considerations specific to forms in templates:</p>
<ul class="simple">
<li>Avoid rendering helpers such as <code class="docutils literal notranslate"><span class="pre">as_table</span></code>, <code class="docutils literal notranslate"><span class="pre">as_ul</span></code>, <code class="docutils literal notranslate"><span class="pre">as_p</span></code>, which can make forms harder to navigate for screen reader users or cause HTML validation issues (see Django ticket <a class="reference external" href="https://code.djangoproject.com/ticket/32339">#32339</a>).</li>
<li>Make sure to visually distinguish required and optional fields.</li>
<li>Take the time to group related fields together in <code class="docutils literal notranslate"><span class="pre">fieldset</span></code>, with an appropriate <code class="docutils literal notranslate"><span class="pre">legend</span></code>, in particular for radios and checkboxes (see Django ticket <a class="reference external" href="https://code.djangoproject.com/ticket/32338">#32338</a>).</li>
<li>If relevant, use the appropriate <code class="docutils literal notranslate"><span class="pre">autocomplete</span></code> and <code class="docutils literal notranslate"><span class="pre">autocapitalize</span></code> attributes.</li>
<li>For Date and Datetime fields, make sure to display the expected format or an example value (see Django ticket <a class="reference external" href="https://code.djangoproject.com/ticket/32340">#32340</a>). Or use <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/date">input type=”date”</a>.</li>
<li>For Number fields, consider whether <code class="docutils literal notranslate"><span class="pre">input</span> <span class="pre">type=&quot;number&quot;</span></code> really is appropriate, or whether there may be <a class="reference external" href="https://technology.blog.gov.uk/2020/02/24/why-the-gov-uk-design-system-team-changed-the-input-type-for-numbers/">better alternatives such as inputmode</a>.</li>
</ul>
<p>Make sure to test your forms’ implementation with assistive technologies, and review <a class="reference external" href="https://www.w3.org/WAI/tutorials/forms/">official W3C guidance on accessible forms development</a> for further information.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="authoring-accessible-content">
<span id="id13"></span><h5>Authoring accessible content<a class="headerlink" href="#authoring-accessible-content" title="Permalink to this headline">¶</a></h5>
<p>Here are things you can do to help authors create accessible content.</p>
<div class="section" id="wagtail-accessibility">
<h6>wagtail-accessibility<a class="headerlink" href="#wagtail-accessibility" title="Permalink to this headline">¶</a></h6>
<p><a class="reference external" href="https://github.com/neon-jungle/wagtail-accessibility">wagtail-accessibility</a> is a third-party package which adds <a class="reference external" href="https://khan.github.io/tota11y/">tota11y</a> to Wagtail previews.
This makes it easy for authors to run basic accessibility checks – validating the page’s heading outline, or link text.</p>
</div>
<div class="section" id="help-text-and-helppanel">
<h6>help_text and HelpPanel<a class="headerlink" href="#help-text-and-helppanel" title="Permalink to this headline">¶</a></h6>
<p>Occasional Wagtail users may not be aware of your site’s content guidelines, or best practices of writing for the web. Use fields’ <code class="docutils literal notranslate"><span class="pre">help_text</span></code> and <code class="docutils literal notranslate"><span class="pre">HelpPanel</span></code> (see <a class="reference internal" href="index.html#document-reference/pages/panels"><span class="doc">Panel types</span></a>).</p>
</div>
<div class="section" id="readability">
<h6>Readability<a class="headerlink" href="#readability" title="Permalink to this headline">¶</a></h6>
<p>Readability is fundamental to accessibility. One of the ways to improve text content is to have a clear target for reading level / reading age, which can be assessed with <a class="reference external" href="https://github.com/vixdigital/wagtail-readinglevel">wagtail-readinglevel</a> as a score displayed in rich text fields.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="accessibility-resources">
<span id="id15"></span><h5>Accessibility resources<a class="headerlink" href="#accessibility-resources" title="Permalink to this headline">¶</a></h5>
<p>We focus on considerations specific to Wagtail websites, but there is much more to accessibility. Here are valuable resources to learn more, for developers but also designers and authors:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.w3.org/WAI/fundamentals/">W3C Accessibility Fundamentals</a></li>
<li><a class="reference external" href="https://www.a11yproject.com/">The A11Y Project</a></li>
<li><a class="reference external" href="https://accessibility.digital.gov/">US GSA –&nbsp;Accessibility for Teams</a></li>
<li><a class="reference external" href="https://accessibility.blog.gov.uk/2016/09/02/dos-and-donts-on-designing-for-accessibility/">UK GDS –&nbsp;Dos and don’ts on designing for accessibility</a></li>
<li><a class="reference external" href="https://www.accessibility-developer-guide.com/">Accessibility Developer Guide</a></li>
</ul>
</div>
</div>
<span id="document-advanced_topics/boundblocks_and_values"></span><div class="section" id="about-streamfield-boundblocks-and-values">
<span id="boundblocks-and-values"></span><h4>About StreamField BoundBlocks and values<a class="headerlink" href="#about-streamfield-boundblocks-and-values" title="Permalink to this headline">¶</a></h4>
<p>All StreamField block types accept a <code class="docutils literal notranslate"><span class="pre">template</span></code> parameter to determine how they will be rendered on a page. However, for blocks that handle basic Python data types, such as <code class="docutils literal notranslate"><span class="pre">CharBlock</span></code> and <code class="docutils literal notranslate"><span class="pre">IntegerBlock</span></code>, there are some limitations on where the template will take effect, since those built-in types (<code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code> and so on) cannot be ‘taught’ about their template rendering. As an example of this, consider the following block definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HeadingBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;blocks/heading.html&#39;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">blocks/heading.html</span></code> consists of:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">value</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>This gives us a block that behaves as an ordinary text field, but wraps its output in <code class="docutils literal notranslate"><span class="pre">&lt;h1&gt;</span></code> tags whenever it is rendered:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
        <span class="c1"># ...</span>
        <span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span> <span class="n">HeadingBlock</span><span class="p">()),</span>
        <span class="c1"># ...</span>
    <span class="p">])</span>
</pre></div>
</div>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">for</span> <span class="nb">block</span> <span class="k">in</span> <span class="nv">page.body</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nb">block</span><span class="nv">.block_type</span> <span class="o">==</span> <span class="s1">&#39;heading&#39;</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">include_block</span> <span class="nb">block</span> <span class="cp">%}</span>  <span class="c">{# This block will output its own &lt;h1&gt;...&lt;/h1&gt; tags. #}</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>This kind of arrangement - a value that supposedly represents a plain text string, but has its own custom HTML representation when output on a template - would normally be a very messy thing to achieve in Python, but it works here because the items you get when iterating over a StreamField are not actually the ‘native’ values of the blocks. Instead, each item is returned as an instance of <code class="docutils literal notranslate"><span class="pre">BoundBlock</span></code> - an object that represents the pairing of a value and its block definition. By keeping track of the block definition, a <code class="docutils literal notranslate"><span class="pre">BoundBlock</span></code> always knows which template to render. To get to the underlying value - in this case, the text content of the heading - you would need to access <code class="docutils literal notranslate"><span class="pre">block.value</span></code>. Indeed, if you were to output <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">block.value</span> <span class="pre">%}</span></code> on the page, you would find that it renders as plain text, without the <code class="docutils literal notranslate"><span class="pre">&lt;h1&gt;</span></code> tags.</p>
<p>(More precisely, the items returned when iterating over a StreamField are instances of a class <code class="docutils literal notranslate"><span class="pre">StreamChild</span></code>, which provides the <code class="docutils literal notranslate"><span class="pre">block_type</span></code> property as well as <code class="docutils literal notranslate"><span class="pre">value</span></code>.)</p>
<p>Experienced Django developers may find it helpful to compare this to the <code class="docutils literal notranslate"><span class="pre">BoundField</span></code> class in Django’s forms framework, which represents the pairing of a form field value with its corresponding form field definition, and therefore knows how to render the value as an HTML form field.</p>
<p>Most of the time, you won’t need to worry about these internal details; Wagtail will use the template rendering wherever you would expect it to. However, there are certain cases where the illusion isn’t quite complete - namely, when accessing children of a <code class="docutils literal notranslate"><span class="pre">ListBlock</span></code> or <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code>. In these cases, there is no <code class="docutils literal notranslate"><span class="pre">BoundBlock</span></code> wrapper, and so the item cannot be relied upon to know its own template rendering. For example, consider the following setup, where our <code class="docutils literal notranslate"><span class="pre">HeadingBlock</span></code> is a child of a StructBlock:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EventBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="n">heading</span> <span class="o">=</span> <span class="n">HeadingBlock</span><span class="p">()</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">TextBlock</span><span class="p">()</span>
    <span class="c1"># ...</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;blocks/event.html&#39;</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">blocks/event.html</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;event </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">value.heading</span> <span class="o">==</span> <span class="s1">&#39;Party!&#39;</span> <span class="cp">%}</span><span class="s">lots-of-balloons</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">value.heading</span> <span class="cp">%}</span>
    - <span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">value.description</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>In this case, <code class="docutils literal notranslate"><span class="pre">value.heading</span></code> returns the plain string value rather than a <code class="docutils literal notranslate"><span class="pre">BoundBlock</span></code>; this is necessary because otherwise the comparison in <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">value.heading</span> <span class="pre">==</span> <span class="pre">'Party!'</span> <span class="pre">%}</span></code> would never succeed. This in turn means that <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">value.heading</span> <span class="pre">%}</span></code> renders as the plain string, without the <code class="docutils literal notranslate"><span class="pre">&lt;h1&gt;</span></code> tags. To get the HTML rendering, you need to explicitly access the <code class="docutils literal notranslate"><span class="pre">BoundBlock</span></code> instance through <code class="docutils literal notranslate"><span class="pre">value.bound_blocks.heading</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;event </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">value.heading</span> <span class="o">==</span> <span class="s1">&#39;Party!&#39;</span> <span class="cp">%}</span><span class="s">lots-of-balloons</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">value.bound_blocks.heading</span> <span class="cp">%}</span>
    - <span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">value.description</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>In practice, it would probably be more natural and readable to make the <code class="docutils literal notranslate"><span class="pre">&lt;h1&gt;</span></code> tag explicit in the EventBlock’s template:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;event </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">value.heading</span> <span class="o">==</span> <span class="s1">&#39;Party!&#39;</span> <span class="cp">%}</span><span class="s">lots-of-balloons</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">value.heading</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    - <span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">value.description</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>This limitation does not apply to StructBlock and StreamBlock values as children of a StructBlock, because Wagtail implements these as complex objects that know their own template rendering, even when not wrapped in a <code class="docutils literal notranslate"><span class="pre">BoundBlock</span></code>. For example, if a StructBlock is nested in another StructBlock, as in:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EventBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="n">heading</span> <span class="o">=</span> <span class="n">HeadingBlock</span><span class="p">()</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">TextBlock</span><span class="p">()</span>
    <span class="n">guest_speaker</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
        <span class="p">(</span><span class="s1">&#39;surname&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
        <span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
    <span class="p">],</span> <span class="n">template</span><span class="o">=</span><span class="s1">&#39;blocks/speaker.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>then <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">value.guest_speaker</span> <span class="pre">%}</span></code> within the EventBlock’s template will pick up the template rendering from <code class="docutils literal notranslate"><span class="pre">blocks/speaker.html</span></code> as intended.</p>
<p>In summary, interactions between BoundBlocks and plain values work according to the following rules:</p>
<ol class="arabic simple">
<li>When iterating over the value of a StreamField or StreamBlock (as in <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">block</span> <span class="pre">in</span> <span class="pre">page.body</span> <span class="pre">%}</span></code>), you will get back a sequence of BoundBlocks.</li>
<li>If you have a BoundBlock instance, you can access the plain value as <code class="docutils literal notranslate"><span class="pre">block.value</span></code>.</li>
<li>Accessing a child of a StructBlock (as in <code class="docutils literal notranslate"><span class="pre">value.heading</span></code>) will return a plain value; to retrieve the BoundBlock instead, use <code class="docutils literal notranslate"><span class="pre">value.bound_blocks.heading</span></code>.</li>
<li>The value of a ListBlock is a plain Python list; iterating over it returns plain child values.</li>
<li>StructBlock and StreamBlock values always know how to render their own templates, even if you only have the plain value rather than the BoundBlock.</li>
</ol>
</div>
<span id="document-advanced_topics/multi_site_multi_instance_multi_tenancy"></span><div class="section" id="multi-site-multi-instance-and-multi-tenancy">
<h4>Multi-site, multi-instance and multi-tenancy<a class="headerlink" href="#multi-site-multi-instance-and-multi-tenancy" title="Permalink to this headline">¶</a></h4>
<p>This page gives background information on how to run multiple Wagtail sites (with the same source code).</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#multi-site" id="id1">Multi-site</a></li>
<li><a class="reference internal" href="#multi-instance" id="id2">Multi-instance</a></li>
<li><a class="reference internal" href="#multi-tenancy" id="id3">Multi-tenancy</a></li>
</ul>
</div>
<div class="section" id="multi-site">
<h5><a class="toc-backref" href="#id1">Multi-site</a><a class="headerlink" href="#multi-site" title="Permalink to this headline">¶</a></h5>
<p>Multi-site is a Wagtail project configuration where content creators go into a single admin interface and manage the content of multiple websites. Permission to manage specific content, and restricting access to other content, is possible to some extent.</p>
<p>Multi-site configuration is a single code base, on a single server, connecting to a single database. Media is stored in a single media root directory. Content can be shared between sites.</p>
<p>Wagtail supports multi-site out of the box: Wagtail comes with a <a class="reference internal" href="index.html#wagtail.core.models.Site" title="wagtail.core.models.Site"><code class="xref py py-class docutils literal notranslate"><span class="pre">site</span> <span class="pre">model</span></code></a>. The site model contains a hostname, port, and root page field. When a URL is requested, the request comes in, the domain name and port are taken from the request object to look up the correct site object. The root page is used as starting point to resolve the URL and serve the correct page.</p>
<p>Wagtail also comes with <a class="reference internal" href="index.html#settings"><span class="std std-ref">site settings</span></a>. <em>Site settings</em> are ‘singletons’ that let you store additional information on a site. For example, social media settings, a field to upload a logo, or a choice field to select a theme.</p>
<p>Model objects can be linked to a site by placing a foreign key field on the model pointing to the site object. A request object can be used to look up the current site. This way, content belonging to a specific site can be served.</p>
<p>User, groups, and permissions can be configured in such a way that content creators can only manage the pages, images, and documents of a specific site. Wagtail can have multiple <em>site objects</em> and multiple <em>page trees</em>. Permissions can be linked to a specific page tree or a subsection thereof. Collections are used to categorize images and documents. A collection can be restricted to users who are in a specific group.</p>
<p>Some projects require content editors to have permissions on specific sites and restrict access to other sites. Splitting <em>all</em> content per site and guaranteeing that no content ‘leaks’ is difficult to realize in a multi-site project. If you require full separation of content, then multi-instance might be a better fit…</p>
</div>
<div class="section" id="multi-instance">
<h5><a class="toc-backref" href="#id2">Multi-instance</a><a class="headerlink" href="#multi-instance" title="Permalink to this headline">¶</a></h5>
<p>Multi-instance is a Wagtail project configuration where a single set of project files is used by multiple websites. Each website has its own settings file, and a dedicated database and media directory. Each website runs in its own server process. This guarantees the <em>total separation</em> of <em>all content</em>.</p>
<p>Assume the domains a.com and b.com. Settings files can be <cite>base.py</cite>, <cite>acom.py</cite>, and <cite>bcom.py</cite>. The base settings will contain all settings like normal. The contents of site-specific settings override the base settings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># settings/acom.py</span>
<span class="kn">from</span> <span class="nn">base</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c1"># noqa</span>

<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a.com&#39;</span><span class="p">]</span>
<span class="n">DATABASES</span><span class="p">[</span><span class="s2">&quot;NAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;acom&quot;</span>
<span class="n">DATABASES</span><span class="p">[</span><span class="s2">&quot;PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;password-for-acom&quot;</span>
<span class="n">MEDIA_DIR</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s2">&quot;acom-media&quot;</span>
</pre></div>
</div>
<p>Each site can be started with its own settings file. In development <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">runserver</span> <span class="pre">--settings</span> <span class="pre">settings.acom</span></code>.
In production, for example with uWSGI, specify the correct settings with <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">=</span> <span class="pre">DJANGO_SETTINGS_MODULE=settings.acom</span></code>.</p>
<p>Because each site has its own database and media folder, nothing can ‘leak’ to another site. But this also means that content cannot be shared between sites as one can do when using the multi-site option.</p>
<p>In this configuration, multiple sites share the same, single set of project files. Deployment would update the single set of project files and reload each instance.</p>
<p>This multi-instance configuration isn’t that different from deploying the project code several times. However, having a single set of project files, and only differentiate with settings files, is the closest Wagtail can get to true multi-tenancy. Every site is identical, content is separated, including user management. ‘Adding a new tenant’ is adding a new settings file and running a new instance.</p>
<p>In a multi-instance configuration, each instance requires a certain amount of server resources (CPU and memory). That means adding sites will increase server load. This only scales up to a certain point.</p>
</div>
<div class="section" id="multi-tenancy">
<h5><a class="toc-backref" href="#id3">Multi-tenancy</a><a class="headerlink" href="#multi-tenancy" title="Permalink to this headline">¶</a></h5>
<p>Multi-tenancy is a project configuration in which a single instance of the software serves multiple tenants. A tenant is a group of users who have access and permission to a single site. Multitenant software is designed to provide every tenant its configuration, data, and user management.</p>
<p>Wagtail supports <em>multi-site</em>, where user management and content are shared. Wagtail can run <em>multi-instance</em> where there is full separation of content at the cost of running multiple instances. Multi-tenancy combines the best of both worlds: a single instance, and the full separation of content per site and user management.</p>
<p>Wagtail does not support full multi-tenancy at this moment. But it is on our radar, we would like to improve Wagtail to add multi-tenancy - while still supporting the existing multi-site option. If you have ideas or like to contribute, join us on <a class="reference internal" href="index.html#slack"><span class="std std-ref">Slack</span></a> in the multi-tenancy channel.</p>
<p>Wagtail currently has the following features to support multi-tenancy:</p>
<ul class="simple">
<li>A Site model mapping a hostname to a root page</li>
<li>Permissions to allow groups of users to manage:<ul>
<li>arbitrary sections of the page tree</li>
<li>sections of the collection tree (coming soon)</li>
<li>one or more collections of documents and images</li>
</ul>
</li>
<li>The page API is automatically scoped to the host used for the request</li>
</ul>
<p>But several features do not currently support multi-tenancy:</p>
<ul class="simple">
<li>Snippets are global pieces of content so not suitable for multi-tenancy but any model that can be registered as a snippet can also be managed via the Wagtail model admin. You can add a site_id to the model and then use the model admin get_queryset method to determine which site can manage each object. The built-in snippet choosers can be replaced by <a class="reference external" href="https://pypi.org/project/wagtail-modelchooser/">modelchooser</a> that allows filtering the queryset to restrict which sites may display which objects.</li>
<li>Site, site setting, user, and group management. At the moment, your best bet is to only allow superusers to manage these objects.</li>
<li>Workflows and workflow tasks</li>
<li>Site history</li>
<li>Redirects</li>
</ul>
<p>Permission configuration for built-in models like Sites, Site settings and Users is not site-specific, so any user with permission to edit a single entry can edit them all. This limitation can be mostly circumvented by only allowing superusers to manage these models.</p>
<p>Python, Django, and Wagtail allow you to override, extend and customize functionality. Here are some ideas that may help you create a multi-tenancy solution for your site:</p>
<ul class="simple">
<li>Django allows to override templates, this also works in the Wagtail admin.</li>
<li>A custom user model can be used to link users to a specific site.</li>
<li>Custom admin views can provide more restrictive user management.</li>
</ul>
<p>We welcome interested members of the Wagtail community to contribute code and ideas.</p>
</div>
</div>
</div>
</div>
<span id="document-extending/index"></span><div class="section" id="extending-wagtail">
<h3>Extending Wagtail<a class="headerlink" href="#extending-wagtail" title="Permalink to this headline">¶</a></h3>
<p>The Wagtail admin interface is a suite of Django apps, and so the familiar concepts from Django development - views, templates, URL routes and so on - can be used to add new functionality to Wagtail. Numerous <a class="reference external" href="https://wagtail.io/packages/">third-party packages</a> can be installed to extend Wagtail’s capabilities.</p>
<p>This section describes the various mechanisms that can be used to integrate your own code into Wagtail’s admin interface.</p>
<div class="toctree-wrapper compound">
<span id="document-extending/admin_views"></span><div class="section" id="creating-admin-views">
<h4>Creating admin views<a class="headerlink" href="#creating-admin-views" title="Permalink to this headline">¶</a></h4>
<p>The most common use for adding custom views to the Wagtail admin is to provide an interface for managing a Django model. The <a class="reference internal" href="index.html#document-reference/contrib/modeladmin/index"><span class="doc">ModelAdmin</span></a> app makes this simple, providing ready-made views for listing, creating and editing objects with minimal configuration.</p>
<p>For other kinds of admin view that don’t fit this pattern, you can write your own Django views and register them as part of the Wagtail admin through <a class="reference internal" href="index.html#admin-hooks"><span class="std std-ref">hooks</span></a>. In this example, we’ll implement a view that displays a calendar for the current year, using <a class="reference external" href="https://docs.python.org/3/library/calendar.html">the calendar module</a> from Python’s standard library.</p>
<div class="section" id="defining-a-view">
<h5>Defining a view<a class="headerlink" href="#defining-a-view" title="Permalink to this headline">¶</a></h5>
<p>Within a Wagtail project, create a new <code class="docutils literal notranslate"><span class="pre">wagtailcalendar</span></code> app with <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">startapp</span> <span class="pre">wagtailcalendar</span></code> and add it to your project’s <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>. (In this case we’re using the name ‘wagtailcalendar’ to avoid clashing with the standard library’s <code class="docutils literal notranslate"><span class="pre">calendar</span></code> module - in general there is no need to use a ‘wagtail’ prefix.)</p>
<p>Edit <code class="docutils literal notranslate"><span class="pre">views.py</span></code> as follows - note that this is a plain Django view with no Wagtail-specific code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">calendar</span>

<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">current_year</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
    <span class="n">calendar_html</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">HTMLCalendar</span><span class="p">()</span><span class="o">.</span><span class="n">formatyear</span><span class="p">(</span><span class="n">current_year</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">calendar_html</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="registering-a-url-route">
<h5>Registering a URL route<a class="headerlink" href="#registering-a-url-route" title="Permalink to this headline">¶</a></h5>
<p>At this point, the standard practice for a Django project would be to add a URL route for this view to your project’s top-level URL config module. However, in this case we want the view to only be available to logged-in users, and to appear within the <code class="docutils literal notranslate"><span class="pre">/admin/</span></code> URL namespace which is managed by Wagtail. This is done through the <a class="reference internal" href="index.html#register-admin-urls"><span class="std std-ref">register_admin_urls</span></a> hook.</p>
<p>On startup, Wagtail looks for a <code class="docutils literal notranslate"><span class="pre">wagtail_hooks</span></code> submodule within each installed app. In this submodule, you can define functions to be run at various points in Wagtail’s operation, such as building the URL config for the admin, and constructing the main menu.</p>
<p>Create a <code class="docutils literal notranslate"><span class="pre">wagtail_hooks.py</span></code> file within the <code class="docutils literal notranslate"><span class="pre">wagtailcalendar</span></code> app containing the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">index</span>


<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_admin_urls&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_calendar_url</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">path</span><span class="p">(</span><span class="s1">&#39;calendar/&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;calendar&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>The calendar will now be visible at the URL <code class="docutils literal notranslate"><span class="pre">/admin/calendar/</span></code>.</p>
<div class="figure">
<img alt="A calendar, presented in unstyled HTML" src="_images/adminviews_calendar.png" />
</div>
</div>
<div class="section" id="adding-a-template">
<h5>Adding a template<a class="headerlink" href="#adding-a-template" title="Permalink to this headline">¶</a></h5>
<p>Currently this view is outputting a plain HTML fragment. Let’s insert this into the usual Wagtail admin page furniture, by creating a template that extends Wagtail’s base template <code class="docutils literal notranslate"><span class="pre">&quot;wagtailadmin/base.html&quot;</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The base template and HTML structure are not considered a stable part of Wagtail’s API, and may change in future releases.</p>
</div>
<p>Update <code class="docutils literal notranslate"><span class="pre">views.py</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">current_year</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
    <span class="n">calendar_html</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">HTMLCalendar</span><span class="p">()</span><span class="o">.</span><span class="n">formatyear</span><span class="p">(</span><span class="n">current_year</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;wagtailcalendar/index.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;current_year&#39;</span><span class="p">:</span> <span class="n">current_year</span><span class="p">,</span>
        <span class="s1">&#39;calendar_html&#39;</span><span class="p">:</span> <span class="n">calendar_html</span><span class="p">,</span>
    <span class="p">})</span>
</pre></div>
</div>
<p>Now create a <code class="docutils literal notranslate"><span class="pre">templates/wagtailcalendar/</span></code> folder within the <code class="docutils literal notranslate"><span class="pre">wagtailcalendar</span></code> app, containing <code class="docutils literal notranslate"><span class="pre">index.html</span></code> as follows:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailadmin/base.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">titletag</span> <span class="cp">%}{{</span> <span class="nv">current_year</span> <span class="cp">}}</span> calendar<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra_css</span> <span class="cp">%}</span>
    <span class="cp">{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
        <span class="nt">table</span><span class="p">.</span><span class="nc">month</span> <span class="p">{</span>
            <span class="k">margin</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nt">table</span><span class="p">.</span><span class="nc">month</span> <span class="nt">td</span><span class="o">,</span> <span class="nt">table</span><span class="p">.</span><span class="nc">month</span> <span class="nt">th</span> <span class="p">{</span>
            <span class="k">padding</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;wagtailadmin/shared/header.html&quot;</span> <span class="k">with</span> <span class="nv">title</span><span class="o">=</span><span class="s2">&quot;Calendar&quot;</span> <span class="nv">icon</span><span class="o">=</span><span class="s2">&quot;date&quot;</span> <span class="cp">%}</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nice-padding&quot;</span><span class="p">&gt;</span>
        <span class="cp">{{</span> <span class="nv">calendar_html</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Here we are overriding three of the blocks defined in the base template: <code class="docutils literal notranslate"><span class="pre">titletag</span></code> (which sets the content of the HTML <code class="docutils literal notranslate"><span class="pre">&lt;title&gt;</span></code> tag), <code class="docutils literal notranslate"><span class="pre">extra_css</span></code> (which allows us to provide additional CSS styles specific to this page), and <code class="docutils literal notranslate"><span class="pre">content</span></code> (for the main content area of the page). We’re also including the standard header bar component, and setting a title and icon. For a list of the recognised icon identifiers, see the <a class="reference internal" href="index.html#styleguide"><span class="std std-ref">UI Styleguide</span></a>.</p>
<p>Revisiting <code class="docutils literal notranslate"><span class="pre">/admin/calendar/</span></code> will now show the calendar within the Wagtail admin page furniture.</p>
<div class="figure">
<img alt="A calendar, shown within the Wagtail admin interface" src="_images/adminviews_calendar_template.png" />
</div>
</div>
<div class="section" id="adding-a-menu-item">
<h5>Adding a menu item<a class="headerlink" href="#adding-a-menu-item" title="Permalink to this headline">¶</a></h5>
<p>Our calendar view is now complete, but there’s no way to reach it from the rest of the admin backend. To add an item to the sidebar menu, we’ll use another hook, <a class="reference internal" href="index.html#register-admin-menu-item"><span class="std std-ref">register_admin_menu_item</span></a>. Update <code class="docutils literal notranslate"><span class="pre">wagtail_hooks.py</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">reverse</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.menu</span> <span class="kn">import</span> <span class="n">MenuItem</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">index</span>


<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_admin_urls&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_calendar_url</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">path</span><span class="p">(</span><span class="s1">&#39;calendar/&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;calendar&#39;</span><span class="p">),</span>
    <span class="p">]</span>


<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_admin_menu_item&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_calendar_menu_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">MenuItem</span><span class="p">(</span><span class="s1">&#39;Calendar&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;calendar&#39;</span><span class="p">),</span> <span class="n">icon_name</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A ‘Calendar’ item will now appear in the menu.</p>
<div class="figure">
<img alt="Wagtail admin sidebar menu, showing a &quot;Calendar&quot; menu item with a date icon" src="_images/adminviews_menu.png" />
</div>
</div>
</div>
<span id="document-extending/template_components"></span><div class="section" id="template-components">
<h4>Template components<a class="headerlink" href="#template-components" title="Permalink to this headline">¶</a></h4>
<p>Working with objects that know how to render themselves as elements on an HTML template is a common pattern seen throughout the Wagtail admin. For example, the admin homepage is a view provided by the central <code class="docutils literal notranslate"><span class="pre">wagtail.admin</span></code> app, but brings together information panels sourced from various other modules of Wagtail, such as images and documents (potentially along with others provided by third-party packages). These panels are passed to the homepage via the <a class="reference external" href="../reference/hooks.html#construct-homepage-panels"><code class="docutils literal notranslate"><span class="pre">construct_homepage_panels</span></code></a> hook, and each one is responsible for providing its own HTML rendering. In this way, the module providing the panel has full control over how it appears on the homepage.</p>
<p>Wagtail implements this pattern using a standard object type known as a <strong>component</strong>. A component is a Python object that provides the following methods and properties:</p>
<dl class="method">
<dt id="render_html">
<code class="descname">render_html</code><span class="sig-paren">(</span><em>self</em>, <em>parent_context=None</em><span class="sig-paren">)</span><a class="headerlink" href="#render_html" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Given a context dictionary from the calling template (which may be a <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/templates/api/#django.template.Context" title="(in Django v3.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> object or a plain <code class="docutils literal notranslate"><span class="pre">dict</span></code> of context variables), returns the string representation to be inserted into the template. This will be subject to Django’s HTML escaping rules, so a return value consisting of HTML should typically be returned as a <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/utils/#module-django.utils.safestring" title="(in Django v3.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">SafeString</span></code></a> instance.</p>
<dl class="attribute">
<dt id="media">
<code class="descname">media</code><a class="headerlink" href="#media" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A (possibly empty) <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/forms/media/" title="(in Django v3.2)"><span class="xref std std-doc">form media</span></a> object defining JavaScript and CSS resources used by the component.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any object implementing this API can be considered a valid component; it does not necessarily have to inherit from the <code class="docutils literal notranslate"><span class="pre">Component</span></code> class described below, and user code that works with components should not assume this (for example, it must not use <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> to check whether a given value is a component).</p>
</div>
<div class="section" id="creating-components">
<span id="creating-template-components"></span><h5>Creating components<a class="headerlink" href="#creating-components" title="Permalink to this headline">¶</a></h5>
<p>The preferred way to create a component is to define a subclass of <code class="docutils literal notranslate"><span class="pre">wagtail.admin.ui.components.Component</span></code> and specify a <code class="docutils literal notranslate"><span class="pre">template_name</span></code> attribute on it. The rendered template will then be used as the component’s HTML representation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin.ui.components</span> <span class="kn">import</span> <span class="n">Component</span>

<span class="k">class</span> <span class="nc">WelcomePanel</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;my_app/panels/welcome.html&#39;</span>


<span class="n">my_welcome_panel</span> <span class="o">=</span> <span class="n">WelcomePanel</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">my_app/templates/my_app/panels/welcome.html</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome to my app!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>For simple cases that don’t require a template, the <code class="docutils literal notranslate"><span class="pre">render_html</span></code> method can be overridden instead:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.components</span> <span class="kn">import</span> <span class="n">Component</span>

<span class="k">class</span> <span class="nc">WelcomePanel</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_context</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span><span class="s2">&quot;&lt;h1&gt;</span><span class="si">{}</span><span class="s2">&lt;/h1&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;Welcome to my app!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="passing-context-to-the-template">
<h5>Passing context to the template<a class="headerlink" href="#passing-context-to-the-template" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">get_context_data</span></code> method can be overridden to pass context variables to the template. As with <code class="docutils literal notranslate"><span class="pre">render_html</span></code>, this receives the context dictionary from the calling template:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin.ui.components</span> <span class="kn">import</span> <span class="n">Component</span>

<span class="k">class</span> <span class="nc">WelcomePanel</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;my_app/panels/welcome.html&#39;</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_context</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">parent_context</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_context</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span>
        <span class="k">return</span> <span class="n">context</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">my_app/templates/my_app/panels/welcome.html</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome to my app, <span class="cp">{{</span> <span class="nv">username</span> <span class="cp">}}</span>!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-media-definitions">
<h5>Adding media definitions<a class="headerlink" href="#adding-media-definitions" title="Permalink to this headline">¶</a></h5>
<p>Like Django form widgets, components can specify associated JavaScript and CSS resources using either an inner <code class="docutils literal notranslate"><span class="pre">Media</span></code> class or a dynamic <code class="docutils literal notranslate"><span class="pre">media</span></code> property:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WelcomePanel</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;my_app/panels/welcome.html&#39;</span>

    <span class="k">class</span> <span class="nc">Media</span><span class="p">:</span>
        <span class="n">css</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;my_app/css/welcome-panel.css&#39;</span><span class="p">,)</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="using-components-on-your-own-templates">
<h5>Using components on your own templates<a class="headerlink" href="#using-components-on-your-own-templates" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">wagtailadmin_tags</span></code> tag library provides a <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">component</span> <span class="pre">%}</span></code> tag for including components on a template. This takes care of passing context variables from the calling template to the component (which would not be the case for a basic <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">...</span> <span class="pre">}}</span></code> variable tag). For example, given the view:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="k">def</span> <span class="nf">welcome_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">WelcomePanel</span><span class="p">(),</span>
    <span class="p">]</span>

    <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;my_app/welcome.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;panels&#39;</span><span class="p">:</span> <span class="n">panels</span><span class="p">,</span>
    <span class="p">})</span>
</pre></div>
</div>
<p>the <code class="docutils literal notranslate"><span class="pre">my_app/welcome.html</span></code> template could render the panels as follows:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailadmin_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">panel</span> <span class="k">in</span> <span class="nv">panels</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">component</span> <span class="nv">panel</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Note that it is your template’s responsibility to output any media declarations defined on the components. For a Wagtail admin view, this is best done by constructing a media object for the whole page within the view, passing this to the template, and outputting it via the base template’s <code class="docutils literal notranslate"><span class="pre">extra_js</span></code> and <code class="docutils literal notranslate"><span class="pre">extra_css</span></code> blocks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">Media</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="k">def</span> <span class="nf">welcome_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">WelcomePanel</span><span class="p">(),</span>
    <span class="p">]</span>

    <span class="n">media</span> <span class="o">=</span> <span class="n">Media</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">:</span>
        <span class="n">media</span> <span class="o">+=</span> <span class="n">panel</span><span class="o">.</span><span class="n">media</span>

    <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;my_app/welcome.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;panels&#39;</span><span class="p">:</span> <span class="n">panels</span><span class="p">,</span>
        <span class="s1">&#39;media&#39;</span><span class="p">:</span> <span class="n">media</span><span class="p">,</span>
    <span class="p">})</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">my_app/welcome.html</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailadmin/base.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailadmin_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra_js</span> <span class="cp">%}</span>
    <span class="cp">{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span>
    <span class="cp">{{</span> <span class="nv">media.js</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra_css</span> <span class="cp">%}</span>
    <span class="cp">{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span>
    <span class="cp">{{</span> <span class="nv">media.css</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">panel</span> <span class="k">in</span> <span class="nv">panels</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">component</span> <span class="nv">panel</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-extending/adding_reports"></span><div class="section" id="adding-reports">
<h4>Adding reports<a class="headerlink" href="#adding-reports" title="Permalink to this headline">¶</a></h4>
<p>Reports are views with listings of pages matching a specific query. They can also export these listings in spreadsheet format.
They are found in the <cite>Reports</cite> submenu: by default, the <cite>Locked Pages</cite> report is provided, allowing an overview of locked pages on the site.</p>
<p>It is possible to create your own custom reports in the Wagtail admin. Two base classes are provided:
<code class="docutils literal notranslate"><span class="pre">wagtail.admin.views.reports.ReportView</span></code>, which provides basic listing and spreadsheet export functionality, and
<code class="docutils literal notranslate"><span class="pre">wagtail.admin.views.reports.PageReportView</span></code>, which additionally provides a default set of fields suitable for page listings.
For this example, we’ll add a report which shows any pages with unpublished changes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/views.py</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.views.reports</span> <span class="kn">import</span> <span class="n">PageReportView</span>


<span class="k">class</span> <span class="nc">UnpublishedChangesReportView</span><span class="p">(</span><span class="n">PageReportView</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="section" id="defining-your-report">
<h5>Defining your report<a class="headerlink" href="#defining-your-report" title="Permalink to this headline">¶</a></h5>
<p>The most important attributes and methods to customise to define your report are:</p>
<dl class="method">
<dt id="get_queryset">
<code class="descname">get_queryset</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#get_queryset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This retrieves the queryset of pages for your report. For our example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/views.py</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.views.reports</span> <span class="kn">import</span> <span class="n">PageReportView</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>


<span class="k">class</span> <span class="nc">UnpublishedChangesReportView</span><span class="p">(</span><span class="n">PageReportView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">has_unpublished_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="template_name">
<code class="descname">template_name</code><a class="headerlink" href="#template_name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>(string)</p>
<p>The template used to render your report. For <code class="docutils literal notranslate"><span class="pre">ReportView</span></code>, this defaults to <code class="docutils literal notranslate"><span class="pre">&quot;wagtailadmin/reports/base_report.html&quot;</span></code>,
which provides an empty report page layout; for <code class="docutils literal notranslate"><span class="pre">PageReportView</span></code>, this defaults to
<code class="docutils literal notranslate"><span class="pre">&quot;wagtailadmin/reports/base_page_report.html&quot;</span></code> which provides a listing based on the explorer views,
displaying action buttons, as well as the title, time of the last update, status, and specific type of any pages.
In this example, we’ll change this to a new template in a later section.</p>
<dl class="attribute">
<dt id="title">
<code class="descname">title</code><a class="headerlink" href="#title" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>(string)</p>
<p>The name of your report, which will be displayed in the header. For our example, we’ll set it to
<code class="docutils literal notranslate"><span class="pre">&quot;Pages</span> <span class="pre">with</span> <span class="pre">unpublished</span> <span class="pre">changes&quot;</span></code>.</p>
<dl class="attribute">
<dt id="header_icon">
<code class="descname">header_icon</code><a class="headerlink" href="#header_icon" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>(string)</p>
<p>The name of the icon, using the standard Wagtail icon names. For example, the locked pages view uses <code class="docutils literal notranslate"><span class="pre">&quot;locked&quot;</span></code>,
and for our example report, we’ll set it to <code class="docutils literal notranslate"><span class="pre">'doc-empty-inverse'</span></code>.</p>
<div class="section" id="spreadsheet-exports">
<h6>Spreadsheet exports<a class="headerlink" href="#spreadsheet-exports" title="Permalink to this headline">¶</a></h6>
<dl class="attribute">
<dt id="list_export">
<code class="descname">list_export</code><a class="headerlink" href="#list_export" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>(list)</p>
<p>A list of the fields/attributes for each model which are exported as columns in the spreadsheet view. For <code class="docutils literal notranslate"><span class="pre">ReportView</span></code>, this
is empty by default, and for <code class="docutils literal notranslate"><span class="pre">PageReportView</span></code>, it corresponds to the listing fields: the title, time of the last update, status,
and specific type of any pages. For our example, we might want to know when the page was last published, so we’ll set
<code class="docutils literal notranslate"><span class="pre">list_export</span></code> as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">list_export</span> <span class="pre">=</span> <span class="pre">PageReportView.list_export</span> <span class="pre">+</span> <span class="pre">['last_published_at']</span></code></p>
<dl class="attribute">
<dt id="export_headings">
<code class="descname">export_headings</code><a class="headerlink" href="#export_headings" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>(dictionary)</p>
<p>A dictionary of any fields/attributes in <code class="docutils literal notranslate"><span class="pre">list_export</span></code> for which you wish to manually specify a heading for the spreadsheet
column, and their headings. If unspecified, the heading will be taken from the field <code class="docutils literal notranslate"><span class="pre">verbose_name</span></code> if applicable, and the
attribute string otherwise. For our example, <code class="docutils literal notranslate"><span class="pre">last_published_at</span></code> will automatically get a heading of <code class="docutils literal notranslate"><span class="pre">&quot;Last</span> <span class="pre">Published</span> <span class="pre">At&quot;</span></code>,
but a simple “Last Published” looks neater. We’ll add that by setting <code class="docutils literal notranslate"><span class="pre">export_headings</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">export_headings</span> <span class="pre">=</span> <span class="pre">dict(last_published_at='Last</span> <span class="pre">Published',</span> <span class="pre">**PageReportView.export_headings)</span></code></p>
<dl class="attribute">
<dt id="custom_value_preprocess">
<code class="descname">custom_value_preprocess</code><a class="headerlink" href="#custom_value_preprocess" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>(dictionary)</p>
<p>A dictionary of <code class="docutils literal notranslate"><span class="pre">(value_class_1,</span> <span class="pre">value_class_2,</span> <span class="pre">...)</span></code> tuples mapping to <code class="docutils literal notranslate"><span class="pre">{export_format:</span> <span class="pre">preprocessing_function}</span></code> dictionaries,
allowing custom preprocessing functions to be applied when exporting field values of specific classes (or their subclasses). If
unspecified (and <code class="docutils literal notranslate"><span class="pre">ReportView.custom_field_preprocess</span></code> also does not specify a function), <code class="docutils literal notranslate"><span class="pre">force_str</span></code> will be used. To prevent
preprocessing, set the preprocessing_function to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<dl class="attribute">
<dt id="custom_field_preprocess">
<code class="descname">custom_field_preprocess</code><a class="headerlink" href="#custom_field_preprocess" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>(dictionary)</p>
<p>A dictionary of <code class="docutils literal notranslate"><span class="pre">field_name</span></code> strings mapping to <code class="docutils literal notranslate"><span class="pre">{export_format:</span> <span class="pre">preprocessing_function}</span></code> dictionaries,
allowing custom preprocessing functions to be applied when exporting field values of specific classes (or their subclasses). This
will take priority over functions specified in <code class="docutils literal notranslate"><span class="pre">ReportView.custom_value_preprocess</span></code>. If unspecified (and
<code class="docutils literal notranslate"><span class="pre">ReportView.custom_value_preprocess</span></code> also does not specify a function), <code class="docutils literal notranslate"><span class="pre">force_str</span></code> will be used. To prevent
preprocessing, set the preprocessing_function to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div>
<div class="section" id="customising-templates">
<h6>Customising templates<a class="headerlink" href="#customising-templates" title="Permalink to this headline">¶</a></h6>
<p>For this example “pages with unpublished changes” report, we’ll add an extra column to the listing template, showing the last
publication date for each page. To do this, we’ll extend two templates: <code class="docutils literal notranslate"><span class="pre">wagtailadmin/reports/base_page_report.html</span></code>, and
<code class="docutils literal notranslate"><span class="pre">wagtailadmin/reports/listing/_list_page_report.html</span></code>.</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="c">{# &lt;project&gt;/templates/reports/unpublished_changes_report.html #}</span>

<span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;wagtailadmin/reports/base_page_report.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">listing</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;reports/include/_list_unpublished_changes.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">no_results</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>No pages with unpublished changes.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="c">{# &lt;project&gt;/templates/reports/include/_list_unpublished_changes.html #}</span>

<span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;wagtailadmin/reports/listing/_list_page_report.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra_columns</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Last Published<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra_page_data</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">valign</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">&gt;</span>
        <span class="cp">{{</span> <span class="nv">page.last_published_at</span> <span class="cp">}}</span>
    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Finally, we’ll set <code class="docutils literal notranslate"><span class="pre">UnpublishedChangesReportView.template_name</span></code> to this new template: <code class="docutils literal notranslate"><span class="pre">'reports/unpublished_changes_report.html'</span></code>.</p>
</div>
</div>
<div class="section" id="adding-a-menu-item-and-admin-url">
<h5>Adding a menu item and admin URL<a class="headerlink" href="#adding-a-menu-item-and-admin-url" title="Permalink to this headline">¶</a></h5>
<p>To add a menu item for your new report to the <cite>Reports</cite> submenu, you will need to use the <code class="docutils literal notranslate"><span class="pre">register_reports_menu_item</span></code> hook (see: <a class="reference internal" href="index.html#register-reports-menu-item"><span class="std std-ref">register_reports_menu_item</span></a>). To add an admin
url for the report, you will need to use the <code class="docutils literal notranslate"><span class="pre">register_admin_urls</span></code> hook (see <a class="reference internal" href="index.html#register-admin-urls"><span class="std std-ref">register_admin_urls</span></a>). This can be done as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/wagtail_hooks.py</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">reverse</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.menu</span> <span class="kn">import</span> <span class="n">AdminOnlyMenuItem</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">UnpublishedChangesReportView</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_reports_menu_item&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_unpublished_changes_report_menu_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">AdminOnlyMenuItem</span><span class="p">(</span><span class="s2">&quot;Pages with unpublished changes&quot;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;unpublished_changes_report&#39;</span><span class="p">),</span> <span class="n">classnames</span><span class="o">=</span><span class="s1">&#39;icon icon-&#39;</span> <span class="o">+</span> <span class="n">UnpublishedChangesReportView</span><span class="o">.</span><span class="n">header_icon</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">700</span><span class="p">)</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_admin_urls&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_unpublished_changes_report_url</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">path</span><span class="p">(</span><span class="s1">&#39;reports/unpublished-changes/&#39;</span><span class="p">,</span> <span class="n">UnpublishedChangesReportView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;unpublished_changes_report&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Here, we use the <code class="docutils literal notranslate"><span class="pre">AdminOnlyMenuItem</span></code> class to ensure our report icon is only shown to superusers. To make the report visible to all users,
you could replace this with <code class="docutils literal notranslate"><span class="pre">MenuItem</span></code>.</p>
</div>
<div class="section" id="the-full-code">
<h5>The full code<a class="headerlink" href="#the-full-code" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/views.py</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.views.reports</span> <span class="kn">import</span> <span class="n">PageReportView</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>


<span class="k">class</span> <span class="nc">UnpublishedChangesReportView</span><span class="p">(</span><span class="n">PageReportView</span><span class="p">):</span>

    <span class="n">header_icon</span> <span class="o">=</span> <span class="s1">&#39;doc-empty-inverse&#39;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;reports/unpublished_changes_report.html&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Pages with unpublished changes&quot;</span>

    <span class="n">list_export</span> <span class="o">=</span> <span class="n">PageReportView</span><span class="o">.</span><span class="n">list_export</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;last_published_at&#39;</span><span class="p">]</span>
    <span class="n">export_headings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">last_published_at</span><span class="o">=</span><span class="s1">&#39;Last Published&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">PageReportView</span><span class="o">.</span><span class="n">export_headings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">has_unpublished_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/wagtail_hooks.py</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">reverse</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.menu</span> <span class="kn">import</span> <span class="n">AdminOnlyMenuItem</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">UnpublishedChangesReportView</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_reports_menu_item&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_unpublished_changes_report_menu_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">AdminOnlyMenuItem</span><span class="p">(</span><span class="s2">&quot;Pages with unpublished changes&quot;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;unpublished_changes_report&#39;</span><span class="p">),</span> <span class="n">classnames</span><span class="o">=</span><span class="s1">&#39;icon icon-&#39;</span> <span class="o">+</span> <span class="n">UnpublishedChangesReportView</span><span class="o">.</span><span class="n">header_icon</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">700</span><span class="p">)</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_admin_urls&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_unpublished_changes_report_url</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">path</span><span class="p">(</span><span class="s1">&#39;reports/unpublished-changes/&#39;</span><span class="p">,</span> <span class="n">UnpublishedChangesReportView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;unpublished_changes_report&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="c">{# &lt;project&gt;/templates/reports/unpublished_changes_report.html #}</span>

<span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;wagtailadmin/reports/base_page_report.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">listing</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;reports/include/_list_unpublished_changes.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">no_results</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>No pages with unpublished changes.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="c">{# &lt;project&gt;/templates/reports/include/_list_unpublished_changes.html #}</span>

<span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;wagtailadmin/reports/listing/_list_page_report.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra_columns</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Last Published<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra_page_data</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">valign</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">&gt;</span>
        <span class="cp">{{</span> <span class="nv">page.last_published_at</span> <span class="cp">}}</span>
    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-extending/custom_tasks"></span><div class="section" id="adding-new-task-types">
<h4>Adding new Task types<a class="headerlink" href="#adding-new-task-types" title="Permalink to this headline">¶</a></h4>
<p>The Workflow system allows users to create tasks, which represent stages of moderation.</p>
<p>Wagtail provides one built in task type: <code class="docutils literal notranslate"><span class="pre">GroupApprovalTask</span></code>, which allows any user in specific groups to approve or reject moderation.</p>
<p>However, it is possible to add your own task types in code. Instances of your custom task can then be created in the <code class="docutils literal notranslate"><span class="pre">Tasks</span></code> section of the Wagtail Admin.</p>
<div class="section" id="task-models">
<h5>Task models<a class="headerlink" href="#task-models" title="Permalink to this headline">¶</a></h5>
<p>All custom tasks must be models inheriting from <code class="docutils literal notranslate"><span class="pre">wagtailcore.Task</span></code>. In this set of examples, we’ll set up a task which can be approved by only one specific user.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/models.py</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Task</span>


<span class="k">class</span> <span class="nc">UserApprovalTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Subclassed Tasks follow the same approach as Pages: they are concrete models, with the specific subclass instance accessible by calling <code class="docutils literal notranslate"><span class="pre">Task.specific()</span></code>.</p>
<p>You can now add any custom fields. To make these editable in the admin, add the names of the fields into the <code class="docutils literal notranslate"><span class="pre">admin_form_fields</span></code> attribute:</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/models.py</span>

<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Task</span>


<span class="k">class</span> <span class="nc">UserApprovalTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">admin_form_fields</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">admin_form_fields</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Any fields that shouldn’t be edited after task creation - for example, anything that would fundamentally change the meaning of the task in any history logs -
can be added to <code class="docutils literal notranslate"><span class="pre">admin_form_readonly_on_edit_fields</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/models.py</span>

<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Task</span>


<span class="k">class</span> <span class="nc">UserApprovalTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">admin_form_fields</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">admin_form_fields</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>

    <span class="c1"># prevent editing of ``user`` after the task is created</span>
    <span class="c1"># by default, this attribute contains the &#39;name&#39; field to prevent tasks from being renamed</span>
    <span class="n">admin_form_readonly_on_edit_fields</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">admin_form_readonly_on_edit_fields</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Wagtail will choose a default form widget to use based on the field type. But you can override the form widget using the <code class="docutils literal notranslate"><span class="pre">admin_form_widgets</span></code> attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/models.py</span>

<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Task</span>

<span class="kn">from</span> <span class="nn">.widgets</span> <span class="kn">import</span> <span class="n">CustomUserChooserWidget</span>


<span class="k">class</span> <span class="nc">UserApprovalTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">admin_form_fields</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">admin_form_fields</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>

    <span class="n">admin_form_widgets</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">CustomUserChooserWidget</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-taskstate-models">
<h5>Custom TaskState models<a class="headerlink" href="#custom-taskstate-models" title="Permalink to this headline">¶</a></h5>
<p>You might also need to store custom state information for the task: for example, a rating left by an approving user.
Normally, this is done on an instance of <code class="docutils literal notranslate"><span class="pre">TaskState</span></code>, which is created when a page starts the task. However, this can
also be subclassed equivalently to <code class="docutils literal notranslate"><span class="pre">Task</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/models.py</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">TaskState</span>


<span class="k">class</span> <span class="nc">UserApprovalTaskState</span><span class="p">(</span><span class="n">TaskState</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Your custom task must then be instructed to generate an instance of your custom task state on start instead of a plain <code class="docutils literal notranslate"><span class="pre">TaskState</span></code> instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/models.py</span>

<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Task</span><span class="p">,</span> <span class="n">TaskState</span>


<span class="k">class</span> <span class="nc">UserApprovalTaskState</span><span class="p">(</span><span class="n">TaskState</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">UserApprovalTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">admin_form_fields</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">admin_form_fields</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>

    <span class="n">task_state_class</span> <span class="o">=</span> <span class="n">UserApprovalTaskState</span>
</pre></div>
</div>
</div>
<div class="section" id="customising-behaviour">
<h5>Customising behaviour<a class="headerlink" href="#customising-behaviour" title="Permalink to this headline">¶</a></h5>
<p>Both <code class="docutils literal notranslate"><span class="pre">Task</span></code> and <code class="docutils literal notranslate"><span class="pre">TaskState</span></code> have a number of methods which can be overridden to implement custom behaviour. Here are some of the most useful:</p>
<p><code class="docutils literal notranslate"><span class="pre">Task.user_can_access_editor(page,</span> <span class="pre">user)</span></code>, <code class="docutils literal notranslate"><span class="pre">Task.user_can_lock(page,</span> <span class="pre">user)</span></code>, <code class="docutils literal notranslate"><span class="pre">Task.user_can_unlock(page,</span> <span class="pre">user)</span></code>:</p>
<p>These methods determine if users usually without permissions can access the editor, lock, or unlock the page, by returning True or False.
Note that returning <code class="docutils literal notranslate"><span class="pre">False</span></code> will not prevent users who would normally be able to perform those actions. For example, for our <code class="docutils literal notranslate"><span class="pre">UserApprovalTask</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">user_can_access_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">user</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Task.page_locked_for_user(page,</span> <span class="pre">user)</span></code>:</p>
<p>This returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the page should be locked and uneditable by the user. It is
used by <cite>GroupApprovalTask</cite> to lock the page to any users not in the approval group.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">page_locked_for_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">user</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Task.get_actions(page,</span> <span class="pre">user)</span></code>:</p>
<p>This returns a list of <code class="docutils literal notranslate"><span class="pre">(action_name,</span> <span class="pre">action_verbose_name,</span> <span class="pre">action_requires_additional_data_from_modal)</span></code> tuples, corresponding to the actions available for the task in the edit view menu.
<code class="docutils literal notranslate"><span class="pre">action_requires_additional_data_from_modal</span></code> should be a boolean, returning <code class="docutils literal notranslate"><span class="pre">True</span></code> if choosing the action should open a modal for
additional data input - for example, entering a comment.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">user</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;approve&#39;</span><span class="p">,</span> <span class="s2">&quot;Approve&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;reject&#39;</span><span class="p">,</span> <span class="s2">&quot;Reject&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;cancel&#39;</span><span class="p">,</span> <span class="s2">&quot;Cancel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Task.get_form_for_action(action)</span></code>:</p>
<p>Returns a form to be used for additional data input for the given action modal. By default,
returns <code class="docutils literal notranslate"><span class="pre">TaskStateCommentForm</span></code>, with a single comment field. The form data returned in
<code class="docutils literal notranslate"><span class="pre">form.cleaned_data</span></code> must be fully serializable as JSON.</p>
<p><code class="docutils literal notranslate"><span class="pre">Task.get_template_for_action(action)</span></code>:</p>
<p>Returns the name of a custom template to be used in rendering the data entry modal for that action.</p>
<p><code class="docutils literal notranslate"><span class="pre">Task.on_action(task_state,</span> <span class="pre">user,</span> <span class="pre">action_name,</span> <span class="pre">**kwargs)</span></code>:</p>
<p>This performs the actions specified in <code class="docutils literal notranslate"><span class="pre">Task.get_actions(page,</span> <span class="pre">user)</span></code>: it is passed an action name, eg <code class="docutils literal notranslate"><span class="pre">approve</span></code>, and the relevant task state. By default,
it calls <code class="docutils literal notranslate"><span class="pre">approve</span></code> and <code class="docutils literal notranslate"><span class="pre">reject</span></code> methods on the task state when the corresponding action names are passed through. Any additional data entered in a modal
(see <code class="docutils literal notranslate"><span class="pre">get_form_for_action</span></code> and <code class="docutils literal notranslate"><span class="pre">get_actions</span></code>) is supplied as kwargs.</p>
<p>For example,  let’s say we wanted to add an additional option: cancelling the entire workflow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_state</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">action_name</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">action_name</span> <span class="o">==</span> <span class="s1">&#39;cancel&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">task_state</span><span class="o">.</span><span class="n">workflow_state</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_action</span><span class="p">(</span><span class="n">task_state</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">workflow_state</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Task.get_task_states_user_can_moderate(user,</span> <span class="pre">**kwargs)</span></code>:</p>
<p>This returns a QuerySet of <code class="docutils literal notranslate"><span class="pre">TaskStates</span></code> (or subclasses) the given user can moderate - this is currently used to select pages to display on the user’s dashboard.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_task_states_user_can_moderate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">user</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
        <span class="c1"># get all task states linked to the (base class of) current task</span>
        <span class="k">return</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">TaskState</span><span class="o">.</span><span class="n">STATUS_IN_PROGRESS</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">task_ptr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Task.get_description()</span></code></p>
<p>A class method that returns the human-readable description for the task.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Members of the chosen Wagtail Groups can approve this task&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-notifications">
<h5>Adding notifications<a class="headerlink" href="#adding-notifications" title="Permalink to this headline">¶</a></h5>
<p>Wagtail’s notifications are sent by <code class="docutils literal notranslate"><span class="pre">wagtail.admin.mail.Notifier</span></code> subclasses: callables intended to be connected to a signal.</p>
<p>By default, email notifications are sent upon workflow submission, approval and rejection, and upon submission to a group approval task.</p>
<p>As an example, we’ll add email notifications for when our new task is started.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/mail.py</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.mail</span> <span class="kn">import</span> <span class="n">EmailNotifier</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">TaskState</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">UserApprovalTaskState</span>


<span class="k">class</span> <span class="nc">BaseUserApprovalTaskStateEmailNotifier</span><span class="p">(</span><span class="n">EmailNotifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A base EmailNotifier to send updates for UserApprovalTask events&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Allow UserApprovalTaskState and TaskState to send notifications</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">((</span><span class="n">UserApprovalTaskState</span><span class="p">,</span> <span class="n">TaskState</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">can_handle</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">specific</span><span class="p">,</span> <span class="n">UserApprovalTask</span><span class="p">):</span>
            <span class="c1"># Don&#39;t send notifications if a Task has been cancelled and then resumed - ie page was updated to a new revision</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">workflow_state</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">workflow_state</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">task</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">TaskState</span><span class="o">.</span><span class="n">STATUS_CANCELLED</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_state</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">task_state</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">task_state</span><span class="o">.</span><span class="n">workflow_state</span><span class="o">.</span><span class="n">page</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">task_state</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">specific</span>
        <span class="k">return</span> <span class="n">context</span>

    <span class="k">def</span> <span class="nf">get_recipient_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_state</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># Send emails to the user assigned to the task</span>
        <span class="n">approving_user</span> <span class="o">=</span> <span class="n">task_state</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">specific</span><span class="o">.</span><span class="n">user</span>

        <span class="n">recipients</span> <span class="o">=</span> <span class="p">{</span><span class="n">approving_user</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">recipients</span>

    <span class="k">def</span> <span class="nf">get_template_base_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Get the template base prefix for TaskState, so use the ``wagtailadmin/notifications/task_state_`` set of notification templates</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_template_base_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">task_state_ptr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UserApprovalTaskStateSubmissionEmailNotifier</span><span class="p">(</span><span class="n">BaseUserApprovalTaskStateEmailNotifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An EmailNotifier to send updates for UserApprovalTask submission events&quot;&quot;&quot;</span>

    <span class="n">notification</span> <span class="o">=</span> <span class="s1">&#39;submitted&#39;</span>
</pre></div>
</div>
<p>Similarly, you could define notifier subclasses for approval and rejection notifications.</p>
<p>Next, you need to instantiate the notifier, and connect it to the <code class="docutils literal notranslate"><span class="pre">task_submitted</span></code> signal.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/signal_handlers.py</span>

<span class="kn">from</span> <span class="nn">wagtail.core.signals</span> <span class="kn">import</span> <span class="n">task_submitted</span>
<span class="kn">from</span> <span class="nn">.mail</span> <span class="kn">import</span> <span class="n">UserApprovalTaskStateSubmissionEmailNotifier</span>


<span class="n">task_submission_email_notifier</span> <span class="o">=</span> <span class="n">UserApprovalTaskStateSubmissionEmailNotifier</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">register_signal_handlers</span><span class="p">():</span>
    <span class="n">task_submitted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user_approval_task_submission_email_notifier</span><span class="p">,</span> <span class="n">dispatch_uid</span><span class="o">=</span><span class="s1">&#39;user_approval_task_submitted_email_notification&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">register_signal_handlers()</span></code> should then be run on loading the app: for example, by adding it to the <code class="docutils literal notranslate"><span class="pre">ready()</span></code> method in your <code class="docutils literal notranslate"><span class="pre">AppConfig</span></code>
(and making sure this config is set as <code class="docutils literal notranslate"><span class="pre">default_app_config</span></code> in <code class="docutils literal notranslate"><span class="pre">&lt;project&gt;/__init__.py</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project&gt;/apps.py</span>
<span class="kn">from</span> <span class="nn">django.apps</span> <span class="kn">import</span> <span class="n">AppConfig</span>


<span class="k">class</span> <span class="nc">MyAppConfig</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;myappname&#39;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;myapplabel&#39;</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;My verbose app name&#39;</span>

    <span class="k">def</span> <span class="nf">ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.signal_handlers</span> <span class="kn">import</span> <span class="n">register_signal_handlers</span>
        <span class="n">register_signal_handlers</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<span id="document-extending/audit_log"></span><div class="section" id="audit-log">
<span id="id1"></span><h4>Audit log<a class="headerlink" href="#audit-log" title="Permalink to this headline">¶</a></h4>
<p>Wagtail provides a mechanism to log actions performed on its objects. Common activities such as page creation, update, deletion,
locking and unlocking, revision scheduling and privacy changes are automatically logged at the model level.</p>
<p>The Wagtail admin uses the action log entries to provide a site-wide and page specific history of changes. It uses a
registry of ‘actions’ that provide additional context for the logged action.</p>
<p>The audit log-driven Page history replaces the revisions list page, but provide a filter for revision-specific entries.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The audit log does not replace revisions</p>
</div>
<p>To provide additional <code class="docutils literal notranslate"><span class="pre">Page</span></code> logging for your site or package, invoke the <code class="xref py py-meth docutils literal notranslate"><span class="pre">log_action()</span></code> manager method
via <code class="docutils literal notranslate"><span class="pre">PageLogEntry.objects.log_action(object_instance,</span> <span class="pre">action)</span></code> and register a <code class="docutils literal notranslate"><span class="pre">register_log_actions</span></code> hook to
describe your action (see <a class="reference internal" href="index.html#register-log-actions"><span class="std std-ref">register_log_actions</span></a>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When adding logging, you need to log the action or actions that happen to the <code class="docutils literal notranslate"><span class="pre">Page</span></code>. For example, if the
user creates and publishes, there should be a “create” entry and a “publish” entry. Or, if the user copies a
published page and chooses to keep it published, there should be a “copy” and a “publish” entry for new page.</p>
</div>
<p>You can provide additional metadata by passing additional parameters:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">user</span></code> - a user object.</li>
<li><code class="docutils literal notranslate"><span class="pre">data</span></code> - a data dictionary, stored as JSON</li>
<li><code class="docutils literal notranslate"><span class="pre">title</span></code> - by default, Wagtail will attempt to use <code class="docutils literal notranslate"><span class="pre">get_admin_display_title</span></code> or the string representation of the passed object.</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypackage/views.py</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">PageLogEntry</span>

<span class="k">def</span> <span class="nf">copy_for_translation</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">page</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">log_action</span><span class="o">=</span><span class="s1">&#39;mypackage.copy_for_translation&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>
    <span class="c1"># ..</span>
    <span class="c1"># Manually log an action</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;make&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;it&#39;</span><span class="p">:</span> <span class="s1">&#39;so&#39;</span><span class="p">}</span>
    <span class="p">}</span>
    <span class="n">PageLogEntry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">log_action</span><span class="p">(</span>
        <span class="n">instance</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;mypackage.custom_action&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>To log actions for your non-page model, you can create a class that inherits from <code class="docutils literal notranslate"><span class="pre">BaseLogEntry</span></code> with the appropriate
linking.</p>
<div class="section" id="log-actions-provided-by-wagtail">
<h5>Log actions provided by Wagtail<a class="headerlink" href="#log-actions-provided-by-wagtail" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Action</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.create</span></code></td>
<td>The page was created</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.edit</span></code></td>
<td>A draft was saved</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.delete</span></code></td>
<td>The page was deleted. Will only surface in the Site History for administrators</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.publish</span></code></td>
<td>The page was published</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.publish.schedule</span></code></td>
<td>Draft is scheduled for publishing</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.publish.scheduled</span></code></td>
<td>Draft published via <code class="docutils literal notranslate"><span class="pre">publish_scheduled_pages</span></code> management command</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.schedule.cancel</span></code></td>
<td>Draft scheduled for publishing cancelled via “Cancel scheduled publish”</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.unpublish</span></code></td>
<td>The page was unpublished</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.unpublish.scheduled</span></code></td>
<td>Page unpublished via <code class="docutils literal notranslate"><span class="pre">publish_scheduled_pages</span></code> management command</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.lock</span></code></td>
<td>Page was locked</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.unlock</span></code></td>
<td>Page was unlocked</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.moderation.approve</span></code></td>
<td>The revision was approved for moderation</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.moderation.reject</span></code></td>
<td>The revision was rejected</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.rename</span></code></td>
<td>A page was renamed</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.revert</span></code></td>
<td>The page was reverted to a previous draft</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.copy</span></code></td>
<td>The page was copied to a new location</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.copy_for_translation</span></code></td>
<td>The page was copied into a new locale for translation</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.move</span></code></td>
<td>The page was moved to a new location</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.reorder</span></code></td>
<td>The order of the page under it’s parent was changed</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.view_restriction.create</span></code></td>
<td>The page was restricted</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.view_restriction.edit</span></code></td>
<td>The page restrictions were updated</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.view_restriction.delete</span></code></td>
<td>The page restrictions were removed</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.workflow.start</span></code></td>
<td>The page was submitted for moderation in a Workflow</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.workflow.approve</span></code></td>
<td>The draft was approved at a Workflow Task</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.workflow.reject</span></code></td>
<td>The draft was rejected, and changes requested at a Workflow Task</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">wagtail.workflow.resume</span></code></td>
<td>The draft was resubmitted to the workflow</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">wagtail.workflow.cancel</span></code></td>
<td>The workflow was cancelled</td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-extending/custom_account_settings"></span><div class="section" id="customising-the-user-account-settings-form">
<h4>Customising the user account settings form<a class="headerlink" href="#customising-the-user-account-settings-form" title="Permalink to this headline">¶</a></h4>
<p>This document describes how to customise the user account settings form that can be found by clicking “Account settings”
at the bottom of the main menu.</p>
<div class="section" id="adding-new-panels">
<h5>Adding new panels<a class="headerlink" href="#adding-new-panels" title="Permalink to this headline">¶</a></h5>
<p>Each panel on this form is a separate model form which can operate on an instance of either the user model, or the
<code class="xref py py-class docutils literal notranslate"><span class="pre">UserProfile</span></code> model.</p>
<div class="section" id="basic-example">
<h6>Basic example<a class="headerlink" href="#basic-example" title="Permalink to this headline">¶</a></h6>
<p>Here is an example of how to add a new form that operates on the user model:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># forms.py</span>

<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>

<span class="k">class</span> <span class="nc">CustomSettingsForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># hooks.py</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.views.account</span> <span class="kn">import</span> <span class="n">BaseSettingsPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CustomSettingsForm</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_account_settings_panel&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CustomSettingsPanel</span><span class="p">(</span><span class="n">BaseSettingsPanel</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;My custom settings&quot;</span>
    <span class="n">order</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">CustomSettingsForm</span>
    <span class="n">form_object</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>The attributes are as follows:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> - A unique name for the panel. All form fields are prefixed with this name, so it must be lowercase and cannot contain symbols -</li>
<li><code class="docutils literal notranslate"><span class="pre">title</span></code> - The heading that is displayed to the user</li>
<li><code class="docutils literal notranslate"><span class="pre">order</span></code> - Used to order panels on a tab. The builtin Wagtail panels start at <code class="docutils literal notranslate"><span class="pre">100</span></code> and increase by <code class="docutils literal notranslate"><span class="pre">100</span></code> for each panel.</li>
<li><code class="docutils literal notranslate"><span class="pre">form_class</span></code> - A <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> subclass that operates on a user or a profile</li>
<li><code class="docutils literal notranslate"><span class="pre">form_object</span></code> - Set to <code class="docutils literal notranslate"><span class="pre">user</span></code> to operate on the user, and <code class="docutils literal notranslate"><span class="pre">profile</span></code> to operate on the profile</li>
<li><code class="docutils literal notranslate"><span class="pre">tab</span></code> (optional) - Set which tab the panel appears on.</li>
<li><code class="docutils literal notranslate"><span class="pre">template_name</span></code> (optional) - Override the default template used for rendering the panel</li>
</ul>
</div>
<div class="section" id="operating-on-the-userprofile-model">
<h6>Operating on the <code class="docutils literal notranslate"><span class="pre">UserProfile</span></code> model<a class="headerlink" href="#operating-on-the-userprofile-model" title="Permalink to this headline">¶</a></h6>
<p>To add a panel that alters data on the user’s <code class="xref py py-class docutils literal notranslate"><span class="pre">UserProfile</span></code> instance, set <code class="docutils literal notranslate"><span class="pre">form_object</span></code> to <code class="docutils literal notranslate"><span class="pre">'profile'</span></code>:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># forms.py</span>

<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">wagtail.users.models</span> <span class="kn">import</span> <span class="n">UserProfile</span>

<span class="k">class</span> <span class="nc">CustomProfileSettingsForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">UserProfile</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># hooks.py</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.views.account</span> <span class="kn">import</span> <span class="n">BaseSettingsPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CustomProfileSettingsForm</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_account_settings_panel&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CustomSettingsPanel</span><span class="p">(</span><span class="n">BaseSettingsPanel</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;My custom settings&quot;</span>
    <span class="n">order</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">CustomProfileSettingsForm</span>
    <span class="n">form_object</span> <span class="o">=</span> <span class="s1">&#39;profile&#39;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="creating-new-tabs">
<h6>Creating new tabs<a class="headerlink" href="#creating-new-tabs" title="Permalink to this headline">¶</a></h6>
<p>You can define a new tab using the <code class="docutils literal notranslate"><span class="pre">SettingsTab</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># hooks.py</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.views.account</span> <span class="kn">import</span> <span class="n">BaseSettingsPanel</span><span class="p">,</span> <span class="n">SettingsTab</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CustomSettingsForm</span>

<span class="n">custom_tab</span> <span class="o">=</span> <span class="n">SettingsTab</span><span class="p">(</span><span class="s1">&#39;custom&#39;</span><span class="p">,</span> <span class="s2">&quot;Custom settings&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_account_settings_panel&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CustomSettingsPanel</span><span class="p">(</span><span class="n">BaseSettingsPanel</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;My custom settings&quot;</span>
    <span class="n">tab</span> <span class="o">=</span> <span class="n">custom_tab</span>
    <span class="n">order</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">CustomSettingsForm</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SettingsTab</span></code> takes three arguments:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> - A slug to use for the tab (this is placed after the <code class="docutils literal notranslate"><span class="pre">#</span></code> when linking to a tab)</li>
<li><code class="docutils literal notranslate"><span class="pre">title</span></code> - The display name of the title</li>
<li><code class="docutils literal notranslate"><span class="pre">order</span></code> - The order of the tab. The builtin Wagtail tabs start at <code class="docutils literal notranslate"><span class="pre">100</span></code> and increase by <code class="docutils literal notranslate"><span class="pre">100</span></code> for each tab</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="customising-the-template">
<h6>Customising the template<a class="headerlink" href="#customising-the-template" title="Permalink to this headline">¶</a></h6>
<p>You can provide a custom template for the panel by specifying a template name:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># hooks.py</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.views.account</span> <span class="kn">import</span> <span class="n">BaseSettingsPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CustomSettingsForm</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_account_settings_panel&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CustomSettingsPanel</span><span class="p">(</span><span class="n">BaseSettingsPanel</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;My custom settings&quot;</span>
    <span class="n">order</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">CustomSettingsForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;myapp/admin/custom_settings.html&#39;</span>
</pre></div>
</div>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="c">{# templates/myapp/admin/custom_settings.html #}</span>

<span class="c">{# This is the default template Wagtail uses, which just renders the form #}</span>

<span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fields&quot;</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="k">in</span> <span class="nv">form</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;wagtailadmin/shared/field_as_li.html&quot;</span> <span class="k">with</span> <span class="nv">field</span><span class="o">=</span><span class="nv">field</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-extending/customising_group_views"></span><div class="section" id="customising-group-edit-create-views">
<span id="customising-group-views"></span><h4>Customising group edit/create views<a class="headerlink" href="#customising-group-edit-create-views" title="Permalink to this headline">¶</a></h4>
<p>The views for managing groups within the app are collected into a ‘viewset’ class, which acts as a single point of reference for all shared components of those views, such as forms. By subclassing the viewset, it is possible to override those components and customise the behaviour of the group management interface.</p>
<div class="section" id="custom-edit-create-forms">
<h5>Custom edit/create forms<a class="headerlink" href="#custom-edit-create-forms" title="Permalink to this headline">¶</a></h5>
<p>This example shows how to customize forms on the ‘edit group’ and ‘create group’ views in the Wagtail
admin.</p>
<p>Let’s say you need to connect Active Directory groups with Django groups.
We create a model for Active Directory groups as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">Group</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">ADGroup</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">guid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;GUID&quot;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Domain&quot;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">roles</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Group</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Role&quot;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;adgroups&quot;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
      <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;AD group&quot;</span>
      <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;AD groups&quot;</span>
</pre></div>
</div>
<p>However, there is no role field on the Wagtail group ‘edit’ or ‘create’ view.
To add it, inherit from <code class="docutils literal notranslate"><span class="pre">wagtail.users.forms.GroupForm</span></code> and add a new field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>

<span class="kn">from</span> <span class="nn">wagtail.users.forms</span> <span class="kn">import</span> <span class="n">GroupForm</span> <span class="k">as</span> <span class="n">WagtailGroupForm</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">ADGroup</span>


<span class="k">class</span> <span class="nc">GroupForm</span><span class="p">(</span><span class="n">WagtailGroupForm</span><span class="p">):</span>
    <span class="n">adgroups</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;AD groups&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">ADGroup</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">WagtailGroupForm</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">WagtailGroupForm</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">fields</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;adgroups&quot;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">initial</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">initial</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">initial</span><span class="p">[</span><span class="s2">&quot;adgroups&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">adgroups</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">adgroups</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;adgroups&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">instance</span>
</pre></div>
</div>
<p>Now add your custom form into the group viewset by inheriting the default Wagtail
<code class="docutils literal notranslate"><span class="pre">GroupViewSet</span></code> class and overriding the <code class="docutils literal notranslate"><span class="pre">get_form_class</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.users.views.groups</span> <span class="kn">import</span> <span class="n">GroupViewSet</span> <span class="k">as</span> <span class="n">WagtailGroupViewSet</span>

<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">GroupForm</span>


<span class="k">class</span> <span class="nc">GroupViewSet</span><span class="p">(</span><span class="n">WagtailGroupViewSet</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_form_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GroupForm</span>
</pre></div>
</div>
<p>Add the field to the group ‘edit’/’create’ templates:</p>
<div class="highlight-html+Django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;wagtailusers/groups/edit.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailusers_tags</span> <span class="nv">wagtailadmin_tags</span> <span class="nv">i18n</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra_fields</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;wagtailadmin/shared/field_as_li.html&quot;</span> <span class="k">with</span> <span class="nv">field</span><span class="o">=</span><span class="nv">form.adgroups</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">extra_fields</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Finally we configure the <code class="docutils literal notranslate"><span class="pre">wagtail.users</span></code> application to use the custom viewset,
by setting up a custom <code class="docutils literal notranslate"><span class="pre">AppConfig</span></code> class. Within your project folder (i.e. the
package containing the top-level settings and urls modules), create <code class="docutils literal notranslate"><span class="pre">apps.py</span></code>
(if it does not exist already) and add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.users.apps</span> <span class="kn">import</span> <span class="n">WagtailUsersAppConfig</span>


<span class="k">class</span> <span class="nc">CustomUsersAppConfig</span><span class="p">(</span><span class="n">WagtailUsersAppConfig</span><span class="p">):</span>
    <span class="n">group_viewset</span> <span class="o">=</span> <span class="s2">&quot;myapplication.someapp.viewsets.GroupViewSet&quot;</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">wagtail.users</span></code> in <code class="docutils literal notranslate"><span class="pre">settings.INSTALLED_APPS</span></code> with the path to
<code class="docutils literal notranslate"><span class="pre">CustomUsersAppConfig</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="s2">&quot;myapplication.apps.CustomUsersAppConfig&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;wagtail.users&quot;,</span>
    <span class="o">...</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<span id="document-extending/rich_text_internals"></span><div class="section" id="rich-text-internals">
<h4>Rich text internals<a class="headerlink" href="#rich-text-internals" title="Permalink to this headline">¶</a></h4>
<p>At first glance, Wagtail’s rich text capabilities appear to give editors direct control over a block of HTML content. In reality, it’s necessary to give editors a representation of rich text content that is several steps removed from the final HTML output, for several reasons:</p>
<ul class="simple">
<li>The editor interface needs to filter out certain kinds of unwanted markup; this includes malicious scripting, font styles pasted from an external word processor, and elements which would break the validity or consistency of the site design (for example, pages will generally reserve the <code class="docutils literal notranslate"><span class="pre">&lt;h1&gt;</span></code> element for the page title, and so it would be inappropriate to allow users to insert their own additional <code class="docutils literal notranslate"><span class="pre">&lt;h1&gt;</span></code> elements through rich text).</li>
<li>Rich text fields can specify a <code class="docutils literal notranslate"><span class="pre">features</span></code> argument to further restrict the elements permitted in the field - see <a class="reference internal" href="index.html#rich-text-features"><span class="std std-ref">Limiting features in a rich text field</span></a>.</li>
<li>Enforcing a subset of HTML helps to keep presentational markup out of the database, making the site more maintainable, and making it easier to repurpose site content (including, potentially, producing non-HTML output such as <a class="reference external" href="https://www.latex-project.org/">LaTeX</a>).</li>
<li>Elements such as page links and images need to preserve metadata such as the page or image ID, which is not present in the final HTML representation.</li>
</ul>
<p>This requires the rich text content to go through a number of validation and conversion steps; both between the editor interface and the version stored in the database, and from the database representation to the final rendered HTML.</p>
<p>For this reason, extending Wagtail’s rich text handling to support a new element is more involved than simply saying (for example) “enable the <code class="docutils literal notranslate"><span class="pre">&lt;blockquote&gt;</span></code> element”, since various components of Wagtail - both client and server-side - need to agree on how to handle that feature, including how it should be exposed in the editor interface, how it should be represented within the database, and (if appropriate) how it should be translated when rendered on the front-end.</p>
<p>The components involved in Wagtail’s rich text handling are described below.</p>
<div class="section" id="data-format">
<h5>Data format<a class="headerlink" href="#data-format" title="Permalink to this headline">¶</a></h5>
<p>Rich text data (as handled by <a class="reference internal" href="index.html#rich-text"><span class="std std-ref">RichTextField</span></a>, and <code class="docutils literal notranslate"><span class="pre">RichTextBlock</span></code> within <a class="reference internal" href="index.html#document-topics/streamfield"><span class="doc">StreamField</span></a>) is stored in the database in a format that is similar, but not identical, to HTML. For example, a link to a page might be stored as:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">linktype</span><span class="o">=</span><span class="s">&quot;page&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;3&quot;</span><span class="p">&gt;</span>Contact us<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> for more information.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Here, the <code class="docutils literal notranslate"><span class="pre">linktype</span></code> attribute identifies a rule that shall be used to rewrite the tag. When rendered on a template through the <code class="docutils literal notranslate"><span class="pre">|richtext</span></code> filter (see <a class="reference internal" href="index.html#rich-text-filter"><span class="std std-ref">Rich text (filter)</span></a>), this is converted into valid HTML:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/contact-us/&quot;</span><span class="p">&gt;</span>Contact us<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> for more information.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>In the case of <code class="docutils literal notranslate"><span class="pre">RichTextBlock</span></code>, the block’s value is a <code class="docutils literal notranslate"><span class="pre">RichText</span></code> object which performs this conversion automatically when rendered as a string, so the <code class="docutils literal notranslate"><span class="pre">|richtext</span></code> filter is not necessary.</p>
<p>Likewise, an image inside rich text content might be stored as:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">embed</span> <span class="na">embedtype</span><span class="o">=</span><span class="s">&quot;image&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;10&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;A pied wagtail&quot;</span> <span class="na">format</span><span class="o">=</span><span class="s">&quot;left&quot;</span> <span class="p">/&gt;</span>
</pre></div>
</div>
<p>which is converted into an <code class="docutils literal notranslate"><span class="pre">img</span></code> element when rendered:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;A pied wagtail&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;richtext-image left&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;294&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/media/images/pied-wagtail.width-500_ENyKffb.jpg&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;500&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Again, the <code class="docutils literal notranslate"><span class="pre">embedtype</span></code> attribute identifies a rule that shall be used to rewrite the tag. All tags other than <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">linktype=&quot;...&quot;&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;embed</span> <span class="pre">embedtype=&quot;...&quot;</span> <span class="pre">/&gt;</span></code> are left unchanged in the converted HTML.</p>
<p>A number of additional constraints apply to <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">linktype=&quot;...&quot;&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;embed</span> <span class="pre">embedtype=&quot;...&quot;</span> <span class="pre">/&gt;</span></code> tags, to allow the conversion to be performed efficiently via string replacement:</p>
<ul class="simple">
<li>The tag name and attributes must be lower-case</li>
<li>Attribute values must be quoted with double-quotes</li>
<li><code class="docutils literal notranslate"><span class="pre">embed</span></code> elements must use XML self-closing tag syntax (i.e. end in <code class="docutils literal notranslate"><span class="pre">/&gt;</span></code> instead of a closing <code class="docutils literal notranslate"><span class="pre">&lt;/embed&gt;</span></code> tag)</li>
<li>The only HTML entities permitted in attribute values are <code class="docutils literal notranslate"><span class="pre">&amp;lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;amp;</span></code> and <code class="docutils literal notranslate"><span class="pre">&amp;quot;</span></code></li>
</ul>
</div>
<div class="section" id="the-feature-registry">
<h5>The feature registry<a class="headerlink" href="#the-feature-registry" title="Permalink to this headline">¶</a></h5>
<p>Any app within your project can define extensions to Wagtail’s rich text handling, such as new <code class="docutils literal notranslate"><span class="pre">linktype</span></code> and <code class="docutils literal notranslate"><span class="pre">embedtype</span></code> rules. An object known as the <em>feature registry</em> serves as a central source of truth about how rich text should behave. This object can be accessed through the <a class="reference internal" href="index.html#register-rich-text-features"><span class="std std-ref">register_rich_text_features</span></a> hook, which is called on startup to gather all definitions relating to rich text:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_app/wagtail_hooks.py</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_rich_text_features&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_my_feature</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="c1"># add new definitions to &#39;features&#39; here</span>
</pre></div>
</div>
</div>
<div class="section" id="rewrite-handlers">
<span id="rich-text-rewrite-handlers"></span><h5>Rewrite handlers<a class="headerlink" href="#rewrite-handlers" title="Permalink to this headline">¶</a></h5>
<p>Rewrite handlers are classes that know how to translate the content of rich text tags like <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">linktype=&quot;...&quot;&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;embed</span> <span class="pre">embedtype=&quot;...&quot;</span> <span class="pre">/&gt;</span></code> into front-end HTML. For example, the <code class="docutils literal notranslate"><span class="pre">PageLinkHandler</span></code> class knows how to convert the rich text tag <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">linktype=&quot;page&quot;</span> <span class="pre">id=&quot;123&quot;&gt;</span></code> into the HTML tag <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href=&quot;/path/to/page/123&quot;&gt;</span></code>.</p>
<p>Rewrite handlers can also provide other useful information about rich text tags. For example, given an appropriate tag, <code class="docutils literal notranslate"><span class="pre">PageLinkHandler</span></code> can be used to extract which page is being referred to. This can be useful for downstream code that may want information about objects being referenced in rich text.</p>
<p>You can create custom rewrite handlers to support your own new <code class="docutils literal notranslate"><span class="pre">linktype</span></code> and <code class="docutils literal notranslate"><span class="pre">embedtype</span></code> tags. New handlers must be Python classes that inherit from either <code class="docutils literal notranslate"><span class="pre">wagtail.core.richtext.LinkHandler</span></code> or <code class="docutils literal notranslate"><span class="pre">wagtail.core.richtext.EmbedHandler</span></code>. Your new classes should override at least some of the following methods (listed here for <code class="docutils literal notranslate"><span class="pre">LinkHandler</span></code>, although <code class="docutils literal notranslate"><span class="pre">EmbedHandler</span></code> has an identical signature):</p>
<dl class="class">
<dt id="LinkHandler">
<em class="property">class </em><code class="descname">LinkHandler</code><a class="headerlink" href="#LinkHandler" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="LinkHandler.identifier">
<code class="descname">identifier</code><a class="headerlink" href="#LinkHandler.identifier" title="Permalink to this definition">¶</a></dt>
<dd><p>Required. The <code class="docutils literal notranslate"><span class="pre">identifier</span></code> attribute is a string that indicates which rich text tags should be handled by this handler.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">PageLinkHandler.identifier</span></code> is set to the string <code class="docutils literal notranslate"><span class="pre">&quot;page&quot;</span></code>, indicating that any rich text tags with <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">linktype=&quot;page&quot;&gt;</span></code> should be handled by it.</p>
</dd></dl>

<dl class="method">
<dt id="LinkHandler.expand_db_attributes">
<code class="descname">expand_db_attributes</code><span class="sig-paren">(</span><em>attrs</em><span class="sig-paren">)</span><a class="headerlink" href="#LinkHandler.expand_db_attributes" title="Permalink to this definition">¶</a></dt>
<dd><p>Required. The <code class="docutils literal notranslate"><span class="pre">expand_db_attributes</span></code> method is expected to take a dictionary of attributes from a database rich text <code class="docutils literal notranslate"><span class="pre">&lt;a&gt;</span></code> tag (<code class="docutils literal notranslate"><span class="pre">&lt;embed&gt;</span></code> for <code class="docutils literal notranslate"><span class="pre">EmbedHandler</span></code>) and use it to generate valid frontend HTML.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">PageLinkHandler.expand_db_attributes</span></code> might receive <code class="docutils literal notranslate"><span class="pre">{'id':</span> <span class="pre">123}</span></code>, use it to retrieve the Wagtail page with ID 123, and render a link to its URL like <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href=&quot;/path/to/page/123&quot;&gt;</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="LinkHandler.get_model">
<code class="descname">get_model</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#LinkHandler.get_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Optional. The static <code class="docutils literal notranslate"><span class="pre">get_model</span></code> method only applies to those handlers that are used to render content related to Django models. This method allows handlers to expose the type of content that they know how to handle.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">PageLinkHandler.get_model</span></code> returns the Wagtail class <code class="docutils literal notranslate"><span class="pre">Page</span></code>.</p>
<p>Handlers that aren’t related to Django models can leave this method undefined, and calling it will raise <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="LinkHandler.get_instance">
<code class="descname">get_instance</code><span class="sig-paren">(</span><em>attrs</em><span class="sig-paren">)</span><a class="headerlink" href="#LinkHandler.get_instance" title="Permalink to this definition">¶</a></dt>
<dd><p>Optional. The static or classmethod <code class="docutils literal notranslate"><span class="pre">get_instance</span></code> method also only applies to those handlers that are used to render content related to Django models. This method is expected to take a dictionary of attributes from a database rich text <code class="docutils literal notranslate"><span class="pre">&lt;a&gt;</span></code> tag (<code class="docutils literal notranslate"><span class="pre">&lt;embed&gt;</span></code> for <code class="docutils literal notranslate"><span class="pre">EmbedHandler</span></code>) and use it to return the specific Django model instance being referred to.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">PageLinkHandler.get_instance</span></code> might receive <code class="docutils literal notranslate"><span class="pre">{'id':</span> <span class="pre">123}</span></code> and return the instance of the Wagtail <code class="docutils literal notranslate"><span class="pre">Page</span></code> class with ID 123.</p>
<p>If left undefined, a default implementation of this method will query the <code class="docutils literal notranslate"><span class="pre">id</span></code> model field on the class returned by <code class="docutils literal notranslate"><span class="pre">get_model</span></code> using the provided <code class="docutils literal notranslate"><span class="pre">id</span></code> attribute; this can be overridden in your own handlers should you want to use some other model field.</p>
</dd></dl>

</dd></dl>

<p>Below is an example custom rewrite handler that implements these methods to add support for rich text linking to user email addresses. It supports the conversion of rich text tags like <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">linktype=&quot;user&quot;</span> <span class="pre">username=&quot;wagtail&quot;&gt;</span></code> to valid HTML like <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href=&quot;mailto:hello&#64;wagtail.io&quot;&gt;</span></code>. This example assumes that equivalent front-end functionality has been added to allow users to insert these kinds of links into their rich text editor.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>
<span class="kn">from</span> <span class="nn">wagtail.core.rich_text</span> <span class="kn">import</span> <span class="n">LinkHandler</span>

<span class="k">class</span> <span class="nc">UserLinkHandler</span><span class="p">(</span><span class="n">LinkHandler</span><span class="p">):</span>
    <span class="n">identifier</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_model</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">get_user_model</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">expand_db_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;mailto:</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span>
</pre></div>
</div>
</div>
<div class="section" id="registering-rewrite-handlers">
<h5>Registering rewrite handlers<a class="headerlink" href="#registering-rewrite-handlers" title="Permalink to this headline">¶</a></h5>
<p>Rewrite handlers must also be registered with the feature registry via the <a class="reference internal" href="index.html#register-rich-text-features"><span class="std std-ref">register_rich_text_features</span></a> hook. Independent methods for registering both link handlers and embed handlers are provided.</p>
<dl class="method">
<dt id="FeatureRegistry.register_link_type">
<code class="descclassname">FeatureRegistry.</code><code class="descname">register_link_type</code><span class="sig-paren">(</span><em>handler</em><span class="sig-paren">)</span><a class="headerlink" href="#FeatureRegistry.register_link_type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This method allows you to register a custom handler deriving from <code class="docutils literal notranslate"><span class="pre">wagtail.core.rich_text.LinkHandler</span></code>, and adds it to the list of link handlers available during rich text conversion.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_app/wagtail_hooks.py</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">my_app.handlers</span> <span class="kn">import</span> <span class="n">MyCustomLinkHandler</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_rich_text_features&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_link_handler</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="n">features</span><span class="o">.</span><span class="n">register_link_type</span><span class="p">(</span><span class="n">MyCustomLinkHandler</span><span class="p">)</span>
</pre></div>
</div>
<p>It is also possible to define link rewrite handlers for Wagtail’s built-in <code class="docutils literal notranslate"><span class="pre">external</span></code> and <code class="docutils literal notranslate"><span class="pre">email</span></code> links, even though they do not have a predefined <code class="docutils literal notranslate"><span class="pre">linktype</span></code>. For example, if you want external links to have a <code class="docutils literal notranslate"><span class="pre">rel=&quot;nofollow&quot;</span></code> attribute for SEO purposes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">escape</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">wagtail.core.rich_text</span> <span class="kn">import</span> <span class="n">LinkHandler</span>

<span class="k">class</span> <span class="nc">NoFollowExternalLinkHandler</span><span class="p">(</span><span class="n">LinkHandler</span><span class="p">):</span>
    <span class="n">identifier</span> <span class="o">=</span> <span class="s1">&#39;external&#39;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">expand_db_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="n">href</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot; rel=&quot;nofollow&quot;&gt;&#39;</span> <span class="o">%</span> <span class="n">escape</span><span class="p">(</span><span class="n">href</span><span class="p">)</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_rich_text_features&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_external_link</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="n">features</span><span class="o">.</span><span class="n">register_link_type</span><span class="p">(</span><span class="n">NoFollowExternalLinkHandler</span><span class="p">)</span>
</pre></div>
</div>
<p>Similarly you can use <code class="docutils literal notranslate"><span class="pre">email</span></code> linktype to add a custom rewrite handler for email links (e.g. to obfuscate emails in rich text).</p>
<dl class="method">
<dt id="FeatureRegistry.register_embed_type">
<code class="descclassname">FeatureRegistry.</code><code class="descname">register_embed_type</code><span class="sig-paren">(</span><em>handler</em><span class="sig-paren">)</span><a class="headerlink" href="#FeatureRegistry.register_embed_type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This method allows you to register a custom handler deriving from <code class="docutils literal notranslate"><span class="pre">wagtail.core.rich_text.EmbedHandler</span></code>, and adds it to the list of embed handlers available during rich text conversion.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_app/wagtail_hooks.py</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">my_app.handlers</span> <span class="kn">import</span> <span class="n">MyCustomEmbedHandler</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_rich_text_features&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_embed_handler</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="n">features</span><span class="o">.</span><span class="n">register_embed_type</span><span class="p">(</span><span class="n">MyCustomEmbedHandler</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="editor-widgets">
<h5>Editor widgets<a class="headerlink" href="#editor-widgets" title="Permalink to this headline">¶</a></h5>
<p>The editor interface used on rich text fields can be configured with the <a class="reference internal" href="index.html#wagtailadmin-rich-text-editors"><span class="std std-ref">WAGTAILADMIN_RICH_TEXT_EDITORS</span></a> setting. Wagtail provides two editor implementations: <code class="docutils literal notranslate"><span class="pre">wagtail.admin.rich_text.DraftailRichTextArea</span></code> (the <a class="reference external" href="https://www.draftail.org/">Draftail</a> editor based on <a class="reference external" href="https://draftjs.org/">Draft.js</a>) and <code class="docutils literal notranslate"><span class="pre">wagtail.admin.rich_text.HalloRichTextArea</span></code> (deprecated, based on <a class="reference external" href="http://hallojs.org/">Hallo.js</a>).</p>
<p>It is possible to create your own rich text editor implementation. At minimum, a rich text editor is a Django <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/forms/widgets/#django.forms.Widget" title="(in Django v3.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Widget</span></code></a> subclass whose constructor accepts an <code class="docutils literal notranslate"><span class="pre">options</span></code> keyword argument (a dictionary of editor-specific configuration options sourced from the <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> field in <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_RICH_TEXT_EDITORS</span></code>), and which consumes and produces string data in the HTML-like format described above.</p>
<p>Typically, a rich text widget also receives a <code class="docutils literal notranslate"><span class="pre">features</span></code> list, passed from either <code class="docutils literal notranslate"><span class="pre">RichTextField</span></code> / <code class="docutils literal notranslate"><span class="pre">RichTextBlock</span></code> or the <code class="docutils literal notranslate"><span class="pre">features</span></code> option in <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_RICH_TEXT_EDITORS</span></code>, which defines the features available in that instance of the editor (see <a class="reference internal" href="index.html#rich-text-features"><span class="std std-ref">Limiting features in a rich text field</span></a>). To opt in to supporting features, set the attribute <code class="docutils literal notranslate"><span class="pre">accepts_features</span> <span class="pre">=</span> <span class="pre">True</span></code> on your widget class; the widget constructor will then receive the feature list as a keyword argument <code class="docutils literal notranslate"><span class="pre">features</span></code>.</p>
<p>There is a standard set of recognised feature identifiers as listed under <a class="reference internal" href="index.html#rich-text-features"><span class="std std-ref">Limiting features in a rich text field</span></a>, but this is not a definitive list; feature identifiers are only defined by convention, and it is up to each editor widget to determine which features it will recognise, and adapt its behaviour accordingly. Individual editor widgets might implement fewer or more features than the default set, either as built-in functionality or through a plugin mechanism if the editor widget has one.</p>
<p>For example, a third-party Wagtail extension might introduce <code class="docutils literal notranslate"><span class="pre">table</span></code> as a new rich text feature, and provide implementations for the Draftail and Hallo editors (which both provide a plugin mechanism). In this case, the third-party extension will not be aware of your custom editor widget, and so the widget will not know how to handle the <code class="docutils literal notranslate"><span class="pre">table</span></code> feature identifier. Editor widgets should silently ignore any feature identifiers that they do not recognise.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">default_features</span></code> attribute of the feature registry is a list of feature identifiers to be used whenever an explicit feature list has not been given in <code class="docutils literal notranslate"><span class="pre">RichTextField</span></code> / <code class="docutils literal notranslate"><span class="pre">RichTextBlock</span></code> or <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_RICH_TEXT_EDITORS</span></code>. This list can be modified within the <code class="docutils literal notranslate"><span class="pre">register_rich_text_features</span></code> hook to make new features enabled by default, and retrieved by calling <code class="docutils literal notranslate"><span class="pre">get_default_features()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_rich_text_features&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">make_h1_default</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="n">features</span><span class="o">.</span><span class="n">default_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Outside of the <code class="docutils literal notranslate"><span class="pre">register_rich_text_features</span></code> hook - for example, inside a widget class - the feature registry can be imported as the object <code class="docutils literal notranslate"><span class="pre">wagtail.core.rich_text.features</span></code>. A possible starting point for a rich text editor with feature support would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">widgets</span>
<span class="kn">from</span> <span class="nn">wagtail.core.rich_text</span> <span class="kn">import</span> <span class="n">features</span>

<span class="k">class</span> <span class="nc">CustomRichTextArea</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">TextArea</span><span class="p">):</span>
    <span class="n">accepts_features</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">get_default_features</span><span class="p">()</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="editor-plugins">
<h5>Editor plugins<a class="headerlink" href="#editor-plugins" title="Permalink to this headline">¶</a></h5>
<dl class="method">
<dt id="FeatureRegistry.register_editor_plugin">
<code class="descclassname">FeatureRegistry.</code><code class="descname">register_editor_plugin</code><span class="sig-paren">(</span><em>editor_name</em>, <em>feature_name</em>, <em>plugin_definition</em><span class="sig-paren">)</span><a class="headerlink" href="#FeatureRegistry.register_editor_plugin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Rich text editors often provide a plugin mechanism to allow extending the editor with new functionality. The <code class="docutils literal notranslate"><span class="pre">register_editor_plugin</span></code> method provides a standardised way for <code class="docutils literal notranslate"><span class="pre">register_rich_text_features</span></code> hooks to define plugins to be pulled in to the editor when a given rich text feature is enabled.</p>
<p><code class="docutils literal notranslate"><span class="pre">register_editor_plugin</span></code> is passed an editor name (a string uniquely identifying the editor widget - Wagtail uses the identifiers <code class="docutils literal notranslate"><span class="pre">draftail</span></code> and <code class="docutils literal notranslate"><span class="pre">hallo</span></code> for its built-in editors), a feature identifier, and a plugin definition object. This object is specific to the editor widget and can be any arbitrary value, but will typically include a <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/forms/media/" title="(in Django v3.2)"><span class="xref std std-doc">Django form media</span></a> definition referencing the plugin’s JavaScript code - which will then be merged into the editor widget’s own media definition - along with any relevant configuration options to be passed when instantiating the editor.</p>
<dl class="method">
<dt id="FeatureRegistry.get_editor_plugin">
<code class="descclassname">FeatureRegistry.</code><code class="descname">get_editor_plugin</code><span class="sig-paren">(</span><em>editor_name</em>, <em>feature_name</em><span class="sig-paren">)</span><a class="headerlink" href="#FeatureRegistry.get_editor_plugin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Within the editor widget, the plugin definition for a given feature can be retrieved via the <code class="docutils literal notranslate"><span class="pre">get_editor_plugin</span></code> method, passing the editor’s own identifier string and the feature identifier. This will return <code class="docutils literal notranslate"><span class="pre">None</span></code> if no matching plugin has been registered.</p>
<p>For details of the plugin formats for Wagtail’s built-in editors, see <a class="reference internal" href="index.html#document-extending/extending_draftail"><span class="doc">Extending the Draftail Editor</span></a> and <a class="reference internal" href="index.html#document-extending/extending_hallo"><span class="doc">Extending the Hallo Editor</span></a>.</p>
</div>
<div class="section" id="format-converters">
<span id="rich-text-format-converters"></span><h5>Format converters<a class="headerlink" href="#format-converters" title="Permalink to this headline">¶</a></h5>
<p>Editor widgets will often be unable to work directly with Wagtail’s rich text format, and require conversion to their own native format. For Draftail, this is a JSON-based format known as ContentState (see <a class="reference external" href="https://medium.com/&#64;rajaraodv/how-draft-js-represents-rich-text-data-eeabb5f25cf2">How Draft.js Represents Rich Text Data</a>). Hallo.js and other editors based on HTML’s <code class="docutils literal notranslate"><span class="pre">contentEditable</span></code> mechanism require valid HTML, and so Wagtail uses a convention referred to as “editor HTML”, where the additional data required on link and embed elements is stored in <code class="docutils literal notranslate"><span class="pre">data-</span></code> attributes, for example: <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href=&quot;/contact-us/&quot;</span> <span class="pre">data-linktype=&quot;page&quot;</span> <span class="pre">data-id=&quot;3&quot;&gt;Contact</span> <span class="pre">us&lt;/a&gt;</span></code>.</p>
<p>Wagtail provides two utility classes, <code class="docutils literal notranslate"><span class="pre">wagtail.admin.rich_text.converters.contentstate.ContentstateConverter</span></code> and <code class="docutils literal notranslate"><span class="pre">wagtail.admin.rich_text.converters.editor_html.EditorHTMLConverter</span></code>, to perform conversions between rich text format and the native editor formats. These classes are independent of any editor widget, and distinct from the rewriting process that happens when rendering rich text onto a template.</p>
<p>Both classes accept a <code class="docutils literal notranslate"><span class="pre">features</span></code> list as an argument to their constructor, and implement two methods, <code class="docutils literal notranslate"><span class="pre">from_database_format(data)</span></code> which converts Wagtail rich text data to the editor’s format, and <code class="docutils literal notranslate"><span class="pre">to_database_format(data)</span></code> which converts editor data to Wagtail rich text format.</p>
<p>As with editor plugins, the behaviour of a converter class can vary according to the feature list passed to it. In particular, it can apply whitelisting rules to ensure that the output only contains HTML elements corresponding to the currently active feature set. The feature registry provides a <code class="docutils literal notranslate"><span class="pre">register_converter_rule</span></code> method to allow <code class="docutils literal notranslate"><span class="pre">register_rich_text_features</span></code> hooks to define conversion rules that will be activated when a given feature is enabled.</p>
<dl class="method">
<dt id="FeatureRegistry.register_converter_rule">
<code class="descclassname">FeatureRegistry.</code><code class="descname">register_converter_rule</code><span class="sig-paren">(</span><em>converter_name</em>, <em>feature_name</em>, <em>rule_definition</em><span class="sig-paren">)</span><a class="headerlink" href="#FeatureRegistry.register_converter_rule" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">register_editor_plugin</span></code> is passed a converter name (a string uniquely identifying the converter class - Wagtail uses the identifiers <code class="docutils literal notranslate"><span class="pre">contentstate</span></code> and <code class="docutils literal notranslate"><span class="pre">editorhtml</span></code>), a feature identifier, and a rule definition object. This object is specific to the converter and can be any arbitrary value.</p>
<p>For details of the rule definition format for the <code class="docutils literal notranslate"><span class="pre">contentstate</span></code> and <code class="docutils literal notranslate"><span class="pre">editorhtml</span></code> converters, see <a class="reference internal" href="index.html#document-extending/extending_draftail"><span class="doc">Extending the Draftail Editor</span></a> and <a class="reference internal" href="index.html#document-extending/extending_hallo"><span class="doc">Extending the Hallo Editor</span></a> respectively.</p>
<dl class="method">
<dt id="FeatureRegistry.get_converter_rule">
<code class="descclassname">FeatureRegistry.</code><code class="descname">get_converter_rule</code><span class="sig-paren">(</span><em>converter_name</em>, <em>feature_name</em><span class="sig-paren">)</span><a class="headerlink" href="#FeatureRegistry.get_converter_rule" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Within a converter class, the rule definition for a given feature can be retrieved via the <code class="docutils literal notranslate"><span class="pre">get_converter_rule</span></code> method, passing the converter’s own identifier string and the feature identifier. This will return <code class="docutils literal notranslate"><span class="pre">None</span></code> if no matching rule has been registered.</p>
</div>
</div>
<span id="document-extending/extending_draftail"></span><div class="section" id="extending-the-draftail-editor">
<h4>Extending the Draftail Editor<a class="headerlink" href="#extending-the-draftail-editor" title="Permalink to this headline">¶</a></h4>
<p>Wagtail’s rich text editor is built with <a class="reference external" href="https://www.draftail.org/">Draftail</a>, and its functionality can be extended through plugins.</p>
<p>Plugins come in three types:</p>
<ul class="simple">
<li>Inline styles – To format a portion of a line, eg. <code class="docutils literal notranslate"><span class="pre">bold</span></code>, <code class="docutils literal notranslate"><span class="pre">italic</span></code>, <code class="docutils literal notranslate"><span class="pre">monospace</span></code>.</li>
<li>Blocks – To indicate the structure of the content, eg. <code class="docutils literal notranslate"><span class="pre">blockquote</span></code>, <code class="docutils literal notranslate"><span class="pre">ol</span></code>.</li>
<li>Entities – To enter additional data/metadata, eg. <code class="docutils literal notranslate"><span class="pre">link</span></code> (with a URL), <code class="docutils literal notranslate"><span class="pre">image</span></code> (with a file).</li>
</ul>
<p>All of these plugins are created with a similar baseline, which we can demonstrate with one of the simplest examples – a custom feature for an inline style of <code class="docutils literal notranslate"><span class="pre">mark</span></code>. Place the following in a <code class="docutils literal notranslate"><span class="pre">wagtail_hooks.py</span></code> file in any installed app:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">wagtail.admin.rich_text.editors.draftail.features</span> <span class="k">as</span> <span class="nn">draftail_features</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.rich_text.converters.html_to_contentstate</span> <span class="kn">import</span> <span class="n">InlineStyleElementHandler</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="c1"># 1. Use the register_rich_text_features hook.</span>
<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_rich_text_features&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_mark_feature</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registering the `mark` feature, which uses the `MARK` Draft.js inline style type,</span>
<span class="sd">    and is stored as HTML with a `&lt;mark&gt;` tag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feature_name</span> <span class="o">=</span> <span class="s1">&#39;mark&#39;</span>
    <span class="n">type_</span> <span class="o">=</span> <span class="s1">&#39;MARK&#39;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;mark&#39;</span>

    <span class="c1"># 2. Configure how Draftail handles the feature in its toolbar.</span>
    <span class="n">control</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">type_</span><span class="p">,</span>
        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;☆&#39;</span><span class="p">,</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span>
        <span class="c1"># This isn’t even required – Draftail has predefined styles for MARK.</span>
        <span class="c1"># &#39;style&#39;: {&#39;textDecoration&#39;: &#39;line-through&#39;},</span>
    <span class="p">}</span>

    <span class="c1"># 3. Call register_editor_plugin to register the configuration for Draftail.</span>
    <span class="n">features</span><span class="o">.</span><span class="n">register_editor_plugin</span><span class="p">(</span>
        <span class="s1">&#39;draftail&#39;</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">draftail_features</span><span class="o">.</span><span class="n">InlineStyleFeature</span><span class="p">(</span><span class="n">control</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># 4.configure the content transform from the DB to the editor and back.</span>
    <span class="n">db_conversion</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;from_database_format&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">tag</span><span class="p">:</span> <span class="n">InlineStyleElementHandler</span><span class="p">(</span><span class="n">type_</span><span class="p">)},</span>
        <span class="s1">&#39;to_database_format&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;style_map&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">type_</span><span class="p">:</span> <span class="n">tag</span><span class="p">}},</span>
    <span class="p">}</span>

    <span class="c1"># 5. Call register_converter_rule to register the content transformation conversion.</span>
    <span class="n">features</span><span class="o">.</span><span class="n">register_converter_rule</span><span class="p">(</span><span class="s1">&#39;contentstate&#39;</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">db_conversion</span><span class="p">)</span>

    <span class="c1"># 6. (optional) Add the feature to the default features list to make it available</span>
    <span class="c1"># on rich text fields that do not specify an explicit &#39;features&#39; list</span>
    <span class="n">features</span><span class="o">.</span><span class="n">default_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;mark&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>These steps will always be the same for all Draftail plugins. The important parts are to:</p>
<ul class="simple">
<li>Consistently use the feature’s Draft.js type or Wagtail feature names where appropriate.</li>
<li>Give enough information to Draftail so it knows how to make a button for the feature, and how to render it (more on this later).</li>
<li>Configure the conversion to use the right HTML element (as they are stored in the DB).</li>
</ul>
<p>For detailed configuration options, head over to the <a class="reference external" href="https://www.draftail.org/docs/formatting-options">Draftail documentation</a> to see all of the details. Here are some parts worth highlighting about controls:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">type</span></code> is the only mandatory piece of information.</li>
<li>To display the control in the toolbar, combine <code class="docutils literal notranslate"><span class="pre">icon</span></code>, <code class="docutils literal notranslate"><span class="pre">label</span></code> and <code class="docutils literal notranslate"><span class="pre">description</span></code>.</li>
<li>The controls’ <code class="docutils literal notranslate"><span class="pre">icon</span></code> can be a string to use an icon font with CSS classes, say <code class="docutils literal notranslate"><span class="pre">'icon':</span> <span class="pre">'fas</span> <span class="pre">fa-user',</span></code>. It can also be an array of strings, to use SVG paths, or SVG symbol references eg. <code class="docutils literal notranslate"><span class="pre">'icon':</span> <span class="pre">['M100</span> <span class="pre">100</span> <span class="pre">H</span> <span class="pre">900</span> <span class="pre">V</span> <span class="pre">900</span> <span class="pre">H</span> <span class="pre">100</span> <span class="pre">Z'],</span></code>. The paths need to be set for a 1024x1024 viewbox.</li>
</ul>
<div class="section" id="creating-new-inline-styles">
<h5>Creating new inline styles<a class="headerlink" href="#creating-new-inline-styles" title="Permalink to this headline">¶</a></h5>
<p>In addition to the initial example, inline styles take a <code class="docutils literal notranslate"><span class="pre">style</span></code> property to define what CSS rules will be applied to text in the editor. Be sure to read the <a class="reference external" href="https://www.draftail.org/docs/formatting-options">Draftail documentation</a> on inline styles.</p>
<p>Finally, the DB to/from conversion uses an <code class="docutils literal notranslate"><span class="pre">InlineStyleElementHandler</span></code> to map from a given tag (<code class="docutils literal notranslate"><span class="pre">&lt;mark&gt;</span></code> in the example above) to a Draftail type, and the inverse mapping is done with <a class="reference external" href="https://github.com/springload/draftjs_exporter">Draft.js exporter configuration</a> of the <code class="docutils literal notranslate"><span class="pre">style_map</span></code>.</p>
</div>
<div class="section" id="creating-new-blocks">
<h5>Creating new blocks<a class="headerlink" href="#creating-new-blocks" title="Permalink to this headline">¶</a></h5>
<p>Blocks are nearly as simple as inline styles:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin.rich_text.converters.html_to_contentstate</span> <span class="kn">import</span> <span class="n">BlockElementHandler</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_rich_text_features&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_help_text_feature</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registering the `help-text` feature, which uses the `help-text` Draft.js block type,</span>
<span class="sd">    and is stored as HTML with a `&lt;div class=&quot;help-text&quot;&gt;` tag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feature_name</span> <span class="o">=</span> <span class="s1">&#39;help-text&#39;</span>
    <span class="n">type_</span> <span class="o">=</span> <span class="s1">&#39;help-text&#39;</span>

    <span class="n">control</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">type_</span><span class="p">,</span>
        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Help text&#39;</span><span class="p">,</span>
        <span class="c1"># Optionally, we can tell Draftail what element to use when displaying those blocks in the editor.</span>
        <span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">features</span><span class="o">.</span><span class="n">register_editor_plugin</span><span class="p">(</span>
        <span class="s1">&#39;draftail&#39;</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">draftail_features</span><span class="o">.</span><span class="n">BlockFeature</span><span class="p">(</span><span class="n">control</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;help-text.css&#39;</span><span class="p">]})</span>
    <span class="p">)</span>

    <span class="n">features</span><span class="o">.</span><span class="n">register_converter_rule</span><span class="p">(</span><span class="s1">&#39;contentstate&#39;</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;from_database_format&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;div[class=help-text]&#39;</span><span class="p">:</span> <span class="n">BlockElementHandler</span><span class="p">(</span><span class="n">type_</span><span class="p">)},</span>
        <span class="s1">&#39;to_database_format&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;block_map&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">type_</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;help-text&#39;</span><span class="p">}}}},</span>
    <span class="p">})</span>
</pre></div>
</div>
<p>Here are the main differences:</p>
<ul class="simple">
<li>We can configure an <code class="docutils literal notranslate"><span class="pre">element</span></code> to tell Draftail how to render those blocks in the editor.</li>
<li>We register the plugin with <code class="docutils literal notranslate"><span class="pre">BlockFeature</span></code>.</li>
<li>We set up the conversion with <code class="docutils literal notranslate"><span class="pre">BlockElementHandler</span></code> and <code class="docutils literal notranslate"><span class="pre">block_map</span></code>.</li>
</ul>
<p>Optionally, we can also define styles for the blocks with the <code class="docutils literal notranslate"><span class="pre">Draftail-block--help-text</span></code> (<code class="docutils literal notranslate"><span class="pre">Draftail-block--&lt;block</span> <span class="pre">type&gt;</span></code>) CSS class.</p>
<p>That’s it! The extra complexity is that you may need to write CSS to style the blocks in the editor.</p>
</div>
<div class="section" id="creating-new-entities">
<h5>Creating new entities<a class="headerlink" href="#creating-new-entities" title="Permalink to this headline">¶</a></h5>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is an advanced feature. Please carefully consider whether you really need this.</p>
</div>
<p>Entities aren’t simply formatting buttons in the toolbar. They usually need to be much more versatile, communicating to APIs or requesting further user input. As such,</p>
<ul class="simple">
<li>You will most likely need to write a <strong>hefty dose of JavaScript</strong>, some of it with React.</li>
<li>The API is very <strong>low-level</strong>. You will most likely need some <strong>Draft.js knowledge</strong>.</li>
<li>Custom UIs in rich text can be brittle. Be ready to spend time <strong>testing in multiple browsers</strong>.</li>
</ul>
<p>The good news is that having such a low-level API will enable third-party Wagtail plugins to innovate on rich text features, proposing new kinds of experiences.
But in the meantime, consider implementing your UI through <a class="reference internal" href="index.html#document-topics/streamfield"><span class="doc">StreamField</span></a> instead, which has a battle-tested API meant for Django developers.</p>
<hr class="docutils" />
<p>Here are the main requirements to create a new entity feature:</p>
<ul class="simple">
<li>Like for inline styles and blocks, register an editor plugin.</li>
<li>The editor plugin must define a <code class="docutils literal notranslate"><span class="pre">source</span></code>: a React component responsible for creating new entity instances in the editor, using the Draft.js API.</li>
<li>The editor plugin also needs a <code class="docutils literal notranslate"><span class="pre">decorator</span></code> (for inline entities) or <code class="docutils literal notranslate"><span class="pre">block</span></code> (for block entities): a React component responsible for displaying entity instances within the editor.</li>
<li>Like for inline styles and blocks, set up the to/from DB conversion.</li>
<li>The conversion usually is more involved, since entities contain data that needs to be serialised to HTML.</li>
</ul>
<p>To write the React components, Wagtail exposes its own React, Draft.js and Draftail dependencies as global variables. Read more about this in <a class="reference internal" href="index.html#extending-clientside-components"><span class="std std-ref">Extending client-side components</span></a>.
To go further, please look at the <a class="reference external" href="https://www.draftail.org/docs/formatting-options">Draftail documentation</a> as well as the <a class="reference external" href="https://github.com/springload/draftjs_exporter">Draft.js exporter documentation</a>.</p>
<p>Here is a detailed example to showcase how those tools are used in the context of Wagtail.
For the sake of our example, we can imagine a news team working at a financial newspaper.
They want to write articles about the stock market, refer to specific stocks anywhere inside of their content (eg. “$TSLA” tokens in a sentence), and then have their article automatically enriched with the stock’s information (a link, a number, a sparkline).</p>
<p>The editor toolbar could contain a “stock chooser” that displays a list of available stocks, then inserts the user’s selection as a textual token. For our example, we will just pick a stock at random:</p>
<img alt="_images/draftail_entity_stock_source.gif" src="_images/draftail_entity_stock_source.gif" />
<p>Those tokens are then saved in the rich text on publish. When the news article is displayed on the site, we then insert live market data coming from an API next to each token:</p>
<img alt="_images/draftail_entity_stock_rendering.png" src="_images/draftail_entity_stock_rendering.png" />
<p>In order to achieve this, we start with registering the rich text feature like for inline styles and blocks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_rich_text_features&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_stock_feature</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="n">features</span><span class="o">.</span><span class="n">default_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;stock&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registering the `stock` feature, which uses the `STOCK` Draft.js entity type,</span>
<span class="sd">    and is stored as HTML with a `&lt;span data-stock&gt;` tag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feature_name</span> <span class="o">=</span> <span class="s1">&#39;stock&#39;</span>
    <span class="n">type_</span> <span class="o">=</span> <span class="s1">&#39;STOCK&#39;</span>

    <span class="n">control</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">type_</span><span class="p">,</span>
        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Stock&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">features</span><span class="o">.</span><span class="n">register_editor_plugin</span><span class="p">(</span>
        <span class="s1">&#39;draftail&#39;</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">draftail_features</span><span class="o">.</span><span class="n">EntityFeature</span><span class="p">(</span>
            <span class="n">control</span><span class="p">,</span>
            <span class="n">js</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stock.js&#39;</span><span class="p">],</span>
            <span class="n">css</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;stock.css&#39;</span><span class="p">]}</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">features</span><span class="o">.</span><span class="n">register_converter_rule</span><span class="p">(</span><span class="s1">&#39;contentstate&#39;</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="p">{</span>
        <span class="c1"># Note here that the conversion is more complicated than for blocks and inline styles.</span>
        <span class="s1">&#39;from_database_format&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;span[data-stock]&#39;</span><span class="p">:</span> <span class="n">StockEntityElementHandler</span><span class="p">(</span><span class="n">type_</span><span class="p">)},</span>
        <span class="s1">&#39;to_database_format&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;entity_decorators&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">type_</span><span class="p">:</span> <span class="n">stock_entity_decorator</span><span class="p">}},</span>
    <span class="p">})</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">js</span></code> and <code class="docutils literal notranslate"><span class="pre">css</span></code> keyword arguments on <code class="docutils literal notranslate"><span class="pre">EntityFeature</span></code> can be used to specify additional
JS and CSS files to load when this feature is active. Both are optional. Their values are added to a <code class="docutils literal notranslate"><span class="pre">Media</span></code> object, more documentation on these objects
is available in the <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/forms/media/" title="(in Django v3.2)"><span class="xref std std-doc">Django Form Assets documentation</span></a>.</p>
<p>Since entities hold data, the conversion to/from database format is more complicated. We have to create the two handlers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">draftjs_exporter.dom</span> <span class="kn">import</span> <span class="n">DOM</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.rich_text.converters.html_to_contentstate</span> <span class="kn">import</span> <span class="n">InlineEntityElementHandler</span>

<span class="k">def</span> <span class="nf">stock_entity_decorator</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draft.js ContentState to database HTML.</span>
<span class="sd">    Converts the STOCK entities into a span tag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">DOM</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;data-stock&#39;</span><span class="p">:</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;stock&#39;</span><span class="p">],</span>
    <span class="p">},</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;children&#39;</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">StockEntityElementHandler</span><span class="p">(</span><span class="n">InlineEntityElementHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Database HTML to Draft.js ContentState.</span>
<span class="sd">    Converts the span tag into a STOCK entity, with the right data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mutability</span> <span class="o">=</span> <span class="s1">&#39;IMMUTABLE&#39;</span>

    <span class="k">def</span> <span class="nf">get_attribute_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take the ``stock`` value from the ``data-stock`` HTML attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;stock&#39;</span><span class="p">:</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;data-stock&#39;</span><span class="p">],</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Note how they both do similar conversions, but use different APIs. <code class="docutils literal notranslate"><span class="pre">to_database_format</span></code> is built with the <a class="reference external" href="https://github.com/springload/draftjs_exporter">Draft.js exporter</a> components API, whereas <code class="docutils literal notranslate"><span class="pre">from_database_format</span></code> uses a Wagtail API.</p>
<p>The next step is to add JavaScript to define how the entities are created (the <code class="docutils literal notranslate"><span class="pre">source</span></code>), and how they are displayed (the <code class="docutils literal notranslate"><span class="pre">decorator</span></code>). Within <code class="docutils literal notranslate"><span class="pre">stock.js</span></code>, we define the source component:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">React</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">React</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">Modifier</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">DraftJS</span><span class="p">.</span><span class="nx">Modifier</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">EditorState</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">DraftJS</span><span class="p">.</span><span class="nx">EditorState</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">DEMO_STOCKS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AMD&#39;</span><span class="p">,</span> <span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;TWTR&#39;</span><span class="p">,</span> <span class="s1">&#39;TSLA&#39;</span><span class="p">,</span> <span class="s1">&#39;BTC&#39;</span><span class="p">];</span>

<span class="c1">// Not a real React component – just creates the entities as soon as it is rendered.</span>
<span class="kd">class</span> <span class="nx">StockSource</span> <span class="k">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="p">{</span> <span class="nx">editorState</span><span class="p">,</span> <span class="nx">entityType</span><span class="p">,</span> <span class="nx">onComplete</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">;</span>

        <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">editorState</span><span class="p">.</span><span class="nx">getCurrentContent</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">selection</span> <span class="o">=</span> <span class="nx">editorState</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">();</span>

        <span class="kd">const</span> <span class="nx">randomStock</span> <span class="o">=</span> <span class="nx">DEMO_STOCKS</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">DEMO_STOCKS</span><span class="p">.</span><span class="nx">length</span><span class="p">)];</span>

        <span class="c1">// Uses the Draft.js API to create a new entity with the right data.</span>
        <span class="kd">const</span> <span class="nx">contentWithEntity</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">createEntity</span><span class="p">(</span><span class="nx">entityType</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="s1">&#39;IMMUTABLE&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">stock</span><span class="o">:</span> <span class="nx">randomStock</span><span class="p">,</span>
        <span class="p">});</span>
        <span class="kd">const</span> <span class="nx">entityKey</span> <span class="o">=</span> <span class="nx">contentWithEntity</span><span class="p">.</span><span class="nx">getLastCreatedEntityKey</span><span class="p">();</span>

        <span class="c1">// We also add some text for the entity to be activated on.</span>
        <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="sb">`$</span><span class="si">${</span><span class="nx">randomStock</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

        <span class="kd">const</span> <span class="nx">newContent</span> <span class="o">=</span> <span class="nx">Modifier</span><span class="p">.</span><span class="nx">replaceText</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">selection</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">entityKey</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">nextState</span> <span class="o">=</span> <span class="nx">EditorState</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">editorState</span><span class="p">,</span> <span class="nx">newContent</span><span class="p">,</span> <span class="s1">&#39;insert-characters&#39;</span><span class="p">);</span>

        <span class="nx">onComplete</span><span class="p">(</span><span class="nx">nextState</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This source component uses data and callbacks provided by <a class="reference external" href="https://www.draftail.org/docs/api">Draftail</a>.
It also uses dependencies from global variables – see <a class="reference internal" href="index.html#extending-clientside-components"><span class="std std-ref">Extending client-side components</span></a>.</p>
<p>We then create the decorator component:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">Stock</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">entityKey</span><span class="p">,</span> <span class="nx">contentState</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">props</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">contentState</span><span class="p">.</span><span class="nx">getEntity</span><span class="p">(</span><span class="nx">entityKey</span><span class="p">).</span><span class="nx">getData</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">role</span><span class="o">:</span> <span class="s1">&#39;button&#39;</span><span class="p">,</span>
        <span class="nx">onMouseUp</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="sb">`https://finance.yahoo.com/quote/</span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">stock</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">},</span> <span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This is a straightforward React component. It does not use JSX since we do not want to have to use a build step for our JavaScript. It uses ES6 syntax – this would not work in IE11 unless it was converted back to ES5 with a build step.</p>
<p>Finally, we register the JS components of our plugin:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">draftail</span><span class="p">.</span><span class="nx">registerPlugin</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;STOCK&#39;</span><span class="p">,</span>
    <span class="nx">source</span><span class="o">:</span> <span class="nx">StockSource</span><span class="p">,</span>
    <span class="nx">decorator</span><span class="o">:</span> <span class="nx">Stock</span><span class="p">,</span>
<span class="p">});</span>
</pre></div>
</div>
<p>And that’s it! All of this setup will finally produce the following HTML on the site’s front-end:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    Anyone following Elon Musk’s <span class="p">&lt;</span><span class="nt">span</span> <span class="na">data-stock</span><span class="o">=</span><span class="s">&quot;TSLA&quot;</span><span class="p">&gt;</span>$TSLA<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> should also look into <span class="p">&lt;</span><span class="nt">span</span> <span class="na">data-stock</span><span class="o">=</span><span class="s">&quot;BTC&quot;</span><span class="p">&gt;</span>$BTC<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>To fully complete the demo, we can add a bit of JavaScript to the front-end in order to decorate those tokens with links and a little sparkline.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;[data-stock]&#39;</span><span class="p">)).</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">elt</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
    <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="sb">`https://finance.yahoo.com/quote/</span><span class="si">${</span><span class="nx">elt</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">stock</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
    <span class="nx">link</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">elt</span><span class="p">.</span><span class="nx">innerHTML</span><span class="si">}</span><span class="sb">&lt;svg width=&quot;50&quot; height=&quot;20&quot; stroke-width=&quot;2&quot; stroke=&quot;blue&quot; fill=&quot;rgba(0, 0, 255, .2)&quot;&gt;&lt;path d=&quot;M4 14.19 L 4 14.19 L 13.2 14.21 L 22.4 13.77 L 31.59 13.99 L 40.8 13.46 L 50 11.68 L 59.19 11.35 L 68.39 10.68 L 77.6 7.11 L 86.8 7.85 L 96 4&quot; fill=&quot;none&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M4 14.19 L 4 14.19 L 13.2 14.21 L 22.4 13.77 L 31.59 13.99 L 40.8 13.46 L 50 11.68 L 59.19 11.35 L 68.39 10.68 L 77.6 7.11 L 86.8 7.85 L 96 4 V 20 L 4 20 Z&quot; stroke=&quot;none&quot;&gt;&lt;/path&gt;&lt;/svg&gt;`</span><span class="p">;</span>

    <span class="nx">elt</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">elt</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<hr class="docutils" />
<p>Custom block entities can also be created (have a look at the separate <a class="reference external" href="https://www.draftail.org/docs/blocks">Draftail documentation</a>), but these are not detailed here since <a class="reference internal" href="index.html#streamfield"><span class="std std-ref">StreamField</span></a> is the go-to way to create block-level rich text in Wagtail.</p>
</div>
<div class="section" id="integration-of-the-draftail-widgets">
<h5>Integration of the Draftail widgets<a class="headerlink" href="#integration-of-the-draftail-widgets" title="Permalink to this headline">¶</a></h5>
<p>To further customise how the Draftail widgets are integrated into the UI, there are additional extension points for CSS and JS:</p>
<ul class="simple">
<li>In JavaScript, use the <code class="docutils literal notranslate"><span class="pre">[data-draftail-input]</span></code> attribute selector to target the input which contains the data, and <code class="docutils literal notranslate"><span class="pre">[data-draftail-editor-wrapper]</span></code> for the element which wraps the editor.</li>
<li>The editor instance is bound on the input field for imperative access. Use <code class="docutils literal notranslate"><span class="pre">document.querySelector('[data-draftail-input]').draftailEditor</span></code>.</li>
<li>In CSS, use the classes prefixed with <code class="docutils literal notranslate"><span class="pre">Draftail-</span></code>.</li>
</ul>
</div>
</div>
<span id="document-extending/extending_hallo"></span><div class="section" id="extending-the-hallo-editor">
<span id="extending-hallo"></span><h4>Extending the Hallo Editor<a class="headerlink" href="#extending-the-hallo-editor" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>As of Wagtail 2.0, the hallo.js editor is deprecated.</strong> We have no intentions to remove it from Wagtail as of yet, but it will no longer receive bug fixes. Please be aware of the <a class="reference external" href="https://github.com/wagtail/wagtail/issues?q=is%3Aissue+is%3Aclosed+hallo+label%3A%22component%3ARich+text%22+label%3Atype%3ABug+label%3A%22status%3AWont+Fix%22">known hallo.js issues</a> should you want to keep using it.</p>
<p>To use hallo.js on Wagtail 2.x, add the following to your settings:</p>
<div class="last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILADMIN_RICH_TEXT_EDITORS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;WIDGET&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.admin.rich_text.HalloRichTextArea&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>The legacy hallo.js editor’s functionality can be extended through plugins. For information on developing custom <code class="docutils literal notranslate"><span class="pre">hallo.js</span></code> plugins, see the project’s page: <a class="reference external" href="https://github.com/bergie/hallo">https://github.com/bergie/hallo</a></p>
<p>Once the plugin has been created, it should be registered through the feature registry’s <code class="docutils literal notranslate"><span class="pre">register_editor_plugin(editor,</span> <span class="pre">feature_name,</span> <span class="pre">plugin)</span></code> method. For a <code class="docutils literal notranslate"><span class="pre">hallo.js</span></code> plugin, the <code class="docutils literal notranslate"><span class="pre">editor</span></code> parameter should always be <code class="docutils literal notranslate"><span class="pre">'hallo'</span></code>.</p>
<p>A plugin <code class="docutils literal notranslate"><span class="pre">halloblockquote</span></code>, implemented in <code class="docutils literal notranslate"><span class="pre">myapp/js/hallo-blockquote.js</span></code>, that adds support for the <code class="docutils literal notranslate"><span class="pre">&lt;blockquote&gt;</span></code> tag, would be registered under the feature name <code class="docutils literal notranslate"><span class="pre">block-quote</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin.rich_text</span> <span class="kn">import</span> <span class="n">HalloPlugin</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_rich_text_features&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_embed_feature</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="n">features</span><span class="o">.</span><span class="n">register_editor_plugin</span><span class="p">(</span>
        <span class="s1">&#39;hallo&#39;</span><span class="p">,</span> <span class="s1">&#39;block-quote&#39;</span><span class="p">,</span>
        <span class="n">HalloPlugin</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;halloblockquote&#39;</span><span class="p">,</span>
            <span class="n">js</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;myapp/js/hallo-blockquote.js&#39;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The constructor for <code class="docutils literal notranslate"><span class="pre">HalloPlugin</span></code> accepts the following keyword arguments:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> - the plugin name as defined in the JavaScript code. <code class="docutils literal notranslate"><span class="pre">hallo.js</span></code> plugin names are prefixed with the <code class="docutils literal notranslate"><span class="pre">&quot;IKS.&quot;</span></code> namespace, but the name passed here should be without the prefix.</li>
<li><code class="docutils literal notranslate"><span class="pre">options</span></code> - a dictionary (or other JSON-serialisable object) of options to be passed to the JavaScript plugin code on initialisation</li>
<li><code class="docutils literal notranslate"><span class="pre">js</span></code> - a list of JavaScript files to be imported for this plugin, defined in the same way as a <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/forms/media/" title="(in Django v3.2)"><span class="xref std std-doc">Django form media</span></a> definition</li>
<li><code class="docutils literal notranslate"><span class="pre">css</span></code> - a dictionary of CSS files to be imported for this plugin, defined in the same way as a <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/forms/media/" title="(in Django v3.2)"><span class="xref std std-doc">Django form media</span></a> definition</li>
<li><code class="docutils literal notranslate"><span class="pre">order</span></code> - an index number (default 100) specifying the order in which plugins should be listed, which in turn determines the order buttons will appear in the toolbar</li>
</ul>
<p>When writing the front-end code for the plugin, Wagtail’s Hallo implementation offers two extension points:</p>
<ul class="simple">
<li>In JavaScript, use the <code class="docutils literal notranslate"><span class="pre">[data-hallo-editor]</span></code> attribute selector to target the editor, eg. <code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">$editor</span> <span class="pre">=</span> <span class="pre">$('[data-hallo-editor]');</span></code>.</li>
<li>In CSS, use the <code class="docutils literal notranslate"><span class="pre">.halloeditor</span></code> class selector.</li>
</ul>
<div class="section" id="whitelisting-rich-text-elements">
<span id="id1"></span><h5>Whitelisting rich text elements<a class="headerlink" href="#whitelisting-rich-text-elements" title="Permalink to this headline">¶</a></h5>
<p>After extending the editor to support a new HTML element, you’ll need to add it to the whitelist of permitted elements - Wagtail’s standard behaviour is to strip out unrecognised elements, to prevent editors from inserting styles and scripts (either deliberately, or inadvertently through copy-and-paste) that the developer didn’t account for.</p>
<p>Elements can be added to the whitelist through the feature registry’s <code class="docutils literal notranslate"><span class="pre">register_converter_rule(converter,</span> <span class="pre">feature_name,</span> <span class="pre">ruleset)</span></code> method. When the <code class="docutils literal notranslate"><span class="pre">hallo.js</span></code> editor is in use, the <code class="docutils literal notranslate"><span class="pre">converter</span></code> parameter should always be <code class="docutils literal notranslate"><span class="pre">'editorhtml'</span></code>.</p>
<p>The following code will add the <code class="docutils literal notranslate"><span class="pre">&lt;blockquote&gt;</span></code> element to the whitelist whenever the <code class="docutils literal notranslate"><span class="pre">block-quote</span></code> feature is active:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin.rich_text.converters.editor_html</span> <span class="kn">import</span> <span class="n">WhitelistRule</span>
<span class="kn">from</span> <span class="nn">wagtail.core.whitelist</span> <span class="kn">import</span> <span class="n">allow_without_attributes</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_rich_text_features&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_blockquote_feature</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="n">features</span><span class="o">.</span><span class="n">register_converter_rule</span><span class="p">(</span><span class="s1">&#39;editorhtml&#39;</span><span class="p">,</span> <span class="s1">&#39;block-quote&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="n">WhitelistRule</span><span class="p">(</span><span class="s1">&#39;blockquote&#39;</span><span class="p">,</span> <span class="n">allow_without_attributes</span><span class="p">),</span>
    <span class="p">])</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">WhitelistRule</span></code> is passed the element name, and a callable which will perform some kind of manipulation of the element whenever it is encountered. This callable receives the element as a <a class="reference external" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup</a> Tag object.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">wagtail.core.whitelist</span></code> module provides a few helper functions to assist in defining these handlers: <code class="docutils literal notranslate"><span class="pre">allow_without_attributes</span></code>, a handler which preserves the element but strips out all of its attributes, and <code class="docutils literal notranslate"><span class="pre">attribute_rule</span></code> which accepts a dict specifying how to handle each attribute, and returns a handler function. This dict will map attribute names to either True (indicating that the attribute should be kept), False (indicating that it should be dropped), or a callable (which takes the initial attribute value and returns either a final value for the attribute, or None to drop the attribute).</p>
</div>
</div>
</div>
</div>
<span id="document-reference/index"></span><div class="section" id="reference">
<h3>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-reference/pages/index"></span><div class="section" id="pages">
<h4>Pages<a class="headerlink" href="#pages" title="Permalink to this headline">¶</a></h4>
<p>Wagtail requires a little careful setup to define the types of content that you want to present through your website. The basic unit of content in Wagtail is the <a class="reference internal" href="index.html#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a>, and all of your page-level content will inherit basic webpage-related properties from it. But for the most part, you will be defining content yourself, through the construction of Django models using Wagtail’s <code class="docutils literal notranslate"><span class="pre">Page</span></code> as a base.</p>
<p>Wagtail organizes content created from your models in a tree, which can have any structure and combination of model objects in it. Wagtail doesn’t prescribe ways to organize and interrelate your content, but here we’ve sketched out some strategies for organizing your models.</p>
<p>The presentation of your content, the actual webpages, includes the normal use of the Django template system. We’ll cover additional functionality that Wagtail provides at the template level later on.</p>
<div class="toctree-wrapper compound">
<span id="document-reference/pages/theory"></span><div class="section" id="theory">
<span id="pages-theory"></span><h5>Theory<a class="headerlink" href="#theory" title="Permalink to this headline">¶</a></h5>
<div class="section" id="introduction-to-trees">
<h6>Introduction to Trees<a class="headerlink" href="#introduction-to-trees" title="Permalink to this headline">¶</a></h6>
<p>If you’re unfamiliar with trees as an abstract data type, you might want to <a class="reference external" href="https://en.wikipedia.org/wiki/Tree_(data_structure)">review the concepts involved.</a></p>
<p>As a web developer, though, you probably already have a good understanding of trees as filesystem directories or paths. Wagtail pages can create the same structure, as each page in the tree has its own URL path, like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span>
    <span class="n">people</span><span class="o">/</span>
        <span class="n">nien</span><span class="o">-</span><span class="n">nunb</span><span class="o">/</span>
        <span class="n">laura</span><span class="o">-</span><span class="n">roslin</span><span class="o">/</span>
    <span class="n">events</span><span class="o">/</span>
        <span class="n">captain</span><span class="o">-</span><span class="n">picard</span><span class="o">-</span><span class="n">day</span><span class="o">/</span>
        <span class="n">winter</span><span class="o">-</span><span class="n">wrap</span><span class="o">-</span><span class="n">up</span><span class="o">/</span>
</pre></div>
</div>
<p>The Wagtail admin interface uses the tree to organize content for editing, letting you navigate up and down levels in the tree through its Explorer menu. This method of organization is a good place to start in thinking about your own Wagtail models.</p>
<div class="section" id="nodes-and-leaves">
<h7>Nodes and Leaves<a class="headerlink" href="#nodes-and-leaves" title="Permalink to this headline">¶</a></h7>
<p>It might be handy to think of the <code class="docutils literal notranslate"><span class="pre">Page</span></code>-derived models you want to create as being one of two node types: parents and leaves. Wagtail isn’t prescriptive in this approach, but it’s a good place to start if you’re not experienced in structuring your own content types.</p>
<div class="section" id="nodes">
<h8>Nodes<a class="headerlink" href="#nodes" title="Permalink to this headline">¶</a></h8>
<p>Parent nodes on the Wagtail tree probably want to organize and display a browse-able index of their descendants. A blog, for instance, needs a way to show a list of individual posts.</p>
<p>A Parent node could provide its own function returning its descendant objects.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EventPageIndex</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">def</span> <span class="nf">events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Get list of live event pages that are descendants of this page</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">descendant_of</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Filter events list to get ones that are either</span>
        <span class="c1"># running now or start in the future</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">date_from__gte</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>

        <span class="c1"># Order by date</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;date_from&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">events</span>
</pre></div>
</div>
<p>This example makes sure to limit the returned objects to pieces of content which make sense, specifically ones which have been published through Wagtail’s admin interface (<code class="docutils literal notranslate"><span class="pre">live()</span></code>) and are children of this node (<code class="docutils literal notranslate"><span class="pre">descendant_of(self)</span></code>). By setting a <code class="docutils literal notranslate"><span class="pre">subpage_types</span></code> class property in your model, you can specify which models are allowed to be set as children, and by setting a <code class="docutils literal notranslate"><span class="pre">parent_page_types</span></code> class property, you can specify which models are allowed to be parents of this page model. Wagtail will allow any <code class="docutils literal notranslate"><span class="pre">Page</span></code>-derived model by default. Regardless, it’s smart for a parent model to provide an index filtered to make sense.</p>
</div>
<div class="section" id="leaves">
<h8>Leaves<a class="headerlink" href="#leaves" title="Permalink to this headline">¶</a></h8>
<p>Leaves are the pieces of content itself, a page which is consumable, and might just consist of a bunch of properties. A blog page leaf might have some body text and an image. A person page leaf might have a photo, a name, and an address.</p>
<p>It might be helpful for a leaf to provide a way to back up along the tree to a parent, such as in the case of breadcrumbs navigation. The tree might also be deep enough that a leaf’s parent won’t be included in general site navigation.</p>
<p>The model for the leaf could provide a function that traverses the tree in the opposite direction and returns an appropriate ancestor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EventPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">def</span> <span class="nf">event_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Find closest ancestor which is an event index</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ancestors</span><span class="p">()</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">EventIndexPage</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
</pre></div>
</div>
<p>If defined, <code class="docutils literal notranslate"><span class="pre">subpage_types</span></code> and <code class="docutils literal notranslate"><span class="pre">parent_page_types</span></code> will also limit the parent models allowed to contain a leaf. If not, Wagtail will allow any combination of parents and leafs to be associated in the Wagtail tree. Like with index pages, it’s a good idea to make sure that the index is actually of the expected model to contain the leaf.</p>
</div>
<div class="section" id="other-relationships">
<h8>Other Relationships<a class="headerlink" href="#other-relationships" title="Permalink to this headline">¶</a></h8>
<p>Your <code class="docutils literal notranslate"><span class="pre">Page</span></code>-derived models might have other interrelationships which extend the basic Wagtail tree or depart from it entirely. You could provide functions to navigate between siblings, such as a “Next Post” link on a blog page (<code class="docutils literal notranslate"><span class="pre">post-&gt;post-&gt;post</span></code>). It might make sense for subtrees to interrelate, such as in a discussion forum (<code class="docutils literal notranslate"><span class="pre">forum-&gt;post-&gt;replies</span></code>) Skipping across the hierarchy might make sense, too, as all objects of a certain model class might interrelate regardless of their ancestors (<code class="docutils literal notranslate"><span class="pre">events</span> <span class="pre">=</span> <span class="pre">EventPage.objects.all</span></code>). It’s largely up to the models to define their interrelations, the possibilities are really endless.</p>
</div>
</div>
</div>
<div class="section" id="anatomy-of-a-wagtail-request">
<span id="id1"></span><h6>Anatomy of a Wagtail Request<a class="headerlink" href="#anatomy-of-a-wagtail-request" title="Permalink to this headline">¶</a></h6>
<p>For going beyond the basics of model definition and interrelation, it might help to know how Wagtail handles requests and constructs responses. In short, it goes something like:</p>
<ol class="arabic simple">
<li>Django gets a request and routes through Wagtail’s URL dispatcher definitions</li>
<li>Wagtail checks the hostname of the request to determine which <code class="docutils literal notranslate"><span class="pre">Site</span></code> record will handle this request.</li>
<li>Starting from the root page of that site, Wagtail traverses the page tree, calling the <code class="docutils literal notranslate"><span class="pre">route()</span></code> method and letting each page model decide whether it will handle the request itself or pass it on to a child page.</li>
<li>The page responsible for handling the request returns a <code class="docutils literal notranslate"><span class="pre">RouteResult</span></code> object from <code class="docutils literal notranslate"><span class="pre">route()</span></code>, which identifies the page along with any additional <code class="docutils literal notranslate"><span class="pre">args</span></code>/<code class="docutils literal notranslate"><span class="pre">kwargs</span></code> to be passed to <code class="docutils literal notranslate"><span class="pre">serve()</span></code>.</li>
<li>Wagtail calls <code class="docutils literal notranslate"><span class="pre">serve()</span></code>, which constructs a context using <code class="docutils literal notranslate"><span class="pre">get_context()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">serve()</span></code> finds a template to pass it to using <code class="docutils literal notranslate"><span class="pre">get_template()</span></code></li>
<li>A response object is returned by <code class="docutils literal notranslate"><span class="pre">serve()</span></code> and Django responds to the requester.</li>
</ol>
<p>You can apply custom behaviour to this process by overriding <code class="docutils literal notranslate"><span class="pre">Page</span></code> class methods such as <code class="docutils literal notranslate"><span class="pre">route()</span></code> and <code class="docutils literal notranslate"><span class="pre">serve()</span></code> in your own models. For examples, see <a class="reference internal" href="index.html#model-recipes"><span class="std std-ref">Recipes</span></a>.</p>
</div>
<div class="section" id="scheduled-publishing">
<span id="id2"></span><h6>Scheduled Publishing<a class="headerlink" href="#scheduled-publishing" title="Permalink to this headline">¶</a></h6>
<p>Page publishing can be scheduled through the <em>Go live date/time</em> feature in the <em>Settings</em> tab of the <em>Edit</em> page. This allows you to set set up initial page publishing or a page update in advance.
In order for pages to be published at the scheduled time you should set up the <a class="reference internal" href="index.html#publish-scheduled-pages"><span class="std std-ref">publish_scheduled_pages</span></a> management command.</p>
<p>The basic workflow is as follows:</p>
<ul class="simple">
<li>Scheduling a revision for a page that is not currently live means that page will go live when the scheduled time comes.</li>
<li>Scheduling a revision for a page that is already live means that revision will be published when the time comes.</li>
<li>If page has a scheduled revision and you set another revision to publish immediately, the scheduled revision will be unscheduled.</li>
</ul>
<p>The <em>Revisions</em> view for a given page will show which revision is scheduled and when it is scheduled for. A scheduled revision in the list will also provide an <em>Unschedule</em> button to cancel it.</p>
</div>
</div>
<span id="document-reference/pages/model_recipes"></span><div class="section" id="recipes">
<span id="model-recipes"></span><h5>Recipes<a class="headerlink" href="#recipes" title="Permalink to this headline">¶</a></h5>
<div class="section" id="overriding-the-serve-method">
<h6>Overriding the <a class="reference internal" href="index.html#wagtail.core.models.Page.serve" title="wagtail.core.models.Page.serve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">serve()</span></code></a> Method<a class="headerlink" href="#overriding-the-serve-method" title="Permalink to this headline">¶</a></h6>
<p>Wagtail defaults to serving <a class="reference internal" href="index.html#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a>-derived models by passing a reference to the page object to a Django HTML template matching the model’s name, but suppose you wanted to serve something other than HTML? You can override the <a class="reference internal" href="index.html#wagtail.core.models.Page.serve" title="wagtail.core.models.Page.serve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">serve()</span></code></a> method provided by the <a class="reference internal" href="index.html#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a> class and handle the Django request and response more directly.</p>
<p>Consider this example from the Wagtail demo site’s <code class="docutils literal notranslate"><span class="pre">models.py</span></code>, which serves an <code class="docutils literal notranslate"><span class="pre">EventPage</span></code> object as an iCal file if the <code class="docutils literal notranslate"><span class="pre">format</span></code> variable is set in the request:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EventPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">serve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;format&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ical&#39;</span><span class="p">:</span>
                <span class="c1"># Export to ical format</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span>
                    <span class="n">export_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ical&#39;</span><span class="p">),</span>
                    <span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;text/calendar&#39;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;attachment; filename=&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">+</span> <span class="s1">&#39;.ics&#39;</span>
                <span class="k">return</span> <span class="n">response</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Unrecognised format error</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Could not export event</span><span class="se">\n\n</span><span class="s1">Unrecognised format: &#39;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Display event page as usual</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="index.html#wagtail.core.models.Page.serve" title="wagtail.core.models.Page.serve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">serve()</span></code></a> takes a Django request object and returns a Django response object. Wagtail returns a <code class="docutils literal notranslate"><span class="pre">TemplateResponse</span></code> object with the template and context which it generates, which allows middleware to function as intended, so keep in mind that a simpler response object like a <code class="docutils literal notranslate"><span class="pre">HttpResponse</span></code> will not receive these benefits.</p>
<p>With this strategy, you could use Django or Python utilities to render your model in JSON or XML or any other format you’d like.</p>
</div>
<div class="section" id="adding-endpoints-with-custom-route-methods">
<span id="overriding-route-method"></span><h6>Adding Endpoints with Custom <a class="reference internal" href="index.html#wagtail.core.models.Page.route" title="wagtail.core.models.Page.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> Methods<a class="headerlink" href="#adding-endpoints-with-custom-route-methods" title="Permalink to this headline">¶</a></h6>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A much simpler way of adding more endpoints to pages is provided by the <a class="reference internal" href="index.html#module-wagtail.contrib.routable_page" title="wagtail.contrib.routable_page"><code class="xref py py-mod docutils literal notranslate"><span class="pre">routable_page</span></code></a> module.</p>
</div>
<p>Wagtail routes requests by iterating over the path components (separated with a forward slash <code class="docutils literal notranslate"><span class="pre">/</span></code>), finding matching objects based on their slug, and delegating further routing to that object’s model class. The Wagtail source is very instructive in figuring out what’s happening. This is the default <code class="docutils literal notranslate"><span class="pre">route()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Page</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">path_components</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path_components</span><span class="p">:</span>
            <span class="c1"># request is for a child of this page</span>
            <span class="n">child_slug</span> <span class="o">=</span> <span class="n">path_components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">remaining_components</span> <span class="o">=</span> <span class="n">path_components</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="c1"># find a matching child or 404</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">subpage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">child_slug</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Page</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Http404</span>

            <span class="c1"># delegate further routing</span>
            <span class="k">return</span> <span class="n">subpage</span><span class="o">.</span><span class="n">specific</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">remaining_components</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># request is for this very page</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="p">:</span>
                <span class="c1"># Return a RouteResult that will tell Wagtail to call</span>
                <span class="c1"># this page&#39;s serve() method</span>
                <span class="k">return</span> <span class="n">RouteResult</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># the page matches the request, but isn&#39;t published, so 404</span>
                <span class="k">raise</span> <span class="n">Http404</span>
</pre></div>
</div>
<p><a class="reference internal" href="index.html#wagtail.core.models.Page.route" title="wagtail.core.models.Page.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> takes the current object (<code class="docutils literal notranslate"><span class="pre">self</span></code>), the <code class="docutils literal notranslate"><span class="pre">request</span></code> object, and a list of the remaining <code class="docutils literal notranslate"><span class="pre">path_components</span></code> from the request URL. It either continues delegating routing by calling <a class="reference internal" href="index.html#wagtail.core.models.Page.route" title="wagtail.core.models.Page.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> again on one of its children in the Wagtail tree, or ends the routing process by returning a <code class="docutils literal notranslate"><span class="pre">RouteResult</span></code> object or raising a 404 error.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">RouteResult</span></code> object (defined in wagtail.core.url_routing) encapsulates all the information Wagtail needs to call a page’s <a class="reference internal" href="index.html#wagtail.core.models.Page.serve" title="wagtail.core.models.Page.serve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">serve()</span></code></a> method and return a final response: this information consists of the page object, and any additional <code class="docutils literal notranslate"><span class="pre">args</span></code>/<code class="docutils literal notranslate"><span class="pre">kwargs</span></code> to be passed to <a class="reference internal" href="index.html#wagtail.core.models.Page.serve" title="wagtail.core.models.Page.serve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">serve()</span></code></a>.</p>
<p>By overriding the <a class="reference internal" href="index.html#wagtail.core.models.Page.route" title="wagtail.core.models.Page.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> method, we could create custom endpoints for each object in the Wagtail tree. One use case might be using an alternate template when encountering the <code class="docutils literal notranslate"><span class="pre">print/</span></code> endpoint in the path. Another might be a REST API which interacts with the current object. Just to see what’s involved, lets make a simple model which prints out all of its child path components.</p>
<p>First, <code class="docutils literal notranslate"><span class="pre">models.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">wagtail.core.url_routing</span> <span class="kn">import</span> <span class="n">RouteResult</span>
<span class="kn">from</span> <span class="nn">django.http.response</span> <span class="kn">import</span> <span class="n">Http404</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>

<span class="o">...</span>

<span class="k">class</span> <span class="nc">Echoer</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">path_components</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path_components</span><span class="p">:</span>
            <span class="c1"># tell Wagtail to call self.serve() with an additional &#39;path_components&#39; kwarg</span>
            <span class="k">return</span> <span class="n">RouteResult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;path_components&#39;</span><span class="p">:</span> <span class="n">path_components</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="p">:</span>
                <span class="c1"># tell Wagtail to call self.serve() with no further args</span>
                <span class="k">return</span> <span class="n">RouteResult</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Http404</span>

    <span class="k">def</span> <span class="nf">serve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_components</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span>
            <span class="s1">&#39;echo&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_components</span><span class="p">),</span>
        <span class="p">})</span>
</pre></div>
</div>
<p>This model, <code class="docutils literal notranslate"><span class="pre">Echoer</span></code>, doesn’t define any properties, but does subclass <code class="docutils literal notranslate"><span class="pre">Page</span></code> so objects will be able to have a custom title and slug. The template just has to display our <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">echo</span> <span class="pre">}}</span></code> property.</p>
<p>Now, once creating a new <code class="docutils literal notranslate"><span class="pre">Echoer</span></code> page in the Wagtail admin titled “Echo Base,” requests such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">echo</span><span class="o">-</span><span class="n">base</span><span class="o">/</span><span class="n">tauntaun</span><span class="o">/</span><span class="n">kennel</span><span class="o">/</span><span class="n">bed</span><span class="o">/</span><span class="ow">and</span><span class="o">/</span><span class="n">breakfast</span><span class="o">/</span>
</pre></div>
</div>
<p>Will return:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tauntaun</span> <span class="n">kennel</span> <span class="n">bed</span> <span class="ow">and</span> <span class="n">breakfast</span>
</pre></div>
</div>
<p>Be careful if you’re introducing new required arguments to the <code class="docutils literal notranslate"><span class="pre">serve()</span></code> method - Wagtail still needs to be able to display a default view of the page for previewing and moderation, and by default will attempt to do this by calling <code class="docutils literal notranslate"><span class="pre">serve()</span></code> with a request object and no further arguments. If your <code class="docutils literal notranslate"><span class="pre">serve()</span></code> method does not accept that as a method signature, you will need to override the page’s <code class="docutils literal notranslate"><span class="pre">serve_preview()</span></code> method to call <code class="docutils literal notranslate"><span class="pre">serve()</span></code> with suitable arguments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">serve_preview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">mode_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tagging">
<span id="id1"></span><h6>Tagging<a class="headerlink" href="#tagging" title="Permalink to this headline">¶</a></h6>
<p>Wagtail provides tagging capabilities through the combination of two Django modules, <a class="reference external" href="https://django-taggit.readthedocs.io/">django-taggit</a> (which provides a general-purpose tagging implementation) and <a class="reference external" href="https://github.com/wagtail/django-modelcluster">django-modelcluster</a> (which extends django-taggit’s <code class="docutils literal notranslate"><span class="pre">TaggableManager</span></code> to allow tag relations to be managed in memory without writing to the database - necessary for handling previews and revisions). To add tagging to a page model, you’ll need to define a ‘through’ model inheriting from <code class="docutils literal notranslate"><span class="pre">TaggedItemBase</span></code> to set up the many-to-many relationship between django-taggit’s <code class="docutils literal notranslate"><span class="pre">Tag</span></code> model and your page model, and add a <code class="docutils literal notranslate"><span class="pre">ClusterTaggableManager</span></code> accessor to your page model to present this relation as a single tag field.</p>
<p>In this example, we set up tagging on <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> through a <code class="docutils literal notranslate"><span class="pre">BlogPageTag</span></code> model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># models.py</span>

<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">modelcluster.contrib.taggit</span> <span class="kn">import</span> <span class="n">ClusterTaggableManager</span>
<span class="kn">from</span> <span class="nn">taggit.models</span> <span class="kn">import</span> <span class="n">TaggedItemBase</span>

<span class="k">class</span> <span class="nc">BlogPageTag</span><span class="p">(</span><span class="n">TaggedItemBase</span><span class="p">):</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;demo.BlogPage&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;tagged_items&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">ClusterTaggableManager</span><span class="p">(</span><span class="n">through</span><span class="o">=</span><span class="n">BlogPageTag</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">promote_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">promote_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="o">...</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Wagtail’s admin provides a nice interface for inputting tags into your content, with typeahead tag completion and friendly tag icons.</p>
<p>We can now make use of the many-to-many tag relationship in our views and templates. For example, we can set up the blog’s index page to accept a <code class="docutils literal notranslate"><span class="pre">?tag=...</span></code> query parameter to filter the <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> listing by tag:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="k">class</span> <span class="nc">BlogIndexPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c1"># Get blog entries</span>
        <span class="n">blog_entries</span> <span class="o">=</span> <span class="n">BlogPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">child_of</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">live</span><span class="p">()</span>

        <span class="c1"># Filter by tag</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tag&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">blog_entries</span> <span class="o">=</span> <span class="n">blog_entries</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tags__name</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>

        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_entries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog_entries</span>
        <span class="k">return</span> <span class="n">context</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">blog_entries.filter(tags__name=tag)</span></code> follows the <code class="docutils literal notranslate"><span class="pre">tags</span></code> relation on <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code>, to filter the listing to only those pages with a matching tag name before passing this to the template for rendering. We can now update the <code class="docutils literal notranslate"><span class="pre">blog_page.html</span></code> template to show a list of tags associated with the page, with links back to the filtered index page:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">tag</span> <span class="k">in</span> <span class="nv">page.tags.all</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">page.blog_index</span> <span class="cp">%}</span><span class="s">?tag=</span><span class="cp">{{</span> <span class="nv">tag</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">tag</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Iterating through <code class="docutils literal notranslate"><span class="pre">page.tags.all</span></code> will display each tag associated with <code class="docutils literal notranslate"><span class="pre">page</span></code>, while the links back to the index make use of the filter option added to the <code class="docutils literal notranslate"><span class="pre">BlogIndexPage</span></code> model. A Django query could also use the <code class="docutils literal notranslate"><span class="pre">tagged_items</span></code> related name field to get <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> objects associated with a tag.</p>
<p>The same approach can be used to add tagging to non-page models managed through <a class="reference internal" href="index.html#snippets"><span class="std std-ref">Snippets</span></a> and <a class="reference internal" href="index.html#document-reference/contrib/modeladmin/index"><span class="doc">ModelAdmin</span></a>. In this case, the model must inherit from <code class="docutils literal notranslate"><span class="pre">modelcluster.models.ClusterableModel</span></code> to be compatible with <code class="docutils literal notranslate"><span class="pre">ClusterTaggableManager</span></code>.</p>
</div>
<div class="section" id="custom-tag-models">
<h6>Custom tag models<a class="headerlink" href="#custom-tag-models" title="Permalink to this headline">¶</a></h6>
<p>In the above example, any newly-created tags will be added to django-taggit’s default <code class="docutils literal notranslate"><span class="pre">Tag</span></code> model, which will be shared by all other models using the same recipe as well as Wagtail’s image and document models. In particular, this means that the autocompletion suggestions on tag fields will include tags previously added to other models. To avoid this, you can set up a custom tag model inheriting from <code class="docutils literal notranslate"><span class="pre">TagBase</span></code>, along with a ‘through’ model inheriting from <code class="docutils literal notranslate"><span class="pre">ItemBase</span></code>, which will provide an independent pool of tags for that page model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">modelcluster.contrib.taggit</span> <span class="kn">import</span> <span class="n">ClusterTaggableManager</span>
<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">taggit.models</span> <span class="kn">import</span> <span class="n">TagBase</span><span class="p">,</span> <span class="n">ItemBase</span>

<span class="k">class</span> <span class="nc">BlogTag</span><span class="p">(</span><span class="n">TagBase</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;blog tag&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;blog tags&quot;</span>


<span class="k">class</span> <span class="nc">TaggedBlog</span><span class="p">(</span><span class="n">ItemBase</span><span class="p">):</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">BlogTag</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;tagged_blogs&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span>
    <span class="p">)</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span>
        <span class="n">to</span><span class="o">=</span><span class="s1">&#39;demo.BlogPage&#39;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;tagged_items&#39;</span>
    <span class="p">)</span>

<span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">ClusterTaggableManager</span><span class="p">(</span><span class="n">through</span><span class="o">=</span><span class="s1">&#39;demo.TaggedBlog&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Within the admin, the tag field will automatically recognise the custom tag model being used, and will offer autocomplete suggestions taken from that tag model.</p>
</div>
<div class="section" id="disabling-free-tagging">
<h6>Disabling free tagging<a class="headerlink" href="#disabling-free-tagging" title="Permalink to this headline">¶</a></h6>
<p>By default, tag fields work on a “free tagging” basis: editors can enter anything into the field, and upon saving, any tag text not recognised as an existing tag will be created automatically. To disable this behaviour, and only allow editors to enter tags that already exist in the database, custom tag models accept a <code class="docutils literal notranslate"><span class="pre">free_tagging</span> <span class="pre">=</span> <span class="pre">False</span></code> option:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">taggit.models</span> <span class="kn">import</span> <span class="n">TagBase</span>
<span class="kn">from</span> <span class="nn">wagtail.snippets.models</span> <span class="kn">import</span> <span class="n">register_snippet</span>

<span class="nd">@register_snippet</span>
<span class="k">class</span> <span class="nc">BlogTag</span><span class="p">(</span><span class="n">TagBase</span><span class="p">):</span>
    <span class="n">free_tagging</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;blog tag&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;blog tags&quot;</span>
</pre></div>
</div>
<p>Here we have registered <code class="docutils literal notranslate"><span class="pre">BlogTag</span></code> as a snippet, to provide an interface for administrators (and other users with the appropriate permissions) to manage the allowed set of tags. With the <code class="docutils literal notranslate"><span class="pre">free_tagging</span> <span class="pre">=</span> <span class="pre">False</span></code> option set, editors can no longer enter arbitrary text into the tag field, and must instead select existing tags from the autocomplete dropdown.</p>
</div>
<div class="section" id="have-redirects-created-automatically-when-changing-page-slug">
<span id="page-model-auto-redirects-recipe"></span><h6>Have redirects created automatically when changing page slug<a class="headerlink" href="#have-redirects-created-automatically-when-changing-page-slug" title="Permalink to this headline">¶</a></h6>
<p>You may want redirects created automatically when a url gets changed in the admin so as to avoid broken links. You can add something like the following block to a <code class="docutils literal notranslate"><span class="pre">wagtail_hooks.py</span></code> file within one of your project’s apps.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.redirects.models</span> <span class="kn">import</span> <span class="n">Redirect</span>

<span class="c1"># Create redirect when editing slugs</span>
<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;before_edit_page&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_redirect_on_slug_change</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">page</span><span class="o">.</span><span class="n">slug</span> <span class="o">!=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;slug&#39;</span><span class="p">]:</span>
            <span class="n">Redirect</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                    <span class="n">old_path</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">url</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">site</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">get_site</span><span class="p">(),</span>
                    <span class="n">redirect_page</span><span class="o">=</span><span class="n">page</span>
                <span class="p">)</span>
</pre></div>
</div>
<p>Note: This does not work in some cases e.g. when you redirect a page, create a new page in that url and then move the new one. It should be helpful in most cases however.</p>
</div>
</div>
<span id="document-reference/pages/panels"></span><div class="section" id="panel-types">
<span id="editing-api"></span><h5>Panel types<a class="headerlink" href="#panel-types" title="Permalink to this headline">¶</a></h5>
<div class="section" id="built-in-fields-and-choosers">
<h6>Built-in Fields and Choosers<a class="headerlink" href="#built-in-fields-and-choosers" title="Permalink to this headline">¶</a></h6>
<p>Django’s field types are automatically recognised and provided with an appropriate widget for input. Just define that field the normal Django way and pass the field name into <a class="reference internal" href="#wagtail.admin.edit_handlers.FieldPanel" title="wagtail.admin.edit_handlers.FieldPanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">FieldPanel</span></code></a> when defining your panels. Wagtail will take care of the rest.</p>
<p>Here are some Wagtail-specific types that you might include as fields in your models.</p>
<span class="target" id="module-wagtail.admin.edit_handlers"></span><div class="section" id="fieldpanel">
<h7>FieldPanel<a class="headerlink" href="#fieldpanel" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.admin.edit_handlers.FieldPanel">
<em class="property">class </em><code class="descclassname">wagtail.admin.edit_handlers.</code><code class="descname">FieldPanel</code><span class="sig-paren">(</span><em>field_name</em>, <em>classname=None</em>, <em>widget=None</em>, <em>heading=''</em>, <em>disable_comments=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.admin.edit_handlers.FieldPanel" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the panel used for basic Django field types.</p>
<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.FieldPanel.field_name">
<code class="descname">field_name</code><a class="headerlink" href="#wagtail.admin.edit_handlers.FieldPanel.field_name" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the name of the class property used in your model definition.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.FieldPanel.classname">
<code class="descname">classname</code><a class="headerlink" href="#wagtail.admin.edit_handlers.FieldPanel.classname" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a string of optional CSS classes given to the panel which are used in formatting and scripted interactivity. By default, panels are formatted as inset fields.</p>
<p>The CSS class <code class="docutils literal notranslate"><span class="pre">full</span></code> can be used to format the panel so it covers the full width of the Wagtail page editor.</p>
<p>The CSS class <code class="docutils literal notranslate"><span class="pre">title</span></code> can be used to give the field a larger text size, suitable for representing page titles and section headings.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.FieldPanel.widget">
<code class="descname">widget</code><span class="sig-paren">(</span><em>optional</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.admin.edit_handlers.FieldPanel.widget" title="Permalink to this definition">¶</a></dt>
<dd><p>This parameter allows you to specify a <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/forms/widgets/" title="(in Django v3.2)"><span class="xref std std-doc">Django form widget</span></a> to use instead of the default widget for this field type.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.FieldPanel.heading">
<code class="descname">heading</code><span class="sig-paren">(</span><em>optional</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.admin.edit_handlers.FieldPanel.heading" title="Permalink to this definition">¶</a></dt>
<dd><p>This allows you to override the heading for the panel, which will otherwise be set automatically using the form field’s label (taken in turn from a model field’s <code class="docutils literal notranslate"><span class="pre">verbose_name</span></code>).</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.FieldPanel.disable_comments">
<code class="descname">disable_comments</code><span class="sig-paren">(</span><em>optional</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.admin.edit_handlers.FieldPanel.disable_comments" title="Permalink to this definition">¶</a></dt>
<dd><p>This allows you to prevent a field level comment button showing for this panel if set to <code class="docutils literal notranslate"><span class="pre">True</span></code> (see <a class="reference internal" href="index.html#commenting"><span class="std std-ref">Commenting</span></a>).</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="streamfieldpanel">
<h7>StreamFieldPanel<a class="headerlink" href="#streamfieldpanel" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.admin.edit_handlers.StreamFieldPanel">
<em class="property">class </em><code class="descclassname">wagtail.admin.edit_handlers.</code><code class="descname">StreamFieldPanel</code><span class="sig-paren">(</span><em>field_name</em>, <em>classname=None</em>, <em>widget=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.admin.edit_handlers.StreamFieldPanel" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the panel used for Wagtail’s StreamField type (see <a class="reference internal" href="index.html#streamfield"><span class="std std-ref">How to use StreamField for mixed content</span></a>).</p>
<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.StreamFieldPanel.FieldPanel.field_name">
<code class="descclassname">FieldPanel.</code><code class="descname">field_name</code><a class="headerlink" href="#wagtail.admin.edit_handlers.StreamFieldPanel.FieldPanel.field_name" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the name of the class property used in your model definition.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.StreamFieldPanel.FieldPanel.classname">
<code class="descclassname">FieldPanel.</code><code class="descname">classname</code><span class="sig-paren">(</span><em>optional</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.admin.edit_handlers.StreamFieldPanel.FieldPanel.classname" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a string of optional CSS classes given to the panel which are used in formatting and scripted interactivity. By default, panels are formatted as inset fields.</p>
<p>The CSS class <code class="docutils literal notranslate"><span class="pre">full</span></code> can be used to format the panel so it covers the full width of the Wagtail page editor.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="multifieldpanel">
<h7>MultiFieldPanel<a class="headerlink" href="#multifieldpanel" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.admin.edit_handlers.MultiFieldPanel">
<em class="property">class </em><code class="descclassname">wagtail.admin.edit_handlers.</code><code class="descname">MultiFieldPanel</code><span class="sig-paren">(</span><em>children</em>, <em>heading=&quot;&quot;</em>, <em>classname=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.admin.edit_handlers.MultiFieldPanel" title="Permalink to this definition">¶</a></dt>
<dd><p>This panel condenses several <a class="reference internal" href="#wagtail.admin.edit_handlers.FieldPanel" title="wagtail.admin.edit_handlers.FieldPanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">FieldPanel</span></code></a> s or choosers, from a <code class="docutils literal notranslate"><span class="pre">list</span></code> or <code class="docutils literal notranslate"><span class="pre">tuple</span></code>, under a single <code class="docutils literal notranslate"><span class="pre">heading</span></code> string.</p>
<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.MultiFieldPanel.children">
<code class="descname">children</code><a class="headerlink" href="#wagtail.admin.edit_handlers.MultiFieldPanel.children" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="docutils literal notranslate"><span class="pre">list</span></code> or <code class="docutils literal notranslate"><span class="pre">tuple</span></code> of child panels</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.MultiFieldPanel.heading">
<code class="descname">heading</code><a class="headerlink" href="#wagtail.admin.edit_handlers.MultiFieldPanel.heading" title="Permalink to this definition">¶</a></dt>
<dd><p>A heading for the fields</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="inlinepanel">
<h7>InlinePanel<a class="headerlink" href="#inlinepanel" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.admin.edit_handlers.InlinePanel">
<em class="property">class </em><code class="descclassname">wagtail.admin.edit_handlers.</code><code class="descname">InlinePanel</code><span class="sig-paren">(</span><em>relation_name</em>, <em>panels=None</em>, <em>classname=''</em>, <em>heading=''</em>, <em>label=''</em>, <em>help_text=''</em>, <em>min_num=None</em>, <em>max_num=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.admin.edit_handlers.InlinePanel" title="Permalink to this definition">¶</a></dt>
<dd><p>This panel allows for the creation of a “cluster” of related objects over a join to a separate model, such as a list of related links or slides to an image carousel.</p>
<p>This is a powerful but complex feature which will take some space to cover, so we’ll skip over it for now. For a full explanation on the usage of <code class="docutils literal notranslate"><span class="pre">InlinePanel</span></code>, see <a class="reference internal" href="#inline-panels"><span class="std std-ref">Inline Panels and Model Clusters</span></a>.</p>
</dd></dl>

<div class="topic">
<p class="topic-title">Collapsing InlinePanels to save space</p>
<p>Note that you can use <code class="docutils literal notranslate"><span class="pre">classname=&quot;collapsible</span> <span class="pre">collapsed&quot;</span></code> to load the panel collapsed under its heading in order to save space in the Wagtail admin.
See <a class="reference internal" href="#collapsible"><span class="std std-ref">Collapsible</span></a> for more details on <code class="docutils literal notranslate"><span class="pre">collapsible</span></code> usage.</p>
</div>
</div>
<div class="section" id="fieldrowpanel">
<h7>FieldRowPanel<a class="headerlink" href="#fieldrowpanel" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.admin.edit_handlers.FieldRowPanel">
<em class="property">class </em><code class="descclassname">wagtail.admin.edit_handlers.</code><code class="descname">FieldRowPanel</code><span class="sig-paren">(</span><em>children</em>, <em>classname=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.admin.edit_handlers.FieldRowPanel" title="Permalink to this definition">¶</a></dt>
<dd><p>This panel creates a columnar layout in the editing interface, where each of the child Panels appears alongside each other rather than below.</p>
<p>Use of FieldRowPanel particularly helps reduce the “snow-blindness” effect of seeing so many fields on the page, for complex models. It also improves the perceived association between fields of a similar nature. For example if you created a model representing an “Event” which had a starting date and ending date, it may be intuitive to find the start and end date on the same “row”.</p>
<p>By default, the panel is divided into equal-width columns, but this can be overridden by adding <code class="docutils literal notranslate"><span class="pre">col*</span></code> class names to each of the child Panels of the FieldRowPanel. The Wagtail editing interface is laid out using a grid system, in which the maximum width of the editor is 12 columns. Classes <code class="docutils literal notranslate"><span class="pre">col1</span></code>-<code class="docutils literal notranslate"><span class="pre">col12</span></code> can be applied to each child of a FieldRowPanel. The class <code class="docutils literal notranslate"><span class="pre">col3</span></code> will ensure that field appears 3 columns wide or a quarter the width. <code class="docutils literal notranslate"><span class="pre">col4</span></code> would cause the field to be 4 columns wide, or a third the width.</p>
<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.FieldRowPanel.children">
<code class="descname">children</code><a class="headerlink" href="#wagtail.admin.edit_handlers.FieldRowPanel.children" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="docutils literal notranslate"><span class="pre">list</span></code> or <code class="docutils literal notranslate"><span class="pre">tuple</span></code> of child panels to display on the row</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.FieldRowPanel.classname">
<code class="descname">classname</code><a class="headerlink" href="#wagtail.admin.edit_handlers.FieldRowPanel.classname" title="Permalink to this definition">¶</a></dt>
<dd><p>A class to apply to the FieldRowPanel as a whole</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="helppanel">
<h7>HelpPanel<a class="headerlink" href="#helppanel" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.admin.edit_handlers.HelpPanel">
<em class="property">class </em><code class="descclassname">wagtail.admin.edit_handlers.</code><code class="descname">HelpPanel</code><span class="sig-paren">(</span><em>content=''</em>, <em>template='wagtailadmin/edit_handlers/help_panel.html'</em>, <em>heading=''</em>, <em>classname=''</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.admin.edit_handlers.HelpPanel" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.admin.edit_handlers.HelpPanel.content">
<code class="descname">content</code><a class="headerlink" href="#wagtail.admin.edit_handlers.HelpPanel.content" title="Permalink to this definition">¶</a></dt>
<dd><p>HTML string that gets displayed in the panel.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.HelpPanel.template">
<code class="descname">template</code><a class="headerlink" href="#wagtail.admin.edit_handlers.HelpPanel.template" title="Permalink to this definition">¶</a></dt>
<dd><p>Path to a template rendering the full panel HTML.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.HelpPanel.heading">
<code class="descname">heading</code><a class="headerlink" href="#wagtail.admin.edit_handlers.HelpPanel.heading" title="Permalink to this definition">¶</a></dt>
<dd><p>A heading for the help content.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.admin.edit_handlers.HelpPanel.classname">
<code class="descname">classname</code><a class="headerlink" href="#wagtail.admin.edit_handlers.HelpPanel.classname" title="Permalink to this definition">¶</a></dt>
<dd><p>String of CSS classes given to the panel which are used in formatting and scripted interactivity.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="pagechooserpanel">
<h7>PageChooserPanel<a class="headerlink" href="#pagechooserpanel" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.admin.edit_handlers.PageChooserPanel">
<em class="property">class </em><code class="descclassname">wagtail.admin.edit_handlers.</code><code class="descname">PageChooserPanel</code><span class="sig-paren">(</span><em>field_name</em>, <em>page_type=None</em>, <em>can_choose_root=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.admin.edit_handlers.PageChooserPanel" title="Permalink to this definition">¶</a></dt>
<dd><p>You can explicitly link <a class="reference internal" href="index.html#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a>-derived models together using the <a class="reference internal" href="index.html#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a> model and <code class="docutils literal notranslate"><span class="pre">PageChooserPanel</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">PageChooserPanel</span>


<span class="k">class</span> <span class="nc">BookPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">related_page</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;wagtailcore.Page&#39;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">PageChooserPanel</span><span class="p">(</span><span class="s1">&#39;related_page&#39;</span><span class="p">,</span> <span class="s1">&#39;demo.PublisherPage&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">PageChooserPanel</span></code> takes one required argument, the field name. Optionally, specifying a page type (in the form of an <code class="docutils literal notranslate"><span class="pre">&quot;appname.modelname&quot;</span></code> string) will filter the chooser to display only pages of that type. A list or tuple of page types can also be passed in, to allow choosing a page that matches any of those page types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PageChooserPanel</span><span class="p">(</span><span class="s1">&#39;related_page&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;demo.PublisherPage&#39;</span><span class="p">,</span> <span class="s1">&#39;demo.AuthorPage&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Passing <code class="docutils literal notranslate"><span class="pre">can_choose_root=True</span></code> will allow the editor to choose the tree root as a page. Normally this would be undesirable, since the tree root is never a usable page, but in some specialised cases it may be appropriate; for example, a page with an automatic “related articles” feed could use a PageChooserPanel to select which subsection articles will be taken from, with the root corresponding to ‘everywhere’.</p>
</dd></dl>

</div>
<div class="section" id="module-wagtail.images.edit_handlers">
<span id="imagechooserpanel"></span><h7>ImageChooserPanel<a class="headerlink" href="#module-wagtail.images.edit_handlers" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.images.edit_handlers.ImageChooserPanel">
<em class="property">class </em><code class="descclassname">wagtail.images.edit_handlers.</code><code class="descname">ImageChooserPanel</code><span class="sig-paren">(</span><em>field_name</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.images.edit_handlers.ImageChooserPanel" title="Permalink to this definition">¶</a></dt>
<dd><p>Wagtail includes a unified image library, which you can access in your models through the <code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code> model and the <code class="docutils literal notranslate"><span class="pre">ImageChooserPanel</span></code> chooser. Here’s how:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.images.models</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">wagtail.images.edit_handlers</span> <span class="kn">import</span> <span class="n">ImageChooserPanel</span>


<span class="k">class</span> <span class="nc">BookPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">cover</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;wagtailimages.Image&#39;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span>
    <span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">ImageChooserPanel</span><span class="p">(</span><span class="s1">&#39;cover&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Django’s default behaviour is to “cascade” deletions through a ForeignKey relationship, which may not be what you want. This is why the <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/fields/#django.db.models.Field.null" title="(in Django v3.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">null</span></code></a>, <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/fields/#django.db.models.Field.blank" title="(in Django v3.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">blank</span></code></a>, and <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/fields/#django.db.models.ForeignKey.on_delete" title="(in Django v3.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">on_delete</span></code></a> parameters should be set to allow for an empty field. <code class="docutils literal notranslate"><span class="pre">ImageChooserPanel</span></code> takes only one argument: the name of the field.</p>
<p>Displaying <code class="docutils literal notranslate"><span class="pre">Image</span></code> objects in a template requires the use of a template tag. See <a class="reference internal" href="index.html#image-tag"><span class="std std-ref">How to use images in templates</span></a>.</p>
</dd></dl>

</div>
<div class="section" id="module-wagtail.contrib.forms.edit_handlers">
<span id="formsubmissionspanel"></span><h7>FormSubmissionsPanel<a class="headerlink" href="#module-wagtail.contrib.forms.edit_handlers" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.contrib.forms.edit_handlers.FormSubmissionsPanel">
<em class="property">class </em><code class="descclassname">wagtail.contrib.forms.edit_handlers.</code><code class="descname">FormSubmissionsPanel</code><a class="headerlink" href="#wagtail.contrib.forms.edit_handlers.FormSubmissionsPanel" title="Permalink to this definition">¶</a></dt>
<dd><p>This panel adds a single, read-only section in the edit interface for pages implementing the <code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractForm</span></code> model.
It includes the number of total submissions for the given form and also a link to the listing of submissions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="n">AbstractForm</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.edit_handlers</span> <span class="kn">import</span> <span class="n">FormSubmissionsPanel</span>

<span class="k">class</span> <span class="nc">ContactFormPage</span><span class="p">(</span><span class="n">AbstractForm</span><span class="p">):</span>
    <span class="n">content_panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FormSubmissionsPanel</span><span class="p">(),</span>
    <span class="p">]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-wagtail.documents.edit_handlers">
<span id="documentchooserpanel"></span><h7>DocumentChooserPanel<a class="headerlink" href="#module-wagtail.documents.edit_handlers" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.documents.edit_handlers.DocumentChooserPanel">
<em class="property">class </em><code class="descclassname">wagtail.documents.edit_handlers.</code><code class="descname">DocumentChooserPanel</code><span class="sig-paren">(</span><em>field_name</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.documents.edit_handlers.DocumentChooserPanel" title="Permalink to this definition">¶</a></dt>
<dd><p>For files in other formats, Wagtail provides a generic file store through the <code class="xref py py-class docutils literal notranslate"><span class="pre">Document</span></code> model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.documents.models</span> <span class="kn">import</span> <span class="n">Document</span>
<span class="kn">from</span> <span class="nn">wagtail.documents.edit_handlers</span> <span class="kn">import</span> <span class="n">DocumentChooserPanel</span>


<span class="k">class</span> <span class="nc">BookPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">book_file</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;wagtaildocs.Document&#39;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span>
    <span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">DocumentChooserPanel</span><span class="p">(</span><span class="s1">&#39;book_file&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>As with images, Wagtail documents should also have the appropriate extra parameters to prevent cascade deletions across a ForeignKey relationship. <code class="docutils literal notranslate"><span class="pre">DocumentChooserPanel</span></code> takes only one argument: the name of the field.</p>
</dd></dl>

</div>
<div class="section" id="module-wagtail.snippets.edit_handlers">
<span id="snippetchooserpanel"></span><h7>SnippetChooserPanel<a class="headerlink" href="#module-wagtail.snippets.edit_handlers" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.snippets.edit_handlers.SnippetChooserPanel">
<em class="property">class </em><code class="descclassname">wagtail.snippets.edit_handlers.</code><code class="descname">SnippetChooserPanel</code><span class="sig-paren">(</span><em>field_name</em>, <em>snippet_type=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.snippets.edit_handlers.SnippetChooserPanel" title="Permalink to this definition">¶</a></dt>
<dd><p>Snippets are vanilla Django models you create yourself without a Wagtail-provided base class. A chooser, <code class="docutils literal notranslate"><span class="pre">SnippetChooserPanel</span></code>, is provided which takes the field name as an argument.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.snippets.edit_handlers</span> <span class="kn">import</span> <span class="n">SnippetChooserPanel</span>

<span class="k">class</span> <span class="nc">BookPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">advert</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;demo.Advert&#39;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span>
    <span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">SnippetChooserPanel</span><span class="p">(</span><span class="s1">&#39;advert&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#snippets"><span class="std std-ref">Snippets</span></a> for more information.</p>
</dd></dl>

</div>
</div>
<div class="section" id="field-customisation">
<h6>Field Customisation<a class="headerlink" href="#field-customisation" title="Permalink to this headline">¶</a></h6>
<p>By adding CSS classes to your panel definitions or adding extra parameters to your field definitions, you can control much of how your fields will display in the Wagtail page editing interface. Wagtail’s page editing interface takes much of its behaviour from Django’s admin, so you may find many options for customisation covered there. (See <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/fields/" title="(in Django v3.2)"><span class="xref std std-doc">Django model field reference</span></a>).</p>
<div class="section" id="full-width-input">
<h7>Full-Width Input<a class="headerlink" href="#full-width-input" title="Permalink to this headline">¶</a></h7>
<p>Use <code class="docutils literal notranslate"><span class="pre">classname=&quot;full&quot;</span></code> to make a field (input element) stretch the full width of the Wagtail page editor. This will not work if the field is encapsulated in a <a class="reference internal" href="#wagtail.admin.edit_handlers.MultiFieldPanel" title="wagtail.admin.edit_handlers.MultiFieldPanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiFieldPanel</span></code></a>, which places its child fields into a formset.</p>
</div>
<div class="section" id="titles">
<h7>Titles<a class="headerlink" href="#titles" title="Permalink to this headline">¶</a></h7>
<p>Use <code class="docutils literal notranslate"><span class="pre">classname=&quot;title&quot;</span></code> to make Page’s built-in title field stand out with more vertical padding.</p>
</div>
<div class="section" id="collapsible">
<span id="id1"></span><h7>Collapsible<a class="headerlink" href="#collapsible" title="Permalink to this headline">¶</a></h7>
<p>By default, panels are expanded and not collapsible.
Use <code class="docutils literal notranslate"><span class="pre">classname=&quot;collapsible&quot;</span></code> to enable the collapse control.
Use <code class="docutils literal notranslate"><span class="pre">classname=&quot;collapsible</span> <span class="pre">collapsed&quot;</span></code> will load the editor page with the panel collapsed under its heading.</p>
<p>You must define a <code class="docutils literal notranslate"><span class="pre">heading</span></code> when using <code class="docutils literal notranslate"><span class="pre">collapsible</span></code> with <code class="docutils literal notranslate"><span class="pre">MultiFieldPanel</span></code>.
You must define a <code class="docutils literal notranslate"><span class="pre">heading</span></code> or <code class="docutils literal notranslate"><span class="pre">label</span></code> when using <code class="docutils literal notranslate"><span class="pre">collapsible</span></code> with <code class="docutils literal notranslate"><span class="pre">InlinePanel</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">content_panels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">MultiFieldPanel</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">ImageChooserPanel</span><span class="p">(</span><span class="s1">&#39;cover&#39;</span><span class="p">),</span>
            <span class="n">DocumentChooserPanel</span><span class="p">(</span><span class="s1">&#39;book_file&#39;</span><span class="p">),</span>
            <span class="n">PageChooserPanel</span><span class="p">(</span><span class="s1">&#39;publisher&#39;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">heading</span><span class="o">=</span><span class="s2">&quot;Collection of Book Fields&quot;</span><span class="p">,</span>
        <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;collapsible collapsed&quot;</span>
    <span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="placeholder-text">
<h7>Placeholder Text<a class="headerlink" href="#placeholder-text" title="Permalink to this headline">¶</a></h7>
<p>By default, Wagtail uses the field’s label as placeholder text. To change it, pass to the FieldPanel a widget with a placeholder attribute set to your desired text. You can select widgets from <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/forms/widgets/" title="(in Django v3.2)"><span class="xref std std-doc">Django’s form widgets</span></a>, or any of the Wagtail’s widgets found in <code class="docutils literal notranslate"><span class="pre">wagtail.admin.widgets</span></code>.</p>
<p>For example, to customize placeholders for a Book model exposed via ModelAdmin:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># models.py</span>
<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>            <span class="c1"># the default Django widgets live here</span>
<span class="kn">from</span> <span class="nn">wagtail.admin</span> <span class="kn">import</span> <span class="n">widgets</span>   <span class="c1"># to use Wagtail&#39;s special datetime widget</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">release_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># you can create them separately</span>
    <span class="n">title_widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;Enter Full Title&#39;</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="c1"># using the correct widget for your field type and desired effect</span>
    <span class="n">date_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">AdminDateInput</span><span class="p">(</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;dd-mm-yyyy&#39;</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">title_widget</span><span class="p">),</span> <span class="c1"># then add them as a variable</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;release_date&#39;</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">date_widget</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">NumberInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;Retail price on release&#39;</span><span class="p">}))</span> <span class="c1"># or directly inline</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="required-fields">
<h7>Required Fields<a class="headerlink" href="#required-fields" title="Permalink to this headline">¶</a></h7>
<p>To make input or chooser selection mandatory for a field, add <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/fields/#django.db.models.Field.blank" title="(in Django v3.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">blank=False</span></code></a> to its model definition.</p>
</div>
<div class="section" id="hiding-fields">
<h7>Hiding Fields<a class="headerlink" href="#hiding-fields" title="Permalink to this headline">¶</a></h7>
<p>Without a panel definition, a default form field (without label) will be used to represent your fields. If you intend to hide a field on the Wagtail page editor, define the field with <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/fields/#django.db.models.Field.editable" title="(in Django v3.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">editable=False</span></code></a>.</p>
</div>
</div>
<div class="section" id="inline-panels-and-model-clusters">
<span id="inline-panels"></span><h6>Inline Panels and Model Clusters<a class="headerlink" href="#inline-panels-and-model-clusters" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">django-modelcluster</span></code> module allows for streamlined relation of extra models to a Wagtail page via a ForeignKey-like relationship called <code class="docutils literal notranslate"><span class="pre">ParentalKey</span></code>.  Normally, your related objects “cluster” would need to be created beforehand (or asynchronously) before being linked to a Page; however, objects related to a Wagtail page via <code class="docutils literal notranslate"><span class="pre">ParentalKey</span></code> can be created on-the-fly and saved to a draft revision of a <code class="docutils literal notranslate"><span class="pre">Page</span></code> object.</p>
<p>Let’s look at the example of adding related links to a <a class="reference internal" href="index.html#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a>-derived model. We want to be able to add as many as we like, assign an order, and do all of this without leaving the page editing screen.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Orderable</span><span class="p">,</span> <span class="n">Page</span>
<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>

<span class="c1"># The abstract model for related links, complete with panels</span>
<span class="k">class</span> <span class="nc">RelatedLink</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">link_external</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="s2">&quot;External link&quot;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;link_external&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># The real model which combines the abstract model, an</span>
<span class="c1"># Orderable helper class, and what amounts to a ForeignKey link</span>
<span class="c1"># to the model we want to add related links to (BookPage)</span>
<span class="k">class</span> <span class="nc">BookPageRelatedLinks</span><span class="p">(</span><span class="n">Orderable</span><span class="p">,</span> <span class="n">RelatedLink</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;demo.BookPage&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;related_links&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BookPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
  <span class="c1"># ...</span>

  <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
    <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;related_links&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Related Links&quot;</span><span class="p">),</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">RelatedLink</span></code> class is a vanilla Django abstract model. The <code class="docutils literal notranslate"><span class="pre">BookPageRelatedLinks</span></code> model extends it with capability for being ordered in the Wagtail interface via the <code class="docutils literal notranslate"><span class="pre">Orderable</span></code> class as well as adding a <code class="docutils literal notranslate"><span class="pre">page</span></code> property which links the model to the <code class="docutils literal notranslate"><span class="pre">BookPage</span></code> model we’re adding the related links objects to. Finally, in the panel definitions for <code class="docutils literal notranslate"><span class="pre">BookPage</span></code>, we’ll add an <a class="reference internal" href="#wagtail.admin.edit_handlers.InlinePanel" title="wagtail.admin.edit_handlers.InlinePanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">InlinePanel</span></code></a> to provide an interface for it all. Let’s look again at the parameters that <a class="reference internal" href="#wagtail.admin.edit_handlers.InlinePanel" title="wagtail.admin.edit_handlers.InlinePanel"><code class="xref py py-class docutils literal notranslate"><span class="pre">InlinePanel</span></code></a> accepts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">InlinePanel</span><span class="p">(</span> <span class="n">relation_name</span><span class="p">,</span> <span class="n">panels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">min_num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_num</span><span class="o">=</span><span class="kc">None</span> <span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">relation_name</span></code> is the <code class="docutils literal notranslate"><span class="pre">related_name</span></code> label given to the cluster’s <code class="docutils literal notranslate"><span class="pre">ParentalKey</span></code> relation. You can add the <code class="docutils literal notranslate"><span class="pre">panels</span></code> manually or make them part of the cluster model. <code class="docutils literal notranslate"><span class="pre">heading</span></code> and <code class="docutils literal notranslate"><span class="pre">help_text</span></code> provide a heading and caption, respectively, for the Wagtail editor. <code class="docutils literal notranslate"><span class="pre">label</span></code> sets the text on the add button, and is used as the heading when <code class="docutils literal notranslate"><span class="pre">heading</span></code> is not present. Finally, <code class="docutils literal notranslate"><span class="pre">min_num</span></code> and <code class="docutils literal notranslate"><span class="pre">max_num</span></code> allow you to set the minimum/maximum number of forms that the user must submit.</p>
<p>For another example of using model clusters, see <a class="reference internal" href="index.html#tagging"><span class="std std-ref">Tagging</span></a></p>
<p>For more on <code class="docutils literal notranslate"><span class="pre">django-modelcluster</span></code>, visit <a class="reference external" href="https://github.com/torchbox/django-modelcluster">the django-modelcluster github project page</a>.</p>
</div>
</div>
<span id="document-reference/pages/model_reference"></span><div class="section" id="module-wagtail.core.models">
<span id="model-reference"></span><h5>Model Reference<a class="headerlink" href="#module-wagtail.core.models" title="Permalink to this headline">¶</a></h5>
<p>wagtail.core.models is split into submodules for maintainability. All definitions intended as
public should be imported here (with ‘noqa’ comments as required) and outside code should continue
to import them from wagtail.core.models (e.g. <cite>from wagtail.core.models import Site</cite>, not
<cite>from wagtail.core.models.sites import Site</cite>.)</p>
<p>Submodules should take care to keep the direction of dependencies consistent; where possible they
should implement low-level generic functionality which is then imported by higher-level models such
as Page.</p>
<p>This document contains reference information for the model classes inside the <code class="docutils literal notranslate"><span class="pre">wagtailcore</span></code> module.</p>
<div class="section" id="page">
<span id="page-model-ref"></span><h6><code class="docutils literal notranslate"><span class="pre">Page</span></code><a class="headerlink" href="#page" title="Permalink to this headline">¶</a></h6>
<div class="section" id="database-fields">
<h7>Database fields<a class="headerlink" href="#database-fields" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.Page">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">Page</code><a class="headerlink" href="#wagtail.core.models.Page" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.Page.title">
<code class="descname">title</code><a class="headerlink" href="#wagtail.core.models.Page.title" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>Human-readable title of the page.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.draft_title">
<code class="descname">draft_title</code><a class="headerlink" href="#wagtail.core.models.Page.draft_title" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>Human-readable title of the page, incorporating any changes that have been made in a draft edit (in contrast to the <code class="docutils literal notranslate"><span class="pre">title</span></code> field, which for published pages will be the title as it exists in the current published version).</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.slug">
<code class="descname">slug</code><a class="headerlink" href="#wagtail.core.models.Page.slug" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>This is used for constructing the page’s URL.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">http://domain.com/blog/[my-slug]/</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.content_type">
<code class="descname">content_type</code><a class="headerlink" href="#wagtail.core.models.Page.content_type" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">django.contrib.contenttypes.models.ContentType</span></code>)</p>
<p>A foreign key to the <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/contrib/contenttypes/#django.contrib.contenttypes.models.ContentType" title="(in Django v3.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContentType</span></code></a> object that represents the specific model of this page.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.live">
<code class="descname">live</code><a class="headerlink" href="#wagtail.core.models.Page.live" title="Permalink to this definition">¶</a></dt>
<dd><p>(boolean)</p>
<p>A boolean that is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> if the page is published.</p>
<p>Note: this field defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code> meaning that any pages that are created programmatically will be published by default.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.has_unpublished_changes">
<code class="descname">has_unpublished_changes</code><a class="headerlink" href="#wagtail.core.models.Page.has_unpublished_changes" title="Permalink to this definition">¶</a></dt>
<dd><p>(boolean)</p>
<p>A boolean that is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> when the page is either in draft or published with draft changes.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.owner">
<code class="descname">owner</code><a class="headerlink" href="#wagtail.core.models.Page.owner" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to user model)</p>
<p>A foreign key to the user that created the page.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.first_published_at">
<code class="descname">first_published_at</code><a class="headerlink" href="#wagtail.core.models.Page.first_published_at" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>The date/time when the page was first published.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.last_published_at">
<code class="descname">last_published_at</code><a class="headerlink" href="#wagtail.core.models.Page.last_published_at" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>The date/time when the page was last published.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.seo_title">
<code class="descname">seo_title</code><a class="headerlink" href="#wagtail.core.models.Page.seo_title" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>Alternate SEO-crafted title, for use in the page’s <code class="docutils literal notranslate"><span class="pre">&lt;title&gt;</span></code> HTML tag.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.search_description">
<code class="descname">search_description</code><a class="headerlink" href="#wagtail.core.models.Page.search_description" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>SEO-crafted description of the content, used for search indexing. This is also suitable for the page’s <code class="docutils literal notranslate"><span class="pre">&lt;meta</span> <span class="pre">name=&quot;description&quot;&gt;</span></code> HTML tag.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.show_in_menus">
<code class="descname">show_in_menus</code><a class="headerlink" href="#wagtail.core.models.Page.show_in_menus" title="Permalink to this definition">¶</a></dt>
<dd><p>(boolean)</p>
<p>Toggles whether the page should be included in site-wide menus.</p>
<p>This is used by the <a class="reference internal" href="index.html#wagtail.core.query.PageQuerySet.in_menu" title="wagtail.core.query.PageQuerySet.in_menu"><code class="xref py py-meth docutils literal notranslate"><span class="pre">in_menu()</span></code></a> QuerySet filter.</p>
<p>Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code> and can be overridden on the model with <code class="docutils literal notranslate"><span class="pre">show_in_menus_default</span> <span class="pre">=</span> <span class="pre">True</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To set the global default for all pages, set <code class="docutils literal notranslate"><span class="pre">Page.show_in_menus_default</span> <span class="pre">=</span> <span class="pre">True</span></code> once where you first import the <code class="docutils literal notranslate"><span class="pre">Page</span></code> model.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.locked">
<code class="descname">locked</code><a class="headerlink" href="#wagtail.core.models.Page.locked" title="Permalink to this definition">¶</a></dt>
<dd><p>(boolean)</p>
<p>When set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the Wagtail editor will not allow any users to edit
the content of the page.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">locked_by</span></code> is also set, only that user can edit the page.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.locked_by">
<code class="descname">locked_by</code><a class="headerlink" href="#wagtail.core.models.Page.locked_by" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to user model)</p>
<p>The user who has currently locked the page. Only this user can edit the page.</p>
<p>If this is <code class="docutils literal notranslate"><span class="pre">None</span></code> when <code class="docutils literal notranslate"><span class="pre">locked</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, nobody can edit the page.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.locked_at">
<code class="descname">locked_at</code><a class="headerlink" href="#wagtail.core.models.Page.locked_at" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>The date/time when the page was locked.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.alias_of">
<code class="descname">alias_of</code><a class="headerlink" href="#wagtail.core.models.Page.alias_of" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to another page)</p>
<p>If set, this page is an alias of the page referenced in this field.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.locale">
<code class="descname">locale</code><a class="headerlink" href="#wagtail.core.models.Page.locale" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to Locale)</p>
<p>This foreign key links to the <code class="docutils literal notranslate"><span class="pre">Locale</span></code> object that represents the page language.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.translation_key">
<code class="descname">translation_key</code><a class="headerlink" href="#wagtail.core.models.Page.translation_key" title="Permalink to this definition">¶</a></dt>
<dd><p>(uuid)</p>
<p>A UUID that is shared between translations of a page. These are randomly generated
when a new page is created and copied when a translation of a page is made.</p>
<p>A translation_key value can only be used on one page in each locale.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="methods-and-properties">
<h7>Methods and properties<a class="headerlink" href="#methods-and-properties" title="Permalink to this headline">¶</a></h7>
<p>In addition to the model fields provided, <code class="docutils literal notranslate"><span class="pre">Page</span></code> has many properties and methods that you may wish to reference, use, or override in creating your own models.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See also <a class="reference external" href="https://django-treebeard.readthedocs.io/en/latest/index.html">django-treebeard</a>’s <a class="reference external" href="https://django-treebeard.readthedocs.io/en/latest/api.html">node API</a>. <code class="docutils literal notranslate"><span class="pre">Page</span></code> is a subclass of <a class="reference external" href="https://django-treebeard.readthedocs.io/en/latest/mp_tree.html">materialized path tree</a> nodes.</p>
</div>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">Page</code></dt>
<dd><dl class="method">
<dt id="wagtail.core.models.Page.get_specific">
<code class="descname">get_specific</code><span class="sig-paren">(</span><em>deferred=False</em>, <em>copy_attrs=None</em>, <em>copy_attrs_exclude=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_specific" title="Permalink to this definition">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified">New in version 2.12.</span></p>
</div>
<p>Return this page in its most specific subclassed form.</p>
<div class="versionchanged">
<p><span class="versionmodified">Changed in version 2.13: </span>* When <code class="docutils literal notranslate"><span class="pre">copy_attrs</span></code> is not supplied, all known non-field attribute
  values are copied to the returned object. Previously, no non-field
  values would be copied.
* The <code class="docutils literal notranslate"><span class="pre">copy_attrs_exclude</span></code> option was added.</p>
</div>
<p>By default, a database query is made to fetch all field values for the
specific object. If you only require access to custom methods or other
non-field attributes on the specific object, you can use
<code class="docutils literal notranslate"><span class="pre">deferred=True</span></code> to avoid this query. However, any attempts to access
specific field values from the returned object will trigger additional
database queries.</p>
<p>By default, references to all non-field attribute values are copied
from current object to the returned one. This includes:</p>
<ul class="simple">
<li>Values set by a queryset, for example: annotations, or values set as
a result of using <code class="docutils literal notranslate"><span class="pre">select_related()</span></code> or <code class="docutils literal notranslate"><span class="pre">prefetch_related()</span></code>.</li>
<li>Any <code class="docutils literal notranslate"><span class="pre">cached_property</span></code> values that have been evaluated.</li>
<li>Attributes set elsewhere in Python code.</li>
</ul>
<p>For fine-grained control over which non-field values are copied to the
returned object, you can use <code class="docutils literal notranslate"><span class="pre">copy_attrs</span></code> to specify a complete list
of attribute names to include. Alternatively, you can use
<code class="docutils literal notranslate"><span class="pre">copy_attrs_exclude</span></code> to specify a list of attribute names to exclude.</p>
<p>If called on a page object that is already an instance of the most
specific class (e.g. an <code class="docutils literal notranslate"><span class="pre">EventPage</span></code>), the object will be returned
as is, and no database queries or other operations will be triggered.</p>
<p>If the page was originally created using a page type that has since
been removed from the codebase, a generic <code class="docutils literal notranslate"><span class="pre">Page</span></code> object will be
returned (without any custom field values or other functionality
present on the original class). Usually, deleting these pages is the
best course of action, but there is currently no safe way for Wagtail
to do that at migration time.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.specific">
<code class="descname">specific</code><a class="headerlink" href="#wagtail.core.models.Page.specific" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns this page in its most specific subclassed form with all field
values fetched from the database. The result is cached in memory.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.specific_deferred">
<code class="descname">specific_deferred</code><a class="headerlink" href="#wagtail.core.models.Page.specific_deferred" title="Permalink to this definition">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified">New in version 2.12.</span></p>
</div>
<p>Returns this page in its most specific subclassed form without any
additional field values being fetched from the database. The result
is cached in memory.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.specific_class">
<code class="descname">specific_class</code><a class="headerlink" href="#wagtail.core.models.Page.specific_class" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the class that this page would be if instantiated in its
most specific form.</p>
<p>If the model class can no longer be found in the codebase, and the
relevant <code class="docutils literal notranslate"><span class="pre">ContentType</span></code> has been removed by a database migration,
the return value will be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>If the model class can no longer be found in the codebase, but the
relevant <code class="docutils literal notranslate"><span class="pre">ContentType</span></code> is still present in the database (usually a
result of switching between git branches without running or reverting
database migrations beforehand), the return value will be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.cached_content_type">
<code class="descname">cached_content_type</code><a class="headerlink" href="#wagtail.core.models.Page.cached_content_type" title="Permalink to this definition">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified">New in version 2.10.</span></p>
</div>
<p>Return this page’s <code class="docutils literal notranslate"><span class="pre">content_type</span></code> value from the <code class="docutils literal notranslate"><span class="pre">ContentType</span></code>
model’s cached manager, which will avoid a database query if the
object is already in memory.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_url">
<code class="descname">get_url</code><span class="sig-paren">(</span><em>request=None</em>, <em>current_site=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the ‘most appropriate’ URL for referring to this page from the pages we serve,
within the Wagtail backend and actual website templates;
this is the local URL (starting with ‘/’) if we’re only running a single site
(i.e. we know that whatever the current page is being served from, this link will be on the
same domain), and the full URL (with domain) if not.
Return None if the page is not routable.</p>
<p>Accepts an optional but recommended <code class="docutils literal notranslate"><span class="pre">request</span></code> keyword argument that, if provided, will
be used to cache site-level URL information (thereby avoiding repeated database / cache
lookups) and, via the <code class="docutils literal notranslate"><span class="pre">Site.find_for_request()</span></code> function, determine whether a relative
or full URL is most appropriate.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_full_url">
<code class="descname">get_full_url</code><span class="sig-paren">(</span><em>request=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_full_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the full URL (including protocol / domain) to this page, or None if it is not routable</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.full_url">
<code class="descname">full_url</code><a class="headerlink" href="#wagtail.core.models.Page.full_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the full URL (including protocol / domain) to this page, or None if it is not routable</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.relative_url">
<code class="descname">relative_url</code><span class="sig-paren">(</span><em>current_site</em>, <em>request=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.relative_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the ‘most appropriate’ URL for this page taking into account the site we’re currently on;
a local URL if the site matches, or a fully qualified one otherwise.
Return None if the page is not routable.</p>
<p>Accepts an optional but recommended <code class="docutils literal notranslate"><span class="pre">request</span></code> keyword argument that, if provided, will
be used to cache site-level URL information (thereby avoiding repeated database / cache
lookups).</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_site">
<code class="descname">get_site</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_site" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the Site object that this page belongs to.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_url_parts">
<code class="descname">get_url_parts</code><span class="sig-paren">(</span><em>request=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_url_parts" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine the URL for this page and return it as a tuple of
<code class="docutils literal notranslate"><span class="pre">(site_id,</span> <span class="pre">site_root_url,</span> <span class="pre">page_url_relative_to_site_root)</span></code>.
Return None if the page is not routable.</p>
<p>This is used internally by the <code class="docutils literal notranslate"><span class="pre">full_url</span></code>, <code class="docutils literal notranslate"><span class="pre">url</span></code>, <code class="docutils literal notranslate"><span class="pre">relative_url</span></code>
and <code class="docutils literal notranslate"><span class="pre">get_site</span></code> properties and methods; pages with custom URL routing
should override this method in order to have those operations return
the custom URLs.</p>
<p>Accepts an optional keyword argument <code class="docutils literal notranslate"><span class="pre">request</span></code>, which may be used
to avoid repeated database / cache lookups. Typically, a page model
that overrides <code class="docutils literal notranslate"><span class="pre">get_url_parts</span></code> should not need to deal with
<code class="docutils literal notranslate"><span class="pre">request</span></code> directly, and should just pass it to the original method
when calling <code class="docutils literal notranslate"><span class="pre">super</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.route">
<code class="descname">route</code><span class="sig-paren">(</span><em>request</em>, <em>path_components</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.route" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.serve">
<code class="descname">serve</code><span class="sig-paren">(</span><em>request</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.serve" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.context_object_name">
<code class="descname">context_object_name</code><em class="property"> = None</em><a class="headerlink" href="#wagtail.core.models.Page.context_object_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Custom name for page instance in page’s <code class="docutils literal notranslate"><span class="pre">Context</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_context">
<code class="descname">get_context</code><span class="sig-paren">(</span><em>request</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_context" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_template">
<code class="descname">get_template</code><span class="sig-paren">(</span><em>request</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_template" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_admin_display_title">
<code class="descname">get_admin_display_title</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_admin_display_title" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the title for this page as it should appear in the admin backend;
override this if you wish to display extra contextual information about the page,
such as language. By default, returns <code class="docutils literal notranslate"><span class="pre">draft_title</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.preview_modes">
<code class="descname">preview_modes</code><a class="headerlink" href="#wagtail.core.models.Page.preview_modes" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of (internal_name, display_name) tuples for the modes in which
this page can be displayed for preview/moderation purposes. Ordinarily a page
will only have one display mode, but subclasses of Page can override this -
for example, a page containing a form might have a default view of the form,
and a post-submission ‘thank you’ page</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.serve_preview">
<code class="descname">serve_preview</code><span class="sig-paren">(</span><em>request</em>, <em>mode_name</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.serve_preview" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an HTTP response for use in page previews. Normally this would be equivalent
to self.serve(request), since we obviously want the preview to be indicative of how
it looks on the live site. However, there are a couple of cases where this is not
appropriate, and custom behaviour is required:</p>
<p>1) The page has custom routing logic that derives some additional required
args/kwargs to be passed to serve(). The routing mechanism is bypassed when
previewing, so there’s no way to know what args we should pass. In such a case,
the page model needs to implement its own version of serve_preview.</p>
<p>2) The page has several different renderings that we would like to be able to see
when previewing - for example, a form page might have one rendering that displays
the form, and another rendering to display a landing page when the form is posted.
This can be done by setting a custom preview_modes list on the page model -
Wagtail will allow the user to specify one of those modes when previewing, and
pass the chosen mode_name to serve_preview so that the page model can decide how
to render it appropriately. (Page models that do not specify their own preview_modes
list will always receive an empty string as mode_name.)</p>
<p>Any templates rendered during this process should use the ‘request’ object passed
here - this ensures that request.user and other properties are set appropriately for
the wagtail user bar to be displayed. This request will always be a GET.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_parent">
<code class="descname">get_parent</code><span class="sig-paren">(</span><em>update=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_parent" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the parent node of the current node object.
Caches the result in the object itself to help in loops.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_ancestors">
<code class="descname">get_ancestors</code><span class="sig-paren">(</span><em>inclusive=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_ancestors" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a queryset of the current page’s ancestors, starting at the root page
and descending to the parent, or to the current page itself if <code class="docutils literal notranslate"><span class="pre">inclusive</span></code> is true.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_descendants">
<code class="descname">get_descendants</code><span class="sig-paren">(</span><em>inclusive=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_descendants" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a queryset of all pages underneath the current page, any number of levels deep.
If <code class="docutils literal notranslate"><span class="pre">inclusive</span></code> is true, the current page itself is included in the queryset.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_siblings">
<code class="descname">get_siblings</code><span class="sig-paren">(</span><em>inclusive=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_siblings" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a queryset of all other pages with the same parent as the current page.
If <code class="docutils literal notranslate"><span class="pre">inclusive</span></code> is true, the current page itself is included in the queryset.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_translations">
<code class="descname">get_translations</code><span class="sig-paren">(</span><em>inclusive=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_translations" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a queryset containing the translations of this instance.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_translation">
<code class="descname">get_translation</code><span class="sig-paren">(</span><em>locale</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_translation" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the translation in the specified locale.</p>
<p>If there is no translation in that locale, this raises a <code class="docutils literal notranslate"><span class="pre">model.DoesNotExist</span></code> exception.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_translation_or_none">
<code class="descname">get_translation_or_none</code><span class="sig-paren">(</span><em>locale</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_translation_or_none" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the translation in the specified locale.</p>
<p>If there is no translation in that locale, this returns None.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.has_translation">
<code class="descname">has_translation</code><span class="sig-paren">(</span><em>locale</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.has_translation" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if a translation exists in the specified locale.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.copy_for_translation">
<code class="descname">copy_for_translation</code><span class="sig-paren">(</span><em>locale</em>, <em>copy_parents=False</em>, <em>alias=False</em>, <em>exclude_fields=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.copy_for_translation" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a copy of this page in the specified locale.</p>
<p>The new page will be created in draft as a child of this page’s translated
parent.</p>
<p>For example, if you are translating a blog post from English into French,
this method will look for the French version of the blog index and create
the French translation of the blog post under that.</p>
<p>If this page’s parent is not translated into the locale, then a <code class="docutils literal notranslate"><span class="pre">ParentNotTranslatedError</span></code>
is raised. You can circumvent this error by passing <code class="docutils literal notranslate"><span class="pre">copy_parents=True</span></code> which
copies any parents that are not translated yet.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">exclude_fields</span></code> parameter can be used to set any fields to a blank value
in the copy.</p>
<p>Note that this method calls the <code class="docutils literal notranslate"><span class="pre">.copy()</span></code> method internally so any fields that
are excluded in <code class="docutils literal notranslate"><span class="pre">.exclude_fields_in_copy</span></code> will be excluded from the translation.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.localized">
<code class="descname">localized</code><a class="headerlink" href="#wagtail.core.models.Page.localized" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the translation in the current active language.</p>
<p>If there is no translation in the active language, self is returned.</p>
<p>Note: This will not return the translation if it is in draft.
If you want to include drafts, use the <code class="docutils literal notranslate"><span class="pre">.localized_draft</span></code> attribute instead.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.localized_draft">
<code class="descname">localized_draft</code><a class="headerlink" href="#wagtail.core.models.Page.localized_draft" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the translation in the current active language.</p>
<p>If there is no translation in the active language, self is returned.</p>
<p>Note: This will return translations that are in draft. If you want to exclude
these, use the <code class="docutils literal notranslate"><span class="pre">.localized</span></code> attribute.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.search_fields">
<code class="descname">search_fields</code><a class="headerlink" href="#wagtail.core.models.Page.search_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of fields to be indexed by the search engine. See Search docs <a class="reference internal" href="index.html#wagtailsearch-indexing-fields"><span class="std std-ref">Indexing extra fields</span></a></p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.subpage_types">
<code class="descname">subpage_types</code><a class="headerlink" href="#wagtail.core.models.Page.subpage_types" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of page models which can be created as children of this page type. For example, a <code class="docutils literal notranslate"><span class="pre">BlogIndex</span></code> page might allow a <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> as a child, but not a <code class="docutils literal notranslate"><span class="pre">JobPage</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogIndex</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">subpage_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mysite.BlogPage&#39;</span><span class="p">,</span> <span class="s1">&#39;mysite.BlogArchivePage&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The creation of child pages can be blocked altogether for a given page by setting its subpage_types attribute to an empty array:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">subpage_types</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.parent_page_types">
<code class="descname">parent_page_types</code><a class="headerlink" href="#wagtail.core.models.Page.parent_page_types" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of page models which are allowed as parent page types. For example, a <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code> may only allow itself to be created below the <code class="docutils literal notranslate"><span class="pre">BlogIndex</span></code> page:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">parent_page_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mysite.BlogIndexPage&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Pages can block themselves from being created at all by setting parent_page_types to an empty array (this is useful for creating unique pages that should only be created once):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HiddenPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">parent_page_types</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>To allow for a page to be only created under the root page (e.g. for <code class="docutils literal notranslate"><span class="pre">HomePage</span></code> models) set the <code class="docutils literal notranslate"><span class="pre">parent_page_type</span></code> to <code class="docutils literal notranslate"><span class="pre">['wagtailcore.Page']</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HomePage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">parent_page_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;wagtailcore.Page&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="wagtail.core.models.Page.can_exist_under">
<em class="property">classmethod </em><code class="descname">can_exist_under</code><span class="sig-paren">(</span><em>parent</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.can_exist_under" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if this page type can exist as a subpage under a parent page
instance.</p>
<p>See also: <a class="reference internal" href="#wagtail.core.models.Page.can_create_at" title="wagtail.core.models.Page.can_create_at"><code class="xref py py-func docutils literal notranslate"><span class="pre">Page.can_create_at()</span></code></a> and <a class="reference internal" href="#wagtail.core.models.Page.can_move_to" title="wagtail.core.models.Page.can_move_to"><code class="xref py py-func docutils literal notranslate"><span class="pre">Page.can_move_to()</span></code></a></p>
</dd></dl>

<dl class="classmethod">
<dt id="wagtail.core.models.Page.can_create_at">
<em class="property">classmethod </em><code class="descname">can_create_at</code><span class="sig-paren">(</span><em>parent</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.can_create_at" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if this page type can be created as a subpage under a parent
page instance.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.can_move_to">
<code class="descname">can_move_to</code><span class="sig-paren">(</span><em>parent</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.can_move_to" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if this page instance can be moved to be a subpage of a parent
page instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.password_required_template">
<code class="descname">password_required_template</code><a class="headerlink" href="#wagtail.core.models.Page.password_required_template" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines which template file should be used to render the login form for Protected pages using this model. This overrides the default, defined using <code class="docutils literal notranslate"><span class="pre">PASSWORD_REQUIRED_TEMPLATE</span></code> in your settings. See <a class="reference internal" href="index.html#private-pages"><span class="std std-ref">Private pages</span></a></p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.is_creatable">
<code class="descname">is_creatable</code><a class="headerlink" href="#wagtail.core.models.Page.is_creatable" title="Permalink to this definition">¶</a></dt>
<dd><p>Controls if this page can be created through the Wagtail administration. Defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>, and is not inherited by subclasses. This is useful when using <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/db/models/#multi-table-inheritance" title="(in Django v3.2)"><span class="xref std std-ref">multi-table inheritance</span></a>, to stop the base model from being created as an actual page.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.max_count">
<code class="descname">max_count</code><a class="headerlink" href="#wagtail.core.models.Page.max_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Controls the maximum number of pages of this type that can be created through the Wagtail administration interface. This is useful when needing “allow at most 3 of these pages to exist”, or for singleton pages.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.max_count_per_parent">
<code class="descname">max_count_per_parent</code><a class="headerlink" href="#wagtail.core.models.Page.max_count_per_parent" title="Permalink to this definition">¶</a></dt>
<dd><p>Controls the maximum number of pages of this type that can be created under any one parent page.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.exclude_fields_in_copy">
<code class="descname">exclude_fields_in_copy</code><a class="headerlink" href="#wagtail.core.models.Page.exclude_fields_in_copy" title="Permalink to this definition">¶</a></dt>
<dd><p>An array of field names that will not be included when a Page is copied.
Useful when you have relations that do not use <cite>ClusterableModel</cite> or should not be copied.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">exclude_fields_in_copy</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;special_relation&#39;</span><span class="p">,</span> <span class="s1">&#39;custom_uuid&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The following fields will always be excluded in a copy - <cite>[‘id’, ‘path’, ‘depth’, ‘numchild’, ‘url_path’, ‘path’]</cite>.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.base_form_class">
<code class="descname">base_form_class</code><a class="headerlink" href="#wagtail.core.models.Page.base_form_class" title="Permalink to this definition">¶</a></dt>
<dd><p>The form class used as a base for editing Pages of this type in the Wagtail page editor.
This attribute can be set on a model to customise the Page editor form.
Forms must be a subclass of <a class="reference internal" href="index.html#wagtail.admin.forms.WagtailAdminPageForm" title="wagtail.admin.forms.WagtailAdminPageForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">WagtailAdminPageForm</span></code></a>.
See <a class="reference internal" href="index.html#custom-edit-handler-forms"><span class="std std-ref">Customising generated forms</span></a> for more information.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.with_content_json">
<code class="descname">with_content_json</code><span class="sig-paren">(</span><em>content_json</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.with_content_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new version of the page with field values updated to reflect changes
in the provided <code class="docutils literal notranslate"><span class="pre">content_json</span></code> (which usually comes from a previously-saved
page revision).</p>
<p>Certain field values are preserved in order to prevent errors if the returned
page is saved, such as <code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">content_type</span></code> and some tree-related values.
The following field values are also preserved, as they are considered to be
meaningful to the page as a whole, rather than to a specific revision:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">draft_title</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">live</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">has_unpublished_changes</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">owner</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">locked</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">locked_by</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">locked_at</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">latest_revision_created_at</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">first_published_at</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">alias_of</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">comments</span></code></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.save">
<code class="descname">save</code><span class="sig-paren">(</span><em>clean=True</em>, <em>user=None</em>, <em>log_action=False</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Overrides default method behaviour to make additional updates unique to pages,
such as updating the <code class="docutils literal notranslate"><span class="pre">url_path</span></code> value of descendant page to reflect changes
to this page’s slug.</p>
<p>New pages should generally be saved via the <code class="docutils literal notranslate"><span class="pre">add_child()</span></code> or <code class="docutils literal notranslate"><span class="pre">add_sibling()</span></code>
method of an existing page, which will correctly set the <code class="docutils literal notranslate"><span class="pre">path</span></code> and <code class="docutils literal notranslate"><span class="pre">depth</span></code>
fields on the new page before saving it.</p>
<p>By default, pages are validated using <code class="docutils literal notranslate"><span class="pre">full_clean()</span></code> before attempting to
save changes to the database, which helps to preserve validity when restoring
pages from historic revisions (which might not necessarily reflect the current
model state). This validation step can be bypassed by calling the method with
<code class="docutils literal notranslate"><span class="pre">clean=False</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.create_alias">
<code class="descname">create_alias</code><span class="sig-paren">(</span><em>*</em>, <em>recursive=False</em>, <em>parent=None</em>, <em>update_slug=None</em>, <em>update_locale=None</em>, <em>user=None</em>, <em>log_action='wagtail.create_alias'</em>, <em>reset_translation_key=True</em>, <em>_mpnode_attrs=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.create_alias" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an alias of the given page.</p>
<p>An alias is like a copy, but an alias remains in sync with the original page. They
are not directly editable and do not have revisions.</p>
<p>You can convert an alias into a regular page by setting the .alias_of attribute to None
and creating an initial revision.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>recursive</strong> (<em>boolean</em><em>, </em><em>optional</em>) – create aliases of the page’s subtree, defaults to False</li>
<li><strong>parent</strong> (<a class="reference internal" href="index.html#wagtail.core.models.Page" title="wagtail.core.models.Page"><em>Page</em></a><em>, </em><em>optional</em>) – The page to create the new alias under</li>
<li><strong>update_slug</strong> (<em>string</em><em>, </em><em>optional</em>) – The slug of the new alias page, defaults to the slug of the original page</li>
<li><strong>update_locale</strong> (<em>Locale</em><em>, </em><em>optional</em>) – The locale of the new alias page, defaults to the locale of the original page</li>
<li><strong>user</strong> (<em>User</em><em>, </em><em>optional</em>) – The user who is performing this action. This user would be assigned as the owner of the new page and appear in the audit log</li>
<li><strong>log_action</strong> (<em>string</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – Override the log action with a custom one. or pass None to skip logging, defaults to ‘wagtail.create_alias’</li>
<li><strong>reset_translation_key</strong> (<em>boolean</em><em>, </em><em>optional</em>) – Generate new translation_keys for the page and any translatable child objects, defaults to False</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.update_aliases">
<code class="descname">update_aliases</code><span class="sig-paren">(</span><em>*</em>, <em>revision=None</em>, <em>user=None</em>, <em>_content_json=None</em>, <em>_updated_ids=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.update_aliases" title="Permalink to this definition">¶</a></dt>
<dd><p>Publishes all aliases that follow this page with the latest content from this page.</p>
<p>This is called by Wagtail whenever a page with aliases is published.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>revision</strong> (<a class="reference internal" href="index.html#wagtail.core.models.PageRevision" title="wagtail.core.models.PageRevision"><em>PageRevision</em></a><em>, </em><em>optional</em>) – The revision of the original page that we are updating to (used for logging purposes)</li>
<li><strong>user</strong> (<em>User</em><em>, </em><em>optional</em>) – The user who is publishing (used for logging purposes)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.has_workflow">
<code class="descname">has_workflow</code><a class="headerlink" href="#wagtail.core.models.Page.has_workflow" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the page or an ancestor has an active workflow assigned, otherwise False</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Page.get_workflow">
<code class="descname">get_workflow</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Page.get_workflow" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the active workflow assigned to the page or its nearest ancestor</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.workflow_in_progress">
<code class="descname">workflow_in_progress</code><a class="headerlink" href="#wagtail.core.models.Page.workflow_in_progress" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if a workflow is in progress on the current page, otherwise False</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.current_workflow_state">
<code class="descname">current_workflow_state</code><a class="headerlink" href="#wagtail.core.models.Page.current_workflow_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the in progress or needs changes workflow state on this page, if it exists</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.current_workflow_task_state">
<code class="descname">current_workflow_task_state</code><a class="headerlink" href="#wagtail.core.models.Page.current_workflow_task_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns (specific class of) the current task state of the workflow on this page, if it exists</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Page.current_workflow_task">
<code class="descname">current_workflow_task</code><a class="headerlink" href="#wagtail.core.models.Page.current_workflow_task" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns (specific class of) the current task in progress on this page, if it exists</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="site">
<span id="site-model-ref"></span><h6><code class="docutils literal notranslate"><span class="pre">Site</span></code><a class="headerlink" href="#site" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">Site</span></code> model is useful for multi-site installations as it allows an administrator to configure which part of the tree to use for each hostname that the server responds on.</p>
<p>The <a class="reference internal" href="#wagtail.core.models.Site.find_for_request" title="wagtail.core.models.Site.find_for_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_for_request()</span></code></a> function returns the Site object that will handle the given HTTP request.</p>
<div class="section" id="id1">
<h7>Database fields<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.Site">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">Site</code><a class="headerlink" href="#wagtail.core.models.Site" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.Site.hostname">
<code class="descname">hostname</code><a class="headerlink" href="#wagtail.core.models.Site.hostname" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>This is the hostname of the site, excluding the scheme, port and path.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">www.mysite.com</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you’re looking for how to get the root url of a site, use the <a class="reference internal" href="#wagtail.core.models.Site.root_url" title="wagtail.core.models.Site.root_url"><code class="xref py py-attr docutils literal notranslate"><span class="pre">root_url</span></code></a> attribute.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Site.port">
<code class="descname">port</code><a class="headerlink" href="#wagtail.core.models.Site.port" title="Permalink to this definition">¶</a></dt>
<dd><p>(number)</p>
<p>This is the port number that the site responds on.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Site.site_name">
<code class="descname">site_name</code><a class="headerlink" href="#wagtail.core.models.Site.site_name" title="Permalink to this definition">¶</a></dt>
<dd><p>(text - optional)</p>
<p>A human-readable name for the site. This is not used by Wagtail itself, but is suitable for use on the site front-end, such as in <code class="docutils literal notranslate"><span class="pre">&lt;title&gt;</span></code> elements.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">Rod's</span> <span class="pre">World</span> <span class="pre">of</span> <span class="pre">Birds</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Site.root_page">
<code class="descname">root_page</code><a class="headerlink" href="#wagtail.core.models.Site.root_page" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <a class="reference internal" href="#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a>)</p>
<p>This is a link to the root page of the site. This page will be what appears at the <code class="docutils literal notranslate"><span class="pre">/</span></code> URL on the site and would usually be a homepage.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Site.is_default_site">
<code class="descname">is_default_site</code><a class="headerlink" href="#wagtail.core.models.Site.is_default_site" title="Permalink to this definition">¶</a></dt>
<dd><p>(boolean)</p>
<p>This is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> if the site is the default. Only one site can be the default.</p>
<p>The default site is used as a fallback in situations where a site with the required hostname/port couldn’t be found.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id2">
<h7>Methods and properties<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">Site</code></dt>
<dd><dl class="staticmethod">
<dt id="wagtail.core.models.Site.find_for_request">
<em class="property">static </em><code class="descname">find_for_request</code><span class="sig-paren">(</span><em>request</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Site.find_for_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the site object responsible for responding to this HTTP
request object. Try:</p>
<ul class="simple">
<li>unique hostname first</li>
<li>then hostname and port</li>
<li>if there is no matching hostname at all, or no matching
hostname:port combination, fall back to the unique default site,
or raise an exception</li>
</ul>
<p>NB this means that high-numbered ports on an extant hostname may
still be routed to a different hostname which is set as the default</p>
<p>The site will be cached via request._wagtail_site</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Site.root_url">
<code class="descname">root_url</code><a class="headerlink" href="#wagtail.core.models.Site.root_url" title="Permalink to this definition">¶</a></dt>
<dd><p>This returns the URL of the site. It is calculated from the <a class="reference internal" href="#wagtail.core.models.Site.hostname" title="wagtail.core.models.Site.hostname"><code class="xref py py-attr docutils literal notranslate"><span class="pre">hostname</span></code></a> and the <a class="reference internal" href="#wagtail.core.models.Site.port" title="wagtail.core.models.Site.port"><code class="xref py py-attr docutils literal notranslate"><span class="pre">port</span></code></a> fields.</p>
<p>The scheme part of the URL is calculated based on value of the <a class="reference internal" href="#wagtail.core.models.Site.port" title="wagtail.core.models.Site.port"><code class="xref py py-attr docutils literal notranslate"><span class="pre">port</span></code></a> field:</p>
<ul class="simple">
<li>80 = <code class="docutils literal notranslate"><span class="pre">http://</span></code></li>
<li>443 = <code class="docutils literal notranslate"><span class="pre">https://</span></code></li>
<li>Everything else will use the <code class="docutils literal notranslate"><span class="pre">http://</span></code> scheme and the port will be appended to the end of the hostname (eg. <code class="docutils literal notranslate"><span class="pre">http://mysite.com:8000/</span></code>)</li>
</ul>
</dd></dl>

<dl class="staticmethod">
<dt id="wagtail.core.models.Site.get_site_root_paths">
<em class="property">static </em><code class="descname">get_site_root_paths</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Site.get_site_root_paths" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of <cite>SiteRootPath</cite> instances, most specific path
first - used to translate url_paths into actual URLs with hostnames</p>
<p>Each root path is an instance of the <cite>SiteRootPath</cite> named tuple,
and have the following attributes:</p>
<ul class="simple">
<li><cite>site_id</cite> - The ID of the Site record</li>
<li><cite>root_path</cite> - The internal URL path of the site’s home page (for example ‘/home/’)</li>
<li><cite>root_url</cite> - The scheme/domain name of the site (for example ‘<a class="reference external" href="https://www.example.com/">https://www.example.com/</a>’)</li>
<li><cite>language_code</cite> - The language code of the site (for example ‘en’)</li>
</ul>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="locale">
<h6>Locale<a class="headerlink" href="#locale" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">Locale</span></code> model defines the set of languages and/or locales that can be used on a site.
Each <code class="docutils literal notranslate"><span class="pre">Locale</span></code> record corresponds to a “language code” defined in the <a class="reference internal" href="index.html#wagtail-content-languages-setting"><span class="std std-ref">WAGTAIL_CONTENT_LANGUAGES</span></a> setting.</p>
<p>Wagtail will initially set up one <code class="docutils literal notranslate"><span class="pre">Locale</span></code> to act as the default language for all existing content.
This first locale will automatically pick the value from <code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code> that most closely matches the site primary language code defined in <code class="docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code>.
If the primary language code is changed later, Wagtail will <strong>not</strong> automatically create a new <code class="docutils literal notranslate"><span class="pre">Locale</span></code> record or update an existing one.</p>
<p>Before internationalisation is enabled, all pages use this primary <code class="docutils literal notranslate"><span class="pre">Locale</span></code> record.
This is to satisfy the database constraints, and makes it easier to switch internationalisation on at a later date.</p>
<div class="section" id="changing-wagtail-content-languages">
<h7>Changing <code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code><a class="headerlink" href="#changing-wagtail-content-languages" title="Permalink to this headline">¶</a></h7>
<p>Languages can be added or removed from <code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code> over time.</p>
<p>Before removing an option from <code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code>, it’s important that the <code class="docutils literal notranslate"><span class="pre">Locale</span></code>
record is updated to a use a different content language or is deleted.
Any <code class="docutils literal notranslate"><span class="pre">Locale</span></code> instances that have invalid content languages are automatically filtered out from all
database queries making them unable to be edited or viewed.</p>
</div>
<div class="section" id="id3">
<h7>Methods and properties<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">Locale</code></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.Locale.language_code">
<code class="descname">language_code</code><a class="headerlink" href="#wagtail.core.models.Locale.language_code" title="Permalink to this definition">¶</a></dt>
<dd><p>The language code that represents this locale</p>
<p>The language code can either be a language code on its own (such as <code class="docutils literal notranslate"><span class="pre">en</span></code>, <code class="docutils literal notranslate"><span class="pre">fr</span></code>),
or it can include a region code (such as <code class="docutils literal notranslate"><span class="pre">en-gb</span></code>, <code class="docutils literal notranslate"><span class="pre">fr-fr</span></code>).</p>
</dd></dl>

<dl class="classmethod">
<dt id="wagtail.core.models.Locale.get_default">
<em class="property">classmethod </em><code class="descname">get_default</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Locale.get_default" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the default Locale based on the site’s LANGUAGE_CODE setting</p>
</dd></dl>

<dl class="classmethod">
<dt id="wagtail.core.models.Locale.get_active">
<em class="property">classmethod </em><code class="descname">get_active</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Locale.get_active" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the Locale that corresponds to the currently activated language in Django.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Locale.get_display_name">
<code class="descname">get_display_name</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Locale.get_display_name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="translatable-mixin">
<h6>Translatable Mixin<a class="headerlink" href="#translatable-mixin" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">TranslatableMixin</span></code> is an abstract model that can be added to any non-page Django model to make it translatable.
Pages already include this mixin, so there is no need to add it.</p>
<div class="section" id="id4">
<h7>Methods and properties<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h7>
<p>The <code class="docutils literal notranslate"><span class="pre">locale</span></code> and <code class="docutils literal notranslate"><span class="pre">translation_key</span></code> fields have a unique key constraint to prevent the object being translated into a language more than once.</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">TranslatableMixin</code></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.TranslatableMixin.locale">
<code class="descname">locale</code><a class="headerlink" href="#wagtail.core.models.TranslatableMixin.locale" title="Permalink to this definition">¶</a></dt>
<dd><p>(Foreign Key to <code class="xref py py-class docutils literal notranslate"><span class="pre">Locale</span></code>)</p>
<p>For pages, this defaults to the locale of the parent page.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.TranslatableMixin.translation_key">
<code class="descname">translation_key</code><a class="headerlink" href="#wagtail.core.models.TranslatableMixin.translation_key" title="Permalink to this definition">¶</a></dt>
<dd><p>(uuid)</p>
<p>A UUID that is randomly generated whenever a new model instance is created.
This is shared with all translations of that instance so can be used for querying translations.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.TranslatableMixin.get_translations">
<code class="descname">get_translations</code><span class="sig-paren">(</span><em>inclusive=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.TranslatableMixin.get_translations" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a queryset containing the translations of this instance.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.TranslatableMixin.get_translation">
<code class="descname">get_translation</code><span class="sig-paren">(</span><em>locale</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.TranslatableMixin.get_translation" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the translation in the specified locale.</p>
<p>If there is no translation in that locale, this raises a <code class="docutils literal notranslate"><span class="pre">model.DoesNotExist</span></code> exception.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.TranslatableMixin.get_translation_or_none">
<code class="descname">get_translation_or_none</code><span class="sig-paren">(</span><em>locale</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.TranslatableMixin.get_translation_or_none" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the translation in the specified locale.</p>
<p>If there is no translation in that locale, this returns None.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.TranslatableMixin.has_translation">
<code class="descname">has_translation</code><span class="sig-paren">(</span><em>locale</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.TranslatableMixin.has_translation" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if a translation exists in the specified locale.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.TranslatableMixin.copy_for_translation">
<code class="descname">copy_for_translation</code><span class="sig-paren">(</span><em>locale</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.TranslatableMixin.copy_for_translation" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a copy of this instance with the specified locale.</p>
<p>Note that the copy is initially unsaved.</p>
</dd></dl>

<dl class="classmethod">
<dt id="wagtail.core.models.TranslatableMixin.get_translation_model">
<em class="property">classmethod </em><code class="descname">get_translation_model</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.TranslatableMixin.get_translation_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns this model’s “Translation model”.</p>
<p>The “Translation model” is the model that has the <code class="docutils literal notranslate"><span class="pre">locale</span></code> and
<code class="docutils literal notranslate"><span class="pre">translation_key</span></code> fields.
Typically this would be the current model, but it may be a
super-class if multi-table inheritance is in use (as is the case
for <code class="docutils literal notranslate"><span class="pre">wagtailcore.Page</span></code>).</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.TranslatableMixin.localized">
<code class="descname">localized</code><a class="headerlink" href="#wagtail.core.models.TranslatableMixin.localized" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the translation in the current active language.</p>
<p>If there is no translation in the active language, self is returned.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="pagerevision">
<span id="page-revision-model-ref"></span><h6><code class="docutils literal notranslate"><span class="pre">PageRevision</span></code><a class="headerlink" href="#pagerevision" title="Permalink to this headline">¶</a></h6>
<p>Every time a page is edited a new <code class="docutils literal notranslate"><span class="pre">PageRevision</span></code> is created and saved to the database. It can be used to find the full history of all changes that have been made to a page and it also provides a place for new changes to be kept before going live.</p>
<ul class="simple">
<li>Revisions can be created from any <a class="reference internal" href="#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a> object by calling its <code class="xref py py-meth docutils literal notranslate"><span class="pre">save_revision()</span></code> method</li>
<li>The content of the page is JSON-serialised and stored in the <a class="reference internal" href="#wagtail.core.models.PageRevision.content_json" title="wagtail.core.models.PageRevision.content_json"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content_json</span></code></a> field</li>
<li>You can retrieve a <code class="docutils literal notranslate"><span class="pre">PageRevision</span></code> as a <a class="reference internal" href="#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a> object by calling the <a class="reference internal" href="#wagtail.core.models.PageRevision.as_page_object" title="wagtail.core.models.PageRevision.as_page_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_page_object()</span></code></a> method</li>
</ul>
<div class="section" id="id5">
<h7>Database fields<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.PageRevision">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">PageRevision</code><a class="headerlink" href="#wagtail.core.models.PageRevision" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.PageRevision.page">
<code class="descname">page</code><a class="headerlink" href="#wagtail.core.models.PageRevision.page" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <a class="reference internal" href="#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a>)</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.PageRevision.submitted_for_moderation">
<code class="descname">submitted_for_moderation</code><a class="headerlink" href="#wagtail.core.models.PageRevision.submitted_for_moderation" title="Permalink to this definition">¶</a></dt>
<dd><p>(boolean)</p>
<p><code class="docutils literal notranslate"><span class="pre">True</span></code> if this revision is in moderation</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.PageRevision.created_at">
<code class="descname">created_at</code><a class="headerlink" href="#wagtail.core.models.PageRevision.created_at" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>This is the time the revision was created</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.PageRevision.user">
<code class="descname">user</code><a class="headerlink" href="#wagtail.core.models.PageRevision.user" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to user model)</p>
<p>This links to the user that created the revision</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.PageRevision.content_json">
<code class="descname">content_json</code><a class="headerlink" href="#wagtail.core.models.PageRevision.content_json" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>This field contains the JSON content for the page at the time the revision was created</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="managers">
<h7>Managers<a class="headerlink" href="#managers" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">PageRevision</code></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.PageRevision.objects">
<code class="descname">objects</code><a class="headerlink" href="#wagtail.core.models.PageRevision.objects" title="Permalink to this definition">¶</a></dt>
<dd><p>This manager is used to retrieve all of the <code class="docutils literal notranslate"><span class="pre">PageRevision</span></code> objects in the database</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PageRevision</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.PageRevision.submitted_revisions">
<code class="descname">submitted_revisions</code><a class="headerlink" href="#wagtail.core.models.PageRevision.submitted_revisions" title="Permalink to this definition">¶</a></dt>
<dd><p>This manager is used to retrieve all of the <code class="docutils literal notranslate"><span class="pre">PageRevision</span></code> objects that are awaiting moderator approval</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PageRevision</span><span class="o">.</span><span class="n">submitted_revisions</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id6">
<h7>Methods and properties<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">PageRevision</code></dt>
<dd><dl class="method">
<dt id="wagtail.core.models.PageRevision.as_page_object">
<code class="descname">as_page_object</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.PageRevision.as_page_object" title="Permalink to this definition">¶</a></dt>
<dd><p>This method retrieves this revision as an instance of its <a class="reference internal" href="#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a> subclass.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.PageRevision.approve_moderation">
<code class="descname">approve_moderation</code><span class="sig-paren">(</span><em>user=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.PageRevision.approve_moderation" title="Permalink to this definition">¶</a></dt>
<dd><p>Calling this on a revision that’s in moderation will mark it as approved and publish it</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.PageRevision.reject_moderation">
<code class="descname">reject_moderation</code><span class="sig-paren">(</span><em>user=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.PageRevision.reject_moderation" title="Permalink to this definition">¶</a></dt>
<dd><p>Calling this on a revision that’s in moderation will mark it as rejected</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.PageRevision.is_latest_revision">
<code class="descname">is_latest_revision</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.PageRevision.is_latest_revision" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if this revision is its page’s latest revision</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.PageRevision.publish">
<code class="descname">publish</code><span class="sig-paren">(</span><em>user=None</em>, <em>changed=True</em>, <em>log_action=True</em>, <em>previous_revision=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.PageRevision.publish" title="Permalink to this definition">¶</a></dt>
<dd><p>Publishes or schedules revision for publishing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>user</strong> – the publishing user</li>
<li><strong>changed</strong> – indicated whether content has changed</li>
<li><strong>log_action</strong> – flag for the logging action. Pass False to skip logging. Cannot pass an action string as the method
performs several actions: “publish”, “revert” (and publish the reverted revision),
“schedule publishing with a live revision”, “schedule revision reversal publishing, with a live revision”,
“schedule publishing”, “schedule revision reversal publishing”</li>
<li><strong>previous_revision</strong> – indicates a revision reversal. Should be set to the previous revision instance</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Calling this will copy the content of this revision into the live page object. If the page is in draft, it will be published.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="grouppagepermission">
<h6><code class="docutils literal notranslate"><span class="pre">GroupPagePermission</span></code><a class="headerlink" href="#grouppagepermission" title="Permalink to this headline">¶</a></h6>
<div class="section" id="id7">
<h7>Database fields<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.GroupPagePermission">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">GroupPagePermission</code><a class="headerlink" href="#wagtail.core.models.GroupPagePermission" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.GroupPagePermission.group">
<code class="descname">group</code><a class="headerlink" href="#wagtail.core.models.GroupPagePermission.group" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.models.Group</span></code>)</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.GroupPagePermission.page">
<code class="descname">page</code><a class="headerlink" href="#wagtail.core.models.GroupPagePermission.page" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <a class="reference internal" href="#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a>)</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.GroupPagePermission.permission_type">
<code class="descname">permission_type</code><a class="headerlink" href="#wagtail.core.models.GroupPagePermission.permission_type" title="Permalink to this definition">¶</a></dt>
<dd><p>(choice list)</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="pageviewrestriction">
<h6><code class="docutils literal notranslate"><span class="pre">PageViewRestriction</span></code><a class="headerlink" href="#pageviewrestriction" title="Permalink to this headline">¶</a></h6>
<div class="section" id="id8">
<h7>Database fields<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.PageViewRestriction">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">PageViewRestriction</code><a class="headerlink" href="#wagtail.core.models.PageViewRestriction" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.PageViewRestriction.page">
<code class="descname">page</code><a class="headerlink" href="#wagtail.core.models.PageViewRestriction.page" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <a class="reference internal" href="#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a>)</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.PageViewRestriction.password">
<code class="descname">password</code><a class="headerlink" href="#wagtail.core.models.PageViewRestriction.password" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="orderable-abstract">
<h6><code class="docutils literal notranslate"><span class="pre">Orderable</span></code> (abstract)<a class="headerlink" href="#orderable-abstract" title="Permalink to this headline">¶</a></h6>
<div class="section" id="id9">
<h7>Database fields<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.Orderable">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">Orderable</code><a class="headerlink" href="#wagtail.core.models.Orderable" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.Orderable.sort_order">
<code class="descname">sort_order</code><a class="headerlink" href="#wagtail.core.models.Orderable.sort_order" title="Permalink to this definition">¶</a></dt>
<dd><p>(number)</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="workflow">
<h6><code class="docutils literal notranslate"><span class="pre">Workflow</span></code><a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h6>
<p>Workflows represent sequences of tasks which much be approved for an action to be performed on a page - typically publication.</p>
<div class="section" id="id10">
<h7>Database fields<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.Workflow">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">Workflow</code><a class="headerlink" href="#wagtail.core.models.Workflow" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.Workflow.name">
<code class="descname">name</code><a class="headerlink" href="#wagtail.core.models.Workflow.name" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>Human-readable name of the workflow.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Workflow.active">
<code class="descname">active</code><a class="headerlink" href="#wagtail.core.models.Workflow.active" title="Permalink to this definition">¶</a></dt>
<dd><p>(boolean)</p>
<p>Whether or not the workflow is active: active workflows can be added to pages, and started. Inactive workflows cannot.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id11">
<h7>Methods and properties<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">Workflow</code></dt>
<dd><dl class="method">
<dt id="wagtail.core.models.Workflow.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>page</em>, <em>user</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Workflow.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Initiates a workflow by creating an instance of <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Workflow.tasks">
<code class="descname">tasks</code><a class="headerlink" href="#wagtail.core.models.Workflow.tasks" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all <code class="docutils literal notranslate"><span class="pre">Task</span></code> instances linked to this workflow</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Workflow.deactivate">
<code class="descname">deactivate</code><span class="sig-paren">(</span><em>user=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Workflow.deactivate" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the workflow as inactive, and cancels all in progress instances of <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code> linked to this workflow</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Workflow.all_pages">
<code class="descname">all_pages</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Workflow.all_pages" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a queryset of all the pages that this Workflow applies to.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="workflowstate">
<h6><code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code><a class="headerlink" href="#workflowstate" title="Permalink to this headline">¶</a></h6>
<p>Workflow states represent the status of a started workflow on a page.</p>
<div class="section" id="id12">
<h7>Database fields<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.WorkflowState">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">WorkflowState</code><a class="headerlink" href="#wagtail.core.models.WorkflowState" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.WorkflowState.page">
<code class="descname">page</code><a class="headerlink" href="#wagtail.core.models.WorkflowState.page" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">Page</span></code>)</p>
<p>The page on which the workflow has been started</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.WorkflowState.workflow">
<code class="descname">workflow</code><a class="headerlink" href="#wagtail.core.models.WorkflowState.workflow" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">Workflow</span></code>)</p>
<p>The workflow whose state the <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code> represents</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.WorkflowState.status">
<code class="descname">status</code><a class="headerlink" href="#wagtail.core.models.WorkflowState.status" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The current status of the workflow (options are <code class="docutils literal notranslate"><span class="pre">WorkflowState.STATUS_CHOICES</span></code>)</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.WorkflowState.created_at">
<code class="descname">created_at</code><a class="headerlink" href="#wagtail.core.models.WorkflowState.created_at" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>When this instance of <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code> was created - when the workflow was started</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.WorkflowState.requested_by">
<code class="descname">requested_by</code><a class="headerlink" href="#wagtail.core.models.WorkflowState.requested_by" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to user model)</p>
<p>The user who started this workflow</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.WorkflowState.current_task_state">
<code class="descname">current_task_state</code><a class="headerlink" href="#wagtail.core.models.WorkflowState.current_task_state" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">TaskState</span></code>)</p>
<p>The <code class="docutils literal notranslate"><span class="pre">TaskState</span></code> model for the task the workflow is currently at: either completing (if in progress) or the final task state (if finished)</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id13">
<h7>Methods and properties<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">WorkflowState</code></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.WorkflowState.STATUS_CHOICES">
<code class="descname">STATUS_CHOICES</code><a class="headerlink" href="#wagtail.core.models.WorkflowState.STATUS_CHOICES" title="Permalink to this definition">¶</a></dt>
<dd><p>A tuple of the possible options for the <code class="docutils literal notranslate"><span class="pre">status</span></code> field, and their verbose names. Options are <code class="docutils literal notranslate"><span class="pre">STATUS_IN_PROGRESS</span></code>, <code class="docutils literal notranslate"><span class="pre">STATUS_APPROVED</span></code>,
<code class="docutils literal notranslate"><span class="pre">STATUS_CANCELLED</span></code> and <code class="docutils literal notranslate"><span class="pre">STATUS_NEEDS_CHANGES</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.WorkflowState.update">
<code class="descname">update</code><span class="sig-paren">(</span><em>user=None</em>, <em>next_task=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.WorkflowState.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks the status of the current task, and progresses (or ends) the workflow if appropriate. If the workflow progresses,
next_task will be used to start a specific task next if provided.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.WorkflowState.get_next_task">
<code class="descname">get_next_task</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.WorkflowState.get_next_task" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the next active task, which has not been either approved or skipped</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.WorkflowState.cancel">
<code class="descname">cancel</code><span class="sig-paren">(</span><em>user=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.WorkflowState.cancel" title="Permalink to this definition">¶</a></dt>
<dd><p>Cancels the workflow state</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.WorkflowState.finish">
<code class="descname">finish</code><span class="sig-paren">(</span><em>user=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.WorkflowState.finish" title="Permalink to this definition">¶</a></dt>
<dd><p>Finishes a successful in progress workflow, marking it as approved and performing the <code class="docutils literal notranslate"><span class="pre">on_finish</span></code> action</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.WorkflowState.resume">
<code class="descname">resume</code><span class="sig-paren">(</span><em>user=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.WorkflowState.resume" title="Permalink to this definition">¶</a></dt>
<dd><p>Put a STATUS_NEEDS_CHANGES workflow state back into STATUS_IN_PROGRESS, and restart the current task</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.WorkflowState.copy_approved_task_states_to_revision">
<code class="descname">copy_approved_task_states_to_revision</code><span class="sig-paren">(</span><em>revision</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.WorkflowState.copy_approved_task_states_to_revision" title="Permalink to this definition">¶</a></dt>
<dd><p>This creates copies of previously approved task states with page_revision set to a different revision.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.WorkflowState.all_tasks_with_status">
<code class="descname">all_tasks_with_status</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.WorkflowState.all_tasks_with_status" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of Task objects that are linked with this workflow state’s
workflow. The status of that task in this workflow state is annotated in the
<cite>.status</cite> field. And a displayable version of that status is annotated in the
<cite>.status_display</cite> field.</p>
<p>This is different to querying TaskState as it also returns tasks that haven’t
been started yet (so won’t have a TaskState).</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.WorkflowState.revisions">
<code class="descname">revisions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.WorkflowState.revisions" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all page revisions associated with task states linked to the current workflow state</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="task">
<h6><code class="docutils literal notranslate"><span class="pre">Task</span></code><a class="headerlink" href="#task" title="Permalink to this headline">¶</a></h6>
<p>Tasks represent stages in a workflow which must be approved for the workflow to complete successfully.</p>
<div class="section" id="id14">
<h7>Database fields<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.Task">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">Task</code><a class="headerlink" href="#wagtail.core.models.Task" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.Task.name">
<code class="descname">name</code><a class="headerlink" href="#wagtail.core.models.Task.name" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>Human-readable name of the task.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Task.active">
<code class="descname">active</code><a class="headerlink" href="#wagtail.core.models.Task.active" title="Permalink to this definition">¶</a></dt>
<dd><p>(boolean)</p>
<p>Whether or not the task is active: active workflows can be added to workflows, and started. Inactive workflows cannot, and are skipped when in
an existing workflow.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Task.content_type">
<code class="descname">content_type</code><a class="headerlink" href="#wagtail.core.models.Task.content_type" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">django.contrib.contenttypes.models.ContentType</span></code>)</p>
<p>A foreign key to the <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/contrib/contenttypes/#django.contrib.contenttypes.models.ContentType" title="(in Django v3.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContentType</span></code></a> object that represents the specific model of this task.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id15">
<h7>Methods and properties<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">Task</code></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.Task.workflows">
<code class="descname">workflows</code><a class="headerlink" href="#wagtail.core.models.Task.workflows" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all <code class="docutils literal notranslate"><span class="pre">Workflow</span></code> instances that use this task</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Task.active_workflows">
<code class="descname">active_workflows</code><a class="headerlink" href="#wagtail.core.models.Task.active_workflows" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a <code class="docutils literal notranslate"><span class="pre">QuerySet`</span></code> of active workflows that this task is part of</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Task.task_state_class">
<code class="descname">task_state_class</code><a class="headerlink" href="#wagtail.core.models.Task.task_state_class" title="Permalink to this definition">¶</a></dt>
<dd><p>The specific task state class to generate to store state information for this task. If not specified, this will be <code class="docutils literal notranslate"><span class="pre">TaskState</span></code>.</p>
</dd></dl>

<dl class="classmethod">
<dt id="wagtail.core.models.Task.get_verbose_name">
<em class="property">classmethod </em><code class="descname">get_verbose_name</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.get_verbose_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the human-readable “verbose name” of this task model e.g “Group approval task”.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Task.specific">
<code class="descname">specific</code><a class="headerlink" href="#wagtail.core.models.Task.specific" title="Permalink to this definition">¶</a></dt>
<dd><p>Return this Task in its most specific subclassed form.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Task.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>workflow_state</em>, <em>user=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start this task on the provided workflow state by creating an instance of TaskState</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Task.on_action">
<code class="descname">on_action</code><span class="sig-paren">(</span><em>task_state</em>, <em>user</em>, <em>action_name</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.on_action" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs an action on a task state determined by the <code class="docutils literal notranslate"><span class="pre">action_name</span></code> string passed</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Task.user_can_access_editor">
<code class="descname">user_can_access_editor</code><span class="sig-paren">(</span><em>page</em>, <em>user</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.user_can_access_editor" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if a user who would not normally be able to access the editor for the page should be able to if the page is currently on this task.
Note that returning False does not remove permissions from users who would otherwise have them.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Task.user_can_lock">
<code class="descname">user_can_lock</code><span class="sig-paren">(</span><em>page</em>, <em>user</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.user_can_lock" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if a user who would not normally be able to lock the page should be able to if the page is currently on this task.
Note that returning False does not remove permissions from users who would otherwise have them.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Task.user_can_unlock">
<code class="descname">user_can_unlock</code><span class="sig-paren">(</span><em>page</em>, <em>user</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.user_can_unlock" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if a user who would not normally be able to unlock the page should be able to if the page is currently on this task.
Note that returning False does not remove permissions from users who would otherwise have them.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Task.page_locked_for_user">
<code class="descname">page_locked_for_user</code><span class="sig-paren">(</span><em>page</em>, <em>user</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.page_locked_for_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the page should be locked to a given user’s edits. This can be used to prevent editing by non-reviewers.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Task.get_actions">
<code class="descname">get_actions</code><span class="sig-paren">(</span><em>page</em>, <em>user</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.get_actions" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the list of action strings (name, verbose_name, whether the action requires additional data - see
<code class="docutils literal notranslate"><span class="pre">get_form_for_action</span></code>) for actions the current user can perform for this task on the given page.
These strings should be the same as those able to be passed to <code class="docutils literal notranslate"><span class="pre">on_action</span></code></p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Task.get_task_states_user_can_moderate">
<code class="descname">get_task_states_user_can_moderate</code><span class="sig-paren">(</span><em>user</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.get_task_states_user_can_moderate" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> of the task states the current user can moderate</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Task.deactivate">
<code class="descname">deactivate</code><span class="sig-paren">(</span><em>user=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.deactivate" title="Permalink to this definition">¶</a></dt>
<dd><p>Set <code class="docutils literal notranslate"><span class="pre">active</span></code> to False and cancel all in progress task states linked to this task</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Task.get_form_for_action">
<code class="descname">get_form_for_action</code><span class="sig-paren">(</span><em>action</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.get_form_for_action" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wagtail.core.models.Task.get_template_for_action">
<code class="descname">get_template_for_action</code><span class="sig-paren">(</span><em>action</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.get_template_for_action" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="wagtail.core.models.Task.get_description">
<em class="property">classmethod </em><code class="descname">get_description</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.Task.get_description" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the task description.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="taskstate">
<h6><code class="docutils literal notranslate"><span class="pre">TaskState</span></code><a class="headerlink" href="#taskstate" title="Permalink to this headline">¶</a></h6>
<p>Task states store state information about the progress of a task on a particular page revision.</p>
<div class="section" id="id16">
<h7>Database fields<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.TaskState">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">TaskState</code><a class="headerlink" href="#wagtail.core.models.TaskState" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.TaskState.workflow_state">
<code class="descname">workflow_state</code><a class="headerlink" href="#wagtail.core.models.TaskState.workflow_state" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code>)</p>
<p>The workflow state which started this task state.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">page revision</code></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">PageRevision</span></code>)</p>
<p>The page revision this task state was created on.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.TaskState.task">
<code class="descname">task</code><a class="headerlink" href="#wagtail.core.models.TaskState.task" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">Task</span></code>)</p>
<p>The task that this task state is storing state information for.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.TaskState.status">
<code class="descname">status</code><a class="headerlink" href="#wagtail.core.models.TaskState.status" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The completion status of the task on this revision. Options are available in <code class="docutils literal notranslate"><span class="pre">TaskState.STATUS_CHOICES</span></code>)</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.TaskState.content_type">
<code class="descname">content_type</code><a class="headerlink" href="#wagtail.core.models.TaskState.content_type" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">django.contrib.contenttypes.models.ContentType</span></code>)</p>
<p>A foreign key to the <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/contrib/contenttypes/#django.contrib.contenttypes.models.ContentType" title="(in Django v3.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContentType</span></code></a> object that represents the specific model of this task.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.TaskState.started_at">
<code class="descname">started_at</code><a class="headerlink" href="#wagtail.core.models.TaskState.started_at" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>When this task state was created.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.TaskState.finished_at">
<code class="descname">finished_at</code><a class="headerlink" href="#wagtail.core.models.TaskState.finished_at" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>When this task state was cancelled, rejected, or approved.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.TaskState.finished_by">
<code class="descname">finished_by</code><a class="headerlink" href="#wagtail.core.models.TaskState.finished_by" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to user model)</p>
<p>The user who completed (cancelled, rejected, approved) the task.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.TaskState.comment">
<code class="descname">comment</code><a class="headerlink" href="#wagtail.core.models.TaskState.comment" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>A text comment, typically added by a user when the task is completed.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id17">
<h7>Methods and properties<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">TaskState</code></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.TaskState.STATUS_CHOICES">
<code class="descname">STATUS_CHOICES</code><a class="headerlink" href="#wagtail.core.models.TaskState.STATUS_CHOICES" title="Permalink to this definition">¶</a></dt>
<dd><p>A tuple of the possible options for the <code class="docutils literal notranslate"><span class="pre">status</span></code> field, and their verbose names. Options are <code class="docutils literal notranslate"><span class="pre">STATUS_IN_PROGRESS</span></code>, <code class="docutils literal notranslate"><span class="pre">STATUS_APPROVED</span></code>,
<code class="docutils literal notranslate"><span class="pre">STATUS_CANCELLED</span></code>, <code class="docutils literal notranslate"><span class="pre">STATUS_REJECTED</span></code> and <code class="docutils literal notranslate"><span class="pre">STATUS_SKIPPED</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.TaskState.exclude_fields_in_copy">
<code class="descname">exclude_fields_in_copy</code><a class="headerlink" href="#wagtail.core.models.TaskState.exclude_fields_in_copy" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of fields not to copy when the <code class="docutils literal notranslate"><span class="pre">TaskState.copy()</span></code> method is called.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.TaskState.specific">
<code class="descname">specific</code><a class="headerlink" href="#wagtail.core.models.TaskState.specific" title="Permalink to this definition">¶</a></dt>
<dd><p>Return this TaskState in its most specific subclassed form.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.TaskState.approve">
<code class="descname">approve</code><span class="sig-paren">(</span><em>user=None</em>, <em>update=True</em>, <em>comment=''</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.TaskState.approve" title="Permalink to this definition">¶</a></dt>
<dd><p>Approve the task state and update the workflow state</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.TaskState.reject">
<code class="descname">reject</code><span class="sig-paren">(</span><em>user=None</em>, <em>update=True</em>, <em>comment=''</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.TaskState.reject" title="Permalink to this definition">¶</a></dt>
<dd><p>Reject the task state and update the workflow state</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.TaskState.task_type_started_at">
<code class="descname">task_type_started_at</code><a class="headerlink" href="#wagtail.core.models.TaskState.task_type_started_at" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the first chronological started_at for successive TaskStates - ie started_at if the task had not been restarted</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.TaskState.cancel">
<code class="descname">cancel</code><span class="sig-paren">(</span><em>user=None</em>, <em>resume=False</em>, <em>comment=''</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.TaskState.cancel" title="Permalink to this definition">¶</a></dt>
<dd><p>Cancel the task state and update the workflow state. If <code class="docutils literal notranslate"><span class="pre">resume</span></code> is set to True, then upon update the workflow state
is passed the current task as <code class="docutils literal notranslate"><span class="pre">next_task</span></code>, causing it to start a new task state on the current task if possible</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.TaskState.copy">
<code class="descname">copy</code><span class="sig-paren">(</span><em>update_attrs=None</em>, <em>exclude_fields=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.TaskState.copy" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy this task state, excluding the attributes in the <code class="docutils literal notranslate"><span class="pre">exclude_fields</span></code> list and updating any attributes to values
specified in the <code class="docutils literal notranslate"><span class="pre">update_attrs</span></code> dictionary of <code class="docutils literal notranslate"><span class="pre">attribute</span></code>: <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">value</span></code> pairs</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.models.TaskState.get_comment">
<code class="descname">get_comment</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.TaskState.get_comment" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a string that is displayed in workflow history.</p>
<p>This could be a comment by the reviewer, or generated.
Use mark_safe to return HTML.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="workflowtask">
<h6><code class="docutils literal notranslate"><span class="pre">WorkflowTask</span></code><a class="headerlink" href="#workflowtask" title="Permalink to this headline">¶</a></h6>
<p>Represents the ordering of a task in a specific workflow.</p>
<div class="section" id="id18">
<h7>Database fields<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.WorkflowTask">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">WorkflowTask</code><a class="headerlink" href="#wagtail.core.models.WorkflowTask" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.WorkflowTask.workflow">
<code class="descname">workflow</code><a class="headerlink" href="#wagtail.core.models.WorkflowTask.workflow" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">Workflow</span></code>)</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.WorkflowTask.task">
<code class="descname">task</code><a class="headerlink" href="#wagtail.core.models.WorkflowTask.task" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">Task</span></code>)</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.WorkflowTask.sort_order">
<code class="descname">sort_order</code><a class="headerlink" href="#wagtail.core.models.WorkflowTask.sort_order" title="Permalink to this definition">¶</a></dt>
<dd><p>(number)</p>
<p>The ordering of the task in the workflow.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="workflowpage">
<h6><code class="docutils literal notranslate"><span class="pre">WorkflowPage</span></code><a class="headerlink" href="#workflowpage" title="Permalink to this headline">¶</a></h6>
<p>Represents the assignment of a workflow to a page and its descendants.</p>
<div class="section" id="id19">
<h7>Database fields<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.WorkflowPage">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">WorkflowPage</code><a class="headerlink" href="#wagtail.core.models.WorkflowPage" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.WorkflowPage.workflow">
<code class="descname">workflow</code><a class="headerlink" href="#wagtail.core.models.WorkflowPage.workflow" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">Workflow</span></code>)</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.WorkflowPage.page">
<code class="descname">page</code><a class="headerlink" href="#wagtail.core.models.WorkflowPage.page" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">Page</span></code>)</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="baselogentry">
<h6><code class="docutils literal notranslate"><span class="pre">BaseLogEntry</span></code><a class="headerlink" href="#baselogentry" title="Permalink to this headline">¶</a></h6>
<p>An abstract base class that represents a record of an action performed on an object.</p>
<div class="section" id="id20">
<h7>Database fields<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.BaseLogEntry">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">BaseLogEntry</code><a class="headerlink" href="#wagtail.core.models.BaseLogEntry" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.BaseLogEntry.content_type">
<code class="descname">content_type</code><a class="headerlink" href="#wagtail.core.models.BaseLogEntry.content_type" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <code class="docutils literal notranslate"><span class="pre">django.contrib.contenttypes.models.ContentType</span></code>)</p>
<p>A foreign key to the <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/contrib/contenttypes/#django.contrib.contenttypes.models.ContentType" title="(in Django v3.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContentType</span></code></a> object that represents the specific model of this model.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.BaseLogEntry.label">
<code class="descname">label</code><a class="headerlink" href="#wagtail.core.models.BaseLogEntry.label" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The object title at the time of the entry creation</p>
<p>Note: Wagtail will attempt to use <code class="docutils literal notranslate"><span class="pre">get_admin_display_title</span></code> or the string representation of the object passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">log_action()</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.BaseLogEntry.user">
<code class="descname">user</code><a class="headerlink" href="#wagtail.core.models.BaseLogEntry.user" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to user model)</p>
<p>A foreign key to the user that triggered the action.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.BaseLogEntry.data_json">
<code class="descname">data_json</code><a class="headerlink" href="#wagtail.core.models.BaseLogEntry.data_json" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The JSON representation of any additional details for each action.
e.g. source page id and title when copying from a page. Or workflow id/name and next step id/name on a workflow transition</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.BaseLogEntry.timestamp">
<code class="descname">timestamp</code><a class="headerlink" href="#wagtail.core.models.BaseLogEntry.timestamp" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>The date/time when the entry was created.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.BaseLogEntry.content_changed">
<code class="descname">content_changed</code><a class="headerlink" href="#wagtail.core.models.BaseLogEntry.content_changed" title="Permalink to this definition">¶</a></dt>
<dd><p>(boolean)</p>
<p>A boolean that can set to <code class="docutils literal notranslate"><span class="pre">True</span></code> when the content has changed.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.BaseLogEntry.deleted">
<code class="descname">deleted</code><a class="headerlink" href="#wagtail.core.models.BaseLogEntry.deleted" title="Permalink to this definition">¶</a></dt>
<dd><p>(boolean)</p>
<p>A boolean that can set to <code class="docutils literal notranslate"><span class="pre">True</span></code> when the object is deleted. Used to filter entries in the Site History report.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id21">
<h7>Methods and properties<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">BaseLogEntry</code></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.BaseLogEntry.user_display_name">
<code class="descname">user_display_name</code><a class="headerlink" href="#wagtail.core.models.BaseLogEntry.user_display_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the display name of the associated user;
get_full_name if available and non-empty, otherwise get_username.
Defaults to ‘system’ when none is provided</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.BaseLogEntry.data">
<code class="descname">data</code><a class="headerlink" href="#wagtail.core.models.BaseLogEntry.data" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides deserialized data</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.BaseLogEntry.comment">
<code class="descname">comment</code><a class="headerlink" href="#wagtail.core.models.BaseLogEntry.comment" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.BaseLogEntry.object_verbose_name">
<code class="descname">object_verbose_name</code><a class="headerlink" href="#wagtail.core.models.BaseLogEntry.object_verbose_name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wagtail.core.models.BaseLogEntry.object_id">
<code class="descname">object_id</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.models.BaseLogEntry.object_id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="pagelogentry">
<h6><code class="docutils literal notranslate"><span class="pre">PageLogEntry</span></code><a class="headerlink" href="#pagelogentry" title="Permalink to this headline">¶</a></h6>
<p>Represents a record of an action performed on an <a class="reference internal" href="#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a>, subclasses <a class="reference internal" href="#wagtail.core.models.BaseLogEntry" title="wagtail.core.models.BaseLogEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseLogEntry</span></code></a>.</p>
<div class="section" id="id22">
<h7>Database fields<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.PageLogEntry">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">PageLogEntry</code><a class="headerlink" href="#wagtail.core.models.PageLogEntry" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.PageLogEntry.page">
<code class="descname">page</code><a class="headerlink" href="#wagtail.core.models.PageLogEntry.page" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <a class="reference internal" href="#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a>)</p>
<p>A foreign key to the page the action is performed on.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.PageLogEntry.revision">
<code class="descname">revision</code><a class="headerlink" href="#wagtail.core.models.PageLogEntry.revision" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <a class="reference internal" href="#wagtail.core.models.PageRevision" title="wagtail.core.models.PageRevision"><code class="xref py py-class docutils literal notranslate"><span class="pre">PageRevision</span></code></a>)</p>
<p>A foreign key to the current page revision.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="comment">
<h6><code class="docutils literal notranslate"><span class="pre">Comment</span></code><a class="headerlink" href="#comment" title="Permalink to this headline">¶</a></h6>
<p>Represents a comment on a page.</p>
<div class="section" id="id23">
<h7>Database fields<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.Comment">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">Comment</code><a class="headerlink" href="#wagtail.core.models.Comment" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.Comment.page">
<code class="descname">page</code><a class="headerlink" href="#wagtail.core.models.Comment.page" title="Permalink to this definition">¶</a></dt>
<dd><p>(parental key to <a class="reference internal" href="#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a>)</p>
<p>A parental key to the page the comment has been added to.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Comment.user">
<code class="descname">user</code><a class="headerlink" href="#wagtail.core.models.Comment.user" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to user model)</p>
<p>A foreign key to the user who added this comment.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Comment.text">
<code class="descname">text</code><a class="headerlink" href="#wagtail.core.models.Comment.text" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The text content of the comment.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Comment.contentpath">
<code class="descname">contentpath</code><a class="headerlink" href="#wagtail.core.models.Comment.contentpath" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The path to the field or streamfield block the comment is attached to,
in the form <code class="docutils literal notranslate"><span class="pre">field</span></code> or <code class="docutils literal notranslate"><span class="pre">field.streamfield_block_id</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Comment.position">
<code class="descname">position</code><a class="headerlink" href="#wagtail.core.models.Comment.position" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>An identifier for the position of the comment within its field. The format
used is determined by the field.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Comment.created_at">
<code class="descname">created_at</code><a class="headerlink" href="#wagtail.core.models.Comment.created_at" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>The date/time when the comment was created.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Comment.updated_at">
<code class="descname">updated_at</code><a class="headerlink" href="#wagtail.core.models.Comment.updated_at" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>The date/time when the comment was updated.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Comment.revision_created">
<code class="descname">revision_created</code><a class="headerlink" href="#wagtail.core.models.Comment.revision_created" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to <a class="reference internal" href="#wagtail.core.models.PageRevision" title="wagtail.core.models.PageRevision"><code class="xref py py-class docutils literal notranslate"><span class="pre">PageRevision</span></code></a>)</p>
<p>A foreign key to the revision on which the comment was created.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Comment.resolved_at">
<code class="descname">resolved_at</code><a class="headerlink" href="#wagtail.core.models.Comment.resolved_at" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>The date/time when the comment was resolved, if any.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.Comment.resolved_by">
<code class="descname">resolved_by</code><a class="headerlink" href="#wagtail.core.models.Comment.resolved_by" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to user model)</p>
<p>A foreign key to the user who resolved this comment, if any.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="commentreply">
<h6><code class="docutils literal notranslate"><span class="pre">CommentReply</span></code><a class="headerlink" href="#commentreply" title="Permalink to this headline">¶</a></h6>
<p>Represents a reply to a comment thread.</p>
<div class="section" id="id24">
<h7>Database fields<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.CommentReply">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">CommentReply</code><a class="headerlink" href="#wagtail.core.models.CommentReply" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.CommentReply.comment">
<code class="descname">comment</code><a class="headerlink" href="#wagtail.core.models.CommentReply.comment" title="Permalink to this definition">¶</a></dt>
<dd><p>(parental key to <a class="reference internal" href="#wagtail.core.models.Comment" title="wagtail.core.models.Comment"><code class="xref py py-class docutils literal notranslate"><span class="pre">Comment</span></code></a>)</p>
<p>A parental key to the comment that started the thread.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.CommentReply.user">
<code class="descname">user</code><a class="headerlink" href="#wagtail.core.models.CommentReply.user" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to user model)</p>
<p>A foreign key to the user who added this comment.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.CommentReply.text">
<code class="descname">text</code><a class="headerlink" href="#wagtail.core.models.CommentReply.text" title="Permalink to this definition">¶</a></dt>
<dd><p>(text)</p>
<p>The text content of the comment.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.CommentReply.created_at">
<code class="descname">created_at</code><a class="headerlink" href="#wagtail.core.models.CommentReply.created_at" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>The date/time when the comment was created.</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.CommentReply.updated_at">
<code class="descname">updated_at</code><a class="headerlink" href="#wagtail.core.models.CommentReply.updated_at" title="Permalink to this definition">¶</a></dt>
<dd><p>(date/time)</p>
<p>The date/time when the comment was updated.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="pagesubscription">
<h6><code class="docutils literal notranslate"><span class="pre">PageSubscription</span></code><a class="headerlink" href="#pagesubscription" title="Permalink to this headline">¶</a></h6>
<p>Represents a user’s subscription to email notifications about page events.
Currently only used for comment notifications.</p>
<div class="section" id="id25">
<h7>Database fields<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="wagtail.core.models.PageSubscription">
<em class="property">class </em><code class="descclassname">wagtail.core.models.</code><code class="descname">PageSubscription</code><a class="headerlink" href="#wagtail.core.models.PageSubscription" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="wagtail.core.models.PageSubscription.page">
<code class="descname">page</code><a class="headerlink" href="#wagtail.core.models.PageSubscription.page" title="Permalink to this definition">¶</a></dt>
<dd><p>(parental key to <a class="reference internal" href="#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a>)</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.PageSubscription.user">
<code class="descname">user</code><a class="headerlink" href="#wagtail.core.models.PageSubscription.user" title="Permalink to this definition">¶</a></dt>
<dd><p>(foreign key to user model)</p>
</dd></dl>

<dl class="attribute">
<dt id="wagtail.core.models.PageSubscription.comment_notifications">
<code class="descname">comment_notifications</code><a class="headerlink" href="#wagtail.core.models.PageSubscription.comment_notifications" title="Permalink to this definition">¶</a></dt>
<dd><p>(boolean)</p>
<p>Whether the user should receive comment notifications for all comments,
or just comments in threads they participate in.</p>
</dd></dl>

</dd></dl>

</div>
</div>
</div>
<span id="document-reference/pages/queryset_reference"></span><div class="section" id="page-queryset-reference">
<h5>Page QuerySet reference<a class="headerlink" href="#page-queryset-reference" title="Permalink to this headline">¶</a></h5>
<p>All models that inherit from <a class="reference internal" href="index.html#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">Page</span></code></a> are given some extra QuerySet methods accessible from their <code class="docutils literal notranslate"><span class="pre">.objects</span></code> attribute.</p>
<div class="section" id="examples">
<h6>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Selecting only live pages</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">live_pages</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first">Selecting published EventPages that are descendants of events_index</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">events</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">descendant_of</span><span class="p">(</span><span class="n">events_index</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Getting a list of menu items</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This gets a QuerySet of live children of the homepage with ``show_in_menus`` set</span>
<span class="n">menu_items</span> <span class="o">=</span> <span class="n">homepage</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">in_menu</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="module-wagtail.core.query">
<span id="reference"></span><h6>Reference<a class="headerlink" href="#module-wagtail.core.query" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="wagtail.core.query.PageQuerySet">
<em class="property">class </em><code class="descclassname">wagtail.core.query.</code><code class="descname">PageQuerySet</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="wagtail.core.query.PageQuerySet.live">
<code class="descname">live</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.live" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain published pages.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">published_pages</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.not_live">
<code class="descname">not_live</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.not_live" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain unpublished pages.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">unpublished_pages</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">not_live</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.in_menu">
<code class="descname">in_menu</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.in_menu" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain pages that are in the menus.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build a menu from live pages that are children of the homepage</span>
<span class="n">menu_items</span> <span class="o">=</span> <span class="n">homepage</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">in_menu</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To put your page in menus, set the show_in_menus flag to true:</p>
<div class="last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add &#39;my_page&#39; to the menu</span>
<span class="n">my_page</span><span class="o">.</span><span class="n">show_in_menus</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.not_in_menu">
<code class="descname">not_in_menu</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.not_in_menu" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain pages that are not in the menus.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.in_site">
<code class="descname">in_site</code><span class="sig-paren">(</span><em>site</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.in_site" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain pages within the specified site.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get all the EventPages in the current site</span>
<span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="o">.</span><span class="n">find_for_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="n">site_events</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">in_site</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.page">
<code class="descname">page</code><span class="sig-paren">(</span><em>other</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.page" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet so it only contains the specified page.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Append an extra page to a QuerySet</span>
<span class="n">new_queryset</span> <span class="o">=</span> <span class="n">old_queryset</span> <span class="o">|</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">page_to_add</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.not_page">
<code class="descname">not_page</code><span class="sig-paren">(</span><em>other</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.not_page" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet so it doesn’t contain the specified page.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove a page from a QuerySet</span>
<span class="n">new_queryset</span> <span class="o">=</span> <span class="n">old_queryset</span> <span class="o">&amp;</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">not_page</span><span class="p">(</span><span class="n">page_to_remove</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.descendant_of">
<code class="descname">descendant_of</code><span class="sig-paren">(</span><em>other</em>, <em>inclusive=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.descendant_of" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain pages that descend from the specified page.</p>
<p>If inclusive is set to True, it will also contain the page itself (instead of just its descendants).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get EventPages that are under the special_events Page</span>
<span class="n">special_events</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">descendant_of</span><span class="p">(</span><span class="n">special_events_index</span><span class="p">)</span>

<span class="c1"># Alternative way</span>
<span class="n">special_events</span> <span class="o">=</span> <span class="n">special_events_index</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.not_descendant_of">
<code class="descname">not_descendant_of</code><span class="sig-paren">(</span><em>other</em>, <em>inclusive=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.not_descendant_of" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to not contain any pages that descend from the specified page.</p>
<p>If inclusive is set to True, it will also exclude the specified page.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get EventPages that are not under the archived_events Page</span>
<span class="n">non_archived_events</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">not_descendant_of</span><span class="p">(</span><span class="n">archived_events_index</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.child_of">
<code class="descname">child_of</code><span class="sig-paren">(</span><em>other</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.child_of" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain pages that are direct children of the specified page.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a list of sections</span>
<span class="n">sections</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">child_of</span><span class="p">(</span><span class="n">homepage</span><span class="p">)</span>

<span class="c1"># Alternative way</span>
<span class="n">sections</span> <span class="o">=</span> <span class="n">homepage</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.not_child_of">
<code class="descname">not_child_of</code><span class="sig-paren">(</span><em>other</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.not_child_of" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to not contain any pages that are direct children of the specified page.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.ancestor_of">
<code class="descname">ancestor_of</code><span class="sig-paren">(</span><em>other</em>, <em>inclusive=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.ancestor_of" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain pages that are ancestors of the specified page.</p>
<p>If inclusive is set to True, it will also include the specified page.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the current section</span>
<span class="n">current_section</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">ancestor_of</span><span class="p">(</span><span class="n">current_page</span><span class="p">)</span><span class="o">.</span><span class="n">child_of</span><span class="p">(</span><span class="n">homepage</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="c1"># Alternative way</span>
<span class="n">current_section</span> <span class="o">=</span> <span class="n">current_page</span><span class="o">.</span><span class="n">get_ancestors</span><span class="p">()</span><span class="o">.</span><span class="n">child_of</span><span class="p">(</span><span class="n">homepage</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.not_ancestor_of">
<code class="descname">not_ancestor_of</code><span class="sig-paren">(</span><em>other</em>, <em>inclusive=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.not_ancestor_of" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to not contain any pages that are ancestors of the specified page.</p>
<p>If inclusive is set to True, it will also exclude the specified page.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the other sections</span>
<span class="n">other_sections</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">not_ancestor_of</span><span class="p">(</span><span class="n">current_page</span><span class="p">)</span><span class="o">.</span><span class="n">child_of</span><span class="p">(</span><span class="n">homepage</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.parent_of">
<code class="descname">parent_of</code><span class="sig-paren">(</span><em>other</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.parent_of" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain the parent of the specified page.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.not_parent_of">
<code class="descname">not_parent_of</code><span class="sig-paren">(</span><em>other</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.not_parent_of" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to exclude the parent of the specified page.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.sibling_of">
<code class="descname">sibling_of</code><span class="sig-paren">(</span><em>other</em>, <em>inclusive=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.sibling_of" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain pages that are siblings of the specified page.</p>
<p>By default, inclusive is set to True so it will include the specified page in the results.</p>
<p>If inclusive is set to False, the page will be excluded from the results.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get list of siblings</span>
<span class="n">siblings</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">sibling_of</span><span class="p">(</span><span class="n">current_page</span><span class="p">)</span>

<span class="c1"># Alternative way</span>
<span class="n">siblings</span> <span class="o">=</span> <span class="n">current_page</span><span class="o">.</span><span class="n">get_siblings</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.not_sibling_of">
<code class="descname">not_sibling_of</code><span class="sig-paren">(</span><em>other</em>, <em>inclusive=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.not_sibling_of" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to not contain any pages that are siblings of the specified page.</p>
<p>By default, inclusive is set to True so it will exclude the specified page from the results.</p>
<p>If inclusive is set to False, the page will be included in the results.</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.public">
<code class="descname">public</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.public" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain pages that are not in a private section</p>
<p>See: <a class="reference internal" href="index.html#private-pages"><span class="std std-ref">Private pages</span></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This doesn’t filter out unpublished pages. If you want to only have published public pages, use <code class="docutils literal notranslate"><span class="pre">.live().public()</span></code></p>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find all the pages that are viewable by the public</span>
<span class="n">all_pages</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">public</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.not_public">
<code class="descname">not_public</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.not_public" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain pages that are in a private section</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.search">
<code class="descname">search</code><span class="sig-paren">(</span><em>query</em>, <em>fields=None</em>, <em>operator=None</em>, <em>order_by_relevance=True</em>, <em>partial_match=True</em>, <em>backend='default'</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.search" title="Permalink to this definition">¶</a></dt>
<dd><p>This runs a search query on all the items in the QuerySet</p>
<p>See: <a class="reference internal" href="index.html#wagtailsearch-searching-pages"><span class="std std-ref">Searching QuerySets</span></a></p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Search future events</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">date__gt</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.type">
<code class="descname">type</code><span class="sig-paren">(</span><em>*types</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.type" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain pages that are an instance
of the specified model(s) (including subclasses).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find all pages that are of type AbstractEmailForm, or one of it&#39;s subclasses</span>
<span class="n">form_pages</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">)</span>

<span class="c1"># Find all pages that are of type AbstractEmailForm or AbstractEventPage, or one of their subclasses</span>
<span class="n">form_and_event_pages</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">,</span> <span class="n">AbstractEventPage</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.not_type">
<code class="descname">not_type</code><span class="sig-paren">(</span><em>*types</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.not_type" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to exclude any pages which are an instance of the specified model(s).</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.exact_type">
<code class="descname">exact_type</code><span class="sig-paren">(</span><em>*types</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.exact_type" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to only contain pages that are an instance of the specified model(s)
(matching the model exactly, not subclasses).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find all pages that are of the exact type EventPage</span>
<span class="n">event_pages</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exact_type</span><span class="p">(</span><span class="n">EventPage</span><span class="p">)</span>

<span class="c1"># Find all page of the exact type EventPage or NewsPage</span>
<span class="n">news_and_events_pages</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exact_type</span><span class="p">(</span><span class="n">EventPage</span><span class="p">,</span> <span class="n">NewsPage</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you are only interested in pages of a single type, it is clearer (and often more efficient) to use
the specific model’s manager to get a queryset. For example:</p>
<div class="last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">event_pages</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.not_exact_type">
<code class="descname">not_exact_type</code><span class="sig-paren">(</span><em>*types</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.not_exact_type" title="Permalink to this definition">¶</a></dt>
<dd><p>This filters the QuerySet to exclude any pages which are an instance of the specified model(s)
(matching the model exactly, not subclasses).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, find all news and event pages</span>
<span class="n">news_and_events</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">NewsPage</span><span class="p">,</span> <span class="n">EventPage</span><span class="p">)</span>

<span class="c1"># Now exclude pages with an exact type of EventPage or NewsPage,</span>
<span class="c1"># leaving only instance of more &#39;specialist&#39; types</span>
<span class="n">specialised_news_and_events</span> <span class="o">=</span> <span class="n">news_and_events</span><span class="o">.</span><span class="n">not_exact_type</span><span class="p">(</span><span class="n">NewsPage</span><span class="p">,</span> <span class="n">EventPage</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.unpublish">
<code class="descname">unpublish</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.unpublish" title="Permalink to this definition">¶</a></dt>
<dd><p>This unpublishes all live pages in the QuerySet.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Unpublish current_page and all of its children</span>
<span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">descendant_of</span><span class="p">(</span><span class="n">current_page</span><span class="p">,</span> <span class="n">inclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">unpublish</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.specific">
<code class="descname">specific</code><span class="sig-paren">(</span><em>defer=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.specific" title="Permalink to this definition">¶</a></dt>
<dd><p>This efficiently gets all the specific pages for the queryset, using
the minimum number of queries.</p>
<p>When the “defer” keyword argument is set to True, only generic page
field values will be loaded and all specific fields will be deferred.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the specific instance of all children of the hompage,</span>
<span class="c1"># in a minimum number of database queries.</span>
<span class="n">homepage</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span><span class="o">.</span><span class="n">specific</span><span class="p">()</span>
</pre></div>
</div>
<p>See also: <a class="reference internal" href="index.html#wagtail.core.models.Page.specific" title="wagtail.core.models.Page.specific"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Page.specific</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.defer_streamfields">
<code class="descname">defer_streamfields</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.defer_streamfields" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply to a queryset to prevent fetching/decoding of StreamField values on
evaluation. Useful when working with potentially large numbers of results,
where StreamField values are unlikely to be needed. For example, when
generating a sitemap or a long list of page links.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply to a queryset to avoid fetching StreamField values</span>
<span class="c1"># for a specific model</span>
<span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">defer_streamfields</span><span class="p">()</span>

<span class="c1"># Or combine with specific() to avoid fetching StreamField</span>
<span class="c1"># values for all models</span>
<span class="n">homepage</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span><span class="o">.</span><span class="n">defer_streamfields</span><span class="p">()</span><span class="o">.</span><span class="n">specific</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.core.query.PageQuerySet.first_common_ancestor">
<code class="descname">first_common_ancestor</code><span class="sig-paren">(</span><em>include_self=False</em>, <em>strict=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.query.PageQuerySet.first_common_ancestor" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the first ancestor that all pages in this queryset have in common.
For example, consider a page hierarchy like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">Home</span><span class="o">/</span>
    <span class="o">-</span> <span class="n">Foo</span> <span class="n">Event</span> <span class="n">Index</span><span class="o">/</span>
        <span class="o">-</span> <span class="n">Foo</span> <span class="n">Event</span> <span class="n">Page</span> <span class="mi">1</span><span class="o">/</span>
        <span class="o">-</span> <span class="n">Foo</span> <span class="n">Event</span> <span class="n">Page</span> <span class="mi">2</span><span class="o">/</span>
    <span class="o">-</span> <span class="n">Bar</span> <span class="n">Event</span> <span class="n">Index</span><span class="o">/</span>
        <span class="o">-</span> <span class="n">Bar</span> <span class="n">Event</span> <span class="n">Page</span> <span class="mi">1</span><span class="o">/</span>
        <span class="o">-</span> <span class="n">Bar</span> <span class="n">Event</span> <span class="n">Page</span> <span class="mi">2</span><span class="o">/</span>
</pre></div>
</div>
<p>The common ancestors for some queries would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Page</span><span class="o">.</span><span class="n">objects</span>\
<span class="gp">... </span>    <span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">EventPage</span><span class="p">)</span>\
<span class="gp">... </span>    <span class="o">.</span><span class="n">first_common_ancestor</span><span class="p">()</span>
<span class="go">&lt;Page: Home&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Page</span><span class="o">.</span><span class="n">objects</span>\
<span class="gp">... </span>    <span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">EventPage</span><span class="p">)</span>\
<span class="gp">... </span>    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">title__contains</span><span class="o">=</span><span class="s1">&#39;Foo&#39;</span><span class="p">)</span>\
<span class="gp">... </span>    <span class="o">.</span><span class="n">first_common_ancestor</span><span class="p">()</span>
<span class="go">&lt;Page: Foo Event Index&gt;</span>
</pre></div>
</div>
<p>This method tries to be efficient, but if you have millions of pages
scattered across your page tree, it will be slow.</p>
<p>If <cite>include_self</cite> is True, the ancestor can be one of the pages in the
queryset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Page</span><span class="o">.</span><span class="n">objects</span>\
<span class="gp">... </span>    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">title__contains</span><span class="o">=</span><span class="s1">&#39;Foo&#39;</span><span class="p">)</span>\
<span class="gp">... </span>    <span class="o">.</span><span class="n">first_common_ancestor</span><span class="p">()</span>
<span class="go">&lt;Page: Foo Event Index&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Page</span><span class="o">.</span><span class="n">objects</span>\
<span class="gp">... </span>    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">title__exact</span><span class="o">=</span><span class="s1">&#39;Bar Event Index&#39;</span><span class="p">)</span>\
<span class="gp">... </span>    <span class="o">.</span><span class="n">first_common_ancestor</span><span class="p">()</span>
<span class="go">&lt;Page: Bar Event Index&gt;</span>
</pre></div>
</div>
<p>A few invalid cases exist: when the queryset is empty, when the root
Page is in the queryset and <code class="docutils literal notranslate"><span class="pre">include_self</span></code> is False, and when there
are multiple page trees with no common root (a case Wagtail does not
support). If <code class="docutils literal notranslate"><span class="pre">strict</span></code> is False (the default), then the first root
node is returned in these cases. If <code class="docutils literal notranslate"><span class="pre">strict</span></code> is True, then a
<code class="docutils literal notranslate"><span class="pre">ObjectDoesNotExist</span></code> is raised.</p>
</dd></dl>

</dd></dl>

</div>
</div>
</div>
</div>
<span id="document-reference/streamfield/index"></span><div class="section" id="streamfield-reference">
<h4>StreamField reference<a class="headerlink" href="#streamfield-reference" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-reference/streamfield/blocks"></span><div class="section" id="streamfield-block-reference">
<span id="id1"></span><h5>StreamField block reference<a class="headerlink" href="#streamfield-block-reference" title="Permalink to this headline">¶</a></h5>
<p>This document details the block types provided by Wagtail for use in <a class="reference internal" href="index.html#streamfield"><span class="std std-ref">StreamField</span></a>, and how they can be combined into new block types.</p>
<dl class="class">
<dt id="wagtail.core.fields.StreamField">
<em class="property">class </em><code class="descclassname">wagtail.core.fields.</code><code class="descname">StreamField</code><span class="sig-paren">(</span><em>blocks</em>, <em>blank=False</em>, <em>min_num=None</em>, <em>max_num=None</em>, <em>block_counts=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.fields.StreamField" title="Permalink to this definition">¶</a></dt>
<dd><p>A model field for representing long-form content as a sequence of content blocks of various types. See <a class="reference internal" href="index.html#streamfield"><span class="std std-ref">How to use StreamField for mixed content</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>blocks</strong> – A list of block types, passed as either a list of <code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">block_definition)</span></code> tuples or a <code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> instance.</li>
<li><strong>blank</strong> – When false (the default), at least one block must be provided for the field to be considered valid.</li>
<li><strong>min_num</strong> – Minimum number of sub-blocks that the stream must have.</li>
<li><strong>max_num</strong> – Maximum number of sub-blocks that the stream may have.</li>
<li><strong>block_counts</strong> – Specifies the minimum and maximum number of each block type, as a dictionary mapping block names to dicts with (optional) <code class="docutils literal notranslate"><span class="pre">min_num</span></code> and <code class="docutils literal notranslate"><span class="pre">max_num</span></code> fields.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;paragraph&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
<span class="p">],</span> <span class="n">block_counts</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;heading&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;min_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;max_num&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
<span class="p">})</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.13: </span>The <code class="docutils literal notranslate"><span class="pre">min_num</span></code>, <code class="docutils literal notranslate"><span class="pre">max_num</span></code> and <code class="docutils literal notranslate"><span class="pre">block_counts</span></code> arguments were added. Previously, these were only available on the <code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> definition.</p>
</div>
</dd></dl>

<div class="section" id="block-options">
<h6>Block options<a class="headerlink" href="#block-options" title="Permalink to this headline">¶</a></h6>
<p>All block definitions accept the following optional keyword arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">default</span></code></dt>
<dd>The default value that a new ‘empty’ block should receive.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">label</span></code></dt>
<dd>The label to display in the editor interface when referring to this block - defaults to a prettified version of the block name (or, in a context where no name is assigned - such as within a <code class="docutils literal notranslate"><span class="pre">ListBlock</span></code> - the empty string).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">icon</span></code></dt>
<dd>The name of the icon to display for this block type in the menu of available block types. For a list of icon names, see the Wagtail style guide, which can be enabled by adding <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.styleguide</span></code> to your project’s <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">template</span></code></dt>
<dd>The path to a Django template that will be used to render this block on the front end. See <a class="reference internal" href="index.html#streamfield-template-rendering"><span class="std std-ref">Template rendering</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">group</span></code></dt>
<dd>The group used to categorize this block, i.e. any blocks with the same group name will be shown together in the editor interface with the group name as a heading.</dd>
</dl>
</div>
<div class="section" id="field-block-types">
<h6>Field block types<a class="headerlink" href="#field-block-types" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="wagtail.core.blocks.CharBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">CharBlock</code><a class="headerlink" href="#wagtail.core.blocks.CharBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A single-line text input. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>max_length</strong> – The maximum allowed length of the field.</li>
<li><strong>min_length</strong> – The minimum allowed length of the field.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.TextBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">TextBlock</code><a class="headerlink" href="#wagtail.core.blocks.TextBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A multi-line text input. As with <code class="docutils literal notranslate"><span class="pre">CharBlock</span></code>, the following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>max_length</strong> – The maximum allowed length of the field.</li>
<li><strong>min_length</strong> – The minimum allowed length of the field.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.EmailBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">EmailBlock</code><a class="headerlink" href="#wagtail.core.blocks.EmailBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A single-line email input that validates that the value is a valid e-mail address. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.IntegerBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">IntegerBlock</code><a class="headerlink" href="#wagtail.core.blocks.IntegerBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A single-line integer input that validates that the value is a valid whole number. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>max_value</strong> – The maximum allowed numeric value of the field.</li>
<li><strong>min_value</strong> – The minimum allowed numeric value of the field.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.FloatBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">FloatBlock</code><a class="headerlink" href="#wagtail.core.blocks.FloatBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A single-line Float input that validates that the value is a valid floating point number. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>max_value</strong> – The maximum allowed numeric value of the field.</li>
<li><strong>min_value</strong> – The minimum allowed numeric value of the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.DecimalBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">DecimalBlock</code><a class="headerlink" href="#wagtail.core.blocks.DecimalBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A single-line decimal input that validates that the value is a valid decimal number. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>max_value</strong> – The maximum allowed numeric value of the field.</li>
<li><strong>min_value</strong> – The minimum allowed numeric value of the field.</li>
<li><strong>max_digits</strong> – The maximum number of digits allowed in the number. This number must be greater than or equal to <code class="docutils literal notranslate"><span class="pre">decimal_places</span></code>.</li>
<li><strong>decimal_places</strong> – The number of decimal places to store with the number.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.RegexBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">RegexBlock</code><a class="headerlink" href="#wagtail.core.blocks.RegexBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A single-line text input that validates a string against a regular expression. The regular expression used for validation must be supplied as the first argument, or as the keyword argument <code class="docutils literal notranslate"><span class="pre">regex</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">blocks</span><span class="o">.</span><span class="n">RegexBlock</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;^[0-9]</span><span class="si">{3}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">error_messages</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s2">&quot;Not a valid library card number.&quot;</span>
<span class="p">})</span>
</pre></div>
</div>
<p>The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>regex</strong> – Regular expression to validate against.</li>
<li><strong>error_messages</strong> – Dictionary of error messages, containing either or both of the keys <code class="docutils literal notranslate"><span class="pre">required</span></code> (for the message shown on an empty value) or <code class="docutils literal notranslate"><span class="pre">invalid</span></code> (for the message shown on a non-matching value).</li>
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>max_length</strong> – The maximum allowed length of the field.</li>
<li><strong>min_length</strong> – The minimum allowed length of the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.URLBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">URLBlock</code><a class="headerlink" href="#wagtail.core.blocks.URLBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A single-line text input that validates that the string is a valid URL. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>max_length</strong> – The maximum allowed length of the field.</li>
<li><strong>min_length</strong> – The minimum allowed length of the field.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.BooleanBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">BooleanBlock</code><a class="headerlink" href="#wagtail.core.blocks.BooleanBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A checkbox. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the checkbox must be ticked to proceed. As with Django’s <code class="docutils literal notranslate"><span class="pre">BooleanField</span></code>, a checkbox that can be left ticked or unticked must be explicitly denoted with <code class="docutils literal notranslate"><span class="pre">required=False</span></code>.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.DateBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">DateBlock</code><a class="headerlink" href="#wagtail.core.blocks.DateBlock" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div>A date picker. The following keyword arguments are accepted in addition to the standard ones:</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>format</strong> – Date format. This must be one of the recognised formats listed in the <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/settings/#std:setting-DATE_INPUT_FORMATS">DATE_INPUT_FORMATS</a> setting. If not specified Wagtail will use the <code class="docutils literal notranslate"><span class="pre">WAGTAIL_DATE_FORMAT</span></code> setting with fallback to ‘%Y-%m-%d’.</li>
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.TimeBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">TimeBlock</code><a class="headerlink" href="#wagtail.core.blocks.TimeBlock" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div>A time picker. The following keyword arguments are accepted in addition to the standard ones:</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.DateTimeBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">DateTimeBlock</code><a class="headerlink" href="#wagtail.core.blocks.DateTimeBlock" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div>A combined date / time picker. The following keyword arguments are accepted in addition to the standard ones:</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>format</strong> – Date/time format. This must be one of the recognised formats listed in the <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/settings/#std:setting-DATETIME_INPUT_FORMATS">DATETIME_INPUT_FORMATS</a> setting. If not specified Wagtail will use the <code class="docutils literal notranslate"><span class="pre">WAGTAIL_DATETIME_FORMAT</span></code> setting with fallback to ‘%Y-%m-%d %H:%M’.</li>
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.RichTextBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">RichTextBlock</code><a class="headerlink" href="#wagtail.core.blocks.RichTextBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A WYSIWYG editor for creating formatted text including links, bold / italics etc. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>editor</strong> – The rich text editor to be used (see <a class="reference internal" href="index.html#wagtailadmin-rich-text-editors"><span class="std std-ref">Rich text</span></a>).</li>
<li><strong>features</strong> – Specifies the set of features allowed (see <a class="reference internal" href="index.html#rich-text-features"><span class="std std-ref">Limiting features in a rich text field</span></a>).</li>
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.RawHTMLBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">RawHTMLBlock</code><a class="headerlink" href="#wagtail.core.blocks.RawHTMLBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A text area for entering raw HTML which will be rendered unescaped in the page output. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>max_length</strong> – The maximum allowed length of the field.</li>
<li><strong>min_length</strong> – The minimum allowed length of the field.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When this block is in use, there is nothing to prevent editors from inserting malicious scripts into the page, including scripts that would allow the editor to acquire administrator privileges when another administrator views the page. Do not use this block unless your editors are fully trusted.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.BlockQuoteBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">BlockQuoteBlock</code><a class="headerlink" href="#wagtail.core.blocks.BlockQuoteBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A text field, the contents of which will be wrapped in an HTML <cite>&lt;blockquote&gt;</cite> tag pair in the page output. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>max_length</strong> – The maximum allowed length of the field.</li>
<li><strong>min_length</strong> – The minimum allowed length of the field.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.ChoiceBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">ChoiceBlock</code><a class="headerlink" href="#wagtail.core.blocks.ChoiceBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A dropdown select box for choosing one item from a list of choices. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>choices</strong> – A list of choices, in any format accepted by Django’s <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/fields/#django.db.models.Field.choices" title="(in Django v3.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">choices</span></code></a> parameter for model fields, or a callable returning such a list.</li>
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>widget</strong> – The form widget to render the field with (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/forms/widgets/">Django Widgets</a>).</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">ChoiceBlock</span></code> can also be subclassed to produce a reusable block with the same list of choices everywhere it is used. For example, a block definition such as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">blocks</span><span class="o">.</span><span class="n">ChoiceBlock</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;tea&#39;</span><span class="p">,</span> <span class="s1">&#39;Tea&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;coffee&#39;</span><span class="p">,</span> <span class="s1">&#39;Coffee&#39;</span><span class="p">),</span>
<span class="p">],</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;cup&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>could be rewritten as a subclass of ChoiceBlock:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DrinksChoiceBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">ChoiceBlock</span><span class="p">):</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;tea&#39;</span><span class="p">,</span> <span class="s1">&#39;Tea&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;coffee&#39;</span><span class="p">,</span> <span class="s1">&#39;Coffee&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s1">&#39;cup&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">StreamField</span></code> definitions can then refer to <code class="docutils literal notranslate"><span class="pre">DrinksChoiceBlock()</span></code> in place of the full <code class="docutils literal notranslate"><span class="pre">ChoiceBlock</span></code> definition. Note that this only works when <code class="docutils literal notranslate"><span class="pre">choices</span></code> is a fixed list, not a callable.</p>
</dd></dl>

<span class="target" id="streamfield-multiplechoiceblock"></span><dl class="class">
<dt id="wagtail.core.blocks.MultipleChoiceBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">MultipleChoiceBlock</code><a class="headerlink" href="#wagtail.core.blocks.MultipleChoiceBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A select box for choosing multiple items from a list of choices. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>choices</strong> – A list of choices, in any format accepted by Django’s <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/fields/#django.db.models.Field.choices" title="(in Django v3.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">choices</span></code></a> parameter for model fields, or a callable returning such a list.</li>
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
<li><strong>widget</strong> – The form widget to render the field with (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/forms/widgets/">Django Widgets</a>).</li>
<li><strong>validators</strong> – A list of validation functions for the field (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/validators/">Django Validators</a>).</li>
<li><strong>form_classname</strong> – A value to add to the form field’s <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute when rendered on the page editing form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.PageChooserBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">PageChooserBlock</code><a class="headerlink" href="#wagtail.core.blocks.PageChooserBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A control for selecting a page object, using Wagtail’s page browser. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>page_type</strong> – Restrict choices to one or more specific page types; by default, any page type may be selected. Can be specified as a page model class, model name (as a string), or a list or tuple of these.</li>
<li><strong>can_choose_root</strong> – Defaults to false. If true, the editor can choose the tree root as a page. Normally this would be undesirable, since the tree root is never a usable page, but in some specialised cases it may be appropriate. For example, a block providing a feed of related articles could use a PageChooserBlock to select which subsection of the site articles will be taken from, with the root corresponding to ‘everywhere’.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.documents.blocks.DocumentChooserBlock">
<em class="property">class </em><code class="descclassname">wagtail.documents.blocks.</code><code class="descname">DocumentChooserBlock</code><a class="headerlink" href="#wagtail.documents.blocks.DocumentChooserBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A control to allow the editor to select an existing document object, or upload a new one. The following additional keyword argument is accepted:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>required</strong> – If true (the default), the field cannot be left blank.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.images.blocks.ImageChooserBlock">
<em class="property">class </em><code class="descclassname">wagtail.images.blocks.</code><code class="descname">ImageChooserBlock</code><a class="headerlink" href="#wagtail.images.blocks.ImageChooserBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A control to allow the editor to select an existing image, or upload a new one. The following additional keyword argument is accepted:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>required</strong> – If true (the default), the field cannot be left blank.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.snippets.blocks.SnippetChooserBlock">
<em class="property">class </em><code class="descclassname">wagtail.snippets.blocks.</code><code class="descname">SnippetChooserBlock</code><a class="headerlink" href="#wagtail.snippets.blocks.SnippetChooserBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A control to allow the editor to select a snippet object. Requires one positional argument: the snippet class to choose from. The following additional keyword argument is accepted:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>required</strong> – If true (the default), the field cannot be left blank.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.embeds.blocks.EmbedBlock">
<em class="property">class </em><code class="descclassname">wagtail.embeds.blocks.</code><code class="descname">EmbedBlock</code><a class="headerlink" href="#wagtail.embeds.blocks.EmbedBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A field for the editor to enter a URL to a media item (such as a YouTube video) to appear as embedded media on the page. The following keyword arguments are accepted in addition to the standard ones:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), the field cannot be left blank.</li>
<li><strong>max_width</strong> – The maximum width of the embed, in pixels; this will be passed to the provider when requesting the embed.</li>
<li><strong>max_height</strong> – The maximum height of the embed, in pixels; this will be passed to the provider when requesting the embed.</li>
<li><strong>max_length</strong> – The maximum allowed length of the field.</li>
<li><strong>min_length</strong> – The minimum allowed length of the field.</li>
<li><strong>help_text</strong> – Help text to display alongside the field.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="structural-block-types">
<h6>Structural block types<a class="headerlink" href="#structural-block-types" title="Permalink to this headline">¶</a></h6>
<span class="target" id="streamfield-staticblock"></span><dl class="class">
<dt id="wagtail.core.blocks.StaticBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">StaticBlock</code><a class="headerlink" href="#wagtail.core.blocks.StaticBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A block which doesn’t have any fields, thus passes no particular values to its template during rendering. This can be useful if you need the editor to be able to insert some content which is always the same or doesn’t need to be configured within the page editor, such as an address, embed code from third-party services, or more complex pieces of code if the template uses template tags. The following additional keyword argument is accepted:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>admin_text</strong> – A text string to display in the admin when this block is used. By default, some default text (which contains the <code class="docutils literal notranslate"><span class="pre">label</span></code> keyword argument if you pass it) will be displayed in the editor interface, so that the block doesn’t look empty, but this can be customised by passing <code class="docutils literal notranslate"><span class="pre">admin_text</span></code>:</td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">blocks</span><span class="o">.</span><span class="n">StaticBlock</span><span class="p">(</span>
    <span class="n">admin_text</span><span class="o">=</span><span class="s1">&#39;Latest posts: no configuration needed.&#39;</span><span class="p">,</span>
    <span class="c1"># or admin_text=mark_safe(&#39;&lt;b&gt;Latest posts&lt;/b&gt;: no configuration needed.&#39;),</span>
    <span class="n">template</span><span class="o">=</span><span class="s1">&#39;latest_posts.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">StaticBlock</span></code> can also be subclassed to produce a reusable block with the same configuration everywhere it is used:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LatestPostsStaticBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StaticBlock</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Latest posts&#39;</span>
        <span class="n">admin_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{label}</span><span class="s1">: configured elsewhere&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;latest_posts.html&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.StructBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">StructBlock</code><a class="headerlink" href="#wagtail.core.blocks.StructBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A block consisting of a fixed group of sub-blocks to be displayed together. Takes a list of <code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">block_definition)</span></code> tuples as its first argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
    <span class="c1"># ...</span>
    <span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
        <span class="p">(</span><span class="s1">&#39;surname&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
        <span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;biography&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
    <span class="p">],</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)),</span>
<span class="p">])</span>
</pre></div>
</div>
<p>Alternatively, StructBlock can be subclassed to specify a reusable set of sub-blocks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PersonBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">surname</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">ImageChooserBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">biography</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Meta</span></code> class supports the properties <code class="docutils literal notranslate"><span class="pre">default</span></code>, <code class="docutils literal notranslate"><span class="pre">label</span></code>, <code class="docutils literal notranslate"><span class="pre">icon</span></code> and <code class="docutils literal notranslate"><span class="pre">template</span></code>, which have the same meanings as when they are passed to the block’s constructor.</p>
<p>This defines <code class="docutils literal notranslate"><span class="pre">PersonBlock()</span></code> as a block type for use in StreamField definitions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">form_classname</span><span class="o">=</span><span class="s2">&quot;full title&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;paragraph&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">PersonBlock</span><span class="p">()),</span>
<span class="p">])</span>
</pre></div>
</div>
<p>The following additional options are available as either keyword arguments or Meta class attributes:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>form_classname</strong> – An HTML <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute to set on the root element of this block as displayed in the editing interface. Defaults to <code class="docutils literal notranslate"><span class="pre">struct-block</span></code>; note that the admin interface has CSS styles defined on this class, so it is advised to include <code class="docutils literal notranslate"><span class="pre">struct-block</span></code> in this value when overriding. See <a class="reference internal" href="index.html#custom-editing-interfaces-for-structblock"><span class="std std-ref">Custom editing interfaces for StructBlock</span></a>.</li>
<li><strong>form_template</strong> – Path to a Django template to use to render this block’s form. See <a class="reference internal" href="index.html#custom-editing-interfaces-for-structblock"><span class="std std-ref">Custom editing interfaces for StructBlock</span></a>.</li>
<li><strong>value_class</strong> – A subclass of <code class="docutils literal notranslate"><span class="pre">wagtail.core.blocks.StructValue</span></code> to use as the type of returned values for this block. See <a class="reference internal" href="index.html#custom-value-class-for-structblock"><span class="std std-ref">Additional methods and properties on StructBlock values</span></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.ListBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">ListBlock</code><a class="headerlink" href="#wagtail.core.blocks.ListBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A block consisting of many sub-blocks, all of the same type. The editor can add an unlimited number of sub-blocks, and re-order and delete them. Takes the definition of the sub-block as its first argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
    <span class="c1"># ...</span>
    <span class="p">(</span><span class="s1">&#39;ingredients_list&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">ListBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ingredient&quot;</span><span class="p">))),</span>
<span class="p">])</span>
</pre></div>
</div>
<p>Any block type is valid as the sub-block type, including structural types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
    <span class="c1"># ...</span>
    <span class="p">(</span><span class="s1">&#39;ingredients_list&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">ListBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;ingredient&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
        <span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="p">]))),</span>
<span class="p">])</span>
</pre></div>
</div>
<p>The following additional options are available as either keyword arguments or Meta class attributes:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>form_classname</strong> – An HTML <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute to set on the root element of this block as displayed in the editing interface.</li>
<li><strong>min_num</strong> – Minimum number of sub-blocks that the list must have.</li>
<li><strong>max_num</strong> – Maximum number of sub-blocks that the list may have.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wagtail.core.blocks.StreamBlock">
<em class="property">class </em><code class="descclassname">wagtail.core.blocks.</code><code class="descname">StreamBlock</code><a class="headerlink" href="#wagtail.core.blocks.StreamBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A block consisting of a sequence of sub-blocks of different types, which can be mixed and reordered at will. Used as the overall mechanism of the StreamField itself, but can also be nested or used within other structural block types. Takes a list of <code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">block_definition)</span></code> tuples as its first argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
    <span class="c1"># ...</span>
    <span class="p">(</span><span class="s1">&#39;carousel&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">StreamBlock</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">ImageChooserBlock</span><span class="p">()),</span>
            <span class="p">(</span><span class="s1">&#39;quotation&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">TextBlock</span><span class="p">()),</span>
                <span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
            <span class="p">])),</span>
            <span class="p">(</span><span class="s1">&#39;video&#39;</span><span class="p">,</span> <span class="n">EmbedBlock</span><span class="p">()),</span>
        <span class="p">],</span>
        <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;cogs&#39;</span>
    <span class="p">)),</span>
<span class="p">])</span>
</pre></div>
</div>
<p>As with StructBlock, the list of sub-blocks can also be provided as a subclass of StreamBlock:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CarouselBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StreamBlock</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChooserBlock</span><span class="p">()</span>
    <span class="n">quotation</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">TextBlock</span><span class="p">()),</span>
        <span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
    <span class="p">])</span>
    <span class="n">video</span> <span class="o">=</span> <span class="n">EmbedBlock</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;cogs&#39;</span>
</pre></div>
</div>
<p id="streamfield-top-level-streamblock">Since <code class="docutils literal notranslate"><span class="pre">StreamField</span></code> accepts an instance of <code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> as a parameter, in place of a list of block types, this makes it possible to re-use a common set of block types without repeating definitions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HomePage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">carousel</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">(</span><span class="n">CarouselBlock</span><span class="p">(</span><span class="n">max_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">block_counts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;video&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;max_num&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}}))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> accepts the following additional options as either keyword arguments or <code class="docutils literal notranslate"><span class="pre">Meta</span></code> properties:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>required</strong> – If true (the default), at least one sub-block must be supplied. This is ignored when using the <code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> as the top-level block of a StreamField; in this case the StreamField’s <code class="docutils literal notranslate"><span class="pre">blank</span></code> property is respected instead.</li>
<li><strong>min_num</strong> – Minimum number of sub-blocks that the stream must have.</li>
<li><strong>max_num</strong> – Maximum number of sub-blocks that the stream may have.</li>
<li><strong>block_counts</strong> – Specifies the minimum and maximum number of each block type, as a dictionary mapping block names to dicts with (optional) <code class="docutils literal notranslate"><span class="pre">min_num</span></code> and <code class="docutils literal notranslate"><span class="pre">max_num</span></code> fields.</li>
<li><strong>form_classname</strong> – <p>An HTML <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute to set on the root element of this block as displayed in the editing interface.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">([</span>
    <span class="c1"># ...</span>
    <span class="p">(</span><span class="s1">&#39;event_promotions&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">StreamBlock</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;hashtag&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()),</span>
        <span class="p">(</span><span class="s1">&#39;post_date&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">DateBlock</span><span class="p">()),</span>
<span class="hll">    <span class="p">],</span> <span class="n">form_classname</span><span class="o">=</span><span class="s1">&#39;event-promotions&#39;</span><span class="p">)),</span>
</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EventPromotionsBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StreamBlock</span><span class="p">):</span>
    <span class="n">hashtag</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">()</span>
    <span class="n">post_date</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">DateBlock</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="hll">        <span class="n">form_classname</span> <span class="o">=</span> <span class="s1">&#39;event-promotions&#39;</span>
</span></pre></div>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<span id="document-reference/streamfield/widget_api"></span><div class="section" id="form-widget-client-side-api">
<span id="streamfield-widget-api"></span><h5>Form widget client-side API<a class="headerlink" href="#form-widget-client-side-api" title="Permalink to this headline">¶</a></h5>
<p>In order for the StreamField editing interface to dynamically create form fields, any Django form widgets used within StreamField blocks must have an accompanying JavaScript implementation, defining how the widget is rendered client-side and populated with data, and how to extract data from that field. Wagtail provides this implementation for widgets inheriting from <code class="docutils literal notranslate"><span class="pre">django.forms.widgets.Input</span></code>, <code class="docutils literal notranslate"><span class="pre">django.forms.Textarea</span></code>, <code class="docutils literal notranslate"><span class="pre">django.forms.Select</span></code> and <code class="docutils literal notranslate"><span class="pre">django.forms.RadioSelect</span></code>. For any other widget types, or ones which require custom client-side behaviour, you will need to provide your own implementation.</p>
<p>The <a class="reference external" href="https://wagtail.github.io/telepath/">telepath</a> library is used to set up mappings between Python widget classes and their corresponding JavaScript implementations. To create a mapping, define a subclass of <code class="docutils literal notranslate"><span class="pre">wagtail.core.widget_adapters.WidgetAdapter</span></code> and register it with <code class="docutils literal notranslate"><span class="pre">wagtail.core.telepath.register</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core.telepath</span> <span class="kn">import</span> <span class="n">register</span>
<span class="kn">from</span> <span class="nn">wagtail.core.widget_adapters</span> <span class="kn">import</span> <span class="n">WidgetAdapter</span>

<span class="k">class</span> <span class="nc">FancyInputAdapter</span><span class="p">(</span><span class="n">WidgetAdapter</span><span class="p">):</span>
    <span class="c1"># Identifier matching the one registered on the client side</span>
    <span class="n">js_constructor</span> <span class="o">=</span> <span class="s1">&#39;myapp.widgets.FancyInput&#39;</span>

    <span class="c1"># Arguments passed to the client-side object</span>
    <span class="k">def</span> <span class="nf">js_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="c1"># Arguments typically include the widget&#39;s HTML representation</span>
            <span class="c1"># and label ID rendered with __NAME__ and __ID__ placeholders,</span>
            <span class="c1"># for use in the client-side render() method</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;__NAME__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;__ID__&#39;</span><span class="p">}),</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">id_for_label</span><span class="p">(</span><span class="s1">&#39;__ID__&#39;</span><span class="p">),</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">extra_options</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="k">class</span> <span class="nc">Media</span><span class="p">:</span>
        <span class="c1"># JS / CSS includes required in addition to the widget&#39;s own media;</span>
        <span class="c1"># generally this will include the client-side adapter definition</span>
        <span class="n">js</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;myapp/js/fancy-input-adapter.js&#39;</span><span class="p">]</span>


<span class="n">register</span><span class="p">(</span><span class="n">FancyInputAdapter</span><span class="p">(),</span> <span class="n">FancyInput</span><span class="p">)</span>
</pre></div>
</div>
<p>The JavaScript object associated with a widget instance should provide a single method:</p>
<dl class="function">
<dt id="render">
<code class="descname">render</code><span class="sig-paren">(</span><em>placeholder</em>, <em>name</em>, <em>id</em>, <em>initialState</em><span class="sig-paren">)</span><a class="headerlink" href="#render" title="Permalink to this definition">¶</a></dt>
<dd><p>Render a copy of this widget into the current page, and perform any initialisation required.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>placeholder</strong> – An HTML DOM element to be replaced by the widget’s HTML.</li>
<li><strong>name</strong> – A string to be used as the <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute on the input element. For widgets that use multiple input elements (and have server-side logic for collating them back into a final value), this can be treated as a prefix, with further elements delimited by dashes. (For example, if <code class="docutils literal notranslate"><span class="pre">name</span></code> is <code class="docutils literal notranslate"><span class="pre">'person-0'</span></code>, the widget may create elements with names <code class="docutils literal notranslate"><span class="pre">person-0-first_name</span></code> and <code class="docutils literal notranslate"><span class="pre">person-0-surname</span></code> without risking collisions with other field names on the form.)</li>
<li><strong>id</strong> – A string to be used as the <code class="docutils literal notranslate"><span class="pre">id</span></code> attribute on the input element. As with <code class="docutils literal notranslate"><span class="pre">name</span></code>, this can be treated as a prefix for any further identifiers.</li>
<li><strong>initialState</strong> – The initial data to populate the widget with.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>A widget’s state will often be the same as the form field’s value, but may contain additional data beyond what is processed in the form submission. For example, a page chooser widget consists of a hidden form field containing the page ID, and a read-only label showing the page title: in this case, the page ID by itself does not provide enough information to render the widget, and so the state is defined as a dictionary with <cite>id</cite> and <cite>title</cite> items.</p>
<p>The value returned by <code class="docutils literal notranslate"><span class="pre">render</span></code> is a ‘bound widget’ object allowing this widget instance’s data to be accessed. This object should implement the following attributes and methods:</p>
<dl class="attribute">
<dt id="idForLabel">
<code class="descname">idForLabel</code><a class="headerlink" href="#idForLabel" title="Permalink to this definition">¶</a></dt>
<dd><p>The HTML ID to use as the <code class="docutils literal notranslate"><span class="pre">for</span></code> attribute of a label referencing this widget, or null if no suitable HTML element exists.</p>
</dd></dl>

<dl class="function">
<dt id="getValue">
<code class="descname">getValue</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#getValue" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the submittable value of this widget (typically the same as the input element’s value).</p>
</dd></dl>

<dl class="function">
<dt id="getState">
<code class="descname">getState</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#getState" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the internal state of this widget, as a value suitable for passing as the <code class="docutils literal notranslate"><span class="pre">render</span></code> method’s <code class="docutils literal notranslate"><span class="pre">initialState</span></code> argument.</p>
</dd></dl>

<dl class="function">
<dt id="setState">
<code class="descname">setState</code><span class="sig-paren">(</span><em>newState</em><span class="sig-paren">)</span><a class="headerlink" href="#setState" title="Permalink to this definition">¶</a></dt>
<dd><p>Optional: updates this widget’s internal state to the passed value.</p>
</dd></dl>

<dl class="function">
<dt id="focus">
<code class="descname">focus</code><span class="sig-paren">(</span><em>soft</em><span class="sig-paren">)</span><a class="headerlink" href="#focus" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the browser’s focus to this widget, so that it receives input events. Widgets that do not have a concept of focus should do nothing. If <code class="docutils literal notranslate"><span class="pre">soft</span></code> is true, this indicates that the focus event was not explicitly triggered by a user action (for example, when a new block is inserted, and the first field is focused as a convenience to the user) - in this case, the widget should avoid performing obtrusive UI actions such as opening modals.</p>
</dd></dl>

</div>
</div>
<div class="section" id="blocks">
<h5><a class="reference internal" href="index.html#document-reference/streamfield/blocks"><span class="doc">StreamField block reference</span></a><a class="headerlink" href="#blocks" title="Permalink to this headline">¶</a></h5>
<p>Details the block types provided by Wagtail for use in StreamField and how they can be combined into new block types.</p>
</div>
<div class="section" id="widget-api">
<h5><a class="reference internal" href="index.html#document-reference/streamfield/widget_api"><span class="doc">Form widget client-side API</span></a><a class="headerlink" href="#widget-api" title="Permalink to this headline">¶</a></h5>
<p>Defines the JavaScript API that must be implemented for any form widget used within a StreamField block.</p>
</div>
</div>
<span id="document-reference/contrib/index"></span><div class="section" id="contrib-modules">
<h4>Contrib modules<a class="headerlink" href="#contrib-modules" title="Permalink to this headline">¶</a></h4>
<p>Wagtail ships with a variety of extra optional modules.</p>
<div class="toctree-wrapper compound">
<span id="document-reference/contrib/settings"></span><div class="section" id="site-settings">
<span id="settings"></span><h5>Site settings<a class="headerlink" href="#site-settings" title="Permalink to this headline">¶</a></h5>
<p>You can define settings for your site that are editable by administrators in the Wagtail admin. These settings can be accessed in code, as well as in templates.</p>
<p>To use these settings, you must add <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.settings</span></code> to your <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="s1">&#39;wagtail.contrib.settings&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="defining-settings">
<h6>Defining settings<a class="headerlink" href="#defining-settings" title="Permalink to this headline">¶</a></h6>
<p>Create a model that inherits from <code class="docutils literal notranslate"><span class="pre">BaseSetting</span></code>, and register it using the <code class="docutils literal notranslate"><span class="pre">register_setting</span></code> decorator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.settings.models</span> <span class="kn">import</span> <span class="n">BaseSetting</span><span class="p">,</span> <span class="n">register_setting</span>

<span class="nd">@register_setting</span>
<span class="k">class</span> <span class="nc">SocialMediaSettings</span><span class="p">(</span><span class="n">BaseSetting</span><span class="p">):</span>
    <span class="n">facebook</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Your Facebook page URL&#39;</span><span class="p">)</span>
    <span class="n">instagram</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Your Instagram username, without the @&#39;</span><span class="p">)</span>
    <span class="n">trip_advisor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Your Trip Advisor page URL&#39;</span><span class="p">)</span>
    <span class="n">youtube</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Your YouTube channel or user account URL&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A ‘Social media settings’ link will appear in the Wagtail admin ‘Settings’ menu.</p>
<div class="section" id="edit-handlers">
<span id="edit-handlers-settings"></span><h7>Edit handlers<a class="headerlink" href="#edit-handlers" title="Permalink to this headline">¶</a></h7>
<p>Settings use edit handlers much like the rest of Wagtail.  Add a <code class="docutils literal notranslate"><span class="pre">panels</span></code> setting to your model defining all the edit handlers required:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_setting</span>
<span class="k">class</span> <span class="nc">ImportantPages</span><span class="p">(</span><span class="n">BaseSetting</span><span class="p">):</span>
    <span class="n">donate_page</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;wagtailcore.Page&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
    <span class="n">sign_up_page</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;wagtailcore.Page&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">PageChooserPanel</span><span class="p">(</span><span class="s1">&#39;donate_page&#39;</span><span class="p">),</span>
        <span class="n">PageChooserPanel</span><span class="p">(</span><span class="s1">&#39;sign_up_page&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>You can also customize the editor handlers <a class="reference internal" href="index.html#customising-the-tabbed-interface"><span class="std std-ref">like you would do for Page model</span></a>
with a custom <code class="docutils literal notranslate"><span class="pre">edit_handler</span></code> attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">TabbedInterface</span><span class="p">,</span> <span class="n">ObjectList</span>

<span class="nd">@register_setting</span>
<span class="k">class</span> <span class="nc">MySettings</span><span class="p">(</span><span class="n">BaseSetting</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">first_tab_panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;field_1&#39;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">second_tab_panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;field_2&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">edit_handler</span> <span class="o">=</span> <span class="n">TabbedInterface</span><span class="p">([</span>
        <span class="n">ObjectList</span><span class="p">(</span><span class="n">first_tab_panels</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s1">&#39;First tab&#39;</span><span class="p">),</span>
        <span class="n">ObjectList</span><span class="p">(</span><span class="n">second_tab_panels</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s1">&#39;Second tab&#39;</span><span class="p">),</span>
    <span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="appearance">
<h7>Appearance<a class="headerlink" href="#appearance" title="Permalink to this headline">¶</a></h7>
<p>You can change the label used in the menu by changing the <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/options/#django.db.models.Options.verbose_name" title="(in Django v3.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">verbose_name</span></code></a> of your model.</p>
<p>You can add an icon to the menu by passing an ‘icon’ argument to the <code class="docutils literal notranslate"><span class="pre">register_setting</span></code> decorator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_setting</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s1">&#39;placeholder&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SocialMediaSettings</span><span class="p">(</span><span class="n">BaseSetting</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;social media accounts&#39;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>For a list of all available icons, please see the <a class="reference internal" href="index.html#styleguide"><span class="std std-ref">UI Styleguide</span></a>.</p>
</div>
</div>
<div class="section" id="using-the-settings">
<h6>Using the settings<a class="headerlink" href="#using-the-settings" title="Permalink to this headline">¶</a></h6>
<p>Settings are designed to be used both in Python code, and in templates.</p>
<div class="section" id="using-in-python">
<h7>Using in Python<a class="headerlink" href="#using-in-python" title="Permalink to this headline">¶</a></h7>
<p>If you require access to a setting in a view, the <code class="xref py py-func docutils literal notranslate"><span class="pre">for_request()</span></code> method allows you to retrieve the relevant settings for the current request:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">social_media_settings</span> <span class="o">=</span> <span class="n">SocialMediaSettings</span><span class="o">.</span><span class="n">for_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>In places where the request is unavailable, but you know the <code class="docutils literal notranslate"><span class="pre">Site</span></code> you wish to retrieve settings for, you can use <code class="xref py py-func docutils literal notranslate"><span class="pre">for_site()</span></code> instead:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">social_media_settings</span> <span class="o">=</span>  <span class="n">SocialMediaSettings</span><span class="o">.</span><span class="n">for_site</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">origin_site</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-in-django-templates">
<h7>Using in Django templates<a class="headerlink" href="#using-in-django-templates" title="Permalink to this headline">¶</a></h7>
<p>Add the <code class="docutils literal notranslate"><span class="pre">settings</span></code> context processor to your settings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="o">...</span>

        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="o">...</span>

                <span class="s1">&#39;wagtail.contrib.settings.context_processors.settings&#39;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Then access the settings through <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">settings</span> <span class="pre">}}</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">settings.app_label.SocialMediaSettings.instagram</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Replace <code class="docutils literal notranslate"><span class="pre">app_label</span></code> with the label of the app containing your settings model.</p>
</div>
<p>If you are not in a <code class="docutils literal notranslate"><span class="pre">RequestContext</span></code>, then context processors will not have run, and the <code class="docutils literal notranslate"><span class="pre">settings</span></code> variable will not be available. To get the <code class="docutils literal notranslate"><span class="pre">settings</span></code>, use the provided <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_settings</span> <span class="pre">%}</span></code> template tag. If a <code class="docutils literal notranslate"><span class="pre">request</span></code> is in the template context, but for some reason it is not a <code class="docutils literal notranslate"><span class="pre">RequestContext</span></code>, just use <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_settings</span> <span class="pre">%}</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailsettings_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">get_settings</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">settings.app_label.SocialMediaSettings.instagram</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>If there is no <code class="docutils literal notranslate"><span class="pre">request</span></code> available in the template at all, you can use the settings for the default Wagtail site instead:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailsettings_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">get_settings</span> <span class="nv">use_default_site</span><span class="o">=</span><span class="kp">True</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">settings.app_label.SocialMediaSettings.instagram</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can not reliably get the correct settings instance for the current site from this template tag if the request object is not available. This is only relevant for multisite instances of Wagtail.</p>
</div>
<p>By default, the tag will create or update a <code class="docutils literal notranslate"><span class="pre">settings</span></code> variable in the context. If you want to
assign to a different context variable instead, use <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_settings</span> <span class="pre">as</span> <span class="pre">other_variable_name</span> <span class="pre">%}</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailsettings_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">get_settings</span> <span class="k">as</span> <span class="nv">wagtail_settings</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">wagtail_settings.app_label.SocialMediaSettings.instagram</span> <span class="cp">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="using-in-jinja2-templates">
<span id="settings-tag-jinja2"></span><h7>Using in Jinja2 templates<a class="headerlink" href="#using-in-jinja2-templates" title="Permalink to this headline">¶</a></h7>
<p>Add <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.settings.jinja2tags.settings</span></code> extension to your Jinja2 settings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.jinja2.Jinja2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;extensions&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="c1"># ...</span>
                <span class="s1">&#39;wagtail.contrib.settings.jinja2tags.settings&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Then access the settings through the <code class="docutils literal notranslate"><span class="pre">settings()</span></code> template function:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">settings</span><span class="o">(</span><span class="s2">&quot;app_label.SocialMediaSettings&quot;</span><span class="o">)</span><span class="nv">.twitter</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Replace <code class="docutils literal notranslate"><span class="pre">app_label</span></code> with the label of the app containing your settings model.</p>
</div>
<p>This will look for a <code class="docutils literal notranslate"><span class="pre">request</span></code> variable in the template context, and find the correct site to use from that. If for some reason you do not have a <code class="docutils literal notranslate"><span class="pre">request</span></code> available, you can instead use the settings defined for the default site:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">settings</span><span class="o">(</span><span class="s2">&quot;app_label.SocialMediaSettings&quot;</span><span class="o">,</span> <span class="nv">use_default_site</span><span class="o">=</span><span class="kp">True</span><span class="o">)</span><span class="nv">.instagram</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>You can store the settings instance in a variable to save some typing, if you have to use multiple values from one model:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">with</span> <span class="nv">social_settings</span><span class="o">=</span><span class="nv">settings</span><span class="o">(</span><span class="s2">&quot;app_label.SocialMediaSettings&quot;</span><span class="o">)</span> <span class="cp">%}</span>
    Follow us on Twitter at @<span class="cp">{{</span> <span class="nv">social_settings.twitter</span> <span class="cp">}}</span>,
    or Instagram at @<span class="cp">{{</span> <span class="nv">social_settings.instagram</span> <span class="cp">}}</span>.
<span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Or, alternately, using the <code class="docutils literal notranslate"><span class="pre">set</span></code> tag:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">set</span> <span class="nv">social_settings</span><span class="o">=</span><span class="nv">settings</span><span class="o">(</span><span class="s2">&quot;app_label.SocialMediaSettings&quot;</span><span class="o">)</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="utilising-select-related-to-improve-efficiency">
<h7>Utilising <code class="docutils literal notranslate"><span class="pre">select_related</span></code> to improve efficiency<a class="headerlink" href="#utilising-select-related-to-improve-efficiency" title="Permalink to this headline">¶</a></h7>
<p>For models with foreign key relationships to other objects (e.g. pages),
which are very often needed to output values in templates, you can set
the <code class="docutils literal notranslate"><span class="pre">select_related</span></code> attribute on your model to have Wagtail utilise
Django’s <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/querysets/#select-related">QuerySet.select_related()</a>
method to fetch the settings object and related objects in a single query.
With this, the initial query is more complex, but you will be able to
freely access the foreign key values without any additional queries,
making things more efficient overall.</p>
<p>Building on the <code class="docutils literal notranslate"><span class="pre">ImportantPages</span></code> example from the previous section, the
following shows how <code class="docutils literal notranslate"><span class="pre">select_related</span></code> can be set to improve efficiency:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_setting</span>
<span class="k">class</span> <span class="nc">ImportantPages</span><span class="p">(</span><span class="n">BaseSetting</span><span class="p">):</span>

<span class="hll">    <span class="c1"># Fetch these pages when looking up ImportantPages for or a site</span>
</span><span class="hll">    <span class="n">select_related</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;donate_page&quot;</span><span class="p">,</span> <span class="s2">&quot;sign_up_page&quot;</span><span class="p">]</span>
</span>
    <span class="n">donate_page</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;wagtailcore.Page&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
    <span class="n">sign_up_page</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;wagtailcore.Page&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">PageChooserPanel</span><span class="p">(</span><span class="s1">&#39;donate_page&#39;</span><span class="p">),</span>
        <span class="n">PageChooserPanel</span><span class="p">(</span><span class="s1">&#39;sign_up_page&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>With these additions, the following template code will now trigger
a single database query instead of three (one to fetch the settings,
and two more to fetch each page):</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">settings.app_label.ImportantPages.donate_page</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">settings.app_label.ImportantPages.sign_up_page</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="utilising-the-page-url-setting-shortcut">
<h7>Utilising the <code class="docutils literal notranslate"><span class="pre">page_url</span></code> setting shortcut<a class="headerlink" href="#utilising-the-page-url-setting-shortcut" title="Permalink to this headline">¶</a></h7>
<p>If, like in the previous section, your settings model references pages,
and you often need to output the URLs of those pages in your project,
you can likely use the setting model’s <code class="docutils literal notranslate"><span class="pre">page_url</span></code> shortcut to do that more
cleanly. For example, instead of doing the following:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">settings.app_label.ImportantPages.donate_page</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">settings.app_label.ImportantPages.sign_up_page</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>You could write:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">settings.app_label.ImportantPages.page_url.donate_page</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">settings.app_label.ImportantPages.page_url.sign_up_page</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">page_url</span></code> shortcut has a few of advantages over using the tag:</p>
<ol class="arabic simple">
<li>The ‘specific’ page is automatically fetched to generate the URL,
so you don’t have to worry about doing this (or forgetting to do this)
yourself.</li>
<li>The results are cached, so if you need to access the same page URL
in more than one place (e.g. in a form and in footer navigation), using
the <code class="docutils literal notranslate"><span class="pre">page_url</span></code> shortcut will be more efficient.</li>
<li>It’s more concise, and the syntax is the same whether using it in templates
or views (or other Python code), allowing you to write more consistent
code.</li>
</ol>
<p>When using the <code class="docutils literal notranslate"><span class="pre">page_url</span></code> shortcut, there are a couple of points worth noting:</p>
<ol class="arabic simple">
<li>The same limitations that apply to the <cite>{% pageurl %}</cite> tag apply to the
shortcut: If the settings are accessed from a template context where the
current request is not available, all URLs returned will include the
site’s scheme/domain, and URL generation will not be quite as efficient.</li>
<li>If using the shortcut in views or other Python code, the method will
raise an <code class="docutils literal notranslate"><span class="pre">AttributeError</span></code> if the attribute you request from <code class="docutils literal notranslate"><span class="pre">page_url</span></code>
is not an attribute on the settings object.</li>
<li>If the settings object DOES have the attribute, but the attribute returns
a value of <code class="docutils literal notranslate"><span class="pre">None</span></code> (or something that is not a <code class="docutils literal notranslate"><span class="pre">Page</span></code>), the shortcut
will return an empty string.</li>
</ol>
</div>
</div>
</div>
<span id="document-reference/contrib/forms/index"></span><div class="section" id="form-builder">
<span id="id1"></span><h5>Form builder<a class="headerlink" href="#form-builder" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">wagtailforms</span></code> module allows you to set up single-page forms, such as a ‘Contact us’ form, as pages of a Wagtail site. It provides a set of base models that site implementers can extend to create their own <code class="docutils literal notranslate"><span class="pre">FormPage</span></code> type with their own site-specific templates. Once a page type has been set up in this way, editors can build forms within the usual page editor, consisting of any number of fields. Form submissions are stored for later retrieval through a new ‘Forms’ section within the Wagtail admin interface; in addition, they can be optionally e-mailed to an address specified by the editor.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>wagtailforms is not a replacement for</strong> <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/forms/" title="(in Django v3.2)"><span class="xref std std-doc">Django’s form support</span></a>. It is designed as a way for page authors to build general-purpose data collection forms without having to write code. If you intend to build a form that assigns specific behaviour to individual fields (such as creating user accounts), or needs a custom HTML layout, you will almost certainly be better served by a standard Django form, where the fields are fixed in code rather than defined on-the-fly by a page author. See the <a class="reference external" href="https://github.com/gasman/wagtail-form-example/commits/master">wagtail-form-example project</a> for an example of integrating a Django form into a Wagtail page.</p>
</div>
<div class="section" id="usage">
<span id="form-builder-usage"></span><h6>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h6>
<p>Add <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.forms</span></code> to your <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
   <span class="o">...</span>
   <span class="s1">&#39;wagtail.contrib.forms&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Within the <code class="docutils literal notranslate"><span class="pre">models.py</span></code> of one of your apps, create a model that extends <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.forms.models.AbstractEmailForm</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">FieldRowPanel</span><span class="p">,</span>
    <span class="n">InlinePanel</span><span class="p">,</span> <span class="n">MultiFieldPanel</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="n">AbstractEmailForm</span><span class="p">,</span> <span class="n">AbstractFormField</span>


<span class="k">class</span> <span class="nc">FormField</span><span class="p">(</span><span class="n">AbstractFormField</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;FormPage&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;form_fields&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thank_you_text</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">AbstractEmailForm</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;form_fields&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Form fields&quot;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;thank_you_text&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">MultiFieldPanel</span><span class="p">([</span>
            <span class="n">FieldRowPanel</span><span class="p">([</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;from_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;to_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
            <span class="p">]),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="s2">&quot;Email&quot;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">AbstractEmailForm</span></code> defines the fields <code class="docutils literal notranslate"><span class="pre">to_address</span></code>, <code class="docutils literal notranslate"><span class="pre">from_address</span></code> and <code class="docutils literal notranslate"><span class="pre">subject</span></code>, and expects <code class="docutils literal notranslate"><span class="pre">form_fields</span></code> to be defined. Any additional fields are treated as ordinary page content - note that <code class="docutils literal notranslate"><span class="pre">FormPage</span></code> is responsible for serving both the form page itself and the landing page after submission, so the model definition should include all necessary content fields for both of those views.</p>
<p>Date and datetime values in a form response will be formatted with the <a class="reference external" href="https://docs.djangoproject.com/en/3.0/ref/settings/#short-date-format">SHORT_DATE_FORMAT</a> and <a class="reference external" href="https://docs.djangoproject.com/en/3.0/ref/settings/#short-datetime-format">SHORT_DATETIME_FORMAT</a> respectively. (see <a class="reference internal" href="index.html#form-builder-render-email"><span class="std std-ref">Custom render_email method</span></a> for how to customise the email content).</p>
<p>If you do not want your form page type to offer form-to-email functionality, you can inherit from AbstractForm instead of <code class="docutils literal notranslate"><span class="pre">AbstractEmailForm</span></code>, and omit the <code class="docutils literal notranslate"><span class="pre">to_address</span></code>, <code class="docutils literal notranslate"><span class="pre">from_address</span></code> and <code class="docutils literal notranslate"><span class="pre">subject</span></code> fields from the <code class="docutils literal notranslate"><span class="pre">content_panels</span></code> definition.</p>
<p>You now need to create two templates named <code class="docutils literal notranslate"><span class="pre">form_page.html</span></code> and <code class="docutils literal notranslate"><span class="pre">form_page_landing.html</span></code> (where <code class="docutils literal notranslate"><span class="pre">form_page</span></code> is the underscore-formatted version of the class name). <code class="docutils literal notranslate"><span class="pre">form_page.html</span></code> differs from a standard Wagtail template in that it is passed a variable <code class="docutils literal notranslate"><span class="pre">form</span></code>, containing a Django <code class="docutils literal notranslate"><span class="pre">Form</span></code> object, in addition to the usual <code class="docutils literal notranslate"><span class="pre">page</span></code> variable. A very basic template for the form would thus be:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="cp">{{</span> <span class="nv">page.intro</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">page</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
            <span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">form_page_landing.html</span></code> is a standard Wagtail template, displayed after the user makes a successful form submission, <cite>form_submission</cite> will available in this template. If you want to dynamically override the landing page template, you can do so with the <code class="docutils literal notranslate"><span class="pre">get_landing_page_template</span></code> method (in the same way that you would with <code class="docutils literal notranslate"><span class="pre">get_template</span></code>).</p>
</div>
<div class="section" id="displaying-form-submission-information">
<span id="wagtailforms-formsubmissionpanel"></span><h6>Displaying form submission information<a class="headerlink" href="#displaying-form-submission-information" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">FormSubmissionsPanel</span></code> can be added to your page’s panel definitions to display the number of form submissions and the time of the most recent submission, along with a quick link to access the full submission data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.forms.edit_handlers</span> <span class="kn">import</span> <span class="n">FormSubmissionsPanel</span>

<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">AbstractEmailForm</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FormSubmissionsPanel</span><span class="p">(),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="c1"># ...</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="index">
<h6>Index<a class="headerlink" href="#index" title="Permalink to this headline">¶</a></h6>
<div class="toctree-wrapper compound">
<span id="document-reference/contrib/forms/customisation"></span><div class="section" id="form-builder-customisation">
<h7>Form builder customisation<a class="headerlink" href="#form-builder-customisation" title="Permalink to this headline">¶</a></h7>
<p>For a basic usage example see <a class="reference internal" href="index.html#form-builder-usage"><span class="std std-ref">Usage</span></a>.</p>
<div class="section" id="custom-related-name-for-form-fields">
<h8>Custom <code class="docutils literal notranslate"><span class="pre">related_name</span></code> for form fields<a class="headerlink" href="#custom-related-name-for-form-fields" title="Permalink to this headline">¶</a></h8>
<p>If you want to change <code class="docutils literal notranslate"><span class="pre">related_name</span></code> for form fields
(by default <code class="docutils literal notranslate"><span class="pre">AbstractForm</span></code> and <code class="docutils literal notranslate"><span class="pre">AbstractEmailForm</span></code> expect <code class="docutils literal notranslate"><span class="pre">form_fields</span></code> to be defined),
you will need to override the <code class="docutils literal notranslate"><span class="pre">get_form_fields</span></code> method.
You can do this as shown below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">FieldRowPanel</span><span class="p">,</span>
    <span class="n">InlinePanel</span><span class="p">,</span> <span class="n">MultiFieldPanel</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="n">AbstractEmailForm</span><span class="p">,</span> <span class="n">AbstractFormField</span>


<span class="k">class</span> <span class="nc">FormField</span><span class="p">(</span><span class="n">AbstractFormField</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;FormPage&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;custom_form_fields&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thank_you_text</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">AbstractEmailForm</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;custom_form_fields&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Form fields&quot;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;thank_you_text&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">MultiFieldPanel</span><span class="p">([</span>
            <span class="n">FieldRowPanel</span><span class="p">([</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;from_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;to_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
            <span class="p">]),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="s2">&quot;Email&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_form_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_form_fields</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-form-submission-model">
<h8>Custom form submission model<a class="headerlink" href="#custom-form-submission-model" title="Permalink to this headline">¶</a></h8>
<p>If you need to save additional data, you can use a custom form submission model.
To do this, you need to:</p>
<ul class="simple">
<li>Define a model that extends <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.forms.models.AbstractFormSubmission</span></code>.</li>
<li>Override the <code class="docutils literal notranslate"><span class="pre">get_submission_class</span></code> and <code class="docutils literal notranslate"><span class="pre">process_form_submission</span></code> methods in your page model.</li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.core.serializers.json</span> <span class="kn">import</span> <span class="n">DjangoJSONEncoder</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">FieldRowPanel</span><span class="p">,</span>
    <span class="n">InlinePanel</span><span class="p">,</span> <span class="n">MultiFieldPanel</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="n">AbstractEmailForm</span><span class="p">,</span> <span class="n">AbstractFormField</span><span class="p">,</span> <span class="n">AbstractFormSubmission</span>


<span class="k">class</span> <span class="nc">FormField</span><span class="p">(</span><span class="n">AbstractFormField</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;FormPage&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;form_fields&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thank_you_text</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">AbstractEmailForm</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;form_fields&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Form fields&quot;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;thank_you_text&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">MultiFieldPanel</span><span class="p">([</span>
            <span class="n">FieldRowPanel</span><span class="p">([</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;from_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;to_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
            <span class="p">]),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="s2">&quot;Email&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_submission_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CustomFormSubmission</span>

    <span class="k">def</span> <span class="nf">process_form_submission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_submission_class</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">form_data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">DjangoJSONEncoder</span><span class="p">),</span>
            <span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">user</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">CustomFormSubmission</span><span class="p">(</span><span class="n">AbstractFormSubmission</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-custom-data-to-csv-export">
<h8>Add custom data to CSV export<a class="headerlink" href="#add-custom-data-to-csv-export" title="Permalink to this headline">¶</a></h8>
<p>If you want to add custom data to the CSV export, you will need to:</p>
<ul class="simple">
<li>Override the <code class="docutils literal notranslate"><span class="pre">get_data_fields</span></code> method in page model.</li>
<li>Override <code class="docutils literal notranslate"><span class="pre">get_data</span></code> in the submission model.</li>
</ul>
<p>The following example shows how to add a username to the CSV export:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.core.serializers.json</span> <span class="kn">import</span> <span class="n">DjangoJSONEncoder</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">FieldRowPanel</span><span class="p">,</span>
    <span class="n">InlinePanel</span><span class="p">,</span> <span class="n">MultiFieldPanel</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="n">AbstractEmailForm</span><span class="p">,</span> <span class="n">AbstractFormField</span><span class="p">,</span> <span class="n">AbstractFormSubmission</span>


<span class="k">class</span> <span class="nc">FormField</span><span class="p">(</span><span class="n">AbstractFormField</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;FormPage&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;form_fields&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thank_you_text</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">AbstractEmailForm</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;form_fields&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Form fields&quot;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;thank_you_text&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">MultiFieldPanel</span><span class="p">([</span>
            <span class="n">FieldRowPanel</span><span class="p">([</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;from_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;to_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
            <span class="p">]),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="s2">&quot;Email&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_data_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;Username&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">data_fields</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_data_fields</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">data_fields</span>

    <span class="k">def</span> <span class="nf">get_submission_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CustomFormSubmission</span>

    <span class="k">def</span> <span class="nf">process_form_submission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_submission_class</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">form_data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">DjangoJSONEncoder</span><span class="p">),</span>
            <span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">user</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">CustomFormSubmission</span><span class="p">(</span><span class="n">AbstractFormSubmission</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form_data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
        <span class="n">form_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">form_data</span>
</pre></div>
</div>
<p>Note that this code also changes the submissions list view.</p>
</div>
<div class="section" id="check-that-a-submission-already-exists-for-a-user">
<h8>Check that a submission already exists for a user<a class="headerlink" href="#check-that-a-submission-already-exists-for-a-user" title="Permalink to this headline">¶</a></h8>
<p>If you want to prevent users from filling in a form more than once,
you need to override the <code class="docutils literal notranslate"><span class="pre">serve</span></code> method in your page model.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.core.serializers.json</span> <span class="kn">import</span> <span class="n">DjangoJSONEncoder</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">FieldRowPanel</span><span class="p">,</span>
    <span class="n">InlinePanel</span><span class="p">,</span> <span class="n">MultiFieldPanel</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="n">AbstractEmailForm</span><span class="p">,</span> <span class="n">AbstractFormField</span><span class="p">,</span> <span class="n">AbstractFormSubmission</span>


<span class="k">class</span> <span class="nc">FormField</span><span class="p">(</span><span class="n">AbstractFormField</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;FormPage&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;form_fields&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thank_you_text</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">AbstractEmailForm</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;form_fields&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Form fields&quot;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;thank_you_text&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">MultiFieldPanel</span><span class="p">([</span>
            <span class="n">FieldRowPanel</span><span class="p">([</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;from_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;to_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
            <span class="p">]),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="s2">&quot;Email&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">serve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_submission_class</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">user__pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span>
                <span class="n">request</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_submission_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CustomFormSubmission</span>

    <span class="k">def</span> <span class="nf">process_form_submission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_submission_class</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">form_data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">DjangoJSONEncoder</span><span class="p">),</span>
            <span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">user</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">CustomFormSubmission</span><span class="p">(</span><span class="n">AbstractFormSubmission</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Your template should look like this:</p>
<div class="highlight-django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;html&gt;</span>
<span class="x">    &lt;head&gt;</span>
<span class="x">        &lt;title&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="x">&lt;/title&gt;</span>
<span class="x">    &lt;/head&gt;</span>
<span class="x">    &lt;body&gt;</span>
<span class="x">        &lt;h1&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="x">&lt;/h1&gt;</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="k">and</span> <span class="nv">user.is_active</span> <span class="k">or</span> <span class="nv">request.is_preview</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">form</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                &lt;div&gt;</span><span class="cp">{{</span> <span class="nv">page.intro</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span><span class="x">&lt;/div&gt;</span>
<span class="x">                &lt;form action=&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">page</span> <span class="cp">%}</span><span class="x">&quot; method=&quot;POST&quot;&gt;</span>
<span class="x">                    </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                    </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">                    &lt;input type=&quot;submit&quot;&gt;</span>
<span class="x">                &lt;/form&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                &lt;div&gt;You can fill in the from only one time.&lt;/div&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">            &lt;div&gt;To fill in the form, you must to log in.&lt;/div&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="multi-step-form">
<h8>Multi-step form<a class="headerlink" href="#multi-step-form" title="Permalink to this headline">¶</a></h8>
<p>The following example shows how to create a multi-step form.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span><span class="p">,</span> <span class="n">PageNotAnInteger</span><span class="p">,</span> <span class="n">EmptyPage</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">FieldRowPanel</span><span class="p">,</span>
    <span class="n">InlinePanel</span><span class="p">,</span> <span class="n">MultiFieldPanel</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="n">AbstractEmailForm</span><span class="p">,</span> <span class="n">AbstractFormField</span>


<span class="k">class</span> <span class="nc">FormField</span><span class="p">(</span><span class="n">AbstractFormField</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;FormPage&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;form_fields&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thank_you_text</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">AbstractEmailForm</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;form_fields&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Form fields&quot;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;thank_you_text&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">MultiFieldPanel</span><span class="p">([</span>
            <span class="n">FieldRowPanel</span><span class="p">([</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;from_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;to_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
            <span class="p">]),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="s2">&quot;Email&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_form_class_for_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_builder</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">object_list</span><span class="p">)</span><span class="o">.</span><span class="n">get_form_class</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">serve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements a simple multi-step form.</span>

<span class="sd">        Stores each step into a session.</span>
<span class="sd">        When the last step was submitted correctly, saves whole form into a DB.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">session_key_data</span> <span class="o">=</span> <span class="s1">&#39;form_data-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span>
        <span class="n">is_last_step</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">step_number</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_form_fields</span><span class="p">(),</span> <span class="n">per_page</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">step_number</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">PageNotAnInteger</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">EmptyPage</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
            <span class="n">is_last_step</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
            <span class="c1"># The first step will be submitted with step_number == 2,</span>
            <span class="c1"># so we need to get a form from previous step</span>
            <span class="c1"># Edge case - submission of the last step</span>
            <span class="n">prev_step</span> <span class="o">=</span> <span class="n">step</span> <span class="k">if</span> <span class="n">is_last_step</span> <span class="k">else</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">previous_page_number</span><span class="p">())</span>

            <span class="c1"># Create a form only for submitted step</span>
            <span class="n">prev_form_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_class_for_step</span><span class="p">(</span><span class="n">prev_step</span><span class="p">)</span>
            <span class="n">prev_form</span> <span class="o">=</span> <span class="n">prev_form_class</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prev_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="c1"># If data for step is valid, update the session</span>
                <span class="n">form_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_key_data</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">form_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">prev_form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">)</span>
                <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="n">session_key_data</span><span class="p">]</span> <span class="o">=</span> <span class="n">form_data</span>

                <span class="k">if</span> <span class="n">prev_step</span><span class="o">.</span><span class="n">has_next</span><span class="p">():</span>
                    <span class="c1"># Create a new form for a following step, if the following step is present</span>
                    <span class="n">form_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_class_for_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
                    <span class="n">form</span> <span class="o">=</span> <span class="n">form_class</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If there is no next step, create form for all fields</span>
                    <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span>
                        <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="n">session_key_data</span><span class="p">],</span>
                        <span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                        <span class="c1"># Perform validation again for whole form.</span>
                        <span class="c1"># After successful validation, save data into DB,</span>
                        <span class="c1"># and remove from the session.</span>
                        <span class="n">form_submission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_form_submission</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
                        <span class="k">del</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="n">session_key_data</span><span class="p">]</span>
                        <span class="c1"># render the landing page</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_landing_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">form_submission</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If data for step is invalid</span>
                <span class="c1"># we will need to display form again with errors,</span>
                <span class="c1"># so restore previous state.</span>
                <span class="n">form</span> <span class="o">=</span> <span class="n">prev_form</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">prev_step</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Create empty form for non-POST requests</span>
            <span class="n">form_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_class_for_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">form_class</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;fields_step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">,</span>
            <span class="n">context</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>Your template for this form page should look like this:</p>
<div class="highlight-django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;html&gt;</span>
<span class="x">    &lt;head&gt;</span>
<span class="x">        &lt;title&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="x">&lt;/title&gt;</span>
<span class="x">    &lt;/head&gt;</span>
<span class="x">    &lt;body&gt;</span>
<span class="x">        &lt;h1&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="x">&lt;/h1&gt;</span>

<span class="x">        &lt;div&gt;</span><span class="cp">{{</span> <span class="nv">page.intro</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span><span class="x">&lt;/div&gt;</span>
<span class="x">        &lt;form action=&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">page</span> <span class="cp">%}</span><span class="x">?p=</span><span class="cp">{{</span> <span class="nv">fields_step.number</span><span class="o">|</span><span class="nf">add</span><span class="s2">:&quot;1&quot;</span> <span class="cp">}}</span><span class="x">&quot; method=&quot;POST&quot;&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">            </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">            &lt;input type=&quot;submit&quot;&gt;</span>
<span class="x">        &lt;/form&gt;</span>
<span class="x">    &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Note that the example shown before allows the user to return to a previous step,
or to open a second step without submitting the first step.
Depending on your requirements, you may need to add extra checks.</p>
</div>
<div class="section" id="show-results">
<h8>Show results<a class="headerlink" href="#show-results" title="Permalink to this headline">¶</a></h8>
<p>If you are implementing polls or surveys, you may want to show results after submission.
The following example demonstrates how to do this.</p>
<p>First, you need to collect results as shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">FieldRowPanel</span><span class="p">,</span>
    <span class="n">InlinePanel</span><span class="p">,</span> <span class="n">MultiFieldPanel</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="n">AbstractEmailForm</span><span class="p">,</span> <span class="n">AbstractFormField</span>


<span class="k">class</span> <span class="nc">FormField</span><span class="p">(</span><span class="n">AbstractFormField</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;FormPage&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;form_fields&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thank_you_text</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">AbstractEmailForm</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;form_fields&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Form fields&quot;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;thank_you_text&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">),</span>
        <span class="n">MultiFieldPanel</span><span class="p">([</span>
            <span class="n">FieldRowPanel</span><span class="p">([</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;from_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;to_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;col6&quot;</span><span class="p">),</span>
            <span class="p">]),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="s2">&quot;Email&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># If you need to show results only on landing page,</span>
        <span class="c1"># you may need check request.method</span>

        <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># Get information about form fields</span>
        <span class="n">data_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">clean_name</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_fields</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="c1"># Get all submissions for current page</span>
        <span class="n">submissions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_submission_class</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">submission</span> <span class="ow">in</span> <span class="n">submissions</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">submission</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

            <span class="c1"># Count results for each question</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">data_fields</span><span class="p">:</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">answer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Something wrong with data.</span>
                    <span class="c1"># Probably you have changed questions</span>
                    <span class="c1"># and now we are receiving answers for old questions.</span>
                    <span class="c1"># Just skip them.</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="c1"># Answer is a list if the field type is &#39;Checkboxes&#39;</span>
                    <span class="n">answer</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

                <span class="n">question_stats</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">question_stats</span><span class="p">[</span><span class="n">answer</span><span class="p">]</span> <span class="o">=</span> <span class="n">question_stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">results</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">question_stats</span>

        <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">context</span>
</pre></div>
</div>
<p>Next, you need to transform your template to display the results:</p>
<div class="highlight-django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;html&gt;</span>
<span class="x">    &lt;head&gt;</span>
<span class="x">        &lt;title&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="x">&lt;/title&gt;</span>
<span class="x">    &lt;/head&gt;</span>
<span class="x">    &lt;body&gt;</span>
<span class="x">        &lt;h1&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="x">&lt;/h1&gt;</span>

<span class="x">        &lt;h2&gt;Results&lt;/h2&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">question</span><span class="o">,</span> <span class="nv">answers</span> <span class="k">in</span> <span class="nv">results.items</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">            &lt;h3&gt;</span><span class="cp">{{</span> <span class="nv">question</span> <span class="cp">}}</span><span class="x">&lt;/h3&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">answer</span><span class="o">,</span> <span class="nv">count</span> <span class="k">in</span> <span class="nv">answers.items</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                &lt;div&gt;</span><span class="cp">{{</span> <span class="nv">answer</span> <span class="cp">}}</span><span class="x">: </span><span class="cp">{{</span> <span class="nv">count</span> <span class="cp">}}</span><span class="x">&lt;/div&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">        &lt;div&gt;</span><span class="cp">{{</span> <span class="nv">page.intro</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span><span class="x">&lt;/div&gt;</span>
<span class="x">        &lt;form action=&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">page</span> <span class="cp">%}</span><span class="x">&quot; method=&quot;POST&quot;&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">            </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">            &lt;input type=&quot;submit&quot;&gt;</span>
<span class="x">        &lt;/form&gt;</span>
<span class="x">    &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>
<p>You can also show the results on the landing page.</p>
</div>
<div class="section" id="custom-landing-page-redirect">
<h8>Custom landing page redirect<a class="headerlink" href="#custom-landing-page-redirect" title="Permalink to this headline">¶</a></h8>
<p>You can override the <code class="docutils literal notranslate"><span class="pre">render_landing_page</span></code> method on your <cite>FormPage</cite> to change what is rendered when a form submits.</p>
<p>In this example below we have added a <cite>thank_you_page</cite> field that enables custom redirects after a form submits to the selected page.</p>
<p>When overriding the <code class="docutils literal notranslate"><span class="pre">render_landing_page</span></code> method, we check if there is a linked <cite>thank_you_page</cite> and then redirect to it if it exists.</p>
<p>Finally, we add a URL param of <cite>id</cite> based on the <code class="docutils literal notranslate"><span class="pre">form_submission</span></code> if it exists.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">FieldRowPanel</span><span class="p">,</span> <span class="n">InlinePanel</span><span class="p">,</span> <span class="n">MultiFieldPanel</span><span class="p">,</span> <span class="n">PageChooserPanel</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="n">AbstractEmailForm</span>

<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>

    <span class="c1"># intro, thank_you_text, ...</span>

    <span class="n">thank_you_page</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;wagtailcore.Page&#39;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">render_landing_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">form_submission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thank_you_page</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thank_you_page</span><span class="o">.</span><span class="n">url</span>
            <span class="c1"># if a form_submission instance is available, append the id to URL</span>
            <span class="c1"># when previewing landing page, there will not be a form_submission instance</span>
            <span class="k">if</span> <span class="n">form_submission</span><span class="p">:</span>
              <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;?id=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">form_submission</span><span class="o">.</span><span class="n">id</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">permanent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># if no thank_you_page is set, render default landing page</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">render_landing_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">form_submission</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">AbstractEmailForm</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;intro&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">),</span>
        <span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;form_fields&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;thank_you_text&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">),</span>
        <span class="n">PageChooserPanel</span><span class="p">(</span><span class="s1">&#39;thank_you_page&#39;</span><span class="p">),</span>
        <span class="n">MultiFieldPanel</span><span class="p">([</span>
            <span class="n">FieldRowPanel</span><span class="p">([</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;from_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s1">&#39;col6&#39;</span><span class="p">),</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;to_address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s1">&#39;col6&#39;</span><span class="p">),</span>
            <span class="p">]),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="s1">&#39;Email&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="customise-form-submissions-listing-in-wagtail-admin">
<h8>Customise form submissions listing in Wagtail Admin<a class="headerlink" href="#customise-form-submissions-listing-in-wagtail-admin" title="Permalink to this headline">¶</a></h8>
<p>The Admin listing of form submissions can be customised by setting the attribute <code class="docutils literal notranslate"><span class="pre">submissions_list_view_class</span></code> on your FormPage model.</p>
<p>The list view class must be a subclass of <code class="docutils literal notranslate"><span class="pre">SubmissionsListView</span></code> from <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.forms.views</span></code>, which is a child class of Django’s class based <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/class-based-views/generic-display/#django.views.generic.list.ListView" title="(in Django v3.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ListView</span></code></a>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="n">AbstractEmailForm</span><span class="p">,</span> <span class="n">AbstractFormField</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.views</span> <span class="kn">import</span> <span class="n">SubmissionsListView</span>


<span class="k">class</span> <span class="nc">CustomSubmissionsListView</span><span class="p">(</span><span class="n">SubmissionsListView</span><span class="p">):</span>
    <span class="n">paginate_by</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># show more submissions per page, default is 20</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;submit_time&#39;</span><span class="p">,)</span>  <span class="c1"># order submissions by oldest first, normally newest first</span>
    <span class="n">ordering_csv</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-submit_time&#39;</span><span class="p">,)</span>  <span class="c1"># order csv export by newest first, normally oldest first</span>

    <span class="c1"># override the method to generate csv filename</span>
    <span class="k">def</span> <span class="nf">get_csv_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the filename for CSV file with page slug at start&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_csv_filename</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_page</span><span class="o">.</span><span class="n">slug</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">filename</span>


<span class="k">class</span> <span class="nc">FormField</span><span class="p">(</span><span class="n">AbstractFormField</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;FormPage&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;form_fields&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Form Page with customised submissions listing view&quot;&quot;&quot;</span>

    <span class="c1"># set custom view class as class attribute</span>
    <span class="n">submissions_list_view_class</span> <span class="o">=</span> <span class="n">CustomSubmissionsListView</span>

    <span class="n">intro</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thank_you_text</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># content_panels = ...</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-a-custom-field-type">
<h8>Adding a custom field type<a class="headerlink" href="#adding-a-custom-field-type" title="Permalink to this headline">¶</a></h8>
<p>First, make the new field type available in the page editor by changing your <code class="docutils literal notranslate"><span class="pre">FormField</span></code> model.</p>
<ul class="simple">
<li>Create a new set of choices which includes the original <code class="docutils literal notranslate"><span class="pre">FORM_FIELD_CHOICES</span></code> along with new field types you want to make available.</li>
<li>Each choice must contain a unique key and a human readable name of the field, e.g. <code class="docutils literal notranslate"><span class="pre">('slug',</span> <span class="pre">'URL</span> <span class="pre">Slug')</span></code></li>
<li>Override the <code class="docutils literal notranslate"><span class="pre">field_type</span></code> field in your <code class="docutils literal notranslate"><span class="pre">FormField</span></code> model with <code class="docutils literal notranslate"><span class="pre">choices</span></code> attribute using these choices.</li>
<li>You will need to run <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">makemigrations</span></code> and <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">migrate</span></code> after this step.</li>
</ul>
<p>Then, create and use a new form builder class.</p>
<ul class="simple">
<li>Define a new form builder class that extends the <code class="docutils literal notranslate"><span class="pre">FormBuilder</span></code> class.</li>
<li>Add a method that will return a created Django form field for the new field type.</li>
<li>Its name must be in the format: <code class="docutils literal notranslate"><span class="pre">create_&lt;field_type_key&gt;_field</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">create_slug_field</span></code></li>
<li>Override the <code class="docutils literal notranslate"><span class="pre">form_builder</span></code> attribute in your form page model to use your new form builder class.</li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">modelcluster.fields</span> <span class="kn">import</span> <span class="n">ParentalKey</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.forms</span> <span class="kn">import</span> <span class="n">FormBuilder</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="p">(</span>
  <span class="n">AbstractEmailForm</span><span class="p">,</span> <span class="n">AbstractFormField</span><span class="p">,</span> <span class="n">FORM_FIELD_CHOICES</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FormField</span><span class="p">(</span><span class="n">AbstractFormField</span><span class="p">):</span>
    <span class="c1"># extend the built in field type choices</span>
    <span class="c1"># our field type key will be &#39;ipaddress&#39;</span>
    <span class="n">CHOICES</span> <span class="o">=</span> <span class="n">FORM_FIELD_CHOICES</span> <span class="o">+</span> <span class="p">((</span><span class="s1">&#39;ipaddress&#39;</span><span class="p">,</span> <span class="s1">&#39;IP Address&#39;</span><span class="p">),)</span>

    <span class="n">page</span> <span class="o">=</span> <span class="n">ParentalKey</span><span class="p">(</span><span class="s1">&#39;FormPage&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;form_fields&#39;</span><span class="p">)</span>
    <span class="c1"># override the field_type field with extended choices</span>
    <span class="n">field_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;field type&#39;</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="c1"># use the choices tuple defined above</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">CHOICES</span>
    <span class="p">)</span>


<span class="k">class</span> <span class="nc">CustomFormBuilder</span><span class="p">(</span><span class="n">FormBuilder</span><span class="p">):</span>
    <span class="c1"># create a function that returns an instanced Django form field</span>
    <span class="c1"># function name must match create_&lt;field_type_key&gt;_field</span>
    <span class="k">def</span> <span class="nf">create_ipaddress_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="c1"># return `forms.GenericIPAddressField(**options)` not `forms.SlugField`</span>
        <span class="c1"># returns created a form field with the options passed in</span>
        <span class="k">return</span> <span class="n">forms</span><span class="o">.</span><span class="n">GenericIPAddressField</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>
    <span class="c1"># intro, thank_you_text, edit_handlers, etc...</span>

    <span class="c1"># use custom form builder defined above</span>
    <span class="n">form_builder</span> <span class="o">=</span> <span class="n">CustomFormBuilder</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-render-email-method">
<span id="form-builder-render-email"></span><h8>Custom <code class="docutils literal notranslate"><span class="pre">render_email</span></code> method<a class="headerlink" href="#custom-render-email-method" title="Permalink to this headline">¶</a></h8>
<p>If you want to change the content of the email that is sent when a form submits you can override the <code class="docutils literal notranslate"><span class="pre">render_email</span></code> method.</p>
<p>To do this, you need to:</p>
<ul class="simple">
<li>Ensure you have your form model defined that extends <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.forms.models.AbstractEmailForm</span></code>.</li>
<li>Override the <code class="docutils literal notranslate"><span class="pre">render_email</span></code> method in your page model.</li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="c1"># ... additional wagtail imports</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="n">AbstractEmailForm</span>


<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>
    <span class="c1"># ... fields, content_panels, etc</span>

    <span class="k">def</span> <span class="nf">render_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="c1"># Get the original content (string)</span>
        <span class="n">email_content</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">render_email</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

        <span class="c1"># Add a title (not part of original method)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Form&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>

        <span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">title</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">email_content</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>

        <span class="c1"># Add a link to the form page</span>
        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Submitted Via&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_url</span><span class="p">))</span>

        <span class="c1"># Add the date the form was submitted</span>
        <span class="n">submitted_date_str</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%x</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Submitted on&#39;</span><span class="p">,</span> <span class="n">submitted_date_str</span><span class="p">))</span>

        <span class="c1"># Content is joined with a new line to separate each text line</span>
        <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">content</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-send-mail-method">
<h8>Custom <code class="docutils literal notranslate"><span class="pre">send_mail</span></code> method<a class="headerlink" href="#custom-send-mail-method" title="Permalink to this headline">¶</a></h8>
<p>If you want to change the subject or some other part of how an email is sent when a form submits you can override the <code class="docutils literal notranslate"><span class="pre">send_mail</span></code> method.</p>
<p>To do this, you need to:</p>
<ul class="simple">
<li>Ensure you have your form model defined that extends <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.forms.models.AbstractEmailForm</span></code>.</li>
<li>In your models.py file, import the <code class="docutils literal notranslate"><span class="pre">wagtail.admin.mail.send_mail</span></code> function.</li>
<li>Override the <code class="docutils literal notranslate"><span class="pre">send_mail</span></code> method in your page model.</li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="c1"># ... additional wagtail imports</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.mail</span> <span class="kn">import</span> <span class="n">send_mail</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.forms.models</span> <span class="kn">import</span> <span class="n">AbstractEmailForm</span>


<span class="k">class</span> <span class="nc">FormPage</span><span class="p">(</span><span class="n">AbstractEmailForm</span><span class="p">):</span>
    <span class="c1"># ... fields, content_panels, etc</span>

    <span class="k">def</span> <span class="nf">send_mail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="c1"># `self` is the FormPage, `form` is the form&#39;s POST data on submit</span>

        <span class="c1"># Email addresses are parsed from the FormPage&#39;s addresses field</span>
        <span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_address</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>

        <span class="c1"># Subject can be adjusted (adding submitted date), be sure to include the form&#39;s defined subject field</span>
        <span class="n">submitted_date_str</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%x</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">submitted_date_str</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">send_mail</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_email</span><span class="p">(</span><span class="n">form</span><span class="p">),</span> <span class="n">addresses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_address</span><span class="p">,)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-reference/contrib/sitemaps"></span><div class="section" id="sitemap-generator">
<span id="sitemap-generation"></span><h5>Sitemap generator<a class="headerlink" href="#sitemap-generator" title="Permalink to this headline">¶</a></h5>
<p>This document describes how to create XML sitemaps for your Wagtail website
using the <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.sitemaps</span></code> module.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>As of Wagtail 1.10 the Django contrib sitemap app is used to generate
sitemaps.  However since Wagtail requires the Site instance to be available
during the sitemap generation you will have to use the views from the
<code class="docutils literal notranslate"><span class="pre">wagtail.contrib.sitemaps.views</span></code> module instead of the views
provided by Django (<code class="docutils literal notranslate"><span class="pre">django.contrib.sitemaps.views</span></code>).</p>
<p class="last">The usage of these views is otherwise identical, which means that
customisation and caching of the sitemaps are done using the default Django
patterns.  See the Django documentation for in-depth information.</p>
</div>
<div class="section" id="basic-configuration">
<h6>Basic configuration<a class="headerlink" href="#basic-configuration" title="Permalink to this headline">¶</a></h6>
<p>You firstly need to add <code class="docutils literal notranslate"><span class="pre">&quot;django.contrib.sitemaps&quot;</span></code> to INSTALLED_APPS in your
Django settings file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>

    <span class="s2">&quot;django.contrib.sitemaps&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Then, in <code class="docutils literal notranslate"><span class="pre">urls.py</span></code>, you need to add a link to the
<code class="docutils literal notranslate"><span class="pre">wagtail.contrib.sitemaps.views.sitemap</span></code> view which generates the
sitemap:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.sitemaps.views</span> <span class="kn">import</span> <span class="n">sitemap</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>

    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;sitemap.xml&#39;</span><span class="p">,</span> <span class="n">sitemap</span><span class="p">),</span>

    <span class="o">...</span>

    <span class="c1"># Ensure that the &#39;sitemap&#39; line appears above the default Wagtail page serving route</span>
    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtail_urls</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>You should now be able to browse to <code class="docutils literal notranslate"><span class="pre">/sitemap.xml</span></code> and see the sitemap
working. By default, all published pages in your website will be added to the
site map.</p>
</div>
<div class="section" id="setting-the-hostname">
<h6>Setting the hostname<a class="headerlink" href="#setting-the-hostname" title="Permalink to this headline">¶</a></h6>
<p>By default, the sitemap uses the hostname defined in the Wagtail Admin’s
<code class="docutils literal notranslate"><span class="pre">Sites</span></code> area. If your default site is called <code class="docutils literal notranslate"><span class="pre">localhost</span></code>, then URLs in the
sitemap will look like:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;url&gt;</span>
    <span class="nt">&lt;loc&gt;</span>http://localhost/about/<span class="nt">&lt;/loc&gt;</span>
    <span class="nt">&lt;lastmod&gt;</span>2015-09-26<span class="nt">&lt;/lastmod&gt;</span>
<span class="nt">&lt;/url&gt;</span>
</pre></div>
</div>
<p>For tools like Google Search Tools to properly index your site, you need to set
a valid, crawlable hostname. If you change the site’s hostname from
<code class="docutils literal notranslate"><span class="pre">localhost</span></code> to <code class="docutils literal notranslate"><span class="pre">mysite.com</span></code>, <code class="docutils literal notranslate"><span class="pre">sitemap.xml</span></code> will contain the correct URLs:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;url&gt;</span>
    <span class="nt">&lt;loc&gt;</span>http://mysite.com/about/<span class="nt">&lt;/loc&gt;</span>
    <span class="nt">&lt;lastmod&gt;</span>2015-09-26<span class="nt">&lt;/lastmod&gt;</span>
<span class="nt">&lt;/url&gt;</span>
</pre></div>
</div>
<p>If you change the site’s port to <code class="docutils literal notranslate"><span class="pre">443</span></code>, the <code class="docutils literal notranslate"><span class="pre">https</span></code> scheme will be used.
Find out more about <a class="reference internal" href="index.html#site-model-ref"><span class="std std-ref">working with Sites</span></a>.</p>
</div>
<div class="section" id="customising">
<h6>Customising<a class="headerlink" href="#customising" title="Permalink to this headline">¶</a></h6>
<div class="section" id="urls">
<h7>URLs<a class="headerlink" href="#urls" title="Permalink to this headline">¶</a></h7>
<p>The <code class="docutils literal notranslate"><span class="pre">Page</span></code> class defines a <code class="docutils literal notranslate"><span class="pre">get_sitemap_urls</span></code> method which you can
override to customise sitemaps per <code class="docutils literal notranslate"><span class="pre">Page</span></code> instance. This method must accept
a request object and return a list of dictionaries, one dictionary per URL
entry in the sitemap. You can exclude pages from the sitemap by returning an
empty list.</p>
<p>Each dictionary can contain the following:</p>
<ul class="simple">
<li><strong>location</strong> (required) - This is the full URL path to add into the sitemap.</li>
<li><strong>lastmod</strong> - A python date or datetime set to when the page was last modified.</li>
<li><strong>changefreq</strong></li>
<li><strong>priority</strong></li>
</ul>
<p>You can add more but you will need to override the
<code class="docutils literal notranslate"><span class="pre">sitemap.xml</span></code> template in order for them to be displayed in the sitemap.</p>
</div>
</div>
<div class="section" id="serving-multiple-sitemaps">
<h6>Serving multiple sitemaps<a class="headerlink" href="#serving-multiple-sitemaps" title="Permalink to this headline">¶</a></h6>
<p>If you want to support the sitemap indexes from Django then you will need to
use the index view from <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.sitemaps.views</span></code> instead of the index
view from <code class="docutils literal notranslate"><span class="pre">django.contrib.sitemaps.views</span></code>.  Please see the Django
documentation for further details.</p>
</div>
</div>
<span id="document-reference/contrib/frontendcache"></span><div class="section" id="frontend-cache-invalidator">
<span id="frontend-cache-purging"></span><h5>Frontend cache invalidator<a class="headerlink" href="#frontend-cache-invalidator" title="Permalink to this headline">¶</a></h5>
<p>Many websites use a frontend cache such as Varnish, Squid, Cloudflare or CloudFront to gain extra performance. The downside of using a frontend cache though is that they don’t respond well to updating content and will often keep an old version of a page cached after it has been updated.</p>
<p>This document describes how to configure Wagtail to purge old versions of pages from a frontend cache whenever a page gets updated.</p>
<div class="section" id="setting-it-up">
<h6>Setting it up<a class="headerlink" href="#setting-it-up" title="Permalink to this headline">¶</a></h6>
<p>Firstly, add <code class="docutils literal notranslate"><span class="pre">&quot;wagtail.contrib.frontend_cache&quot;</span></code> to your INSTALLED_APPS:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
  <span class="o">...</span>

  <span class="s2">&quot;wagtail.contrib.frontend_cache&quot;</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">wagtailfrontendcache</span></code> module provides a set of signal handlers which will automatically purge the cache whenever a page is published or deleted. These signal handlers are automatically registered when the <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.frontend_cache</span></code> app is loaded.</p>
<div class="section" id="varnish-squid">
<h7>Varnish/Squid<a class="headerlink" href="#varnish-squid" title="Permalink to this headline">¶</a></h7>
<p>Add a new item into the <code class="docutils literal notranslate"><span class="pre">WAGTAILFRONTENDCACHE</span></code> setting and set the <code class="docutils literal notranslate"><span class="pre">BACKEND</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.frontend_cache.backends.HTTPBackend</span></code>. This backend requires an extra parameter <code class="docutils literal notranslate"><span class="pre">LOCATION</span></code> which points to where the cache is running (this must be a direct connection to the server and cannot go through another proxy).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># settings.py</span>

<span class="n">WAGTAILFRONTENDCACHE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;varnish&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.contrib.frontend_cache.backends.HTTPBackend&#39;</span><span class="p">,</span>
        <span class="s1">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="s1">&#39;http://localhost:8000&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
<span class="n">WAGTAILFRONTENDCACHE_LANGUAGES</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>Set <code class="docutils literal notranslate"><span class="pre">WAGTAILFRONTENDCACHE_LANGUAGES</span></code> to a list of languages (typically equal to <code class="docutils literal notranslate"><span class="pre">[l[0]</span> <span class="pre">for</span> <span class="pre">l</span> <span class="pre">in</span> <span class="pre">settings.LANGUAGES]</span></code>) to also purge the urls for each language of a purging url. This setting needs <code class="docutils literal notranslate"><span class="pre">settings.USE_I18N</span></code> to be <code class="docutils literal notranslate"><span class="pre">True</span></code> to work. Its default is an empty list.</p>
<p>Finally, make sure you have configured your frontend cache to accept PURGE requests:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.varnish-cache.org/docs/3.0/tutorial/purging.html">Varnish</a></li>
<li><a class="reference external" href="https://wiki.squid-cache.org/SquidFaq/OperatingSquid#How_can_I_purge_an_object_from_my_cache.3F">Squid</a></li>
</ul>
</div>
<div class="section" id="cloudflare">
<span id="frontendcache-cloudflare"></span><h7>Cloudflare<a class="headerlink" href="#cloudflare" title="Permalink to this headline">¶</a></h7>
<p>Firstly, you need to register an account with Cloudflare if you haven’t already got one. You can do this here: <a class="reference external" href="https://www.cloudflare.com/sign-up">Cloudflare Sign up</a></p>
<p>Add an item into the <code class="docutils literal notranslate"><span class="pre">WAGTAILFRONTENDCACHE</span></code> and set the <code class="docutils literal notranslate"><span class="pre">BACKEND</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.frontend_cache.backends.CloudflareBackend</span></code>.</p>
<p>This backend can be configured to use an account-wide API key, or an API token with restricted access.</p>
<p>To use an account-wide API key, find the key <a class="reference external" href="https://support.cloudflare.com/hc/en-us/articles/200167836-Managing-API-Tokens-and-Keys#12345682">as described in the Cloudflare documentation</a> and specify <code class="docutils literal notranslate"><span class="pre">EMAIL</span></code> and <code class="docutils literal notranslate"><span class="pre">API_KEY</span></code> parameters.</p>
<p>To use a limited API token, <a class="reference external" href="https://support.cloudflare.com/hc/en-us/articles/200167836-Managing-API-Tokens-and-Keys#12345680">create a token</a> configured with the ‘Zone, Cache Purge’ permission and specify the <code class="docutils literal notranslate"><span class="pre">BEARER_TOKEN</span></code> parameter.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">ZONEID</span></code> parameter will need to be set for either option. To find the <code class="docutils literal notranslate"><span class="pre">ZONEID</span></code> for your domain, read the <a class="reference external" href="https://api.cloudflare.com/#getting-started-resource-ids">Cloudflare API Documentation</a></p>
<p>With an API key:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># settings.py</span>

<span class="n">WAGTAILFRONTENDCACHE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cloudflare&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.contrib.frontend_cache.backends.CloudflareBackend&#39;</span><span class="p">,</span>
        <span class="s1">&#39;EMAIL&#39;</span><span class="p">:</span> <span class="s1">&#39;your-cloudflare-email-address@example.com&#39;</span><span class="p">,</span>
        <span class="s1">&#39;API_KEY&#39;</span><span class="p">:</span> <span class="s1">&#39;your cloudflare api key&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ZONEID&#39;</span><span class="p">:</span> <span class="s1">&#39;your cloudflare domain zone id&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With an API token:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># settings.py</span>

<span class="n">WAGTAILFRONTENDCACHE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cloudflare&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.contrib.frontend_cache.backends.CloudflareBackend&#39;</span><span class="p">,</span>
        <span class="s1">&#39;BEARER_TOKEN&#39;</span><span class="p">:</span> <span class="s1">&#39;your cloudflare bearer token&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ZONEID&#39;</span><span class="p">:</span> <span class="s1">&#39;your cloudflare domain zone id&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="amazon-cloudfront">
<span id="frontendcache-aws-cloudfront"></span><h7>Amazon CloudFront<a class="headerlink" href="#amazon-cloudfront" title="Permalink to this headline">¶</a></h7>
<p>Within Amazon Web Services you will need at least one CloudFront web distribution. If you don’t have one, you can get one here: <a class="reference external" href="https://aws.amazon.com/cloudfront/">CloudFront getting started</a></p>
<p>Add an item into the <code class="docutils literal notranslate"><span class="pre">WAGTAILFRONTENDCACHE</span></code> and set the <code class="docutils literal notranslate"><span class="pre">BACKEND</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.frontend_cache.backends.CloudfrontBackend</span></code>. This backend requires one extra parameter, <code class="docutils literal notranslate"><span class="pre">DISTRIBUTION_ID</span></code> (your CloudFront generated distribution id).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILFRONTENDCACHE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cloudfront&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.contrib.frontend_cache.backends.CloudfrontBackend&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DISTRIBUTION_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;your-distribution-id&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Configuration of credentials can done in multiple ways. You won’t need to store them in your Django settings file. You can read more about this here: <a class="reference external" href="https://boto3.readthedocs.org/en/latest/guide/configuration.html">Boto 3 Docs</a></p>
<p>In case you run multiple sites with Wagtail and each site has its CloudFront distribution, provide a mapping instead of a single distribution. Make sure the mapping matches with the hostnames provided in your site settings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILFRONTENDCACHE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cloudfront&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.contrib.frontend_cache.backends.CloudfrontBackend&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DISTRIBUTION_ID&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;www.wagtail.io&#39;</span><span class="p">:</span> <span class="s1">&#39;your-distribution-id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;www.madewithwagtail.org&#39;</span><span class="p">:</span> <span class="s1">&#39;your-distribution-id&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In most cases, absolute URLs with <code class="docutils literal notranslate"><span class="pre">www</span></code> prefixed domain names should be used in your mapping. Only drop the <code class="docutils literal notranslate"><span class="pre">www</span></code> prefix if you’re absolutely sure you’re not using it (e.g. a subdomain).</p>
</div>
</div>
</div>
<div class="section" id="advanced-usage">
<h6>Advanced usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h6>
<div class="section" id="invalidating-more-than-one-url-per-page">
<h7>Invalidating more than one URL per page<a class="headerlink" href="#invalidating-more-than-one-url-per-page" title="Permalink to this headline">¶</a></h7>
<p>By default, Wagtail will only purge one URL per page. If your page has more than one URL to be purged, you will need to override the <code class="docutils literal notranslate"><span class="pre">get_cached_paths</span></code> method on your page type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogIndexPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_blog_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This returns a Django paginator of blog items in this section</span>
        <span class="k">return</span> <span class="n">Paginator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">BlogPage</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_cached_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Yield the main URL</span>
        <span class="k">yield</span> <span class="s1">&#39;/&#39;</span>

        <span class="c1"># Yield one URL per page in the paginator to make sure all pages are purged</span>
        <span class="k">for</span> <span class="n">page_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_blog_items</span><span class="p">()</span><span class="o">.</span><span class="n">num_pages</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">yield</span> <span class="s1">&#39;/?page=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">page_number</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="invalidating-index-pages">
<h7>Invalidating index pages<a class="headerlink" href="#invalidating-index-pages" title="Permalink to this headline">¶</a></h7>
<p>Pages that list other pages (such as a blog index) may need to be purged as
well so any changes to a blog page are also reflected on the index (for example,
a blog post was added, deleted or its title/thumbnail was changed).</p>
<p>To purge these pages, we need to write a signal handler that listens for
Wagtail’s <code class="docutils literal notranslate"><span class="pre">page_published</span></code> and <code class="docutils literal notranslate"><span class="pre">page_unpublished</span></code> signals for blog pages
(note, <code class="docutils literal notranslate"><span class="pre">page_published</span></code> is called both when a page is created and updated).
This signal handler would trigger the invalidation of the index page using the
<code class="docutils literal notranslate"><span class="pre">PurgeBatch</span></code> class which is used to construct and dispatch invalidation requests.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># models.py</span>
<span class="kn">from</span> <span class="nn">django.dispatch</span> <span class="kn">import</span> <span class="n">receiver</span>
<span class="kn">from</span> <span class="nn">django.db.models.signals</span> <span class="kn">import</span> <span class="n">pre_delete</span>

<span class="kn">from</span> <span class="nn">wagtail.core.signals</span> <span class="kn">import</span> <span class="n">page_published</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.frontend_cache.utils</span> <span class="kn">import</span> <span class="n">PurgeBatch</span>

<span class="o">...</span>

<span class="k">def</span> <span class="nf">blog_page_changed</span><span class="p">(</span><span class="n">blog_page</span><span class="p">):</span>
    <span class="c1"># Find all the live BlogIndexPages that contain this blog_page</span>
    <span class="n">batch</span> <span class="o">=</span> <span class="n">PurgeBatch</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">blog_index</span> <span class="ow">in</span> <span class="n">BlogIndexPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">blog_page</span> <span class="ow">in</span> <span class="n">blog_index</span><span class="o">.</span><span class="n">get_blog_items</span><span class="p">()</span><span class="o">.</span><span class="n">object_list</span><span class="p">:</span>
            <span class="n">batch</span><span class="o">.</span><span class="n">add_page</span><span class="p">(</span><span class="n">blog_index</span><span class="p">)</span>

    <span class="c1"># Purge all the blog indexes we found in a single request</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">purge</span><span class="p">()</span>


<span class="nd">@receiver</span><span class="p">(</span><span class="n">page_published</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">BlogPage</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">blog_published_handler</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">blog_page_changed</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>


<span class="nd">@receiver</span><span class="p">(</span><span class="n">pre_delete</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">BlogPage</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">blog_deleted_handler</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">blog_page_changed</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="invalidating-urls">
<span id="frontend-cache-invalidating-urls"></span><h7>Invalidating URLs<a class="headerlink" href="#invalidating-urls" title="Permalink to this headline">¶</a></h7>
<p>The <code class="docutils literal notranslate"><span class="pre">PurgeBatch</span></code> class provides a <code class="docutils literal notranslate"><span class="pre">.add_url(url)</span></code> and a <code class="docutils literal notranslate"><span class="pre">.add_urls(urls)</span></code>
for adding individual URLs to the purge batch.</p>
<p>For example, this could be useful for purging a single page on a blog index:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.frontend_cache.utils</span> <span class="kn">import</span> <span class="n">PurgeBatch</span>

<span class="c1"># Purge the first page of the blog index</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">PurgeBatch</span><span class="p">()</span>
<span class="n">batch</span><span class="o">.</span><span class="n">add_url</span><span class="p">(</span><span class="n">blog_index</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;?page=1&#39;</span><span class="p">)</span>
<span class="n">batch</span><span class="o">.</span><span class="n">purge</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="the-purgebatch-class">
<h7>The <code class="docutils literal notranslate"><span class="pre">PurgeBatch</span></code> class<a class="headerlink" href="#the-purgebatch-class" title="Permalink to this headline">¶</a></h7>
<p>All of the methods available on <code class="docutils literal notranslate"><span class="pre">PurgeBatch</span></code> are listed below:</p>
<span class="target" id="module-wagtail.contrib.frontend_cache.utils"></span><dl class="class">
<dt id="wagtail.contrib.frontend_cache.utils.PurgeBatch">
<em class="property">class </em><code class="descclassname">wagtail.contrib.frontend_cache.utils.</code><code class="descname">PurgeBatch</code><span class="sig-paren">(</span><em>urls=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.frontend_cache.utils.PurgeBatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents a list of URLs to be purged in a single request</p>
<dl class="method">
<dt id="wagtail.contrib.frontend_cache.utils.PurgeBatch.add_url">
<code class="descname">add_url</code><span class="sig-paren">(</span><em>url</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.frontend_cache.utils.PurgeBatch.add_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a single URL</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.contrib.frontend_cache.utils.PurgeBatch.add_urls">
<code class="descname">add_urls</code><span class="sig-paren">(</span><em>urls</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.frontend_cache.utils.PurgeBatch.add_urls" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds multiple URLs from an iterable</p>
<p>This is equivalent to running <code class="docutils literal notranslate"><span class="pre">.add_url(url)</span></code> on each URL
individually</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.contrib.frontend_cache.utils.PurgeBatch.add_page">
<code class="descname">add_page</code><span class="sig-paren">(</span><em>page</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.frontend_cache.utils.PurgeBatch.add_page" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds all URLs for the specified page</p>
<p>This combines the page’s full URL with each path that is returned by
the page’s <cite>.get_cached_paths</cite> method</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.contrib.frontend_cache.utils.PurgeBatch.add_pages">
<code class="descname">add_pages</code><span class="sig-paren">(</span><em>pages</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.frontend_cache.utils.PurgeBatch.add_pages" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds multiple pages from a QuerySet or an iterable</p>
<p>This is equivalent to running <code class="docutils literal notranslate"><span class="pre">.add_page(page)</span></code> on each page
individually</p>
</dd></dl>

<dl class="method">
<dt id="wagtail.contrib.frontend_cache.utils.PurgeBatch.purge">
<code class="descname">purge</code><span class="sig-paren">(</span><em>backend_settings=None</em>, <em>backends=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.frontend_cache.utils.PurgeBatch.purge" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs the purge of all the URLs in this batch</p>
<p>This method takes two optional keyword arguments: backend_settings and backends</p>
<ul class="simple">
<li>backend_settings can be used to override the WAGTAILFRONTENDCACHE setting for
just this call</li>
<li>backends can be set to a list of backend names. When set, the invalidation request
will only be sent to these backends</li>
</ul>
</dd></dl>

</dd></dl>

</div>
</div>
</div>
<span id="document-reference/contrib/routablepage"></span><div class="section" id="module-wagtail.contrib.routable_page">
<span id="routablepagemixin"></span><span id="routable-page-mixin"></span><h5><code class="docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code><a class="headerlink" href="#module-wagtail.contrib.routable_page" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code> mixin provides a convenient way for a page to respond on multiple sub-URLs with different views. For example, a blog section on a site might provide several different types of index page at URLs like <code class="docutils literal notranslate"><span class="pre">/blog/2013/06/</span></code>, <code class="docutils literal notranslate"><span class="pre">/blog/authors/bob/</span></code>, <code class="docutils literal notranslate"><span class="pre">/blog/tagged/python/</span></code>, all served by the same page instance.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">Page</span></code> using <code class="docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code> exists within the page tree like any other page, but URL paths underneath it are checked against a list of patterns. If none of the patterns match, control is passed to subpages as usual (or failing that, a 404 error is thrown).</p>
<p>By default a route for <code class="docutils literal notranslate"><span class="pre">r'^$'</span></code> exists, which serves the content exactly like a normal <code class="docutils literal notranslate"><span class="pre">Page</span></code> would. It can be overridden by using <code class="docutils literal notranslate"><span class="pre">&#64;route(r'^$')</span></code> on any other method of the inheriting class.</p>
<div class="section" id="installation">
<h6>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h6>
<p>Add <code class="docutils literal notranslate"><span class="pre">&quot;wagtail.contrib.routable_page&quot;</span></code> to your INSTALLED_APPS:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
  <span class="o">...</span>

  <span class="s2">&quot;wagtail.contrib.routable_page&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="the-basics">
<h6>The basics<a class="headerlink" href="#the-basics" title="Permalink to this headline">¶</a></h6>
<p>To use <code class="docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code>, you need to make your class inherit from both <a class="reference internal" href="#wagtail.contrib.routable_page.models.RoutablePageMixin" title="wagtail.contrib.routable_page.models.RoutablePageMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">wagtail.contrib.routable_page.models.RoutablePageMixin</span></code></a> and <a class="reference internal" href="index.html#wagtail.core.models.Page" title="wagtail.core.models.Page"><code class="xref py py-class docutils literal notranslate"><span class="pre">wagtail.core.models.Page</span></code></a>, then define some view methods and decorate them with <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.routable_page.models.route</span></code>. These view methods behave like ordinary Django view functions, and must return an <code class="docutils literal notranslate"><span class="pre">HttpResponse</span></code> object; typically this is done through a call to <code class="docutils literal notranslate"><span class="pre">django.shortcuts.render</span></code>.</p>
<p>Here’s an example of an <code class="docutils literal notranslate"><span class="pre">EventIndexPage</span></code> with three views, assuming that an <code class="docutils literal notranslate"><span class="pre">EventPage</span></code> model with an <code class="docutils literal notranslate"><span class="pre">event_date</span></code> field has been defined elsewhere:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>
<span class="kn">from</span> <span class="nn">wagtail.core.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.routable_page.models</span> <span class="kn">import</span> <span class="n">RoutablePageMixin</span><span class="p">,</span> <span class="n">route</span>


<span class="k">class</span> <span class="nc">EventIndexPage</span><span class="p">(</span><span class="n">RoutablePageMixin</span><span class="p">,</span> <span class="n">Page</span><span class="p">):</span>

    <span class="c1"># Routable pages can have fields like any other - here we would</span>
    <span class="c1"># render the intro text on a template with {{ page.intro|richtext }}</span>
    <span class="n">intro</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">()</span>

    <span class="nd">@route</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">)</span> <span class="c1"># will override the default Page serving mechanism</span>
    <span class="k">def</span> <span class="nf">current_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        View function for the current events page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">event_date__gte</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>

        <span class="c1"># NOTE: We can use the RoutablePageMixin.render() method to render</span>
        <span class="c1"># the page as normal, but with some of the context values overridden</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">context_overrides</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Current events&quot;</span><span class="p">,</span>
            <span class="s1">&#39;events&#39;</span><span class="p">:</span> <span class="n">events</span><span class="p">,</span>
        <span class="p">})</span>

    <span class="nd">@route</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^past/$&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">past_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        View function for the past events page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">event_date__lt</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>

        <span class="c1"># NOTE: We are overriding the template here, as well as few context values</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">context_overrides</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Past events&quot;</span><span class="p">,</span>
                <span class="s1">&#39;events&#39;</span><span class="p">:</span> <span class="n">events</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">template</span><span class="o">=</span><span class="s2">&quot;events/event_index_historical.html&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Multiple routes!</span>
    <span class="nd">@route</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^year/(\d+)/$&#39;</span><span class="p">)</span>
    <span class="nd">@route</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^year/current/$&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">events_for_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        View function for the events for year page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>

        <span class="n">events</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">event_date__year</span><span class="o">=</span><span class="n">year</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">context_overrides</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Events for </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">year</span><span class="p">,</span>
            <span class="s1">&#39;events&#39;</span><span class="p">:</span> <span class="n">events</span><span class="p">,</span>
        <span class="p">})</span>

    <span class="nd">@route</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^year/(\d+)/count/$&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">count_for_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        View function that returns a simple JSON response that</span>
<span class="sd">        includes the number of events scheduled for a specific year</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">event_date__year</span><span class="o">=</span><span class="n">year</span><span class="p">)</span>

        <span class="c1"># NOTE: The usual template/context rendering process is irrelevant</span>
        <span class="c1"># here, so we&#39;ll just return a HttpResponse directly</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">events</span><span class="o">.</span><span class="n">count</span><span class="p">()})</span>
</pre></div>
</div>
</div>
<div class="section" id="rendering-other-pages">
<h6>Rendering other pages<a class="headerlink" href="#rendering-other-pages" title="Permalink to this headline">¶</a></h6>
<p>Another way of returning an <code class="docutils literal notranslate"><span class="pre">HttpResponse</span></code> is to call the <code class="docutils literal notranslate"><span class="pre">serve</span></code> method of another page. (Calling a page’s own <code class="docutils literal notranslate"><span class="pre">serve</span></code> method within a view method is not valid, as the view method is already being called within <code class="docutils literal notranslate"><span class="pre">serve</span></code>, and this would create a circular definition).</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">EventIndexPage</span></code> could be extended with a <code class="docutils literal notranslate"><span class="pre">next/</span></code> route that displays the page for the next event:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@route</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^next/$&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">next_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display the page for the next event</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">future_events</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">event_date__gt</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
    <span class="n">next_event</span> <span class="o">=</span> <span class="n">future_events</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;event_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">next_event</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="reversing-urls">
<h6>Reversing URLs<a class="headerlink" href="#reversing-urls" title="Permalink to this headline">¶</a></h6>
<p><a class="reference internal" href="#wagtail.contrib.routable_page.models.RoutablePageMixin" title="wagtail.contrib.routable_page.models.RoutablePageMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code></a> adds a <a class="reference internal" href="#wagtail.contrib.routable_page.models.RoutablePageMixin.reverse_subpage" title="wagtail.contrib.routable_page.models.RoutablePageMixin.reverse_subpage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reverse_subpage()</span></code></a> method to your page model which you can use for reversing URLs. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The URL name defaults to the view method name.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">event_page</span><span class="o">.</span><span class="n">reverse_subpage</span><span class="p">(</span><span class="s1">&#39;events_for_year&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="p">))</span>
<span class="s1">&#39;year/2015/&#39;</span>
</pre></div>
</div>
<p>This method only returns the part of the URL within the page. To get the full URL, you must append it to the values of either the <code class="xref py py-attr docutils literal notranslate"><span class="pre">url</span></code> or the <a class="reference internal" href="index.html#wagtail.core.models.Page.full_url" title="wagtail.core.models.Page.full_url"><code class="xref py py-attr docutils literal notranslate"><span class="pre">full_url</span></code></a> attribute on your page:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">event_page</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="n">event_page</span><span class="o">.</span><span class="n">reverse_subpage</span><span class="p">(</span><span class="s1">&#39;events_for_year&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="p">))</span>
<span class="go">&#39;/events/year/2015/&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">event_page</span><span class="o">.</span><span class="n">full_url</span> <span class="o">+</span> <span class="n">event_page</span><span class="o">.</span><span class="n">reverse_subpage</span><span class="p">(</span><span class="s1">&#39;events_for_year&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="p">))</span>
<span class="go">&#39;http://example.com/events/year/2015/&#39;</span>
</pre></div>
</div>
<div class="section" id="changing-route-names">
<h7>Changing route names<a class="headerlink" href="#changing-route-names" title="Permalink to this headline">¶</a></h7>
<p>The route name defaults to the name of the view. You can override this name with the <code class="docutils literal notranslate"><span class="pre">name</span></code> keyword argument on <code class="docutils literal notranslate"><span class="pre">&#64;route</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.routable_page.models</span> <span class="kn">import</span> <span class="n">RoutablePageMixin</span><span class="p">,</span> <span class="n">route</span>


<span class="k">class</span> <span class="nc">EventPage</span><span class="p">(</span><span class="n">RoutablePageMixin</span><span class="p">,</span> <span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="nd">@route</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^year/(\d+)/$&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">events_for_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        View function for the events for year page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">event_page</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="n">event_page</span><span class="o">.</span><span class="n">reverse_subpage</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="p">))</span>
<span class="go">&#39;/events/year/2015/&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="module-wagtail.contrib.routable_page.models">
<span id="the-routablepagemixin-class"></span><h6>The <code class="docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code> class<a class="headerlink" href="#module-wagtail.contrib.routable_page.models" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="wagtail.contrib.routable_page.models.RoutablePageMixin">
<em class="property">class </em><code class="descclassname">wagtail.contrib.routable_page.models.</code><code class="descname">RoutablePageMixin</code><a class="headerlink" href="#wagtail.contrib.routable_page.models.RoutablePageMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This class can be mixed in to a Page model, allowing extra routes to be
added to it.</p>
<blockquote>
<div><dl class="method">
<dt id="wagtail.contrib.routable_page.models.RoutablePageMixin.render">
<code class="descname">render</code><span class="sig-paren">(</span><em>request</em>, <em>*args</em>, <em>template=None</em>, <em>context_overrides=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.routable_page.models.RoutablePageMixin.render" title="Permalink to this definition">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified">New in version 2.11.</span></p>
</div>
<p>This method replicates what <code class="docutils literal notranslate"><span class="pre">Page.serve()</span></code> usually does when <code class="docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code>
is not used. By default, <code class="docutils literal notranslate"><span class="pre">Page.get_template()</span></code> is called to derive the template
to use for rendering, and <code class="docutils literal notranslate"><span class="pre">Page.get_context()</span></code> is always called to gather the
data to be included in the context.</p>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">context_overrides</span></code> keyword argument as a shortcut to override or
add new values to the context. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@route</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">)</span> <span class="c1"># override the default route</span>
<span class="k">def</span> <span class="nf">upcoming_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">context_overrides</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Current events&quot;</span><span class="p">,</span>
        <span class="s1">&#39;events&#39;</span><span class="p">:</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">future</span><span class="p">(),</span>
    <span class="p">})</span>
</pre></div>
</div>
<p>You can also use the <code class="docutils literal notranslate"><span class="pre">template</span></code> argument to specify an alternative
template to use for rendering. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@route</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^past/$&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">past_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
        <span class="n">request</span><span class="p">,</span>
        <span class="n">context_overrides</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Past events&quot;</span><span class="p">,</span>
            <span class="s1">&#39;events&#39;</span><span class="p">:</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">live</span><span class="p">()</span><span class="o">.</span><span class="n">past</span><span class="p">(),</span>
        <span class="p">},</span>
        <span class="n">template</span><span class="o">=</span><span class="s2">&quot;events/event_index_historical.html&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="wagtail.contrib.routable_page.models.RoutablePageMixin.get_subpage_urls">
<em class="property">classmethod </em><code class="descname">get_subpage_urls</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.routable_page.models.RoutablePageMixin.get_subpage_urls" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wagtail.contrib.routable_page.models.RoutablePageMixin.resolve_subpage">
<code class="descname">resolve_subpage</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.routable_page.models.RoutablePageMixin.resolve_subpage" title="Permalink to this definition">¶</a></dt>
<dd><p>This method takes a URL path and finds the view to call.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">view</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">resolve_subpage</span><span class="p">(</span><span class="s1">&#39;/past/&#39;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wagtail.contrib.routable_page.models.RoutablePageMixin.reverse_subpage">
<code class="descname">reverse_subpage</code><span class="sig-paren">(</span><em>name</em>, <em>args=None</em>, <em>kwargs=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.routable_page.models.RoutablePageMixin.reverse_subpage" title="Permalink to this definition">¶</a></dt>
<dd><p>This method takes a route name/arguments and returns a URL path.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="n">page</span><span class="o">.</span><span class="n">reverse_subpage</span><span class="p">(</span><span class="s1">&#39;events_for_year&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="s1">&#39;2014&#39;</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

</div></blockquote>
</dd></dl>

</div>
<div class="section" id="the-routablepageurl-template-tag">
<span id="routablepageurl-template-tag"></span><h6>The <code class="docutils literal notranslate"><span class="pre">routablepageurl</span></code> template tag<a class="headerlink" href="#the-routablepageurl-template-tag" title="Permalink to this headline">¶</a></h6>
<dl class="function">
<dt id="wagtail.contrib.routable_page.templatetags.wagtailroutablepage_tags.routablepageurl">
<code class="descclassname">wagtail.contrib.routable_page.templatetags.wagtailroutablepage_tags.</code><code class="descname">routablepageurl</code><span class="sig-paren">(</span><em>context</em>, <em>page</em>, <em>url_name</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.routable_page.templatetags.wagtailroutablepage_tags.routablepageurl" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">routablepageurl</span></code> is similar to <code class="docutils literal notranslate"><span class="pre">pageurl</span></code>, but works with
pages using <code class="docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code>. It behaves like a hybrid between the built-in
<code class="docutils literal notranslate"><span class="pre">reverse</span></code>, and <code class="docutils literal notranslate"><span class="pre">pageurl</span></code> from Wagtail.</p>
<p><code class="docutils literal notranslate"><span class="pre">page</span></code> is the RoutablePage that URLs will be generated from.</p>
<p><code class="docutils literal notranslate"><span class="pre">url_name</span></code> is a URL name defined in <code class="docutils literal notranslate"><span class="pre">page.subpage_urls</span></code>.</p>
<p>Positional arguments and keyword arguments should be passed as normal
positional arguments and keyword arguments.</p>
<p>Example:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailroutablepage_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">routablepageurl</span> <span class="nv">page</span> <span class="s2">&quot;feed&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">routablepageurl</span> <span class="nv">page</span> <span class="s2">&quot;archive&quot;</span> <span class="m">2014</span> <span class="m">08</span> <span class="m">14</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">routablepageurl</span> <span class="nv">page</span> <span class="s2">&quot;food&quot;</span> <span class="nv">foo</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span> <span class="nv">baz</span><span class="o">=</span><span class="s2">&quot;quux&quot;</span> <span class="cp">%}</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
<span id="document-reference/contrib/modeladmin/index"></span><div class="section" id="modeladmin">
<h5><code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code><a class="headerlink" href="#modeladmin" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code> module allows you to add any model in your project to the Wagtail admin.  You can create customisable listing
pages for a model, including plain Django models, and add navigation elements so that a model can be accessed directly from the Wagtail admin. Simply extend the <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class, override a few attributes to suit your needs, register it with Wagtail using an easy one-line <code class="docutils literal notranslate"><span class="pre">modeladmin_register</span></code> method (you can copy and paste from the examples below), and you’re good to go. Your model doesn’t need to extend <code class="docutils literal notranslate"><span class="pre">Page</span></code> or be registered as a <code class="docutils literal notranslate"><span class="pre">Snippet</span></code>, and it won’t interfere with any of the existing admin functionality that Wagtail provides.</p>
<div class="section" id="summary-of-features">
<span id="modeladmin-feature-summary"></span><h6>Summary of features<a class="headerlink" href="#summary-of-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>A customisable list view, allowing you to control what values are displayed
for each row, available options for result filtering, default ordering,
spreadsheet downloads and more.</li>
<li>Access your list views from the Wagtail admin menu easily with automatically
generated menu items, with automatic ‘active item’ highlighting. Control the
label text and icons used with easy-to-change attributes on your class.</li>
<li>An additional <code class="docutils literal notranslate"><span class="pre">ModelAdminGroup</span></code> class, that allows you to group your
related models, and list them together in their own submenu, for a more
logical user experience.</li>
<li>Simple, robust <strong>add</strong> and <strong>edit</strong> views for your non-Page models that use
the panel configurations defined on your model using Wagtail’s edit panels.</li>
<li>For Page models, the system directs to Wagtail’s existing add and
edit views, and returns you back to the correct list page, for a seamless
experience.</li>
<li>Full respect for permissions assigned to your Wagtail users and groups. Users
will only be able to do what you want them to!</li>
<li>All you need to easily hook your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> classes into Wagtail, taking
care of URL registration, menu changes, and registering any missing model
permissions, so that you can assign them to Groups.</li>
<li><strong>Built to be customisable</strong> - While <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code> provides a solid
experience out of the box, you can easily use your own templates, and the
<code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class has a large number of methods that you can override or
extend, allowing you to customise the behaviour to a greater degree.</li>
</ul>
</div>
<div class="section" id="want-to-know-more-about-customising-modeladmin">
<h6>Want to know more about customising <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code>?<a class="headerlink" href="#want-to-know-more-about-customising-modeladmin" title="Permalink to this headline">¶</a></h6>
<div class="toctree-wrapper compound">
<span id="document-reference/contrib/modeladmin/primer"></span><div class="section" id="modeladmin-customisation-primer">
<h7><code class="docutils literal notranslate"><span class="pre">modeladmin</span></code> customisation primer<a class="headerlink" href="#modeladmin-customisation-primer" title="Permalink to this headline">¶</a></h7>
<p>The <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code> app is designed to offer you as much flexibility as possible
in how your model and its objects are represented in Wagtail’s CMS. This page
aims to provide you with some background information to help you gain a better
understanding of what the app can do, and to point you in the right direction,
depending on the kind of customisations you’re looking to make.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#wagtail-s-modeladmin-class-isn-t-the-same-as-django-s" id="id4">Wagtail’s <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class isn’t the same as Django’s</a></li>
<li><a class="reference internal" href="#changing-what-appears-in-the-listing" id="id5">Changing what appears in the listing</a></li>
<li><a class="reference internal" href="#adding-additional-stylesheets-and-or-javascript" id="id6">Adding additional stylesheets and/or JavaScript</a></li>
<li><a class="reference internal" href="#overriding-templates" id="id7">Overriding templates</a></li>
<li><a class="reference internal" href="#overriding-views" id="id8">Overriding views</a></li>
<li><a class="reference internal" href="#overriding-helper-classes" id="id9">Overriding helper classes</a></li>
</ul>
</div>
<div class="section" id="wagtail-s-modeladmin-class-isn-t-the-same-as-django-s">
<h8><a class="toc-backref" href="#id4">Wagtail’s <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class isn’t the same as Django’s</a><a class="headerlink" href="#wagtail-s-modeladmin-class-isn-t-the-same-as-django-s" title="Permalink to this headline">¶</a></h8>
<p>Wagtail’s <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class is designed to be used in a similar way to
Django’s class of the same name, and it often uses the same attribute and method
names to achieve similar things. However, there are a few key differences:</p>
<div class="section" id="add-edit-forms-are-still-defined-by-panels-and-edit-handlers">
<h9>Add &amp; edit forms are still defined by <code class="docutils literal notranslate"><span class="pre">panels</span></code> and <code class="docutils literal notranslate"><span class="pre">edit_handlers</span></code><a class="headerlink" href="#add-edit-forms-are-still-defined-by-panels-and-edit-handlers" title="Permalink to this headline">¶</a></h9>
<p>In Wagtail, controlling which fields appear in add/edit forms for your
<code class="docutils literal notranslate"><span class="pre">Model</span></code>, and defining how they are grouped and ordered, is achieved by
adding a <code class="docutils literal notranslate"><span class="pre">panels</span></code> attribute, or <cite>edit_handler</cite> to your <code class="docutils literal notranslate"><span class="pre">Model</span></code> class.
This remains the same whether your model is a <code class="docutils literal notranslate"><span class="pre">Page</span></code> type, a snippet, or
just a standard Django <code class="docutils literal notranslate"><span class="pre">Model</span></code>. Because of this, Wagtail’s <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code>
class is mostly concerned with ‘listing’ configuration. For example,
<code class="docutils literal notranslate"><span class="pre">list_display</span></code>, <code class="docutils literal notranslate"><span class="pre">list_filter</span></code> and <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> attributes are
present and support largely the same values as Django’s ModelAdmin class,
while <cite>fields</cite>, <cite>fieldsets</cite>, <cite>exclude</cite> and other attributes you may be used
to using to configure Django’s add/edit views, simply aren’t supported by
Wagtail’s version.</p>
</div>
<div class="section" id="page-type-models-need-to-be-treated-differently-from-other-models">
<h9>‘Page type’ models need to be treated differently from other models<a class="headerlink" href="#page-type-models-need-to-be-treated-differently-from-other-models" title="Permalink to this headline">¶</a></h9>
<p>While <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code>’s listing view and it’s supported customisation
options work in exactly the same way for all types of <code class="docutils literal notranslate"><span class="pre">Model</span></code>, when it
comes to the other management views, the treatment differs depending on
whether your ModelAdmin class is representing a page type model (that
extends <code class="docutils literal notranslate"><span class="pre">wagtailcore.models.Page</span></code>) or not.</p>
<p>Pages in Wagtail have some unique properties, and require additional views,
interface elements and general treatment in order to be managed
effectively. For example, they have a tree structure that must be preserved
properly as pages are added, deleted and moved around. They also have a
revisions system, their own permission considerations, and the facility to
preview changes before saving changes. Because of this added complexity,
Wagtail provides its own specific views for managing any custom page types
you  might add to your project (whether you create a <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class
for them or not).</p>
<p>In order to deliver a consistent user experience, <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code>
simply redirects users to Wagtail’s existing page management views wherever
possible. You should bear this in mind if you ever find yourself wanting to
change what happens when pages of a certain type are added, deleted,
published, or have some other action applied to them. Customising the
<code class="docutils literal notranslate"><span class="pre">CreateView</span></code> or <code class="docutils literal notranslate"><span class="pre">EditView</span></code> for your page type <code class="docutils literal notranslate"><span class="pre">Model</span></code> (even if just
to add an additional stylesheet or JavaScript), simply won’t have any
effect, as those views are not used.</p>
<p>If you do find yourself needing to customise the add, edit or other
behaviour for a page type model, you should take a look at the following
part of the documentation: <a class="reference internal" href="index.html#admin-hooks"><span class="std std-ref">Hooks</span></a>.</p>
</div>
<div class="section" id="wagtail-s-modeladmin-class-is-modular">
<h9>Wagtail’s <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class is ‘modular’<a class="headerlink" href="#wagtail-s-modeladmin-class-is-modular" title="Permalink to this headline">¶</a></h9>
<p>Unlike Django’s class of the same name, wagtailadmin’s <code class="docutils literal notranslate"><span class="pre">ModelAmin</span></code> acts
primarily as a ‘controller’ class. While it does have a set of attributes
and methods to enable you to configure how various components should treat
your model, it has been deliberately designed to do as little work as
possible by itself; it designates all of the real work to a set of
separate, swappable components.</p>
<p>The theory is: If you want to do something differently, or add some
functionality that <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code> doesn’t already have, you can create new
classes (or extend the ones provided by <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code>) and easily
configure your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class to use them instead of the defaults.</p>
<ul class="simple">
<li>Learn more about <a class="reference internal" href="#modeladmin-overriding-views"><span class="std std-ref">Overriding views</span></a></li>
<li>Learn more about <a class="reference internal" href="#modeladmin-overriding-helper-classes"><span class="std std-ref">Overriding helper classes</span></a></li>
</ul>
</div>
</div>
<div class="section" id="changing-what-appears-in-the-listing">
<h8><a class="toc-backref" href="#id5">Changing what appears in the listing</a><a class="headerlink" href="#changing-what-appears-in-the-listing" title="Permalink to this headline">¶</a></h8>
<p>You should familiarise yourself with the attributes and methods supported by
the <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class, that allow you to change what is displayed in the
<code class="docutils literal notranslate"><span class="pre">IndexView</span></code>. The following page should give you everything you need to get
going: <a class="reference internal" href="index.html#document-reference/contrib/modeladmin/indexview"><span class="doc">Customising IndexView - the listing view</span></a></p>
</div>
<div class="section" id="adding-additional-stylesheets-and-or-javascript">
<span id="modeladmin-adding-css-and-js"></span><h8><a class="toc-backref" href="#id6">Adding additional stylesheets and/or JavaScript</a><a class="headerlink" href="#adding-additional-stylesheets-and-or-javascript" title="Permalink to this headline">¶</a></h8>
<p>The <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class provides several attributes to enable you to easily
add additional stylesheets and JavaScript to the admin interface for your
model. Each attribute simply needs to be a list of paths to the files you
want to include. If the path is for a file in your project’s static directory,
then Wagtail will automatically prepend the path with <code class="docutils literal notranslate"><span class="pre">STATIC_URL</span></code> so that you don’t need to repeat it each time in your list of paths.</p>
<p>If you’d like to add styles or scripts to the <code class="docutils literal notranslate"><span class="pre">IndexView</span></code>, you should set the
following attributes:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">index_view_extra_css</span></code> -  Where each item is the path name of a
pre-compiled stylesheet that you’d like to include.</li>
<li><code class="docutils literal notranslate"><span class="pre">index_view_extra_js</span></code> - Where each item is the path name of a JavaScript
file that you’d like to include.</li>
</ul>
<p>If you’d like to do the same for <code class="docutils literal notranslate"><span class="pre">CreateView</span></code> and <code class="docutils literal notranslate"><span class="pre">EditView</span></code>, you should
set the following attributes:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">form_view_extra_css</span></code> -  Where each item is the path name of a
pre-compiled stylesheet that you’d like to include.</li>
<li><code class="docutils literal notranslate"><span class="pre">form_view_extra_js</span></code> - Where each item is the path name of a JavaScript
file that you’d like to include.</li>
</ul>
<p>And if you’re using the <code class="docutils literal notranslate"><span class="pre">InspectView</span></code> for your model, and want to do the same
for that view, you should set the following attributes:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">inspect_view_extra_css</span></code> -  Where each item is the path name of a
pre-compiled stylesheet that you’d like to include.</li>
<li><code class="docutils literal notranslate"><span class="pre">inspect_view_extra_js</span></code> - Where each item is the path name of a JavaScript
file that you’d like to include.</li>
</ul>
</div>
<div class="section" id="overriding-templates">
<span id="modeladmin-overriding-templates"></span><h8><a class="toc-backref" href="#id7">Overriding templates</a><a class="headerlink" href="#overriding-templates" title="Permalink to this headline">¶</a></h8>
<p>For all modeladmin views, Wagtail looks for templates in the following folders
within your project, before resorting to the defaults:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">/modeladmin/app-name/model-name/</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/modeladmin/app-name/</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/modeladmin/</span></code></li>
</ol>
<p>So, to override the template used by <code class="docutils literal notranslate"><span class="pre">IndexView</span></code> for example, you’d create a
new <code class="docutils literal notranslate"><span class="pre">index.html</span></code> template and put it in one of those locations.  For example,
if you wanted to do this for an <code class="docutils literal notranslate"><span class="pre">ArticlePage</span></code> model in a <code class="docutils literal notranslate"><span class="pre">news</span></code> app, you’d
add your custom template as <code class="docutils literal notranslate"><span class="pre">modeladmin/news/articlepage/index.html</span></code>.</p>
<p>For reference, <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code> looks for templates with the following names for
each view:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'index.html'</span></code> for <code class="docutils literal notranslate"><span class="pre">IndexView</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'inspect.html'</span></code> for <code class="docutils literal notranslate"><span class="pre">InspectView</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'create.html'</span></code> for <code class="docutils literal notranslate"><span class="pre">CreateView</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'edit.html'</span></code> for <code class="docutils literal notranslate"><span class="pre">EditView</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'delete.html'</span></code> for <code class="docutils literal notranslate"><span class="pre">DeleteView</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'choose_parent.html'</span></code> for <code class="docutils literal notranslate"><span class="pre">ChooseParentView</span></code></li>
</ul>
<p>To add extra information to a block within one of the above Wagtail templates, use Django’s <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">block.super</span> <span class="pre">}}</span></code> within the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">...</span> <span class="pre">%}</span></code> that you wish to extend.  For example, if you wish to display an image in an edit form below the fields of the model that is being edited, you could do the following:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;modeladmin/edit.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="cp">{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;object&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">get_media_prefix</span> <span class="cp">%}{{</span> <span class="nv">instance.image</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>If for any reason you’d rather bypass the above behaviour and explicitly specify a
template for a specific view, you can set either of the following attributes
on your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">index_template_name</span></code> to specify a template for <code class="docutils literal notranslate"><span class="pre">IndexView</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">inspect_template_name</span></code> to specify a template for <code class="docutils literal notranslate"><span class="pre">InspectView</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">create_template_name</span></code> to specify a template for <code class="docutils literal notranslate"><span class="pre">CreateView</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">edit_template_name</span></code> to specify a template for <code class="docutils literal notranslate"><span class="pre">EditView</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">delete_template_name</span></code> to specify a template for <code class="docutils literal notranslate"><span class="pre">DeleteView</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">choose_parent_template_name</span></code> to specify a template for <code class="docutils literal notranslate"><span class="pre">ChooseParentView</span></code></li>
</ul>
</div>
<div class="section" id="overriding-views">
<span id="modeladmin-overriding-views"></span><h8><a class="toc-backref" href="#id8">Overriding views</a><a class="headerlink" href="#overriding-views" title="Permalink to this headline">¶</a></h8>
<p>For all of the views offered by <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code>, the class provides an attribute
that you can override in order to tell it which class you’d like to use:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">index_view_class</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">inspect_view_class</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">create_view_class</span></code> (not used for ‘page type’ models)</li>
<li><code class="docutils literal notranslate"><span class="pre">edit_view_class</span></code> (not used for ‘page type’ models)</li>
<li><code class="docutils literal notranslate"><span class="pre">delete_view_class</span></code> (not used for ‘page type’ models)</li>
<li><code class="docutils literal notranslate"><span class="pre">choose_parent_view_class</span></code> (only used for ‘page type’ models)</li>
</ul>
<p>For example, if you’d like to create your own view class and use it for the
<code class="docutils literal notranslate"><span class="pre">IndexView</span></code>, you would do the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.views</span> <span class="kn">import</span> <span class="n">IndexView</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MyModel</span>

<span class="k">class</span> <span class="nc">MyCustomIndexView</span><span class="p">(</span><span class="n">IndexView</span><span class="p">):</span>
    <span class="c1"># New functionality and existing method overrides added here</span>
    <span class="o">...</span>


<span class="k">class</span> <span class="nc">MyModelAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span>
    <span class="n">index_view_class</span> <span class="o">=</span> <span class="n">MyCustomIndexView</span>
</pre></div>
</div>
<p>Or, if you have no need for any of <code class="docutils literal notranslate"><span class="pre">IndexView</span></code>’s existing functionality in
your view and would rather create your own view from scratch, <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code>
will support that too. However, it’s highly recommended that you use
<code class="docutils literal notranslate"><span class="pre">modeladmin.views.WMABaseView</span></code> as a base for your view. It’ll make
integrating with your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class much easier and will provide a bunch of
useful attributes and methods to get you started.</p>
<p>You can also use the url_helper to easily reverse URLs for any ModelAdmin see <a class="reference internal" href="index.html#modeladmin-reversing-urls"><span class="std std-ref">Reversing ModelAdmin URLs</span></a>.</p>
</div>
<div class="section" id="overriding-helper-classes">
<span id="modeladmin-overriding-helper-classes"></span><h8><a class="toc-backref" href="#id9">Overriding helper classes</a><a class="headerlink" href="#overriding-helper-classes" title="Permalink to this headline">¶</a></h8>
<p>While ‘view classes’ are responsible for a lot of the work, there are also
a number of other tasks that <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code> must do regularly, that need to be
handled in a consistent way, and in a number of different places. These tasks
are designated to a set of simple classes (in <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code>, these are termed
‘helper’ classes) and can be found in <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.modeladmin.helpers</span></code>.</p>
<p>If you ever intend to write and use your own custom views with <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code>,
you should familiarise yourself with these helpers, as they are made available
to views via the <code class="docutils literal notranslate"><span class="pre">modeladmin.views.WMABaseView</span></code> view.</p>
<p>There are three types of ‘helper class’:</p>
<ul class="simple">
<li><strong>URL helpers</strong> - That help with the consistent generation, naming and
referencing of urls.</li>
<li><strong>Permission helpers</strong> - That help with ensuring only users with sufficient
permissions can perform certain actions, or see options to perform those
actions.</li>
<li><strong>Button helpers</strong> - That, with the help of the other two, helps with the
generation of buttons for use in a number of places.</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class allows you to define and use your own helper classes
by setting values on the following attributes:</p>
<div class="section" id="modeladmin-url-helper-class">
<span id="id1"></span><h9><code class="docutils literal notranslate"><span class="pre">ModelAdmin.url_helper_class</span></code><a class="headerlink" href="#modeladmin-url-helper-class" title="Permalink to this headline">¶</a></h9>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">modeladmin.helpers.url.PageAdminURLHelper</span></code> class is used
when your model extends <code class="docutils literal notranslate"><span class="pre">wagtailcore.models.Page</span></code>, otherwise
<code class="docutils literal notranslate"><span class="pre">modeladmin.helpers.url.AdminURLHelper</span></code> is used.</p>
<p>If you find that the above helper classes don’t work for your needs, you can
easily create your own helper class by sub-classing <code class="docutils literal notranslate"><span class="pre">AdminURLHelper</span></code> or
<code class="docutils literal notranslate"><span class="pre">PageAdminURLHelper</span></code> (if your  model extends Wagtail’s <code class="docutils literal notranslate"><span class="pre">Page</span></code> model), and
making any necessary additions/overrides.</p>
<p>Once your class is defined, set the <code class="docutils literal notranslate"><span class="pre">url_helper_class</span></code> attribute on
your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class to use your custom URLHelper, like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.helpers</span> <span class="kn">import</span> <span class="n">AdminURLHelper</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span><span class="p">,</span> <span class="n">modeladmin_register</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MyModel</span>


<span class="k">class</span> <span class="nc">MyURLHelper</span><span class="p">(</span><span class="n">AdminURLHelper</span><span class="p">):</span>
    <span class="o">...</span>


<span class="k">class</span> <span class="nc">MyModelAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span>
    <span class="n">url_helper_class</span> <span class="o">=</span> <span class="n">MyURLHelper</span>

<span class="n">modeladmin_register</span><span class="p">(</span><span class="n">MyModelAdmin</span><span class="p">)</span>
</pre></div>
</div>
<p>Or, if you have a more complicated use case, where simply setting that
attribute isn’t possible (due to circular imports, for example) or doesn’t
meet your needs, you can override the  <code class="docutils literal notranslate"><span class="pre">get_url_helper_class</span></code> method, like
so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModelAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span>

    <span class="k">def</span> <span class="nf">get_url_helper_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">some_attribute</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MyURLHelper</span>
        <span class="k">return</span> <span class="n">AdminURLHelper</span>
</pre></div>
</div>
</div>
<div class="section" id="modeladmin-permission-helper-class">
<span id="id2"></span><h9><code class="docutils literal notranslate"><span class="pre">ModelAdmin.permission_helper_class</span></code><a class="headerlink" href="#modeladmin-permission-helper-class" title="Permalink to this headline">¶</a></h9>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">modeladmin.helpers.permission.PagePermissionHelper</span></code>
class is used when your model extends <code class="docutils literal notranslate"><span class="pre">wagtailcore.models.Page</span></code>,
otherwise <code class="docutils literal notranslate"><span class="pre">modeladmin.helpers.permission.PermissionHelper</span></code> is used.</p>
<p>If you find that the above helper classes don’t work for your needs, you can
easily create your own helper class, by sub-classing
<code class="docutils literal notranslate"><span class="pre">PermissionHelper</span></code> (or <code class="docutils literal notranslate"><span class="pre">PagePermissionHelper</span></code> if your model extends Wagtail’s <code class="docutils literal notranslate"><span class="pre">Page</span></code> model),
and making any necessary additions/overrides. Once
defined, you set the <code class="docutils literal notranslate"><span class="pre">permission_helper_class</span></code> attribute on your
<code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class to use your custom class instead of the default, like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.helpers</span> <span class="kn">import</span> <span class="n">PermissionHelper</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span><span class="p">,</span> <span class="n">modeladmin_register</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MyModel</span>


<span class="k">class</span> <span class="nc">MyPermissionHelper</span><span class="p">(</span><span class="n">PermissionHelper</span><span class="p">):</span>
    <span class="o">...</span>


<span class="k">class</span> <span class="nc">MyModelAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span>
    <span class="n">permission_helper_class</span> <span class="o">=</span> <span class="n">MyPermissionHelper</span>

<span class="n">modeladmin_register</span><span class="p">(</span><span class="n">MyModelAdmin</span><span class="p">)</span>
</pre></div>
</div>
<p>Or, if you have a more complicated use case, where simply setting an attribute
isn’t possible or doesn’t meet your needs, you can override the
<code class="docutils literal notranslate"><span class="pre">get_permission_helper_class</span></code> method, like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModelAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span>

    <span class="k">def</span> <span class="nf">get_permission_helper_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">some_attribute</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MyPermissionHelper</span>
        <span class="k">return</span> <span class="n">PermissionHelper</span>
</pre></div>
</div>
</div>
<div class="section" id="modeladmin-button-helper-class">
<span id="id3"></span><h9><code class="docutils literal notranslate"><span class="pre">ModelAdmin.button_helper_class</span></code><a class="headerlink" href="#modeladmin-button-helper-class" title="Permalink to this headline">¶</a></h9>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">modeladmin.helpers.button.PageButtonHelper</span></code> class is used
when your model extends <code class="docutils literal notranslate"><span class="pre">wagtailcore.models.Page</span></code>, otherwise
<code class="docutils literal notranslate"><span class="pre">modeladmin.helpers.button.ButtonHelper</span></code> is used.</p>
<p>If you wish to add or change buttons for your model’s IndexView, you’ll need to
create  your own button helper class by sub-classing <code class="docutils literal notranslate"><span class="pre">ButtonHelper</span></code> or <code class="docutils literal notranslate"><span class="pre">PageButtonHelper</span></code> (if
your  model extend’s Wagtail’s <code class="docutils literal notranslate"><span class="pre">Page</span></code> model), and
make any necessary additions/overrides. Once defined, you set the
<code class="docutils literal notranslate"><span class="pre">button_helper_class</span></code> attribute on your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class to use your
custom class instead of the default, like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.helpers</span> <span class="kn">import</span> <span class="n">ButtonHelper</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span><span class="p">,</span> <span class="n">modeladmin_register</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MyModel</span>


<span class="k">class</span> <span class="nc">MyButtonHelper</span><span class="p">(</span><span class="n">ButtonHelper</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classnames_add</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">classnames_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">classnames_add</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">classnames_add</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">classnames_exclude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">classnames_exclude</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">classnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_button_classnames</span> <span class="o">+</span> <span class="n">classnames_add</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalise_classname</span><span class="p">(</span><span class="n">classnames</span><span class="p">,</span> <span class="n">classnames_exclude</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_helper</span><span class="o">.</span><span class="n">create_url</span><span class="p">,</span>
            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Add </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span>
            <span class="s1">&#39;classname&#39;</span><span class="p">:</span> <span class="n">cn</span><span class="p">,</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Add a new </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">inspect_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">classnames_add</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">classnames_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">edit_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">classnames_add</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">classnames_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">delete_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">classnames_add</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">classnames_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="o">...</span>


<span class="k">class</span> <span class="nc">MyModelAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span>
    <span class="n">button_helper_class</span> <span class="o">=</span> <span class="n">MyButtonHelper</span>

<span class="n">modeladmin_register</span><span class="p">(</span><span class="n">MyModelAdmin</span><span class="p">)</span>
</pre></div>
</div>
<p>To customise the buttons found in the ModelAdmin List View you can change the
returned dictionary in the <code class="docutils literal notranslate"><span class="pre">add_button</span></code>, <code class="docutils literal notranslate"><span class="pre">delete_button</span></code>, <code class="docutils literal notranslate"><span class="pre">edit_button</span></code>
or <code class="docutils literal notranslate"><span class="pre">inspect_button</span></code> methods. For example if you wanted to change the <code class="docutils literal notranslate"><span class="pre">Delete</span></code>
button you could modify the <code class="docutils literal notranslate"><span class="pre">delete_button</span></code> method in your <code class="docutils literal notranslate"><span class="pre">ButtonHelper</span></code> like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyButtonHelper</span><span class="p">(</span><span class="n">ButtonHelper</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">delete_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">classnames_add</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">classnames_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;your_custom_url&quot;</span><span class="p">),</span>
            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Delete&#39;</span><span class="p">),</span>
            <span class="s1">&#39;classname&#39;</span><span class="p">:</span> <span class="s2">&quot;custom-css-class&quot;</span><span class="p">,</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Delete this item&#39;</span><span class="p">)</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Or, if you have a more complicated use case, where simply setting an attribute
isn’t possible or doesn’t meet your needs, you can override the
<code class="docutils literal notranslate"><span class="pre">get_button_helper_class</span></code> method, like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModelAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span>

    <span class="k">def</span> <span class="nf">get_button_helper_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">some_attribute</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MyButtonHelper</span>
        <span class="k">return</span> <span class="n">ButtonHelper</span>
</pre></div>
</div>
</div>
<div class="section" id="using-helpers-in-your-custom-views">
<span id="modeladmin-helpers-in-custom-views"></span><h9>Using helpers in your custom views<a class="headerlink" href="#using-helpers-in-your-custom-views" title="Permalink to this headline">¶</a></h9>
<p>As long as you sub-class <code class="docutils literal notranslate"><span class="pre">modeladmin.views.WMABaseView</span></code> (or one of the more
‘specific’ view classes) to create your custom view, instances of each helper
should be available on instances of your class as:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">self.url_helper</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">self.permission_helper</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">self.button_helper</span></code></li>
</ul>
<p>Unlike the other two, <cite>self.button_helper</cite> isn’t populated right away when
the view is instantiated. In order to show the right buttons for the right
users, ButtonHelper instances need to be ‘request aware’, so
<code class="docutils literal notranslate"><span class="pre">self.button_helper</span></code> is only set once the view’s <code class="docutils literal notranslate"><span class="pre">dispatch()</span></code> method has
run, which takes a <code class="docutils literal notranslate"><span class="pre">HttpRequest</span></code> object as an argument, from which the
current user can be identified.</p>
</div>
</div>
</div>
<span id="document-reference/contrib/modeladmin/menu_item"></span><div class="section" id="customising-the-menu-item">
<h7>Customising the menu item<a class="headerlink" href="#customising-the-menu-item" title="Permalink to this headline">¶</a></h7>
<p>You can use the following attributes and methods on the <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class to
alter the menu item used to represent your model in Wagtail’s admin area.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#modeladmin-menu-label" id="id5"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.menu_label</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-menu-icon" id="id6"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.menu_icon</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-menu-order" id="id7"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.menu_order</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-add-to-settings-menu" id="id8"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.add_to_settings_menu</span></code></a></li>
</ul>
</div>
<div class="section" id="modeladmin-menu-label">
<span id="id1"></span><h8><a class="toc-backref" href="#id5"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.menu_label</span></code></a><a class="headerlink" href="#modeladmin-menu-label" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A string.</p>
<p>Set this attribute to a string value to override the label used for the menu
item that appears in Wagtail’s sidebar. If not set, the menu item will use
<code class="docutils literal notranslate"><span class="pre">verbose_name_plural</span></code> from your model’s <code class="docutils literal notranslate"><span class="pre">Meta</span></code> data.</p>
</div>
<div class="section" id="modeladmin-menu-icon">
<span id="id2"></span><h8><a class="toc-backref" href="#id6"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.menu_icon</span></code></a><a class="headerlink" href="#modeladmin-menu-icon" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A string matching one of Wagtail’s icon class names.</p>
<p>If you want to change the icon used to represent your model, you can set the
<code class="docutils literal notranslate"><span class="pre">menu_icon</span></code> attribute on your class to use one of the other icons available
in Wagtail’s CMS. The same icon will be used for the menu item in Wagtail’s
sidebar, and will also appear in the header on the list page and other views
for your model. If not set, <code class="docutils literal notranslate"><span class="pre">'doc-full-inverse'</span></code> will be used for
page-type models, and <code class="docutils literal notranslate"><span class="pre">'snippet'</span></code> for others.</p>
<p>If you’re using a <code class="docutils literal notranslate"><span class="pre">ModelAdminGroup</span></code> class to group together several
<code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> classes in their own sub-menu, and want to change the menu item
used to represent the group, you should override the <code class="docutils literal notranslate"><span class="pre">menu_icon</span></code> attribute on
your <code class="docutils literal notranslate"><span class="pre">ModelAdminGroup</span></code> class (<code class="docutils literal notranslate"><span class="pre">'folder-open-inverse'</span></code> is the default).</p>
</div>
<div class="section" id="modeladmin-menu-order">
<span id="id3"></span><h8><a class="toc-backref" href="#id7"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.menu_order</span></code></a><a class="headerlink" href="#modeladmin-menu-order" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: An integer between <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">999</span></code>.</p>
<p>If you want to change the position of the menu item for your model (or group of
models) in Wagtail’s sidebar, you do that by setting <code class="docutils literal notranslate"><span class="pre">menu_order</span></code>. The value
should be an integer between <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">999</span></code>. The lower the value, the higher
up the menu item will appear.</p>
<p>Wagtail’s ‘Explorer’ menu item has an order value of <code class="docutils literal notranslate"><span class="pre">100</span></code>, so supply a value
greater than that if you wish to keep the explorer menu item at the top.</p>
</div>
<div class="section" id="modeladmin-add-to-settings-menu">
<span id="id4"></span><h8><a class="toc-backref" href="#id8"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.add_to_settings_menu</span></code></a><a class="headerlink" href="#modeladmin-add-to-settings-menu" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code></p>
<p>If you’d like the menu item for your model to appear in Wagtail’s ‘Settings’
sub-menu instead of at the top level, add <code class="docutils literal notranslate"><span class="pre">add_to_settings_menu</span> <span class="pre">=</span> <span class="pre">True</span></code> to
your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class.</p>
<p>This will only work for individual <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> classes registered with their
own <code class="docutils literal notranslate"><span class="pre">modeladmin_register</span></code> call. It won’t work for members of a
<code class="docutils literal notranslate"><span class="pre">ModelAdminGroup</span></code>.</p>
</div>
</div>
<span id="document-reference/contrib/modeladmin/indexview"></span><div class="section" id="customising-indexview-the-listing-view">
<h7>Customising <code class="docutils literal notranslate"><span class="pre">IndexView</span></code> - the listing view<a class="headerlink" href="#customising-indexview-the-listing-view" title="Permalink to this headline">¶</a></h7>
<p>For the sake of consistency, this section of the docs will refer to the listing
view as <code class="docutils literal notranslate"><span class="pre">IndexView</span></code>, because that is the view class that does all the heavy
lifting.</p>
<p>You can use the following attributes and methods on the <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class to
alter how your model data is treated and represented by the <code class="docutils literal notranslate"><span class="pre">IndexView</span></code>.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#modeladmin-list-display" id="id19"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.list_display</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-list-export" id="id20"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.list_export</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-list-filter" id="id21"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.list_filter</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-export-filename" id="id22"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.export_filename</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-search-fields" id="id23"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.search_fields</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-search-handler-class" id="id24"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.search_handler_class</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-extra-search-kwargs" id="id25"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.extra_search_kwargs</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-ordering" id="id26"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.ordering</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-list-per-page" id="id27"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.list_per_page</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-get-queryset" id="id28"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.get_queryset()</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-get-extra-attrs-for-row" id="id29"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.get_extra_attrs_for_row()</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-get-extra-class-names-for-field-col" id="id30"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.get_extra_class_names_for_field_col()</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-get-extra-attrs-for-field-col" id="id31"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.get_extra_attrs_for_field_col()</span></code></a></li>
<li><a class="reference internal" href="#wagtail-contrib-modeladmin-mixins-thumbnailmixin" id="id32"><code class="docutils literal notranslate"><span class="pre">wagtail.contrib.modeladmin.mixins.ThumbnailMixin</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-list-display-add-buttons" id="id33"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.list_display_add_buttons</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-index-view-extra-css" id="id34"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.index_view_extra_css</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-index-view-extra-js" id="id35"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.index_view_extra_js</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-index-template-name" id="id36"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.index_template_name</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-index-view-class" id="id37"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.index_view_class</span></code></a></li>
</ul>
</div>
<div class="section" id="modeladmin-list-display">
<span id="id1"></span><h8><a class="toc-backref" href="#id19"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.list_display</span></code></a><a class="headerlink" href="#modeladmin-list-display" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A list or tuple, where each item is the name of a field or
single-argument callable on your model, or a similarly simple method defined
on the <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class itself.</p>
<p>Default value: <code class="docutils literal notranslate"><span class="pre">('__str__',)</span></code></p>
<p>Set <code class="docutils literal notranslate"><span class="pre">list_display</span></code> to control which fields are displayed in the <code class="docutils literal notranslate"><span class="pre">IndexView</span></code>
for your model.</p>
<p>You have three possible values that can be used in <code class="docutils literal notranslate"><span class="pre">list_display</span></code>:</p>
<ul>
<li><p class="first">A field of the model. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Person</span>

<span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Person</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">The name of a custom method on your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class, that accepts a
single parameter for the model instance. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Person</span>


<span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Person</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;upper_case_name&#39;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">upper_case_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">last_name</span><span class="p">))</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">upper_case_name</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">&#39;Name&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first">The name of a method on your <code class="docutils literal notranslate"><span class="pre">Model</span></code> class that accepts only <code class="docutils literal notranslate"><span class="pre">self</span></code> as
an argument. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">birthday</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">decade_born_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">birthday</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;0&#39;s&quot;</span>
    <span class="n">decade_born_in</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">&#39;Birth decade&#39;</span>


<span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Person</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;decade_born_in&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>A few special cases to note about <code class="docutils literal notranslate"><span class="pre">list_display</span></code>:</p>
<ul>
<li><p class="first">If the field is a <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code>, Django will display the output of
<code class="docutils literal notranslate"><span class="pre">__str__()</span></code> of the related object.</p>
</li>
<li><p class="first">If the string provided is a method of the model or <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class,
Django will HTML-escape the output by default. To escape user input and
allow your own unescaped tags, use <code class="docutils literal notranslate"><span class="pre">format_html()</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">color_code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">colored_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span>
            <span class="s1">&#39;&lt;span style=&quot;color: #</span><span class="si">{}</span><span class="s1">;&quot;&gt;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&lt;/span&gt;&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color_code</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Person</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="s1">&#39;colored_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">If the value of a field is <code class="docutils literal notranslate"><span class="pre">None</span></code>, an empty string, or an iterable
without elements, Wagtail will display a dash (-) for that column. You can
override this by setting <code class="docutils literal notranslate"><span class="pre">empty_value_display</span></code> on your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code>
class. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>

<span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">empty_value_display</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Or, if you’d like to change the value used depending on the field, you can
override <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code>’s <code class="docutils literal notranslate"><span class="pre">get_empty_value_display()</span></code> method, like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>


<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">nickname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">likes_cat_gifs</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">NullBooleanField</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Person</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;nickname&#39;</span><span class="p">,</span> <span class="s1">&#39;likes_cat_gifs&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_empty_value_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;nickname&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;None given&#39;</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;likes_cat_gifs&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;Unanswered&#39;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_empty_value_display</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">__str__()</span></code> method is just as valid
in <code class="docutils literal notranslate"><span class="pre">list_display</span></code> as any other model method, so it’s perfectly OK to do
this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;__str__&#39;</span><span class="p">,</span> <span class="s1">&#39;some_other_field&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, the ability to sort results by an item in <code class="docutils literal notranslate"><span class="pre">list_display</span></code> is
only offered when it’s a field that has an actual database value (because
sorting is done at the database level). However, if the output of the
method is representative of a database field, you can indicate this fact by
setting the <code class="docutils literal notranslate"><span class="pre">admin_order_field</span></code> attribute on that method, like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">color_code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">colored_first_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span>
            <span class="s1">&#39;&lt;span style=&quot;color: #</span><span class="si">{}</span><span class="s1">;&quot;&gt;</span><span class="si">{}</span><span class="s1">&lt;/span&gt;&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color_code</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">colored_first_name</span><span class="o">.</span><span class="n">admin_order_field</span> <span class="o">=</span> <span class="s1">&#39;first_name&#39;</span>


<span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Person</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;colored_first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The above will tell Wagtail to order by the <code class="docutils literal notranslate"><span class="pre">first_name</span></code> field when
trying to sort by <code class="docutils literal notranslate"><span class="pre">colored_first_name</span></code> in the index view.</p>
<p>To indicate descending order with <code class="docutils literal notranslate"><span class="pre">admin_order_field</span></code> you can use a
hyphen prefix on the field name. Using the above example, this would look
like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">colored_first_name</span><span class="o">.</span><span class="n">admin_order_field</span> <span class="o">=</span> <span class="s1">&#39;-first_name&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">admin_order_field</span></code> supports query lookups to sort by values on related
models, too. This example includes an “author first name” column in the
list display and allows sorting it by first name:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">author_first_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">first_name</span>

    <span class="n">author_first_name</span><span class="o">.</span><span class="n">admin_order_field</span> <span class="o">=</span> <span class="s1">&#39;author__first_name&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first">Elements of <code class="docutils literal notranslate"><span class="pre">list_display</span></code> can also be properties. Please note however,
that due to the way properties work in Python, setting
<code class="docutils literal notranslate"><span class="pre">short_description</span></code> on a property is only possible when using the
<code class="docutils literal notranslate"><span class="pre">property()</span></code> function and <strong>not</strong> with the <code class="docutils literal notranslate"><span class="pre">&#64;property</span></code> decorator.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">full_name_property</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span>
    <span class="n">full_name_property</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s2">&quot;Full name of the person&quot;</span>

    <span class="n">full_name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">full_name_property</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;full_name&#39;</span><span class="p">,)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="modeladmin-list-export">
<span id="id2"></span><h8><a class="toc-backref" href="#id20"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.list_export</span></code></a><a class="headerlink" href="#modeladmin-list-export" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A list or tuple, where each item is the name of a field or
single-argument callable on your model, or a similarly simple method defined
on the <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class itself.</p>
<p>Set <code class="docutils literal notranslate"><span class="pre">list_export</span></code> to set the fields you wish to be exported as columns when
downloading a spreadsheet version of your index_view</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_export</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;is_staff&#39;</span><span class="p">,</span> <span class="s1">&#39;company&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="modeladmin-list-filter">
<span id="id3"></span><h8><a class="toc-backref" href="#id21"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.list_filter</span></code></a><a class="headerlink" href="#modeladmin-list-filter" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A list or tuple, where each item is the name of model field
of type <code class="docutils literal notranslate"><span class="pre">BooleanField</span></code>, <code class="docutils literal notranslate"><span class="pre">CharField</span></code>, <code class="docutils literal notranslate"><span class="pre">DateField</span></code>, <code class="docutils literal notranslate"><span class="pre">DateTimeField</span></code>,
<code class="docutils literal notranslate"><span class="pre">IntegerField</span></code> or <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code>.</p>
<p>Set <code class="docutils literal notranslate"><span class="pre">list_filter</span></code> to activate filters in the right sidebar of the list page
for your model. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;is_staff&#39;</span><span class="p">,</span> <span class="s1">&#39;company&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="modeladmin-export-filename">
<span id="id4"></span><h8><a class="toc-backref" href="#id22"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.export_filename</span></code></a><a class="headerlink" href="#modeladmin-export-filename" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A string specifying the filename of an exported spreadsheet,
without file extensions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">export_filename</span> <span class="o">=</span> <span class="s1">&#39;people_spreadsheet&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="modeladmin-search-fields">
<span id="id5"></span><h8><a class="toc-backref" href="#id23"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.search_fields</span></code></a><a class="headerlink" href="#modeladmin-search-fields" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A list or tuple, where each item is the name of a model
field of type <code class="docutils literal notranslate"><span class="pre">CharField</span></code>, <code class="docutils literal notranslate"><span class="pre">TextField</span></code>, <code class="docutils literal notranslate"><span class="pre">RichTextField</span></code> or
<code class="docutils literal notranslate"><span class="pre">StreamField</span></code>.</p>
<p>Set <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> to enable a search box at the top of the index page
for your model. You should add names of any fields on the model that should
be searched whenever somebody submits a search query using the search box.</p>
<p>Searching is handled via Django’s QuerySet API by default,
see <a class="reference internal" href="#id6">ModelAdmin.search_handler_class</a> about changing this behaviour.
This means by default it will work for all models, whatever search backend
your project is using, and without any additional setup or configuration.</p>
</div>
<div class="section" id="modeladmin-search-handler-class">
<span id="id6"></span><h8><a class="toc-backref" href="#id24"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.search_handler_class</span></code></a><a class="headerlink" href="#modeladmin-search-handler-class" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A subclass of
<code class="docutils literal notranslate"><span class="pre">wagtail.contrib.modeladmin.helpers.search.BaseSearchHandler</span></code></p>
<p>The default value is <code class="docutils literal notranslate"><span class="pre">DjangoORMSearchHandler</span></code>, which uses the Django ORM to
perform lookups on the fields specified by <code class="docutils literal notranslate"><span class="pre">search_fields</span></code>.</p>
<p>If you would prefer to use the built-in Wagtail search backend to search your
models, you can use the <code class="docutils literal notranslate"><span class="pre">WagtailBackendSearchHandler</span></code> class instead. For
example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.helpers</span> <span class="kn">import</span> <span class="n">WagtailBackendSearchHandler</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Person</span>

<span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Person</span>
    <span class="n">search_handler_class</span> <span class="o">=</span> <span class="n">WagtailBackendSearchHandler</span>
</pre></div>
</div>
<div class="section" id="extra-considerations-when-using-wagtailbackendsearchhandler">
<h9>Extra considerations when using <code class="docutils literal notranslate"><span class="pre">WagtailBackendSearchHandler</span></code><a class="headerlink" href="#extra-considerations-when-using-wagtailbackendsearchhandler" title="Permalink to this headline">¶</a></h9>
<div class="section" id="modeladmin-search-fields-is-used-differently">
<h10><code class="docutils literal notranslate"><span class="pre">ModelAdmin.search_fields</span></code> is used differently<a class="headerlink" href="#modeladmin-search-fields-is-used-differently" title="Permalink to this headline">¶</a></h10>
<p>The value of <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> is passed to the underlying search backend to
limit the fields used when matching. Each item in the list must be indexed
on your model using <a class="reference internal" href="index.html#wagtailsearch-index-searchfield"><span class="std std-ref">index.SearchField</span></a>.</p>
<p>To allow matching on <strong>any</strong> indexed field, set the <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> attribute
on your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class to <code class="docutils literal notranslate"><span class="pre">None</span></code>, or remove it completely.</p>
</div>
<div class="section" id="indexing-extra-fields-using-index-filterfield">
<h10>Indexing extra fields using <code class="docutils literal notranslate"><span class="pre">index.FilterField</span></code><a class="headerlink" href="#indexing-extra-fields-using-index-filterfield" title="Permalink to this headline">¶</a></h10>
<p>The underlying search backend must be able to interpret all of the fields and
relationships used in the queryset created by <code class="docutils literal notranslate"><span class="pre">IndexView</span></code>, including those
used in <code class="docutils literal notranslate"><span class="pre">prefetch()</span></code> or <code class="docutils literal notranslate"><span class="pre">select_related()</span></code> queryset methods, or used in
<code class="docutils literal notranslate"><span class="pre">list_display</span></code>, <code class="docutils literal notranslate"><span class="pre">list_filter</span></code> or <code class="docutils literal notranslate"><span class="pre">ordering</span></code>.</p>
<p>Be sure to test things thoroughly in a development environment (ideally
using the same search backend as you use in production). Wagtail will raise
an <code class="docutils literal notranslate"><span class="pre">IndexError</span></code> if the backend encounters something it does not understand,
and will tell you what you need to change.</p>
</div>
</div>
</div>
<div class="section" id="modeladmin-extra-search-kwargs">
<span id="id7"></span><h8><a class="toc-backref" href="#id25"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.extra_search_kwargs</span></code></a><a class="headerlink" href="#modeladmin-extra-search-kwargs" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A dictionary of keyword arguments that will be passed on to the <code class="docutils literal notranslate"><span class="pre">search()</span></code> method of
<code class="docutils literal notranslate"><span class="pre">search_handler_class</span></code>.</p>
<p>For example, to override the <code class="docutils literal notranslate"><span class="pre">WagtailBackendSearchHandler</span></code> default operator you could do the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.helpers</span> <span class="kn">import</span> <span class="n">WagtailBackendSearchHandler</span>
<span class="kn">from</span> <span class="nn">wagtail.search.utils</span> <span class="kn">import</span> <span class="n">OR</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">IndexedModel</span>

<span class="k">class</span> <span class="nc">DemoAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">IndexedModel</span>
    <span class="n">search_handler_class</span> <span class="o">=</span> <span class="n">WagtailBackendSearchHandler</span>
    <span class="n">extra_search_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="n">OR</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="modeladmin-ordering">
<span id="id8"></span><h8><a class="toc-backref" href="#id26"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.ordering</span></code></a><a class="headerlink" href="#modeladmin-ordering" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A list or tuple in the same format as a model’s
<a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/models/options/#django.db.models.Options.ordering" title="(in Django v3.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ordering</span></code></a> parameter.</p>
<p>Set <code class="docutils literal notranslate"><span class="pre">ordering</span></code> to specify the default ordering of objects when listed by
IndexView.  If not provided, the model’s default ordering will be respected.</p>
<p>If you need to specify a dynamic order (for example, depending on user or
language) you can override the <code class="docutils literal notranslate"><span class="pre">get_ordering()</span></code> method instead.</p>
</div>
<div class="section" id="modeladmin-list-per-page">
<span id="id9"></span><h8><a class="toc-backref" href="#id27"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.list_per_page</span></code></a><a class="headerlink" href="#modeladmin-list-per-page" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A positive integer</p>
<p>Set <code class="docutils literal notranslate"><span class="pre">list_per_page</span></code> to control how many items appear on each paginated page
of the index view. By default, this is set to <code class="docutils literal notranslate"><span class="pre">100</span></code>.</p>
</div>
<div class="section" id="modeladmin-get-queryset">
<span id="id10"></span><h8><a class="toc-backref" href="#id28"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.get_queryset()</span></code></a><a class="headerlink" href="#modeladmin-get-queryset" title="Permalink to this headline">¶</a></h8>
<p><strong>Must return</strong>: A QuerySet</p>
<p>The <code class="docutils literal notranslate"><span class="pre">get_queryset</span></code> method returns the ‘base’ QuerySet for your model, to
which any filters and search queries are applied. By default, the <code class="docutils literal notranslate"><span class="pre">all()</span></code>
method of your model’s default manager is used. But, if for any reason you
only want a certain sub-set of objects to appear in the IndexView listing,
overriding the <code class="docutils literal notranslate"><span class="pre">get_queryset</span></code> method on your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class can help
you with that. The method takes an <code class="docutils literal notranslate"><span class="pre">HttpRequest</span></code> object as a parameter, so
limiting objects by the current logged-in user is possible.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">managed_by</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;auth.User&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Person</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="c1"># Only show people managed by the current user</span>
        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">managed_by</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="modeladmin-get-extra-attrs-for-row">
<span id="id11"></span><h8><a class="toc-backref" href="#id29"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.get_extra_attrs_for_row()</span></code></a><a class="headerlink" href="#modeladmin-get-extra-attrs-for-row" title="Permalink to this headline">¶</a></h8>
<p><strong>Must return</strong>: A dictionary</p>
<p>The <code class="docutils literal notranslate"><span class="pre">get_extra_attrs_for_row</span></code> method allows you to add html attributes to
the opening <code class="docutils literal notranslate"><span class="pre">&lt;tr&gt;</span></code> tag for each result, in addition to the <code class="docutils literal notranslate"><span class="pre">data-object_pk</span></code> and
<code class="docutils literal notranslate"><span class="pre">class</span></code> attributes already added by the <code class="docutils literal notranslate"><span class="pre">result_row_display</span></code> template tag.</p>
<p>If you want to add additional CSS classes, simply provide those class names
as a string value using the <code class="docutils literal notranslate"><span class="pre">'class'</span></code> key, and the <code class="docutils literal notranslate"><span class="pre">odd</span></code>/<code class="docutils literal notranslate"><span class="pre">even</span></code> will be appended
to your custom class names when rendering.</p>
<p>For example, if you wanted to add some additional class names based on field
values, you could do something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>

<span class="k">class</span> <span class="nc">BankAccount</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">account_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">balance</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_places</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BankAccountAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;account_number&#39;</span><span class="p">,</span> <span class="s1">&#39;balance&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_extra_attrs_for_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">balance</span> <span class="o">&lt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.00&#39;</span><span class="p">):</span>
            <span class="n">classname</span> <span class="o">=</span> <span class="s1">&#39;balance-negative&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">classname</span> <span class="o">=</span> <span class="s1">&#39;balance-positive&#39;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="n">classname</span><span class="p">,</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="modeladmin-get-extra-class-names-for-field-col">
<span id="id12"></span><h8><a class="toc-backref" href="#id30"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.get_extra_class_names_for_field_col()</span></code></a><a class="headerlink" href="#modeladmin-get-extra-class-names-for-field-col" title="Permalink to this headline">¶</a></h8>
<p><strong>Must return</strong>: A list</p>
<p>The <code class="docutils literal notranslate"><span class="pre">get_extra_class_names_for_field_col</span></code> method allows you to add additional
CSS class names to any of the columns defined by <code class="docutils literal notranslate"><span class="pre">list_display</span></code> for your
model. The method takes two parameters:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">obj</span></code>: the object being represented by the current row</li>
<li><code class="docutils literal notranslate"><span class="pre">field_name</span></code>: the item from <code class="docutils literal notranslate"><span class="pre">list_display</span></code> being represented by the
current column</li>
</ul>
<p>For example, if you’d like to apply some conditional formatting to a cell
depending on the row’s value, you could do something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>

<span class="k">class</span> <span class="nc">BankAccount</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">account_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">balance</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_places</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BankAccountAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;account_number&#39;</span><span class="p">,</span> <span class="s1">&#39;balance&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_extra_class_names_for_field_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;balance&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">balance</span> <span class="o">&lt;=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;-100.00&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;brand-danger&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">balance</span> <span class="o">&lt;=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;-0.00&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;brand-warning&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">balance</span> <span class="o">&lt;=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;50.00&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;brand-info&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;brand-success&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
<div class="section" id="modeladmin-get-extra-attrs-for-field-col">
<span id="id13"></span><h8><a class="toc-backref" href="#id31"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.get_extra_attrs_for_field_col()</span></code></a><a class="headerlink" href="#modeladmin-get-extra-attrs-for-field-col" title="Permalink to this headline">¶</a></h8>
<p><strong>Must return</strong>: A dictionary</p>
<p>The <code class="docutils literal notranslate"><span class="pre">get_extra_attrs_for_field_col</span></code> method allows you to add additional HTML
attributes to any of the columns defined in <code class="docutils literal notranslate"><span class="pre">list_display</span></code>. Like the
<code class="docutils literal notranslate"><span class="pre">get_extra_class_names_for_field_col</span></code> method above, this method takes two
parameters:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">obj</span></code>: the object being represented by the current row</li>
<li><code class="docutils literal notranslate"><span class="pre">field_name</span></code>: the item from <code class="docutils literal notranslate"><span class="pre">list_display</span></code> being represented by the
current column</li>
</ul>
<p>For example, you might like to add some tooltip text to a certain column, to
help give the value more context:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>


<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">likes_cat_gifs</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">NullBooleanField</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Person</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;likes_cat_gifs&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_extra_attrs_for_field_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_extra_attrs_for_field_col</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;likes_cat_gifs&#39;</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">likes_cat_gifs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="s1">&#39;The person was shown several cat gifs, but failed to &#39;</span>
                    <span class="s1">&#39;indicate a preference.&#39;</span>
                <span class="p">),</span>
            <span class="p">})</span>
        <span class="k">return</span> <span class="n">attrs</span>
</pre></div>
</div>
<p>Or you might like to add one or more data attributes to help implement some
kind of interactivity using JavaScript:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>


<span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TimeField</span><span class="p">()</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TimeField</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">EventAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Event</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;start_date&#39;</span><span class="p">,</span> <span class="s1">&#39;end_date&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_extra_attrs_for_field_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_extra_attrs_for_field_col</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;start_date&#39;</span><span class="p">:</span>
            <span class="c1"># Add the start time as data to the &#39;start_date&#39; cell</span>
            <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span> <span class="s1">&#39;data-time&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">)</span> <span class="p">})</span>
        <span class="k">elif</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;end_date&#39;</span><span class="p">:</span>
            <span class="c1"># Add the end time as data to the &#39;end_date&#39; cell</span>
            <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span> <span class="s1">&#39;data-time&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">)</span> <span class="p">})</span>
        <span class="k">return</span> <span class="n">attrs</span>
</pre></div>
</div>
</div>
<div class="section" id="wagtail-contrib-modeladmin-mixins-thumbnailmixin">
<span id="modeladmin-thumbnailmixin"></span><h8><a class="toc-backref" href="#id32"><code class="docutils literal notranslate"><span class="pre">wagtail.contrib.modeladmin.mixins.ThumbnailMixin</span></code></a><a class="headerlink" href="#wagtail-contrib-modeladmin-mixins-thumbnailmixin" title="Permalink to this headline">¶</a></h8>
<p>If you’re using <code class="docutils literal notranslate"><span class="pre">wagtailimages.Image</span></code> to define an image for each item in
your model, <code class="docutils literal notranslate"><span class="pre">ThumbnailMixin</span></code> can help you add thumbnail versions of that
image to each row in <code class="docutils literal notranslate"><span class="pre">IndexView</span></code>. To use it, simply extend <code class="docutils literal notranslate"><span class="pre">ThumbnailMixin</span></code>
as well as <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> when defining your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class, and
change a few attributes to change the thumbnail to your liking, like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.mixins</span> <span class="kn">import</span> <span class="n">ThumbnailMixin</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">avatar</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;wagtailimages.Image&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">likes_cat_gifs</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">NullBooleanField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">PersonAdmin</span><span class="p">(</span><span class="n">ThumbnailMixin</span><span class="p">,</span> <span class="n">ModelAdmin</span><span class="p">):</span>

    <span class="c1"># Add &#39;admin_thumb&#39; to list_display, where you want the thumbnail to appear</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;admin_thumb&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;likes_cat_gifs&#39;</span><span class="p">)</span>

    <span class="c1"># Optionally tell IndexView to add buttons to a different column (if the</span>
    <span class="c1"># first column contains the thumbnail, the buttons are likely better off</span>
    <span class="c1"># displayed elsewhere)</span>
    <span class="n">list_display_add_buttons</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set &#39;thumb_image_field_name&#39; to the name of the ForeignKey field that</span>
<span class="sd">    links to &#39;wagtailimages.Image&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">thumb_image_field_name</span> <span class="o">=</span> <span class="s1">&#39;avatar&#39;</span>

    <span class="c1"># Optionally override the filter spec used to create each thumb</span>
    <span class="n">thumb_image_filter_spec</span> <span class="o">=</span> <span class="s1">&#39;fill-100x100&#39;</span> <span class="c1"># this is the default</span>

    <span class="c1"># Optionally override the &#39;width&#39; attribute value added to each `&lt;img&gt;` tag</span>
    <span class="n">thumb_image_width</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># this is the default</span>

    <span class="c1"># Optionally override the class name added to each `&lt;img&gt;` tag</span>
    <span class="n">thumb_classname</span> <span class="o">=</span> <span class="s1">&#39;admin-thumb&#39;</span> <span class="c1"># this is the default</span>

    <span class="c1"># Optionally override the text that appears in the column header</span>
    <span class="n">thumb_col_header_text</span> <span class="o">=</span> <span class="s1">&#39;image&#39;</span> <span class="c1"># this is the default</span>

    <span class="c1"># Optionally specify a fallback image to be used when the object doesn&#39;t</span>
    <span class="c1"># have an image set, or the image has been deleted. It can an image from</span>
    <span class="c1"># your static files folder, or an external URL.</span>
    <span class="n">thumb_default</span> <span class="o">=</span> <span class="s1">&#39;https://lorempixel.com/100/100&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="modeladmin-list-display-add-buttons">
<span id="id14"></span><h8><a class="toc-backref" href="#id33"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.list_display_add_buttons</span></code></a><a class="headerlink" href="#modeladmin-list-display-add-buttons" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A string matching one of the items in <code class="docutils literal notranslate"><span class="pre">list_display</span></code>.</p>
<p>If for any reason you’d like to change which column the action buttons appear
in for each row, you can specify a different column using
<code class="docutils literal notranslate"><span class="pre">list_display_add_buttons</span></code> on your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class. The value must
match one of the items your class’s <code class="docutils literal notranslate"><span class="pre">list_display</span></code> attribute. By default,
buttons are added to the first column of each row.</p>
<p>See the <code class="docutils literal notranslate"><span class="pre">ThumbnailMixin</span></code> example above to see how
<code class="docutils literal notranslate"><span class="pre">list_display_add_buttons</span></code> can be used.</p>
</div>
<div class="section" id="modeladmin-index-view-extra-css">
<span id="id15"></span><h8><a class="toc-backref" href="#id34"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.index_view_extra_css</span></code></a><a class="headerlink" href="#modeladmin-index-view-extra-css" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A list of path names of additional stylesheets to be added
to the <code class="docutils literal notranslate"><span class="pre">IndexView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-adding-css-and-js"><span class="std std-ref">Adding additional stylesheets and/or JavaScript</span></a></p>
</div>
<div class="section" id="modeladmin-index-view-extra-js">
<span id="id16"></span><h8><a class="toc-backref" href="#id35"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.index_view_extra_js</span></code></a><a class="headerlink" href="#modeladmin-index-view-extra-js" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A list of path names of additional js files to be added
to the <code class="docutils literal notranslate"><span class="pre">IndexView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-adding-css-and-js"><span class="std std-ref">Adding additional stylesheets and/or JavaScript</span></a></p>
</div>
<div class="section" id="modeladmin-index-template-name">
<span id="id17"></span><h8><a class="toc-backref" href="#id36"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.index_template_name</span></code></a><a class="headerlink" href="#modeladmin-index-template-name" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: The path to a custom template to use for <code class="docutils literal notranslate"><span class="pre">IndexView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-overriding-templates"><span class="std std-ref">Overriding templates</span></a></p>
</div>
<div class="section" id="modeladmin-index-view-class">
<span id="id18"></span><h8><a class="toc-backref" href="#id37"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.index_view_class</span></code></a><a class="headerlink" href="#modeladmin-index-view-class" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A custom <code class="docutils literal notranslate"><span class="pre">view</span></code> class to replace
<code class="docutils literal notranslate"><span class="pre">modeladmin.views.IndexView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-overriding-views"><span class="std std-ref">Overriding views</span></a></p>
</div>
</div>
<span id="document-reference/contrib/modeladmin/create_edit_delete_views"></span><div class="section" id="customising-createview-editview-and-deleteview">
<h7>Customising <code class="docutils literal notranslate"><span class="pre">CreateView</span></code>, <code class="docutils literal notranslate"><span class="pre">EditView</span></code> and <code class="docutils literal notranslate"><span class="pre">DeleteView</span></code><a class="headerlink" href="#customising-createview-editview-and-deleteview" title="Permalink to this headline">¶</a></h7>
<p><strong>NOTE:</strong> <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code> only provides ‘create’, ‘edit’ and ‘delete’
functionality for non page type models (i.e. models that do not extend
<code class="docutils literal notranslate"><span class="pre">wagtailcore.models.Page</span></code>). If your model is a ‘page type’ model, customising
any of the following will not have any effect:</p>
<div class="section" id="changing-which-fields-appear-in-createview-editview">
<span id="modeladmin-edit-handler-customisation"></span><h8>Changing which fields appear in <code class="docutils literal notranslate"><span class="pre">CreateView</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">EditView</span></code><a class="headerlink" href="#changing-which-fields-appear-in-createview-editview" title="Permalink to this headline">¶</a></h8>
<p><code class="docutils literal notranslate"><span class="pre">edit_handler</span></code> can be used on any Django models.Model class, just like it
can be used for <code class="docutils literal notranslate"><span class="pre">Page</span></code> models or other models registered as <code class="docutils literal notranslate"><span class="pre">Snippets</span></code> in
Wagtail.</p>
<p>To change the way your <code class="docutils literal notranslate"><span class="pre">MyPageModel</span></code> is displayed in the CreateView and the
EditView, simply define an <code class="docutils literal notranslate"><span class="pre">edit_handler</span></code> or <code class="docutils literal notranslate"><span class="pre">panels</span></code> attribute on your
model class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyPageModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">MultiFieldPanel</span><span class="p">([</span>
            <span class="n">FieldRowPanel</span><span class="p">([</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s1">&#39;fn&#39;</span><span class="p">),</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s1">&#39;ln&#39;</span><span class="p">),</span>
            <span class="p">]),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s1">&#39;custom1&#39;</span><span class="p">,)</span>
        <span class="p">])</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Or alternatively:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyPageModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="n">custom_panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">MultiFieldPanel</span><span class="p">([</span>
            <span class="n">FieldRowPanel</span><span class="p">([</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s1">&#39;fn&#39;</span><span class="p">),</span>
                <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s1">&#39;ln&#39;</span><span class="p">),</span>
            <span class="p">]),</span>
            <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s1">&#39;custom1&#39;</span><span class="p">,)</span>
        <span class="p">])</span>
    <span class="p">]</span>
    <span class="n">edit_handler</span> <span class="o">=</span> <span class="n">ObjectList</span><span class="p">(</span><span class="n">custom_panels</span><span class="p">)</span>
    <span class="c1"># or</span>
    <span class="n">edit_handler</span> <span class="o">=</span> <span class="n">TabbedInterface</span><span class="p">([</span>
        <span class="n">ObjectList</span><span class="p">(</span><span class="n">custom_panels</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s1">&#39;First Tab&#39;</span><span class="p">),</span>
        <span class="n">ObjectList</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="p">])</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">edit_handler</span></code> and <code class="docutils literal notranslate"><span class="pre">panels</span></code> can alternatively be
defined on a <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> definition. This feature is especially useful
for use cases where you have to work with models that are
‘out of reach’ (due to being part of a third-party package, for example).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Or alternatively:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>

    <span class="n">custom_panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">edit_handler</span> <span class="o">=</span> <span class="n">ObjectList</span><span class="p">(</span><span class="n">custom_panels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="modeladmin-form-view-extra-css">
<span id="id1"></span><h8><code class="docutils literal notranslate"><span class="pre">ModelAdmin.form_view_extra_css</span></code><a class="headerlink" href="#modeladmin-form-view-extra-css" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A list of path names of additional stylesheets to be added
to <code class="docutils literal notranslate"><span class="pre">CreateView</span></code> and <code class="docutils literal notranslate"><span class="pre">EditView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-adding-css-and-js"><span class="std std-ref">Adding additional stylesheets and/or JavaScript</span></a></p>
</div>
<div class="section" id="modeladmin-form-view-extra-js">
<span id="id2"></span><h8><code class="docutils literal notranslate"><span class="pre">ModelAdmin.form_view_extra_js</span></code><a class="headerlink" href="#modeladmin-form-view-extra-js" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A list of path names of additional js files to be added
to <code class="docutils literal notranslate"><span class="pre">CreateView</span></code> and <code class="docutils literal notranslate"><span class="pre">EditView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-adding-css-and-js"><span class="std std-ref">Adding additional stylesheets and/or JavaScript</span></a></p>
</div>
<div class="section" id="modeladmin-create-template-name">
<span id="id3"></span><h8><code class="docutils literal notranslate"><span class="pre">ModelAdmin.create_template_name</span></code><a class="headerlink" href="#modeladmin-create-template-name" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: The path to a custom template to use for <code class="docutils literal notranslate"><span class="pre">CreateView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-overriding-templates"><span class="std std-ref">Overriding templates</span></a></p>
</div>
<div class="section" id="modeladmin-create-view-class">
<span id="id4"></span><h8><code class="docutils literal notranslate"><span class="pre">ModelAdmin.create_view_class</span></code><a class="headerlink" href="#modeladmin-create-view-class" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A custom <code class="docutils literal notranslate"><span class="pre">view</span></code> class to replace
<code class="docutils literal notranslate"><span class="pre">modeladmin.views.CreateView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-overriding-views"><span class="std std-ref">Overriding views</span></a></p>
</div>
<div class="section" id="modeladmin-edit-template-name">
<span id="id5"></span><h8><code class="docutils literal notranslate"><span class="pre">ModelAdmin.edit_template_name</span></code><a class="headerlink" href="#modeladmin-edit-template-name" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: The path to a custom template to use for <code class="docutils literal notranslate"><span class="pre">EditView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-overriding-templates"><span class="std std-ref">Overriding templates</span></a></p>
</div>
<div class="section" id="modeladmin-edit-view-class">
<span id="id6"></span><h8><code class="docutils literal notranslate"><span class="pre">ModelAdmin.edit_view_class</span></code><a class="headerlink" href="#modeladmin-edit-view-class" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A custom <code class="docutils literal notranslate"><span class="pre">view</span></code> class to replace
<code class="docutils literal notranslate"><span class="pre">modeladmin.views.EditView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-overriding-views"><span class="std std-ref">Overriding views</span></a></p>
</div>
<div class="section" id="modeladmin-delete-template-name">
<span id="id7"></span><h8><code class="docutils literal notranslate"><span class="pre">ModelAdmin.delete_template_name</span></code><a class="headerlink" href="#modeladmin-delete-template-name" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: The path to a custom template to use for <code class="docutils literal notranslate"><span class="pre">DeleteView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-overriding-templates"><span class="std std-ref">Overriding templates</span></a></p>
</div>
<div class="section" id="modeladmin-delete-view-class">
<span id="id8"></span><h8><code class="docutils literal notranslate"><span class="pre">ModelAdmin.delete_view_class</span></code><a class="headerlink" href="#modeladmin-delete-view-class" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A custom <code class="docutils literal notranslate"><span class="pre">view</span></code> class to replace
<code class="docutils literal notranslate"><span class="pre">modeladmin.views.DeleteView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-overriding-views"><span class="std std-ref">Overriding views</span></a></p>
</div>
<div class="section" id="modeladmin-form-fields-exclude">
<span id="id9"></span><h8><code class="docutils literal notranslate"><span class="pre">ModelAdmin.form_fields_exclude</span></code><a class="headerlink" href="#modeladmin-form-fields-exclude" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A list or tuple of fields names</p>
<p>When using CreateView or EditView to create or update model instances, this
value will be passed to the edit form, so that any named fields will be
excluded from the form. This is particularly useful when registering ModelAdmin
classes for models from third-party apps, where defining panel configurations
on the Model itself is more complicated.</p>
</div>
<div class="section" id="modeladmin-prepopulated-fields">
<span id="id10"></span><h8><code class="docutils literal notranslate"><span class="pre">ModelAdmin.prepopulated_fields</span></code><a class="headerlink" href="#modeladmin-prepopulated-fields" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A dict mapping prepopulated fields to a tuple of fields to
prepopulate from</p>
<p>When using CreateView or EditView to create or update model instances, the
fields corresponding to the keys in the dict are prepopulated using the fields
in the corresponding tuple. The main use for this functionality is to
automatically generate the value for SlugField fields from one or more other
fields. The generated value is produced by concatenating the values of the
source fields, and then by transforming that result into a valid slug (e.g.
substituting dashes for spaces; lowercasing ASCII letters; and removing various
English stop words such as ‘a’, ‘an’, ‘as’, and similar).</p>
<p>Prepopulated fields aren’t modified by JavaScript after a value has been saved.
It’s usually undesired that slugs change (which would cause an object’s URL to
change if the slug is used in it).</p>
<p>prepopulated_fields doesn’t accept DateTimeField, ForeignKey, OneToOneField,
and ManyToManyField fields.</p>
</div>
<div class="section" id="modeladmin-get-edit-handler">
<h8><code class="docutils literal notranslate"><span class="pre">ModelAdmin.get_edit_handler()</span></code><a class="headerlink" href="#modeladmin-get-edit-handler" title="Permalink to this headline">¶</a></h8>
<p><strong>Must return</strong>: An instance of <code class="docutils literal notranslate"><span class="pre">wagtail.admin.edit_handlers.ObjectList</span></code></p>
<p>Returns the appropriate <code class="docutils literal notranslate"><span class="pre">edit_handler</span></code> for the modeladmin class.
<code class="docutils literal notranslate"><span class="pre">edit_handlers</span></code> can be defined either on the model itself or on the
modeladmin (as property <code class="docutils literal notranslate"><span class="pre">edit_handler</span></code> or <code class="docutils literal notranslate"><span class="pre">panels</span></code>). Falls back to
extracting panel / edit handler definitions from the model class.</p>
</div>
</div>
<span id="document-reference/contrib/modeladmin/inspectview"></span><div class="section" id="enabling-customising-inspectview">
<h7>Enabling &amp; customising <code class="docutils literal notranslate"><span class="pre">InspectView</span></code><a class="headerlink" href="#enabling-customising-inspectview" title="Permalink to this headline">¶</a></h7>
<p>The <code class="docutils literal notranslate"><span class="pre">InspectView</span></code> is disabled by default, as it’s not often useful for most
models. However, if you need a view that enables users to view more detailed
information about an instance without the option to edit it, you can easily
enable the inspect view by setting <code class="docutils literal notranslate"><span class="pre">inspect_view_enabled=True</span></code> on your
<code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">InspectView</span></code> is enabled, an ‘Inspect’ button will automatically appear for each row in
your index / listing view, linking to a new page that shows a list of
field values for that particular object.</p>
<p>By default, all ‘concrete’ fields (where the field value is stored as a column
in the database table for your model) will be shown. You can customise what
values are displayed by adding the following attributes to your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code>
class:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#modeladmin-inspect-view-fields" id="id7"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.inspect_view_fields</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-inspect-view-fields-exclude" id="id8"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.inspect_view_fields_exclude</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-inspect-view-extra-css" id="id9"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.inspect_view_extra_css</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-inspect-view-extra-js" id="id10"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.inspect_view_extra_js</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-inspect-template-name" id="id11"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.inspect_template_name</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-inspect-view-class" id="id12"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.inspect_view_class</span></code></a></li>
</ul>
</div>
<div class="section" id="modeladmin-inspect-view-fields">
<span id="id1"></span><h8><a class="toc-backref" href="#id7"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.inspect_view_fields</span></code></a><a class="headerlink" href="#modeladmin-inspect-view-fields" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value:</strong> A list or tuple, where each item is the name of a field
or attribute on the instance that you’d like <code class="docutils literal notranslate"><span class="pre">InspectView</span></code> to render.</p>
<p>A sensible value will be rendered for most field types.</p>
<p>If you have <code class="docutils literal notranslate"><span class="pre">wagtail.images</span></code> installed, and the value happens to be an
instance of <code class="docutils literal notranslate"><span class="pre">wagtailimages.models.Image</span></code> (or a custom model that subclasses
<code class="docutils literal notranslate"><span class="pre">wagtailimages.models.AbstractImage</span></code>), a thumbnail of that image will be
rendered.</p>
<p>If you have <cite>wagtail.documents</cite> installed, and the value happens to be an
instance of <cite>wagtaildocs.models.Document</cite> (or a custom model that subclasses
<code class="docutils literal notranslate"><span class="pre">wagtaildocs.models.AbstractDocument</span></code>), a link to that document will be
rendered, along with the document title, file extension and size.</p>
</div>
<div class="section" id="modeladmin-inspect-view-fields-exclude">
<span id="id2"></span><h8><a class="toc-backref" href="#id8"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.inspect_view_fields_exclude</span></code></a><a class="headerlink" href="#modeladmin-inspect-view-fields-exclude" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value:</strong> A list or tuple, where each item is the name of a field
that you’d like to exclude from <code class="docutils literal notranslate"><span class="pre">InspectView</span></code></p>
<p><strong>Note:</strong> If both <code class="docutils literal notranslate"><span class="pre">inspect_view_fields</span></code> and <code class="docutils literal notranslate"><span class="pre">inspect_view_fields_exclude</span></code>
are set, <code class="docutils literal notranslate"><span class="pre">inspect_view_fields_exclude</span></code> will be ignored.</p>
</div>
<div class="section" id="modeladmin-inspect-view-extra-css">
<span id="id3"></span><h8><a class="toc-backref" href="#id9"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.inspect_view_extra_css</span></code></a><a class="headerlink" href="#modeladmin-inspect-view-extra-css" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A list of path names of additional stylesheets to be added
to the <code class="docutils literal notranslate"><span class="pre">InspectView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-adding-css-and-js"><span class="std std-ref">Adding additional stylesheets and/or JavaScript</span></a></p>
</div>
<div class="section" id="modeladmin-inspect-view-extra-js">
<span id="id4"></span><h8><a class="toc-backref" href="#id10"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.inspect_view_extra_js</span></code></a><a class="headerlink" href="#modeladmin-inspect-view-extra-js" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A list of path names of additional js files to be added
to the <code class="docutils literal notranslate"><span class="pre">InspectView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-adding-css-and-js"><span class="std std-ref">Adding additional stylesheets and/or JavaScript</span></a></p>
</div>
<div class="section" id="modeladmin-inspect-template-name">
<span id="id5"></span><h8><a class="toc-backref" href="#id11"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.inspect_template_name</span></code></a><a class="headerlink" href="#modeladmin-inspect-template-name" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: The path to a custom template to use for <code class="docutils literal notranslate"><span class="pre">InspectView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-overriding-templates"><span class="std std-ref">Overriding templates</span></a></p>
</div>
<div class="section" id="modeladmin-inspect-view-class">
<span id="id6"></span><h8><a class="toc-backref" href="#id12"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.inspect_view_class</span></code></a><a class="headerlink" href="#modeladmin-inspect-view-class" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A custom <code class="docutils literal notranslate"><span class="pre">view</span></code> class to replace
<code class="docutils literal notranslate"><span class="pre">modeladmin.views.InspectView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-overriding-views"><span class="std std-ref">Overriding views</span></a></p>
</div>
</div>
<span id="document-reference/contrib/modeladmin/chooseparentview"></span><div class="section" id="customising-chooseparentview">
<h7>Customising <code class="docutils literal notranslate"><span class="pre">ChooseParentView</span></code><a class="headerlink" href="#customising-chooseparentview" title="Permalink to this headline">¶</a></h7>
<p>When adding a new page via Wagtail’s explorer view, you essentially choose
where you want to add a new page by navigating the relevant part of the page
tree and choosing to ‘add a child page’ to your chosen parent page. Wagtail
then asks you to select what type of page you’d like to add.</p>
<p>When adding a page from a <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> list page, we know what type of page
needs to be added, but we might not automatically know where in the page tree
it should be added. If there’s only one possible choice of parent for a new page
(as defined by setting <code class="docutils literal notranslate"><span class="pre">parent_page_types</span></code> and <code class="docutils literal notranslate"><span class="pre">subpage_types</span></code> attributes
on your models), then we skip a step and use that as the parent. Otherwise, the
user must specify a parent page using modeladmin’s <code class="docutils literal notranslate"><span class="pre">ChooseParentView</span></code>.</p>
<p>It should be very rare that you need to customise this view, but in case you
do, modeladmin offers the following attributes that you can override:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#modeladmin-choose-parent-template-name" id="id3"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.choose_parent_template_name</span></code></a></li>
<li><a class="reference internal" href="#modeladmin-choose-parent-view-class" id="id4"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.choose_parent_view_class</span></code></a></li>
</ul>
</div>
<div class="section" id="modeladmin-choose-parent-template-name">
<span id="id1"></span><h8><a class="toc-backref" href="#id3"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.choose_parent_template_name</span></code></a><a class="headerlink" href="#modeladmin-choose-parent-template-name" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: The path to a custom template to use for
<code class="docutils literal notranslate"><span class="pre">ChooseParentView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-overriding-templates"><span class="std std-ref">Overriding templates</span></a></p>
</div>
<div class="section" id="modeladmin-choose-parent-view-class">
<span id="id2"></span><h8><a class="toc-backref" href="#id4"><code class="docutils literal notranslate"><span class="pre">ModelAdmin.choose_parent_view_class</span></code></a><a class="headerlink" href="#modeladmin-choose-parent-view-class" title="Permalink to this headline">¶</a></h8>
<p><strong>Expected value</strong>: A custom <code class="docutils literal notranslate"><span class="pre">view</span></code> class to replace
<code class="docutils literal notranslate"><span class="pre">modeladmin.views.ChooseParentView</span></code></p>
<p>See the following part of the docs to find out more:
<a class="reference internal" href="index.html#modeladmin-overriding-views"><span class="std std-ref">Overriding views</span></a></p>
</div>
</div>
<span id="document-reference/contrib/modeladmin/tips_and_tricks/index"></span><div class="section" id="additional-tips-and-tricks">
<h7>Additional tips and tricks<a class="headerlink" href="#additional-tips-and-tricks" title="Permalink to this headline">¶</a></h7>
<p>This section explores some of modeladmin’s lesser-known features, and provides examples to help with modeladmin customisation. More pages will be added in future.</p>
<div class="toctree-wrapper compound">
<span id="document-reference/contrib/modeladmin/tips_and_tricks/reversing_urls"></span><div class="section" id="reversing-modeladmin-urls">
<span id="modeladmin-reversing-urls"></span><h8>Reversing ModelAdmin URLs<a class="headerlink" href="#reversing-modeladmin-urls" title="Permalink to this headline">¶</a></h8>
<p>It’s sometimes useful to be able to derive the <code class="docutils literal notranslate"><span class="pre">index</span></code> (listing) or
<code class="docutils literal notranslate"><span class="pre">create</span></code> URLs for a model along with the <code class="docutils literal notranslate"><span class="pre">edit</span></code>, <code class="docutils literal notranslate"><span class="pre">delete</span></code> or
<code class="docutils literal notranslate"><span class="pre">inspect</span></code> URL for a specific object in a model you have registered via
the <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code> app.</p>
<p>Wagtail itself does this by instantiating each <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class you have
registered, and using the <code class="docutils literal notranslate"><span class="pre">url_helper</span></code> attribute of each instance to
determine what these URLs are.</p>
<p>You can take a similar approach in your own code too, by creating a
<code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> instance yourself, and using its <code class="docutils literal notranslate"><span class="pre">url_helper</span></code>
to determine URLs.</p>
<p>See below for some examples:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#getting-the-edit-or-delete-or-inspect-url-for-an-object" id="id1">Getting the <code class="docutils literal notranslate"><span class="pre">edit</span></code> or <code class="docutils literal notranslate"><span class="pre">delete</span></code> or <code class="docutils literal notranslate"><span class="pre">inspect</span></code> URL for an object</a></li>
<li><a class="reference internal" href="#getting-the-index-or-create-url-for-a-model" id="id2">Getting the <code class="docutils literal notranslate"><span class="pre">index</span></code> or <code class="docutils literal notranslate"><span class="pre">create</span></code> URL for a model</a></li>
</ul>
</div>
<div class="section" id="getting-the-edit-or-delete-or-inspect-url-for-an-object">
<h9><a class="toc-backref" href="#id1">Getting the <code class="docutils literal notranslate"><span class="pre">edit</span></code> or <code class="docutils literal notranslate"><span class="pre">delete</span></code> or <code class="docutils literal notranslate"><span class="pre">inspect</span></code> URL for an object</a><a class="headerlink" href="#getting-the-edit-or-delete-or-inspect-url-for-an-object" title="Permalink to this headline">¶</a></h9>
<p>In this example, we will provide a quick way to <code class="docutils literal notranslate"><span class="pre">edit</span></code> the Author that is
linked to a blog post from the admin page listing menu. We have defined
an <code class="docutils literal notranslate"><span class="pre">AuthorModelAdmin</span></code> class and registered it with Wagtail to allow
<code class="docutils literal notranslate"><span class="pre">Author</span></code> objects to be administered via the admin area. The <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code>
model has an <code class="docutils literal notranslate"><span class="pre">author</span></code> field (a <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> to the <code class="docutils literal notranslate"><span class="pre">Author</span></code> model)
to allow a single author to be specified for each post.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># file: wagtail_hooks.py</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.widgets</span> <span class="kn">import</span> <span class="n">PageListingButton</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="n">ModelAdmin</span><span class="p">,</span> <span class="n">modeladmin_register</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="c1"># Author &amp; BlogPage model not shown in this example</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Author</span>

<span class="c1"># ensure our modeladmin is created</span>
<span class="k">class</span> <span class="nc">AuthorModelAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Author</span>
    <span class="n">menu_order</span> <span class="o">=</span> <span class="mi">200</span>

<span class="c1"># Creating an instance of `AuthorModelAdmin`</span>
<span class="n">author_modeladmin</span> <span class="o">=</span> <span class="n">AuthorModelAdmin</span><span class="p">()</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_page_listing_buttons&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_author_edit_buttons</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">page_perms</span><span class="p">,</span> <span class="n">is_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">next_url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For pages that have an author, add an additional button to the page listing,</span>
<span class="sd">    linking to the &#39;edit&#39; page for that author.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">author_id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="s1">&#39;author_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">author_id</span><span class="p">:</span>
        <span class="c1"># the url helper will return something like: /admin/my-app/author/edit/2/</span>
        <span class="n">author_edit_url</span> <span class="o">=</span> <span class="n">author_modeladmin</span><span class="o">.</span><span class="n">url_helper</span><span class="o">.</span><span class="n">get_action_url</span><span class="p">(</span><span class="s1">&#39;edit&#39;</span><span class="p">,</span> <span class="n">author_id</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">PageListingButton</span><span class="p">(</span><span class="s1">&#39;Edit Author&#39;</span><span class="p">,</span>  <span class="n">author_edit_url</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">modeladmin_register</span><span class="p">(</span><span class="n">AuthorModelAdmin</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see from the example above, when using <code class="docutils literal notranslate"><span class="pre">get_action_url()</span></code> to
generate object-specific URLs, the target object’s primary key value must be supplied
so that it can be included in the resulting URL (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;/admin/my-app/author/edit/2/&quot;</span></code>).
The following object-specific action names are supported by <code class="docutils literal notranslate"><span class="pre">get_action_url()</span></code>:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">'edit'</span></code></dt>
<dd>Returns a URL for updating a specific object.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">'delete'</span></code></dt>
<dd>Returns a URL for deleting a specific object.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">'inspect'</span></code></dt>
<dd>Returns a URL for viewing details of a specific object.
<strong>NOTE:</strong> This will only work if <code class="docutils literal notranslate"><span class="pre">inspect_view_enabled</span></code> is set to
<code class="docutils literal notranslate"><span class="pre">True</span></code> on your <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you are using string values as primary keys for you model, you may need to handle
cases where the key contains characters that are not URL safe. Only alphanumerics
(<code class="docutils literal notranslate"><span class="pre">[0-9a-zA-Z]</span></code>), or the following special characters are safe:
<code class="docutils literal notranslate"><span class="pre">$</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">_</span></code>, <code class="docutils literal notranslate"><span class="pre">.</span></code>, <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">!</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">'</span></code>, <code class="docutils literal notranslate"><span class="pre">(</span></code>, <code class="docutils literal notranslate"><span class="pre">)</span></code>.</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">django.contrib.admin.utils.quote()</span></code> can be used to safely encode these primary
key values before passing them to <code class="docutils literal notranslate"><span class="pre">get_action_url()</span></code>. Failure to do this may result
in Wagtail not being able to recognise the primary key when the URL is visited,
resulting in 404 errors.</p>
</div>
</div>
<div class="section" id="getting-the-index-or-create-url-for-a-model">
<h9><a class="toc-backref" href="#id2">Getting the <code class="docutils literal notranslate"><span class="pre">index</span></code> or <code class="docutils literal notranslate"><span class="pre">create</span></code> URL for a model</a><a class="headerlink" href="#getting-the-index-or-create-url-for-a-model" title="Permalink to this headline">¶</a></h9>
<p>There are URLs available for the model listing view (action is <code class="docutils literal notranslate"><span class="pre">'index'</span></code>) and
the create model view (action is <code class="docutils literal notranslate"><span class="pre">'create'</span></code>). Each of these has an equivalent
shortcut available; <code class="docutils literal notranslate"><span class="pre">url_helper.index_url</span></code> and <code class="docutils literal notranslate"><span class="pre">url_helper.create_url</span></code>.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.wagtail_hooks</span> <span class="kn">import</span> <span class="n">AuthorModelAdmin</span>

<span class="n">url_helper</span> <span class="o">=</span> <span class="n">AuthorModelAdmin</span><span class="p">()</span><span class="o">.</span><span class="n">url_helper</span>

<span class="n">index_url</span> <span class="o">=</span> <span class="n">url_helper</span><span class="o">.</span><span class="n">get_action_url</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="c1"># OR we can use the &#39;index_url&#39; shortcut</span>
<span class="n">also_index_url</span> <span class="o">=</span> <span class="n">url_helper</span><span class="o">.</span><span class="n">index_url</span> <span class="c1"># note: do not call this property as a function</span>
<span class="c1"># both will output /admin/my-app/author</span>

<span class="n">create_url</span> <span class="o">=</span> <span class="n">url_helper</span><span class="o">.</span><span class="n">get_action_url</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">)</span>
<span class="c1"># OR we can use the &#39;create_url&#39; shortcut</span>
<span class="n">also_create_url</span> <span class="o">=</span> <span class="n">url_helper</span><span class="o">.</span><span class="n">create_url</span> <span class="c1"># note: do not call this property as a function</span>
<span class="c1"># both will output /admin/my-app/author/create</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you have registered a page type with <code class="docutils literal notranslate"><span class="pre">modeladmin</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">BlogPage</span></code>), and pages
of that type can be added to more than one place in the page tree, when a user visits
the <cite>create</cite> URL, they’ll be automatically redirected to another view to choose a
parent for the new page. So, this isn’t something you need to check or cater for in
your own code.</p>
</div>
<p>To customise <code class="docutils literal notranslate"><span class="pre">url_helper</span></code> behaviour, see <a class="reference internal" href="index.html#modeladmin-url-helper-class"><span class="std std-ref">ModelAdmin.url_helper_class</span></a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="installation">
<span id="modeladmin-usage"></span><h7>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h7>
<p>Add <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.modeladmin</span></code> to your <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
   <span class="o">...</span>
   <span class="s1">&#39;wagtail.contrib.modeladmin&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-use">
<h7>How to use<a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h7>
<div class="section" id="a-simple-example">
<span id="modeladmin-example-simple"></span><h8>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h8>
<p>Let’s say your website is for a local library. They have a model called
<code class="docutils literal notranslate"><span class="pre">Book</span></code> that appears across the site in many places. You can define a normal
Django model for it, then use ModelAdmin to create a menu in Wagtail’s admin
to create, view, and edit <code class="docutils literal notranslate"><span class="pre">Book</span></code> entries.</p>
<p><code class="docutils literal notranslate"><span class="pre">models.py</span></code> looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">FieldPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.images.edit_handlers</span> <span class="kn">import</span> <span class="n">ImageChooserPanel</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">cover_photo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s1">&#39;wagtailimages.Image&#39;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span>
    <span class="p">)</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">),</span>
        <span class="n">ImageChooserPanel</span><span class="p">(</span><span class="s1">&#39;cover_photo&#39;</span><span class="p">)</span>
    <span class="p">]</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can specify <code class="docutils literal notranslate"><span class="pre">FieldPanels</span></code> like <code class="docutils literal notranslate"><span class="pre">ImageChooserPanel</span></code>, <code class="docutils literal notranslate"><span class="pre">PageChooserPanel</span></code>,
and <code class="docutils literal notranslate"><span class="pre">DocumentChooserPanel</span></code> within the <code class="docutils literal notranslate"><span class="pre">panels</span></code> attribute of the model.
This lets you use Wagtail-specific features in an otherwise traditional
Django model.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wagtail_hooks.py</span></code> in your app directory would look something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ModelAdmin</span><span class="p">,</span> <span class="n">modeladmin_register</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Book</span>


<span class="k">class</span> <span class="nc">BookAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
    <span class="n">menu_label</span> <span class="o">=</span> <span class="s1">&#39;Book&#39;</span>  <span class="c1"># ditch this to use verbose_name_plural from model</span>
    <span class="n">menu_icon</span> <span class="o">=</span> <span class="s1">&#39;pilcrow&#39;</span>  <span class="c1"># change as required</span>
    <span class="n">menu_order</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># will put in 3rd place (000 being 1st, 100 2nd)</span>
    <span class="n">add_to_settings_menu</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># or True to add your model to the Settings sub-menu</span>
    <span class="n">exclude_from_explorer</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># or True to exclude pages of this type from Wagtail&#39;s explorer view</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">)</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,)</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">)</span>

<span class="c1"># Now you just need to register your customised ModelAdmin class with Wagtail</span>
<span class="n">modeladmin_register</span><span class="p">(</span><span class="n">BookAdmin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="a-more-complicated-example">
<span id="modeladmin-example-complex"></span><h8>A more complicated example<a class="headerlink" href="#a-more-complicated-example" title="Permalink to this headline">¶</a></h8>
<p>In addition to <code class="docutils literal notranslate"><span class="pre">Book</span></code>, perhaps we also want to add <code class="docutils literal notranslate"><span class="pre">Author</span></code> and <code class="docutils literal notranslate"><span class="pre">Genre</span></code>
models to our app and display a menu item for each of them, too. Creating
lots of menus can add up quickly, so it might be a good idea to group related
menus together. This section show you how to create one menu called <em>Library</em>
which expands to show submenus for <em>Book</em>, <em>Author</em>, and <em>Genre</em>.</p>
<p>Assume we’ve defined <code class="docutils literal notranslate"><span class="pre">Book</span></code>, <code class="docutils literal notranslate"><span class="pre">Author</span></code>, and <code class="docutils literal notranslate"><span class="pre">Genre</span></code> models in
<code class="docutils literal notranslate"><span class="pre">models.py</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">wagtail_hooks.py</span></code> in your app directory would look something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.contrib.modeladmin.options</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ModelAdmin</span><span class="p">,</span> <span class="n">ModelAdminGroup</span><span class="p">,</span> <span class="n">modeladmin_register</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Book</span><span class="p">,</span> <span class="n">Author</span><span class="p">,</span> <span class="n">Genre</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BookAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
    <span class="n">menu_label</span> <span class="o">=</span> <span class="s1">&#39;Book&#39;</span>  <span class="c1"># ditch this to use verbose_name_plural from model</span>
    <span class="n">menu_icon</span> <span class="o">=</span> <span class="s1">&#39;pilcrow&#39;</span>  <span class="c1"># change as required</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">)</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;genre&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">)</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AuthorAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Author</span>
    <span class="n">menu_label</span> <span class="o">=</span> <span class="s1">&#39;Author&#39;</span>  <span class="c1"># ditch this to use verbose_name_plural from model</span>
    <span class="n">menu_icon</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>  <span class="c1"># change as required</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">)</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">)</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GenreAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Genre</span>
    <span class="n">menu_label</span> <span class="o">=</span> <span class="s1">&#39;Genre&#39;</span>  <span class="c1"># ditch this to use verbose_name_plural from model</span>
    <span class="n">menu_icon</span> <span class="o">=</span> <span class="s1">&#39;group&#39;</span>  <span class="c1"># change as required</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,)</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,)</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">LibraryGroup</span><span class="p">(</span><span class="n">ModelAdminGroup</span><span class="p">):</span>
    <span class="n">menu_label</span> <span class="o">=</span> <span class="s1">&#39;Library&#39;</span>
    <span class="n">menu_icon</span> <span class="o">=</span> <span class="s1">&#39;folder-open-inverse&#39;</span>  <span class="c1"># change as required</span>
    <span class="n">menu_order</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># will put in 3rd place (000 being 1st, 100 2nd)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">(</span><span class="n">BookAdmin</span><span class="p">,</span> <span class="n">AuthorAdmin</span><span class="p">,</span> <span class="n">GenreAdmin</span><span class="p">)</span>

<span class="c1"># When using a ModelAdminGroup class to group several ModelAdmin classes together,</span>
<span class="c1"># you only need to register the ModelAdminGroup class with Wagtail:</span>
<span class="n">modeladmin_register</span><span class="p">(</span><span class="n">LibraryGroup</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="registering-multiple-classes-in-one-wagtail-hooks-py-file">
<span id="modeladmin-multi-registration"></span><h8>Registering multiple classes in one <code class="docutils literal notranslate"><span class="pre">wagtail_hooks.py</span></code> file<a class="headerlink" href="#registering-multiple-classes-in-one-wagtail-hooks-py-file" title="Permalink to this headline">¶</a></h8>
<p>Each time you call <code class="docutils literal notranslate"><span class="pre">modeladmin_register(MyAdmin)</span></code> it creates a new top-level
menu item in Wagtail’s left sidebar. You can call this multiple times within
the same <code class="docutils literal notranslate"><span class="pre">wagtail_hooks.py</span></code> file if you want. The example below will create
3 top-level menus.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">MovieAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MovieModel</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">MusicAdminGroup</span><span class="p">(</span><span class="n">ModelAdminGroup</span><span class="p">):</span>
    <span class="n">menu_label</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Music&quot;</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">(</span><span class="n">AlbumAdmin</span><span class="p">,</span> <span class="n">ArtistAdmin</span><span class="p">)</span>
    <span class="o">...</span>

<span class="n">modeladmin_register</span><span class="p">(</span><span class="n">BookAdmin</span><span class="p">)</span>
<span class="n">modeladmin_register</span><span class="p">(</span><span class="n">MovieAdmin</span><span class="p">)</span>
<span class="n">modeladmin_register</span><span class="p">(</span><span class="n">MusicAdminGroup</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-reference/contrib/postgres_search"></span><div class="section" id="postgresql-search-engine">
<span id="postgres-search"></span><h5>PostgreSQL search engine<a class="headerlink" href="#postgresql-search-engine" title="Permalink to this headline">¶</a></h5>
<p>This contrib module provides a search engine backend using
<a class="reference external" href="https://www.postgresql.org/docs/current/static/textsearch.html">PostgreSQL full-text search capabilities</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<div class="last line-block">
<div class="line">You can only use this module to index data from a PostgreSQL database.</div>
</div>
</div>
<p><strong>Features</strong>:</p>
<ul class="simple">
<li>It supports all the search features available in Wagtail.</li>
<li>Easy to install and adds no external dependency or service.</li>
<li>Excellent performance for sites with up to 200&nbsp;000 pages and stays decent for sites up to a million pages.</li>
<li>Faster to reindex than Elasticsearch, if you use PostgreSQL 9.5 or higher.</li>
</ul>
<p><strong>Drawbacks</strong>:</p>
<ul class="simple">
<li>Partial matching (<code class="docutils literal notranslate"><span class="pre">SearchField(partial_match=True)</span></code>) is not supported</li>
<li><code class="docutils literal notranslate"><span class="pre">SearchField(boost=…)</span></code> is only partially respected as PostgreSQL only supports four different boosts.
So if you use five or more distinct values for the boost in your site, slight inaccuracies may occur.</li>
<li>When <a class="reference internal" href="index.html#wagtailsearch-specifying-fields"><span class="std std-ref">Specifying the fields to search</span></a>, the index is not used,
so it will be slow on huge sites.</li>
<li>Still when <a class="reference internal" href="index.html#wagtailsearch-specifying-fields"><span class="std std-ref">Specifying the fields to search</span></a>, you cannot search
on a specific method.</li>
</ul>
<div class="section" id="installation">
<h6>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h6>
<p>Add <code class="docutils literal notranslate"><span class="pre">'wagtail.contrib.postgres_search',</span></code> anywhere in your <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="s1">&#39;wagtail.contrib.postgres_search&#39;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Then configure Wagtail to use it as a search backend.
Give it the alias <cite>‘default’</cite> if you want it to be the default search backend:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.contrib.postgres_search.backend&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After installing the module, run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></code> to create the necessary <code class="docutils literal notranslate"><span class="pre">postgres_search_indexentry</span></code> table.</p>
<p>You then need to index data inside this backend using
the <a class="reference internal" href="index.html#update-index"><span class="std std-ref">update_index</span></a> command. You can reuse this command whenever
you want. However, it should not be needed after a first usage since
the search engine is automatically updated when data is modified.
To disable this behaviour, see <a class="reference internal" href="index.html#wagtailsearch-backends-auto-update"><span class="std std-ref">AUTO_UPDATE</span></a>.</p>
</div>
<div class="section" id="configuration">
<h6>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h6>
<div class="section" id="language-postgresql-search-configuration">
<h7>Language / PostgreSQL search configuration<a class="headerlink" href="#language-postgresql-search-configuration" title="Permalink to this headline">¶</a></h7>
<p>Use the additional <code class="docutils literal notranslate"><span class="pre">'SEARCH_CONFIG'</span></code> key to define which PostgreSQL
search configuration should be used. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.contrib.postgres_search.backend&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SEARCH_CONFIG&#39;</span><span class="p">:</span> <span class="s1">&#39;english&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can deduce, a PostgreSQL search configuration is mostly used to define
rules for a language, English in this case. A search configuration consists
in a compilation of algorithms (parsers &amp; analysers)
and language specifications (stop words, stems, dictionaries, synonyms,
thesauruses, etc.).</p>
<p>A few search configurations are already defined by default in PostgreSQL.
You can list them using <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">-u</span> <span class="pre">postgres</span> <span class="pre">psql</span> <span class="pre">-c</span> <span class="pre">&quot;\dF&quot;</span></code> in a Unix shell
or by using this SQL query: <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">cfgname</span> <span class="pre">FROM</span> <span class="pre">pg_catalog.pg_ts_config</span></code>.</p>
<p>These already-defined search configurations are decent, but they’re basic
compared to commercial search engines.
If you want better support for your language, you will have to create
your own PostgreSQL search configuration. See the PostgreSQL documentation for
<a class="reference external" href="https://www.postgresql.org/docs/current/static/textsearch-configuration.html">an example</a>,
<a class="reference external" href="https://www.postgresql.org/docs/current/static/textsearch-parsers.html">the list of parsers</a>,
and <a class="reference external" href="https://www.postgresql.org/docs/current/static/textsearch-dictionaries.html">a guide to use dictionaries</a>.</p>
</div>
<div class="section" id="atomic-rebuild">
<h7>Atomic rebuild<a class="headerlink" href="#atomic-rebuild" title="Permalink to this headline">¶</a></h7>
<p>Like the Elasticsearch backend, this backend supports
<a class="reference internal" href="index.html#wagtailsearch-backends-atomic-rebuild"><span class="std std-ref">ATOMIC_REBUILD</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.contrib.postgres_search.backend&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ATOMIC_REBUILD&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is nearly useless with this backend. In Elasticsearch, all data
is removed before rebuilding the index. But in this PostgreSQL backend,
only objects no longer in the database are removed. Then the index is
progressively updated, with no moment where the index is empty.</p>
<p>However, if you want to be extra sure that nothing wrong happens while updating
the index, you can use atomic rebuild. The index will be rebuilt, but nobody
will have access to it until reindexing is complete. If any error occurs during
the operation, all changes to the index are reverted
as if reindexing was never started.</p>
</div>
</div>
</div>
<span id="document-reference/contrib/searchpromotions"></span><div class="section" id="module-wagtail.contrib.search_promotions">
<span id="promoted-search-results"></span><span id="editors-picks"></span><h5>Promoted search results<a class="headerlink" href="#module-wagtail.contrib.search_promotions" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">searchpromotions</span></code> module provides the models and user interface for managing “Promoted search results” and displaying them in a search results page.</p>
<p>“Promoted search results” allow editors to explicitly link relevant content to search terms, so results pages can contain curated content in addition to results from the search engine.</p>
<div class="section" id="installation">
<h6>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">searchpromotions</span></code> module is not enabled by default. To install it, add <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.search_promotions</span></code> to <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> in your project’s Django settings file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>

    <span class="s1">&#39;wagtail.contrib.search_promotions&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This app contains migrations so make sure you run the <code class="docutils literal notranslate"><span class="pre">migrate</span></code> django-admin command after installing.</p>
</div>
<div class="section" id="usage">
<h6>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h6>
<p>Once installed, a new menu item called “Promoted search results” should appear in the “Settings” menu. This is where you can assign pages to popular search terms.</p>
<div class="section" id="displaying-on-a-search-results-page">
<h7>Displaying on a search results page<a class="headerlink" href="#displaying-on-a-search-results-page" title="Permalink to this headline">¶</a></h7>
<p>To retrieve a list of promoted search results for a particular search query, you can use the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_search_promotions</span> <span class="pre">%}</span></code> template tag from the <code class="docutils literal notranslate"><span class="pre">wagtailsearchpromotions_tags</span></code> templatetag library:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="nv">wagtailsearchpromotions_tags</span> <span class="cp">%}</span>

...

<span class="cp">{%</span> <span class="k">get_search_promotions</span> <span class="nv">search_query</span> <span class="k">as</span> <span class="nv">search_promotions</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">search_promotion</span> <span class="k">in</span> <span class="nv">search_promotions</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">pageurl</span> <span class="nv">search_promotion.page</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">search_promotion.page.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">search_promotion.description</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-reference/contrib/simple_translation"></span><div class="section" id="simple-translation">
<span id="id1"></span><h5>Simple translation<a class="headerlink" href="#simple-translation" title="Permalink to this headline">¶</a></h5>
<p>The simple_translation module provides a user interface that allows users to copy pages and translatable snippets into another language.</p>
<ul class="simple">
<li>Copies are created in the source language (not translated)</li>
<li>Copies of pages are in draft status</li>
</ul>
<p>Content editors need to translate the content and publish the pages.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Simple Translation is optional. It can be switched out by third-party packages. Like the more advanced <a class="reference external" href="https://github.com/wagtail/wagtail-localize">wagtail-localize</a>.</p>
</div>
<div class="section" id="basic-configuration">
<h6>Basic configuration<a class="headerlink" href="#basic-configuration" title="Permalink to this headline">¶</a></h6>
<p>Add <code class="docutils literal notranslate"><span class="pre">&quot;wagtail.contrib.simple_translation&quot;</span></code> to INSTALLED_APPS in your settings file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="s2">&quot;wagtail.contrib.simple_translation&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></code> to create the necessary permissions.</p>
<p>In the Wagtail admin, go to settings and give some users or groups the “Can submit translations” permission.</p>
</div>
</div>
<span id="document-reference/contrib/table_block"></span><div class="section" id="tableblock">
<h5>TableBlock<a class="headerlink" href="#tableblock" title="Permalink to this headline">¶</a></h5>
<p>The TableBlock module provides an HTML table block type for StreamField. This module uses <a class="reference external" href="https://handsontable.com/">handsontable 6.2.2</a> to provide users with the ability to create and edit HTML tables in Wagtail. Table blocks provides a caption field for accessibility.</p>
<img alt="_images/screen40_table_block.png" src="_images/screen40_table_block.png" />
<div class="section" id="installation">
<h6>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h6>
<p>Add <code class="docutils literal notranslate"><span class="pre">&quot;wagtail.contrib.table_block&quot;</span></code> to your INSTALLED_APPS:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
  <span class="o">...</span>

  <span class="s2">&quot;wagtail.contrib.table_block&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-usage">
<h6>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h6>
<p>After installation, the TableBlock module can be used in a similar fashion to other StreamField blocks in the Wagtail core.</p>
<p>Import the TableBlock <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">wagtail.contrib.table_block.blocks</span> <span class="pre">import</span> <span class="pre">TableBlock</span></code> and add it to your StreamField declaration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DemoStreamBlock</span><span class="p">(</span><span class="n">StreamBlock</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">TableBlock</span><span class="p">()</span>
</pre></div>
</div>
<p>Then, on your page template, the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> tag (called on either the individual block, or the StreamField value as a whole) will render any table blocks it encounters as an HTML <code class="docutils literal notranslate"><span class="pre">&lt;table&gt;</span></code> element:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">page.body</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">for</span> <span class="nb">block</span> <span class="k">in</span> <span class="nv">page.body</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nb">block</span><span class="nv">.block_type</span> <span class="o">==</span> <span class="s1">&#39;table&#39;</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">include_block</span> <span class="nb">block</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="c">{# rendering for other block types #}</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="advanced-usage">
<h6>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h6>
<div class="section" id="default-configuration">
<h7>Default Configuration<a class="headerlink" href="#default-configuration" title="Permalink to this headline">¶</a></h7>
<p>When defining a TableBlock, Wagtail provides the ability to pass an optional <code class="docutils literal notranslate"><span class="pre">table_options</span></code> dictionary. The default TableBlock dictionary looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">default_table_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;minSpareRows&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;startRows&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;startCols&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;colHeaders&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;rowHeaders&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;contextMenu&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;row_above&#39;</span><span class="p">,</span>
        <span class="s1">&#39;row_below&#39;</span><span class="p">,</span>
        <span class="s1">&#39;---------&#39;</span><span class="p">,</span>
        <span class="s1">&#39;col_left&#39;</span><span class="p">,</span>
        <span class="s1">&#39;col_right&#39;</span><span class="p">,</span>
        <span class="s1">&#39;---------&#39;</span><span class="p">,</span>
        <span class="s1">&#39;remove_row&#39;</span><span class="p">,</span>
        <span class="s1">&#39;remove_col&#39;</span><span class="p">,</span>
        <span class="s1">&#39;---------&#39;</span><span class="p">,</span>
        <span class="s1">&#39;undo&#39;</span><span class="p">,</span>
        <span class="s1">&#39;redo&#39;</span>
    <span class="p">],</span>
    <span class="s1">&#39;editor&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
    <span class="s1">&#39;stretchH&#39;</span><span class="p">:</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
    <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">108</span><span class="p">,</span>
    <span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
    <span class="s1">&#39;renderer&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
    <span class="s1">&#39;autoColumnSize&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration-options">
<h7>Configuration Options<a class="headerlink" href="#configuration-options" title="Permalink to this headline">¶</a></h7>
<p>Every key in the <code class="docutils literal notranslate"><span class="pre">table_options</span></code> dictionary maps to a <a class="reference external" href="https://handsontable.com/">handsontable</a> option. These settings can be changed to alter the behaviour of tables in Wagtail. The following options are available:</p>
<ul class="simple">
<li><a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html#minSpareRows">minSpareRows</a> - The number of rows to append to the end of an empty grid. The default setting is 0.</li>
<li><a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html#startRows">startRows</a> - The default number of rows for a new table.</li>
<li><a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html#startCols">startCols</a> - The default number of columns for new tables.</li>
<li><a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html#colHeaders">colHeaders</a> - Can be set to <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>. This setting designates if new tables should be created with column headers. <strong>Note:</strong> this only sets the behaviour for newly created tables. Page editors can override this by checking the the “Column header” checkbox in the table editor in the Wagtail admin.</li>
<li><a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html#rowHeaders">rowHeaders</a> - Operates the same as <code class="docutils literal notranslate"><span class="pre">colHeaders</span></code> to designate if new tables should be created with the first column as a row header. Just like <code class="docutils literal notranslate"><span class="pre">colHeaders</span></code> this option can be overridden by the page editor in the Wagtail admin.</li>
<li><a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html#contextMenu">contextMenu</a> - Enables or disables the Handsontable right-click menu. By default this is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>. Alternatively you can provide a list or a dictionary with [specific options](<a class="reference external" href="https://handsontable.com/docs/6.2.2/demo-context-menu.html#page-specific">https://handsontable.com/docs/6.2.2/demo-context-menu.html#page-specific</a>).</li>
<li><a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html#editor">editor</a> - Defines the editor used for table cells. The default setting is text.</li>
<li><a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html#stretchH">stretchH</a> - Sets the default horizontal resizing of tables. Options include, ‘none’, ‘last’, and ‘all’. By default TableBlock uses ‘all’ for the even resizing of columns.</li>
<li><a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html#height">height</a> - The default height of the grid. By default TableBlock sets the height to <code class="docutils literal notranslate"><span class="pre">108</span></code> for the optimal appearance of new tables in the editor. This is optimized for tables with <code class="docutils literal notranslate"><span class="pre">startRows</span></code> set to <code class="docutils literal notranslate"><span class="pre">3</span></code>. If you change the number of <code class="docutils literal notranslate"><span class="pre">startRows</span></code> in the configuration, you might need to change the <code class="docutils literal notranslate"><span class="pre">height</span></code> setting to improve the default appearance in the editor.</li>
<li><a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html#language">language</a> - The default language setting. By default TableBlock tries to get the language from <code class="docutils literal notranslate"><span class="pre">django.utils.translation.get_language</span></code>. If needed, this setting can be overridden here.</li>
<li><a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html#renderer">renderer</a> - The default setting Handsontable uses to render the content of table cells.</li>
<li><a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html#autoColumnSize">autoColumnSize</a> - Enables or disables the <code class="docutils literal notranslate"><span class="pre">autoColumnSize</span></code> plugin. The TableBlock default setting is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
</ul>
<p>A <a class="reference external" href="https://handsontable.com/docs/6.2.2/Options.html">complete list of handsontable options</a> can be found on the Handsontable website.</p>
</div>
<div class="section" id="changing-the-default-table-options">
<h7>Changing the default table_options<a class="headerlink" href="#changing-the-default-table-options" title="Permalink to this headline">¶</a></h7>
<p>To change the default table options just pass a new table_options dictionary when a new TableBlock is declared.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_table_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;minSpareRows&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;startRows&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s1">&#39;startCols&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;colHeaders&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;rowHeaders&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;contextMenu&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;editor&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
    <span class="s1">&#39;stretchH&#39;</span><span class="p">:</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
    <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">216</span><span class="p">,</span>
    <span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
    <span class="s1">&#39;renderer&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
    <span class="s1">&#39;autoColumnSize&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">DemoStreamBlock</span><span class="p">(</span><span class="n">StreamBlock</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">TableBlock</span><span class="p">(</span><span class="n">table_options</span><span class="o">=</span><span class="n">new_table_options</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="supporting-cell-alignment">
<h7>Supporting cell alignment<a class="headerlink" href="#supporting-cell-alignment" title="Permalink to this headline">¶</a></h7>
<p>You can activate the <cite>alignment</cite> option by setting a custom <cite>contextMenu</cite> which allows you to set the alignment on a cell selection.
HTML classes set by handsontable will be kept on the rendered block. You’ll then be able to apply your own custom CSS rules to preserve the style. Those class names are:</p>
<ul class="simple">
<li>Horizontal: <code class="docutils literal notranslate"><span class="pre">htLeft</span></code>, <code class="docutils literal notranslate"><span class="pre">htCenter</span></code>, <code class="docutils literal notranslate"><span class="pre">htRight</span></code>, <code class="docutils literal notranslate"><span class="pre">htJustify</span></code></li>
<li>Vertical: <code class="docutils literal notranslate"><span class="pre">htTop</span></code>, <code class="docutils literal notranslate"><span class="pre">htMiddle</span></code>, <code class="docutils literal notranslate"><span class="pre">htBottom</span></code></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_table_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;contextMenu&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;row_above&#39;</span><span class="p">,</span>
        <span class="s1">&#39;row_below&#39;</span><span class="p">,</span>
        <span class="s1">&#39;---------&#39;</span><span class="p">,</span>
        <span class="s1">&#39;col_left&#39;</span><span class="p">,</span>
        <span class="s1">&#39;col_right&#39;</span><span class="p">,</span>
        <span class="s1">&#39;---------&#39;</span><span class="p">,</span>
        <span class="s1">&#39;remove_row&#39;</span><span class="p">,</span>
        <span class="s1">&#39;remove_col&#39;</span><span class="p">,</span>
        <span class="s1">&#39;---------&#39;</span><span class="p">,</span>
        <span class="s1">&#39;undo&#39;</span><span class="p">,</span>
        <span class="s1">&#39;redo&#39;</span><span class="p">,</span>
        <span class="s1">&#39;---------&#39;</span><span class="p">,</span>
        <span class="s1">&#39;copy&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cut&#39;</span>
        <span class="s1">&#39;---------&#39;</span><span class="p">,</span>
        <span class="s1">&#39;alignment&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>

  <span class="k">class</span> <span class="nc">DemoStreamBlock</span><span class="p">(</span><span class="n">StreamBlock</span><span class="p">):</span>
      <span class="o">...</span>
      <span class="n">table</span> <span class="o">=</span> <span class="n">TableBlock</span><span class="p">(</span><span class="n">table_options</span><span class="o">=</span><span class="n">new_table_options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-reference/contrib/redirects"></span><div class="section" id="redirects">
<span id="id1"></span><h5>Redirects<a class="headerlink" href="#redirects" title="Permalink to this headline">¶</a></h5>
<span class="target" id="module-wagtail.contrib.redirects"></span><p>The <code class="docutils literal notranslate"><span class="pre">redirects</span></code> module provides the models and user interface for managing arbitrary redirection between urls and <code class="docutils literal notranslate"><span class="pre">Pages</span></code> or other urls.</p>
<div class="section" id="installation">
<h6>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">redirects</span></code> module is not enabled by default. To install it, add <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.redirects</span></code> to <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> and <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.redirects.middleware.RedirectMiddleware</span></code> to <code class="docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code> in your project’s Django settings file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>

    <span class="s1">&#39;wagtail.contrib.redirects&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="c1"># all other django middlware first</span>

    <span class="s1">&#39;wagtail.contrib.redirects.middleware.RedirectMiddleware&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This app contains migrations so make sure you run the <code class="docutils literal notranslate"><span class="pre">migrate</span></code> django-admin command after installing.</p>
</div>
<div class="section" id="usage">
<h6>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h6>
<p>Once installed, a new menu item called “Redirects” should appear in the “Settings” menu. This is where you can add arbitrary redirects to your site.</p>
<p>Page model recipe of to have redirects created automatically when changing a page’s slug, see <a class="reference internal" href="index.html#page-model-auto-redirects-recipe"><span class="std std-ref">Have redirects created automatically when changing page slug</span></a>.</p>
<p>For an editor’s guide to the interface, see <a class="reference internal" href="index.html#managing-redirects"><span class="std std-ref">Managing Redirects</span></a>.</p>
</div>
<div class="section" id="management-commands">
<h6>Management commands<a class="headerlink" href="#management-commands" title="Permalink to this headline">¶</a></h6>
<div class="section" id="import-redirects">
<h7>import_redirects<a class="headerlink" href="#import-redirects" title="Permalink to this headline">¶</a></h7>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./manage.py import_redirects
</pre></div>
</div>
<p>This command imports and creates redirects from a file supplied by the user.</p>
<p>Options:</p>
<ul class="simple">
<li><strong>src</strong>
This is the path to the file you wish to import redirects from.</li>
<li><strong>site</strong>
This is the <strong>site</strong> for the site you wish to save redirects to.</li>
<li><strong>permanent</strong>
If the redirects imported should be <strong>permanent</strong> (True) or not (False). It’s True by default.</li>
<li><strong>from</strong>
The column index you want to use as redirect from value.</li>
<li><strong>to</strong>
The column index you want to use as redirect to value.</li>
<li><strong>dry_run</strong>
Lets you run a import without doing any changes.</li>
<li><strong>ask</strong>
Lets you inspect and approve each redirect before it is created.</li>
</ul>
</div>
</div>
<div class="section" id="module-wagtail.contrib.redirects.models">
<span id="the-redirect-class"></span><h6>The <code class="docutils literal notranslate"><span class="pre">Redirect</span></code> class<a class="headerlink" href="#module-wagtail.contrib.redirects.models" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="wagtail.contrib.redirects.models.Redirect">
<em class="property">class </em><code class="descclassname">wagtail.contrib.redirects.models.</code><code class="descname">Redirect</code><span class="sig-paren">(</span><em>id</em>, <em>old_path</em>, <em>site</em>, <em>is_permanent</em>, <em>redirect_page</em>, <em>redirect_link</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.redirects.models.Redirect" title="Permalink to this definition">¶</a></dt>
<dd><dl class="staticmethod">
<dt id="wagtail.contrib.redirects.models.Redirect.add_redirect">
<em class="property">static </em><code class="descname">add_redirect</code><span class="sig-paren">(</span><em>old_path</em>, <em>redirect_to=None</em>, <em>is_permanent=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.contrib.redirects.models.Redirect.add_redirect" title="Permalink to this definition">¶</a></dt>
<dd><p>Create and save a Redirect instance with a single method.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>old_path</strong> – the path you wish to redirect</li>
<li><strong>redirect_to</strong> – a Page (instance) or path (string) where the redirect should point</li>
<li><strong>is_permanent</strong> – whether the redirect should be indicated as permanent (i.e. 301 redirect)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Redirect instance</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-reference/contrib/legacy_richtext"></span><div class="section" id="module-wagtail.contrib.legacy.richtext">
<span id="legacy-richtext"></span><h5>Legacy richtext<a class="headerlink" href="#module-wagtail.contrib.legacy.richtext" title="Permalink to this headline">¶</a></h5>
<p>Provides the legacy richtext wrapper.</p>
<p>Place <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.legacy.richtext</span></code> before <code class="docutils literal notranslate"><span class="pre">wagtail.core</span></code> in  <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="s2">&quot;wagtail.contrib.legacy.richtext&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wagtail.core&quot;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">page.body|richtext</span> <span class="pre">}}</span></code> template filter will now render:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;rich-text&quot;</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="settings">
<h5><a class="reference internal" href="index.html#document-reference/contrib/settings"><span class="doc">Site settings</span></a><a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h5>
<p>Site-wide settings that are editable by administrators in the Wagtail admin.</p>
</div>
<div class="section" id="forms-index">
<h5><a class="reference internal" href="index.html#document-reference/contrib/forms/index"><span class="doc">Form builder</span></a><a class="headerlink" href="#forms-index" title="Permalink to this headline">¶</a></h5>
<p>Allows forms to be created by admins and provides an interface for browsing form submissions.</p>
</div>
<div class="section" id="sitemaps">
<h5><a class="reference internal" href="index.html#document-reference/contrib/sitemaps"><span class="doc">Sitemap generator</span></a><a class="headerlink" href="#sitemaps" title="Permalink to this headline">¶</a></h5>
<p>Provides a view that generates a Google XML sitemap of your public Wagtail content.</p>
</div>
<div class="section" id="frontendcache">
<h5><a class="reference internal" href="index.html#document-reference/contrib/frontendcache"><span class="doc">Frontend cache invalidator</span></a><a class="headerlink" href="#frontendcache" title="Permalink to this headline">¶</a></h5>
<p>A module for automatically purging pages from a cache (Varnish, Squid, Cloudflare or Cloudfront) when their content is changed.</p>
</div>
<div class="section" id="routablepage">
<h5><a class="reference internal" href="index.html#document-reference/contrib/routablepage"><span class="doc">RoutablePageMixin</span></a><a class="headerlink" href="#routablepage" title="Permalink to this headline">¶</a></h5>
<p>Provides a way of embedding Django URLconfs into pages.</p>
</div>
<div class="section" id="modeladmin-index">
<h5><a class="reference internal" href="index.html#document-reference/contrib/modeladmin/index"><span class="doc">ModelAdmin</span></a><a class="headerlink" href="#modeladmin-index" title="Permalink to this headline">¶</a></h5>
<p>A module allowing for more customisable representation and management of custom models in Wagtail’s admin area.</p>
</div>
<div class="section" id="searchpromotions">
<h5><a class="reference internal" href="index.html#document-reference/contrib/searchpromotions"><span class="doc">Promoted search results</span></a><a class="headerlink" href="#searchpromotions" title="Permalink to this headline">¶</a></h5>
<p>A module for managing “Promoted Search Results”</p>
</div>
<div class="section" id="simple-translation">
<h5><a class="reference internal" href="index.html#document-reference/contrib/simple_translation"><span class="doc">Simple translation</span></a><a class="headerlink" href="#simple-translation" title="Permalink to this headline">¶</a></h5>
<p>A module for copying translatables (pages and snippets) to another language.</p>
</div>
<div class="section" id="table-block">
<h5><a class="reference internal" href="index.html#document-reference/contrib/table_block"><span class="doc">TableBlock</span></a><a class="headerlink" href="#table-block" title="Permalink to this headline">¶</a></h5>
<p>Provides a TableBlock for adding HTML tables to pages.</p>
</div>
<div class="section" id="redirects">
<h5><a class="reference internal" href="index.html#document-reference/contrib/redirects"><span class="doc">Redirects</span></a><a class="headerlink" href="#redirects" title="Permalink to this headline">¶</a></h5>
<p>Provides a way to manage redirects.</p>
</div>
<div class="section" id="legacy-richtext">
<h5><a class="reference internal" href="index.html#document-reference/contrib/legacy_richtext"><span class="doc">Legacy richtext</span></a><a class="headerlink" href="#legacy-richtext" title="Permalink to this headline">¶</a></h5>
<p>Provides the legacy richtext wrapper (<code class="docutils literal notranslate"><span class="pre">&lt;div</span> <span class="pre">class=&quot;rich-text&quot;&gt;&lt;/div&gt;</span></code>).</p>
</div>
</div>
<span id="document-reference/management_commands"></span><div class="section" id="management-commands">
<span id="id1"></span><h4>Management commands<a class="headerlink" href="#management-commands" title="Permalink to this headline">¶</a></h4>
<div class="section" id="publish-scheduled-pages">
<span id="id2"></span><h5>publish_scheduled_pages<a class="headerlink" href="#publish-scheduled-pages" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./manage.py publish_scheduled_pages
</pre></div>
</div>
<p>This command publishes, updates or unpublishes pages that have had these actions scheduled by an editor. We recommend running this command once an hour.</p>
</div>
<div class="section" id="fixtree">
<span id="id3"></span><h5>fixtree<a class="headerlink" href="#fixtree" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./manage.py fixtree
</pre></div>
</div>
<p>This command scans for errors in your database and attempts to fix any issues it finds.</p>
</div>
<div class="section" id="move-pages">
<span id="id4"></span><h5>move_pages<a class="headerlink" href="#move-pages" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>manage.py move_pages from to
</pre></div>
</div>
<p>This command moves a selection of pages from one section of the tree to another.</p>
<p>Options:</p>
<ul class="simple">
<li><strong>from</strong>
This is the <strong>id</strong> of the page to move pages from. All descendants of this page will be moved to the destination. After the operation is complete, this page will have no children.</li>
<li><strong>to</strong>
This is the <strong>id</strong> of the page to move pages to.</li>
</ul>
</div>
<div class="section" id="purge-revisions">
<span id="id5"></span><h5>purge_revisions<a class="headerlink" href="#purge-revisions" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>manage.py purge_revisions <span class="o">[</span>--days<span class="o">=</span>&lt;number of days&gt;<span class="o">]</span>
</pre></div>
</div>
<p>This command deletes old page revisions which are not in moderation, live, approved to go live, or the latest
revision for a page. If the <code class="docutils literal notranslate"><span class="pre">days</span></code> argument is supplied, only revisions older than the specified number of
days will be deleted.</p>
</div>
<div class="section" id="update-index">
<span id="id6"></span><h5>update_index<a class="headerlink" href="#update-index" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./manage.py update_index <span class="o">[</span>--backend &lt;backend name&gt;<span class="o">]</span>
</pre></div>
</div>
<p>This command rebuilds the search index from scratch. It is not required when using the database search backend (<code class="docutils literal notranslate"><span class="pre">wagtail.search.backends.db</span></code>).</p>
<p>It is recommended to run this command once a week and at the following times:</p>
<ul class="simple">
<li>whenever any pages have been created through a script (after an import, for example)</li>
<li>whenever any changes have been made to models or search configuration</li>
</ul>
<p>The search may not return any results while this command is running, so avoid running it at peak times.</p>
<div class="section" id="specifying-which-backend-to-update">
<h6>Specifying which backend to update<a class="headerlink" href="#specifying-which-backend-to-update" title="Permalink to this headline">¶</a></h6>
<p>By default, <code class="docutils literal notranslate"><span class="pre">update_index</span></code> will rebuild all the search indexes listed in <code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_BACKENDS</span></code>.</p>
<p>If you have multiple backends and would only like to update one of them, you can use the <code class="docutils literal notranslate"><span class="pre">--backend</span></code> option.</p>
<p>For example, to update just the default backend:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python manage.py update_index --backend default
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--chunk_size</span></code> option can be used to set the size of chunks that are indexed at a time. This defaults to
1000 but may need to be reduced for larger document sizes.</p>
</div>
<div class="section" id="indexing-the-schema-only">
<h6>Indexing the schema only<a class="headerlink" href="#indexing-the-schema-only" title="Permalink to this headline">¶</a></h6>
<p>You can prevent the <code class="docutils literal notranslate"><span class="pre">update_index</span></code> command from indexing any data by using the <code class="docutils literal notranslate"><span class="pre">--schema-only</span></code> option:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python manage.py update_index --schema-only
</pre></div>
</div>
</div>
</div>
<div class="section" id="wagtail-update-index">
<span id="id7"></span><h5>wagtail_update_index<a class="headerlink" href="#wagtail-update-index" title="Permalink to this headline">¶</a></h5>
<p>An alias for the <code class="docutils literal notranslate"><span class="pre">update_index</span></code> command that can be used when another installed package (such as <a class="reference external" href="https://haystacksearch.org/">Haystack</a>) provides a command named <code class="docutils literal notranslate"><span class="pre">update_index</span></code>. In this case, the other package’s entry in <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> should appear above <code class="docutils literal notranslate"><span class="pre">wagtail.search</span></code> so that its <code class="docutils literal notranslate"><span class="pre">update_index</span></code> command takes precedence over Wagtail’s.</p>
</div>
<div class="section" id="search-garbage-collect">
<span id="id8"></span><h5>search_garbage_collect<a class="headerlink" href="#search-garbage-collect" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./manage.py search_garbage_collect
</pre></div>
</div>
<p>Wagtail keeps a log of search queries that are popular on your website. On high traffic websites, this log may get big and you may want to clean out old search queries. This command cleans out all search query logs that are more than one week old (or a number of days configurable through the <a class="reference internal" href="index.html#wagtailsearch-hits-max-age"><span class="std std-ref">WAGTAILSEARCH_HITS_MAX_AGE</span></a> setting).</p>
</div>
</div>
<span id="document-reference/hooks"></span><div class="section" id="hooks">
<span id="admin-hooks"></span><h4>Hooks<a class="headerlink" href="#hooks" title="Permalink to this headline">¶</a></h4>
<p>On loading, Wagtail will search for any app with the file <code class="docutils literal notranslate"><span class="pre">wagtail_hooks.py</span></code> and execute the contents. This provides a way to register your own functions to execute at certain points in Wagtail’s execution, such as when a page is saved or when the main menu is constructed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Hooks are typically used to customise the view-level behaviour of the Wagtail admin and front-end. For customisations that only deal with model-level behaviour - such as calling an external service when a page or document is added - it is often better to use <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/signals/" title="(in Django v3.2)"><span class="xref std std-doc">Django’s signal mechanism</span></a> (see also: <a class="reference internal" href="index.html#signals"><span class="std std-ref">Wagtail signals</span></a>), as these are not dependent on a user taking a particular path through the admin interface.</p>
</div>
<p>Registering functions with a Wagtail hook is done through the <code class="docutils literal notranslate"><span class="pre">&#64;hooks.register</span></code> decorator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;name_of_hook&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_hook_function</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="o">...</span><span class="p">)</span>
    <span class="c1"># your code here</span>
</pre></div>
</div>
<p>Alternatively, <code class="docutils literal notranslate"><span class="pre">hooks.register</span></code> can be called as an ordinary function, passing in the name of the hook and a handler function defined elsewhere:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;name_of_hook&#39;</span><span class="p">,</span> <span class="n">my_hook_function</span><span class="p">)</span>
</pre></div>
</div>
<p>If you need your hooks to run in a particular order, you can pass the <code class="docutils literal notranslate"><span class="pre">order</span></code> parameter.  If order is not specified then the hooks proceed in the order given by INSTALLED_APPS. Wagtail uses hooks internally, too, so you need to be aware of order when overriding built-in Wagtail functionality (i.e. removing default summary items):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;name_of_hook&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># This will run after every hook in the wagtail core</span>
<span class="k">def</span> <span class="nf">my_hook_function</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="o">...</span><span class="p">)</span>
    <span class="c1"># your code here</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;name_of_hook&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># This will run before every hook in the wagtail core</span>
<span class="k">def</span> <span class="nf">my_other_hook_function</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="o">...</span><span class="p">)</span>
    <span class="c1"># your code here</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;name_of_hook&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># This will run after `my_hook_function`</span>
<span class="k">def</span> <span class="nf">yet_another_hook_function</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="o">...</span><span class="p">)</span>
    <span class="c1"># your code here</span>
</pre></div>
</div>
<div class="section" id="unit-testing-hooks">
<h5>Unit testing hooks<a class="headerlink" href="#unit-testing-hooks" title="Permalink to this headline">¶</a></h5>
<p>Hooks are usually registered on startup and can’t be changed at runtime. But when writing unit tests, you might want to register a hook
function just for a single test or block of code and unregister it so that it doesn’t run when other tests are run.</p>
<p>You can register hooks temporarily using the <code class="docutils literal notranslate"><span class="pre">hooks.register_temporarily</span></code> function, this can be used as both a decorator and a context
manager. Here’s an example of how to register a hook function for just a single test:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_hook_function</span><span class="p">():</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">MyHookTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="nd">@hooks</span><span class="o">.</span><span class="n">register_temporarily</span><span class="p">(</span><span class="s1">&#39;name_of_hook&#39;</span><span class="p">,</span> <span class="n">my_hook_function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_my_hook_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Test with the hook registered here</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>And here’s an example of registering a hook function for a single block of code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_hook_function</span><span class="p">():</span>
    <span class="o">...</span>

<span class="k">with</span> <span class="n">hooks</span><span class="o">.</span><span class="n">register_temporarily</span><span class="p">(</span><span class="s1">&#39;name_of_hook&#39;</span><span class="p">,</span> <span class="n">my_hook_function</span><span class="p">):</span>
    <span class="c1"># Hook is registered here</span>
    <span class="o">..</span>

<span class="c1"># Hook is unregistered here</span>
</pre></div>
</div>
<p>If you need to register multiple hooks in a <code class="docutils literal notranslate"><span class="pre">with</span></code> block, you can pass the hooks in as a list of tuples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_hook</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">my_other_hook</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">with</span> <span class="n">hooks</span><span class="o">.</span><span class="n">register_temporarily</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;hook_name&#39;</span><span class="p">,</span> <span class="n">my_hook</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;hook_name&#39;</span><span class="p">,</span> <span class="n">my_other_hook</span><span class="p">),</span>
<span class="p">]):</span>
    <span class="c1"># All hooks are registered here</span>
    <span class="o">..</span>

<span class="c1"># All hooks are unregistered here</span>
</pre></div>
</div>
<p>The available hooks are listed below.</p>
</div>
<div class="section" id="admin-modules">
<h5>Admin modules<a class="headerlink" href="#admin-modules" title="Permalink to this headline">¶</a></h5>
<p>Hooks for building new areas of the admin interface (alongside pages, images, documents and so on).</p>
<div class="section" id="construct-homepage-panels">
<span id="id1"></span><h6><code class="docutils literal notranslate"><span class="pre">construct_homepage_panels</span></code><a class="headerlink" href="#construct-homepage-panels" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add or remove panels from the Wagtail admin homepage. The callable passed into this hook should take a <code class="docutils literal notranslate"><span class="pre">request</span></code> object and a list of panel objects, and should modify this list in-place as required. Panel objects are <a class="reference internal" href="index.html#document-extending/template_components"><span class="doc">components</span></a> with an additional <code class="docutils literal notranslate"><span class="pre">order</span></code> property, an integer that determines the panel’s position in the final ordered list. The default panels use integers between <code class="docutils literal notranslate"><span class="pre">100</span></code> and <code class="docutils literal notranslate"><span class="pre">300</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">mark_safe</span>

<span class="kn">from</span> <span class="nn">wagtail.admin.ui.components</span> <span class="kn">import</span> <span class="n">Component</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="k">class</span> <span class="nc">WelcomePanel</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="n">order</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">def</span> <span class="nf">render_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_context</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;section class=&quot;panel summary nice-padding&quot;&gt;</span>
<span class="s2">          &lt;h3&gt;No, but seriously -- welcome to the admin homepage.&lt;/h3&gt;</span>
<span class="s2">        &lt;/section&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_homepage_panels&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_another_welcome_panel</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">panels</span><span class="p">):</span>
    <span class="n">panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WelcomePanel</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="construct-homepage-summary-items">
<span id="id2"></span><h6><code class="docutils literal notranslate"><span class="pre">construct_homepage_summary_items</span></code><a class="headerlink" href="#construct-homepage-summary-items" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add or remove items from the ‘site summary’ bar on the admin homepage (which shows the number of pages and other object that exist on the site). The callable passed into this hook should take a <code class="docutils literal notranslate"><span class="pre">request</span></code> object and a list of summary item objects, and should modify this list in-place as required. Summary item objects are instances of <code class="docutils literal notranslate"><span class="pre">wagtail.admin.site_summary.SummaryItem</span></code>, which extends <a class="reference internal" href="index.html#creating-template-components"><span class="std std-ref">the Component class</span></a> with the following additional methods and properties:</p>
<dl class="method">
<dt id="SummaryItem">
<code class="descname">SummaryItem</code><span class="sig-paren">(</span><em>request</em><span class="sig-paren">)</span><a class="headerlink" href="#SummaryItem" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor; receives the request object its argument</p>
</dd></dl>

<dl class="attribute">
<dt id="order">
<code class="descname">order</code><a class="headerlink" href="#order" title="Permalink to this definition">¶</a></dt>
<dd><p>An integer that specifies the item’s position in the sequence.</p>
</dd></dl>

<dl class="method">
<dt id="is_shown">
<code class="descname">is_shown</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#is_shown" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a boolean indicating whether the summary item should be shown on this request.</p>
</dd></dl>

</div></blockquote>
</div>
<div class="section" id="construct-main-menu">
<span id="id3"></span><h6><code class="docutils literal notranslate"><span class="pre">construct_main_menu</span></code><a class="headerlink" href="#construct-main-menu" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called just before the Wagtail admin menu is output, to allow the list of menu items to be modified. The callable passed to this hook will receive a <code class="docutils literal notranslate"><span class="pre">request</span></code> object and a list of <code class="docutils literal notranslate"><span class="pre">menu_items</span></code>, and should modify <code class="docutils literal notranslate"><span class="pre">menu_items</span></code> in-place as required. Adding menu items should generally be done through the <code class="docutils literal notranslate"><span class="pre">register_admin_menu_item</span></code> hook instead - items added through <code class="docutils literal notranslate"><span class="pre">construct_main_menu</span></code> will be missing any associated JavaScript includes, and their <code class="docutils literal notranslate"><span class="pre">is_shown</span></code> check will not be applied.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_main_menu&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hide_explorer_menu_item_from_frank</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">menu_items</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s1">&#39;frank&#39;</span><span class="p">:</span>
    <span class="n">menu_items</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">menu_items</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;explorer&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="describe-collection-contents">
<span id="id4"></span><h6><code class="docutils literal notranslate"><span class="pre">describe_collection_contents</span></code><a class="headerlink" href="#describe-collection-contents" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Called when Wagtail needs to find out what objects exist in a collection, if any. Currently this happens on the confirmation before deleting a collection, to ensure that non-empty collections cannot be deleted. The callable passed to this hook will receive a <code class="docutils literal notranslate"><span class="pre">collection</span></code> object, and should return either <code class="docutils literal notranslate"><span class="pre">None</span></code> (to indicate no objects in this collection), or a dict containing the following keys:</div></blockquote>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">count</span></code></dt>
<dd>A numeric count of items in this collection</dd>
<dt><code class="docutils literal notranslate"><span class="pre">count_text</span></code></dt>
<dd>A human-readable string describing the number of items in this collection, such as “3 documents”. (Sites with multi-language support should return a translatable string here, most likely using the <code class="docutils literal notranslate"><span class="pre">django.utils.translation.ngettext</span></code> function.)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">url</span></code> (optional)</dt>
<dd>A URL to an index page that lists the objects being described.</dd>
</dl>
</div>
<div class="section" id="register-account-settings-panel">
<h6><code class="docutils literal notranslate"><span class="pre">register_account_settings_panel</span></code><a class="headerlink" href="#register-account-settings-panel" title="Permalink to this headline">¶</a></h6>
<p>Registers a new settings panel class to add to the “Account” view in the admin.</p>
<p>This hook can be added to a sub-class of <code class="docutils literal notranslate"><span class="pre">BaseSettingsPanel</span></code>. For example:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin.views.account</span> <span class="kn">import</span> <span class="n">BaseSettingsPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_account_settings_panel&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CustomSettingsPanel</span><span class="p">(</span><span class="n">BaseSettingsPanel</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;My custom settings&quot;</span>
    <span class="n">order</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">CustomSettingsForm</span>
</pre></div>
</div>
</div></blockquote>
<p>Alternatively, it can also be added to a function. For example, this function is equivalent to the above:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin.views.account</span> <span class="kn">import</span> <span class="n">BaseSettingsPanel</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="k">class</span> <span class="nc">CustomSettingsPanel</span><span class="p">(</span><span class="n">BaseSettingsPanel</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;My custom settings&quot;</span>
    <span class="n">order</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">CustomSettingsForm</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_account_settings_panel&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_custom_settings_panel</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">CustomSettingsPanel</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>More details about the options that are available can be found at <a class="reference internal" href="index.html#document-extending/custom_account_settings"><span class="doc">Customising the user account settings form</span></a>.</p>
</div>
<div class="section" id="register-account-menu-item">
<span id="id5"></span><h6><code class="docutils literal notranslate"><span class="pre">register_account_menu_item</span></code><a class="headerlink" href="#register-account-menu-item" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add an item to the “More actions” tab on the “Account” page within the Wagtail admin.
The callable for this hook should return a dict with the keys
<code class="docutils literal notranslate"><span class="pre">url</span></code>, <code class="docutils literal notranslate"><span class="pre">label</span></code> and <code class="docutils literal notranslate"><span class="pre">help_text</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_account_menu_item&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_account_delete_account</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;delete-account&#39;</span><span class="p">),</span>
        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Delete account&#39;</span><span class="p">,</span>
        <span class="s1">&#39;help_text&#39;</span><span class="p">:</span> <span class="s1">&#39;This permanently deletes your account.&#39;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="register-admin-menu-item">
<span id="id6"></span><h6><code class="docutils literal notranslate"><span class="pre">register_admin_menu_item</span></code><a class="headerlink" href="#register-admin-menu-item" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add an item to the Wagtail admin menu. The callable passed to this hook must return an instance of <code class="docutils literal notranslate"><span class="pre">wagtail.admin.menu.MenuItem</span></code>. New items can be constructed from the <code class="docutils literal notranslate"><span class="pre">MenuItem</span></code> class by passing in a <code class="docutils literal notranslate"><span class="pre">label</span></code> which will be the text in the menu item, and the URL of the admin page you want the menu item to link to (usually by calling <code class="docutils literal notranslate"><span class="pre">reverse()</span></code> on the admin view you’ve set up). Additionally, the following keyword arguments are accepted:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">name:</th><td class="field-body">an internal name used to identify the menu item; defaults to the slugified form of the label.</td>
</tr>
<tr class="field-even field"><th class="field-name">icon_name:</th><td class="field-body">icon to display against the menu item</td>
</tr>
<tr class="field-odd field"><th class="field-name">classnames:</th><td class="field-body">additional classnames applied to the link</td>
</tr>
<tr class="field-even field"><th class="field-name">attrs:</th><td class="field-body">additional HTML attributes to apply to the link</td>
</tr>
<tr class="field-odd field"><th class="field-name">order:</th><td class="field-body">an integer which determines the item’s position in the menu</td>
</tr>
</tbody>
</table>
<p>For menu items that are only available to superusers, the subclass <code class="docutils literal notranslate"><span class="pre">wagtail.admin.menu.AdminOnlyMenuItem</span></code> can be used in place of <code class="docutils literal notranslate"><span class="pre">MenuItem</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">MenuItem</span></code> can be further subclassed to customise the HTML output, specify JavaScript files required by the menu item, or conditionally show or hide the item for specific requests (for example, to apply permission checks); see the source code (<code class="docutils literal notranslate"><span class="pre">wagtail/admin/menu.py</span></code>) for details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.menu</span> <span class="kn">import</span> <span class="n">MenuItem</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_admin_menu_item&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_frank_menu_item</span><span class="p">():</span>
  <span class="k">return</span> <span class="n">MenuItem</span><span class="p">(</span><span class="s1">&#39;Frank&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;frank&#39;</span><span class="p">),</span> <span class="n">icon_name</span><span class="o">=</span><span class="s1">&#39;folder-inverse&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="register-admin-urls">
<span id="id7"></span><h6><code class="docutils literal notranslate"><span class="pre">register_admin_urls</span></code><a class="headerlink" href="#register-admin-urls" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Register additional admin page URLs. The callable fed into this hook should return a list of Django URL patterns which define the structure of the pages and endpoints of your extension to the Wagtail admin. For more about vanilla Django URLconfs and views, see <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/http/urls/" title="(in Django v3.2)"><span class="xref std std-doc">url dispatcher</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="k">def</span> <span class="nf">admin_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span>
    <span class="s2">&quot;I have approximate knowledge of many things!&quot;</span><span class="p">,</span>
    <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_admin_urls&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">urlconf_time</span><span class="p">():</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;how_did_you_almost_know_my_name/&#39;</span><span class="p">,</span> <span class="n">admin_view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;frank&#39;</span><span class="p">),</span>
  <span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="register-group-permission-panel">
<span id="id8"></span><h6><code class="docutils literal notranslate"><span class="pre">register_group_permission_panel</span></code><a class="headerlink" href="#register-group-permission-panel" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Add a new panel to the Groups form in the ‘settings’ area. The callable passed to this hook must return a ModelForm / ModelFormSet-like class, with a constructor that accepts a group object as its <code class="docutils literal notranslate"><span class="pre">instance</span></code> keyword argument, and which implements the methods <code class="docutils literal notranslate"><span class="pre">save</span></code>, <code class="docutils literal notranslate"><span class="pre">is_valid</span></code>, and <code class="docutils literal notranslate"><span class="pre">as_admin_panel</span></code> (which returns the HTML to be included on the group edit page).</div></blockquote>
</div>
<div class="section" id="register-settings-menu-item">
<span id="id9"></span><h6><code class="docutils literal notranslate"><span class="pre">register_settings_menu_item</span></code><a class="headerlink" href="#register-settings-menu-item" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>As <code class="docutils literal notranslate"><span class="pre">register_admin_menu_item</span></code>, but registers menu items into the ‘Settings’ sub-menu rather than the top-level menu.</div></blockquote>
</div>
<div class="section" id="construct-settings-menu">
<span id="id10"></span><h6><code class="docutils literal notranslate"><span class="pre">construct_settings_menu</span></code><a class="headerlink" href="#construct-settings-menu" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>As <code class="docutils literal notranslate"><span class="pre">construct_main_menu</span></code>, but modifies the ‘Settings’ sub-menu rather than the top-level menu.</div></blockquote>
</div>
<div class="section" id="register-reports-menu-item">
<span id="id11"></span><h6><code class="docutils literal notranslate"><span class="pre">register_reports_menu_item</span></code><a class="headerlink" href="#register-reports-menu-item" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>As <code class="docutils literal notranslate"><span class="pre">register_admin_menu_item</span></code>, but registers menu items into the ‘Reports’ sub-menu rather than the top-level menu.</div></blockquote>
</div>
<div class="section" id="construct-reports-menu">
<span id="id12"></span><h6><code class="docutils literal notranslate"><span class="pre">construct_reports_menu</span></code><a class="headerlink" href="#construct-reports-menu" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>As <code class="docutils literal notranslate"><span class="pre">construct_main_menu</span></code>, but modifies the ‘Reports’ sub-menu rather than the top-level menu.</div></blockquote>
</div>
<div class="section" id="register-admin-search-area">
<span id="id13"></span><h6><code class="docutils literal notranslate"><span class="pre">register_admin_search_area</span></code><a class="headerlink" href="#register-admin-search-area" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add an item to the Wagtail admin search “Other Searches”. Behaviour of this hook is similar to <code class="docutils literal notranslate"><span class="pre">register_admin_menu_item</span></code>. The callable passed to this hook must return an instance of <code class="docutils literal notranslate"><span class="pre">wagtail.admin.search.SearchArea</span></code>. New items can be constructed from the <code class="docutils literal notranslate"><span class="pre">SearchArea</span></code> class by passing the following parameters:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">label:</th><td class="field-body">text displayed in the “Other Searches” option box.</td>
</tr>
<tr class="field-even field"><th class="field-name">name:</th><td class="field-body">an internal name used to identify the search option; defaults to the slugified form of the label.</td>
</tr>
<tr class="field-odd field"><th class="field-name">url:</th><td class="field-body">the URL of the target search page.</td>
</tr>
<tr class="field-even field"><th class="field-name">classnames:</th><td class="field-body">arbitrary CSS classnames applied to the link</td>
</tr>
<tr class="field-odd field"><th class="field-name">icon_name:</th><td class="field-body">icon to display next to the label.</td>
</tr>
<tr class="field-even field"><th class="field-name">attrs:</th><td class="field-body">additional HTML attributes to apply to the link.</td>
</tr>
<tr class="field-odd field"><th class="field-name">order:</th><td class="field-body">an integer which determines the item’s position in the list of options.</td>
</tr>
</tbody>
</table>
<p>Setting the URL can be achieved using reverse() on the target search page. The GET parameter ‘q’ will be appended to the given URL.</p>
<p>A template tag, <code class="docutils literal notranslate"><span class="pre">search_other</span></code> is provided by the <code class="docutils literal notranslate"><span class="pre">wagtailadmin_tags</span></code> template module. This tag takes a single, optional parameter, <code class="docutils literal notranslate"><span class="pre">current</span></code>, which allows you to specify the <code class="docutils literal notranslate"><span class="pre">name</span></code> of the search option currently active. If the parameter is not given, the hook defaults to a reverse lookup of the page’s URL for comparison against the <code class="docutils literal notranslate"><span class="pre">url</span></code> parameter.</p>
<p><code class="docutils literal notranslate"><span class="pre">SearchArea</span></code> can be subclassed to customise the HTML output, specify JavaScript files required by the option, or conditionally show or hide the item for specific requests (for example, to apply permission checks); see the source code (<code class="docutils literal notranslate"><span class="pre">wagtail/admin/search.py</span></code>) for details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.search</span> <span class="kn">import</span> <span class="n">SearchArea</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_admin_search_area&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_frank_search_area</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">SearchArea</span><span class="p">(</span><span class="s1">&#39;Frank&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;frank&#39;</span><span class="p">),</span> <span class="n">icon_name</span><span class="o">=</span><span class="s1">&#39;folder-inverse&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="register-permissions">
<span id="id14"></span><h6><code class="docutils literal notranslate"><span class="pre">register_permissions</span></code><a class="headerlink" href="#register-permissions" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Return a QuerySet of <code class="docutils literal notranslate"><span class="pre">Permission</span></code> objects to be shown in the Groups administration area.</div></blockquote>
</div>
<div class="section" id="filter-form-submissions-for-user">
<span id="id15"></span><h6><code class="docutils literal notranslate"><span class="pre">filter_form_submissions_for_user</span></code><a class="headerlink" href="#filter-form-submissions-for-user" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Allows access to form submissions to be customised on a per-user, per-form basis.</p>
<dl class="docutils">
<dt>This hook takes two parameters:</dt>
<dd><ul class="first last simple">
<li>The user attempting to access form submissions</li>
<li>A <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> of form pages</li>
</ul>
</dd>
</dl>
<p>The hook must return a <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> containing a subset of these form pages which the user is allowed to access the submissions for.</p>
<p>For example, to prevent non-superusers from accessing form submissions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>


<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;filter_form_submissions_for_user&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">construct_forms_for_user</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_superuser</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">queryset</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="editor-interface">
<h5>Editor interface<a class="headerlink" href="#editor-interface" title="Permalink to this headline">¶</a></h5>
<p>Hooks for customising the editing interface for pages and snippets.</p>
<div class="section" id="register-rich-text-features">
<span id="id16"></span><h6><code class="docutils literal notranslate"><span class="pre">register_rich_text_features</span></code><a class="headerlink" href="#register-rich-text-features" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Rich text fields in Wagtail work with a list of ‘feature’ identifiers that determine which editing controls are available in the editor, and which elements are allowed in the output; for example, a rich text field defined as <code class="docutils literal notranslate"><span class="pre">RichTextField(features=['h2',</span> <span class="pre">'h3',</span> <span class="pre">'bold',</span> <span class="pre">'italic',</span> <span class="pre">'link'])</span></code> would allow headings, bold / italic formatting and links, but not (for example) bullet lists or images. The <code class="docutils literal notranslate"><span class="pre">register_rich_text_features</span></code> hook allows new feature identifiers to be defined - see <a class="reference internal" href="index.html#rich-text-features"><span class="std std-ref">Limiting features in a rich text field</span></a> for details.</div></blockquote>
</div>
<div class="section" id="insert-editor-css">
<span id="id17"></span><h6><code class="docutils literal notranslate"><span class="pre">insert_editor_css</span></code><a class="headerlink" href="#insert-editor-css" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add additional CSS files or snippets to the page editor.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.templatetags.static</span> <span class="kn">import</span> <span class="n">static</span>
<span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;insert_editor_css&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">editor_css</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span>
        <span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; href=&quot;</span><span class="si">{}</span><span class="s1">&quot;&gt;&#39;</span><span class="p">,</span>
        <span class="n">static</span><span class="p">(</span><span class="s1">&#39;demo/css/vendor/font-awesome/css/font-awesome.min.css&#39;</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="insert-global-admin-css">
<span id="id18"></span><h6><code class="docutils literal notranslate"><span class="pre">insert_global_admin_css</span></code><a class="headerlink" href="#insert-global-admin-css" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add additional CSS files or snippets to all admin pages.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>
<span class="kn">from</span> <span class="nn">django.templatetags.static</span> <span class="kn">import</span> <span class="n">static</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;insert_global_admin_css&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">global_admin_css</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; href=&quot;</span><span class="si">{}</span><span class="s1">&quot;&gt;&#39;</span><span class="p">,</span> <span class="n">static</span><span class="p">(</span><span class="s1">&#39;my/wagtail/theme.css&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="insert-editor-js">
<span id="id19"></span><h6><code class="docutils literal notranslate"><span class="pre">insert_editor_js</span></code><a class="headerlink" href="#insert-editor-js" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add additional JavaScript files or code snippets to the page editor.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span><span class="p">,</span> <span class="n">format_html_join</span>
<span class="kn">from</span> <span class="nn">django.templatetags.static</span> <span class="kn">import</span> <span class="n">static</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;insert_editor_js&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">editor_js</span><span class="p">():</span>
    <span class="n">js_files</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;demo/js/jquery.raptorize.1.0.js&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">js_includes</span> <span class="o">=</span> <span class="n">format_html_join</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;script src=&quot;</span><span class="si">{0}</span><span class="s1">&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">,</span>
        <span class="p">((</span><span class="n">static</span><span class="p">(</span><span class="n">filename</span><span class="p">),)</span> <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">js_files</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># remember to use double &#39;{{&#39; so they are not parsed as template placeholders</span>
    <span class="k">return</span> <span class="n">js_includes</span> <span class="o">+</span> <span class="n">format_html</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &lt;script&gt;</span>
<span class="sd">            $(function() {{</span>
<span class="sd">                $(&#39;button&#39;).raptorize();</span>
<span class="sd">            }});</span>
<span class="sd">        &lt;/script&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="insert-global-admin-js">
<span id="id20"></span><h6><code class="docutils literal notranslate"><span class="pre">insert_global_admin_js</span></code><a class="headerlink" href="#insert-global-admin-js" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add additional JavaScript files or code snippets to all admin pages.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;insert_global_admin_js&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">global_admin_js</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span>
        <span class="s1">&#39;&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/three.js/r74/three.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="editor-workflow">
<h5>Editor workflow<a class="headerlink" href="#editor-workflow" title="Permalink to this headline">¶</a></h5>
<p>Hooks for customising the way users are directed through the process of creating page content.</p>
<div class="section" id="after-create-page">
<span id="id21"></span><h6><code class="docutils literal notranslate"><span class="pre">after_create_page</span></code><a class="headerlink" href="#after-create-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Do something with a <code class="docutils literal notranslate"><span class="pre">Page</span></code> object after it has been saved to the database (as a published page or a revision). The callable passed to this hook should take a <code class="docutils literal notranslate"><span class="pre">request</span></code> object and a <code class="docutils literal notranslate"><span class="pre">page</span></code> object. The function does not have to return anything, but if an object with a <code class="docutils literal notranslate"><span class="pre">status_code</span></code> property is returned, Wagtail will use it as a response object. By default, Wagtail will instead redirect to the Explorer page for the new page’s parent.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;after_create_page&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_after_page_create</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;Congrats on making content!&quot;</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you set attributes on a <code class="docutils literal notranslate"><span class="pre">Page</span></code> object, you should also call <code class="docutils literal notranslate"><span class="pre">save_revision()</span></code>, since the edit and index view pick up their data from the revisions table rather than the actual saved page record.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;after_create_page&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_attribute_after_page_create</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>
   <span class="n">page</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Persistent Title&#39;</span>
   <span class="n">new_revision</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">save_revision</span><span class="p">()</span>
   <span class="k">if</span> <span class="n">page</span><span class="o">.</span><span class="n">live</span><span class="p">:</span>
       <span class="c1"># page has been created and published at the same time,</span>
       <span class="c1"># so ensure that the updated title is on the published version too</span>
       <span class="n">new_revision</span><span class="o">.</span><span class="n">publish</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="before-create-page">
<span id="id22"></span><h6><code class="docutils literal notranslate"><span class="pre">before_create_page</span></code><a class="headerlink" href="#before-create-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called at the beginning of the “create page” view passing in the request, the parent page and page model class.</p>
<p>The function does not have to return anything, but if an object with a <code class="docutils literal notranslate"><span class="pre">status_code</span></code> property is returned, Wagtail will use it as a response object and skip the rest of the view.</p>
<p>Unlike, <code class="docutils literal notranslate"><span class="pre">after_create_page</span></code>, this is run both for both <code class="docutils literal notranslate"><span class="pre">GET</span></code> and <code class="docutils literal notranslate"><span class="pre">POST</span></code> requests.</p>
<p>This can be used to completely override the editor on a per-view basis:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">AwesomePage</span>
<span class="kn">from</span> <span class="nn">.admin_views</span> <span class="kn">import</span> <span class="n">edit_awesome_page</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;before_create_page&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">before_create_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">parent_page</span><span class="p">,</span> <span class="n">page_class</span><span class="p">):</span>
    <span class="c1"># Use a custom create view for the AwesomePage model</span>
    <span class="k">if</span> <span class="n">page_class</span> <span class="o">==</span> <span class="n">AwesomePage</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">create_awesome_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">parent_page</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="after-delete-page">
<span id="id23"></span><h6><code class="docutils literal notranslate"><span class="pre">after_delete_page</span></code><a class="headerlink" href="#after-delete-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Do something after a <code class="docutils literal notranslate"><span class="pre">Page</span></code> object is deleted. Uses the same behaviour as <code class="docutils literal notranslate"><span class="pre">after_create_page</span></code>.</div></blockquote>
</div>
<div class="section" id="before-delete-page">
<span id="id24"></span><h6><code class="docutils literal notranslate"><span class="pre">before_delete_page</span></code><a class="headerlink" href="#before-delete-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called at the beginning of the “delete page” view passing in the request and the page object.</p>
<p>Uses the same behaviour as <code class="docutils literal notranslate"><span class="pre">before_create_page</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="after-edit-page">
<span id="id25"></span><h6><code class="docutils literal notranslate"><span class="pre">after_edit_page</span></code><a class="headerlink" href="#after-edit-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Do something with a <code class="docutils literal notranslate"><span class="pre">Page</span></code> object after it has been updated. Uses the same behaviour as <code class="docutils literal notranslate"><span class="pre">after_create_page</span></code>.</div></blockquote>
</div>
<div class="section" id="before-edit-page">
<span id="id26"></span><h6><code class="docutils literal notranslate"><span class="pre">before_edit_page</span></code><a class="headerlink" href="#before-edit-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called at the beginning of the “edit page” view passing in the request and the page object.</p>
<p>Uses the same behaviour as <code class="docutils literal notranslate"><span class="pre">before_create_page</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="after-publish-page">
<span id="id27"></span><h6><code class="docutils literal notranslate"><span class="pre">after_publish_page</span></code><a class="headerlink" href="#after-publish-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Do something with a <code class="docutils literal notranslate"><span class="pre">Page</span></code> object after it has been published via page create view or page edit view.</p>
<p>The function does not have to return anything, but if an object with a <code class="docutils literal notranslate"><span class="pre">status_code</span></code> property is returned, Wagtail will use it as a response object and skip the rest of the view.</p>
</div></blockquote>
</div>
<div class="section" id="before-publish-page">
<span id="id28"></span><h6><code class="docutils literal notranslate"><span class="pre">before_publish_page</span></code><a class="headerlink" href="#before-publish-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Do something with a <code class="docutils literal notranslate"><span class="pre">Page</span></code> object before it has been published via page create view or page edit view.</p>
<p>The function does not have to return anything, but if an object with a <code class="docutils literal notranslate"><span class="pre">status_code</span></code> property is returned, Wagtail will use it as a response object and skip the rest of the view.</p>
</div></blockquote>
</div>
<div class="section" id="after-unpublish-page">
<span id="id29"></span><h6><code class="docutils literal notranslate"><span class="pre">after_unpublish_page</span></code><a class="headerlink" href="#after-unpublish-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called after unpublish action in “unpublish” view passing in the request and the page object.</p>
<p>The function does not have to return anything, but if an object with a <code class="docutils literal notranslate"><span class="pre">status_code</span></code> property is returned, Wagtail will use it as a response object and skip the rest of the view.</p>
</div></blockquote>
</div>
<div class="section" id="before-unpublish-page">
<span id="id30"></span><h6><code class="docutils literal notranslate"><span class="pre">before_unpublish_page</span></code><a class="headerlink" href="#before-unpublish-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called before unpublish action in “unpublish” view passing in the request and the page object.</p>
<p>The function does not have to return anything, but if an object with a <code class="docutils literal notranslate"><span class="pre">status_code</span></code> property is returned, Wagtail will use it as a response object and skip the rest of the view.</p>
</div></blockquote>
</div>
<div class="section" id="after-copy-page">
<span id="id31"></span><h6><code class="docutils literal notranslate"><span class="pre">after_copy_page</span></code><a class="headerlink" href="#after-copy-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Do something with a <code class="docutils literal notranslate"><span class="pre">Page</span></code> object after it has been copied passing in the request, page object and the new copied page. Uses the same behaviour as <code class="docutils literal notranslate"><span class="pre">after_create_page</span></code>.</div></blockquote>
</div>
<div class="section" id="before-copy-page">
<span id="id32"></span><h6><code class="docutils literal notranslate"><span class="pre">before_copy_page</span></code><a class="headerlink" href="#before-copy-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called at the beginning of the “copy page” view passing in the request and the page object.</p>
<p>Uses the same behaviour as <code class="docutils literal notranslate"><span class="pre">before_create_page</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="after-move-page">
<span id="id33"></span><h6><code class="docutils literal notranslate"><span class="pre">after_move_page</span></code><a class="headerlink" href="#after-move-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Do something with a <code class="docutils literal notranslate"><span class="pre">Page</span></code> object after it has been moved passing in the request and page object. Uses the same behaviour as <code class="docutils literal notranslate"><span class="pre">after_create_page</span></code>.</div></blockquote>
</div>
<div class="section" id="before-move-page">
<span id="id34"></span><h6><code class="docutils literal notranslate"><span class="pre">before_move_page</span></code><a class="headerlink" href="#before-move-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called at the beginning of the “move page” view passing in the request, the page object and the destination page object.</p>
<p>Uses the same behaviour as <code class="docutils literal notranslate"><span class="pre">before_create_page</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="before-convert-alias-page">
<span id="id35"></span><h6><code class="docutils literal notranslate"><span class="pre">before_convert_alias_page</span></code><a class="headerlink" href="#before-convert-alias-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called at the beginning of the <code class="docutils literal notranslate"><span class="pre">convert_alias</span></code> view, which is responsible for converting alias pages into normal Wagtail pages.</p>
<p>The request and the page being converted are passed in as arguments to the hook.</p>
<p>The function does not have to return anything, but if an object with a <code class="docutils literal notranslate"><span class="pre">status_code</span></code> property is returned, Wagtail will use it as a response object and skip the rest of the view.</p>
</div></blockquote>
</div>
<div class="section" id="after-convert-alias-page">
<span id="id36"></span><h6><code class="docutils literal notranslate"><span class="pre">after_convert_alias_page</span></code><a class="headerlink" href="#after-convert-alias-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Do something with a <code class="docutils literal notranslate"><span class="pre">Page</span></code> object after it has been converted from an alias.</p>
<p>The request and the page that was just converted are passed in as arguments to the hook.</p>
<p>The function does not have to return anything, but if an object with a <code class="docutils literal notranslate"><span class="pre">status_code</span></code> property is returned, Wagtail will use it as a response object and skip the rest of the view.</p>
</div></blockquote>
</div>
<div class="section" id="register-page-action-menu-item">
<span id="id37"></span><h6><code class="docutils literal notranslate"><span class="pre">register_page_action_menu_item</span></code><a class="headerlink" href="#register-page-action-menu-item" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add an item to the popup menu of actions on the page creation and edit views. The callable passed to this hook must return an instance of <code class="docutils literal notranslate"><span class="pre">wagtail.admin.action_menu.ActionMenuItem</span></code>. <code class="docutils literal notranslate"><span class="pre">ActionMenuItem</span></code> is a subclass of <a class="reference internal" href="index.html#creating-template-components"><span class="std std-ref">Component</span></a> and so the rendering of the menu item can be customised through <code class="docutils literal notranslate"><span class="pre">template_name</span></code>, <code class="docutils literal notranslate"><span class="pre">get_context_data</span></code>, <code class="docutils literal notranslate"><span class="pre">render_html</span></code> and <code class="docutils literal notranslate"><span class="pre">Media</span></code>. In addition, the following attributes and methods are available to be overridden:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">order:</th><td class="field-body">an integer (default 100) which determines the item’s position in the menu. Can also be passed as a keyword argument to the object constructor. The lowest-numbered item in this sequence will be selected as the default menu item; as standard, this is “Save draft” (which has an <code class="docutils literal notranslate"><span class="pre">order</span></code> of 0).</td>
</tr>
<tr class="field-even field"><th class="field-name">label:</th><td class="field-body">the displayed text of the menu item</td>
</tr>
<tr class="field-odd field"><th class="field-name">get_url:</th><td class="field-body">a method which returns a URL for the menu item to link to; by default, returns <code class="docutils literal notranslate"><span class="pre">None</span></code> which causes the menu item to behave as a form submit button instead</td>
</tr>
<tr class="field-even field"><th class="field-name">name:</th><td class="field-body">value of the <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute of the submit button, if no URL is specified</td>
</tr>
<tr class="field-odd field"><th class="field-name">icon_name:</th><td class="field-body">icon to display against the menu item</td>
</tr>
<tr class="field-even field"><th class="field-name">classname:</th><td class="field-body">a <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute value to add to the button element</td>
</tr>
<tr class="field-odd field"><th class="field-name">is_shown:</th><td class="field-body">a method which returns a boolean indicating whether the menu item should be shown; by default, true except when editing a locked page</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">get_url</span></code>, <code class="docutils literal notranslate"><span class="pre">is_shown</span></code>, <code class="docutils literal notranslate"><span class="pre">get_context_data</span></code> and <code class="docutils literal notranslate"><span class="pre">render_html</span></code> methods all accept a context dictionary containing the following fields:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">view:</th><td class="field-body">name of the current view: <code class="docutils literal notranslate"><span class="pre">'create'</span></code>, <code class="docutils literal notranslate"><span class="pre">'edit'</span></code> or <code class="docutils literal notranslate"><span class="pre">'revisions_revert'</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">page:</th><td class="field-body">For <code class="docutils literal notranslate"><span class="pre">view</span></code> = <code class="docutils literal notranslate"><span class="pre">'edit'</span></code> or <code class="docutils literal notranslate"><span class="pre">'revisions_revert'</span></code>, the page being edited</td>
</tr>
<tr class="field-odd field"><th class="field-name">parent_page:</th><td class="field-body">For <code class="docutils literal notranslate"><span class="pre">view</span></code> = <code class="docutils literal notranslate"><span class="pre">'create'</span></code>, the parent page of the page being created</td>
</tr>
<tr class="field-even field"><th class="field-name">request:</th><td class="field-body">The current request object</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">user_page_permissions:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">a <code class="docutils literal notranslate"><span class="pre">UserPagePermissionsProxy</span></code> object for the current user, to test permissions against</td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.action_menu</span> <span class="kn">import</span> <span class="n">ActionMenuItem</span>

<span class="k">class</span> <span class="nc">GuacamoleMenuItem</span><span class="p">(</span><span class="n">ActionMenuItem</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;action-guacamole&#39;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Guacamole&quot;</span>

    <span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;https://www.youtube.com/watch?v=dNJdJIwCF_Y&quot;</span>


<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_page_action_menu_item&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_guacamole_menu_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">GuacamoleMenuItem</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="construct-page-action-menu">
<span id="id38"></span><h6><code class="docutils literal notranslate"><span class="pre">construct_page_action_menu</span></code><a class="headerlink" href="#construct-page-action-menu" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Modify the final list of action menu items on the page creation and edit views. The callable passed to this hook receives a list of <code class="docutils literal notranslate"><span class="pre">ActionMenuItem</span></code> objects, a request object and a context dictionary as per <code class="docutils literal notranslate"><span class="pre">register_page_action_menu_item</span></code>, and should modify the list of menu items in-place.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_page_action_menu&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">remove_submit_to_moderator_option</span><span class="p">(</span><span class="n">menu_items</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">menu_items</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">menu_items</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;action-submit&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">construct_page_action_menu</span></code> hook is called after the menu items have been sorted by their order attributes, and so setting a menu item’s order will have no effect at this point. Instead, items can be reordered by changing their position in the list, with the first item being selected as the default action. For example, to change the default action to Publish:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_page_action_menu&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">make_publish_default_action</span><span class="p">(</span><span class="n">menu_items</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">menu_items</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;action-publish&#39;</span><span class="p">:</span>
            <span class="c1"># move to top of list</span>
            <span class="n">menu_items</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">menu_items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="k">break</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="construct-page-listing-buttons">
<h6><code class="docutils literal notranslate"><span class="pre">construct_page_listing_buttons</span></code><a class="headerlink" href="#construct-page-listing-buttons" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Modify the final list of page listing buttons in the page explorer. The
callable passed to this hook receives a list of <code class="docutils literal notranslate"><span class="pre">PageListingButton</span></code> objects, a page,
a page perms object, and a context dictionary as per <code class="docutils literal notranslate"><span class="pre">register_page_listing_buttons</span></code>,
and should modify the list of listing items in-place.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_page_listing_buttons&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">remove_page_listing_button_item</span><span class="p">(</span><span class="n">buttons</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">page_perms</span><span class="p">,</span> <span class="n">is_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_parent</span><span class="p">:</span>
        <span class="n">buttons</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="c1"># removes the last &#39;more&#39; dropdown button on the parent page listing buttons</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="construct-wagtail-userbar">
<span id="id39"></span><h6><code class="docutils literal notranslate"><span class="pre">construct_wagtail_userbar</span></code><a class="headerlink" href="#construct-wagtail-userbar" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add or remove items from the wagtail userbar. Add, edit, and moderation tools are provided by default. The callable passed into the hook must take the <code class="docutils literal notranslate"><span class="pre">request</span></code> object and a list of menu objects, <code class="docutils literal notranslate"><span class="pre">items</span></code>. The menu item objects must have a <code class="docutils literal notranslate"><span class="pre">render</span></code> method which can take a <code class="docutils literal notranslate"><span class="pre">request</span></code> object and return the HTML string representing the menu item. See the userbar templates and menu item classes for more information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="k">class</span> <span class="nc">UserbarPuppyLinkItem</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;li&gt;&lt;a href=&quot;http://cuteoverload.com/tag/puppehs/&quot; &#39;</span> \
            <span class="o">+</span> <span class="s1">&#39;target=&quot;_parent&quot; role=&quot;menuitem&quot; class=&quot;action icon icon-wagtail&quot;&gt;Puppies!&lt;/a&gt;&lt;/li&gt;&#39;</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_wagtail_userbar&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_puppy_link_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">UserbarPuppyLinkItem</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="admin-workflow">
<h5>Admin workflow<a class="headerlink" href="#admin-workflow" title="Permalink to this headline">¶</a></h5>
<p>Hooks for customising the way admins are directed through the process of editing users.</p>
<div class="section" id="after-create-user">
<span id="id40"></span><h6><code class="docutils literal notranslate"><span class="pre">after_create_user</span></code><a class="headerlink" href="#after-create-user" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Do something with a <code class="docutils literal notranslate"><span class="pre">User</span></code> object after it has been saved to the database.  The callable passed to this hook should take a <code class="docutils literal notranslate"><span class="pre">request</span></code> object and a <code class="docutils literal notranslate"><span class="pre">user</span></code> object. The function does not have to return anything, but if an object with a <code class="docutils literal notranslate"><span class="pre">status_code</span></code> property is returned, Wagtail will use it as a response object. By default, Wagtail will instead redirect to the User index page.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;after_create_user&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_after_page_create</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;Congrats on creating a new user!&quot;</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="before-create-user">
<span id="id41"></span><h6><code class="docutils literal notranslate"><span class="pre">before_create_user</span></code><a class="headerlink" href="#before-create-user" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called at the beginning of the “create user” view passing in the request.</p>
<p>The function does not have to return anything, but if an object with a <code class="docutils literal notranslate"><span class="pre">status_code</span></code> property is returned, Wagtail will use it as a response object and skip the rest of the view.</p>
<p>Unlike, <code class="docutils literal notranslate"><span class="pre">after_create_user</span></code>, this is run both for both <code class="docutils literal notranslate"><span class="pre">GET</span></code> and <code class="docutils literal notranslate"><span class="pre">POST</span></code> requests.</p>
<p>This can be used to completely override the user editor on a per-view basis:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">AwesomePage</span>
<span class="kn">from</span> <span class="nn">.admin_views</span> <span class="kn">import</span> <span class="n">edit_awesome_page</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;before_create_user&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">before_create_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;A user creation form&quot;</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="after-delete-user">
<span id="id42"></span><h6><code class="docutils literal notranslate"><span class="pre">after_delete_user</span></code><a class="headerlink" href="#after-delete-user" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Do something after a <code class="docutils literal notranslate"><span class="pre">User</span></code> object is deleted. Uses the same behaviour as <code class="docutils literal notranslate"><span class="pre">after_create_user</span></code>.</div></blockquote>
</div>
<div class="section" id="before-delete-user">
<span id="id43"></span><h6><code class="docutils literal notranslate"><span class="pre">before_delete_user</span></code><a class="headerlink" href="#before-delete-user" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called at the beginning of the “delete user” view passing in the request and the user object.</p>
<p>Uses the same behaviour as <code class="docutils literal notranslate"><span class="pre">before_create_user</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="after-edit-user">
<span id="id44"></span><h6><code class="docutils literal notranslate"><span class="pre">after_edit_user</span></code><a class="headerlink" href="#after-edit-user" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Do something with a <code class="docutils literal notranslate"><span class="pre">User</span></code> object after it has been updated. Uses the same behaviour as <code class="docutils literal notranslate"><span class="pre">after_create_user</span></code>.</div></blockquote>
</div>
<div class="section" id="before-edit-user">
<span id="id45"></span><h6><code class="docutils literal notranslate"><span class="pre">before_edit_user</span></code><a class="headerlink" href="#before-edit-user" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called at the beginning of the “edit user” view passing in the request and the user object.</p>
<p>Uses the same behaviour as <code class="docutils literal notranslate"><span class="pre">before_create_user</span></code>.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="choosers">
<h5>Choosers<a class="headerlink" href="#choosers" title="Permalink to this headline">¶</a></h5>
<div class="section" id="construct-page-chooser-queryset">
<span id="id46"></span><h6><code class="docutils literal notranslate"><span class="pre">construct_page_chooser_queryset</span></code><a class="headerlink" href="#construct-page-chooser-queryset" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called when rendering the page chooser view, to allow the page listing QuerySet to be customised. The callable passed into the hook will receive the current page QuerySet and the request object, and must return a Page QuerySet (either the original one, or a new one).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_page_chooser_queryset&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_my_pages_only</span><span class="p">(</span><span class="n">pages</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="c1"># Only show own pages</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="n">pages</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pages</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="construct-document-chooser-queryset">
<span id="id47"></span><h6><code class="docutils literal notranslate"><span class="pre">construct_document_chooser_queryset</span></code><a class="headerlink" href="#construct-document-chooser-queryset" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called when rendering the document chooser view, to allow the document listing QuerySet to be customised. The callable passed into the hook will receive the current document QuerySet and the request object, and must return a Document QuerySet (either the original one, or a new one).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_document_chooser_queryset&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_my_uploaded_documents_only</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="c1"># Only show uploaded documents</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">uploaded_by_user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">documents</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="construct-image-chooser-queryset">
<span id="id48"></span><h6><code class="docutils literal notranslate"><span class="pre">construct_image_chooser_queryset</span></code><a class="headerlink" href="#construct-image-chooser-queryset" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called when rendering the image chooser view, to allow the image listing QuerySet to be customised. The callable passed into the hook will receive the current image QuerySet and the request object, and must return an Image QuerySet (either the original one, or a new one).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_image_chooser_queryset&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_my_uploaded_images_only</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="c1"># Only show uploaded images</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">uploaded_by_user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">images</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="page-explorer">
<h5>Page explorer<a class="headerlink" href="#page-explorer" title="Permalink to this headline">¶</a></h5>
<div class="section" id="construct-explorer-page-queryset">
<span id="id49"></span><h6><code class="docutils literal notranslate"><span class="pre">construct_explorer_page_queryset</span></code><a class="headerlink" href="#construct-explorer-page-queryset" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called when rendering the page explorer view, to allow the page listing QuerySet to be customised. The callable passed into the hook will receive the parent page object, the current page QuerySet, and the request object, and must return a Page QuerySet (either the original one, or a new one).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_explorer_page_queryset&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_my_profile_only</span><span class="p">(</span><span class="n">parent_page</span><span class="p">,</span> <span class="n">pages</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="c1"># If we&#39;re in the &#39;user-profiles&#39; section, only show the user&#39;s own profile</span>
    <span class="k">if</span> <span class="n">parent_page</span><span class="o">.</span><span class="n">slug</span> <span class="o">==</span> <span class="s1">&#39;user-profiles&#39;</span><span class="p">:</span>
        <span class="n">pages</span> <span class="o">=</span> <span class="n">pages</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pages</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="register-page-listing-buttons">
<span id="id50"></span><h6><code class="docutils literal notranslate"><span class="pre">register_page_listing_buttons</span></code><a class="headerlink" href="#register-page-listing-buttons" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add buttons to the actions list for a page in the page explorer. This is useful when adding custom actions to the listing, such as translations or a complex workflow.</p>
<p>This example will add a simple button to the listing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin</span> <span class="kn">import</span> <span class="n">widgets</span> <span class="k">as</span> <span class="n">wagtailadmin_widgets</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_page_listing_buttons&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_listing_buttons</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">page_perms</span><span class="p">,</span> <span class="n">is_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">next_url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">wagtailadmin_widgets</span><span class="o">.</span><span class="n">PageListingButton</span><span class="p">(</span>
        <span class="s1">&#39;A page listing button&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/goes/to/a/url/&#39;</span><span class="p">,</span>
        <span class="n">priority</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The arguments passed to the hook are as follows:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">page</span></code> - the page object to generate the button for</li>
<li><code class="docutils literal notranslate"><span class="pre">page_perms</span></code> - a <code class="docutils literal notranslate"><span class="pre">PagePermissionTester</span></code> object that can be queried to determine the current user’s permissions on the given page</li>
<li><code class="docutils literal notranslate"><span class="pre">is_parent</span></code> - if true, this button is being rendered for the parent page being displayed at the top of the listing</li>
<li><code class="docutils literal notranslate"><span class="pre">next_url</span></code> - the URL that the linked action should redirect back to on completion of the action, if the view supports it</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">priority</span></code> argument controls the order the buttons are displayed in. Buttons are ordered from low to high priority, so a button with <code class="docutils literal notranslate"><span class="pre">priority=10</span></code> will be displayed before a button with <code class="docutils literal notranslate"><span class="pre">priority=20</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="register-page-listing-more-buttons">
<h6><code class="docutils literal notranslate"><span class="pre">register_page_listing_more_buttons</span></code><a class="headerlink" href="#register-page-listing-more-buttons" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add buttons to the “More” dropdown menu for a page in the page explorer. This works similarly to the <code class="docutils literal notranslate"><span class="pre">register_page_listing_buttons</span></code> hook but is useful for lesser-used custom actions that are better suited for the dropdown.</p>
<p>This example will add a simple button to the dropdown menu:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin</span> <span class="kn">import</span> <span class="n">widgets</span> <span class="k">as</span> <span class="n">wagtailadmin_widgets</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_page_listing_more_buttons&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_listing_more_buttons</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">page_perms</span><span class="p">,</span> <span class="n">is_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">next_url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">wagtailadmin_widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
        <span class="s1">&#39;A dropdown button&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/goes/to/a/url/&#39;</span><span class="p">,</span>
        <span class="n">priority</span><span class="o">=</span><span class="mi">60</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The arguments passed to the hook are as follows:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">page</span></code> - the page object to generate the button for</li>
<li><code class="docutils literal notranslate"><span class="pre">page_perms</span></code> - a <code class="docutils literal notranslate"><span class="pre">PagePermissionTester</span></code> object that can be queried to determine the current user’s permissions on the given page</li>
<li><code class="docutils literal notranslate"><span class="pre">is_parent</span></code> - if true, this button is being rendered for the parent page being displayed at the top of the listing</li>
<li><code class="docutils literal notranslate"><span class="pre">next_url</span></code> - the URL that the linked action should redirect back to on completion of the action, if the view supports it</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">priority</span></code> argument controls the order the buttons are displayed in the dropdown. Buttons are ordered from low to high priority, so a button with <code class="docutils literal notranslate"><span class="pre">priority=10</span></code> will be displayed before a button with <code class="docutils literal notranslate"><span class="pre">priority=60</span></code>.</p>
</div></blockquote>
<div class="section" id="buttons-with-dropdown-lists">
<h7>Buttons with dropdown lists<a class="headerlink" href="#buttons-with-dropdown-lists" title="Permalink to this headline">¶</a></h7>
<blockquote>
<div><p>The admin widgets also provide <code class="docutils literal notranslate"><span class="pre">ButtonWithDropdownFromHook</span></code>, which allows you to define a custom hook for generating a dropdown menu that gets attached to your button.</p>
<p>Creating a button with a dropdown menu involves two steps. Firstly, you add your button to the <code class="docutils literal notranslate"><span class="pre">register_page_listing_buttons</span></code> hook, just like the example above.
Secondly, you register a new hook that yields the contents of the dropdown menu.</p>
<p>This example shows how Wagtail’s default admin dropdown is implemented. You can also see how to register buttons conditionally, in this case by evaluating the <code class="docutils literal notranslate"><span class="pre">page_perms</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin</span> <span class="kn">import</span> <span class="n">widgets</span> <span class="k">as</span> <span class="n">wagtailadmin_widgets</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_page_listing_buttons&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_custom_listing_buttons</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">page_perms</span><span class="p">,</span> <span class="n">is_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">next_url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">wagtailadmin_widgets</span><span class="o">.</span><span class="n">ButtonWithDropdownFromHook</span><span class="p">(</span>
        <span class="s1">&#39;More actions&#39;</span><span class="p">,</span>
        <span class="n">hook_name</span><span class="o">=</span><span class="s1">&#39;my_button_dropdown_hook&#39;</span><span class="p">,</span>
        <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
        <span class="n">page_perms</span><span class="o">=</span><span class="n">page_perms</span><span class="p">,</span>
        <span class="n">is_parent</span><span class="o">=</span><span class="n">is_parent</span><span class="p">,</span>
        <span class="n">next_url</span><span class="o">=</span><span class="n">next_url</span><span class="p">,</span>
        <span class="n">priority</span><span class="o">=</span><span class="mi">50</span>
    <span class="p">)</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;my_button_dropdown_hook&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_custom_listing_more_buttons</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">page_perms</span><span class="p">,</span> <span class="n">is_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">next_url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">page_perms</span><span class="o">.</span><span class="n">can_move</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">wagtailadmin_widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Move&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;wagtailadmin_pages:move&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">page</span><span class="o">.</span><span class="n">id</span><span class="p">]),</span> <span class="n">priority</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">page_perms</span><span class="o">.</span><span class="n">can_delete</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">wagtailadmin_widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Delete&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;wagtailadmin_pages:delete&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">page</span><span class="o">.</span><span class="n">id</span><span class="p">]),</span> <span class="n">priority</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">page_perms</span><span class="o">.</span><span class="n">can_unpublish</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">wagtailadmin_widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Unpublish&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;wagtailadmin_pages:unpublish&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">page</span><span class="o">.</span><span class="n">id</span><span class="p">]),</span> <span class="n">priority</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
<p>The template for the dropdown button can be customised by overriding <code class="docutils literal notranslate"><span class="pre">wagtailadmin/pages/listing/_button_with_dropdown.html</span></code>. The JavaScript that runs the dropdowns makes use of custom data attributes, so you should leave <code class="docutils literal notranslate"><span class="pre">data-dropdown</span></code> and <code class="docutils literal notranslate"><span class="pre">data-dropdown-toggle</span></code> in the markup if you customise it.</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="page-serving">
<h5>Page serving<a class="headerlink" href="#page-serving" title="Permalink to this headline">¶</a></h5>
<div class="section" id="before-serve-page">
<span id="id51"></span><h6><code class="docutils literal notranslate"><span class="pre">before_serve_page</span></code><a class="headerlink" href="#before-serve-page" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called when Wagtail is about to serve a page. The callable passed into the hook will receive the page object, the request object, and the <code class="docutils literal notranslate"><span class="pre">args</span></code> and <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> that will be passed to the page’s <code class="docutils literal notranslate"><span class="pre">serve()</span></code> method. If the callable returns an <code class="docutils literal notranslate"><span class="pre">HttpResponse</span></code>, that response will be returned immediately to the user, and Wagtail will not proceed to call <code class="docutils literal notranslate"><span class="pre">serve()</span></code> on the page.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;before_serve_page&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">block_googlebot</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">serve_args</span><span class="p">,</span> <span class="n">serve_kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_USER_AGENT&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;GoogleBot&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;&lt;h1&gt;bad googlebot no cookie&lt;/h1&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="document-serving">
<h5>Document serving<a class="headerlink" href="#document-serving" title="Permalink to this headline">¶</a></h5>
<div class="section" id="before-serve-document">
<span id="id52"></span><h6><code class="docutils literal notranslate"><span class="pre">before_serve_document</span></code><a class="headerlink" href="#before-serve-document" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Called when Wagtail is about to serve a document. The callable passed into the hook will receive the document object and the request object. If the callable returns an <code class="docutils literal notranslate"><span class="pre">HttpResponse</span></code>, that response will be returned immediately to the user, instead of serving the document. Note that this hook will be skipped if the <a class="reference internal" href="index.html#wagtaildocs-serve-method"><span class="std std-ref">WAGTAILDOCS_SERVE_METHOD</span></a> setting is set to <code class="docutils literal notranslate"><span class="pre">direct</span></code>.</div></blockquote>
</div>
</div>
<div class="section" id="snippets">
<h5>Snippets<a class="headerlink" href="#snippets" title="Permalink to this headline">¶</a></h5>
<p>Hooks for working with registered Snippets.</p>
<div class="section" id="after-edit-snippet">
<span id="id53"></span><h6><code class="docutils literal notranslate"><span class="pre">after_edit_snippet</span></code><a class="headerlink" href="#after-edit-snippet" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called when a Snippet is edited. The callable passed into the hook will receive the model instance, the request object. If the callable returns an <code class="docutils literal notranslate"><span class="pre">HttpResponse</span></code>, that response will be returned immediately to the user, and Wagtail will not proceed to call <code class="docutils literal notranslate"><span class="pre">redirect()</span></code> to the listing view.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;after_edit_snippet&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">after_snippet_update</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Congrats on editing a snippet with id </span><span class="si">{</span><span class="n">instance</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="before-edit-snippet">
<span id="id54"></span><h6><code class="docutils literal notranslate"><span class="pre">before_edit_snippet</span></code><a class="headerlink" href="#before-edit-snippet" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called at the beginning of the edit snippet view. The callable passed into the hook will receive the model instance, the request object. If the callable returns an <code class="docutils literal notranslate"><span class="pre">HttpResponse</span></code>, that response will be returned immediately to the user, and Wagtail will not proceed to call <code class="docutils literal notranslate"><span class="pre">redirect()</span></code> to the listing view.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;before_edit_snippet&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">block_snippet_edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">RestrictedSnippet</span><span class="p">)</span> <span class="ow">and</span> <span class="n">instance</span><span class="o">.</span><span class="n">prevent_edit</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;Sorry, you can&#39;t edit this snippet&quot;</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="after-create-snippet">
<span id="id55"></span><h6><code class="docutils literal notranslate"><span class="pre">after_create_snippet</span></code><a class="headerlink" href="#after-create-snippet" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Called when a Snippet is created. <code class="docutils literal notranslate"><span class="pre">after_create_snippet</span></code> and
<code class="docutils literal notranslate"><span class="pre">after_edit_snippet</span></code> work in identical ways. The only difference is where
the hook is called.</div></blockquote>
</div>
<div class="section" id="before-create-snippet">
<span id="id56"></span><h6><code class="docutils literal notranslate"><span class="pre">before_create_snippet</span></code><a class="headerlink" href="#before-create-snippet" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div>Called at the beginning of the create snippet view. Works in a similar way to <cite>before_edit_snippet</cite> except the model is passed as an argument instead of an instance.</div></blockquote>
</div>
<div class="section" id="after-delete-snippet">
<span id="id57"></span><h6><code class="docutils literal notranslate"><span class="pre">after_delete_snippet</span></code><a class="headerlink" href="#after-delete-snippet" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called when a Snippet is deleted. The callable passed into the hook will receive the model instance(s) as a queryset along with the request object. If the callable returns an <code class="docutils literal notranslate"><span class="pre">HttpResponse</span></code>, that response will be returned immediately to the user, and Wagtail will not proceed to call <code class="docutils literal notranslate"><span class="pre">redirect()</span></code> to the listing view.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;after_delete_snippet&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">after_snippet_delete</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">instances</span><span class="p">):</span>
    <span class="c1"># &quot;instances&quot; is a QuerySet</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2"> snippets have been deleted&quot;</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="before-delete-snippet">
<span id="id58"></span><h6><code class="docutils literal notranslate"><span class="pre">before_delete_snippet</span></code><a class="headerlink" href="#before-delete-snippet" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Called at the beginning of the delete snippet view. The callable passed into the hook will receive the model instance(s) as a queryset along with the request object. If the callable returns an <code class="docutils literal notranslate"><span class="pre">HttpResponse</span></code>, that response will be returned immediately to the user, and Wagtail will not proceed to call <code class="docutils literal notranslate"><span class="pre">redirect()</span></code> to the listing view.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;before_delete_snippet&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">before_snippet_delete</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">instances</span><span class="p">):</span>
    <span class="c1"># &quot;instances&quot; is a QuerySet</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
      <span class="c1"># Override the deletion behaviour</span>
      <span class="n">instances</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

      <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2"> snippets have been deleted&quot;</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="register-snippet-action-menu-item">
<span id="id59"></span><h6><code class="docutils literal notranslate"><span class="pre">register_snippet_action_menu_item</span></code><a class="headerlink" href="#register-snippet-action-menu-item" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add an item to the popup menu of actions on the snippet creation and edit views.
The callable passed to this hook must return an instance of
<code class="docutils literal notranslate"><span class="pre">wagtail.snippets.action_menu.ActionMenuItem</span></code>. <code class="docutils literal notranslate"><span class="pre">ActionMenuItem</span></code> is a subclass of <a class="reference internal" href="index.html#creating-template-components"><span class="std std-ref">Component</span></a> and so the rendering of the menu item can be customised through <code class="docutils literal notranslate"><span class="pre">template_name</span></code>, <code class="docutils literal notranslate"><span class="pre">get_context_data</span></code>, <code class="docutils literal notranslate"><span class="pre">render_html</span></code> and <code class="docutils literal notranslate"><span class="pre">Media</span></code>. In addition, the following attributes and methods are available to be overridden:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">order:</th><td class="field-body">an integer (default 100) which determines the item’s position in the menu. Can also be passed as a keyword argument to the object constructor. The lowest-numbered item in this sequence will be selected as the default menu item; as standard, this is “Save draft” (which has an <code class="docutils literal notranslate"><span class="pre">order</span></code> of 0).</td>
</tr>
<tr class="field-even field"><th class="field-name">label:</th><td class="field-body">the displayed text of the menu item</td>
</tr>
<tr class="field-odd field"><th class="field-name">get_url:</th><td class="field-body">a method which returns a URL for the menu item to link to; by default, returns <code class="docutils literal notranslate"><span class="pre">None</span></code> which causes the menu item to behave as a form submit button instead</td>
</tr>
<tr class="field-even field"><th class="field-name">name:</th><td class="field-body">value of the <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute of the submit button if no URL is specified</td>
</tr>
<tr class="field-odd field"><th class="field-name">icon_name:</th><td class="field-body">icon to display against the menu item</td>
</tr>
<tr class="field-even field"><th class="field-name">classname:</th><td class="field-body">a <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute value to add to the button element</td>
</tr>
<tr class="field-odd field"><th class="field-name">is_shown:</th><td class="field-body">a method which returns a boolean indicating whether the menu item should be shown; by default, true except when editing a locked page</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">get_url</span></code>, <code class="docutils literal notranslate"><span class="pre">is_shown</span></code>, <code class="docutils literal notranslate"><span class="pre">get_context_data</span></code> and <code class="docutils literal notranslate"><span class="pre">render_html</span></code> methods all accept a context dictionary containing the following fields:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">view:</th><td class="field-body">name of the current view: <code class="docutils literal notranslate"><span class="pre">'create'</span></code> or <code class="docutils literal notranslate"><span class="pre">'edit'</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">model:</th><td class="field-body">The snippet’s model class</td>
</tr>
<tr class="field-odd field"><th class="field-name">instance:</th><td class="field-body">For <code class="docutils literal notranslate"><span class="pre">view</span></code> = <code class="docutils literal notranslate"><span class="pre">'edit'</span></code>, the instance being edited</td>
</tr>
<tr class="field-even field"><th class="field-name">request:</th><td class="field-body">The current request object</td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">wagtail.snippets.action_menu</span> <span class="kn">import</span> <span class="n">ActionMenuItem</span>

<span class="k">class</span> <span class="nc">GuacamoleMenuItem</span><span class="p">(</span><span class="n">ActionMenuItem</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;action-guacamole&#39;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Guacamole&quot;</span>

    <span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;https://www.youtube.com/watch?v=dNJdJIwCF_Y&quot;</span>


<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_snippet_action_menu_item&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_guacamole_menu_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">GuacamoleMenuItem</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="construct-snippet-action-menu">
<span id="id60"></span><h6><code class="docutils literal notranslate"><span class="pre">construct_snippet_action_menu</span></code><a class="headerlink" href="#construct-snippet-action-menu" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Modify the final list of action menu items on the snippet creation and edit views.
The callable passed to this hook receives a list of <code class="docutils literal notranslate"><span class="pre">ActionMenuItem</span></code> objects, a
request object and a context dictionary as per <code class="docutils literal notranslate"><span class="pre">register_snippet_action_menu_item</span></code>,
and should modify the list of menu items in-place.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_snippet_action_menu&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">remove_delete_option</span><span class="p">(</span><span class="n">menu_items</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">menu_items</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">menu_items</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;delete&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">construct_snippet_action_menu</span></code> hook is called after the menu items have been
sorted by their order attributes, and so setting a menu item’s order will have no
effect at this point. Instead, items can be reordered by changing their position in
the list, with the first item being selected as the default action. For example, to
change the default action to Delete:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_snippet_action_menu&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">make_delete_default_action</span><span class="p">(</span><span class="n">menu_items</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">menu_items</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span><span class="p">:</span>
            <span class="c1"># move to top of list</span>
            <span class="n">menu_items</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">menu_items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="k">break</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="register-snippet-listing-buttons">
<span id="id61"></span><h6><code class="docutils literal notranslate"><span class="pre">register_snippet_listing_buttons</span></code><a class="headerlink" href="#register-snippet-listing-buttons" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Add buttons to the actions list for a snippet in the snippets listing. This is useful when adding custom actions to the listing, such as translations or a complex workflow.</p>
<p>This example will add a simple button to the listing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.snippets</span> <span class="kn">import</span> <span class="n">widgets</span> <span class="k">as</span> <span class="n">wagtailsnippets_widgets</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_snippet_listing_buttons&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">snippet_listing_buttons</span><span class="p">(</span><span class="n">snippet</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">next_url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">wagtailsnippets_widgets</span><span class="o">.</span><span class="n">SnippetListingButton</span><span class="p">(</span>
        <span class="s1">&#39;A page listing button&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/goes/to/a/url/&#39;</span><span class="p">,</span>
        <span class="n">priority</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The arguments passed to the hook are as follows:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">snippet</span></code> - the snippet object to generate the button for</li>
<li><code class="docutils literal notranslate"><span class="pre">user</span></code> - the user who is viewing the snippets listing</li>
<li><code class="docutils literal notranslate"><span class="pre">next_url</span></code> - the URL that the linked action should redirect back to on completion of the action, if the view supports it</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">priority</span></code> argument controls the order the buttons are displayed in. Buttons are ordered from low to high priority, so a button with <code class="docutils literal notranslate"><span class="pre">priority=10</span></code> will be displayed before a button with <code class="docutils literal notranslate"><span class="pre">priority=20</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="construct-snippet-listing-buttons">
<h6><code class="docutils literal notranslate"><span class="pre">construct_snippet_listing_buttons</span></code><a class="headerlink" href="#construct-snippet-listing-buttons" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>Modify the final list of snippet listing buttons. The
callable passed to this hook receives a list of <code class="docutils literal notranslate"><span class="pre">SnippetListingButton</span></code> objects, a user,
and a context dictionary as per <code class="docutils literal notranslate"><span class="pre">register_snippet_listing_buttons</span></code>,
and should modify the list of menu items in-place.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_snippet_listing_buttons&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">remove_snippet_listing_button_item</span><span class="p">(</span><span class="n">buttons</span><span class="p">,</span> <span class="n">snippet</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">buttons</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># Removes the &#39;delete&#39; button</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="audit-log">
<h5>Audit log<a class="headerlink" href="#audit-log" title="Permalink to this headline">¶</a></h5>
<div class="section" id="register-log-actions">
<span id="id62"></span><h6><code class="docutils literal notranslate"><span class="pre">register_log_actions</span></code><a class="headerlink" href="#register-log-actions" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p>See <a class="reference internal" href="index.html#audit-log"><span class="std std-ref">Audit log</span></a></p>
<p>To add new actions to the registry, call the <code class="docutils literal notranslate"><span class="pre">register_action</span></code> method with the action type, its label and the message to be displayed in administrative listings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_log_actions&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">additional_log_actions</span><span class="p">(</span><span class="n">actions</span><span class="p">):</span>
    <span class="n">actions</span><span class="o">.</span><span class="n">register_action</span><span class="p">(</span><span class="s1">&#39;wagtail_package.echo&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Echo&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Sent an echo&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">callback_message</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Hello </span><span class="si">%(audience)s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
            <span class="s1">&#39;audience&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;audience&#39;</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="n">actions</span><span class="o">.</span><span class="n">register_action</span><span class="p">(</span><span class="s1">&#39;wagtail_package.with_callback&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Callback&#39;</span><span class="p">),</span> <span class="n">callback_message</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>
<span id="document-reference/signals"></span><div class="section" id="signals">
<span id="id1"></span><h4>Signals<a class="headerlink" href="#signals" title="Permalink to this headline">¶</a></h4>
<p>Wagtail’s <a class="reference internal" href="index.html#page-revision-model-ref"><span class="std std-ref">PageRevision</span></a> and <a class="reference internal" href="index.html#page-model-ref"><span class="std std-ref">Page</span></a> implement
<a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/signals/" title="(in Django v3.2)"><span class="xref std std-doc">Signals</span></a> from <code class="docutils literal notranslate"><span class="pre">django.dispatch</span></code>.
Signals are useful for creating side-effects from page publish/unpublish events.</p>
<p>For example, you could use signals to send publish notifications to a messaging service, or <code class="docutils literal notranslate"><span class="pre">POST</span></code> messages to another app that’s consuming the API, such as a static site generator.</p>
<div class="section" id="page-published">
<h5><code class="docutils literal notranslate"><span class="pre">page_published</span></code><a class="headerlink" href="#page-published" title="Permalink to this headline">¶</a></h5>
<p>This signal is emitted from a <code class="docutils literal notranslate"><span class="pre">PageRevision</span></code> when a revision is set to <cite>published</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">sender:</th><td class="field-body">The page <code class="docutils literal notranslate"><span class="pre">class</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">instance:</th><td class="field-body">The specific <code class="docutils literal notranslate"><span class="pre">Page</span></code> instance.</td>
</tr>
<tr class="field-odd field"><th class="field-name">revision:</th><td class="field-body">The <code class="docutils literal notranslate"><span class="pre">PageRevision</span></code> that was published.</td>
</tr>
<tr class="field-even field"><th class="field-name">kwargs:</th><td class="field-body">Any other arguments passed to <code class="docutils literal notranslate"><span class="pre">page_published.send()</span></code>.</td>
</tr>
</tbody>
</table>
<p>To listen to a signal, implement <code class="docutils literal notranslate"><span class="pre">page_published.connect(receiver,</span> <span class="pre">sender,</span> <span class="pre">**kwargs)</span></code>. Here’s a simple
example showing how you might notify your team when something is published:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core.signals</span> <span class="kn">import</span> <span class="n">page_published</span>
<span class="kn">import</span> <span class="nn">requests</span>


<span class="c1"># Let everyone know when a new page is published</span>
<span class="k">def</span> <span class="nf">send_to_slack</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX&#39;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;text&quot;</span> <span class="p">:</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> was published by </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">username</span><span class="p">),</span>
        <span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;#publish-notifications&quot;</span><span class="p">,</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;the squid of content&quot;</span><span class="p">,</span>
        <span class="s2">&quot;icon_emoji&quot;</span><span class="p">:</span> <span class="s2">&quot;:octopus:&quot;</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

<span class="c1"># Register a receiver</span>
<span class="n">page_published</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">send_to_slack</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="receiving-specific-model-events">
<h6>Receiving specific model events<a class="headerlink" href="#receiving-specific-model-events" title="Permalink to this headline">¶</a></h6>
<p>Sometimes you’re not interested in receiving signals for every model, or you want
to handle signals for specific models in different ways. For instance, you may
wish to do something when a new blog post is published:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core.signals</span> <span class="kn">import</span> <span class="n">page_published</span>
<span class="kn">from</span> <span class="nn">mysite.models</span> <span class="kn">import</span> <span class="n">BlogPostPage</span>

<span class="c1"># Do something clever for each model type</span>
<span class="k">def</span> <span class="nf">receiver</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># Do something with blog posts</span>
    <span class="k">pass</span>

<span class="c1"># Register listeners for each page model class</span>
<span class="n">page_published</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">BlogPostPage</span><span class="p">)</span>
</pre></div>
</div>
<p>Wagtail provides access to a list of registered page types through the <code class="docutils literal notranslate"><span class="pre">get_page_models()</span></code> function in <code class="docutils literal notranslate"><span class="pre">wagtail.core.models</span></code>.</p>
<p>Read the <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/signals/#connecting-to-specific-signals" title="(in Django v3.2)"><span class="xref std std-ref">Django documentation</span></a> for more information about specifying senders.</p>
</div>
</div>
<div class="section" id="page-unpublished">
<h5><code class="docutils literal notranslate"><span class="pre">page_unpublished</span></code><a class="headerlink" href="#page-unpublished" title="Permalink to this headline">¶</a></h5>
<p>This signal is emitted from a <code class="docutils literal notranslate"><span class="pre">Page</span></code> when the page is unpublished.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">sender:</th><td class="field-body">The page <code class="docutils literal notranslate"><span class="pre">class</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">instance:</th><td class="field-body">The specific <code class="docutils literal notranslate"><span class="pre">Page</span></code> instance.</td>
</tr>
<tr class="field-odd field"><th class="field-name">kwargs:</th><td class="field-body">Any other arguments passed to <code class="docutils literal notranslate"><span class="pre">page_unpublished.send()</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pre-page-move-and-post-page-move">
<h5><code class="docutils literal notranslate"><span class="pre">pre_page_move</span></code> and <code class="docutils literal notranslate"><span class="pre">post_page_move</span></code><a class="headerlink" href="#pre-page-move-and-post-page-move" title="Permalink to this headline">¶</a></h5>
<p>These signals are emitted from a <code class="docutils literal notranslate"><span class="pre">Page</span></code> immediately before and after it is moved.</p>
<p>Subscribe to <code class="docutils literal notranslate"><span class="pre">pre_page_move</span></code> if you need to know values BEFORE any database changes are applied. For example: Getting the page’s previous URL, or that of its descendants.</p>
<p>Subscribe to <code class="docutils literal notranslate"><span class="pre">post_page_move</span></code> if you need to know values AFTER database changes have been applied. For example: Getting the page’s new URL, or that of its descendants.</p>
<p>The following arguments are emitted for both signals:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">sender:</th><td class="field-body">The page <code class="docutils literal notranslate"><span class="pre">class</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">instance:</th><td class="field-body">The specific <code class="docutils literal notranslate"><span class="pre">Page</span></code> instance.</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">parent_page_before:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">The parent page of <code class="docutils literal notranslate"><span class="pre">instance</span></code> <strong>before</strong> moving.</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">parent_page_after:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body">The parent page of <code class="docutils literal notranslate"><span class="pre">instance</span></code> <strong>after</strong> moving.</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">url_path_before:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">The value of <code class="docutils literal notranslate"><span class="pre">instance.url_path</span></code> <strong>before</strong> moving.</td>
</tr>
<tr class="field-even field"><th class="field-name">url_path_after:</th><td class="field-body">The value of <code class="docutils literal notranslate"><span class="pre">instance.url_path</span></code> <strong>after</strong> moving.</td>
</tr>
<tr class="field-odd field"><th class="field-name">kwargs:</th><td class="field-body">Any other arguments passed to <code class="docutils literal notranslate"><span class="pre">pre_page_move.send()</span></code> or <code class="docutils literal notranslate"><span class="pre">post_page_move.send()</span></code>.</td>
</tr>
</tbody>
</table>
<div class="section" id="distinguishing-between-a-move-and-a-reorder">
<h6>Distinguishing between a ‘move’ and a ‘reorder’<a class="headerlink" href="#distinguishing-between-a-move-and-a-reorder" title="Permalink to this headline">¶</a></h6>
<p>The signal can be emitted as a result of a page being moved to a different section (a ‘move’), or as a result of a page being moved to a different position within the same section (a ‘reorder’). Knowing the difference between the two can be particularly useful, because only a ‘move’ affects a page’s URL (and that of its descendants), whereas a ‘reorder’ only affects the natural page order; which is probably less impactful.</p>
<p>The best way to distinguish between a ‘move’ and ‘reorder’ is to compare the <code class="docutils literal notranslate"><span class="pre">url_path_before</span></code> and <code class="docutils literal notranslate"><span class="pre">url_path_after</span></code> values. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core.signals</span> <span class="kn">import</span> <span class="n">pre_page_move</span>
<span class="kn">from</span> <span class="nn">wagtail.contrib.frontend_cache.utils</span> <span class="kn">import</span> <span class="n">purge_page_from_cache</span>

<span class="c1"># Clear a page&#39;s old URLs from the cache when it moves to a different section</span>
<span class="k">def</span> <span class="nf">clear_page_url_from_cache_on_move</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url_path_before&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url_path_after&#39;</span><span class="p">]:</span>
        <span class="c1"># No URLs are changing :) nothing to do here!</span>
        <span class="k">return</span>

    <span class="c1"># The page is moving to a new section (possibly even a new site)</span>
    <span class="c1"># so clear old URL(s) from the cache</span>
    <span class="n">purge_page_from_cache</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">])</span>

<span class="c1"># Register a receiver</span>
<span class="n">pre_page_move</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">clear_old_page_urls_from_cache</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="workflow-submitted">
<h5>workflow_submitted<a class="headerlink" href="#workflow-submitted" title="Permalink to this headline">¶</a></h5>
<p>This signal is emitted from a <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code> when a page is submitted to a workflow.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">sender:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">instance:</th><td class="field-body">The specific <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code> instance.</td>
</tr>
<tr class="field-odd field"><th class="field-name">user:</th><td class="field-body">The user who submitted the workflow</td>
</tr>
<tr class="field-even field"><th class="field-name">kwargs:</th><td class="field-body">Any other arguments passed to <code class="docutils literal notranslate"><span class="pre">workflow_submitted.send()</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="workflow-rejected">
<h5>workflow_rejected<a class="headerlink" href="#workflow-rejected" title="Permalink to this headline">¶</a></h5>
<p>This signal is emitted from a <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code> when a page is rejected from a workflow.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">sender:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">instance:</th><td class="field-body">The specific <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code> instance.</td>
</tr>
<tr class="field-odd field"><th class="field-name">user:</th><td class="field-body">The user who rejected the workflow</td>
</tr>
<tr class="field-even field"><th class="field-name">kwargs:</th><td class="field-body">Any other arguments passed to <code class="docutils literal notranslate"><span class="pre">workflow_rejected.send()</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="workflow-approved">
<h5>workflow_approved<a class="headerlink" href="#workflow-approved" title="Permalink to this headline">¶</a></h5>
<p>This signal is emitted from a <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code> when a page’s workflow completes successfully</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">sender:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">instance:</th><td class="field-body">The specific <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code> instance.</td>
</tr>
<tr class="field-odd field"><th class="field-name">user:</th><td class="field-body">The user who last approved the workflow</td>
</tr>
<tr class="field-even field"><th class="field-name">kwargs:</th><td class="field-body">Any other arguments passed to <code class="docutils literal notranslate"><span class="pre">workflow_approved.send()</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="workflow-cancelled">
<h5>workflow_cancelled<a class="headerlink" href="#workflow-cancelled" title="Permalink to this headline">¶</a></h5>
<p>This signal is emitted from a <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code> when a page’s workflow is cancelled</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">sender:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">instance:</th><td class="field-body">The specific <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code> instance.</td>
</tr>
<tr class="field-odd field"><th class="field-name">user:</th><td class="field-body">The user who cancelled the workflow</td>
</tr>
<tr class="field-even field"><th class="field-name">kwargs:</th><td class="field-body">Any other arguments passed to <code class="docutils literal notranslate"><span class="pre">workflow_cancelled.send()</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="task-submitted">
<h5>task_submitted<a class="headerlink" href="#task-submitted" title="Permalink to this headline">¶</a></h5>
<p>This signal is emitted from a <code class="docutils literal notranslate"><span class="pre">TaskState</span></code> when a page is submitted to a task.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">sender:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">TaskState</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">instance:</th><td class="field-body">The specific <code class="docutils literal notranslate"><span class="pre">TaskState</span></code> instance.</td>
</tr>
<tr class="field-odd field"><th class="field-name">user:</th><td class="field-body">The user who submitted the page to the task</td>
</tr>
<tr class="field-even field"><th class="field-name">kwargs:</th><td class="field-body">Any other arguments passed to <code class="docutils literal notranslate"><span class="pre">task_submitted.send()</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="task-rejected">
<h5>task_rejected<a class="headerlink" href="#task-rejected" title="Permalink to this headline">¶</a></h5>
<p>This signal is emitted from a <code class="docutils literal notranslate"><span class="pre">TaskState</span></code> when a page is rejected from a task.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">sender:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">TaskState</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">instance:</th><td class="field-body">The specific <code class="docutils literal notranslate"><span class="pre">TaskState</span></code> instance.</td>
</tr>
<tr class="field-odd field"><th class="field-name">user:</th><td class="field-body">The user who rejected the task</td>
</tr>
<tr class="field-even field"><th class="field-name">kwargs:</th><td class="field-body">Any other arguments passed to <code class="docutils literal notranslate"><span class="pre">task_rejected.send()</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="task-approved">
<h5>task_approved<a class="headerlink" href="#task-approved" title="Permalink to this headline">¶</a></h5>
<p>This signal is emitted from a <code class="docutils literal notranslate"><span class="pre">TaskState</span></code> when a page’s task is approved</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">sender:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">TaskState</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">instance:</th><td class="field-body">The specific <code class="docutils literal notranslate"><span class="pre">TaskState</span></code> instance.</td>
</tr>
<tr class="field-odd field"><th class="field-name">user:</th><td class="field-body">The user who approved the task</td>
</tr>
<tr class="field-even field"><th class="field-name">kwargs:</th><td class="field-body">Any other arguments passed to <code class="docutils literal notranslate"><span class="pre">task_approved.send()</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="task-cancelled">
<h5>task_cancelled<a class="headerlink" href="#task-cancelled" title="Permalink to this headline">¶</a></h5>
<p>This signal is emitted from a <code class="docutils literal notranslate"><span class="pre">TaskState</span></code> when a page’s task is cancelled.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">sender:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">TaskState</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">instance:</th><td class="field-body">The specific <code class="docutils literal notranslate"><span class="pre">TaskState</span></code> instance.</td>
</tr>
<tr class="field-odd field"><th class="field-name">user:</th><td class="field-body">The user who cancelled the task</td>
</tr>
<tr class="field-even field"><th class="field-name">kwargs:</th><td class="field-body">Any other arguments passed to <code class="docutils literal notranslate"><span class="pre">task_cancelled.send()</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-reference/settings"></span><div class="section" id="settings">
<h4>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h4>
<p>Wagtail makes use of the following settings, in addition to <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/settings/" title="(in Django v3.2)"><span class="xref std std-doc">Django’s core settings</span></a>:</p>
<div class="section" id="site-name">
<h5>Site Name<a class="headerlink" href="#site-name" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtail-site-name">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_SITE_NAME</span></code><a class="headerlink" href="#wagtail-site-name" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_SITE_NAME</span> <span class="o">=</span> <span class="s1">&#39;Stark Industries Skunkworks&#39;</span>
</pre></div>
</div>
<p>This is the human-readable name of your Wagtail install which welcomes users upon login to the Wagtail admin.</p>
</div>
</div>
<div class="section" id="append-slash">
<span id="id1"></span><h5>Append Slash<a class="headerlink" href="#append-slash" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtail-append-slash">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_APPEND_SLASH</span></code><a class="headerlink" href="#wagtail-append-slash" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t add a trailing slash to Wagtail-served URLs</span>
<span class="n">WAGTAIL_APPEND_SLASH</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Similar to Django’s <code class="docutils literal notranslate"><span class="pre">APPEND_SLASH</span></code>, this setting controls how Wagtail will handle requests that don’t end in a trailing slash.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">WAGTAIL_APPEND_SLASH</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> (default), requests to Wagtail pages which omit a trailing slash will be redirected by Django’s <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/middleware/#django.middleware.common.CommonMiddleware" title="(in Django v3.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CommonMiddleware</span></code></a> to a URL with a trailing slash.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">WAGTAIL_APPEND_SLASH</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>, requests to Wagtail pages will be served both with and without trailing slashes. Page links generated by Wagtail, however, will not include trailing slashes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you use the <code class="docutils literal notranslate"><span class="pre">False</span></code> setting, keep in mind that serving your pages both with and without slashes may affect search engines’ ability to index your site. See <a class="reference external" href="https://developers.google.com/search/blog/2010/04/to-slash-or-not-to-slash">this Google Search Central Blog post</a> for more details.</p>
</div>
</div>
</div>
<div class="section" id="search">
<h5>Search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtailsearch-backends">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_BACKENDS</span></code><a class="headerlink" href="#wagtailsearch-backends" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.search.backends.elasticsearch5&#39;</span><span class="p">,</span>
        <span class="s1">&#39;INDEX&#39;</span><span class="p">:</span> <span class="s1">&#39;myapp&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Define a search backend. For a full explanation, see <a class="reference internal" href="index.html#wagtailsearch-backends"><span class="std std-ref">Backends</span></a>.</p>
</div>
<div class="section" id="wagtailsearch-hits-max-age">
<span id="id2"></span><h6><code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_HITS_MAX_AGE</span></code><a class="headerlink" href="#wagtailsearch-hits-max-age" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILSEARCH_HITS_MAX_AGE</span> <span class="o">=</span> <span class="mi">14</span>
</pre></div>
</div>
<p>Set the number of days (default 7) that search query logs are kept for; these are used to identify popular search terms for <a class="reference internal" href="index.html#editors-picks"><span class="std std-ref">promoted search results</span></a>. Queries older than this will be removed by the <a class="reference internal" href="index.html#search-garbage-collect"><span class="std std-ref">search_garbage_collect</span></a> command.</p>
</div>
</div>
<div class="section" id="internationalisation">
<h5>Internationalisation<a class="headerlink" href="#internationalisation" title="Permalink to this headline">¶</a></h5>
<p>Wagtail supports internationalisation of content by maintaining separate trees
of pages for each language.</p>
<p>For a guide on how to enable internationalisation on your site, see the <a class="reference internal" href="index.html#enabling-internationalisation"><span class="std std-ref">configuration guide</span></a>.</p>
<div class="section" id="wagtail-i18n-enabled">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_I18N_ENABLED</span></code><a class="headerlink" href="#wagtail-i18n-enabled" title="Permalink to this headline">¶</a></h6>
<p>(boolean, default <code class="docutils literal notranslate"><span class="pre">False</span></code>)</p>
<p>When set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, Wagtail’s internationalisation features will be enabled:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_I18N_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="wagtail-content-languages">
<span id="wagtail-content-languages-setting"></span><h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code><a class="headerlink" href="#wagtail-content-languages" title="Permalink to this headline">¶</a></h6>
<p>(list, default <code class="docutils literal notranslate"><span class="pre">[]</span></code>)</p>
<p>A list of languages and/or locales that Wagtail content can be authored in.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_CONTENT_LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;English&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;fr&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;French&quot;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Each item in the list is a 2-tuple containing a language code and a display name.
The language code can either be a language code on its own (such as <code class="docutils literal notranslate"><span class="pre">en</span></code>, <code class="docutils literal notranslate"><span class="pre">fr</span></code>),
or it can include a region code (such as <code class="docutils literal notranslate"><span class="pre">en-gb</span></code>, <code class="docutils literal notranslate"><span class="pre">fr-fr</span></code>).
You can mix the two formats if you only need to localize in some regions but not others.</p>
<p>This setting follows the same structure of Django’s  <code class="docutils literal notranslate"><span class="pre">LANGUAGES</span></code> setting,
so they can both be set to the same value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LANGUAGES</span> <span class="o">=</span> <span class="n">WAGTAIL_CONTENT_LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;en-gb&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;English (United Kingdom)&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;en-us&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;English (United States)&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;es-es&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Spanish (Spain)&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;es-mx&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Spanish (Mexico)&quot;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>However having them separate allows you to configure many different regions on your site
yet have them share Wagtail content (but defer on things like date formatting, currency, etc):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;English (United Kingdom)&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;en-us&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;English (United States)&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Spanish (Spain)&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;es-mx&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Spanish (Mexico)&quot;</span><span class="p">)),</span>
<span class="p">]</span>


<span class="n">WAGTAIL_CONTENT_LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;English&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Spanish&quot;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This would mean that your site will respond on the
<code class="docutils literal notranslate"><span class="pre">https://www.mysite.com/es/</span></code> and <code class="docutils literal notranslate"><span class="pre">https://www.mysite.com/es-MX/</span></code> URLs, but both
of them will serve content from the same “Spanish” tree in Wagtail.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code> must be a subset of <code class="docutils literal notranslate"><span class="pre">LANGUAGES</span></code></p>
<p class="last">Note that all languages that exist in <code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code>
must also exist in your <code class="docutils literal notranslate"><span class="pre">LANGUAGES</span></code> setting. This is so that Wagtail can
generate a live URL to these pages from an untranslated context (e.g. the admin
interface).</p>
</div>
</div>
</div>
<div class="section" id="embeds">
<h5>Embeds<a class="headerlink" href="#embeds" title="Permalink to this headline">¶</a></h5>
<p>Wagtail supports generating embed code from URLs to content on an external
providers such as Youtube or Twitter. By default, Wagtail will fetch the embed
code directly from the relevant provider’s site using the oEmbed protocol.
Wagtail has a builtin list of the most common providers.</p>
<p>The embeds fetching can be fully configured using the <code class="docutils literal notranslate"><span class="pre">WAGTAILEMBEDS_FINDERS</span></code>
setting. This is fully documented in <a class="reference internal" href="index.html#configuring-embed-finders"><span class="std std-ref">Configuring embed “finders”</span></a>.</p>
<div class="section" id="wagtailembeds-responsive-html">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILEMBEDS_RESPONSIVE_HTML</span></code><a class="headerlink" href="#wagtailembeds-responsive-html" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILEMBEDS_RESPONSIVE_HTML</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Adds <code class="docutils literal notranslate"><span class="pre">class=&quot;responsive-object&quot;</span></code> and an inline <code class="docutils literal notranslate"><span class="pre">padding-bottom</span></code> style to embeds,
to assist in making them responsive. See <a class="reference internal" href="index.html#responsive-embeds"><span class="std std-ref">Responsive Embeds</span></a> for details.</p>
</div>
</div>
<div class="section" id="dashboard">
<h5>Dashboard<a class="headerlink" href="#dashboard" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtailadmin-recent-edits-limit">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_RECENT_EDITS_LIMIT</span></code><a class="headerlink" href="#wagtailadmin-recent-edits-limit" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILADMIN_RECENT_EDITS_LIMIT</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>This setting lets you change the number of items shown at ‘Your most recent edits’ on the dashboard.</p>
</div>
<div class="section" id="wagtailadmin-user-login-form">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_USER_LOGIN_FORM</span></code><a class="headerlink" href="#wagtailadmin-user-login-form" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILADMIN_USER_LOGIN_FORM</span> <span class="o">=</span> <span class="s1">&#39;users.forms.LoginForm&#39;</span>
</pre></div>
</div>
<p>Allows the default <code class="docutils literal notranslate"><span class="pre">LoginForm</span></code> to be extended with extra fields.</p>
</div>
<div class="section" id="wagtail-gravatar-provider-url">
<span id="id3"></span><h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_GRAVATAR_PROVIDER_URL</span></code><a class="headerlink" href="#wagtail-gravatar-provider-url" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_GRAVATAR_PROVIDER_URL</span> <span class="o">=</span> <span class="s1">&#39;//www.gravatar.com/avatar&#39;</span>
</pre></div>
</div>
<p>If a user has not uploaded a profile picture, Wagtail will look for an avatar linked to their email address on gravatar.com. This setting allows you to specify an alternative provider such as like robohash.org, or can be set to <code class="docutils literal notranslate"><span class="pre">None</span></code> to disable the use of remote avatars completely.</p>
</div>
<div class="section" id="wagtail-moderation-enabled">
<span id="id4"></span><h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_MODERATION_ENABLED</span></code><a class="headerlink" href="#wagtail-moderation-enabled" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_MODERATION_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Changes whether the Submit for Moderation button is displayed in the action menu.</p>
</div>
</div>
<div class="section" id="comments">
<h5>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h5>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.13.</span></p>
</div>
<div class="section" id="wagtailadmin-comments-enabled">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_COMMENTS_ENABLED</span></code><a class="headerlink" href="#wagtailadmin-comments-enabled" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Disable commenting</span>
<span class="n">WAGTAILADMIN_COMMENTS_ENABLED</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Sets whether commenting is enabled for pages (<code class="docutils literal notranslate"><span class="pre">True</span></code> by default).</p>
</div>
</div>
<div class="section" id="images">
<h5>Images<a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtailimages-image-model">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_IMAGE_MODEL</span></code><a class="headerlink" href="#wagtailimages-image-model" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILIMAGES_IMAGE_MODEL</span> <span class="o">=</span> <span class="s1">&#39;myapp.MyImage&#39;</span>
</pre></div>
</div>
<p>This setting lets you provide your own image model for use in Wagtail, which should extend the built-in <code class="docutils literal notranslate"><span class="pre">AbstractImage</span></code> class.</p>
</div>
<div class="section" id="wagtailimages-image-form-base">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_IMAGE_FORM_BASE</span></code><a class="headerlink" href="#wagtailimages-image-form-base" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILIMAGES_IMAGE_FORM_BASE</span> <span class="o">=</span> <span class="s1">&#39;myapp.forms.MyImageBaseForm&#39;</span>
</pre></div>
</div>
<p>This setting lets you provide your own image base form for use in Wagtail, which might extend the built-in <code class="docutils literal notranslate"><span class="pre">BaseImageForm</span></code> class or replace it entirely.
You can use it to specify or override the widgets to use in the admin form.</p>
</div>
<div class="section" id="wagtailimages-max-upload-size">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_MAX_UPLOAD_SIZE</span></code><a class="headerlink" href="#wagtailimages-max-upload-size" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILIMAGES_MAX_UPLOAD_SIZE</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># i.e. 20MB</span>
</pre></div>
</div>
<p>This setting lets you override the maximum upload size for images (in bytes). If omitted, Wagtail will fall back to using its 10MB default value.</p>
</div>
<div class="section" id="wagtailimages-max-image-pixels">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_MAX_IMAGE_PIXELS</span></code><a class="headerlink" href="#wagtailimages-max-image-pixels" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILIMAGES_MAX_IMAGE_PIXELS</span> <span class="o">=</span> <span class="mi">128000000</span>  <span class="c1"># i.e. 128 megapixels</span>
</pre></div>
</div>
<p>This setting lets you override the maximum number of pixels an image can have. If omitted, Wagtail will fall back to using its 128 megapixels default value. The pixel count takes animation frames into account - for example, a 25-frame animation of size 100x100 is considered to have 100 * 100 * 25 = 250000 pixels.</p>
</div>
<div class="section" id="wagtailimages-feature-detection-enabled">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_FEATURE_DETECTION_ENABLED</span></code><a class="headerlink" href="#wagtailimages-feature-detection-enabled" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILIMAGES_FEATURE_DETECTION_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>This setting enables feature detection once OpenCV is installed, see all details on the <a class="reference internal" href="index.html#image-feature-detection"><span class="std std-ref">Feature Detection</span></a> documentation.</p>
</div>
<div class="section" id="wagtailimages-index-page-size">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_INDEX_PAGE_SIZE</span></code><a class="headerlink" href="#wagtailimages-index-page-size" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILIMAGES_INDEX_PAGE_SIZE</span> <span class="o">=</span> <span class="mi">20</span>
</pre></div>
</div>
<p>Specifies the number of images per page shown on the main Images listing in the Wagtail admin.</p>
</div>
<div class="section" id="wagtailimages-usage-page-size">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_USAGE_PAGE_SIZE</span></code><a class="headerlink" href="#wagtailimages-usage-page-size" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILIMAGES_USAGE_PAGE_SIZE</span> <span class="o">=</span> <span class="mi">20</span>
</pre></div>
</div>
<p>Specifies the number of items per page shown when viewing an image’s usage (see <a class="reference internal" href="#wagtail-usage-count-enabled"><span class="std std-ref">WAGTAIL_USAGE_COUNT_ENABLED</span></a>).</p>
</div>
<div class="section" id="wagtailimages-chooser-page-size">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_CHOOSER_PAGE_SIZE</span></code><a class="headerlink" href="#wagtailimages-chooser-page-size" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILIMAGES_CHOOSER_PAGE_SIZE</span> <span class="o">=</span> <span class="mi">12</span>
</pre></div>
</div>
<p>Specifies the number of images shown per page in the image chooser modal.</p>
</div>
</div>
<div class="section" id="documents">
<h5>Documents<a class="headerlink" href="#documents" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtaildocs-document-model">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_DOCUMENT_MODEL</span></code><a class="headerlink" href="#wagtaildocs-document-model" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILDOCS_DOCUMENT_MODEL</span> <span class="o">=</span> <span class="s1">&#39;myapp.MyDocument&#39;</span>
</pre></div>
</div>
<p>This setting lets you provide your own document model for use in Wagtail, which should extend the built-in <code class="docutils literal notranslate"><span class="pre">AbstractDocument</span></code> class.</p>
</div>
<div class="section" id="wagtaildocs-document-form-base">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_DOCUMENT_FORM_BASE</span></code><a class="headerlink" href="#wagtaildocs-document-form-base" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILDOCS_DOCUMENT_FORM_BASE</span> <span class="o">=</span> <span class="s1">&#39;myapp.forms.MyDocumentBaseForm&#39;</span>
</pre></div>
</div>
<p>This setting lets you provide your own Document base form for use in Wagtail, which might extend the built-in <code class="docutils literal notranslate"><span class="pre">BaseDocumentForm</span></code> class or replace it entirely.
You can use it to specify or override the widgets to use in the admin form.</p>
</div>
<div class="section" id="wagtaildocs-serve-method">
<span id="id5"></span><h6><code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_SERVE_METHOD</span></code><a class="headerlink" href="#wagtaildocs-serve-method" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILDOCS_SERVE_METHOD</span> <span class="o">=</span> <span class="s1">&#39;redirect&#39;</span>
</pre></div>
</div>
<p>Determines how document downloads will be linked to and served. Normally, requests for documents are sent through a Django view, to perform permission checks (see <a class="reference internal" href="index.html#image-document-permissions"><span class="std std-ref">Image / document permissions</span></a>) and potentially other housekeeping tasks such as hit counting. To fully protect against users bypassing this check, it needs to happen in the same request where the document is served; however, this incurs a performance hit as the document then needs to be served by the Django server. In particular, this cancels out much of the benefit of hosting documents on external storage, such as S3 or a CDN.</p>
<p>For this reason, Wagtail provides a number of serving methods which trade some of the strictness of the permission check for performance:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'direct'</span></code> - links to documents point directly to the URL provided by the underlying storage, bypassing the Django view that provides the permission check. This is most useful when deploying sites as fully static HTML (e.g. using <a class="reference external" href="https://github.com/wagtail/wagtail-bakery">wagtail-bakery</a> or <a class="reference external" href="https://www.gatsbyjs.org/">Gatsby</a>).</li>
<li><code class="docutils literal notranslate"><span class="pre">'redirect'</span></code> - links to documents point to a Django view which will check the user’s permission; if successful, it will redirect to the URL provided by the underlying storage to allow the document to be downloaded. This is most suitable for remote storage backends such as S3, as it allows the document to be served independently of the Django server. Note that if a user is able to guess the latter URL, they will be able to bypass the permission check; some storage backends may provide configuration options to generate a random or short-lived URL to mitigate this.</li>
<li><code class="docutils literal notranslate"><span class="pre">'serve_view'</span></code> - links to documents point to a Django view which both checks the user’s permission, and serves the document. Serving will be handled by <a class="reference external" href="https://github.com/johnsensible/django-sendfile">django-sendfile</a>, if this is installed and supported by your server configuration, or as a streaming response from Django if not. When using this method, it is recommended that you configure your webserver to <em>disallow</em> serving documents directly from their location under <code class="docutils literal notranslate"><span class="pre">MEDIA_ROOT</span></code>, as this would provide a way to bypass the permission check.</li>
</ul>
</div></blockquote>
<p>If <code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_SERVE_METHOD</span></code> is unspecified or set to <code class="docutils literal notranslate"><span class="pre">None</span></code>, the default method is <code class="docutils literal notranslate"><span class="pre">'redirect'</span></code> when a remote storage backend is in use (i.e. one that exposes a URL but not a local filesystem path), and <code class="docutils literal notranslate"><span class="pre">'serve_view'</span></code> otherwise. Finally, some storage backends may not expose a URL at all; in this case, serving will proceed as for <code class="docutils literal notranslate"><span class="pre">'serve_view'</span></code>.</p>
</div>
<div class="section" id="wagtaildocs-content-types">
<span id="id6"></span><h6><code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_CONTENT_TYPES</span></code><a class="headerlink" href="#wagtaildocs-content-types" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILDOCS_CONTENT_TYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;pdf&#39;</span><span class="p">:</span> <span class="s1">&#39;application/pdf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;txt&#39;</span><span class="p">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Specifies the MIME content type that will be returned for the given file extension, when using the <code class="docutils literal notranslate"><span class="pre">serve_view</span></code> method. Content types not listed here will be guessed using the Python <code class="docutils literal notranslate"><span class="pre">mimetypes.guess_type</span></code> function, or <code class="docutils literal notranslate"><span class="pre">application/octet-stream</span></code> if unsuccessful.</p>
</div>
<div class="section" id="wagtaildocs-inline-content-types">
<span id="id7"></span><h6><code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_INLINE_CONTENT_TYPES</span></code><a class="headerlink" href="#wagtaildocs-inline-content-types" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILDOCS_INLINE_CONTENT_TYPES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>A list of MIME content types that will be shown inline in the browser (by serving the HTTP header <code class="docutils literal notranslate"><span class="pre">Content-Disposition:</span> <span class="pre">inline</span></code>) rather than served as a download, when using the <code class="docutils literal notranslate"><span class="pre">serve_view</span></code> method. Defaults to <code class="docutils literal notranslate"><span class="pre">application/pdf</span></code>.</p>
</div>
<div class="section" id="wagtaildocs-extensions">
<span id="id8"></span><h6><code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_EXTENSIONS</span></code><a class="headerlink" href="#wagtaildocs-extensions" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILDOCS_EXTENSIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;docx&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>A list of allowed document extensions that will be validated during document uploading.
If this isn’t supplied all document extensions are allowed.
Warning: this doesn’t always ensure that the uploaded file is valid as files can
be renamed to have an extension no matter what data they contain.</p>
</div>
</div>
<div class="section" id="password-management">
<h5>Password Management<a class="headerlink" href="#password-management" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtail-password-management-enabled">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_PASSWORD_MANAGEMENT_ENABLED</span></code><a class="headerlink" href="#wagtail-password-management-enabled" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_PASSWORD_MANAGEMENT_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>This specifies whether users are allowed to change their passwords (enabled by default).</p>
</div>
<div class="section" id="wagtail-password-reset-enabled">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_PASSWORD_RESET_ENABLED</span></code><a class="headerlink" href="#wagtail-password-reset-enabled" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_PASSWORD_RESET_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>This specifies whether users are allowed to reset their passwords. Defaults to the same as <code class="docutils literal notranslate"><span class="pre">WAGTAIL_PASSWORD_MANAGEMENT_ENABLED</span></code>. Password reset emails will be sent from the address specified in Django’s <code class="docutils literal notranslate"><span class="pre">DEFAULT_FROM_EMAIL</span></code> setting.</p>
</div>
<div class="section" id="wagtailusers-password-enabled">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILUSERS_PASSWORD_ENABLED</span></code><a class="headerlink" href="#wagtailusers-password-enabled" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILUSERS_PASSWORD_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>This specifies whether password fields are shown when creating or editing users through Settings -&gt; Users (enabled by default). Set this to False (along with <code class="docutils literal notranslate"><span class="pre">WAGTAIL_PASSWORD_MANAGEMENT_ENABLED</span></code> and <code class="docutils literal notranslate"><span class="pre">WAGTAIL_PASSWORD_RESET_ENABLED</span></code>) if your users are authenticated through an external system such as LDAP.</p>
</div>
<div class="section" id="wagtailusers-password-required">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILUSERS_PASSWORD_REQUIRED</span></code><a class="headerlink" href="#wagtailusers-password-required" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILUSERS_PASSWORD_REQUIRED</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>This specifies whether password is a required field when creating a new user. True by default; ignored if <code class="docutils literal notranslate"><span class="pre">WAGTAILUSERS_PASSWORD_ENABLED</span></code> is false. If this is set to False, and the password field is left blank when creating a user, then that user will have no usable password; in order to log in, they will have to reset their password (if <code class="docutils literal notranslate"><span class="pre">WAGTAIL_PASSWORD_RESET_ENABLED</span></code> is True) or use an alternative authentication system such as LDAP (if one is set up).</p>
</div>
<div class="section" id="wagtail-email-management-enabled">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_EMAIL_MANAGEMENT_ENABLED</span></code><a class="headerlink" href="#wagtail-email-management-enabled" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_EMAIL_MANAGEMENT_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>This specifies whether users are allowed to change their email (enabled by default).</p>
</div>
</div>
<div class="section" id="email-notifications">
<span id="id9"></span><h5>Email Notifications<a class="headerlink" href="#email-notifications" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtailadmin-notification-from-email">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_NOTIFICATION_FROM_EMAIL</span></code><a class="headerlink" href="#wagtailadmin-notification-from-email" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILADMIN_NOTIFICATION_FROM_EMAIL</span> <span class="o">=</span> <span class="s1">&#39;wagtail@myhost.io&#39;</span>
</pre></div>
</div>
<p>Wagtail sends email notifications when content is submitted for moderation, and when the content is accepted or rejected. This setting lets you pick which email address these automatic notifications will come from. If omitted, Wagtail will fall back to using Django’s <code class="docutils literal notranslate"><span class="pre">DEFAULT_FROM_EMAIL</span></code> setting if set, or <code class="docutils literal notranslate"><span class="pre">webmaster&#64;localhost</span></code> if not.</p>
</div>
<div class="section" id="wagtailadmin-notification-use-html">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_NOTIFICATION_USE_HTML</span></code><a class="headerlink" href="#wagtailadmin-notification-use-html" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILADMIN_NOTIFICATION_USE_HTML</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Notification emails are sent in <cite>text/plain</cite> by default, change this to use HTML formatting.</p>
</div>
<div class="section" id="wagtailadmin-notification-include-superusers">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_NOTIFICATION_INCLUDE_SUPERUSERS</span></code><a class="headerlink" href="#wagtailadmin-notification-include-superusers" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILADMIN_NOTIFICATION_INCLUDE_SUPERUSERS</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Notification emails are sent to moderators and superusers by default. You can change this to exclude superusers and only notify moderators.</p>
</div>
</div>
<div class="section" id="wagtail-update-notifications">
<span id="update-notifications"></span><h5>Wagtail update notifications<a class="headerlink" href="#wagtail-update-notifications" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtail-enable-update-check">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_ENABLE_UPDATE_CHECK</span></code><a class="headerlink" href="#wagtail-enable-update-check" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_ENABLE_UPDATE_CHECK</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>For admins only, Wagtail performs a check on the dashboard to see if newer releases are available. This also provides the Wagtail team with the hostname of your Wagtail site. If you’d rather not receive update notifications, or if you’d like your site to remain unknown, you can disable it with this setting.</p>
</div>
</div>
<div class="section" id="private-pages-documents">
<h5>Private pages / documents<a class="headerlink" href="#private-pages-documents" title="Permalink to this headline">¶</a></h5>
<div class="section" id="password-required-template">
<h6><code class="docutils literal notranslate"><span class="pre">PASSWORD_REQUIRED_TEMPLATE</span></code><a class="headerlink" href="#password-required-template" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PASSWORD_REQUIRED_TEMPLATE</span> <span class="o">=</span> <span class="s1">&#39;myapp/password_required.html&#39;</span>
</pre></div>
</div>
<p>This is the path to the Django template which will be used to display the “password required” form when a user accesses a private page. For more details, see the <a class="reference internal" href="index.html#private-pages"><span class="std std-ref">Private pages</span></a> documentation.</p>
</div>
<div class="section" id="document-password-required-template">
<h6><code class="docutils literal notranslate"><span class="pre">DOCUMENT_PASSWORD_REQUIRED_TEMPLATE</span></code><a class="headerlink" href="#document-password-required-template" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DOCUMENT_PASSWORD_REQUIRED_TEMPLATE</span> <span class="o">=</span> <span class="s1">&#39;myapp/document_password_required.html&#39;</span>
</pre></div>
</div>
<p>As above, but for password restrictions on documents. For more details, see the <a class="reference internal" href="index.html#private-pages"><span class="std std-ref">Private pages</span></a> documentation.</p>
</div>
</div>
<div class="section" id="login-page">
<h5>Login page<a class="headerlink" href="#login-page" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtail-frontend-login-template">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_FRONTEND_LOGIN_TEMPLATE</span></code><a class="headerlink" href="#wagtail-frontend-login-template" title="Permalink to this headline">¶</a></h6>
<p>The basic login page can be customised with a custom template.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_FRONTEND_LOGIN_TEMPLATE</span> <span class="o">=</span> <span class="s1">&#39;myapp/login.html&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="wagtail-frontend-login-url">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_FRONTEND_LOGIN_URL</span></code><a class="headerlink" href="#wagtail-frontend-login-url" title="Permalink to this headline">¶</a></h6>
<p>Or the login page can be a redirect to an external or internal URL.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_FRONTEND_LOGIN_URL</span> <span class="o">=</span> <span class="s1">&#39;/accounts/login/&#39;</span>
</pre></div>
</div>
<p>For more details, see the <a class="reference internal" href="index.html#login-page"><span class="std std-ref">Setting up a login page</span></a> documentation.</p>
</div>
</div>
<div class="section" id="case-insensitive-tags">
<h5>Case-Insensitive Tags<a class="headerlink" href="#case-insensitive-tags" title="Permalink to this headline">¶</a></h5>
<div class="section" id="taggit-case-insensitive">
<h6><code class="docutils literal notranslate"><span class="pre">TAGGIT_CASE_INSENSITIVE</span></code><a class="headerlink" href="#taggit-case-insensitive" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TAGGIT_CASE_INSENSITIVE</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Tags are case-sensitive by default (‘music’ and ‘Music’ are treated as distinct tags). In many cases the reverse behaviour is preferable.</p>
</div>
</div>
<div class="section" id="multi-word-tags">
<h5>Multi-word tags<a class="headerlink" href="#multi-word-tags" title="Permalink to this headline">¶</a></h5>
<div class="section" id="tag-spaces-allowed">
<h6><code class="docutils literal notranslate"><span class="pre">TAG_SPACES_ALLOWED</span></code><a class="headerlink" href="#tag-spaces-allowed" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TAG_SPACES_ALLOWED</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Tags can only consist of a single word, no spaces allowed. The default setting is <code class="docutils literal notranslate"><span class="pre">True</span></code> (spaces in tags are allowed).</p>
</div>
</div>
<div class="section" id="tag-limit">
<h5>Tag limit<a class="headerlink" href="#tag-limit" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id10">
<h6><code class="docutils literal notranslate"><span class="pre">TAG_LIMIT</span></code><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TAG_LIMIT</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>Limit the number of tags that can be added to (django-taggit) Tag model. Default setting is <code class="docutils literal notranslate"><span class="pre">None</span></code>, meaning no limit on tags.</p>
</div>
</div>
<div class="section" id="unicode-page-slugs">
<h5>Unicode Page Slugs<a class="headerlink" href="#unicode-page-slugs" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtail-allow-unicode-slugs">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_ALLOW_UNICODE_SLUGS</span></code><a class="headerlink" href="#wagtail-allow-unicode-slugs" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_ALLOW_UNICODE_SLUGS</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>By default, page slugs can contain any alphanumeric characters, including non-Latin alphabets. Set this to False to limit slugs to ASCII characters.</p>
</div>
</div>
<div class="section" id="auto-update-preview">
<span id="wagtail-auto-update-preview"></span><h5>Auto update preview<a class="headerlink" href="#auto-update-preview" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id11">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_AUTO_UPDATE_PREVIEW</span></code><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_AUTO_UPDATE_PREVIEW</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>When enabled, data from an edited page is automatically sent to the server
on each change, even without saving. That way, users don’t have to click on
“Preview” to update the content of the preview page. However, the preview page
tab is not refreshed automatically, users have to do it manually.
This behaviour is disabled by default.</p>
</div>
</div>
<div class="section" id="custom-user-edit-forms">
<h5>Custom User Edit Forms<a class="headerlink" href="#custom-user-edit-forms" title="Permalink to this headline">¶</a></h5>
<p>See <a class="reference internal" href="index.html#document-advanced_topics/customisation/custom_user_models"><span class="doc">Custom user models</span></a>.</p>
<div class="section" id="wagtail-user-edit-form">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_USER_EDIT_FORM</span></code><a class="headerlink" href="#wagtail-user-edit-form" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_USER_EDIT_FORM</span> <span class="o">=</span> <span class="s1">&#39;users.forms.CustomUserEditForm&#39;</span>
</pre></div>
</div>
<p>Allows the default <code class="docutils literal notranslate"><span class="pre">UserEditForm</span></code> class to be overridden with a custom form when
a custom user model is being used and extra fields are required in the user edit form.</p>
</div>
<div class="section" id="wagtail-user-creation-form">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_USER_CREATION_FORM</span></code><a class="headerlink" href="#wagtail-user-creation-form" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_USER_CREATION_FORM</span> <span class="o">=</span> <span class="s1">&#39;users.forms.CustomUserCreationForm&#39;</span>
</pre></div>
</div>
<p>Allows the default <code class="docutils literal notranslate"><span class="pre">UserCreationForm</span></code> class to be overridden with a custom form when
a custom user model is being used and extra fields are required in the user creation form.</p>
</div>
<div class="section" id="wagtail-user-custom-fields">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_USER_CUSTOM_FIELDS</span></code><a class="headerlink" href="#wagtail-user-custom-fields" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_USER_CUSTOM_FIELDS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>A list of the extra custom fields to be appended to the default list.</p>
</div>
</div>
<div class="section" id="usage-for-images-documents-and-snippets">
<span id="wagtail-usage-count-enabled"></span><h5>Usage for images, documents and snippets<a class="headerlink" href="#usage-for-images-documents-and-snippets" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id12">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_USAGE_COUNT_ENABLED</span></code><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_USAGE_COUNT_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>When enabled Wagtail shows where a particular image, document or snippet is being used on your site.
This is disabled by default because it generates a query which may run slowly on sites with large numbers of pages.</p>
<p>A link will appear on the edit page (in the rightmost column) showing you how many times the item is used.
Clicking this link takes you to the “Usage” page, which shows you where the snippet, document or image is used.</p>
<p>The link is also shown on the delete page, above the “Delete” button.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The usage count only applies to direct (database) references. Using documents, images and snippets within StreamFields or rich text fields will not be taken into account.</p>
</div>
</div>
</div>
<div class="section" id="date-and-datetime-inputs">
<h5>Date and DateTime inputs<a class="headerlink" href="#date-and-datetime-inputs" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtail-date-format-wagtail-datetime-format-wagtail-time-format">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_DATE_FORMAT</span></code>, <code class="docutils literal notranslate"><span class="pre">WAGTAIL_DATETIME_FORMAT</span></code>, <code class="docutils literal notranslate"><span class="pre">WAGTAIL_TIME_FORMAT</span></code><a class="headerlink" href="#wagtail-date-format-wagtail-datetime-format-wagtail-time-format" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_DATE_FORMAT</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.%m.%Y.&#39;</span>
<span class="n">WAGTAIL_DATETIME_FORMAT</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.%m.%Y. %H:%M&#39;</span>
<span class="n">WAGTAIL_TIME_FORMAT</span> <span class="o">=</span> <span class="s1">&#39;%H:%M&#39;</span>
</pre></div>
</div>
<p>Specifies the date, time and datetime format to be used in input fields in the Wagtail admin. The format is specified in <a class="reference external" href="https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior">Python datetime module syntax</a>, and must be one of the recognised formats listed in the <code class="docutils literal notranslate"><span class="pre">DATE_INPUT_FORMATS</span></code>, <code class="docutils literal notranslate"><span class="pre">TIME_INPUT_FORMATS</span></code>, or <code class="docutils literal notranslate"><span class="pre">DATETIME_INPUT_FORMATS</span></code> setting respectively (see <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/settings/#std:setting-DATE_INPUT_FORMATS">DATE_INPUT_FORMATS</a>).</p>
</div>
</div>
<div class="section" id="time-zones">
<span id="wagtail-user-time-zones"></span><h5>Time zones<a class="headerlink" href="#time-zones" title="Permalink to this headline">¶</a></h5>
<p>Logged-in users can choose their current time zone for the admin interface in the account settings.  If is no time zone selected by the user, then <code class="docutils literal notranslate"><span class="pre">TIME_ZONE</span></code> will be used.
(Note that time zones are only applied to datetime fields, not to plain time or date fields.  This is a Django design decision.)</p>
<div class="section" id="id13">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_USER_TIME_ZONES</span></code><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h6>
<p>The list of time zones is by default the common_timezones list from pytz.
It is possible to override this list via the <code class="docutils literal notranslate"><span class="pre">WAGTAIL_USER_TIME_ZONES</span></code> setting.
If there is zero or one time zone permitted, the account settings form will be hidden.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_USER_TIME_ZONES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;America/Chicago&#39;</span><span class="p">,</span> <span class="s1">&#39;Australia/Sydney&#39;</span><span class="p">,</span> <span class="s1">&#39;Europe/Rome&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="admin-languages">
<span id="wagtailadmin-permitted-languages"></span><h5>Admin languages<a class="headerlink" href="#admin-languages" title="Permalink to this headline">¶</a></h5>
<p>Users can choose between several languages for the admin interface
in the account settings. The list of languages is by default all the available
languages in Wagtail with at least 90% coverage. To change it, set <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_PERMITTED_LANGUAGES</span></code>:</p>
<div class="section" id="id14">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_PERMITTED_LANGUAGES</span></code><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILADMIN_PERMITTED_LANGUAGES</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="s1">&#39;English&#39;</span><span class="p">),</span>
                                    <span class="p">(</span><span class="s1">&#39;pt&#39;</span><span class="p">,</span> <span class="s1">&#39;Portuguese&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Since the syntax is the same as Django <code class="docutils literal notranslate"><span class="pre">LANGUAGES</span></code>, you can do this so users
can only choose between front office languages:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LANGUAGES</span> <span class="o">=</span> <span class="n">WAGTAILADMIN_PERMITTED_LANGUAGES</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="s1">&#39;English&#39;</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s1">&#39;pt&#39;</span><span class="p">,</span> <span class="s1">&#39;Portuguese&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="static-files">
<h5>Static files<a class="headerlink" href="#static-files" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtailadmin-static-file-version-strings">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_STATIC_FILE_VERSION_STRINGS</span></code><a class="headerlink" href="#wagtailadmin-static-file-version-strings" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILADMIN_STATIC_FILE_VERSION_STRINGS</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Static file URLs within the Wagtail admin are given a version-specific query string of the form <code class="docutils literal notranslate"><span class="pre">?v=1a2b3c4d</span></code>, to prevent outdated cached copies of JavaScript and CSS files from persisting after a Wagtail upgrade. To disable these, set <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_STATIC_FILE_VERSION_STRINGS</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div>
</div>
<div class="section" id="api-settings">
<h5>API Settings<a class="headerlink" href="#api-settings" title="Permalink to this headline">¶</a></h5>
<p>For full documentation on API configuration, including these settings, see <a class="reference internal" href="index.html#api-v2-configuration"><span class="std std-ref">Wagtail API v2 Configuration Guide</span></a> documentation.</p>
<div class="section" id="wagtailapi-base-url">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILAPI_BASE_URL</span></code><a class="headerlink" href="#wagtailapi-base-url" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILAPI_BASE_URL</span> <span class="o">=</span> <span class="s1">&#39;http://api.example.com/&#39;</span>
</pre></div>
</div>
<p>Required when using frontend cache invalidation, used to generate absolute URLs to document files and invalidating the cache.</p>
</div>
<div class="section" id="wagtailapi-limit-max">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILAPI_LIMIT_MAX</span></code><a class="headerlink" href="#wagtailapi-limit-max" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILAPI_LIMIT_MAX</span> <span class="o">=</span> <span class="mi">500</span>
</pre></div>
</div>
<p>Default is 20, used to change the maximum number of results a user can request at a time, set to <code class="docutils literal notranslate"><span class="pre">None</span></code> for no limit.</p>
</div>
<div class="section" id="wagtailapi-search-enabled">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILAPI_SEARCH_ENABLED</span></code><a class="headerlink" href="#wagtailapi-search-enabled" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILAPI_SEARCH_ENABLED</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Default is true, setting this to false will disable full text search on all endpoints.</p>
</div>
<div class="section" id="wagtailapi-use-frontendcache">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILAPI_USE_FRONTENDCACHE</span></code><a class="headerlink" href="#wagtailapi-use-frontendcache" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILAPI_USE_FRONTENDCACHE</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Requires <code class="docutils literal notranslate"><span class="pre">wagtailfrontendcache</span></code> app to be installed, indicates the API should use the frontend cache.</p>
</div>
</div>
<div class="section" id="frontend-cache">
<h5>Frontend cache<a class="headerlink" href="#frontend-cache" title="Permalink to this headline">¶</a></h5>
<p>For full documentation on frontend cache invalidation, including these settings, see <a class="reference internal" href="index.html#frontend-cache-purging"><span class="std std-ref">Frontend cache invalidator</span></a>.</p>
<div class="section" id="wagtailfrontendcache">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILFRONTENDCACHE</span></code><a class="headerlink" href="#wagtailfrontendcache" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILFRONTENDCACHE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;varnish&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.contrib.frontend_cache.backends.HTTPBackend&#39;</span><span class="p">,</span>
        <span class="s1">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="s1">&#39;http://localhost:8000&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See documentation linked above for full options available.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">WAGTAILFRONTENDCACHE_LOCATION</span></code> is no longer the preferred way to set the cache location, instead set the <code class="docutils literal notranslate"><span class="pre">LOCATION</span></code> within the <code class="docutils literal notranslate"><span class="pre">WAGTAILFRONTENDCACHE</span></code> item.</p>
</div>
</div>
<div class="section" id="wagtailfrontendcache-languages">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILFRONTENDCACHE_LANGUAGES</span></code><a class="headerlink" href="#wagtailfrontendcache-languages" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILFRONTENDCACHE_LANGUAGES</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGES</span><span class="p">]</span>
</pre></div>
</div>
<p>Default is an empty list, must be a list of languages to also purge the urls for each language of a purging url. This setting needs <code class="docutils literal notranslate"><span class="pre">settings.USE_I18N</span></code> to be <code class="docutils literal notranslate"><span class="pre">True</span></code> to work.</p>
</div>
</div>
<div class="section" id="rich-text">
<span id="wagtailadmin-rich-text-editors"></span><h5>Rich text<a class="headerlink" href="#rich-text" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id15">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_RICH_TEXT_EDITORS</span></code><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILADMIN_RICH_TEXT_EDITORS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;WIDGET&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.admin.rich_text.DraftailRichTextArea&#39;</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;h2&#39;</span><span class="p">,</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="s1">&#39;italic&#39;</span><span class="p">,</span> <span class="s1">&#39;link&#39;</span><span class="p">,</span> <span class="s1">&#39;document-link&#39;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;legacy&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;WIDGET&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.admin.rich_text.HalloRichTextArea&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Customise the behaviour of rich text fields. By default, <code class="docutils literal notranslate"><span class="pre">RichTextField</span></code> and <code class="docutils literal notranslate"><span class="pre">RichTextBlock</span></code> use the configuration given under the <code class="docutils literal notranslate"><span class="pre">'default'</span></code> key, but this can be overridden on a per-field basis through the <code class="docutils literal notranslate"><span class="pre">editor</span></code> keyword argument, e.g. <code class="docutils literal notranslate"><span class="pre">body</span> <span class="pre">=</span> <span class="pre">RichTextField(editor='legacy')</span></code>. Within each configuration block, the following fields are recognised:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">WIDGET</span></code>: The rich text widget implementation to use. Wagtail provides two implementations: <code class="docutils literal notranslate"><span class="pre">wagtail.admin.rich_text.DraftailRichTextArea</span></code> (a modern extensible editor which enforces well-structured markup) and <code class="docutils literal notranslate"><span class="pre">wagtail.admin.rich_text.HalloRichTextArea</span></code> (deprecated; works directly at the HTML level). Other widgets may be provided by third-party packages.</li>
<li><code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code>: Configuration options to pass to the widget. Recognised options are widget-specific, but both <code class="docutils literal notranslate"><span class="pre">DraftailRichTextArea</span></code> and <code class="docutils literal notranslate"><span class="pre">HalloRichTextArea</span></code> accept a <code class="docutils literal notranslate"><span class="pre">features</span></code> list indicating the active rich text features (see <a class="reference internal" href="index.html#rich-text-features"><span class="std std-ref">Limiting features in a rich text field</span></a>).</li>
</ul>
</div></blockquote>
<p>If a <code class="docutils literal notranslate"><span class="pre">'default'</span></code> editor is not specified, rich text fields that do not specify an <code class="docutils literal notranslate"><span class="pre">editor</span></code> argument will use the Draftail editor with the default feature set enabled.</p>
</div>
<div class="section" id="wagtailadmin-external-link-conversion">
<span id="id16"></span><h6><code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_EXTERNAL_LINK_CONVERSION</span></code><a class="headerlink" href="#wagtailadmin-external-link-conversion" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILADMIN_EXTERNAL_LINK_CONVERSION</span> <span class="o">=</span> <span class="s1">&#39;exact&#39;</span>
</pre></div>
</div>
<p>Customise Wagtail’s behaviour when an internal page url is entered in the external link chooser. Possible values for this setting are
<code class="docutils literal notranslate"><span class="pre">'all'</span></code>, <code class="docutils literal notranslate"><span class="pre">'exact'</span></code>, <code class="docutils literal notranslate"><span class="pre">'confirm</span></code>, or <code class="docutils literal notranslate"><span class="pre">''</span></code>. The default, <code class="docutils literal notranslate"><span class="pre">'all'</span></code>, means that Wagtail will automatically convert submitted urls that exactly match
page urls to the corresponding internal links. If the url is an inexact match - for example, the submitted url has query parameters - then
Wagtail will confirm the conversion with the user. <code class="docutils literal notranslate"><span class="pre">'exact'</span></code> means that any inexact matches will be left as external urls, and the confirmation
step will be skipped. <code class="docutils literal notranslate"><span class="pre">'confirm'</span></code> means that every link conversion will be confirmed with the user, even if the match is exact. <code class="docutils literal notranslate"><span class="pre">''</span></code>  means
that Wagtail will not attempt to convert any urls entered to internal page links.</p>
</div>
</div>
<div class="section" id="page-locking">
<span id="wagtailadmin-global-page-edit-lock"></span><h5>Page locking<a class="headerlink" href="#page-locking" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id17">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_GLOBAL_PAGE_EDIT_LOCK</span></code><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_GLOBAL_PAGE_EDIT_LOCK</span></code> can be set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to prevent users
from editing pages that they have locked.</p>
</div>
</div>
<div class="section" id="redirects">
<h5>Redirects<a class="headerlink" href="#redirects" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtail-redirects-file-storage">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_REDIRECTS_FILE_STORAGE</span></code><a class="headerlink" href="#wagtail-redirects-file-storage" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_REDIRECTS_FILE_STORAGE</span> <span class="o">=</span> <span class="s1">&#39;tmp_file&#39;</span>
</pre></div>
</div>
<p>By default the redirect importer keeps track of the uploaded file as a temp file, but on certain environments (load balanced/cloud environments), you cannot keep a shared file between environments. For those cases you can use the built-in cache to store the file instead.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_REDIRECTS_FILE_STORAGE</span> <span class="o">=</span> <span class="s1">&#39;cache&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="form-builder">
<h5>Form builder<a class="headerlink" href="#form-builder" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtailforms-help-text-allow-html">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAILFORMS_HELP_TEXT_ALLOW_HTML</span></code><a class="headerlink" href="#wagtailforms-help-text-allow-html" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILFORMS_HELP_TEXT_ALLOW_HTML</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>When true, HTML tags in form field help text will be rendered unescaped (default: False).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Enabling this option will allow editors to insert arbitrary HTML into the page, such as scripts that could allow the editor to acquire administrator privileges when another administrator views the page. Do not enable this setting unless your editors are fully trusted.</p>
</div>
</div>
</div>
<div class="section" id="workflow">
<span id="workflow-settings"></span><h5>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtail-workflow-enabled">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_WORKFLOW_ENABLED</span></code><a class="headerlink" href="#wagtail-workflow-enabled" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_WORKFLOW_ENABLED</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Specifies whether moderation workflows are enabled (default: True). When disabled, editors will no longer be given the option to submit pages to a workflow, and the settings areas for admins to configure workflows and tasks will be unavailable.</p>
</div>
<div class="section" id="wagtail-workflow-require-reapproval-on-edit">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_WORKFLOW_REQUIRE_REAPPROVAL_ON_EDIT</span></code><a class="headerlink" href="#wagtail-workflow-require-reapproval-on-edit" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_WORKFLOW_REQUIRE_REAPPROVAL_ON_EDIT</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Moderation workflows can be used in two modes. The first is to require that all tasks must approve a specific page revision for the workflow to complete. As a result,
if edits are made to a page while it is in moderation, any approved tasks will need to be re-approved for the new revision before the workflow finishes.
This is the default, <code class="docutils literal notranslate"><span class="pre">WAGTAIL_WORKFLOW_REQUIRE_REAPPROVAL_ON_EDIT</span> <span class="pre">=</span> <span class="pre">True</span></code> . The second mode does not require reapproval: if edits are made when
tasks have already been approved, those tasks do not need to be reapproved. This is more suited to a hierarchical workflow system. To use workflows in this mode,
set <code class="docutils literal notranslate"><span class="pre">WAGTAIL_WORKFLOW_REQUIRE_REAPPROVAL_ON_EDIT</span> <span class="pre">=</span> <span class="pre">False</span></code>.</p>
</div>
<div class="section" id="wagtail-finish-workflow-action">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_FINISH_WORKFLOW_ACTION</span></code><a class="headerlink" href="#wagtail-finish-workflow-action" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_FINISH_WORKFLOW_ACTION</span> <span class="o">=</span> <span class="s1">&#39;wagtail.core.workflows.publish_workflow_state&#39;</span>
</pre></div>
</div>
<p>This sets the function to be called when a workflow completes successfully - by default, <code class="docutils literal notranslate"><span class="pre">wagtail.core.workflows.publish_workflow_state</span></code>,
which publishes the page. The function must accept a <code class="docutils literal notranslate"><span class="pre">WorkflowState</span></code> object as its only positional argument.</p>
</div>
<div class="section" id="wagtail-workflow-cancel-on-publish">
<h6><code class="docutils literal notranslate"><span class="pre">WAGTAIL_WORKFLOW_CANCEL_ON_PUBLISH</span></code><a class="headerlink" href="#wagtail-workflow-cancel-on-publish" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_WORKFLOW_CANCEL_ON_PUBLISH</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>This determines whether publishing a page with an ongoing workflow will cancel the workflow (if true) or leave the workflow unaffected (false).
Disabling this could be useful if your site has long, multi-step workflows, and you want to be able to publish urgent page updates while the
workflow continues to provide less urgent feedback.</p>
</div>
</div>
</div>
<span id="document-reference/project_template"></span><div class="section" id="the-project-template">
<h4>The project template<a class="headerlink" href="#the-project-template" title="Permalink to this headline">¶</a></h4>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mysite/
    home/
        migrations/
            __init__.py
            0001_initial.py
            0002_create_homepage.py
        templates/
            home/
                home_page.html
        __init__.py
        models.py
    search/
        templates/
            search/
                search.html
        __init__.py
        views.py
    mysite/
        settings/
            __init__.py
            base.py
            dev.py
            production.py
        static/
            css/
                mysite.css
            js/
                mysite.js
        templates/
            404.html
            500.html
            base.html
        __init__.py
        urls.py
        wsgi.py
    Dockerfile
    manage.py
    requirements.txt
</pre></div>
</div>
<div class="section" id="the-home-app">
<h5>The “home” app<a class="headerlink" href="#the-home-app" title="Permalink to this headline">¶</a></h5>
<p>Location: <code class="docutils literal notranslate"><span class="pre">/mysite/home/</span></code></p>
<p>This app is here to help get you started quicker by providing a <code class="docutils literal notranslate"><span class="pre">HomePage</span></code> model with migrations to create one when you first set up your app.</p>
</div>
<div class="section" id="default-templates-and-static-files">
<h5>Default templates and static files<a class="headerlink" href="#default-templates-and-static-files" title="Permalink to this headline">¶</a></h5>
<p>Location: <code class="docutils literal notranslate"><span class="pre">/mysite/mysite/templates/</span></code> and <code class="docutils literal notranslate"><span class="pre">/mysite/mysite/static/</span></code></p>
<p>The templates directory contains <code class="docutils literal notranslate"><span class="pre">base.html</span></code>, <code class="docutils literal notranslate"><span class="pre">404.html</span></code> and <code class="docutils literal notranslate"><span class="pre">500.html</span></code>. These files are very commonly needed on Wagtail sites to they have been added into the template.</p>
<p>The static directory contains an empty JavaScript and CSS file.</p>
</div>
<div class="section" id="django-settings">
<h5>Django settings<a class="headerlink" href="#django-settings" title="Permalink to this headline">¶</a></h5>
<p>Location: <code class="docutils literal notranslate"><span class="pre">/mysite/mysite/settings/</span></code></p>
<p>The Django settings files are split up into <code class="docutils literal notranslate"><span class="pre">base.py</span></code>, <code class="docutils literal notranslate"><span class="pre">dev.py</span></code>, <code class="docutils literal notranslate"><span class="pre">production.py</span></code> and <code class="docutils literal notranslate"><span class="pre">local.py</span></code>.</p>
<dl class="glossary docutils">
<dt id="term-base-py"><code class="docutils literal notranslate"><span class="pre">base.py</span></code></dt>
<dd>This file is for global settings that will be used in both development and production. Aim to keep most of your configuration in this file.</dd>
<dt id="term-dev-py"><code class="docutils literal notranslate"><span class="pre">dev.py</span></code></dt>
<dd>This file is for settings that will only be used by developers. For example: <code class="docutils literal notranslate"><span class="pre">DEBUG</span> <span class="pre">=</span> <span class="pre">True</span></code></dd>
<dt id="term-production-py"><code class="docutils literal notranslate"><span class="pre">production.py</span></code></dt>
<dd>This file is for settings that will only run on a production server. For example: <code class="docutils literal notranslate"><span class="pre">DEBUG</span> <span class="pre">=</span> <span class="pre">False</span></code></dd>
<dt id="term-local-py"><code class="docutils literal notranslate"><span class="pre">local.py</span></code></dt>
<dd><p class="first">This file is used for settings local to a particular machine. This file should never be tracked by a version control system.</p>
<div class="last admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">On production servers, we recommend that you only store secrets in <code class="docutils literal notranslate"><span class="pre">local.py</span></code> (such as API keys and passwords). This can save you headaches in the future if you are ever trying to debug why a server is behaving badly. If you are using multiple servers which need different settings then we recommend that you create a different <code class="docutils literal notranslate"><span class="pre">production.py</span></code> file for each one.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="dockerfile">
<h5>Dockerfile<a class="headerlink" href="#dockerfile" title="Permalink to this headline">¶</a></h5>
<p>Location: <code class="docutils literal notranslate"><span class="pre">/mysite/Dockerfile</span></code></p>
<p>Contains configuration for building and deploying the site as a <a class="reference external" href="https://docs.docker.com/">Docker</a> container. To build and use the Docker image for your project, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker build -t mysite .</span>
<span class="go">docker run -p 8000:8000 mysite</span>
</pre></div>
</div>
</div>
</div>
<span id="document-reference/jinja2"></span><div class="section" id="jinja2-template-support">
<span id="jinja2"></span><h4>Jinja2 template support<a class="headerlink" href="#jinja2-template-support" title="Permalink to this headline">¶</a></h4>
<p>Wagtail supports Jinja2 templating for all front end features. More information on each of the template tags below can be found in the <a class="reference internal" href="index.html#writing-templates"><span class="std std-ref">Writing templates</span></a> documentation.</p>
<div class="section" id="configuring-django">
<h5>Configuring Django<a class="headerlink" href="#configuring-django" title="Permalink to this headline">¶</a></h5>
<p>Django needs to be configured to support Jinja2 templates. As the Wagtail admin is written using standard Django templates, Django has to be configured to use both templating engines. Add the following configuration to the <code class="docutils literal notranslate"><span class="pre">TEMPLATES</span></code> setting for your app:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.jinja2.Jinja2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;extensions&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;wagtail.core.jinja2tags.core&#39;</span><span class="p">,</span>
                <span class="s1">&#39;wagtail.admin.jinja2tags.userbar&#39;</span><span class="p">,</span>
                <span class="s1">&#39;wagtail.images.jinja2tags.images&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Jinja templates must be placed in a <code class="docutils literal notranslate"><span class="pre">jinja2/</span></code> directory in your app. The template for an <code class="docutils literal notranslate"><span class="pre">EventPage</span></code> model in an <code class="docutils literal notranslate"><span class="pre">events</span></code> app should be created at <code class="docutils literal notranslate"><span class="pre">events/jinja2/events/event_page.html</span></code>.</p>
<p>By default, the Jinja environment does not have any Django functions or filters. The Django documentation has more information on <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/templates/#django.template.backends.jinja2.Jinja2" title="(in Django v3.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">configuring</span> <span class="pre">Jinja</span> <span class="pre">for</span> <span class="pre">Django</span></code></a>.</p>
</div>
<div class="section" id="self-in-templates">
<h5><code class="docutils literal notranslate"><span class="pre">self</span></code> in templates<a class="headerlink" href="#self-in-templates" title="Permalink to this headline">¶</a></h5>
<p>In Django templates, <code class="docutils literal notranslate"><span class="pre">self</span></code> can be used to refer to the current page, stream block, or field panel. In Jinja, <code class="docutils literal notranslate"><span class="pre">self</span></code> is reserved for internal use. When writing Jinja templates, use <code class="docutils literal notranslate"><span class="pre">page</span></code> to refer to pages, <code class="docutils literal notranslate"><span class="pre">value</span></code> for stream blocks, and <code class="docutils literal notranslate"><span class="pre">field_panel</span></code> for field panels.</p>
</div>
<div class="section" id="template-tags-functions-filters">
<h5>Template tags, functions &amp; filters<a class="headerlink" href="#template-tags-functions-filters" title="Permalink to this headline">¶</a></h5>
<div class="section" id="pageurl">
<h6><code class="docutils literal notranslate"><span class="pre">pageurl()</span></code><a class="headerlink" href="#pageurl" title="Permalink to this headline">¶</a></h6>
<p>Generate a URL for a Page instance:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">pageurl</span><span class="o">(</span><span class="nv">page.more_information</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>More information<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#pageurl-tag"><span class="std std-ref">pageurl</span></a> for more information</p>
</div>
<div class="section" id="slugurl">
<h6><code class="docutils literal notranslate"><span class="pre">slugurl()</span></code><a class="headerlink" href="#slugurl" title="Permalink to this headline">¶</a></h6>
<p>Generate a URL for a Page with a slug:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">slugurl</span><span class="o">(</span><span class="s2">&quot;about&quot;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>About us<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#slugurl-tag"><span class="std std-ref">slugurl</span></a> for more information</p>
</div>
<div class="section" id="image">
<h6><code class="docutils literal notranslate"><span class="pre">image()</span></code><a class="headerlink" href="#image" title="Permalink to this headline">¶</a></h6>
<p>Resize an image, and print an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> tag:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="c">{# Print an image tag #}</span>
<span class="cp">{{</span> <span class="nv">image</span><span class="o">(</span><span class="nv">page.header_image</span><span class="o">,</span> <span class="s2">&quot;fill-1024x200&quot;</span><span class="o">,</span> <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;header-image&quot;</span><span class="o">)</span> <span class="cp">}}</span>

<span class="c">{# Resize an image #}</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">background</span><span class="o">=</span><span class="nv">image</span><span class="o">(</span><span class="nv">page.background_image</span><span class="o">,</span> <span class="s2">&quot;max-1024x1024&quot;</span><span class="o">)</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;wrapper&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;background-image: url(</span><span class="cp">{{</span> <span class="nv">background.url</span> <span class="cp">}}</span><span class="s">);&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#image-tag"><span class="std std-ref">How to use images in templates</span></a> for more information</p>
</div>
<div class="section" id="richtext">
<h6><code class="docutils literal notranslate"><span class="pre">|richtext</span></code><a class="headerlink" href="#richtext" title="Permalink to this headline">¶</a></h6>
<p>Transform Wagtail’s internal HTML representation, expanding internal references to pages and images.</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">page.body</span><span class="o">|</span><span class="nf">richtext</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#rich-text-filter"><span class="std std-ref">Rich text (filter)</span></a> for more information</p>
</div>
<div class="section" id="wagtailuserbar">
<h6><code class="docutils literal notranslate"><span class="pre">wagtailuserbar()</span></code><a class="headerlink" href="#wagtailuserbar" title="Permalink to this headline">¶</a></h6>
<p>Output the Wagtail contextual flyout menu for editing pages from the front end</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">wagtailuserbar</span><span class="o">()</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#wagtailuserbar-tag"><span class="std std-ref">Wagtail User Bar</span></a> for more information</p>
</div>
<div class="section" id="include-block">
<h6><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code><a class="headerlink" href="#include-block" title="Permalink to this headline">¶</a></h6>
<p>Output the HTML representation for the stream content as a whole, as well as for each individual block.</p>
<p>Allows to pass template context (by default) to the StreamField template.</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">page.body</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">page.body</span> <span class="k">with context</span> <span class="cp">%}</span> <span class="c">{# The same as the previous #}</span>
<span class="cp">{%</span> <span class="k">include_block</span> <span class="nv">page.body</span> <span class="k">without context</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#streamfield-template-rendering"><span class="std std-ref">StreamField template rendering</span></a> for more information.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> tag is designed to closely follow the syntax and behaviour
of Jinja’s <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">%}</span></code>, so it does not implement the Django version’s feature of
only passing specified variables into the context.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-support"></span><div class="section" id="support">
<h3>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h3>
<p>If you have any problems or questions about working with Wagtail, you are invited to visit any of the following support channels, where volunteer members of the Wagtail community will be happy to assist.</p>
<p><strong>Please respect the time and effort of volunteers, by not asking the same question in multiple places.</strong> At best, you’ll be spamming the same set of people each time; at worst, you’ll waste the effort of volunteers who spend time answering a question unaware that it has already been answered elsewhere. If you absolutely must ask a question on multiple forums, post it on Stack Overflow first and include the Stack Overflow link in your subsequent posts.</p>
<div class="section" id="stack-overflow">
<h4>Stack Overflow<a class="headerlink" href="#stack-overflow" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://stackoverflow.com/questions/tagged/wagtail">Stack Overflow</a> is the best place to find answers to your questions about working with Wagtail - there is an active community of Wagtail users and developers responding to questions there. When posting questions, please read Stack Overflow’s advice on <a class="reference external" href="https://stackoverflow.com/help/how-to-ask">how to ask questions</a> and remember to tag your question with “wagtail”.</p>
</div>
<div class="section" id="mailing-list">
<h4>Mailing list<a class="headerlink" href="#mailing-list" title="Permalink to this headline">¶</a></h4>
<p>For topics and discussions that do not fit Stack Overflow’s question-and-answer format, there is a Wagtail Support mailing list at <a class="reference external" href="https://groups.google.com/d/forum/wagtail">groups.google.com/d/forum/wagtail</a>.</p>
</div>
<div class="section" id="slack">
<span id="id2"></span><h4>Slack<a class="headerlink" href="#slack" title="Permalink to this headline">¶</a></h4>
<p>The Wagtail Slack workspace is open to all users and developers of Wagtail. To join, head to: <a class="reference external" href="https://wagtail.io/slack/">https://wagtail.io/slack/</a></p>
<p>Please use the <strong>#support</strong> channel for support questions. Support is provided by members of the Wagtail community on a voluntary basis, and we cannot guarantee that questions will be answered quickly (or at all). If you want to see this resource succeed, please consider sticking around to help out! Also, please keep in mind that many of Wagtail’s core and expert developers prefer to handle support queries on a non-realtime basis through Stack Overflow, and questions asked there may well get a better response.</p>
</div>
<div class="section" id="issues">
<h4>Issues<a class="headerlink" href="#issues" title="Permalink to this headline">¶</a></h4>
<p>If you think you’ve found a bug in Wagtail, or you’d like to suggest a new feature, please check the current list at <a class="reference external" href="https://github.com/wagtail/wagtail/issues">github.com/wagtail/wagtail/issues</a>. If your bug or suggestion isn’t there, raise a new issue, providing as much relevant context as possible.</p>
<p>If your bug report is a security issue, <strong>do not</strong> report it with an issue. Please read our ​guide to <a class="reference internal" href="index.html#document-contributing/security"><span class="doc">reporting security issues</span></a>.</p>
</div>
<div class="section" id="torchbox">
<h4>Torchbox<a class="headerlink" href="#torchbox" title="Permalink to this headline">¶</a></h4>
<p>Finally, if you have a query which isn’t relevant for any of the above forums, feel free to contact the Wagtail team at Torchbox directly, on <a class="reference external" href="mailto:hello&#37;&#52;&#48;wagtail&#46;io">hello<span>&#64;</span>wagtail<span>&#46;</span>io</a> or <a class="reference external" href="https://twitter.com/wagtailcms">&#64;wagtailcms</a>.</p>
</div>
</div>
<span id="document-editor_manual/index"></span><div class="section" id="using-wagtail-an-editor-s-guide">
<span id="editor-manual"></span><h3>Using Wagtail: an Editor’s guide<a class="headerlink" href="#using-wagtail-an-editor-s-guide" title="Permalink to this headline">¶</a></h3>
<p>This section of the documentation is written for the users of a Wagtail-powered site. That is, the content editors, moderators and administrators who will be running things on a day-to-day basis.</p>
<div class="toctree-wrapper compound">
<span id="document-editor_manual/intro"></span><div class="section" id="introduction">
<h4>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://wagtail.io">Wagtail</a> is an open source content management system (CMS) developed by <a class="reference external" href="https://torchbox.com">Torchbox</a>. It is built on the Django framework and designed to be super easy to use for both developers and editors.</p>
<p>This documentation will explain how to:</p>
<ul class="simple">
<li>navigate the main user interface of Wagtail</li>
<li>create pages of all different types</li>
<li>modify, save, publish and unpublish pages</li>
<li>set up users, and provide them with specific roles to create a publishing workflow</li>
<li>upload, edit and include images and documents</li>
<li>… and more!</li>
</ul>
</div>
<span id="document-editor_manual/getting_started"></span><div class="section" id="getting-started">
<h4>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h4>
<div class="section" id="the-wagtail-demo-site">
<h5>The Wagtail demo site<a class="headerlink" href="#the-wagtail-demo-site" title="Permalink to this headline">¶</a></h5>
<p>The examples in this document are based on <a class="reference external" href="https://torchbox.com">Torchbox.com</a>. However, the instructions are general enough as to be applicable to any Wagtail site.</p>
<p>For the purposes of this documentation we will be using the URL, <strong>www.example.com</strong>, to represent the root (homepage) of your website.</p>
</div>
<div class="section" id="logging-in">
<h5>Logging in<a class="headerlink" href="#logging-in" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The first port of call for an editor is the login page for the administrator interface.</li>
<li>Access this by adding <strong>/admin</strong> onto the end of your root URL (e.g. <code class="docutils literal notranslate"><span class="pre">www.example.com/admin</span></code>).</li>
<li>Enter your username and password and click <strong>Sign in</strong>.</li>
</ul>
<img alt="_images/screen01_login.png" src="_images/screen01_login.png" />
</div>
</div>
<span id="document-editor_manual/finding_your_way_around/index"></span><div class="section" id="finding-your-way-around">
<h4>Finding your way around<a class="headerlink" href="#finding-your-way-around" title="Permalink to this headline">¶</a></h4>
<p>This section describes the different pages that you will see as you navigate around the CMS, and how you can find the content that you are looking for.</p>
<div class="toctree-wrapper compound">
<span id="document-editor_manual/finding_your_way_around/the_dashboard"></span><div class="section" id="the-dashboard">
<h5>The Dashboard<a class="headerlink" href="#the-dashboard" title="Permalink to this headline">¶</a></h5>
<p>The Dashboard provides information on:</p>
<ul class="simple">
<li>The number of pages, images, and documents currently held in the Wagtail CMS</li>
<li>Any pages currently awaiting moderation (if you have these privileges)</li>
<li>Any pages that you’ve locked (if your administrator has enabled <a class="reference internal" href="index.html#wagtailadmin-global-page-edit-lock"><span class="std std-ref">author-specific locking</span></a>)</li>
<li>Your most recently edited pages</li>
</ul>
<p>You can return to the Dashboard at any time by clicking the Wagtail logo in the top-left of the screen.</p>
<img alt="_images/screen02_dashboard_editor.png" src="_images/screen02_dashboard_editor.png" />
<ul class="simple">
<li>Clicking the logo returns you to your Dashboard.</li>
<li>The stats at the top of the page describe the total amount of content on the CMS (just for fun!).</li>
<li>The <em>Your pages in a workflow</em> panel shows you any pages in moderation that you own or submitted for moderation yourself, along with which
moderation tasks they are awaiting, and how long they’ve been on that task.</li>
<li>The <em>Awaiting your review</em> panel will only be displayed if you are able to perform moderation actions.<ul>
<li>Clicking the name of a page will take you to the ‘Edit page’ interface for this page.</li>
<li>Clicking approve or request changes will either progress the page to the next task in the moderation workflow (or publish if it’s the final stage) or mark the page as needing changes and return it to normal editing. An email will be sent to the creator of the page giving the result of the overall workflow when it completes.</li>
<li>The status indicator circles show the progress through the workflow: a tick for a completed task, or an empty circle for an incomplete one. Tooltips provide more details on the status of each.</li>
<li>The time this page has been waiting for review on this task is also shown to the right.</li>
</ul>
</li>
<li>The <em>Your locked pages</em> panel shows the pages you’ve locked so that only you can edit them.<ul>
<li>The date you locked the page is displayed to the right.</li>
<li>Clicking the name of a page will take you to the ‘Edit page’ interface for this page.</li>
</ul>
</li>
<li>The <em>Your most recent edits</em> table displays the five pages that you most recently edited.<ul>
<li>The date that you edited the page is displayed. Hover your mouse over the date for a more exact time/date.</li>
<li>The current status of the page is displayed. A page will have one of a number of statuses:<ul>
<li>Live: Published and accessible to website visitors</li>
<li>Draft:  Not live on the website</li>
<li>In Moderation: In the middle of a moderation workflow</li>
<li>Scheduled: Not live, but has a publication date set</li>
<li>Expired: Not live - this page was unpublished as it had an expiry date set which has now passed</li>
<li>Live + Draft: A version of the page is live, but a newer version is in draft mode.</li>
<li>Live + (another status): A version of the page is live, but a newer version has another status.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<span id="document-editor_manual/finding_your_way_around/the_explorer_menu"></span><div class="section" id="the-explorer-menu">
<h5>The Explorer menu<a class="headerlink" href="#the-explorer-menu" title="Permalink to this headline">¶</a></h5>
<img alt="_images/screen03_explorer_menu.png" src="_images/screen03_explorer_menu.png" />
<ul class="simple">
<li>Click the Pages button in the sidebar to open the explorer. This allows you to navigate through the sections of the site.</li>
<li>Clicking the name of a page will take you to the Explorer page for that section.</li>
<li>Clicking the edit icon for a page will take you to its edit screen.</li>
<li>Clicking the arrow takes you to the sub-section.</li>
<li>Clicking the section title takes you back to where you were.</li>
</ul>
</div>
<span id="document-editor_manual/finding_your_way_around/using_search"></span><div class="section" id="using-search">
<h5>Using search<a class="headerlink" href="#using-search" title="Permalink to this headline">¶</a></h5>
<img alt="_images/screen04_search_screen.png" src="_images/screen04_search_screen.png" />
<ul class="simple">
<li>A very easy way to find the page that you want is to use the main search feature, accessible from the left-hand menu.</li>
<li>Simply type in part or all of the name of the page you are looking for, and the results below will automatically update as you type.</li>
<li>Clicking the page title in the results will take you to the Edit page for that result. You can differentiate between similar named pages using the Parent column, which tells you what the parent page of that page is.</li>
</ul>
</div>
<span id="document-editor_manual/finding_your_way_around/the_explorer_page"></span><div class="section" id="the-explorer-page">
<h5>The Explorer page<a class="headerlink" href="#the-explorer-page" title="Permalink to this headline">¶</a></h5>
<p>The Explorer page allows you to view a page’s children and perform actions on them. From here you can publish/unpublish pages, move pages to other sections, drill down further into the content tree, or reorder pages under the parent for the purposes of display in menus.</p>
<img alt="_images/screen05_explorer_page.png" src="_images/screen05_explorer_page.png" />
<ul class="simple">
<li>The name of the section you are looking at is displayed below the breadcrumb (the row of page names beginning with the home icon). Each section is also itself a page (in this case the homepage). Clicking the title of the section takes you to the Edit screen for the section page.</li>
<li>As the heading suggests, below are the child pages of the section. Clicking the titles of each child page will take you to its Edit screen.</li>
</ul>
<img alt="_images/screen06_explorer_page_arrow.png" src="_images/screen06_explorer_page_arrow.png" />
<ul class="simple">
<li>Clicking the arrows will display a further level of child pages.</li>
</ul>
<img alt="_images/screen07_explorer_page_breadcrumb.png" src="_images/screen07_explorer_page_breadcrumb.png" />
<ul class="simple">
<li>As you drill down through the site the breadcrumb (the row of pages beginning with the home icon) will display the path you have taken. Clicking on the page titles in the breadcrumb will take you to the Explorer screen for that page.</li>
</ul>
<img alt="_images/screen08_add_page_button.png" src="_images/screen08_add_page_button.png" />
<ul class="simple">
<li>To add further child pages press the Add child page button below the parent page title. You can view the parent page on the live site by pressing the View live button. The Move button will take you to the Move page screen where you can reposition the page and all its child pages in the site structure.</li>
<li>Similar buttons are available for each child page. These are made visible on hover.</li>
</ul>
<div class="section" id="reordering-pages">
<h6>Reordering pages<a class="headerlink" href="#reordering-pages" title="Permalink to this headline">¶</a></h6>
<img alt="_images/screen08.5_reorder_page_handles.png" src="_images/screen08.5_reorder_page_handles.png" />
<ul class="simple">
<li>Clicking the “Sort” control in the header row will enable the reordering handles. This allows you to reorder the way that content displays in the main menu of your website.</li>
<li>Reorder by dragging the pages by the handles on the far left (the icon made up of 6 dots).</li>
<li>Your new order will be automatically saved each time you drag and drop an item.</li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-editor_manual/new_pages/index"></span><div class="section" id="creating-new-pages">
<h4>Creating new pages<a class="headerlink" href="#creating-new-pages" title="Permalink to this headline">¶</a></h4>
<img alt="_images/screen08_add_page_button1.png" src="_images/screen08_add_page_button1.png" />
<p>Create new pages by clicking the <strong>Add child page</strong> button. This creates a child page of the section you are currently in. In this case a child page of the ‘School of Fine Art’ page.</p>
<div class="toctree-wrapper compound">
<span id="document-editor_manual/new_pages/selecting_a_page_type"></span><div class="section" id="selecting-a-page-type">
<h5>Selecting a page type<a class="headerlink" href="#selecting-a-page-type" title="Permalink to this headline">¶</a></h5>
<img alt="_images/screen09_page_type_selection.png" src="_images/screen09_page_type_selection.png" />
<ul class="simple">
<li>On the left of the page chooser screen are listed all the types of pages that you can create. Clicking the page type name will take you to the Create new page screen for that page type (see below).</li>
<li>Clicking the <em>Pages using … Page</em> links on the right will display all the pages that exist on the website of this type. This is to help you judge what type of page you will need to complete your task.</li>
</ul>
<img alt="_images/screen10_blank_page_edit_screen.png" src="_images/screen10_blank_page_edit_screen.png" />
<ul class="simple">
<li>Once you’ve selected a page type you will be presented with a blank New page screen.</li>
<li>Click into the areas below each field’s heading to start entering content.</li>
</ul>
</div>
<span id="document-editor_manual/new_pages/creating_body_content"></span><div class="section" id="creating-page-body-content">
<h5>Creating page body content<a class="headerlink" href="#creating-page-body-content" title="Permalink to this headline">¶</a></h5>
<p>Wagtail supports a number of basic fields for creating content, as well as our unique StreamField feature which allows you to construct complex layouts by combining these basic fields in any order.</p>
<div class="section" id="streamfield">
<h6>StreamField<a class="headerlink" href="#streamfield" title="Permalink to this headline">¶</a></h6>
<p>StreamField allows you to create complex layouts of content on a page by combining a number of different arrangements of content, ‘blocks’, in any order.</p>
<img alt="_images/screen11_empty_streamfield.png" src="_images/screen11_empty_streamfield.png" />
<p>When you first edit a page, you will be presented with the empty StreamField area, with the option to choose one of several block types. The block types on your website may be different from the screenshot here, but the principles are the same.</p>
<p>Click the block type, and the options will disappear, revealing the entry field for that block.</p>
<p>Depending on the block you chose, the field will display differently, and there might even be more than one field! There are a few common field types though that we will talk about here.</p>
<ul class="simple">
<li>Basic text field</li>
<li>Rich text field</li>
<li>Image field</li>
</ul>
<div class="section" id="basic-text-field">
<h7>Basic text field<a class="headerlink" href="#basic-text-field" title="Permalink to this headline">¶</a></h7>
<p>Basic text fields have no formatting options. How these display will be determined by the style of the page in which they are being inserted. Just click into the field and type!</p>
</div>
<div class="section" id="rich-text-fields">
<h7>Rich text fields<a class="headerlink" href="#rich-text-fields" title="Permalink to this headline">¶</a></h7>
<p>Most of the time though, you need formatting options to create beautiful looking pages. Wagtail provides “rich text” fields, which have formatting options similar to those of word processors.</p>
<img alt="_images/screen11.1_streamfield_richtext.png" src="_images/screen11.1_streamfield_richtext.png" />
<p>Those fields present a set of tools which allow you to format and style your text. These tools also allow you to insert links, images, videos clips and links to documents. If you want to know more about a specific tool, hover your mouse on the corresponding button so the tooltip appears:</p>
<img alt="_images/screen11.2_toolbar_tooltips.png" src="_images/screen11.2_toolbar_tooltips.png" />
<p>This tooltip shows a longer description of the tool, and displays its keyboard shortcut if there is one. If the keyboard shortcut does not start with CTRL or ⌘, it’s a <a class="reference external" href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> shortcut to type directly in the editor:</p>
<img alt="_images/screen11.3_keyboard_shortcuts_.gif" src="_images/screen11.3_keyboard_shortcuts_.gif" />
<hr class="docutils" />
<p>That’s the gist of it! If you want more information about the editor, please have a look at its dedicated <a class="reference external" href="https://www.draftail.org/docs/user-guide">user guide</a>. It also contains a list of all of the available keyboard shortcuts, and some tricks and gotchas.</p>
</div>
<div class="section" id="adding-further-blocks-in-streamfield">
<h7>Adding further blocks in StreamField<a class="headerlink" href="#adding-further-blocks-in-streamfield" title="Permalink to this headline">¶</a></h7>
<img alt="_images/screen11.8_adding_new_blocks.png" src="_images/screen11.8_adding_new_blocks.png" />
<ul class="simple">
<li>To add new blocks, click the ‘+’ icons above or below the existing blocks.</li>
<li>You’ll then be presented once again with the different blocks from which you may choose.</li>
<li>You can cancel the addition of a new block by clicking the cross at the top of the block selection interface.</li>
<li>You can duplicate a block (including the content) using the button towards the top right corner of an existing block.</li>
</ul>
</div>
<div class="section" id="reordering-and-deleting-content-in-streamfield">
<h7>Reordering and deleting content in StreamField<a class="headerlink" href="#reordering-and-deleting-content-in-streamfield" title="Permalink to this headline">¶</a></h7>
<img alt="_images/screen11.9_streamfield_reordering.png" src="_images/screen11.9_streamfield_reordering.png" />
<ul class="simple">
<li>Click the arrows on the right-hand side of each block to move blocks up and down in the StreamField order of content.</li>
<li>The blocks will be displayed in the front-end in the order that they are placed in this interface.</li>
<li>Click the rubbish bin on the far right to delete a field</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Once a StreamField field is deleted it cannot be retrieved if the page has not been saved. Save your pages regularly so that if you accidentally delete a field you can reload the page to undo your latest edit.</p>
</div>
</div>
</div>
</div>
<span id="document-editor_manual/new_pages/inserting_images"></span><div class="section" id="inserting-images-in-a-page">
<span id="inserting-images"></span><h5>Inserting images in a page<a class="headerlink" href="#inserting-images-in-a-page" title="Permalink to this headline">¶</a></h5>
<p>There will obviously be many instances in which you will want to add images to a page. There are two main ways to add images to pages, either via a specific image chooser field, or via the rich text field image button. Which of these you use will be dependent on the individual setup of your site.</p>
<div class="section" id="inserting-images-using-the-image-chooser-field">
<h6>Inserting images using the image chooser field<a class="headerlink" href="#inserting-images-using-the-image-chooser-field" title="Permalink to this headline">¶</a></h6>
<p>Often a specific image field will be used for a main image on a page, or for an image to be used when sharing the page on social media. For the standard page on Torchbox.com, the former is used.</p>
<img alt="_images/screen14_add_main_image.png" src="_images/screen14_add_main_image.png" />
<ul class="simple">
<li>You insert an image by clicking the <em>Choose an image</em> button.</li>
</ul>
</div>
<div class="section" id="choosing-an-image-to-insert">
<h6>Choosing an image to insert<a class="headerlink" href="#choosing-an-image-to-insert" title="Permalink to this headline">¶</a></h6>
<p>You have two options when selecting an image to insert:</p>
<ol class="arabic simple">
<li>Selecting an image from the existing image library, or…</li>
<li>Uploading a new image to the CMS</li>
</ol>
<p>When you click the <em>Choose an image</em> button you will be presented with a pop-up with two tabs at the top. The first, Search, allows you to search and select from the library. The second, <em>Upload</em>, allows you to upload a new image.</p>
<p><strong>Choosing an image from the image library</strong></p>
<p>The image below demonstrates finding and  inserting an image that is already present in the CMS image library.</p>
<img alt="_images/screen16_selecting_image_from_library.png" src="_images/screen16_selecting_image_from_library.png" />
<ol class="arabic simple">
<li>Typing into the search box will automatically display the results below.</li>
<li>Clicking one of the Popular tags will filter the search results by that tag.</li>
<li>Clicking an image will take you to the Choose a format window (see image below).</li>
</ol>
<p><strong>Uploading a new image to the CMS</strong></p>
<img alt="_images/screen17_upload_image.png" src="_images/screen17_upload_image.png" />
<ol class="arabic simple">
<li>You must include an image title for your uploaded image</li>
<li>Click the <em>Choose file</em> button to choose an image from your computer.</li>
<li><em>Tags</em> allows you to associate tags with the image you are uploading. This allows them to be more easily found when searching. Each tag should be separated by a space. Good practice for creating multiple word tags is to use an underscore between each word (e.g. western_yellow_wagtail).</li>
<li>Click <em>Upload</em> to insert the uploaded image into the carousel. The image will also be added to the main CMS image library for reuse in other content.</li>
</ol>
</div>
<div class="section" id="inserting-images-using-the-rich-text-field">
<h6>Inserting images using the rich text field<a class="headerlink" href="#inserting-images-using-the-rich-text-field" title="Permalink to this headline">¶</a></h6>
<p>Images can also be inserted into the body text of a page via the rich text editor. When working in a rich text field, click the Image control. You will then be presented with the same options as for inserting images into the main carousel.</p>
<p>In addition, Wagtail allows you to choose the format of your image.</p>
<img alt="_images/screen18_image_format.png" src="_images/screen18_image_format.png" />
<ol class="arabic simple">
<li>You can select how the image is displayed by selecting one of the format options.</li>
<li>You can choose if the image is <a class="reference external" href="https://www.w3.org/WAI/tutorials/images/decorative/">decorative</a>, in which case you will not need to enter alt text for your image.</li>
<li>If you do not choose for the image to be decorative, you must provide specific <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Images_in_HTML#Alternative_text">alt text</a> for your image.</li>
</ol>
<p>The format options available are described below:</p>
<ul class="simple">
<li><strong>Full width:</strong> Image will be inserted using the full width of the text area.</li>
<li><strong>Half-width left/right aligned:</strong> Inserts the image at half the width of the text area. If inserted in a block of text, the text will wrap around the image. If two half-width images are inserted together, they will display next to each other.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The display of images formatted in this way is dependent on your implementation of Wagtail, so you may get slightly different results.</p>
</div>
</div>
</div>
<span id="document-editor_manual/new_pages/inserting_links"></span><div class="section" id="inserting-links-in-a-page">
<span id="inserting-links"></span><h5>Inserting links in a page<a class="headerlink" href="#inserting-links-in-a-page" title="Permalink to this headline">¶</a></h5>
<p>Similar to images, there are a variety of points at which you will want to add links. The most common place to insert a link will be in the body text of a page. You can insert a link into the body text by clicking the <strong>Insert link</strong> button in the rich text toolbar.</p>
<p>Whichever way you insert a link, you will be presented with the form displayed below.</p>
<img alt="_images/screen19_link_form.png" src="_images/screen19_link_form.png" />
<ul class="simple">
<li>Search for an existing page to link to using the search bar at the top of the pop-up.</li>
<li>Below the search bar you can select the type of link you want to insert. The following types are available:<ul>
<li>Internal link: A link to an existing page within your website.</li>
<li>External link: A link to a page on another website.</li>
<li>Email link: A link that will open the user’s default email client with the email address prepopulated.</li>
<li>Phone link: A link that will open the user’s default client for initiating audio calls, with the phone number prepopulated.</li>
</ul>
</li>
<li>You can also navigate through the website to find an internal link via the explorer.</li>
</ul>
</div>
<span id="document-editor_manual/new_pages/inserting_videos"></span><div class="section" id="inserting-videos-into-body-content">
<span id="inserting-videos"></span><h5>Inserting videos into body content<a class="headerlink" href="#inserting-videos-into-body-content" title="Permalink to this headline">¶</a></h5>
<p>It is possible to embed media into the body text of a web page by clicking the <em>Embed</em> button in rich text toolbar.</p>
<img alt="_images/screen20_insert_video_form.png" src="_images/screen20_insert_video_form.png" />
<ul class="simple">
<li>Copy and paste the web address for the media into the URL field and click Insert.</li>
</ul>
<img alt="_images/screen21_video_in_editor.png" src="_images/screen21_video_in_editor.png" />
<ul class="simple">
<li>A placeholder of the media will be inserted into the text area.</li>
</ul>
<p>The embed button can be used to import media from a number of supported providers, you can see the <a class="reference external" href="https://github.com/wagtail/wagtail/blob/main/wagtail/embeds/oembed_providers.py">full list of supported providers in Wagtail’s source code</a>.</p>
</div>
<span id="document-editor_manual/new_pages/inserting_documents"></span><div class="section" id="inserting-links-to-documents-into-body-text">
<h5>Inserting links to documents into body text<a class="headerlink" href="#inserting-links-to-documents-into-body-text" title="Permalink to this headline">¶</a></h5>
<img alt="_images/screen27_docs_icon.png" src="_images/screen27_docs_icon.png" />
<p>It is possible to insert links to documents held in the CMS into the body text of a web page by clicking the button above in the rich text field.</p>
<p>The process for doing this is the same as when inserting an image. You are given the choice of either choosing a document from the CMS, or uploading a new document.</p>
<img alt="_images/screen28_docs_form.png" src="_images/screen28_docs_form.png" />
</div>
<span id="document-editor_manual/new_pages/adding_multiple_items"></span><div class="section" id="adding-multiple-items">
<h5>Adding multiple items<a class="headerlink" href="#adding-multiple-items" title="Permalink to this headline">¶</a></h5>
<p>A common feature of Wagtail is the ability to add more than one of a particular type of field or item. For example, you can add as many carousel items or related links as you wish.</p>
<img alt="_images/screen24_multiple_items_closed.png" src="_images/screen24_multiple_items_closed.png" />
<ul class="simple">
<li>Whenever you see the white cross in the green circle illustrated here, it means you can add multiple objects or items to a page. Clicking the icon will display the fields required for that piece of content. The image below demonstrates this with a <em>Related link</em> item.</li>
</ul>
<img alt="_images/screen25_multiple_items_open.png" src="_images/screen25_multiple_items_open.png" />
<ul class="simple">
<li>You can delete an individual item by pressing the trash can in the top-right.</li>
<li>You can add more items by clicking the link with the white cross again.</li>
</ul>
<img alt="_images/screen26_reordering_multiple_items.png" src="_images/screen26_reordering_multiple_items.png" />
<ul class="simple">
<li>You can reorder your multiple items using the up and down arrows. Doing this will affect the order in which they are displayed on the live page.</li>
</ul>
</div>
<span id="document-editor_manual/new_pages/required_fields"></span><div class="section" id="required-fields">
<h5>Required fields<a class="headerlink" href="#required-fields" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Fields marked with an asterisk are required. You will not be able to save a draft or submit the page for moderation without these fields being completed.</li>
</ul>
<img alt="_images/screen22_required_field.png" src="_images/screen22_required_field.png" />
<ul class="simple">
<li>If you try to save/submit the page with some required fields not filled out, you will see the error displayed here.</li>
<li>The number of validation errors for each of the <em>Promote</em> and <em>Content</em> tabs will appear in a red circle, and the text, ‘This field is required’, will appear below each field that must be completed.</li>
</ul>
<img alt="_images/screen23_validation_error.png" src="_images/screen23_validation_error.png" />
</div>
<span id="document-editor_manual/new_pages/the_promote_tab"></span><div class="section" id="edit-page-tabs">
<h5>Edit Page tabs<a class="headerlink" href="#edit-page-tabs" title="Permalink to this headline">¶</a></h5>
<p>A common feature of the <em>Edit</em> pages for all page types is the three tabs at the top of the screen. The first, <em>Content</em>, is where you build the content of the page itself.</p>
<div class="section" id="the-promote-tab">
<h6>The Promote tab<a class="headerlink" href="#the-promote-tab" title="Permalink to this headline">¶</a></h6>
<p>The Promote tab is where you can configure a page’s metadata, to help search engines find and index it. Below is a description of all the default fields under this tab.</p>
<p><strong>For Search Engines</strong></p>
<ul class="simple">
<li><strong>Slug:</strong> The section of the URL that appears after your website’s domain e.g. <code class="docutils literal notranslate"><span class="pre">http://domain.com/blog/[my-slug]/</span></code>. This is automatically generated from the main page title, which is set in the Content tab. Slugs should be entirely lowercase, with words separated by hyphens (-). It is recommended that you don’t change a page’s slug once a page is published.</li>
<li><strong>Title tag:</strong> This is the bold headline that often shows up search engine results. This is one of the most significant elements of how search engines rank the page. The keywords used here should align with the keywords you wish to be found for. If you don’t think this field is working, ask your developers to check they have configured the site to output the appropriate tags on the frontend.</li>
<li><strong>Meta description:</strong> This is the descriptive text displayed underneath a headline in search engine results. It is designed to explain what this page is about. It has no impact on how search engines rank your content, but it can impact on the likelihood that a user will click your result. Ideally 140 to 155 characters in length. If you don’t think this field is working, ask your developers to check they have configured the site to output the appropriate tags on the frontend.</li>
</ul>
<p><strong>For Site Menus</strong></p>
<ul class="simple">
<li><strong>Show in menus:</strong> Ticking this box will ensure that the page is included in automatically generated menus on your site. Note: A page will only display in menus if all of its parent pages also have <em>Show in menus</em> ticked.</li>
</ul>
<img alt="_images/screen26.5_promote_tab.png" src="_images/screen26.5_promote_tab.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may see more fields than this in your promote tab. These are just the default fields, but you are free to add other fields to this section as necessary.</p>
</div>
</div>
<div class="section" id="the-settings-tab">
<h6>The Settings Tab<a class="headerlink" href="#the-settings-tab" title="Permalink to this headline">¶</a></h6>
<p>The <em>Settings</em> tab has three fields by default.</p>
<ul class="simple">
<li><strong>Go Live date/time:</strong> Sets the date and time at which the changes should go live when published. See <a class="reference internal" href="index.html#scheduled-publishing"><span class="std std-ref">Scheduled Publishing</span></a> for more details.</li>
<li><strong>Expiry date/time:</strong> Sets the date and time at which this page should be unpublished.</li>
<li><strong>Privacy:</strong> Sets restrictions for who can view the page on the frontend. Also applies to all child pages.</li>
</ul>
</div>
</div>
<span id="document-editor_manual/new_pages/previewing_and_submitting_for_moderation"></span><div class="section" id="previewing-and-submitting-pages-for-moderation">
<h5>Previewing and submitting pages for moderation<a class="headerlink" href="#previewing-and-submitting-pages-for-moderation" title="Permalink to this headline">¶</a></h5>
<p>The Save/Preview/Submit for moderation menu is always present at the bottom of the page edit/creation screen. The menu allows you to perform the following actions, dependent on whether you are an editor, moderator or administrator:</p>
<ul class="simple">
<li><strong>Save draft:</strong> Saves your current changes but doesn’t submit the page for moderation and so won’t be published. (all roles)</li>
<li><strong>Submit for moderation:</strong> Saves your current changes and submits the page for moderation. The page will then enter a moderation workflow: a set of tasks which, when all are approved, will publish the page (by default, depending on your site <a class="reference internal" href="index.html#workflow-settings"><span class="std std-ref">settings</span></a>). This button may be missing if the site administrator has <a class="reference internal" href="index.html#wagtail-moderation-enabled"><span class="std std-ref">disabled moderation</span></a>, or hasn’t assigned a workflow to this part of the site.  (all roles)</li>
<li><strong>Preview:</strong> Opens a new window displaying the page as it would look if published, but does not save your changes or submit the page for moderation. (all roles)</li>
<li><strong>Publish/Unpublish:</strong> Clicking the <em>Publish</em> button will publish this page. Clicking the <em>Unpublish</em> button will take you to a confirmation screen asking you to confirm that you wish to unpublish this page. If a page is published it will be accessible from its specific URL and will also be displayed in site search results. (moderators and administrators only)</li>
<li><strong>Delete:</strong> Clicking this button will take you to a confirmation screen asking you to confirm that you wish to delete the current page. Be sure that this is actually what you want to do, as deleted pages are not recoverable. In many situations simply unpublishing the page will be enough. (moderators and administrators only)</li>
</ul>
<img alt="_images/screen13_publish_menu.png" src="_images/screen13_publish_menu.png" />
</div>
</div>
</div>
<span id="document-editor_manual/editing_existing_pages"></span><div class="section" id="editing-existing-pages">
<h4>Editing existing pages<a class="headerlink" href="#editing-existing-pages" title="Permalink to this headline">¶</a></h4>
<p>Here is how you can access the edit screen of an existing page:</p>
<ul class="simple">
<li>Clicking the title of the page in an <a class="reference internal" href="index.html#document-editor_manual/finding_your_way_around/the_explorer_page"><span class="doc">Explorer page</span></a> or in <a class="reference internal" href="index.html#document-editor_manual/finding_your_way_around/using_search"><span class="doc">search results</span></a>.</li>
<li>Clicking the <em>Edit</em> link below the title in either of the situations above.</li>
<li>Clicking the <em>Edit</em> icon for a page in the explorer menu.</li>
</ul>
<img alt="_images/screen12_edit_screen_overview.png" src="_images/screen12_edit_screen_overview.png" />
<ul class="simple">
<li>When editing an existing page the title of the page being edited is displayed at the top of the page.</li>
<li>Underneath the title, you can find the page type and a link to the page history.</li>
<li>If published, a link to the live version of the page is shown on the top right.</li>
<li>You can toggle commenting mode by clicking the icon in the top right, which also shows the number of comments.</li>
<li>You can change the title of the page by clicking into the title field.</li>
<li>When you’re typing into a field, help text is often displayed on the right-hand side of the screen.</li>
</ul>
<div class="section" id="workflow">
<h5>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h5>
<p>If the page is currently in a workflow, you’ll see an additional indicator underneath the title, showing the current workflow task. Clicking this will
show more information about the page’s progress through the workflow, as well as any comments left by reviewers.</p>
<img alt="_images/screen12.5_edit_screen_in_moderation.png" src="_images/screen12.5_edit_screen_in_moderation.png" />
<p>If you can perform moderation actions (for example, approval or requesting changes) on the current task, you’ll see additional options in the
action menu at the bottom of the page.</p>
</div>
<div class="section" id="commenting">
<span id="id1"></span><h5>Commenting<a class="headerlink" href="#commenting" title="Permalink to this headline">¶</a></h5>
<p>Use the comment icon at the top right to enable commenting mode. If there are comments on the page, the number
of comments is shown alongside the icon.</p>
<p>When in commenting mode, hovering over a commentable field or block will reveal a comment button.</p>
<img alt="_images/screen49_new_comment_icon.png" src="_images/screen49_new_comment_icon.png" />
<p>If there is no pre-existing comment on the field, you can use this to create a new comment.</p>
<img alt="_images/screen52_new_comment.png" src="_images/screen52_new_comment.png" />
<p>If there is an existing comment, clicking either the field button or the comment will bring the comment thread into focus, allowing you to
add new replies.</p>
<img alt="_images/screen48_comment_thread.png" src="_images/screen48_comment_thread.png" />
<p>Within a rich text field, you can highlight text and click the comment button to add an inline comment.</p>
<img alt="_images/screen51_draftail_comment.png" src="_images/screen51_draftail_comment.png" />
<p>All of these actions can also be performed using the comment shortcut, <code class="docutils literal notranslate"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">Alt</span> <span class="pre">+</span> <span class="pre">M</span></code> / <code class="docutils literal notranslate"><span class="pre">⌘</span> <span class="pre">+</span> <span class="pre">Alt</span> <span class="pre">+</span> <span class="pre">M</span></code>.</p>
<p>Clicking the three dots in the top right of an existing comment will open its menu. This allows you to
resolve a comment, as well as to edit or delete any of your own comments.</p>
<img alt="_images/screen50_comment_menu.png" src="_images/screen50_comment_menu.png" />
<p>Any comments or changes to comments will only be saved when the page is saved.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently, fields inside <code class="docutils literal notranslate"><span class="pre">InlinePanels</span></code> and <code class="docutils literal notranslate"><span class="pre">ListBlocks</span></code> are uncommentable.</p>
</div>
<p>The arrow to the right of the comments icon shows the comment notifications
panel, where you can enable or disable email notifications for other users’ comments on the page.</p>
<img alt="_images/screen53_commenting_notifications.png" src="_images/screen53_commenting_notifications.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You will always receive email notifications for threads you are part of, unless you opt out of all comment notifications in your
account settings.</p>
</div>
</div>
</div>
<span id="document-editor_manual/copying_aliasing_existing_pages"></span><div class="section" id="copying-and-creating-aliases-to-existing-pages">
<h4>Copying and creating aliases to existing pages<a class="headerlink" href="#copying-and-creating-aliases-to-existing-pages" title="Permalink to this headline">¶</a></h4>
<div class="section" id="copying-pages">
<span id="copying-page-label"></span><h5>Copying Pages<a class="headerlink" href="#copying-pages" title="Permalink to this headline">¶</a></h5>
<p>Sometimes you might not need to create a new page from scratch. For example, you could have several pages that are very similar in terms of structure, but differ in content. In that case, you can copy an existing page and only change the required parts.</p>
<p>Here is how to copy an existing page:</p>
<ul class="simple">
<li>When you hover over a page in an <a class="reference internal" href="index.html#document-editor_manual/finding_your_way_around/the_explorer_page"><span class="doc">Explorer page</span></a>, click on <em>More</em> and then <em>Copy</em>.</li>
</ul>
<img alt="Copy action available when hovering over a page in an explorer page" src="_images/screen12.6_1_copy_from_explorer_menu.png" />
<ul class="simple">
<li>You are then taken to a form where you can enter the copy’s title, slug and choose the parent page (if you want to change it). You then get the option to publish the copied page right away and an option to mark the copy as an alias of the original page (see <a class="reference internal" href="#aliasing-page-label"><span class="std std-ref">Aliasing pages</span></a> for more information about aliasing pages).</li>
</ul>
<img alt="Copy page form with the options to change the title, slug, parent page, published status and option to create an alias." src="_images/screen12.6_2_copy_input_information.png" />
<ul class="simple">
<li>Once you completed this form, press <em>Copy this page</em>. The page will then be copied and appear in the Explorer page.</li>
</ul>
<img alt="Successful copying of a page results in it being available in the Explorer page." src="_images/screen12.6_3_copy_success.png" />
</div>
<div class="section" id="aliasing-pages">
<span id="aliasing-page-label"></span><h5>Aliasing pages<a class="headerlink" href="#aliasing-pages" title="Permalink to this headline">¶</a></h5>
<p>When copying a page, you also have the option to mark it as an alias. The content of an aliased page will stay in sync with the original. This is particularly useful when a page is required to be available in multiple places.
For example, let’s say you have a page about Brioche in the Breads section. You then want to also make this page available in the Pastries section. One way to do this is to create a copy of the Brioche page and change the parent page to the Pastries page. However you now need to remember to update this copy each time the original is modified. If a copy is marked as an alias Wagtail will do this for you each time a modification to the original page is published.</p>
<p>Here is how to create an alias to an existing page:</p>
<ul class="simple">
<li>The first step is the same as it is for <a class="reference internal" href="#copying-page-label"><span class="std std-ref">Copying Pages</span></a>. When you hover over a page in the <a class="reference internal" href="index.html#document-editor_manual/finding_your_way_around/the_explorer_page"><span class="doc">Explorer page</span></a>, click on <em>More</em> and then <em>Copy</em>.</li>
<li>When you get to the copy page form, you can then choose another page as the parent page. Click the <em>Choose another page</em> button.</li>
</ul>
<img alt="Clicking the choose another page button during the copy page form in order to change the parent of the copied page." src="_images/screen12.7_1_alias_choose_parent_page_button.png" />
<ul class="simple">
<li>Select and click on the desired parent page.</li>
</ul>
<img alt="Selecting and clicking the desired parent page." src="_images/screen12.7_2_alias_choose_new_parent_page.png" />
<ul class="simple">
<li>Make sure the <em>Alias</em> checkbox is ticked.</li>
<li>You can then complete the page aliasing by clicking on the <em>Copy this page</em> button.</li>
</ul>
<img alt="Clicking on the Copy this page button to confirm aliasing." src="_images/screen12.7_3_alias_confirm_changes.png" />
<ul class="simple">
<li>The aliased page will then appear under the new parent in the Explorer.</li>
</ul>
<img alt="The aliased page appearing under the new parent page in the Explorer page." src="_images/screen12.7_3_alias_page_new_parent.png" />
<ul class="simple">
<li>When you try to edit the aliased page, you are notified that it is an alias of another page. You will then be offered two options: edit the original page (with changes appearing in both places) or convert the alias page into an ordinary page (i.e. a conventional copy, not updated when the original changes).</li>
</ul>
<img alt="Editing an alias page notifies it is an alias and offers to either edit the original page or change the alias to an ordinary page." src="_images/screen12.7_4_alias_page_edit_notification.png" />
</div>
</div>
<span id="document-editor_manual/documents_images_snippets/index"></span><div class="section" id="managing-documents-images-snippets-and-collections">
<h4>Managing documents, images, snippets and collections<a class="headerlink" href="#managing-documents-images-snippets-and-collections" title="Permalink to this headline">¶</a></h4>
<p>Wagtail allows you to manage all of your documents and images through their own dedicated interfaces. See below for information on each of these elements.</p>
<div class="toctree-wrapper compound">
<span id="document-editor_manual/documents_images_snippets/documents"></span><div class="section" id="documents">
<h5>Documents<a class="headerlink" href="#documents" title="Permalink to this headline">¶</a></h5>
<p>Documents such as PDFs can be managed from the Documents interface, available in the left-hand menu. This interface allows you to add documents to and remove documents from the CMS.</p>
<img alt="_images/screen29_documents_page.png" src="_images/screen29_documents_page.png" />
<ul class="simple">
<li>Add documents by clicking the <em>Add document</em> button in the top-right.</li>
<li>Search for documents in the CMS by entering your search term in the search bar. The results will be automatically updated as you type.</li>
<li>You can also filter the results by <em>Collection</em> by selecting one from the collections dropdown above the documents list.</li>
<li>Edit the details of a document by clicking the document title.</li>
</ul>
<img alt="_images/screen30_documents_edit_page.png" src="_images/screen30_documents_edit_page.png" />
<ul class="simple">
<li>When editing a document you can replace the file associated with that document record. This means you can update documents without having to update the pages on which they are placed. Changing the file will change it on all pages that use the document.</li>
<li>Change the document’s collection using the collection dropdown.</li>
<li>Add or remove tags using the Tags field.</li>
<li>Save or delete documents using the buttons at the bottom of the interface.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Deleted documents cannot be recovered.</p>
</div>
</div>
<span id="document-editor_manual/documents_images_snippets/images"></span><div class="section" id="images">
<h5>Images<a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h5>
<p>If you want to edit, add or remove images from the CMS outside of the individual pages you can do so from the Images interface. This is accessed from the left-hand menu.</p>
<img alt="_images/screen31_images_page.png" src="_images/screen31_images_page.png" />
<ul class="simple">
<li>Clicking an image will allow you to edit the data associated with it. This includes the title, the focal point of the image and much more.</li>
</ul>
<img alt="_images/screen32_image_edit_page.png" src="_images/screen32_image_edit_page.png" />
<div class="section" id="changing-the-image">
<h6>Changing the image<a class="headerlink" href="#changing-the-image" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>When editing an image you can replace the file associated with that image record. This means you can update images without having to update the pages on which they are placed.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Changing the file will change it on all pages that use the image.</p>
</div>
</div>
<div class="section" id="focal-area">
<h6>Focal area<a class="headerlink" href="#focal-area" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>This interface allows you to select a focal area which can effect how your image displays to visitors on the front-end.</li>
<li>If your images are cropped in some way to make them fit to a specific shape, then the focal area will define the centre point from which the image is cropped.</li>
<li>To set the focal area, drag a marquee around the most important element of the image.</li>
<li>To remove the focal area, hit the button below the image.</li>
<li>If the feature is set up in your website, then on the front-end you will see the crop of this image focusing on your selection.</li>
</ul>
</div>
</div>
<span id="document-editor_manual/documents_images_snippets/snippets"></span><div class="section" id="snippets">
<h5>Snippets<a class="headerlink" href="#snippets" title="Permalink to this headline">¶</a></h5>
<p>Snippets allow you to create elements on a website once and reuse them in multiple places. Then, if you want to change something on the snippet, you only need to change it once, and it will change across all the occurrences of the snippet.</p>
<p>How snippets are used can vary widely between websites. Here are a few examples of things Torchbox have used snippets for on our clients’ websites:</p>
<ul class="simple">
<li>For staff contact details, so that they can be added to many pages but managed in one place</li>
<li>For Adverts, either to be applied sitewide or on individual pages</li>
<li>To manage links in a global area of the site, for example in the footer</li>
<li>For Calls to Action, such as Newsletter sign up blocks, that may be consistent across many different pages</li>
</ul>
<div class="section" id="the-snippets-menu">
<h6>The Snippets menu<a class="headerlink" href="#the-snippets-menu" title="Permalink to this headline">¶</a></h6>
<img alt="_images/screen33_snippet_menu.png" src="_images/screen33_snippet_menu.png" />
<ul class="simple">
<li>You can access the Snippets menu by clicking on the ‘Snippets’ link in the left-hand menu bar.</li>
<li>To add or edit a snippet, click on the snippet type you are interested in (often help text will be included to help you in selecting the right type)</li>
<li>Click on an individual snippet to edit, or click ‘Add …’ in the top right to add a new snippet</li>
<li>To delete snippets, select one or more snippets with the tickbox on the left and then click the delete button near the top right</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Editing a snippet will change it on all of the pages on which it has been used. In the top-right of the Snippet edit screen you will see a label saying how many times the snippet has been used. Clicking this label will display a listing of all of these pages.</p>
</div>
<img alt="_images/screen34_snippet_used_times.png" src="_images/screen34_snippet_used_times.png" />
</div>
<div class="section" id="adding-snippets-whilst-editing-a-page">
<h6>Adding snippets whilst editing a page<a class="headerlink" href="#adding-snippets-whilst-editing-a-page" title="Permalink to this headline">¶</a></h6>
<p>If you are editing a page, and you find yourself in need of a new snippet, do not fear! You can create a new one without leaving the page you are editing:</p>
<ul class="simple">
<li>Whilst editing the page, open the snippets interface in a new tab, either by Ctrl+click (cmd+click on Mac) or by right clicking it and selecting ‘Open in new tab’ from the resulting menu.</li>
<li>Add the snippet in this new tab as you normally would.</li>
<li>Return to your existing tab and reopen the Snippet chooser window.</li>
<li>You should now see your new snippet, even though you didn’t leave the edit page.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even though this is possible, it is worth saving your page as a draft as often as possible, to avoid your changes being lost by navigating away from the edit page accidentally.</p>
</div>
</div>
</div>
<span id="document-editor_manual/documents_images_snippets/collections"></span><div class="section" id="collections">
<h5>Collections<a class="headerlink" href="#collections" title="Permalink to this headline">¶</a></h5>
<p>Access to specific sets of images and documents can be controlled by setting up ‘collections’. By default all images and documents belong to the ‘root’ collection, but new collections can be created through the <strong>Settings -&gt; Collections</strong> area of the admin interface.</p>
<img alt="_images/collections_list.png" src="_images/collections_list.png" />
<div class="section" id="add-a-collection">
<h6>Add a collection<a class="headerlink" href="#add-a-collection" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Clicking the <strong>add a collection</strong> button will allow you to create a collection. Name your collection and click <strong>save</strong> .</li>
</ul>
<img alt="_images/collections_create_collection.png" src="_images/collections_create_collection.png" />
</div>
<div class="section" id="add-images-documents-to-a-collection">
<h6>Add images / documents to a collection<a class="headerlink" href="#add-images-documents-to-a-collection" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Navigate to the <strong>Images</strong> or <strong>Documents</strong> section and select a collection from the dropdown menu.</li>
</ul>
<img alt="_images/collections_create_collection_upload_images.png" src="_images/collections_create_collection_upload_images.png" />
<img alt="_images/collections_add_to_collection.png" src="_images/collections_add_to_collection.png" />
<ul class="simple">
<li>You can also edit an image or document directly by clicking on it to assign it to a collection.</li>
</ul>
<img alt="_images/collections_edit_img_view.png" src="_images/collections_edit_img_view.png" />
</div>
<div class="section" id="privacy-settings">
<h6>Privacy settings<a class="headerlink" href="#privacy-settings" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>To set permissions determining who is able to view documents within a collection, navigate to <strong>Settings &gt; Collections</strong> and select a collection.  Then click the privacy button above the collection name.</li>
</ul>
<img alt="_images/collections_privacy_button.png" src="_images/collections_privacy_button.png" />
<ul class="simple">
<li>Within the privacy settings overlay, select the level of privacy for the collection.</li>
</ul>
<img alt="_images/collections_privacy_overlay.png" src="_images/collections_privacy_overlay.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Permissions set on ‘root’ apply to all collections, so a user with ‘edit’ permission for images on root can edit all images; permissions set on other collections apply to that collection only.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-editor_manual/managing_redirects"></span><div class="section" id="managing-redirects">
<span id="id1"></span><h4>Managing Redirects<a class="headerlink" href="#managing-redirects" title="Permalink to this headline">¶</a></h4>
<div class="section" id="about-redirects">
<h5>About redirects<a class="headerlink" href="#about-redirects" title="Permalink to this headline">¶</a></h5>
<p>When dealing with publishing and unpublishing pages you will eventually need to make redirects.
A redirect ensures that when a page is no longer available (404), the visitor and search engines are sent to a new page.
Therefore the visitor won’t end up in a breaking journey which would result in a page not found.</p>
<p>Wagtail considers two types of configurable redirects depending on whether <em>Permanent</em> is checked or not:</p>
<ul class="simple">
<li>Permanent redirect (checked by default)</li>
<li>Temporary redirect</li>
</ul>
<p>For both redirects the visitor won’t experience a difference when visiting a page, but the search engine will react to these two type of redirects differently.</p>
<ul class="simple">
<li>In the case of a temporary redirect a search engine will keep track of your old page and will index the redirected page as well.</li>
<li>With a permanent redirect, the search engine will mark the old page as obsolete and considers the new page as a replacement.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As a best practice Wagtail will check redirects as permanent by default, in order to prevent the undermining of your search engine ranking.</p>
</div>
</div>
<div class="section" id="configuring-redirects">
<h5>Configuring redirects<a class="headerlink" href="#configuring-redirects" title="Permalink to this headline">¶</a></h5>
<img alt="_images/screen41_redirects_menu_item.png" src="_images/screen41_redirects_menu_item.png" />
<p>To configure redirects head over to ‘Redirects’, which can be found in the Settings menu, accessible via the left-hand menu bar.</p>
<img alt="_images/screen42_redirects_interface.png" src="_images/screen42_redirects_interface.png" />
<ul class="simple">
<li>Add a redirect by clicking the <em>Add redirect</em> button in the top-right.</li>
<li>Search for redirects already configured by entering your search term in the search bar. The results will be automatically updated as you type.</li>
<li>Edit the details of a redirect by clicking the URL path in the listing.</li>
</ul>
<img alt="_images/screen43_redirects_edit_redirect.png" src="_images/screen43_redirects_edit_redirect.png" />
<ul class="simple">
<li>Set <em>Redirect from</em> to the URL pattern which is no longer available on your site.</li>
<li>Set the <em>From site</em> if applicable (for eg: a multisite environment).</li>
<li>Check whether the redirect is <em>Permanent</em> or temporary (unchecked).</li>
</ul>
<p>As a last step you can either redirect to a new page within Wagtail <strong>or</strong> you can redirect the page to a different domain outside of Wagtail.</p>
<ul class="simple">
<li>Select your page from the explorer for <em>Redirect to a page</em>.</li>
<li>Set a full-domain and path for <em>Redirect to any URL</em>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Keep in mind a redirect will only be initiated if the page is not found.
It will not be applied to existing pages (200) which will resolve on your site.</p>
</div>
</div>
</div>
<span id="document-editor_manual/administrator_tasks/index"></span><div class="section" id="administrator-tasks">
<h4>Administrator tasks<a class="headerlink" href="#administrator-tasks" title="Permalink to this headline">¶</a></h4>
<p>This section of the guide documents how to perform common tasks as an administrator of a Wagtail site.</p>
<div class="toctree-wrapper compound">
<span id="document-editor_manual/administrator_tasks/managing_users"></span><div class="section" id="managing-users-and-roles">
<h5>Managing users and roles<a class="headerlink" href="#managing-users-and-roles" title="Permalink to this headline">¶</a></h5>
<p>As an administrator, a common task will be adding, modifying or removing user profiles.</p>
<p>This is done via the ‘Users’ interface, which can be found in the Settings menu, accessible via the left-hand menu bar.</p>
<img alt="_images/screen35_users_menu_item.png" src="_images/screen35_users_menu_item.png" />
<p>In this interface you can see all of your users, their usernames, their ‘level’ of access (otherwise known as their ‘role’), and their status, either active or inactive.</p>
<p>You can sort this listing either via Name or Username.</p>
<img alt="_images/screen36_users_interface.png" src="_images/screen36_users_interface.png" />
<p>Clicking on a user’s name will open their profile details. From here you can then edit that users details.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is possible to change user’s passwords in this interface, but it is worth encouraging your users to use the ‘Forgotten password’ link on the login screen instead. This should save you some time!</p>
</div>
<p>Click the ‘Roles’ tab to edit the level of access your users have. By default there are three roles:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="29%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Role</th>
<th class="head">Create/view drafts</th>
<th class="head">Publish content</th>
<th class="head">Access Settings</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Editor</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>Moderator</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr class="row-even"><td>Administrator</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
</tbody>
</table>
</div>
<span id="document-editor_manual/administrator_tasks/managing_workflows"></span><div class="section" id="managing-workflows">
<span id="id1"></span><h5>Managing Workflows<a class="headerlink" href="#managing-workflows" title="Permalink to this headline">¶</a></h5>
<p>Workflows allow you to configure how moderation works on your site. Workflows are sequences of tasks, all of which must be approved
before the workflow completes (by default, this results in the publication of the page, but depends on your site <a class="reference internal" href="index.html#workflow-settings"><span class="std std-ref">settings</span></a>).</p>
<p>The workflow management interface is accessed via the <cite>Workflows</cite> item in the <cite>Settings</cite> submenu, found in the left menu bar.</p>
<img alt="_images/screen45_workflow_index.png" src="_images/screen45_workflow_index.png" />
<p>In this interface you can see all of the workflows on your site, and the order of tasks in each. You can click on a workflow to edit it or to assign it
to part of the page tree, or use the <cite>Add a workflow</cite> button to create a new workflow. The number of pages each workflow applies to is also shown, and can be
clicked for a complete listing.</p>
<div class="section" id="editing-workflows">
<h6>Editing workflows<a class="headerlink" href="#editing-workflows" title="Permalink to this headline">¶</a></h6>
<img alt="_images/screen44_workflow_edit1.png" src="_images/screen44_workflow_edit1.png" />
<p>Under <cite>Add tasks to your workflow</cite>, you can add, remove, or reorder tasks in a workflow. When adding a task to a workflow, you will be given the
option to create a new task, or reuse an existing one.</p>
<p>Under <cite>Assign your workflow to pages</cite>, you can see a list of the pages to which the workflow has been assigned: any child pages will also have the same workflow,
so if a workflow is assigned to the root page, it becomes the default workflow. You may remove it from pages using the <cite>Delete</cite> button to
the right of each entry, or assign it to a page using the <cite>Choose a page</cite> button.</p>
<p>The action menu at the bottom allows you to save your changes, or to disable the workflow, which will cancel all pages currently in moderation on this workflow, and prevent others from starting it.
On a previously disabled workflow, there is also the option to enable it again.</p>
</div>
<div class="section" id="creating-and-editing-tasks">
<h6>Creating and editing tasks<a class="headerlink" href="#creating-and-editing-tasks" title="Permalink to this headline">¶</a></h6>
<img alt="_images/screen46_task_index.png" src="_images/screen46_task_index.png" />
<p>In the tasks interface, accessible via the <cite>Workflow Tasks</cite> item in the <cite>Settings</cite> submenu, you can see a list of the tasks
currently available, as well as which workflows use each task. Similarly to workflows, you can click an existing task to edit it, or the <cite>Add a task</cite> button to create a new task.</p>
<p>When creating a task, if you have multiple task types available, these will be offered as options. By default, only <cite>group approval tasks</cite> are available.
Creating a <cite>group approval task</cite>, you will be able to select one or multiple groups: members of any of these, as well as administrators, will be able to
approve or reject moderation for this task.</p>
<img alt="_images/screen47_task_create.png" src="_images/screen47_task_create.png" />
<p>When editing a task, you may find that some fields - including the name - are uneditable. This is to ensure workflow history
remains consistent - if you find yourself needing to change the name, it is recommended that you disable the old task, and create a new one with the name
you need. Disabling a task will cause any pages currently in moderation on that task to skip to the next task.</p>
</div>
</div>
<span id="document-editor_manual/administrator_tasks/promoted_search_results"></span><div class="section" id="promoted-search-results">
<h5>Promoted search results<a class="headerlink" href="#promoted-search-results" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Promoted search results are an optional Wagtail feature. For details of how to enable them on a Wagtail installation, see <a class="reference internal" href="index.html#module-wagtail.contrib.search_promotions" title="wagtail.contrib.search_promotions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">search_promotions</span></code></a></p>
</div>
<p>Wagtail allows you to promote certain search results dependent on the keyword or phrase entered by the user when searching. This can be particularly useful when users commonly refer to parts of your organisation via an acronym that isn’t in official use, or if you want to direct users to a page when they enter a certain term related to the page but not included in the text of the page itself.</p>
<p>As a concrete example, one of our clients wanted to direct people who searched for ‘finances’ to their ‘Annual budget review’ page. The word ‘finances’ is not mentioned in either the title or the body of the target page, so they created a promoted search result for the word ‘finances’ that pushed the budget page to the very top of the results.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The promoted result will only work if the user types <em>exactly</em> the phrase that you have set it up for. If you have variations of a phrase that you want to take into account, then you must create additional promoted results.</p>
</div>
<p>To set up the promoted search results, click on the ‘Promoted search results’ menu item in the ‘Settings’ menu.</p>
<img alt="_images/screen37_promoted_menu_item.png" src="_images/screen37_promoted_menu_item.png" />
<p>Add a new promoted result from the button in the top right of the resulting screen, or edit an existing promoted result by clicking on it.</p>
<img alt="_images/screen38_promoted_results_listing.png" src="_images/screen38_promoted_results_listing.png" />
<p>When adding a new promoted result, Wagtail provides you with a ‘Choose from popular search terms’ option. This will show you the most popular terms entered by users into your internal search. You can match this list against your existing promoted results to ensure that users are able to find what they are looking for.</p>
<img alt="_images/screen38.5_popular_search_results.png" src="_images/screen38.5_popular_search_results.png" />
<p>You then add a the result itself by clicking ‘Add recommended page’. You can add multiple results, but be careful about adding too many, as you may end up hiding all of your organic results with promoted results, which may not be helpful for users who aren’t really sure what they are looking for.</p>
<img alt="_images/screen39_add_promoted_result.png" src="_images/screen39_add_promoted_result.png" />
</div>
</div>
</div>
<span id="document-editor_manual/browser_issues"></span><div class="section" id="browser-issues">
<h4>Browser issues<a class="headerlink" href="#browser-issues" title="Permalink to this headline">¶</a></h4>
<p>Some issues with Wagtail may come from the browser. Try <a class="reference external" href="https://www.refreshyourcache.com/">clearing the browser cache and cookies</a>, or you can also try using Wagtail with <a class="reference external" href="https://browsehappy.com/">another browser</a> to see if the problem persists.</p>
<p>JavaScript is required to use Wagtail – make sure it is <a class="reference external" href="https://www.enable-javascript.com/">enabled in your browser</a>.</p>
<div class="section" id="supported-browsers">
<h5>Supported browsers<a class="headerlink" href="#supported-browsers" title="Permalink to this headline">¶</a></h5>
<p>For the best experience and security, we recommend that you keep your browser up to date. Go to <a class="reference external" href="https://browsehappy.com/">Browse Happy</a> for more information.</p>
</div>
<div class="section" id="ie11">
<span id="id1"></span><h5>IE11<a class="headerlink" href="#ie11" title="Permalink to this headline">¶</a></h5>
<p>Wagtail is gradually removing support for the legacy Internet Explorer browser over the course of <a class="reference external" href="https://github.com/wagtail/wagtail/wiki/Release-schedule">future releases</a>.</p>
<ul class="simple">
<li>In Wagtail 2.11 (LTS), there will be a warning message displayed on the Wagtail dashboard for IE11 users with administrator role.</li>
<li>In Wagtail 2.12, the message will be displayed to all users regardless of their role.</li>
<li>In Wagtail 2.13, the message will be displayed at the top of all pages.</li>
<li>Wagtail will no longer support IE11 starting in version 2.14.</li>
</ul>
<p>If this affects you or your organisation, consider which alternative browsers you may be able to use.
Wagtail is fully compatible with Microsoft Edge, Microsoft’s replacement for Internet Explorer. You may consider using its <a class="reference external" href="https://docs.microsoft.com/en-us/deployedge/edge-ie-mode">IE mode</a> to keep access to IE11-only sites, while other sites and apps like Wagtail can leverage modern browser capabilities.</p>
<p>We are looking for feedback on this change to our support policy, please <a class="reference external" href="https://github.com/wagtail/wagtail/issues/6170">get in touch</a> if it affects you and there are no clear alternatives.</p>
</div>
<div class="section" id="assistive-technologies">
<h5>Assistive technologies<a class="headerlink" href="#assistive-technologies" title="Permalink to this headline">¶</a></h5>
<p>We want Wagtail to be accessible for users of a wide range of assistive technologies, but are aware of many blockers currently. For an overview, see our <a class="reference external" href="https://docs.google.com/spreadsheets/d/1l7tnpEyJiC5BWE_JX0XCkknyrjxYA5T2aee5JgPnmi4/edit">public accessibility audit</a>.</p>
</div>
</div>
</div>
</div>
<span id="document-contributing/index"></span><div class="section" id="contributing-to-wagtail">
<h3>Contributing to Wagtail<a class="headerlink" href="#contributing-to-wagtail" title="Permalink to this headline">¶</a></h3>
<div class="section" id="issues">
<h4>Issues<a class="headerlink" href="#issues" title="Permalink to this headline">¶</a></h4>
<p>The easiest way to contribute to Wagtail is to tell us how to improve it! First, check to see if your bug or feature request has already been submitted at <a class="reference external" href="https://github.com/wagtail/wagtail/issues">github.com/wagtail/wagtail/issues</a>. If it has, and you have some supporting information which may help us deal with it, comment on the existing issue. If not, please <a class="reference external" href="https://github.com/wagtail/wagtail/issues/new">create a new one</a>, providing as much relevant context as possible. For example, if you’re experiencing problems with installation, detail your environment and the steps you’ve already taken. If something isn’t displaying correctly, tell us what browser you’re using, and include a screenshot if possible.</p>
<p>If your bug report is a security issue, <strong>do not</strong> report it with an issue. Please read our ​guide to <a class="reference internal" href="index.html#document-contributing/security"><span class="doc">reporting security issues</span></a>.</p>
<div class="toctree-wrapper compound">
<span id="document-contributing/issue_tracking"></span><div class="section" id="issue-tracking">
<h5>Issue tracking<a class="headerlink" href="#issue-tracking" title="Permalink to this headline">¶</a></h5>
<p>We welcome bug reports, feature requests and pull requests through Wagtail’s <a class="reference external" href="https://github.com/wagtail/wagtail/issues">Github issue tracker</a>.</p>
<div class="section" id="issues">
<h6>Issues<a class="headerlink" href="#issues" title="Permalink to this headline">¶</a></h6>
<p>An issue must always correspond to a specific action with a well-defined completion state: fixing a bug, adding a new feature, updating documentation, cleaning up code. Open-ended issues where the end result is not immediately clear (“come up with a way of doing translations”) are fine, as long as there’s a clear way to progress the issue and identify when it has been completed (not e.g. “make rich text fields suck less”).</p>
<p>Do not use issues for support queries or other questions (“How do I do X?” - although “Implement a way of doing X” or “Document how to do X” could well be valid issues). These should be asked on <a class="reference external" href="https://stackoverflow.com/questions/tagged/wagtail">Stack Overflow</a>, or for discussions that do not fit Stack Overflow’s question-and-answer format, the <a class="reference external" href="https://groups.google.com/forum/#!forum/wagtail">Wagtail Support Google group</a>.</p>
<p>As soon as a ticket is opened - ideally within one day - a member of the core team will give it an initial classification, by either closing it as invalid or assigning it to a milestone. Don’t be discouraged if you feel that your ticket has been given a lower priority than it deserves - this decision isn’t permanent. We will consider all feedback, and reassign or reopen tickets where appropriate.</p>
<p>(From the other side, this means that the core team member doing the classification should feel free to make bold unilateral decisions - there’s no need to seek consensus first. If they make the wrong judgement call, that can always be reversed later.)</p>
<p>The possible milestones that it might be assigned to are as follows:</p>
<ul class="simple">
<li><strong>invalid</strong> (closed): this issue doesn’t identify a specific action to be taken, or the action is not one that we want to take. For example - a bug report for something that’s working as designed, or a feature request for something that’s actively harmful.</li>
<li><strong>some-day</strong>: the issue is accepted as valid (i.e. it’s a bug report for a legitimate bug, or a useful feature request) but not deemed a priority to work on (in the opinion of the core team). For example - a bug that’s only cosmetic, or a feature that would be kind of neat but not really essential. There are no resources allocated to it - feel free to take it on!</li>
<li><strong>real-soon-now</strong>: no-one on the core team has resources allocated to work on this right now, but we know it’s a pain point, and it will be prioritised whenever we next get a chance to choose something new to work on. In practice, that kind of free choice doesn’t happen very often - there are lots of pressures determining what we work on from day to day - so if this is a feature or fix you need, we encourage you to work on it and contribute a pull request, rather than waiting for the core team to get round to it!</li>
<li>A specific version number (eg. <strong>1.6</strong>): the issue is important enough that it needs to be fixed in this version. There are resources allocated and/or plans to work on the issue in the given version.</li>
</ul>
<p>On some occasions it may take longer for the core team to classify an issue into a milestone. For example:</p>
<ul class="simple">
<li>It may require a non-trivial amount of work to confirm the presence of a bug. In this case, feedback and further details from other contributors, whether or not they can replicate the bug, would be particularly welcomed.</li>
<li>It may require further discussion to decide whether the proposal is a good idea or not - if so, it will be tagged “design decision needed”.</li>
</ul>
<p>We will endeavour to make sure that issues don’t remain in this state for prolonged periods. Issues and PRs tagged “design decision needed” will be revisited regularly and discussed with at least two core contributors - we aim to review each ticket at least once per release cycle (= 6 weeks) as part of weekly core team meetings.</p>
</div>
<div class="section" id="pull-requests">
<h6>Pull requests<a class="headerlink" href="#pull-requests" title="Permalink to this headline">¶</a></h6>
<p>As with issues, the core team will classify pull requests as soon as they are opened, usually within one day. Unless the change is invalid or particularly contentious (in which case it will be closed or marked as “design decision needed”), it will generally be classified under the next applicable version - the next minor release for new features, or the next patch release for bugfixes - and marked as ‘Needs review’.</p>
<ul class="simple">
<li>All contributors, core and non-core, are invited to offer feedback on the pull request.</li>
<li>Core team members are invited to assign themselves to the pull request for review.</li>
</ul>
<p>Subsequently (ideally within a week or two, but possibly longer for larger submissions) a core team member will merge it if it is ready to be merged, or tag it as requiring further work (‘needs work’ / ‘needs tests’ / ‘needs docs’). In the latter case, they may also reassign it to a later milestone (‘real-soon-now’ or ‘some-day’). Pull requests that require further work are handled and prioritised in the same way as issues - anyone is welcome to pick one up from the backlog, whether or not they were the original committer.</p>
<p>Rebasing / squashing of pull requests is welcome, but not essential. When doing so, do not squash commits that need reviewing into previous ones and make sure to preserve the sequence of changes. To fix mistakes in earlier commits, use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">--fixup</span></code> so that the final merge can be done with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rebase</span> <span class="pre">-i</span> <span class="pre">--autosquash</span></code>.</p>
<p>Core team members working on Wagtail are expected to go through the same process with their own fork of the project.</p>
</div>
<div class="section" id="release-schedule">
<h6>Release schedule<a class="headerlink" href="#release-schedule" title="Permalink to this headline">¶</a></h6>
<p>We aim to release a new version every 2 months. To keep to this schedule, we will tend to ‘bump’ issues and PRs to a future release where necessary, rather than let them delay the present one. For this reason, an issue being tagged under a particular release milestone should not be taken as any kind of guarantee that the feature will actually be shipped in that release.</p>
</div>
</div>
</div>
</div>
<div class="section" id="pull-requests">
<h4>Pull requests<a class="headerlink" href="#pull-requests" title="Permalink to this headline">¶</a></h4>
<p>If you’re a Python or Django developer, <a class="reference external" href="https://github.com/wagtail/wagtail/">fork it</a> and read the <a class="reference internal" href="index.html#developing"><span class="std std-ref">developing docs</span></a> to get stuck in! We welcome all contributions, whether they solve problems which are specific to you or they address existing issues. If you’re stuck for ideas, pick something from the <a class="reference external" href="https://github.com/wagtail/wagtail/issues?state=open">issue list</a>, or email us directly on <a class="reference external" href="mailto:hello&#37;&#52;&#48;wagtail&#46;io">hello<span>&#64;</span>wagtail<span>&#46;</span>io</a> if you’d like us to suggest something!</p>
<p>For large-scale changes, we’d generally recommend breaking them down into smaller pull requests that achieve a single well-defined task and can be reviewed individually. If this isn’t possible, we recommend opening a pull request on the <a class="reference external" href="https://github.com/wagtail/rfcs/">Wagtail RFCs</a> repository, so that there’s a chance for the community to discuss the change before it gets implemented.</p>
<div class="toctree-wrapper compound">
<span id="document-contributing/developing"></span><div class="section" id="development">
<span id="developing"></span><h5>Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h5>
<p>Setting up a local copy of <a class="reference external" href="https://github.com/wagtail/wagtail">the Wagtail git repository</a> is slightly more involved than running a release package of Wagtail, as it requires <a class="reference external" href="https://nodejs.org/">Node.js</a> and NPM for building JavaScript and CSS assets. (This is not required when running a release version, as the compiled assets are included in the release package.)</p>
<p>If you’re happy to develop on a virtual machine, the <a class="reference external" href="https://github.com/wagtail/vagrant-wagtail-develop">vagrant-wagtail-develop</a> and <a class="reference external" href="https://github.com/wagtail/docker-wagtail-develop">docker-wagtail-develop</a> setup scripts are the fastest way to get up and running. They will provide you with a running instance of the <a class="reference external" href="https://github.com/wagtail/bakerydemo/">Wagtail Bakery demo site</a>, with the Wagtail and bakerydemo codebases available as shared folders for editing on your host machine.</p>
<p>(Build scripts for other platforms would be very much welcomed - if you create one, please let us know via the <a class="reference external" href="https://github.com/wagtail/wagtail/wiki/Slack">Slack workspace</a>!)</p>
<p>If you’d prefer to set up all the components manually, read on. These instructions assume that you’re familiar with using pip and virtualenv to manage Python packages.</p>
<div class="section" id="setting-up-the-wagtail-codebase">
<h6>Setting up the Wagtail codebase<a class="headerlink" href="#setting-up-the-wagtail-codebase" title="Permalink to this headline">¶</a></h6>
<p>Install Node.js, version 14. Instructions for installing Node.js can be found on the <a class="reference external" href="https://nodejs.org/download/">Node.js download page</a>.
You can also use Node version manager (nvm) since Wagtail supplies a <code class="docutils literal notranslate"><span class="pre">.nvmrc</span></code> file in the root of the project with the minimum required Node version - see nvm’s <a class="reference external" href="https://github.com/creationix/nvm">installation instructions</a>.</p>
<p>You will also need to install the <strong>libjpeg</strong> and <strong>zlib</strong> libraries, if you haven’t done so already - see Pillow’s <a class="reference external" href="https://pillow.readthedocs.org/en/latest/installation.html#external-libraries">platform-specific installation instructions</a>.</p>
<p>Clone a copy of <a class="reference external" href="https://github.com/wagtail/wagtail">the Wagtail codebase</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git clone https://github.com/wagtail/wagtail.git
<span class="gp">$ </span><span class="nb">cd</span> wagtail
</pre></div>
</div>
<p>With your preferred virtualenv activated, install the Wagtail package in development mode with the included testing and documentation dependencies:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip install -e .<span class="o">[</span>testing,docs<span class="o">]</span> -U
<span class="gp">$ </span><span class="c1"># or if using zsh as your shell:</span>
<span class="gp">$ </span><span class="c1">#    pip install -e &#39;.[testing,docs]&#39; -U</span>
</pre></div>
</div>
<p>Install Node through nvm (optional):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>nvm install
</pre></div>
</div>
<p>Install the tool chain for building static assets:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>npm install --no-save
</pre></div>
</div>
<p>Compile the assets:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>npm run build
</pre></div>
</div>
<p>Any Wagtail sites you start up in this virtualenv will now run against this development instance of Wagtail.  We recommend using the <a class="reference external" href="https://github.com/wagtail/bakerydemo/">Wagtail Bakery demo site</a> as a basis for developing Wagtail. Keep in mind that the setup steps for a Wagtail site may include installing a release version of Wagtail, which will override the development version you’ve just set up. In this case, you should install the site before running the <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span></code> step, or re-run that step after the site is installed.</p>
</div>
<div class="section" id="testing">
<span id="id2"></span><h6>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h6>
<p>From the root of the Wagtail codebase, run the following command to run all the tests:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python runtests.py
</pre></div>
</div>
<div class="section" id="running-only-some-of-the-tests">
<h7>Running only some of the tests<a class="headerlink" href="#running-only-some-of-the-tests" title="Permalink to this headline">¶</a></h7>
<p>At the time of writing, Wagtail has well over 2500 tests, which takes a while to
run. You can run tests for only one part of Wagtail by passing in the path as
an argument to <code class="docutils literal notranslate"><span class="pre">runtests.py</span></code> or <code class="docutils literal notranslate"><span class="pre">tox</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="c1"># Running in the current environment</span>
<span class="gp">$ </span>python runtests.py wagtail.core

<span class="gp">$ </span><span class="c1"># Running in a specified Tox environment</span>
<span class="gp">$ </span>tox -e py36-dj22-sqlite-noelasticsearch wagtail.core

<span class="gp">$ </span><span class="c1"># See a list of available Tox environments</span>
<span class="gp">$ </span>tox -l
</pre></div>
</div>
<p>You can also run tests for individual TestCases by passing in the path as
an argument to <code class="docutils literal notranslate"><span class="pre">runtests.py</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="c1"># Running in the current environment</span>
<span class="gp">$ </span>python runtests.py wagtail.core.tests.test_blocks.TestIntegerBlock

<span class="gp">$ </span><span class="c1"># Running in a specified Tox environment</span>
<span class="gp">$ </span>tox -e py36-dj22-sqlite-noelasticsearch wagtail.core.tests.test_blocks.TestIntegerBlock
</pre></div>
</div>
</div>
<div class="section" id="running-migrations-for-the-test-app-models">
<h7>Running migrations for the test app models<a class="headerlink" href="#running-migrations-for-the-test-app-models" title="Permalink to this headline">¶</a></h7>
<p>You can create migrations for the test app by running the following from the Wagtail root.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>django-admin makemigrations --settings<span class="o">=</span>wagtail.tests.settings
</pre></div>
</div>
</div>
<div class="section" id="testing-against-postgresql">
<h7>Testing against PostgreSQL<a class="headerlink" href="#testing-against-postgresql" title="Permalink to this headline">¶</a></h7>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In order to run these tests, you must install the required modules for PostgreSQL as described in Django’s <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/databases/">Databases documentation</a>.</p>
</div>
<p>By default, Wagtail tests against SQLite. You can switch to using PostgreSQL by
using the <code class="docutils literal notranslate"><span class="pre">--postgres</span></code> argument:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python runtests.py --postgres
</pre></div>
</div>
<p>If you need to use a different user, password, host or port, use the <code class="docutils literal notranslate"><span class="pre">PGUSER</span></code>, <code class="docutils literal notranslate"><span class="pre">PGPASSWORD</span></code>, <code class="docutils literal notranslate"><span class="pre">PGHOST</span></code> and <code class="docutils literal notranslate"><span class="pre">PGPORT</span></code> environment variables respectively.</p>
</div>
<div class="section" id="testing-against-a-different-database">
<h7>Testing against a different database<a class="headerlink" href="#testing-against-a-different-database" title="Permalink to this headline">¶</a></h7>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In order to run these tests, you must install the required client libraries and modules for the given database as described in Django’s <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/settings/#databases">Databases</a> documentation or 3rd-party database backend’s documentation.</p>
</div>
<p>If you need to test against a different database, set the <code class="docutils literal notranslate"><span class="pre">DATABASE_ENGINE</span></code>
environment variable to the name of the Django database backend to test against:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nv">DATABASE_ENGINE</span><span class="o">=</span>django.db.backends.mysql python runtests.py
</pre></div>
</div>
<p>This will create a new database called <code class="docutils literal notranslate"><span class="pre">test_wagtail</span></code> in MySQL and run
the tests against it.</p>
<p>If you need to use different connection settings, use the following environment variables which correspond to the respective keys within Django’s <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/settings/#databases">DATABASES</a> settings dictionary:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">DATABASE_ENGINE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">DATABASE_NAME</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">DATABASE_PASSWORD</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">DATABASE_HOST</span></code><ul>
<li>Note that for MySQL, this must be <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> rather than <code class="docutils literal notranslate"><span class="pre">localhost</span></code> if you need to connect using a TCP socket</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">DATABASE_PORT</span></code></li>
</ul>
<p>It is also possible to set <code class="docutils literal notranslate"><span class="pre">DATABASE_DRIVER</span></code>, which corresponds to the <cite>driver</cite> value within <cite>OPTIONS</cite> if an SQL Server engine is used.</p>
</div>
<div class="section" id="testing-elasticsearch">
<h7>Testing Elasticsearch<a class="headerlink" href="#testing-elasticsearch" title="Permalink to this headline">¶</a></h7>
<p>You can test Wagtail against Elasticsearch by passing the <code class="docutils literal notranslate"><span class="pre">--elasticsearch</span></code>
argument to <code class="docutils literal notranslate"><span class="pre">runtests.py</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python runtests.py --elasticsearch
</pre></div>
</div>
<p>Wagtail will attempt to connect to a local instance of Elasticsearch
(<code class="docutils literal notranslate"><span class="pre">http://localhost:9200</span></code>) and use the index <code class="docutils literal notranslate"><span class="pre">test_wagtail</span></code>.</p>
<p>If your Elasticsearch instance is located somewhere else, you can set the
<code class="docutils literal notranslate"><span class="pre">ELASTICSEARCH_URL</span></code> environment variable to point to its location:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nv">ELASTICSEARCH_URL</span><span class="o">=</span>http://my-elasticsearch-instance:9200 python runtests.py --elasticsearch
</pre></div>
</div>
</div>
<div class="section" id="browser-and-device-support">
<h7>Browser and device support<a class="headerlink" href="#browser-and-device-support" title="Permalink to this headline">¶</a></h7>
<p>Wagtail is meant to be used on a wide variety of devices and browsers. Supported browser / device versions include:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Browser</th>
<th class="head">Device/OS</th>
<th class="head">Version(s)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Mobile Safari</td>
<td>iOS Phone</td>
<td>Last 2</td>
</tr>
<tr class="row-odd"><td>Mobile Safari</td>
<td>iOS Tablet</td>
<td>Last 2</td>
</tr>
<tr class="row-even"><td>Chrome</td>
<td>Android</td>
<td>Last 2</td>
</tr>
<tr class="row-odd"><td>IE</td>
<td>Desktop</td>
<td>11</td>
</tr>
<tr class="row-even"><td>Chrome</td>
<td>Desktop</td>
<td>Last 2</td>
</tr>
<tr class="row-odd"><td>MS Edge</td>
<td>Desktop</td>
<td>Last 2</td>
</tr>
<tr class="row-even"><td>Firefox</td>
<td>Desktop</td>
<td>Latest</td>
</tr>
<tr class="row-odd"><td>Firefox ESR</td>
<td>Desktop</td>
<td>Latest</td>
</tr>
<tr class="row-even"><td>Safari</td>
<td>macOS</td>
<td>Last 2</td>
</tr>
</tbody>
</table>
<p>We aim for Wagtail to work in those environments. Our development standards ensure that the site is usable on other browsers <strong>and will work on future browsers</strong>. To test on IE, install virtual machines <a class="reference external" href="https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/">made available by Microsoft</a>.</p>
<p>IE 11 is gradually falling out of use, and specific features are unsupported in this browser:</p>
<ul class="simple">
<li>Rich text copy-paste in the rich text editor.</li>
<li>Sticky toolbar in the rich text editor.</li>
<li>Focus outline styles in the main menu &amp; explorer menu.</li>
<li>Keyboard access to the actions in page listing tables.</li>
</ul>
<p><strong>Unsupported browsers / devices include:</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Browser</th>
<th class="head">Device/OS</th>
<th class="head">Version(s)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Stock browser</td>
<td>Android</td>
<td>All</td>
</tr>
<tr class="row-odd"><td>IE</td>
<td>Desktop</td>
<td>10 and below</td>
</tr>
<tr class="row-even"><td>Safari</td>
<td>Windows</td>
<td>All</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="accessibility-targets">
<h7>Accessibility targets<a class="headerlink" href="#accessibility-targets" title="Permalink to this headline">¶</a></h7>
<p>We want to make Wagtail accessible for users of a wide variety of assistive technologies. The specific standard we aim for is <a class="reference external" href="https://www.w3.org/TR/WCAG21/">WCAG2.1</a>, AA level. Here are specific assistive technologies we aim to test for, and ultimately support:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.nvaccess.org/download/">NVDA</a> on Windows with Firefox ESR</li>
<li><a class="reference external" href="https://support.apple.com/en-gb/guide/voiceover-guide/welcome/web">VoiceOver</a> on macOS with Safari</li>
<li><a class="reference external" href="https://support.microsoft.com/en-gb/help/11542/windows-use-magnifier">Windows Magnifier</a> and macOS Zoom</li>
<li>Windows Speech Recognition and macOS Dictation</li>
<li>Mobile <a class="reference external" href="https://support.apple.com/en-gb/guide/voiceover-guide/welcome/web">VoiceOver</a> on iOS, or <a class="reference external" href="https://support.google.com/accessibility/android/answer/6283677?hl=en-GB">TalkBack</a> on Android</li>
<li>Windows <a class="reference external" href="https://support.microsoft.com/en-us/windows/use-high-contrast-mode-in-windows-10-fedc744c-90ac-69df-aed5-c8a90125e696">High-contrast mode</a></li>
</ul>
<p>We aim for Wagtail to work in those environments. Our development standards ensure that the site is usable with other assistive technologies. In practice, testing with assistive technology can be a daunting task that requires specialised training – here are tools we rely on to help identify accessibility issues, to use during development and code reviews:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/dequelabs/react-axe">react-axe</a> integrated directly in our build tools, to identify actionable issues. Logs its results in the browser console.</li>
<li><a class="reference external" href="https://chrome.google.com/webstore/detail/axe/lhdoppojpmngadmnindnejefpokejbdd">Axe</a> Chrome extension for more comprehensive automated tests of a given page.</li>
<li><a class="reference external" href="https://accessibilityinsights.io/docs/en/web/overview">Accessibility Insights for Web</a> Chrome extension for semi-automated tests, and manual audits.</li>
</ul>
</div>
<div class="section" id="known-accessibility-issues">
<h7>Known accessibility issues<a class="headerlink" href="#known-accessibility-issues" title="Permalink to this headline">¶</a></h7>
<p>Wagtail’s administration interface isn’t fully accessible at the moment. We actively work on fixing issues both as part of ongoing maintenance and bigger overhauls. To learn about known issues, check out:</p>
<ul class="simple">
<li>The <a class="reference external" href="https://github.com/wagtail/wagtail/projects/5">WCAG2.1 AA for CMS admin</a> issues backlog.</li>
<li>Our <a class="reference external" href="https://docs.google.com/spreadsheets/d/1l7tnpEyJiC5BWE_JX0XCkknyrjxYA5T2aee5JgPnmi4/edit">2021 accessibility audit</a>.</li>
</ul>
<p>The audit also states which parts of Wagtail have and haven’t been tested, how issues affect WCAG 2.1 compliance, and the likely impact on users.</p>
</div>
</div>
<div class="section" id="compiling-static-assets">
<h6>Compiling static assets<a class="headerlink" href="#compiling-static-assets" title="Permalink to this headline">¶</a></h6>
<p>All static assets such as JavaScript, CSS, images, and fonts for the Wagtail admin are compiled from their respective sources by <code class="docutils literal notranslate"><span class="pre">gulp</span></code>. The compiled assets are not committed to the repository, and are compiled before packaging each new release. Compiled assets should not be submitted as part of a pull request.</p>
<p>To compile the assets, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>npm run build
</pre></div>
</div>
<p>This must be done after every change to the source files. To watch the source files for changes and then automatically recompile the assets, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>npm start
</pre></div>
</div>
</div>
<div class="section" id="compiling-the-documentation">
<h6>Compiling the documentation<a class="headerlink" href="#compiling-the-documentation" title="Permalink to this headline">¶</a></h6>
<p>The Wagtail documentation is built by Sphinx. To install Sphinx and compile the documentation, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span> /path/to/wagtail
<span class="gp">$ </span><span class="c1"># Install the documentation dependencies</span>
<span class="gp">$ </span>pip install -e .<span class="o">[</span>docs<span class="o">]</span>
<span class="gp">$ </span><span class="c1"># or if using zsh as your shell:</span>
<span class="gp">$ </span><span class="c1">#    pip install -e &#39;.[docs]&#39; -U</span>
<span class="gp">$ </span><span class="c1"># Compile the docs</span>
<span class="gp">$ </span><span class="nb">cd</span> docs/
<span class="gp">$ </span>make html
</pre></div>
</div>
<p>The compiled documentation will now be in <code class="docutils literal notranslate"><span class="pre">docs/_build/html</span></code>.
Open this directory in a web browser to see it.
Python comes with a module that makes it very easy to preview static files in a web browser.
To start this simple server, run the following commands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span> docs/_build/html/
<span class="gp">$ </span>python -mhttp.server <span class="m">8080</span>
</pre></div>
</div>
<p>Now you can open &lt;<a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a>&gt; in your web browser to see the compiled documentation.</p>
<p>Sphinx caches the built documentation to speed up subsequent compilations.
Unfortunately, this cache also hides any warnings thrown by unmodified documentation source files.
To clear the built HTML and start fresh, so you can see all warnings thrown when building the documentation, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span> docs/
<span class="gp">$ </span>make clean
<span class="gp">$ </span>make html
</pre></div>
</div>
<p>Wagtail also provides a way for documentation to be compiled automatically on each change.
To do this, you can run the following command to see the changes automatically at <code class="docutils literal notranslate"><span class="pre">localhost:4000</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span> docs/
<span class="gp">$ </span>make livehtml
</pre></div>
</div>
</div>
</div>
<span id="document-contributing/committing"></span><div class="section" id="committing-code">
<h5>Committing code<a class="headerlink" href="#committing-code" title="Permalink to this headline">¶</a></h5>
<p><strong>This section is for the core team of Wagtail, or for anyone interested in the process of getting code committed to Wagtail.</strong></p>
<p>Code should only be committed after it has been reviewed
by at least one other reviewer or committer,
unless the change is a small documentation change or fixing a typo.
If additional code changes are made after the review, it is OK to commit them
without further review if they are uncontroversial and small enough that
there is minimal chance of introducing new bugs.</p>
<p>Most code contributions will be in the form of pull requests from Github.
Pull requests should not be merged from Github, apart from small documentation fixes,
which can be merged with the ‘Squash and merge’ option. Instead, the code should
be checked out by a committer locally, the changes examined and rebased,
the <code class="docutils literal notranslate"><span class="pre">CHANGELOG.txt</span></code> and release notes updated,
and finally the code should be pushed to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch.
This process is covered in more detail below.</p>
<div class="section" id="check-out-the-code-locally">
<h6>Check out the code locally<a class="headerlink" href="#check-out-the-code-locally" title="Permalink to this headline">¶</a></h6>
<p>If the code has been submitted as a pull request,
you should fetch the changes and check them out in your Wagtail repository.
A simple way to do this is by adding the following <code class="docutils literal notranslate"><span class="pre">git</span></code> alias to your <code class="docutils literal notranslate"><span class="pre">~/.gitconfig</span></code> (assuming <code class="docutils literal notranslate"><span class="pre">upstream</span></code> is <code class="docutils literal notranslate"><span class="pre">wagtail/wagtail</span></code>):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[alias]
    pr = !sh -c \&quot;git fetch upstream pull/${1}/head:pr/${1} &amp;&amp; git checkout pr/${1}\&quot;
</pre></div>
</div>
<p>Now you can check out pull request number <code class="docutils literal notranslate"><span class="pre">xxxx</span></code> by running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pr</span> <span class="pre">xxxx</span></code>.</p>
</div>
<div class="section" id="rebase-on-to-main">
<h6>Rebase on to <code class="docutils literal notranslate"><span class="pre">main</span></code><a class="headerlink" href="#rebase-on-to-main" title="Permalink to this headline">¶</a></h6>
<p>Now that you have the code, you should rebase the commits on to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch.
Rebasing is preferred over merging,
as merge commits make the commit history harder to read for small changes.</p>
<p>You can fix up any small mistakes in the commits,
such as typos and formatting, as part of the rebase.
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rebase</span> <span class="pre">--interactive</span></code> is an excellent tool for this job.</p>
<p>Ideally, use this as an opportunity to squash the changes to a few commits, so
each commit is making a single meaningful change (and not breaking anything).
If this is not possible because of the nature of the changes, it’s acceptable
to either squash into a commit or leave all commits unsquashed,
depending on which will be more readable in the commit history.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="c1"># Get the latest commits from Wagtail</span>
<span class="gp">$ </span>git fetch upstream
<span class="gp">$ </span>git checkout main
<span class="gp">$ </span>git merge --ff-only upstream/main
<span class="gp">$ </span><span class="c1"># Rebase this pull request on to main</span>
<span class="gp">$ </span>git checkout pr/xxxx
<span class="gp">$ </span>git rebase main
<span class="gp">$ </span><span class="c1"># Update main to this commit</span>
<span class="gp">$ </span>git checkout main
<span class="gp">$ </span>git merge --ff-only pr/xxxx
</pre></div>
</div>
</div>
<div class="section" id="update-changelog-txt-and-release-notes">
<h6>Update <code class="docutils literal notranslate"><span class="pre">CHANGELOG.txt</span></code> and release notes<a class="headerlink" href="#update-changelog-txt-and-release-notes" title="Permalink to this headline">¶</a></h6>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This should only be done by core committers, once the changes have been reviewed and accepted.</p>
</div>
<p>Every significant change to Wagtail should get an entry in the <code class="docutils literal notranslate"><span class="pre">CHANGELOG.txt</span></code>,
and the release notes for the current version.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">CHANGELOG.txt</span></code> contains a short summary of each new feature, refactoring, or bug fix in each release.
Each summary should be a single line.
Bug fixes should be grouped together at the end of the list for each release,
and be prefixed with “Fix:”.
The name of the contributor should be added at the end of the summary, in brackets.
For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>* Fix: Tags added on the multiple image uploader are now saved correctly (Alex Smith)
</pre></div>
</div>
<p>The release notes for each version contain a more detailed description of each change.
Backwards compatibility notes should also be included.
Large new features or changes should get their own section,
while smaller changes and bug fixes should be grouped together in their own section.
See previous release notes for examples.
The release notes for each version are found in <code class="docutils literal notranslate"><span class="pre">docs/releases/x.x.x.rst</span></code>.</p>
<p>If the contributor is a new person, and this is their first contribution to Wagtail,
they should be added to the <code class="docutils literal notranslate"><span class="pre">CONTRIBUTORS.rst</span></code> list.
Contributors are added in chronological order,
with new contributors added to the bottom of the list.
Use their preferred name.
You can usually find the name of a contributor on their Github profile.
If in doubt, or if their name is not on their profile, ask them how they want to be named.</p>
<p>If the changes to be merged are small enough to be a single commit,
amend this single commit with the additions to
the <code class="docutils literal notranslate"><span class="pre">CHANGELOG.txt</span></code>, release notes, and contributors:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git add CHANGELOG.txt docs/releases/x.x.x.rst CONTRIBUTORS.rst
<span class="gp">$ </span>git commit --amend --no-edit
</pre></div>
</div>
<p>If the changes do not fit in a single commit, make a new commit with the updates to
the <code class="docutils literal notranslate"><span class="pre">CHANGELOG.txt</span></code>, release notes, and contributors.
The commit message should say <code class="docutils literal notranslate"><span class="pre">Release</span> <span class="pre">notes</span> <span class="pre">for</span> <span class="pre">#xxxx</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git add CHANGELOG.txt docs/releases/x.x.x.rst CONTRIBUTORS.rst
<span class="gp">$ </span>git commit -m <span class="s1">&#39;Release notes for #xxxx&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="push-to-main">
<h6>Push to <code class="docutils literal notranslate"><span class="pre">main</span></code><a class="headerlink" href="#push-to-main" title="Permalink to this headline">¶</a></h6>
<p>The changes are ready to be pushed to <code class="docutils literal notranslate"><span class="pre">main</span></code> now.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="c1"># Check that everything looks OK</span>
<span class="gp">$ </span>git log upstream/main..main --oneline
<span class="gp">$ </span>git push --dry-run upstream main
<span class="gp">$ </span><span class="c1"># Push the commits!</span>
<span class="gp">$ </span>git push upstream main
<span class="gp">$ </span>git branch -d pr/xxxx
</pre></div>
</div>
</div>
<div class="section" id="when-you-have-made-a-mistake">
<h6>When you have made a mistake<a class="headerlink" href="#when-you-have-made-a-mistake" title="Permalink to this headline">¶</a></h6>
<p>It’s ok! Everyone makes mistakes. If you realise that recent merged changes
have a negative impact, create a new pull request with a revert of the changes
and merge it without waiting for a review. The PR will serve as additional
documentation for the changes, and will run through the CI tests.</p>
</div>
<div class="section" id="add-commits-to-someone-else-s-pull-request">
<h6>Add commits to someone else’s pull request<a class="headerlink" href="#add-commits-to-someone-else-s-pull-request" title="Permalink to this headline">¶</a></h6>
<p>Github users with write access to wagtail/wagtail (core members) can add
commits to the pull request branch of the contributor.</p>
<p>Given that the contributor username is johndoe and his pull request branch is called foo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git clone git@github.com:wagtail/wagtail.git
<span class="gp">$ </span><span class="nb">cd</span> wagtail
<span class="gp">$ </span>git remote add johndoe git@github.com:johndoe/wagtail.git
<span class="gp">$ </span>git fetch johndoe foo
<span class="gp">$ </span>git checkout johndoe/foo
<span class="gp"># </span>Make changes
<span class="gp"># </span>Commit changes
<span class="gp">$ </span>git push johndoe HEAD:foo
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="translations">
<h4>Translations<a class="headerlink" href="#translations" title="Permalink to this headline">¶</a></h4>
<p>Wagtail has internationalisation support so if you are fluent in a non-English language you can contribute by localising the interface.</p>
<p>Translation work should be submitted through <a class="reference external" href="https://www.transifex.com/projects/p/wagtail/">Transifex</a>.</p>
</div>
<div class="section" id="other-contributions">
<h4>Other contributions<a class="headerlink" href="#other-contributions" title="Permalink to this headline">¶</a></h4>
<p>We welcome contributions to all aspects of Wagtail. If you would like to improve the design of the user interface, or extend the documentation, please submit a pull request as above. If you’re not familiar with Github or pull requests, <a class="reference external" href="mailto:hello&#37;&#52;&#48;wagtail&#46;io">contact us directly</a> and we’ll work something out.</p>
</div>
<div class="section" id="developing-packages-for-wagtail">
<h4>Developing packages for Wagtail<a class="headerlink" href="#developing-packages-for-wagtail" title="Permalink to this headline">¶</a></h4>
<p>If you are developing packages for Wagtail, you can add the following <a class="reference external" href="https://pypi.org/">PyPI</a> classifiers:</p>
<ul class="simple">
<li><a class="reference external" href="https://pypi.org/search/?c=Framework+%3A%3A+Wagtail">Framework :: Wagtail</a></li>
<li><a class="reference external" href="https://pypi.org/search/?c=Framework+%3A%3A+Wagtail+%3A%3A+1">Framework :: Wagtail :: 1</a></li>
<li><a class="reference external" href="https://pypi.org/search/?c=Framework+%3A%3A+Wagtail+%3A%3A+2">Framework :: Wagtail :: 2</a></li>
</ul>
<p>You can also find a curated list of awesome packages, articles, and other cool resources from the Wagtail community at <a class="reference external" href="https://github.com/springload/awesome-wagtail">Awesome Wagtail</a>.</p>
</div>
<div class="section" id="more-information">
<h4>More information<a class="headerlink" href="#more-information" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-contributing/styleguide"></span><div class="section" id="ui-styleguide">
<span id="styleguide"></span><h5>UI Styleguide<a class="headerlink" href="#ui-styleguide" title="Permalink to this headline">¶</a></h5>
<p>Developers working on the Wagtail UI or creating new UI components may wish to test their work against our Styleguide, which is provided as the contrib module “wagtailstyleguide”.</p>
<p>To install the styleguide module on your site, add it to the list of <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> in your settings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">...</span>
    <span class="s1">&#39;wagtail.contrib.styleguide&#39;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This will add a ‘Styleguide’ item to the Settings menu in the admin.</p>
<p>At present the styleguide is static: new UI components must be added to it manually, and there are no hooks into it for other modules to use. We hope to support hooks in the future.</p>
<p>The styleguide doesn’t currently provide examples of all the core interface components; notably the Page, Document, Image and Snippet chooser interfaces are not currently represented.</p>
</div>
<span id="document-contributing/general_guidelines"></span><div class="section" id="general-coding-guidelines">
<h5>General coding guidelines<a class="headerlink" href="#general-coding-guidelines" title="Permalink to this headline">¶</a></h5>
<div class="section" id="language">
<h6>Language<a class="headerlink" href="#language" title="Permalink to this headline">¶</a></h6>
<p>British English is preferred for user-facing text; this text should also be marked for translation (using the <code class="docutils literal notranslate"><span class="pre">django.utils.translation.gettext</span></code> function and <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">trans</span> <span class="pre">%}</span></code> template tag, for example). However, identifiers within code should use American English if the British or international spelling would conflict with built-in language keywords; for example, CSS code should consistently use the spelling <code class="docutils literal notranslate"><span class="pre">color</span></code> to avoid inconsistencies like <code class="docutils literal notranslate"><span class="pre">background-color:</span> <span class="pre">$colour-red</span></code>.</p>
</div>
</div>
<span id="document-contributing/python_guidelines"></span><div class="section" id="python-coding-guidelines">
<h5>Python coding guidelines<a class="headerlink" href="#python-coding-guidelines" title="Permalink to this headline">¶</a></h5>
<div class="section" id="pep8">
<h6>PEP8<a class="headerlink" href="#pep8" title="Permalink to this headline">¶</a></h6>
<p>We ask that all Python contributions adhere to the <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> style guide, apart from the restriction on line length (E501) and some minor docstring-related issues.
The list of PEP8 violations to ignore is in the <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> file, under the <code class="docutils literal notranslate"><span class="pre">[flake8]</span></code> header.
You might want to configure the flake8 linter in your editor/IDE to use the configuration in this file.</p>
<p>In addition, import lines should be sorted according to <a class="reference external" href="https://pycqa.github.io/isort/">isort</a> 5.6.4 rules. If you have installed Wagtail’s testing dependencies (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.[testing]</span></code>), you can check your code by running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">lint</span></code>.</p>
</div>
<div class="section" id="django-compatibility">
<h6>Django compatibility<a class="headerlink" href="#django-compatibility" title="Permalink to this headline">¶</a></h6>
<p>Wagtail is written to be compatible with multiple versions of Django. Sometimes, this requires running one piece of code for recent version of Django, and another piece of code for older versions of Django. In these cases, always check which version of Django is being used by inspecting <code class="docutils literal notranslate"><span class="pre">django.VERSION</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">django</span>

<span class="k">if</span> <span class="n">django</span><span class="o">.</span><span class="n">VERSION</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
    <span class="c1"># Use new attribute</span>
    <span class="n">related_field</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">rel</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Use old, deprecated attribute</span>
    <span class="n">related_field</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">related</span>
</pre></div>
</div>
<p>Always compare against the version using greater-or-equals (<code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>), so that code for newer versions of Django is first.</p>
<p>Do not use a <code class="docutils literal notranslate"><span class="pre">try</span> <span class="pre">...</span> <span class="pre">except</span></code> when seeing if an object has an attribute or method introduced in a newer versions of Django, as it does not clearly express why the <code class="docutils literal notranslate"><span class="pre">try</span> <span class="pre">...</span> <span class="pre">except</span></code> is used. An explicit check against the Django version makes the intention of the code very clear.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Do not do this</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">related_field</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">rel</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="n">related_field</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">related</span>
</pre></div>
</div>
<p>If the code needs to use something that changed in a version of Django many times, consider making a function that encapsulates the check:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">django</span>

<span class="k">def</span> <span class="nf">related_field</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">django</span><span class="o">.</span><span class="n">VERSION</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="n">rel</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="n">related</span>
</pre></div>
</div>
<p>If a new function has been introduced by Django that you think would be very useful for Wagtail, but is not available in older versions of Django that Wagtail supports, that function can be copied over in to Wagtail. If the user is running a new version of Django that has the function, the function should be imported from Django. Otherwise, the version bundled with Wagtail should be used. A link to the Django source code where this function was taken from should be included:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">django</span>

<span class="k">if</span> <span class="n">django</span><span class="o">.</span><span class="n">VERSION</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">django.core.validators</span> <span class="kn">import</span> <span class="n">validate_unicode_slug</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Taken from https://github.com/django/django/blob/1.9/django/core/validators.py#L230</span>
    <span class="k">def</span> <span class="nf">validate_unicode_slug</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="c1"># Code left as an exercise to the reader</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="tests">
<h6>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h6>
<p>Wagtail has a suite of tests, which we are committed to improving and expanding. See <a class="reference internal" href="index.html#testing"><span class="std std-ref">Testing</span></a>.</p>
<p>We run continuous integration to ensure that no commits or pull requests introduce test failures. If your contributions add functionality to Wagtail, please include the additional tests to cover it; if your contributions alter existing functionality, please update the relevant tests accordingly.</p>
</div>
</div>
<span id="document-contributing/html_guidelines"></span><div class="section" id="html-coding-guidelines">
<h5>HTML coding guidelines<a class="headerlink" href="#html-coding-guidelines" title="Permalink to this headline">¶</a></h5>
<p>We use <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/templates/language/">Django templates</a> to author HTML.</p>
<div class="section" id="linting-html">
<h6>Linting HTML<a class="headerlink" href="#linting-html" title="Permalink to this headline">¶</a></h6>
<p>We use <a class="reference external" href="https://github.com/motet-a/jinjalint">jinjalint</a> to lint templates. If you have installed Wagtail’s testing dependencies (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.[testing]</span></code>), you can check your code by running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">lint</span></code>.</p>
</div>
<div class="section" id="principles">
<h6>Principles<a class="headerlink" href="#principles" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Write <a class="reference external" href="https://validator.w3.org/nu/">valid HTML</a>. We target the HTML5 doctype.</li>
<li>Write <a class="reference external" href="https://html5doctor.com/element-index/">semantic HTML</a>.</li>
<li>Consult <a class="reference external" href="https://w3c.github.io/aria-practices/">ARIA Authoring Practices</a>, in particular <a class="reference external" href="https://w3c.github.io/aria-practices/#no_aria_better_bad_aria">No ARIA is better than Bad ARIA</a>.</li>
<li>Attach JavaScript behavior with <code class="docutils literal notranslate"><span class="pre">data-</span></code> attributes, rather than classes or IDs.</li>
<li>For comments, use Django templates syntax instead of HTML.</li>
</ul>
</div>
</div>
<span id="document-contributing/css_guidelines"></span><div class="section" id="css-coding-guidelines">
<h5>CSS coding guidelines<a class="headerlink" href="#css-coding-guidelines" title="Permalink to this headline">¶</a></h5>
<p>Our CSS is written in <a class="reference external" href="https://sass-lang.com/">Sass</a>, using the SCSS syntax.</p>
<div class="section" id="compiling">
<h6>Compiling<a class="headerlink" href="#compiling" title="Permalink to this headline">¶</a></h6>
<p>The SCSS source files are compiled to CSS using the
<a class="reference external" href="https://gulpjs.com/">gulp</a> build system.
This requires <a class="reference external" href="https://nodejs.org">Node.js</a> to run.
To install the libraries required for compiling the SCSS,
run the following from the Wagtail repository root:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>npm install --no-save
</pre></div>
</div>
<p>To compile the assets, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>npm run build
</pre></div>
</div>
<p>Alternatively, the SCSS files can be monitored,
automatically recompiling when any changes are observed, by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>npm start
</pre></div>
</div>
</div>
<div class="section" id="linting-and-formatting-scss">
<h6>Linting and formatting SCSS<a class="headerlink" href="#linting-and-formatting-scss" title="Permalink to this headline">¶</a></h6>
<p>Wagtail uses the <a class="reference external" href="https://stylelint.io/">stylelint</a> linter.
You’ll need Node.js and npm on your development machine.
Ensure project dependencies are installed by running <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span> <span class="pre">--no-save</span></code></p>
<div class="section" id="linting-code">
<h7>Linting code<a class="headerlink" href="#linting-code" title="Permalink to this headline">¶</a></h7>
<p>Run the linter from the wagtail project root:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>npm run lint:css
</pre></div>
</div>
<p>The linter is configured to check your code for adherence to the guidelines
below, plus a little more.</p>
</div>
<div class="section" id="formatting-code">
<h7>Formatting code<a class="headerlink" href="#formatting-code" title="Permalink to this headline">¶</a></h7>
<p>If you want to autofix errors, you can run that command directly with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>npm run lint:css -- --fix
</pre></div>
</div>
</div>
<div class="section" id="changing-the-linter-configuration">
<h7>Changing the linter configuration<a class="headerlink" href="#changing-the-linter-configuration" title="Permalink to this headline">¶</a></h7>
<p>The configuration for the linting rules is managed in an external
repository so that it can be easily shared across other Wagtail projects
or plugins. This configuration can be found at
<a class="reference external" href="https://github.com/wagtail/stylelint-config-wagtail">stylelint-config-wagtail</a>.</p>
</div>
</div>
<div class="section" id="styleguide-reference">
<h6>Styleguide Reference<a class="headerlink" href="#styleguide-reference" title="Permalink to this headline">¶</a></h6>
<div class="section" id="spacing">
<h7>Spacing<a class="headerlink" href="#spacing" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Use soft-tabs with a four space indent. Spaces are the only way to
guarantee code renders the same in any person’s environment.</li>
<li>Put spaces after <code class="docutils literal notranslate"><span class="pre">:</span></code> in property declarations.</li>
<li>Put spaces before <code class="docutils literal notranslate"><span class="pre">{</span></code> in rule declarations.</li>
<li>Put line breaks between rulesets.</li>
<li>When grouping selectors, put each selector on its own line.</li>
<li>Place closing braces of declaration blocks on a new line.</li>
<li>Each declaration should appear on its own line for more accurate
error reporting.</li>
<li>Add a newline at the end of your <code class="docutils literal notranslate"><span class="pre">.scss</span></code> files.</li>
<li>Strip trailing whitespace from your rules.</li>
<li>Add a space after the comma, in comma-delimited property values e.g <code class="docutils literal notranslate"><span class="pre">rgba()</span></code></li>
</ul>
</div>
<div class="section" id="formatting">
<h7>Formatting<a class="headerlink" href="#formatting" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Use hex color codes <code class="docutils literal notranslate"><span class="pre">#000</span></code> unless using <code class="docutils literal notranslate"><span class="pre">rgba()</span></code> in raw CSS
(SCSS’ <code class="docutils literal notranslate"><span class="pre">rgba()</span></code> function is overloaded to accept hex colors as a
param, e.g., <code class="docutils literal notranslate"><span class="pre">rgba(#000,</span> <span class="pre">.5)</span></code>).</li>
<li>Use <code class="docutils literal notranslate"><span class="pre">//</span></code> for comment blocks (instead of <code class="docutils literal notranslate"><span class="pre">/*</span> <span class="pre">*/</span></code>).</li>
<li>Use single quotes for string values
<code class="docutils literal notranslate"><span class="pre">background:</span> <span class="pre">url('my/image.png')</span></code></li>
<li>Avoid specifying units for zero values, e.g., <code class="docutils literal notranslate"><span class="pre">margin:</span> <span class="pre">0;</span></code> instead
of <code class="docutils literal notranslate"><span class="pre">margin:</span> <span class="pre">0px;</span></code>.</li>
<li>Strive to limit use of shorthand declarations to instances where you
must explicitly set all the available values.</li>
</ul>
</div>
<div class="section" id="sass-imports">
<h7>Sass imports<a class="headerlink" href="#sass-imports" title="Permalink to this headline">¶</a></h7>
<p>Leave off underscores and file extensions in includes:</p>
<div class="highlight-scss notranslate"><div class="highlight"><pre><span></span><span class="c1">// Bad</span>
<span class="k">@import</span> <span class="s1">&#39;components/_widget.scss&#39;</span>

<span class="c1">// Better</span>
<span class="o">@</span><span class="n">import</span> <span class="s1">&#39;components/widget&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="pixels-vs-ems">
<h7>Pixels vs. ems<a class="headerlink" href="#pixels-vs-ems" title="Permalink to this headline">¶</a></h7>
<p>Use <code class="docutils literal notranslate"><span class="pre">rems</span></code> for <code class="docutils literal notranslate"><span class="pre">font-size</span></code>, because they offer
absolute control over text. Additionally, unit-less <code class="docutils literal notranslate"><span class="pre">line-height</span></code> is
preferred because it does not inherit a percentage value of its parent
element, but instead is based on a multiplier of the <code class="docutils literal notranslate"><span class="pre">font-size</span></code>.</p>
</div>
<div class="section" id="specificity-classes-vs-ids">
<h7>Specificity (classes vs. ids)<a class="headerlink" href="#specificity-classes-vs-ids" title="Permalink to this headline">¶</a></h7>
<p>Always use classes instead of IDs in CSS code. IDs are overly specific and lead
to duplication of CSS.</p>
<p>When styling a component, start with an element + class namespace,
prefer direct descendant selectors by default, and use as little
specificity as possible. Here is a good example:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;category-list&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;item&quot;</span><span class="p">&gt;</span>Category 1<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;item&quot;</span><span class="p">&gt;</span>Category 2<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;item&quot;</span><span class="p">&gt;</span>Category 3<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="highlight-scss notranslate"><div class="highlight"><pre><span></span><span class="nc">.category-list</span> <span class="p">{</span> <span class="c1">// element + class namespace</span>

    <span class="c1">// Direct descendant selector &gt; for list items</span>
    <span class="o">&gt;</span> <span class="nt">li</span> <span class="p">{</span>
        <span class="nt">list-style-type</span><span class="nd">:</span> <span class="nt">disc</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="c1">// Minimal specificity for all links</span>
    <span class="nt">a</span> <span class="p">{</span>
        <span class="nt">color</span><span class="nd">:</span> <span class="nn">#f00</span><span class="o">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="class-naming-conventions">
<h7>Class naming conventions<a class="headerlink" href="#class-naming-conventions" title="Permalink to this headline">¶</a></h7>
<p>Never reference <code class="docutils literal notranslate"><span class="pre">js-</span></code> prefixed class names from CSS files. <code class="docutils literal notranslate"><span class="pre">js-</span></code> are
used exclusively from JS files.</p>
<p>Use the SMACSS <code class="docutils literal notranslate"><span class="pre">is-</span></code> <a class="reference external" href="https://smacss.com/book/type-state">prefix</a>
for state rules that are shared between CSS and JS.</p>
</div>
<div class="section" id="misc">
<h7>Misc<a class="headerlink" href="#misc" title="Permalink to this headline">¶</a></h7>
<p>As a rule of thumb, avoid unnecessary nesting in SCSS. At most, aim for
three levels. If you cannot help it, step back and rethink your overall
strategy (either the specificity needed, or the layout of the nesting).</p>
</div>
<div class="section" id="examples">
<h7>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h7>
<p>Here are some good examples that apply the above guidelines:</p>
<div class="highlight-scss notranslate"><div class="highlight"><pre><span></span><span class="c1">// Example of good basic formatting practices</span>
<span class="nc">.styleguide-format</span> <span class="p">{</span>
    <span class="nt">color</span><span class="nd">:</span> <span class="nn">#000</span><span class="o">;</span>
    <span class="nt">background-color</span><span class="nd">:</span> <span class="nt">rgba</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">,</span> <span class="nc">.5</span><span class="o">);</span>
    <span class="nt">border</span><span class="nd">:</span> <span class="nt">1px</span> <span class="nt">solid</span> <span class="nn">#0f0</span><span class="o">;</span>
<span class="p">}</span>

<span class="c1">// Example of individual selectors getting their own lines (for error reporting)</span>
<span class="nc">.multiple</span><span class="o">,</span>
<span class="nc">.classes</span><span class="o">,</span>
<span class="nc">.get-new-lines</span> <span class="p">{</span>
    <span class="nt">display</span><span class="nd">:</span> <span class="nt">block</span><span class="o">;</span>
<span class="p">}</span>

<span class="c1">// Avoid unnecessary shorthand declarations</span>
<span class="nc">.not-so-good</span> <span class="p">{</span>
    <span class="nt">margin</span><span class="nd">:</span> <span class="nt">0</span> <span class="nt">0</span> <span class="nt">20px</span><span class="o">;</span>
<span class="p">}</span>
<span class="nc">.good</span> <span class="p">{</span>
    <span class="nt">margin-bottom</span><span class="nd">:</span> <span class="nt">20px</span><span class="o">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-contributing/javascript_guidelines"></span><div class="section" id="javascript-coding-guidelines">
<h5>JavaScript coding guidelines<a class="headerlink" href="#javascript-coding-guidelines" title="Permalink to this headline">¶</a></h5>
<p>Write JavaScript according to the <a class="reference external" href="https://github.com/airbnb/javascript">Airbnb Styleguide</a>, with some exceptions:</p>
<ul class="simple">
<li>Use soft-tabs with a two space indent. Spaces are the only way to
guarantee code renders the same in any person’s environment.</li>
<li>We accept <code class="docutils literal notranslate"><span class="pre">snake_case</span></code> in object properties, such as
<code class="docutils literal notranslate"><span class="pre">ajaxResponse.page_title</span></code>, however camelCase or UPPER_CASE should be used
everywhere else.</li>
</ul>
<div class="section" id="linting-and-formatting-code">
<h6>Linting and formatting code<a class="headerlink" href="#linting-and-formatting-code" title="Permalink to this headline">¶</a></h6>
<p>Wagtail uses the <a class="reference external" href="https://eslint.org/">ESLint</a> linter to help check your code meets the
styleguide. You’ll need node.js and npm on your development machine.
Ensure project dependencies are installed by running <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span> <span class="pre">--no-save</span></code></p>
<div class="section" id="linting-code">
<h7>Linting code<a class="headerlink" href="#linting-code" title="Permalink to this headline">¶</a></h7>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>npm run lint:js
</pre></div>
</div>
<p>This will lint all the JS in the wagtail project, excluding vendor
files and compiled libraries.</p>
<p>Some of the modals are generated via server-side scripts. These include
template tags that upset the linter, so modal workflow JavaScript is
excluded from the linter.</p>
</div>
<div class="section" id="formatting-code">
<h7>Formatting code<a class="headerlink" href="#formatting-code" title="Permalink to this headline">¶</a></h7>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>npm run lint:js -- --fix
</pre></div>
</div>
<p>This will perform safe edits to conform your JS code to the styleguide.
It won’t touch the line-length, or convert quotemarks from double to single.</p>
<p>Run the linter after you’ve formatted the code to see what manual fixes
you need to make to the codebase.</p>
</div>
<div class="section" id="changing-the-linter-configuration">
<h7>Changing the linter configuration<a class="headerlink" href="#changing-the-linter-configuration" title="Permalink to this headline">¶</a></h7>
<p>The configuration for the linting rules is managed in an external
repository so that it can be easily shared across other Wagtail projects
or plugins. This configuration can be found at
<a class="reference external" href="https://github.com/wagtail/eslint-config-wagtail">eslint-config-wagtail</a>.</p>
</div>
</div>
</div>
<span id="document-contributing/documentation_guidelines"></span><div class="section" id="documentation-guidelines">
<h5>Documentation guidelines<a class="headerlink" href="#documentation-guidelines" title="Permalink to this headline">¶</a></h5>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#formatting-recommendations" id="id1">Formatting recommendations</a></li>
<li><a class="reference internal" href="#formatting-to-avoid" id="id2">Formatting to avoid</a></li>
</ul>
</div>
<div class="section" id="formatting-recommendations">
<h6><a class="toc-backref" href="#id1">Formatting recommendations</a><a class="headerlink" href="#formatting-recommendations" title="Permalink to this headline">¶</a></h6>
<p>Wagtail’s documentation uses a mixture of <a class="reference external" href="https://commonmark.org/help/">Markdown</a> and <a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html">reStructuredText</a>. We encourage writing documentation in Markdown first, and only reaching for more advanced reStructuredText formatting if there is a compelling reason.</p>
<p>Here are formats we encourage using when writing documentation for Wagtail.</p>
<div class="section" id="paragraphs">
<h7>Paragraphs<a class="headerlink" href="#paragraphs" title="Permalink to this headline">¶</a></h7>
<p>It all starts here.
Keep your sentences short, varied in length.</p>
<p>Separate text with an empty line to create a new paragraph.</p>
</div>
<div class="section" id="heading-levels">
<h7>Heading levels<a class="headerlink" href="#heading-levels" title="Permalink to this headline">¶</a></h7>
<p>Use heading levels to create sections, and allow users to link straight to a specific section. Start documents with an <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">h1</span></code>, and proceed with <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">h2</span></code> and further sub-sections without skipping levels.</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh"># Heading level 1</span>

<span class="gu">## Heading level 2</span>

<span class="gu">### Heading level 3</span>
</pre></div>
</div>
</div>
<div class="section" id="lists">
<h7>Lists<a class="headerlink" href="#lists" title="Permalink to this headline">¶</a></h7>
<p>Use bullets for unordered lists, numbers when ordered. Prefer dashes <code class="docutils literal notranslate"><span class="pre">-</span></code> for bullets. Nest by indenting with 4 spaces.</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="k">-</span> Bullet 1
<span class="k">-</span> Bullet 2
    <span class="k">-</span> Nested bullet 2
<span class="k">-</span> Bullet 3

<span class="k">1.</span> Numbered list 1
<span class="k">2.</span> Numbered list 2
<span class="k">3.</span> Numbered list 3
</pre></div>
</div>
<details><summary>Rendered output</summary><ul class="simple">
<li>Bullet 1</li>
<li>Bullet 2<ul>
<li>Nested bullet 2</li>
</ul>
</li>
<li>Bullet 3</li>
</ul>
<ol class="simple">
<li>Numbered list 1</li>
<li>Numbered list 2</li>
<li>Numbered list 3</li>
</ol>
</details></div>
<div class="section" id="inline-styles">
<h7>Inline styles<a class="headerlink" href="#inline-styles" title="Permalink to this headline">¶</a></h7>
<p>Use <strong>bold</strong> and <em>italic</em> sparingly, inline <code class="docutils literal notranslate"><span class="pre">code</span></code> when relevant.</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>Use <span class="gs">**bold**</span> and <span class="ge">_italic_</span> sparingly, inline <span class="sb">`code`</span> when relevant.
</pre></div>
</div>
</div>
<div class="section" id="code-blocks">
<h7>Code blocks<a class="headerlink" href="#code-blocks" title="Permalink to this headline">¶</a></h7>
<p>Make sure to include the correct language code for syntax highlighting, and to format your code according to our coding guidelines. Frequently used: <code class="docutils literal notranslate"><span class="pre">python</span></code>, <code class="docutils literal notranslate"><span class="pre">css</span></code>, <code class="docutils literal notranslate"><span class="pre">html</span></code>, <code class="docutils literal notranslate"><span class="pre">html+django</span></code>, <code class="docutils literal notranslate"><span class="pre">javascript</span></code>, <code class="docutils literal notranslate"><span class="pre">console</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```python
INSTALLED_APPS = [
    ...
    &quot;wagtail.core&quot;,
    ...
]
```
</pre></div>
</div>
</div>
<div class="section" id="links">
<h7>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h7>
<p>Links are fundamental in documentation. Use internal links to tie your content to other docs, and external links as needed. Pick relevant text for links, so readers know where they will land.</p>
<p>Don’t rely on <a class="reference external" href="https://www.example.com/"><code class="docutils literal notranslate"><span class="pre">links</span> <span class="pre">over</span> <span class="pre">code</span></code></a>, as they are impossible to spot.</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>An [<span class="nt">external link</span>](<span class="na">https://wwww.example.com</span>).
An [<span class="nt">internal link to another document</span>](<span class="na">/reference/contrib/legacy_richtext.md</span>).
A [<span class="nt">link to a reference</span>](<span class="na">register_reports_menu_item</span>).
</pre></div>
</div>
<details><summary>Rendered output</summary><p>An <a class="reference external" href="https://wwww.example.com">external link</a>.
An <a class="reference internal" href="index.html#document-reference/contrib/legacy_richtext"><span class="doc">internal link to another document</span></a>.
A <a class="reference internal" href="index.html#register-reports-menu-item"><span class="std std-ref">link to a reference</span></a>.</p>
</details><p>Reference links rely on creating a reference in reStructuredText. Prefer linking to the whole document if at all possible, otherwise create a reference by embedding reStructuredText with <code class="docutils literal notranslate"><span class="pre">eval_rst</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```eval_rst
.. _register_reports_menu_item:
```
</pre></div>
</div>
</div>
<div class="section" id="note-and-warning-call-outs">
<h7>Note and warning call-outs<a class="headerlink" href="#note-and-warning-call-outs" title="Permalink to this headline">¶</a></h7>
<p>Use notes and warnings sparingly, as they rely on reStructuredText syntax which is more complicated for future editors.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```eval_rst note:: Notes can provide complementary information.
```

```eval_rst warning:: Warnings can be scary.
```
</pre></div>
</div>
<details><summary>Rendered output</summary><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notes can provide complementary information.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Warnings can be scary.</p>
</div>
</details></div>
<div class="section" id="images">
<h7>Images<a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h7>
<p>Images are hard to keep up-to-date as documentation evolves, but can be worthwhile nonetheless. Here are guidelines when adding images:</p>
<ul class="simple">
<li>All images should have meaningful <a class="reference external" href="https://axesslab.com/alt-texts/">alt text</a> unless they are decorative.</li>
<li>Images are served as-is – pick the correct format, and losslessly compress all images.</li>
<li>Use absolute paths for image files so they are more portable.</li>
</ul>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>![<span class="nt">Screenshot of the workflow editing interface, with fields to change the workflow name, tasks, and assigned pages</span>](<span class="na">/_static/images/screen44_workflow_edit.png</span>)
</pre></div>
</div>
<details><summary>Rendered output</summary><p><img alt="_images/screen44_workflow_edit.png" src="_images/screen44_workflow_edit.png" />Screenshot of the workflow editing interface, with fields to change the workflow name, tasks, and assigned pages</p>
</details></div>
<div class="section" id="autodoc">
<h7>Autodoc<a class="headerlink" href="#autodoc" title="Permalink to this headline">¶</a></h7>
<p>With its <a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/extensions/autodoc.html">autodoc</a> feature, Sphinx supports writing documentation in Python docstrings for subsequent integration in the project’s documentation pages. This is a very powerful feature which we highly recommend using to document Wagtail’s APIs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```eval_rst
.. module:: wagtail.core.utils

.. autofunction:: cautious_slugify
```
</pre></div>
</div>
<details>
<summary>Rendered output</summary><span class="target" id="module-wagtail.core.utils"></span><dl class="function">
<dt id="wagtail.core.utils.cautious_slugify">
<code class="descclassname">wagtail.core.utils.</code><code class="descname">cautious_slugify</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#wagtail.core.utils.cautious_slugify" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a string to ASCII exactly as Django’s slugify does, with the exception
that any non-ASCII alphanumeric characters (that cannot be ASCIIfied under Unicode
normalisation) are escaped into codes like ‘u0421’ instead of being deleted entirely.</p>
<p>This ensures that the result of slugifying e.g. Cyrillic text will not be an empty
string, and can thus be safely used as an identifier (albeit not a human-readable one).</p>
</dd></dl>

</details></div>
<div class="section" id="tables">
<h7>Tables<a class="headerlink" href="#tables" title="Permalink to this headline">¶</a></h7>
<p>Only use tables when needed, with the “simple” reStructuredText syntax, which is hard enough to format as it is.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```eval_rst
=============  =============
Browser        Device/OS    
=============  =============
Stock browser  Android      
IE             Desktop      
Safari         Windows      
=============  =============
```
</pre></div>
</div>
<details><summary>Rendered output</summary><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Browser</th>
<th class="head">Device/OS</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Stock browser</td>
<td>Android</td>
</tr>
<tr class="row-odd"><td>IE</td>
<td>Desktop</td>
</tr>
<tr class="row-even"><td>Safari</td>
<td>Windows</td>
</tr>
</tbody>
</table>
</details></div>
<div class="section" id="tables-of-content">
<h7>Tables of content<a class="headerlink" href="#tables-of-content" title="Permalink to this headline">¶</a></h7>
<p><code class="docutils literal notranslate"><span class="pre">toctree</span></code> and <code class="docutils literal notranslate"><span class="pre">contents</span></code> can be used as reStructuredText embeds.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```eval_rst
.. toctree::
    :maxdepth: 2
    :titlesonly:

    getting_started/index
    topics/index
```

```eval_rst
.. contents::
```
</pre></div>
</div>
</div>
<div class="section" id="version-added-changed-deprecations">
<h7>Version added, changed, deprecations<a class="headerlink" href="#version-added-changed-deprecations" title="Permalink to this headline">¶</a></h7>
<p>Sphinx offers release-metadata directives to generate this information consistently. Use as appropriate.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```eval_rst
.. versionadded:: 2.15
```

```eval_rst
.. versionchanged:: 2.15
```
</pre></div>
</div>
<details><summary>Rendered output</summary><div class="versionadded">
<p><span class="versionmodified">New in version 2.15.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Changed in version 2.15.</span></p>
</div>
</details></div>
<div class="section" id="progressive-disclosure">
<h7>Progressive disclosure<a class="headerlink" href="#progressive-disclosure" title="Permalink to this headline">¶</a></h7>
<p>We can add supplementary information in documentation with the HTML <code class="docutils literal notranslate"><span class="pre">&lt;details&gt;</span></code> element. This relies on HTML syntax, which can be hard to author consistently, so keep this type of formatting to a minimum.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">details</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>Supplementary information<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>

This will be visible when expanding the content.

<span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<details><summary>Supplementary information</summary><p>This will be visible when expanding the content.</p>
</details></div>
</div>
<div class="section" id="formatting-to-avoid">
<h6><a class="toc-backref" href="#id2">Formatting to avoid</a><a class="headerlink" href="#formatting-to-avoid" title="Permalink to this headline">¶</a></h6>
<p>There is some formatting in the documentation which is technically supported, but we recommend avoiding unless there is a clear necessity.</p>
<div class="section" id="call-outs">
<h7>Call-outs<a class="headerlink" href="#call-outs" title="Permalink to this headline">¶</a></h7>
<p>We only use <code class="docutils literal notranslate"><span class="pre">note::</span></code> and <code class="docutils literal notranslate"><span class="pre">warning::</span></code> call-outs. Avoid <code class="docutils literal notranslate"><span class="pre">important::</span></code>, <code class="docutils literal notranslate"><span class="pre">topic::</span></code>, and <code class="docutils literal notranslate"><span class="pre">tip::</span></code>. If you find one of these, please replace it with <code class="docutils literal notranslate"><span class="pre">note::</span></code>.</p>
</div>
<div class="section" id="glossary">
<h7>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h7>
<p>Sphinx glossaries (<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">glossary::</span></code>) generate definition lists. Use plain bullet or number lists instead, or sections with headings, or a table.</p>
</div>
<div class="section" id="comments">
<h7>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h7>
<p>Avoid documentation source comments in committed documentation.</p>
</div>
<div class="section" id="figure">
<h7>Figure<a class="headerlink" href="#figure" title="Permalink to this headline">¶</a></h7>
<p>reStructuredText figures (<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">figure::</span></code>) only offer very marginal improvements over vanilla images. If your figure has a caption, add it as an italicised paragraph underneath the image.</p>
</div>
<div class="section" id="other-restructuredtext-syntax-and-sphinx-directives">
<h7>Other reStructuredText syntax and Sphinx directives<a class="headerlink" href="#other-restructuredtext-syntax-and-sphinx-directives" title="Permalink to this headline">¶</a></h7>
<p>We generally want to favour Markdown over reStructuredText, to make it as simple as possible for newcomers to make documentation contributions to Wagtail. Always prefer Markdown, unless the document’s formatting highly depends on reStructuredText syntax.</p>
<p>If you want to use a specific Sphinx directive, consult with core contributors to see whether its usage is justified, and document its expected usage on this page.</p>
</div>
<div class="section" id="arbitrary-html">
<h7>Arbitrary HTML<a class="headerlink" href="#arbitrary-html" title="Permalink to this headline">¶</a></h7>
<p>While our documentation tooling offers some support for embedding arbitrary HTML, this is frowned upon. Only do so if there is a necessity, and if the formatting is unlikely to need updates.</p>
</div>
</div>
</div>
<span id="document-contributing/documentation-modes"></span><div class="section" id="writing-documentation">
<h5>Writing documentation<a class="headerlink" href="#writing-documentation" title="Permalink to this headline">¶</a></h5>
<p class="intro">Wagtail documentation is written in <strong>four modes</strong> of information delivery.
Each type of information delivery has a purpose and targets a specific audience.</p>
<ul class="simple">
<li><a class="reference internal" href="#doc-mode-tutorial"><span class="std std-ref">Tutorial</span></a>, learning-oriented</li>
<li><a class="reference internal" href="#doc-mode-how-to-guide"><span class="std std-ref">How-to guide</span></a>, goal-oriented</li>
<li><a class="reference internal" href="#doc-mode-reference"><span class="std std-ref">Reference</span></a>, information-oriented</li>
<li><a class="reference internal" href="#doc-mode-explanation"><span class="std std-ref">Explanation</span></a>, understanding-oriented</li>
</ul>
<p>We are following Daniele Procida’s <a class="reference external" href="https://diataxis.fr/">Diátaxis documentation framework</a>.</p>
<div class="section" id="choose-a-writing-mode">
<span id="id1"></span><h6>Choose a writing mode<a class="headerlink" href="#choose-a-writing-mode" title="Permalink to this headline">¶</a></h6>
<p>Each page of the Wagtail documentation should be written in single mode of information delivery.
Single pages with mixed modes are harder to understand.
If you have documents that mix the types of information delivery,
it’s best to split them up. Add links to the first section of each document to cross reference other documents on the same topic.</p>
<p>Writing documentation in a specific mode will help our users to understand and quickly find what they are looking for.</p>
</div>
<div class="section" id="tutorial">
<span id="doc-mode-tutorial"></span><h6>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h6>
<p>Tutorials are designed to be <strong>learning-oriented</strong> resources which guide newcomers through a specific topic. To help effective learning, tutorials should provide examples to illustrate the subjects they cover.</p>
<p>Tutorials may not necessarily follow best practices. They are designed to make it easier to get started. A tutorial is concrete and particular. It must be repeatable, instil confidence, and should result in success, every time, for every learner.</p>
<div class="section" id="do">
<h7>Do<a class="headerlink" href="#do" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Use conversational language</li>
<li>Use contractions, speak in the first person plural,
be reassuring. For example: “We’re going to do this.”</li>
<li>Use pictures or concrete outputs of code to reassure people that they’re on the right track.
For example: “Your new login page should look like this:” or “Your directory should now have three files”.</li>
</ul>
</div>
<div class="section" id="dont">
<h7>Don’t<a class="headerlink" href="#dont" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Tell people what they’re going to learn.
Instead, tell them what tasks they’re going to complete.</li>
<li>Use optionality in a tutorial. The word ‘if’ is a sign of danger!
For example: “If you want to do this…”
The expected actions and outcomes should be unambiguous.</li>
<li>Assume that learners have a prior understanding of the subject.</li>
</ul>
<p><a class="reference external" href="https://diataxis.fr/tutorials/">More about tutorials</a></p>
</div>
</div>
<div class="section" id="how-to-guide">
<span id="doc-mode-how-to-guide"></span><h6>How-to guide<a class="headerlink" href="#how-to-guide" title="Permalink to this headline">¶</a></h6>
<p>A guide offers advice on how best to achieve a given task.
How-to guides are <strong>task-oriented</strong> with a clear <strong>goal or objective</strong>.</p>
<div class="section" id="id2">
<h7>Do<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Name the guide well - ensure that the learner understands what exactly the guide does.</li>
<li>Focus on actions and outcomes. For example: “If you do X, Y should happen.”</li>
<li>Assume that the learner has a basic understanding of the general concepts</li>
<li>Point the reader to additional resources</li>
</ul>
</div>
<div class="section" id="id3">
<h7>Don’t<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Use an unnecessarily strict tone of voice. For example: “You must absolutely NOT do X.”</li>
</ul>
<p><a class="reference external" href="https://diataxis.fr/how-to-guides/">More about how-to guides</a></p>
</div>
</div>
<div class="section" id="reference">
<span id="doc-mode-reference"></span><h6>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h6>
<p>Reference material is <strong>information-oriented</strong>.
A reference is well-structured and allows the reader to find information about a specific topic.
They should be short and to the point. Boring is fine! Use an imperative voice.
For example: “Inherit from the Page model”.</p>
<p>Most references will be auto-generated based on doc-strings in the Python code.</p>
<p><a class="reference external" href="https://diataxis.fr/reference/">More about reference</a></p>
</div>
<div class="section" id="explanation">
<span id="doc-mode-explanation"></span><h6>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h6>
<p>Explanations are <strong>understanding-oriented</strong>.
They are high-level and offer context to concepts and design decisions.
There is little or no code involved in explanations,
which are used to deepen the theoretical understanding of a practical draft.
Explanations are used to establish connections and may require some prior knowledge of the principles being explored.</p>
<p><a class="reference external" href="https://diataxis.fr/explanation/">More about explanation</a></p>
</div>
</div>
<span id="document-contributing/security"></span><div class="section" id="reporting-security-issues">
<h5>Reporting security issues<a class="headerlink" href="#reporting-security-issues" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please report security issues <strong>only</strong> to <a class="reference external" href="mailto:security&#37;&#52;&#48;wagtail&#46;io">security<span>&#64;</span>wagtail<span>&#46;</span>io</a>.</p>
</div>
<p>Most normal bugs in Wagtail are reported as <a class="reference external" href="https://github.com/wagtail/wagtail/issues">GitHub issues</a>, but due to the sensitive nature of security issues, we ask that they not be publicly reported in this fashion.</p>
<p>Instead, if you believe you’ve found something in Wagtail which has security implications, please send a description of the issue via email to <a class="reference external" href="mailto:security&#37;&#52;&#48;wagtail&#46;io">security<span>&#64;</span>wagtail<span>&#46;</span>io</a>.
Mail sent to that address reaches a subset of the core team, who can forward security issues to other core team members for broader discussion if needed.</p>
<p>Once you’ve submitted an issue via email, you should receive an acknowledgement from a member of the security team within 48 hours, and depending on the action to be taken, you may receive further followup emails.</p>
<p>If you want to send an encrypted email (optional), the public key ID for <a class="reference external" href="mailto:security&#37;&#52;&#48;wagtail&#46;io">security<span>&#64;</span>wagtail<span>&#46;</span>io</a> is <code class="docutils literal notranslate"><span class="pre">0x6ba1e1a86e0f8ce8</span></code>, and this public key is available from most commonly-used keyservers.</p>
<p>Django security issues should be reported directly to the Django Project, following <a class="reference external" href="https://docs.djangoproject.com/en/dev/internals/security/">Django’s security policies</a> (upon which Wagtail’s own policies are based).</p>
<div class="section" id="supported-versions">
<h6>Supported versions<a class="headerlink" href="#supported-versions" title="Permalink to this headline">¶</a></h6>
<p>At any given time, the Wagtail team provides official security support for several versions of Wagtail:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">main</span></code> development branch, hosted on GitHub, which will become the next release of Wagtail, receives security support.</li>
<li>The two most recent Wagtail release series receive security support.
For example, during the development cycle leading to the release of
Wagtail 2.6, support will be provided for Wagtail 2.5 and Wagtail 2.4. Upon the release of Wagtail 2.6, Wagtail 2.4’s security support will end.</li>
<li>The latest long-term support release will receive security updates.</li>
</ul>
<p>When new releases are issued for security reasons, the accompanying notice will include a list of affected versions.
This list is comprised solely of supported versions of Wagtail: older versions may also be affected, but we do not investigate to determine that, and will not issue patches or new releases for those versions.</p>
</div>
<div class="section" id="how-wagtail-discloses-security-issues">
<h6>How Wagtail discloses security issues<a class="headerlink" href="#how-wagtail-discloses-security-issues" title="Permalink to this headline">¶</a></h6>
<p>Our process for taking a security issue from private discussion to public disclosure involves multiple steps.</p>
<p>There is no fixed period of time by which a confirmed security issue will be resolved as this is dependent on the issue, however it will be a priority of the Wagtail team to issue a security release as soon as possible.</p>
<p>The reporter of the issue will receive notification of the date on which we plan to take the issue public.
On the day of disclosure, we will take the following steps:</p>
<ol class="simple">
<li>Apply the relevant patch(es) to Wagtail’s codebase.
The commit messages for these patches will indicate that they are for security issues, but will not describe the issue in any detail; instead, they will warn of upcoming disclosure.</li>
<li>Issue the relevant release(s), by placing new packages on <a class="reference external" href="https://pypi.org/project/wagtail/">the Python Package Index</a>, tagging the new release(s) in Wagtail’s GitHub repository and updating Wagtail’s <a class="reference internal" href="index.html#document-releases/index"><span class="doc">release notes</span></a>.</li>
<li>Post a public entry on <a class="reference external" href="https://wagtail.io/blog/">Wagtail’s blog</a>, describing the issue and its resolution in detail, pointing to the relevant patches and new releases, and crediting the reporter of the issue (if the reporter wishes to be publicly identified).</li>
<li>Post a notice to the <a class="reference external" href="https://groups.google.com/d/forum/wagtail">Wagtail support forum</a> and Twitter feed (<a class="reference external" href="https://twitter.com/wagtailcms">&#64;WagtailCMS</a>) that links to the blog post.</li>
</ol>
<p>If a reported issue is believed to be particularly time-sensitive – due to a known exploit in the wild, for example – the time between advance notification and public disclosure may be shortened considerably.</p>
</div>
</div>
<span id="document-contributing/release_process"></span><div class="section" id="wagtail-s-release-process">
<h5>Wagtail’s release process<a class="headerlink" href="#wagtail-s-release-process" title="Permalink to this headline">¶</a></h5>
<div class="section" id="official-releases">
<h6>Official releases<a class="headerlink" href="#official-releases" title="Permalink to this headline">¶</a></h6>
<p>Release numbering works as follows:</p>
<ul class="simple">
<li>Versions are numbered in the form <code class="docutils literal notranslate"><span class="pre">A.B</span></code> or <code class="docutils literal notranslate"><span class="pre">A.B.C</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">A.B</span></code> is the <em>feature release</em> version number. Each version will be mostly
backwards compatible with the previous release. Exceptions to this rule will
be listed in the release notes.</li>
<li><code class="docutils literal notranslate"><span class="pre">C</span></code> is the <em>patch release</em> version number, which is incremented for bugfix
and security releases. These releases will be 100% backwards-compatible with
the previous patch release. The only exception is when a security or data
loss issue can’t be fixed without breaking backwards-compatibility. If this
happens, the release notes will provide detailed upgrade instructions.</li>
<li>Before a new feature release, we’ll make at least one release candidate
release. These are of the form <code class="docutils literal notranslate"><span class="pre">A.BrcN</span></code>, which means the
<code class="docutils literal notranslate"><span class="pre">Nth</span></code> release candidate of version <code class="docutils literal notranslate"><span class="pre">A.B</span></code>.</li>
</ul>
<p>In git, each Wagtail release will have a tag indicating its version number.
Additionally, each release series has its
own branch, called <code class="docutils literal notranslate"><span class="pre">stable/A.B.x</span></code>, and bugfix/security releases will be
issued from those branches.</p>
<dl class="glossary docutils">
<dt id="term-feature-release">Feature release</dt>
<dd>Feature releases (A.B, A.B+1, etc.) happen every three months
– see <a class="reference external" href="#release-process">release process</a> for details. These releases will contain new
features and improvements to existing features.</dd>
<dt id="term-patch-release">Patch release</dt>
<dd><p class="first">Patch releases (A.B.C, A.B.C+1, etc.) will be issued as needed, to fix
bugs and/or security issues.</p>
<p class="last">These releases will be 100% compatible with the associated feature release,
unless this is impossible for security reasons or to prevent data loss.
So the answer to “should I upgrade to the latest patch release?” will always
be “yes.”</p>
</dd>
<dt id="term-long-term-support-release">Long-term support release</dt>
<dd>Certain feature releases will be designated as long-term support (LTS)
releases. These releases will get security and data loss fixes applied for
a guaranteed period of time, typically six months.</dd>
</dl>
</div>
<div class="section" id="release-cadence">
<h6>Release cadence<a class="headerlink" href="#release-cadence" title="Permalink to this headline">¶</a></h6>
<p>Wagtail uses a loose form of <a class="reference external" href="https://semver.org/">semantic versioning</a>.
SemVer makes it easier to see at a glance how compatible releases are with each
other. It also helps to anticipate when compatibility shims will be removed.
It’s not a pure form of SemVer as each feature release will continue to have a
few documented backwards incompatibilities where a deprecation path isn’t
possible or not worth the cost.</p>
</div>
<div class="section" id="deprecation-policy">
<h6>Deprecation policy<a class="headerlink" href="#deprecation-policy" title="Permalink to this headline">¶</a></h6>
<p>A feature release may deprecate certain features from previous releases. If a
feature is deprecated in feature release A.B, it will continue to work in
the following version but raise warnings. Features deprecated in release A.B
will be removed in the A.B+2 release to ensure deprecations are done
over at least 2 feature releases.</p>
<p>So, for example, if we decided to start the deprecation of a function in
Wagtail 1.4:</p>
<ul class="simple">
<li>Wagtail 1.4 will contain a backwards-compatible replica of the function which
will raise a <code class="docutils literal notranslate"><span class="pre">RemovedInWagtail16Warning</span></code>.</li>
<li>Wagtail 1.5 will still contain the backwards-compatible replica.</li>
<li>Wagtail 1.6 will remove the feature outright.</li>
</ul>
<p>The warnings are silent by default. You can turn on display of these warnings
with the <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-Wd</span></code> option.</p>
</div>
<div class="section" id="supported-versions">
<h6>Supported versions<a class="headerlink" href="#supported-versions" title="Permalink to this headline">¶</a></h6>
<p>At any moment in time, Wagtail’s developer team will support a set of releases to
varying levels.</p>
<ul>
<li><p class="first">The current development <code class="docutils literal notranslate"><span class="pre">main</span></code> will get new features and bug fixes
requiring non-trivial refactoring.</p>
</li>
<li><p class="first">Patches applied to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch must also be applied to the last feature
release branch, to be released in the next patch release of that feature
series, when they fix critical problems:</p>
<ul class="simple">
<li>Security issues.</li>
<li>Data loss bugs.</li>
<li>Crashing bugs.</li>
<li>Major functionality bugs in newly-introduced features.</li>
<li>Regressions from older versions of Wagtail.</li>
</ul>
<p>The rule of thumb is that fixes will be backported to the last feature
release for bugs that would have prevented a release in the first place
(release blockers).</p>
</li>
<li><p class="first">Security fixes and data loss bugs will be applied to the current <code class="docutils literal notranslate"><span class="pre">main</span></code>, the
last feature release branch, and any other supported long-term
support release branches.</p>
</li>
<li><p class="first">Documentation fixes generally will be more freely backported to the last
release branch. That’s because it’s highly advantageous to have the docs for
the last release be up-to-date and correct, and the risk of introducing
regressions is much less of a concern.</p>
</li>
</ul>
<p>As a concrete example, consider a moment in time halfway between the release of
Wagtail 1.6 and 1.7. At this point in time:</p>
<ul class="simple">
<li>Features will be added to <code class="docutils literal notranslate"><span class="pre">main</span></code>, to be released as Wagtail 1.7.</li>
<li>Critical bug fixes will be applied to the <code class="docutils literal notranslate"><span class="pre">stable/1.6.x</span></code> branch, and
released as 1.6.1, 1.6.2, etc.</li>
<li>Security fixes and bug fixes for data loss issues will be applied to
<code class="docutils literal notranslate"><span class="pre">main</span></code> and to the <code class="docutils literal notranslate"><span class="pre">stable/1.6.x</span></code> and <code class="docutils literal notranslate"><span class="pre">stable/1.4.x</span></code> (LTS) branches.
They will trigger the release of <code class="docutils literal notranslate"><span class="pre">1.6.1</span></code>, <code class="docutils literal notranslate"><span class="pre">1.4.8</span></code>, etc.</li>
<li>Documentation fixes will be applied to <code class="docutils literal notranslate"><span class="pre">main</span></code>, and, if easily backported, to
the latest stable branch, <code class="docutils literal notranslate"><span class="pre">1.6.x</span></code>.</li>
</ul>
</div>
<div class="section" id="supported-versions-of-django">
<h6>Supported versions of Django<a class="headerlink" href="#supported-versions-of-django" title="Permalink to this headline">¶</a></h6>
<p>Each release of Wagtail declares which versions of Django it supports.</p>
<p>Typically, a new Wagtail feature release supports the last long-term support version and
all following versions of Django.</p>
<p>For example, consider a moment in time before release of Wagtail 1.5
and after the following releases:</p>
<ul class="simple">
<li>Django 1.8 (LTS)</li>
<li>Django 1.9</li>
<li>Wagtail 1.4 (LTS) - Released before Django 1.10 and supports Django 1.8 and 1.9</li>
<li>Django 1.10</li>
</ul>
<p>Wagtail 1.5 will support Django 1.8 (LTS), 1.9, 1.10.
Wagtail 1.4 will still support only Django 1.8 (LTS) and 1.9.</p>
</div>
<div class="section" id="release-process">
<span id="id1"></span><h6>Release process<a class="headerlink" href="#release-process" title="Permalink to this headline">¶</a></h6>
<p>Wagtail uses a <a class="reference external" href="https://github.com/wagtail/wagtail/wiki/Release-schedule">time-based release schedule</a>,
with feature releases every three months.</p>
<p>After each feature release, the release manager will announce a timeline for
the next feature release.</p>
<div class="section" id="release-cycle">
<h7>Release cycle<a class="headerlink" href="#release-cycle" title="Permalink to this headline">¶</a></h7>
<p>Each release cycle consists of three parts:</p>
<div class="section" id="phase-one-feature-proposal">
<h8>Phase one: feature proposal<a class="headerlink" href="#phase-one-feature-proposal" title="Permalink to this headline">¶</a></h8>
<p>The first phase of the release process will include figuring out what major
features to include in the next version. This should include a good deal of
preliminary work on those features – working code trumps grand design.</p>
</div>
<div class="section" id="phase-two-development">
<h8>Phase two: development<a class="headerlink" href="#phase-two-development" title="Permalink to this headline">¶</a></h8>
<p>The second part of the release schedule is the “heads-down” working period.
Using the roadmap produced at the end of phase one, we’ll all work very hard to
get everything on it done.</p>
<p>At the end of phase two, any unfinished features will be postponed until the
next release.</p>
<p>At this point, the <code class="docutils literal notranslate"><span class="pre">stable/A.B.x</span></code> branch will be forked from <code class="docutils literal notranslate"><span class="pre">main</span></code>.</p>
</div>
<div class="section" id="phase-three-bugfixes">
<h8>Phase three: bugfixes<a class="headerlink" href="#phase-three-bugfixes" title="Permalink to this headline">¶</a></h8>
<p>The last part of a release cycle is spent fixing bugs – no new features will
be accepted during this time.</p>
<p>Once all known blocking bugs have been addressed, a release candidate will be
made available for testing. The final release will usually follow two weeks later,
although this period may be extended if the further release blockers are found.</p>
<p>During this phase, committers will be more and more conservative with
backports, to avoid introducing regressions. After the release candidate, only
release blockers and documentation fixes should be backported.</p>
<p>Developers should avoid adding any new translatable strings after the release
candidate - this ensures that translators have the full period between the release
candidate and the final release to bring translations up to date. Translations
will be re-imported immediately before the final release.</p>
<p>In parallel to this phase, <code class="docutils literal notranslate"><span class="pre">main</span></code> can receive new features, to be released
in the <code class="docutils literal notranslate"><span class="pre">A.B+1</span></code> cycle.</p>
</div>
</div>
<div class="section" id="bug-fix-releases">
<h7>Bug-fix releases<a class="headerlink" href="#bug-fix-releases" title="Permalink to this headline">¶</a></h7>
<p>After a feature release (e.g. A.B), the previous release will go into bugfix
mode.</p>
<p>The branch for the previous feature release (e.g. <code class="docutils literal notranslate"><span class="pre">stable/A.B-1.x</span></code>) will
include bugfixes. Critical bugs fixed on <code class="docutils literal notranslate"><span class="pre">main</span></code> must <em>also</em> be fixed on the
bugfix branch; this means that commits need to cleanly separate bug fixes from
feature additions. The developer who commits a fix to <code class="docutils literal notranslate"><span class="pre">main</span></code> will be
responsible for also applying the fix to the current bugfix branch.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-releases/index"></span><div class="section" id="release-notes">
<h3>Release notes<a class="headerlink" href="#release-notes" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-releases/upgrading"></span><div class="section" id="upgrading-wagtail">
<h4>Upgrading Wagtail<a class="headerlink" href="#upgrading-wagtail" title="Permalink to this headline">¶</a></h4>
<div class="section" id="version-numbers">
<h5>Version numbers<a class="headerlink" href="#version-numbers" title="Permalink to this headline">¶</a></h5>
<p>New feature releases of Wagtail are released every three months. These releases provide new features, improvements and bugfixes, and are marked by incrementing the second part of the version number (for example, 2.6 to 2.7).</p>
<p>Additionally, patch releases will be issued as needed, to fix bugs and security issues. These are marked by incrementing the third part of the version number (for example, 2.6 to 2.6.1). Wherever possible, these releases will remain fully backwards compatible with the corresponding feature and not introduce any breaking changes.</p>
<p>A feature release will usually stop receiving patch release updates when the next feature release comes out. However, selected feature releases are designated as Long Term Support (LTS) releases, and will continue to receive maintenance updates to address any security and data-loss related issues that arise. Typically, a Long Term Support release will happen once every four feature releases and receive updates for five feature releases, giving a support period of fifteen months with a three month overlap.</p>
<p>Also, Long Term Support releases will ensure compatibility with at least one <a class="reference external" href="https://www.djangoproject.com/download/#supported-versions">Django Long Term Support release</a>.</p>
<p>For dates of past and upcoming releases and support periods, see <a class="reference external" href="https://github.com/wagtail/wagtail/wiki/Release-schedule">Release Schedule</a>.</p>
</div>
<div class="section" id="deprecation-policy">
<h5>Deprecation policy<a class="headerlink" href="#deprecation-policy" title="Permalink to this headline">¶</a></h5>
<p>Sometimes it is necessary for a feature release to deprecate features from previous releases. This will be noted in the “Upgrade considerations” section of the release notes.</p>
<p>When a feature is deprecated, it will continue to work in that feature release and the one after it, but will raise a warning. The feature will then be removed in the subsequent feature release. For example, a feature marked as deprecated in version 1.8 will continue to work in versions 1.8 and 1.9, and be dropped in version 1.10.</p>
</div>
<div class="section" id="upgrade-process">
<h5>Upgrade process<a class="headerlink" href="#upgrade-process" title="Permalink to this headline">¶</a></h5>
<p>We recommend upgrading one feature release at a time, even if your project is several versions behind the current one. This has a number of advantages over skipping directly to the newest release:</p>
<ul class="simple">
<li>If anything breaks as a result of the upgrade, you will know which version caused it, and will be able to troubleshoot accordingly;</li>
<li>Deprecation warnings shown in the console output will notify you of any code changes you need to make before upgrading to the following version;</li>
<li>Some releases make database schema changes that need to be reflected on your project by running <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">makemigrations</span></code> - this is liable to fail if too many schema changes happen in one go.</li>
</ul>
<p>Before upgrading to a new feature release:</p>
<ul class="simple">
<li>Check your project’s console output for any deprecation warnings, and fix them where necessary;</li>
<li>Check the new version’s release notes, and the <a class="reference internal" href="#compatible-django-python-versions"><span class="std std-ref">Compatible Django / Python versions</span></a> table below, for any dependencies that need upgrading first;</li>
<li>Make a backup of your database.</li>
</ul>
<p>To upgrade:</p>
<ul>
<li><p class="first">Update the <code class="docutils literal notranslate"><span class="pre">wagtail</span></code> line in your project’s <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file to specify the latest patch release of the version you wish to install. For example, to upgrade to version 1.8.x, the line should read:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wagtail</span><span class="o">&gt;=</span><span class="mf">1.8</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">1.9</span>
</pre></div>
</div>
</li>
<li><p class="first">Run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pip install -r requirements.txt</span>
<span class="go">./manage.py makemigrations</span>
<span class="go">./manage.py migrate</span>
</pre></div>
</div>
</li>
<li><p class="first">Make any necessary code changes as directed in the “Upgrade considerations” section of the release notes.</p>
</li>
<li><p class="first">Test that your project is working as expected.</p>
</li>
</ul>
<p>Remember that the JavaScript and CSS files used in the Wagtail admin may have changed between releases - if you encounter erratic behaviour on upgrading, ensure that you have cleared your browser cache. When deploying the upgrade to a production server, be sure to run <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">collectstatic</span></code> to make the updated static files available to the web server. In production, we recommend enabling <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/contrib/staticfiles/#manifeststaticfilesstorage">ManifestStaticFilesStorage</a> in the <code class="docutils literal notranslate"><span class="pre">STATICFILES_STORAGE</span></code> setting - this ensures that different versions of files are assigned distinct URLs.</p>
</div>
<div class="section" id="compatible-django-python-versions">
<span id="id1"></span><h5>Compatible Django / Python versions<a class="headerlink" href="#compatible-django-python-versions" title="Permalink to this headline">¶</a></h5>
<p>New feature releases frequently add support for newer versions of Django and Python, and drop support for older ones. We recommend always carrying out upgrades to Django and Python as a separate step from upgrading Wagtail.</p>
<p>The compatible versions of Django and Python for each Wagtail release are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="38%" />
<col width="37%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Wagtail release</th>
<th class="head">Compatible Django versions</th>
<th class="head">Compatible Python versions</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0.1</td>
<td>1.6</td>
<td>2.7</td>
</tr>
<tr class="row-odd"><td>0.2</td>
<td>1.6</td>
<td>2.7</td>
</tr>
<tr class="row-even"><td>0.3</td>
<td>1.6</td>
<td>2.6, 2.7</td>
</tr>
<tr class="row-odd"><td>0.4</td>
<td>1.6</td>
<td>2.6, 2.7, 3.2, 3.3, 3.4</td>
</tr>
<tr class="row-even"><td>0.5</td>
<td>1.6</td>
<td>2.6, 2.7, 3.2, 3.3, 3.4</td>
</tr>
<tr class="row-odd"><td>0.6</td>
<td>1.6, 1.7</td>
<td>2.6, 2.7, 3.2, 3.3, 3.4</td>
</tr>
<tr class="row-even"><td>0.7</td>
<td>1.6, 1.7</td>
<td>2.6, 2.7, 3.2, 3.3, 3.4</td>
</tr>
<tr class="row-odd"><td>0.8 LTS</td>
<td>1.6, 1.7</td>
<td>2.6, 2.7, 3.2, 3.3, 3.4</td>
</tr>
<tr class="row-even"><td>1.0</td>
<td>1.7, 1.8</td>
<td>2.7, 3.3, 3.4</td>
</tr>
<tr class="row-odd"><td>1.1</td>
<td>1.7, 1.8</td>
<td>2.7, 3.3, 3.4</td>
</tr>
<tr class="row-even"><td>1.2</td>
<td>1.7, 1.8</td>
<td>2.7, 3.3, 3.4, 3.5</td>
</tr>
<tr class="row-odd"><td>1.3</td>
<td>1.7, 1.8, 1.9</td>
<td>2.7, 3.3, 3.4, 3.5</td>
</tr>
<tr class="row-even"><td>1.4 LTS</td>
<td>1.8, 1.9</td>
<td>2.7, 3.3, 3.4, 3.5</td>
</tr>
<tr class="row-odd"><td>1.5</td>
<td>1.8, 1.9</td>
<td>2.7, 3.3, 3.4, 3.5</td>
</tr>
<tr class="row-even"><td>1.6</td>
<td>1.8, 1.9, 1.10</td>
<td>2.7, 3.3, 3.4, 3.5</td>
</tr>
<tr class="row-odd"><td>1.7</td>
<td>1.8, 1.9, 1.10</td>
<td>2.7, 3.3, 3.4, 3.5</td>
</tr>
<tr class="row-even"><td>1.8 LTS</td>
<td>1.8, 1.9, 1.10</td>
<td>2.7, 3.3, 3.4, 3.5</td>
</tr>
<tr class="row-odd"><td>1.9</td>
<td>1.8, 1.9, 1.10</td>
<td>2.7, 3.3, 3.4, 3.5</td>
</tr>
<tr class="row-even"><td>1.10</td>
<td>1.8, 1.10, 1.11</td>
<td>2.7, 3.4, 3.5, 3.6</td>
</tr>
<tr class="row-odd"><td>1.11</td>
<td>1.8, 1.10, 1.11</td>
<td>2.7, 3.4, 3.5, 3.6</td>
</tr>
<tr class="row-even"><td>1.12 LTS</td>
<td>1.8, 1.10, 1.11</td>
<td>2.7, 3.4, 3.5, 3.6</td>
</tr>
<tr class="row-odd"><td>1.13 LTS</td>
<td>1.8, 1.10, 1.11</td>
<td>2.7, 3.4, 3.5, 3.6</td>
</tr>
<tr class="row-even"><td>2.0</td>
<td>1.11, 2.0</td>
<td>3.4, 3.5, 3.6</td>
</tr>
<tr class="row-odd"><td>2.1</td>
<td>1.11, 2.0</td>
<td>3.4, 3.5, 3.6</td>
</tr>
<tr class="row-even"><td>2.2</td>
<td>1.11, 2.0</td>
<td>3.4, 3.5, 3.6</td>
</tr>
<tr class="row-odd"><td>2.3 LTS</td>
<td>1.11, 2.0, 2.1</td>
<td>3.4, 3.5, 3.6</td>
</tr>
<tr class="row-even"><td>2.4</td>
<td>2.0, 2.1</td>
<td>3.4, 3.5, 3.6, 3.7</td>
</tr>
<tr class="row-odd"><td>2.5</td>
<td>2.0, 2.1, 2.2</td>
<td>3.4, 3.5, 3.6, 3.7</td>
</tr>
<tr class="row-even"><td>2.6</td>
<td>2.0, 2.1, 2.2</td>
<td>3.5, 3.6, 3.7</td>
</tr>
<tr class="row-odd"><td>2.7 LTS</td>
<td>2.0, 2.1, 2.2</td>
<td>3.5, 3.6, 3.7, 3.8</td>
</tr>
<tr class="row-even"><td>2.8</td>
<td>2.1, 2.2, 3.0</td>
<td>3.5, 3.6, 3.7, 3.8</td>
</tr>
<tr class="row-odd"><td>2.9</td>
<td>2.2, 3.0</td>
<td>3.5, 3.6, 3.7, 3.8</td>
</tr>
<tr class="row-even"><td>2.10</td>
<td>2.2, 3.0, 3.1</td>
<td>3.6, 3.7, 3.8</td>
</tr>
<tr class="row-odd"><td>2.11 LTS</td>
<td>2.2, 3.0, 3.1</td>
<td>3.6, 3.7, 3.8</td>
</tr>
<tr class="row-even"><td>2.12</td>
<td>2.2, 3.0, 3.1</td>
<td>3.6, 3.7, 3.8, 3.9</td>
</tr>
<tr class="row-odd"><td>2.13</td>
<td>2.2, 3.0, 3.1, 3.2</td>
<td>3.6, 3.7, 3.8, 3.9</td>
</tr>
<tr class="row-even"><td>2.14</td>
<td>3.0, 3.1, 3.2</td>
<td>3.6, 3.7, 3.8, 3.9</td>
</tr>
<tr class="row-odd"><td>2.15 LTS</td>
<td>3.0, 3.1, 3.2</td>
<td>3.6, 3.7, 3.8, 3.9</td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-releases/2.15"></span><div class="section" id="wagtail-2-15-release-notes-in-development">
<h4>Wagtail 2.15 release notes - IN DEVELOPMENT<a class="headerlink" href="#wagtail-2-15-release-notes-in-development" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<p>Wagtail 2.15 is designated a Long Term Support (LTS) release. Long Term Support releases will continue to receive maintenance updates as necessary to address security and data-loss related issues, up until the next LTS release (typically a period of 12 months).</p>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Add the ability for the page chooser to convert external urls that match a page to internal links, see <a class="reference internal" href="index.html#wagtailadmin-external-link-conversion"><span class="std std-ref">WAGTAILADMIN_EXTERNAL_LINK_CONVERSION</span></a> (Jacob Topp-Mugglestone. Sponsored by The Motley Fool)</li>
<li>Added “Extending Wagtail” section to documentation (Matt Westcott)</li>
<li>Introduced <a class="reference internal" href="index.html#document-extending/template_components"><span class="doc">template components</span></a>, a standard mechanism for renderable objects in the admin (Matt Westcott)</li>
<li>Support <code class="docutils literal notranslate"><span class="pre">min_num</span></code> / <code class="docutils literal notranslate"><span class="pre">max_num</span></code> options on ListBlock (Matt Westcott)</li>
<li>Added a <cite>background_position_style</cite> property to renditions. This can be used to crop images using its focal point in the browser. See <a class="reference internal" href="index.html#rendition-background-position-style"><span class="std std-ref">Setting the background-position inline style based on the focal point</span></a> (Karl Hobley)</li>
<li>Added a distinct <code class="docutils literal notranslate"><span class="pre">wagtail.copy_for_translation</span></code> log action type (Karl Hobley)</li>
<li>Add a debug logger around image rendition generation (Jake Howard)</li>
<li>Convert Documents and Images to class based views for easier overriding (Matt Westcott)</li>
<li>Isolate admin URLs for Documents and Images search listing results with the name <cite>‘listing_results’</cite> (Matt Westcott)</li>
<li>Removed <code class="docutils literal notranslate"><span class="pre">request.is_ajax()</span></code> usage in Documents, Image and Snippet views (Matt Westcott)</li>
<li>Simplify generic admin view templates plus ensure <code class="docutils literal notranslate"><span class="pre">page_title</span></code> and <code class="docutils literal notranslate"><span class="pre">page_subtitle</span></code> are used consistently (Matt Westcott)</li>
<li>Extend support for <a class="reference internal" href="index.html#collapsible"><span class="std std-ref">collapsing edit panels</span></a> from just MultiFieldPanels to all kinds of panels (Fabien Le Frapper, Robbie Mackay)</li>
<li>Add object count to header within modeladmin listing view (Jonathan “Yoni” Knoll)</li>
<li>Add ability to return HTML in multiple image upload errors (Gordon Pendleton)</li>
<li>Upgrade internal JS tooling; Node v14 plus other smaller package upgrades (LB (Ben Johnston))</li>
<li>Add support for <code class="docutils literal notranslate"><span class="pre">non_field_errors</span></code> rendering in Workflow action modal (LB (Ben Johnston))</li>
<li>Support calling <code class="docutils literal notranslate"><span class="pre">get_image_model</span></code> and <code class="docutils literal notranslate"><span class="pre">get_document_model</span></code> at import time (Matt Westcott)</li>
<li>When copying a page, default the ‘Publish copied page’ field to false (Justin Slay)</li>
<li>Open Preview and Live page links in the same tab, except where it would interrupt editing a Page (Sagar Agarwal)</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Delete button is now correct colour on snippets and modeladmin listings (Brandon Murch)</li>
<li>Ensure that StreamBlock / ListBlock-level validation errors are counted towards error counts (Matt Westcott)</li>
<li>InlinePanel add button is now keyboard navigatable (Jesse Menn)</li>
<li>Remove redundant ‘clear’ button from site root page chooser (Matt Westcott)</li>
<li>Make ModelAdmin IndexView keyboard-navigable (Saptak Sengupta)</li>
<li>Prevent error on refreshing page previews when multiple preview tabs are open (Alex Tomkins)</li>
<li>Multiple accessibility fixes for Windows high contrast mode; Admin fields, Icon visibility, Page Editor field panels, sidebar menu (Dmitrii Faiazov, Chakita Muttaraju, Onkar Apte, Desai Akshata, LB (Ben Johnston))</li>
<li><code class="docutils literal notranslate"><span class="pre">blocks.MultipleChoiceBlock</span></code>, <code class="docutils literal notranslate"><span class="pre">forms.CheckboxSelectMultiple</span></code> and <code class="docutils literal notranslate"><span class="pre">ArrayField</span></code> checkboxes will now stack instead of display inline to align with all other checkboxes fields (Seb Brown)</li>
<li>Screen readers can now access login screen field labels (Amy Chan)</li>
<li>Admin breadcrumbs home icon now shows for users with access to a subtree only (Stefan Hammer)</li>
<li>Add handling of invalid inline styles submitted to <code class="docutils literal notranslate"><span class="pre">RichText</span></code> so <code class="docutils literal notranslate"><span class="pre">ConfigException</span></code> is not thrown (Alex Tomkins)</li>
<li>Ensure comment notifications dropdown handles longer translations without overflowing content (Krzysztof Jeziorny)</li>
<li>Set <code class="docutils literal notranslate"><span class="pre">default_auto_field</span></code> in <code class="docutils literal notranslate"><span class="pre">postgres_search</span></code> <code class="docutils literal notranslate"><span class="pre">AppConfig</span></code> (Nick Moreton)</li>
<li>Ensure admin tab JS events are handled on page load (Andrew Stone)</li>
<li><cite>EmailNotificationMixin</cite> and <cite>send_notification</cite> should only send emails to active users (Bryan Williams)</li>
<li>Disable Task confirmation now shows the correct value for quantity of tasks in progress (LB Johnston)</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="admin-homepage-panels-summary-items-and-action-menu-items-now-use-components">
<h6>Admin homepage panels, summary items and action menu items now use components<a class="headerlink" href="#admin-homepage-panels-summary-items-and-action-menu-items-now-use-components" title="Permalink to this headline">¶</a></h6>
<p id="template-components-2-15">Several Wagtail hooks provide a mechanism for passing Python objects to be rendered as HTML inside admin views, and the APIs for these objects have been updated to adopt a common <a class="reference internal" href="index.html#document-extending/template_components"><span class="doc">template components</span></a> pattern. The affected objects are:</p>
<blockquote>
<div><ul class="simple">
<li>Homepage panels (as registered with the <a class="reference internal" href="index.html#construct-homepage-panels"><span class="std std-ref">construct_homepage_panels</span></a> hook)</li>
<li>Homepage summary items (as registered with the <a class="reference internal" href="index.html#construct-homepage-summary-items"><span class="std std-ref">construct_homepage_summary_items</span></a> hook)</li>
<li>Page action menu items (as registered with the <a class="reference internal" href="index.html#register-page-action-menu-item"><span class="std std-ref">register_page_action_menu_item</span></a> and <a class="reference internal" href="index.html#construct-page-action-menu"><span class="std std-ref">construct_page_action_menu</span></a> hooks)</li>
<li>Snippet action menu items (as registered with the <a class="reference internal" href="index.html#register-snippet-action-menu-item"><span class="std std-ref">register_snippet_action_menu_item</span></a> and <a class="reference internal" href="index.html#construct-snippet-action-menu"><span class="std std-ref">construct_snippet_action_menu</span></a> hooks)</li>
</ul>
</div></blockquote>
<p>User code that creates these objects should be updated to follow the component API. This will typically require the following changes:</p>
<blockquote>
<div><ul class="simple">
<li>Homepage panels should be made subclasses of <code class="docutils literal notranslate"><span class="pre">wagtail.admin.ui.components.Component</span></code>, and the <code class="docutils literal notranslate"><span class="pre">render(self)</span></code> method should be changed to <code class="docutils literal notranslate"><span class="pre">render_html(self,</span> <span class="pre">parent_context)</span></code>. (Alternatively, rather than defining <code class="docutils literal notranslate"><span class="pre">render_html</span></code>, it may be more convenient to reimplement it with a template, as per <a class="reference internal" href="index.html#creating-template-components"><span class="std std-ref">Creating components</span></a>.)</li>
<li>Summary item classes can continue to inherit from <code class="docutils literal notranslate"><span class="pre">wagtail.admin.site_summary.SummaryItem</span></code> (which is now a subclass of <code class="docutils literal notranslate"><span class="pre">Component</span></code>) as before, but:<ul>
<li>Any <code class="docutils literal notranslate"><span class="pre">template</span></code> attribute should be changed to <code class="docutils literal notranslate"><span class="pre">template_name</span></code>;</li>
<li>Any place where the <code class="docutils literal notranslate"><span class="pre">render(self)</span></code> method is overridden should be changed to <code class="docutils literal notranslate"><span class="pre">render_html(self,</span> <span class="pre">parent_context)</span></code>;</li>
<li>Any place where the <code class="docutils literal notranslate"><span class="pre">get_context(self)</span></code> method is overridden should be changed to <code class="docutils literal notranslate"><span class="pre">get_context_data(self,</span> <span class="pre">parent_context)</span></code>.</li>
</ul>
</li>
<li>Action menu items for pages and snippets can continue to inherit from <code class="docutils literal notranslate"><span class="pre">wagtail.admin.action_menu.ActionMenuItem</span></code> and <code class="docutils literal notranslate"><span class="pre">wagtail.snippets.action_menu.ActionMenuItem</span></code> respectively - these are now subclasses of <code class="docutils literal notranslate"><span class="pre">Component</span></code> - but:<ul>
<li>Any <code class="docutils literal notranslate"><span class="pre">template</span></code> attribute should be changed to <code class="docutils literal notranslate"><span class="pre">template_name</span></code>;</li>
<li>Any <code class="docutils literal notranslate"><span class="pre">get_context</span></code> method should be renamed to <code class="docutils literal notranslate"><span class="pre">get_context_data</span></code>;</li>
<li>The <code class="docutils literal notranslate"><span class="pre">get_url</span></code>, <code class="docutils literal notranslate"><span class="pre">is_shown</span></code>, <code class="docutils literal notranslate"><span class="pre">get_context_data</span></code> and <code class="docutils literal notranslate"><span class="pre">render_html</span></code> methods no longer accept a <code class="docutils literal notranslate"><span class="pre">request</span></code> parameter. The request object is available in the context dictionary as <code class="docutils literal notranslate"><span class="pre">context['request']</span></code>.</li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<span id="document-releases/2.14.1"></span><div class="section" id="wagtail-2-14-1-release-notes">
<h4>Wagtail 2.14.1 release notes<a class="headerlink" href="#wagtail-2-14-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Prevent failure on Twitter embeds and others which return cache_age as a string (Matt Westcott)</li>
<li>Fix Uncaught ReferenceError when editing links in Hallo (Cynthia Kiser)</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<span id="document-releases/2.14"></span><div class="section" id="wagtail-2-14-release-notes">
<h4>Wagtail 2.14 release notes<a class="headerlink" href="#wagtail-2-14-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="new-features">
<h6>New features<a class="headerlink" href="#new-features" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Added <code class="docutils literal notranslate"><span class="pre">ancestor_of</span></code> API filter. See <a class="reference internal" href="index.html#apiv2-filter-by-tree-position"><span class="std std-ref">Filtering by tree position (pages only)</span></a>. (Jaap Roes)</li>
<li>Added support for customising group management views. See <a class="reference internal" href="index.html#customising-group-views"><span class="std std-ref">Customising group edit/create views</span></a>. (Jan Seifert)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">full_url</span></code> property to image renditions (Shreyash Srivastava)</li>
<li>Added locale selector when choosing translatable snippets (Karl Hobley)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">WAGTAIL_WORKFLOW_ENABLED</span></code> setting for enabling / disabling moderation workflows globally (Matt Westcott)</li>
<li>Allow specifying <code class="docutils literal notranslate"><span class="pre">max_width</span></code> and <code class="docutils literal notranslate"><span class="pre">max_height</span></code> on EmbedBlock (Petr Dlouhý)</li>
<li>Add warning when StreamField is used without a StreamFieldPanel (Naomi Morduch Toubman)</li>
<li>Added keyboard and screen reader support to Wagtail user bar (LB Johnston, Storm Heg)</li>
<li>Added instructions on copying and aliasing pages to the editor’s guide in documentation (Vlad Podgurschi)</li>
<li>Add Google Data Studio to the list of oEmbed providers (Petr Dlouhý)</li>
<li>Allow ListBlock to raise validation errors that are not attached to an individual child block (Matt Westcott)</li>
<li>Use <code class="docutils literal notranslate"><span class="pre">DATETIME_FORMAT</span></code> for localization in templates (Andrew Stone)</li>
<li>Added documentation on multi site, multi instance and multi tenancy setups (Coen Van Der Kamp)</li>
<li>Updated Facebook / Instagram oEmbed endpoints to v11.0 (Thomas Kremmel)</li>
<li>Performance improvements for admin listing pages (Jake Howard, Dan Braghis, Tom Usher)</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Invalid filter values for foreign key fields in the API now give an error instead of crashing (Tidjani Dia)</li>
<li>Ordering specified in the <code class="docutils literal notranslate"><span class="pre">construct_explorer_page_queryset</span></code> hook is now taken into account again by the page explorer API (Andre Fonseca)</li>
<li>Deleting a page from its listing view no longer results in a 404 error (Tidjani Dia)</li>
<li>The Wagtail admin urls will now respect the <code class="docutils literal notranslate"><span class="pre">APPEND_SLASH</span></code> setting (Tidjani Dia)</li>
<li>Prevent “Forgotten password” link from overlapping with field on mobile devices (Helen Chapman)</li>
<li>Snippet admin urls are now namespaced to avoid ambiguity with the primary key component of the url (Matt Westcott)</li>
<li>Prevent error on copying pages with ClusterTaggableManager relations and multi-level inheritance (Chris Pollard)</li>
<li>Prevent failure on root page when registering the Page model with ModelAdmin (Jake Howard)</li>
<li>Prevent error when filtering page search results with a malformed content_type (Chris Pollard)</li>
<li>Prevent multiple submissions of “update” form when uploading images / documents (Mike Brown)</li>
<li>Ensure HTML title is populated on project template 404 page (Matt Westcott)</li>
<li>Respect cache_age parameters on embeds (Gordon Pendleton)</li>
<li>Page comparison view now reflects request-level customisations to edit handlers (Matt Westcott)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">block.super</span></code> to remaining <code class="docutils literal notranslate"><span class="pre">extra_js</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">extra_css</span></code> blocks (Andrew Stone)</li>
<li>Ensure that <code class="docutils literal notranslate"><span class="pre">editor</span></code> and <code class="docutils literal notranslate"><span class="pre">features</span></code> arguments on RichTextField are preserved by <code class="docutils literal notranslate"><span class="pre">clone()</span></code> (Daniel Fairhead)</li>
<li>Rename ‘spin’ CSS animation to avoid clashes with other libraries (Kevin Gutiérrez)</li>
<li>Prevent crash when copying a page from a section where the user has no publish permission (Karl Hobley)</li>
<li>Ensure that rich text conversion correctly handles images / embeds inside links or inline styles (Matt Westcott)</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="removed-support-for-django-2-2">
<h6>Removed support for Django 2.2<a class="headerlink" href="#removed-support-for-django-2-2" title="Permalink to this headline">¶</a></h6>
<p>Django 2.2 is no longer supported as of this release; please upgrade to Django 3.0 or above before upgrading Wagtail.</p>
</div>
<div class="section" id="user-bar-with-keyboard-and-screen-reader-support">
<h6>User bar with keyboard and screen reader support<a class="headerlink" href="#user-bar-with-keyboard-and-screen-reader-support" title="Permalink to this headline">¶</a></h6>
<p>The Wagtail user bar (“edit bird”) widget now supports keyboard and screen reader navigation. To make the most of this, we now recommend placing the widget near the top of the page <code class="docutils literal notranslate"><span class="pre">&lt;body&gt;</span></code>, so users can reach it without having to go through the whole page. See <a class="reference internal" href="index.html#wagtailuserbar-tag"><span class="std std-ref">Wagtail User Bar</span></a> for more information.</p>
<p>For implementers of custom user bar menu items, we also now require the addition of <code class="docutils literal notranslate"><span class="pre">role=&quot;menuitem&quot;</span></code> on the <code class="docutils literal notranslate"><span class="pre">a</span></code> element to provide the correct semantics. See <a class="reference internal" href="index.html#construct-wagtail-userbar"><span class="std std-ref">construct_wagtail_userbar</span></a> for more information.</p>
</div>
<div class="section" id="deprecation-of-facebook-instagram-oembed-product">
<h6>Deprecation of Facebook / Instagram oEmbed product<a class="headerlink" href="#deprecation-of-facebook-instagram-oembed-product" title="Permalink to this headline">¶</a></h6>
<p>As of June 2021, the procedure for setting up a Facebook app to handle Facebook / Instagram embedded content (see <a class="reference internal" href="index.html#facebook-and-instagram-embeds"><span class="std std-ref">Facebook and Instagram</span></a>) has changed. It is now necessary to activate the “oEmbed Read” feature on the app, and submit it to Facebook for review. Apps that activated the oEmbed Product before June 8, 2021 must be migrated to oEmbed Read by September 7, 2021 to continue working. No change to the Wagtail code or configuration is required.</p>
</div>
</div>
</div>
<span id="document-releases/2.13.4"></span><div class="section" id="wagtail-2-13-4-release-notes">
<h4>Wagtail 2.13.4 release notes<a class="headerlink" href="#wagtail-2-13-4-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Prevent embed thumbnail_url migration from failing on URLs longer than 200 characters (Matt Westcott)</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<span id="document-releases/2.13.3"></span><div class="section" id="wagtail-2-13-3-release-notes">
<h4>Wagtail 2.13.3 release notes<a class="headerlink" href="#wagtail-2-13-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Prevent error when using rich text on views where commenting is unavailable (Jacob Topp-Mugglestone)</li>
<li>Include form media on account settings page (Matt Westcott)</li>
<li>Avoid error when rendering validation error messages on ListBlock children (Matt Westcott)</li>
<li>Prevent comments CSS from overriding admin UI colour customisations (Matt Westcott)</li>
<li>Avoid validation error when editing rich text content preceding a comment (Jacob Topp-Mugglestone)</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<span id="document-releases/2.13.2"></span><div class="section" id="wagtail-2-13-2-release-notes">
<h4>Wagtail 2.13.2 release notes<a class="headerlink" href="#wagtail-2-13-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="cve-2021-32681-improper-escaping-of-html-cross-site-scripting-in-wagtail-streamfield-blocks">
<h6>CVE-2021-32681: Improper escaping of HTML (‘Cross-site Scripting’) in Wagtail StreamField blocks<a class="headerlink" href="#cve-2021-32681-improper-escaping-of-html-cross-site-scripting-in-wagtail-streamfield-blocks" title="Permalink to this headline">¶</a></h6>
<p>This release addresses a cross-site scripting (XSS) vulnerability in StreamField. When the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> template tag is used to output the value of a plain-text StreamField block (<code class="docutils literal notranslate"><span class="pre">CharBlock</span></code>, <code class="docutils literal notranslate"><span class="pre">TextBlock</span></code> or a similar user-defined block derived from <code class="docutils literal notranslate"><span class="pre">FieldBlock</span></code>), and that block does not specify a template for rendering, the tag output is not properly escaped as HTML. This could allow users to insert arbitrary HTML or scripting. This vulnerability is only exploitable by users with the ability to author StreamField content (i.e. users with ‘editor’ access to the Wagtail admin).</p>
<p>Site implementors who wish to retain the existing behaviour of allowing editors to insert HTML content in these blocks (and are willing to accept the risk of untrusted editors inserting arbitrary code) may disable the escaping by surrounding the relevant <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> tag in <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">autoescape</span> <span class="pre">off</span> <span class="pre">%}...{%</span> <span class="pre">endautoescape</span> <span class="pre">%}</span></code>.</p>
<p>Many thanks to Karen Tracey for reporting this issue. For further details, please see <a class="reference external" href="https://github.com/wagtail/wagtail/security/advisories/GHSA-xfrw-hxr5-ghqf">the CVE-2021-32681 security advisory</a>.</p>
</div>
</div>
</div>
<span id="document-releases/2.13.1"></span><div class="section" id="wagtail-2-13-1-release-notes">
<h4>Wagtail 2.13.1 release notes<a class="headerlink" href="#wagtail-2-13-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Ensure comment notification checkbox is fully hidden when commenting is disabled (Karl Hobley)</li>
<li>Prevent commenting from failing for user models with UUID primary keys (Jacob Topp-Mugglestone)</li>
<li>Fix incorrect link in comment notification HTML email (Matt Westcott)</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<span id="document-releases/2.13"></span><div class="section" id="wagtail-2-13-release-notes">
<h4>Wagtail 2.13 release notes<a class="headerlink" href="#wagtail-2-13-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id2">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id3">Upgrade considerations</a></li>
<li><a class="reference internal" href="#feedback" id="id4">Feedback</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id2">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="streamfield-performance-and-functionality-updates">
<h6>StreamField performance and functionality updates<a class="headerlink" href="#streamfield-performance-and-functionality-updates" title="Permalink to this headline">¶</a></h6>
<p>The StreamField editing interface has been rebuilt on a client-side rendering model, powered by the <a class="reference external" href="https://wagtail.github.io/telepath/">telepath</a> library. This provides better performance, increased customisability and UI enhancements including the ability to duplicate blocks. For further background, see the blog post <a class="reference external" href="https://wagtail.io/blog/telepath/">Telepath - the next evolution of StreamField</a>.</p>
<p>This feature was developed by Matt Westcott and Karl Hobley and sponsored by <a class="reference external" href="https://yougov.co.uk/">YouGov</a>, inspired by earlier work on <a class="reference external" href="https://github.com/wagtail/wagtail-react-streamfield">react-streamfield</a> completed by Bertrand Bordage through the <a class="reference external" href="https://www.kickstarter.com/projects/noripyt/wagtails-first-hatch">Wagtail’s First Hatch</a> crowdfunder.</p>
</div>
<div class="section" id="simple-translation-module">
<h6>Simple translation module<a class="headerlink" href="#simple-translation-module" title="Permalink to this headline">¶</a></h6>
<p>In Wagtail 2.12 we shipped the new localisation support, but in order to translate content an external library had to be used, such as <a class="reference external" href="https://www.wagtail-localize.org">wagtail-localize</a>.</p>
<p>In this release, a new contrib app has been introduced called <a class="reference internal" href="index.html#document-reference/contrib/simple_translation"><span class="doc">simple_translation</span></a>. This allows you to create copies of pages and translatable snippets in other languages and translate them as regular Wagtail pages. It does not include any more advanced translation features such as using external services, PO files, or an interface that helps keep translations in sync with the original language.</p>
<p>This module was contributed by Coen van der Kamp.</p>
</div>
<div class="section" id="commenting">
<h6>Commenting<a class="headerlink" href="#commenting" title="Permalink to this headline">¶</a></h6>
<p>The page editor now supports <a class="reference internal" href="index.html#commenting"><span class="std std-ref">leaving comments on fields and StreamField blocks</span></a>, by entering commenting mode (using the button in the top right of the editor). Inline comments are available in rich text fields using the Draftail editor.</p>
<p>This feature was developed by Jacob Topp-Mugglestone, Karl Hobley and Simon Evans and sponsored by <a class="reference external" href="https://www.fool.com/">The Motley Fool</a>.</p>
</div>
<div class="section" id="combined-account-settings">
<h6>Combined account settings<a class="headerlink" href="#combined-account-settings" title="Permalink to this headline">¶</a></h6>
<p>The “Account settings” section available at the bottom of the admin menu has been updated to include all settings on a single form. This feature was developed by Karl Hobley.</p>
</div>
<div class="section" id="redirect-export">
<h6>Redirect export<a class="headerlink" href="#redirect-export" title="Permalink to this headline">¶</a></h6>
<p>The redirects module now includes support for exporting the list of redirects to XLSX or CSV. This feature was developed by Martin Sandström.</p>
</div>
<div class="section" id="sphinx-wagtail-theme">
<h6>Sphinx Wagtail Theme<a class="headerlink" href="#sphinx-wagtail-theme" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference external" href="https://docs.wagtail.io/">documentation</a> now uses our brand new <a class="reference external" href="https://github.com/wagtail/sphinx_wagtail_theme">Sphinx Wagtail Theme</a>, with a search feature powered by <a class="reference external" href="https://docsearch.algolia.com/">Algolia DocSearch</a>.</p>
<p>Feedback and feature requests for the theme may be reported to the <a class="reference external" href="https://github.com/wagtail/sphinx_wagtail_theme/issues">sphinx_wagtail_theme issue list</a>, and to Wagtail’s issues for the search.</p>
<p>Thank you to Storm Heg, Tibor Leupold, Thibaud Colas, Coen van der Kamp, Olly Willans, Naomi Morduch Toubman, Scott Cranfill, and Andy Chosak for making this happen!</p>
</div>
<div class="section" id="django-3-2-support">
<h6>Django 3.2 support<a class="headerlink" href="#django-3-2-support" title="Permalink to this headline">¶</a></h6>
<p>Django 3.2 is formally supported in this release. Note that Wagtail 2.13 will be the last release to support Django 2.2.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Support passing <code class="docutils literal notranslate"><span class="pre">min_num</span></code>, <code class="docutils literal notranslate"><span class="pre">max_num</span></code> and <code class="docutils literal notranslate"><span class="pre">block_counts</span></code> arguments directly to <code class="docutils literal notranslate"><span class="pre">StreamField</span></code> (Haydn Greatnews, Matt Westcott)</li>
<li>Add the option to set rich text images as decorative, without alt text (Helen Chapman, Thibaud Colas)</li>
<li>Add support for <code class="docutils literal notranslate"><span class="pre">__year</span></code> filter in Elasticsearch queries (Seb Brown)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">PageQuerySet.defer_streamfields()</span></code> (Andy Babic)</li>
<li>Utilize <code class="docutils literal notranslate"><span class="pre">PageQuerySet.defer_streamfields()</span></code> to improve efficiency in a few key places (Andy Babic)</li>
<li>Support passing multiple models as arguments to <code class="docutils literal notranslate"><span class="pre">type()</span></code>, <code class="docutils literal notranslate"><span class="pre">not_type()</span></code>, <code class="docutils literal notranslate"><span class="pre">exact_type()</span></code> and <code class="docutils literal notranslate"><span class="pre">not_exact_type()</span></code> methods on <code class="docutils literal notranslate"><span class="pre">PageQuerySet</span></code> (Andy Babic)</li>
<li>Update default attribute copying behaviour of <code class="docutils literal notranslate"><span class="pre">Page.get_specific()</span></code> and added the <code class="docutils literal notranslate"><span class="pre">copy_attrs_exclude</span></code> option (Andy Babic)</li>
<li>Update <code class="docutils literal notranslate"><span class="pre">PageQueryset.specific(defer=True)</span></code> to only perform a single database query (Andy Babic)</li>
<li>Switched <code class="docutils literal notranslate"><span class="pre">register_setting</span></code>, <code class="docutils literal notranslate"><span class="pre">register_settings_menu_item</span></code> to use SVG icons (Thibaud Colas)</li>
<li>Add support to SVG icons for <code class="docutils literal notranslate"><span class="pre">SearchArea</span></code> subclasses in <code class="docutils literal notranslate"><span class="pre">register_admin_search_area</span></code> (Thibaud Colas)</li>
<li>Add specialized <code class="docutils literal notranslate"><span class="pre">wagtail.reorder</span></code> page audit log action. This was previously covered by the <code class="docutils literal notranslate"><span class="pre">wagtail.move</span></code> action (Storm Heg)</li>
<li><code class="docutils literal notranslate"><span class="pre">get_settings</span></code> template tag now supports specifying the variable name with <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_settings</span> <span class="pre">as</span> <span class="pre">var</span> <span class="pre">%}</span></code> (Samir Shah)</li>
<li>Reinstate submitter’s name on moderation notification email (Matt Westcott)</li>
<li>Add a new switch input widget as an alternative to checkboxes (Karl Hobley)</li>
<li>Allow <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">pageurl</span> <span class="pre">%}</span></code> fallback to be a direct URL or an object with a <code class="docutils literal notranslate"><span class="pre">get_absolute_url</span></code> method (Andy Babic)</li>
<li>Support slicing on StreamField / StreamBlock values (Matt Westcott)</li>
<li>Switch Wagtail choosers to use SVG icons instead of font icon (Storm Heg)</li>
<li>Save revision when restart workflow (Ihor Marhitych)</li>
<li>Add a visible indicator of unsaved changes to the page editor (Jacob Topp-Mugglestone)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>StreamField required status is now consistently handled by the <code class="docutils literal notranslate"><span class="pre">blank</span></code> keyword argument (Matt Westcott)</li>
<li>Show ‘required’ asterisks for blocks inside required StreamFields (Matt Westcott)</li>
<li>Make image chooser “Select format” fields translatable (Helen Chapman, Thibaud Colas)</li>
<li>Fix pagination on ‘view users in a group’ (Sagar Agarwal)</li>
<li>Prevent page privacy menu from being triggered by pressing enter on a char field (Sagar Agarwal)</li>
<li>Validate host/scheme of return URLs on password authentication forms (Susan Dreher)</li>
<li>Reordering a page now includes the correct user in the audit log (Storm Heg)</li>
<li>Fix reverse migration errors in images and documents (Mike Brown)</li>
<li>Make “Collection” and “Parent” form field labels translatable (Thibaud Colas)</li>
<li>Apply enough chevron padding to all applicable select elements (Scott Cranfill)</li>
<li>Reduce database queries in the page edit view (Ihor Marhitych)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id3">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="end-of-internet-explorer-11-support">
<h6>End of Internet Explorer 11 support<a class="headerlink" href="#end-of-internet-explorer-11-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail 2.13 will be the last Wagtail release to support IE11. Users accessing the admin with IE11 will be shown a warning message advising that support is being phased out.</p>
</div>
<div class="section" id="updated-handling-of-non-required-streamfields">
<h6>Updated handling of non-required StreamFields<a class="headerlink" href="#updated-handling-of-non-required-streamfields" title="Permalink to this headline">¶</a></h6>
<p>The rules for determining whether a StreamField is required (i.e. at least one block must be provided) have been simplified and made consistent with other field types. Non-required fields are now indicated by <code class="docutils literal notranslate"><span class="pre">blank=True</span></code> on the <code class="docutils literal notranslate"><span class="pre">StreamField</span></code> definition; the default is <code class="docutils literal notranslate"><span class="pre">blank=False</span></code> (the field is required). In previous versions, to make a field non-required, it was necessary to define <a class="reference internal" href="index.html#streamfield-top-level-streamblock"><span class="std std-ref">a top-level StreamBlock</span></a> with <code class="docutils literal notranslate"><span class="pre">required=False</span></code> (which applied the validation rule) as well as setting <code class="docutils literal notranslate"><span class="pre">blank=True</span></code> (which removed the asterisk from the form field). You should review your use of StreamField to check that <code class="docutils literal notranslate"><span class="pre">blank=True</span></code> is used on the fields you wish to make optional.</p>
</div>
<div class="section" id="new-client-side-implementation-for-custom-streamfield-blocks">
<h6>New client-side implementation for custom StreamField blocks<a class="headerlink" href="#new-client-side-implementation-for-custom-streamfield-blocks" title="Permalink to this headline">¶</a></h6>
<p>For the majority of cases, the new StreamField implementation in this release will be a like-for-like upgrade, and no code changes will be necessary - this includes projects where custom block types have been defined by extending <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code>, <code class="docutils literal notranslate"><span class="pre">ListBlock</span></code> and <code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code>. However, certain complex customisations may need to be reimplemented to work with the new client-side rendering model:</p>
<ul class="simple">
<li>When customising the form template for a <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> using the <code class="docutils literal notranslate"><span class="pre">form_template</span></code> attribute, the HTML of each child block must be enclosed in an element with a <code class="docutils literal notranslate"><span class="pre">data-contentpath</span></code> attribute equal to the block’s name. This attribute is used by the commenting framework to attach comments to the correct fields. See <a class="reference internal" href="index.html#custom-editing-interfaces-for-structblock"><span class="std std-ref">Custom editing interfaces for StructBlock</span></a>.</li>
<li>If a <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> subclass overrides the <code class="docutils literal notranslate"><span class="pre">get_form_context</span></code> method as part of customising the form template, and that method contains logic that causes the returned context to vary depending on the block value, this will no longer work as intended. This is because <code class="docutils literal notranslate"><span class="pre">get_form_context</span></code> is now invoked once with the block’s default (blank) value in order to construct a template for the client-side rendering to use; previously it was called for each block in the stream. In the new implementation, any Python-side processing that needs to happen on a per-block-value basis can be performed in the block’s <code class="docutils literal notranslate"><span class="pre">get_form_state</span></code> method; the data returned from that method will then be available in the client-side <code class="docutils literal notranslate"><span class="pre">render</span></code> method.</li>
<li>If <code class="docutils literal notranslate"><span class="pre">FieldBlock</span></code> is used to wrap a Django widget with non-standard client-side behaviour - such as requiring a JavaScript function to be called on initialisation, or combining multiple HTML elements such that it is not possible to read or write its data by accessing a single element’s <code class="docutils literal notranslate"><span class="pre">value</span></code> property - then you will need to supply a JavaScript handler object to define how the widget is rendered and populated, and how to extract data from it.</li>
<li>Packages that replace the StreamField interface at a low level, such as <code class="docutils literal notranslate"><span class="pre">wagtail-react-streamfield</span></code>, are likely to be incompatible (but the new StreamField implementation will generally offer equivalent functionality).</li>
</ul>
<p>For further details, see <a class="reference internal" href="index.html#custom-streamfield-blocks"><span class="std std-ref">How to build custom StreamField blocks</span></a>.</p>
</div>
<div class="section" id="switched-register-setting-register-settings-menu-item-to-use-svg-icons">
<h6>Switched <code class="docutils literal notranslate"><span class="pre">register_setting</span></code>, <code class="docutils literal notranslate"><span class="pre">register_settings_menu_item</span></code> to use SVG icons<a class="headerlink" href="#switched-register-setting-register-settings-menu-item-to-use-svg-icons" title="Permalink to this headline">¶</a></h6>
<p>Setting menu items now use SVG icons by default. For sites reusing built-in Wagtail icons, no changes should be required. For sites using custom font icons, update the menu items’ definition to use the <code class="docutils literal notranslate"><span class="pre">classnames</span></code> attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># With register_setting,</span>
<span class="c1"># Before:</span>
<span class="nd">@register_setting</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s1">&#39;custom-cog&#39;</span><span class="p">)</span>
<span class="c1"># After:</span>
<span class="nd">@register_setting</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">classnames</span><span class="o">=</span><span class="s1">&#39;icon icon-custom-cog&#39;</span><span class="p">)</span>

<span class="c1"># Or with register_settings_menu_item,</span>
<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_settings_menu_item&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register_frank_menu_item</span><span class="p">():</span>
    <span class="c1"># Before:</span>
    <span class="k">return</span> <span class="n">SettingMenuItem</span><span class="p">(</span><span class="n">CustomSetting</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;custom-cog&#39;</span><span class="p">)</span>
    <span class="c1"># After:</span>
    <span class="k">return</span> <span class="n">SettingMenuItem</span><span class="p">(</span><span class="n">CustomSetting</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">classnames</span><span class="o">=</span><span class="s1">&#39;icon icon-custom-cog&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="commentpanel">
<h6><code class="docutils literal notranslate"><span class="pre">CommentPanel</span></code><a class="headerlink" href="#commentpanel" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">Page.settings_panels</span></code> now includes <code class="docutils literal notranslate"><span class="pre">CommentPanel</span></code>, which is used to save and load comments. If you are overriding page settings edit handlers
without directly extending <code class="docutils literal notranslate"><span class="pre">Page.settings_panels</span></code> (ie <code class="docutils literal notranslate"><span class="pre">settings_panels</span> <span class="pre">=</span> <span class="pre">Page.settings_panels</span> <span class="pre">+</span> <span class="pre">[</span> <span class="pre">FieldPanel('my_field')</span> <span class="pre">]</span></code> would need no
change here) and want to use the new commenting system, your list of edit handlers should be updated to include <code class="docutils literal notranslate"><span class="pre">CommentPanel</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.edit_handlers</span> <span class="kn">import</span> <span class="n">CommentPanel</span>


<span class="k">class</span> <span class="nc">HomePage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">settings_panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># My existing panels here</span>
        <span class="n">CommentPanel</span><span class="p">(),</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="feedback">
<h5><a class="toc-backref" href="#id4">Feedback</a><a class="headerlink" href="#feedback" title="Permalink to this headline">¶</a></h5>
<p>We would love to <a class="reference external" href="https://forms.gle/G5WYo6sLiZiwdfsQA">receive your feedback</a> on this release.</p>
</div>
</div>
<span id="document-releases/2.12.6"></span><div class="section" id="wagtail-2-12-6-release-notes">
<h4>Wagtail 2.12.6 release notes<a class="headerlink" href="#wagtail-2-12-6-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Prevent embed thumbnail_url migration from failing on URLs longer than 200 characters (Matt Westcott)</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<span id="document-releases/2.12.5"></span><div class="section" id="wagtail-2-12-5-release-notes">
<h4>Wagtail 2.12.5 release notes<a class="headerlink" href="#wagtail-2-12-5-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="cve-2021-32681-improper-escaping-of-html-cross-site-scripting-in-wagtail-streamfield-blocks">
<h6>CVE-2021-32681: Improper escaping of HTML (‘Cross-site Scripting’) in Wagtail StreamField blocks<a class="headerlink" href="#cve-2021-32681-improper-escaping-of-html-cross-site-scripting-in-wagtail-streamfield-blocks" title="Permalink to this headline">¶</a></h6>
<p>This release addresses a cross-site scripting (XSS) vulnerability in StreamField. When the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> template tag is used to output the value of a plain-text StreamField block (<code class="docutils literal notranslate"><span class="pre">CharBlock</span></code>, <code class="docutils literal notranslate"><span class="pre">TextBlock</span></code> or a similar user-defined block derived from <code class="docutils literal notranslate"><span class="pre">FieldBlock</span></code>), and that block does not specify a template for rendering, the tag output is not properly escaped as HTML. This could allow users to insert arbitrary HTML or scripting. This vulnerability is only exploitable by users with the ability to author StreamField content (i.e. users with ‘editor’ access to the Wagtail admin).</p>
<p>Site implementors who wish to retain the existing behaviour of allowing editors to insert HTML content in these blocks (and are willing to accept the risk of untrusted editors inserting arbitrary code) may disable the escaping by surrounding the relevant <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> tag in <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">autoescape</span> <span class="pre">off</span> <span class="pre">%}...{%</span> <span class="pre">endautoescape</span> <span class="pre">%}</span></code>.</p>
<p>Many thanks to Karen Tracey for reporting this issue. For further details, please see <a class="reference external" href="https://github.com/wagtail/wagtail/security/advisories/GHSA-xfrw-hxr5-ghqf">the CVE-2021-32681 security advisory</a>.</p>
</div>
</div>
</div>
<span id="document-releases/2.12.4"></span><div class="section" id="wagtail-2-12-4-release-notes">
<h4>Wagtail 2.12.4 release notes<a class="headerlink" href="#wagtail-2-12-4-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="cve-2021-29434-improper-validation-of-urls-cross-site-scripting-in-rich-text-fields">
<h6>CVE-2021-29434: Improper validation of URLs (‘Cross-site Scripting’) in rich text fields<a class="headerlink" href="#cve-2021-29434-improper-validation-of-urls-cross-site-scripting-in-rich-text-fields" title="Permalink to this headline">¶</a></h6>
<p>This release addresses a cross-site scripting (XSS) vulnerability in rich text fields. When saving the contents of a rich text field in the admin interface, Wagtail did not apply server-side checks to ensure that link URLs use a valid protocol. A malicious user with access to the admin interface could thus craft a POST request to publish content with javascript: URLs containing arbitrary code. The vulnerability is not exploitable by an ordinary site visitor without access to the Wagtail admin.</p>
<p>Many thanks to Kevin Breen for reporting this issue.</p>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Prevent reverse migration errors in images and documents (Mike Brown)</li>
<li>Avoid wagtailembeds migration failure on MySQL 8.0.13+ (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.12.3"></span><div class="section" id="wagtail-2-12-3-release-notes">
<h4>Wagtail 2.12.3 release notes<a class="headerlink" href="#wagtail-2-12-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Un-pin django-treebeard following upstream fix for migration issue (Matt Westcott)</li>
<li>Prevent crash when copying an alias page (Karl Hobley)</li>
<li>Prevent errors on page editing after changing LANGUAGE_CODE (Matt Westcott)</li>
<li>Correctly handle model inheritance and <code class="docutils literal notranslate"><span class="pre">ClusterableModel</span></code> on <code class="docutils literal notranslate"><span class="pre">copy_for_translation</span></code> (Karl Hobley)</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<span id="document-releases/2.12.2"></span><div class="section" id="wagtail-2-12-2-release-notes">
<h4>Wagtail 2.12.2 release notes<a class="headerlink" href="#wagtail-2-12-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Pin django-treebeard to &lt;4.5 to prevent migration conflicts (Matt Westcott)</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<span id="document-releases/2.12.1"></span><div class="section" id="wagtail-2-12-1-release-notes">
<h4>Wagtail 2.12.1 release notes<a class="headerlink" href="#wagtail-2-12-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Ensure aliases are published when the source page is published (Karl Hobley)</li>
<li>Make page privacy rules apply to aliases (Karl Hobley)</li>
<li>Prevent error when saving embeds that do not include a thumbnail URL (Cynthia Kiser)</li>
<li>Ensure that duplicate embed records are deleted when upgrading (Matt Westcott)</li>
<li>Prevent failure when running <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">dumpdata</span></code> with no arguments (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.12"></span><div class="section" id="wagtail-2-12-release-notes">
<h4>Wagtail 2.12 release notes<a class="headerlink" href="#wagtail-2-12-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="image-document-choose-permission">
<h6>Image / document choose permission<a class="headerlink" href="#image-document-choose-permission" title="Permalink to this headline">¶</a></h6>
<p>Images and documents now support a distinct ‘choose’ permission type, to control the set of items displayed in the chooser interfaces when inserting images and documents into a page, and allow setting up collections that are only available for use by specific user groups. This feature was developed by Robert Rollins.</p>
</div>
<div class="section" id="in-place-streamfield-updating">
<h6>In-place StreamField updating<a class="headerlink" href="#in-place-streamfield-updating" title="Permalink to this headline">¶</a></h6>
<p>StreamField values now formally support being updated in-place from Python code, allowing blocks to be inserted, modified and deleted rather than having to assign a new list of blocks to the field. For further details, see <a class="reference internal" href="index.html#modifying-streamfield-data"><span class="std std-ref">Modifying StreamField data</span></a>. This feature was developed by Matt Westcott.</p>
</div>
<div class="section" id="admin-color-themes">
<h6>Admin color themes<a class="headerlink" href="#admin-color-themes" title="Permalink to this headline">¶</a></h6>
<p>Wagtail’s admin now uses CSS custom properties for its primary teal color. Applying brand colors for the whole user interface only takes a few lines of CSS, and third-party extensions can reuse Wagtail’s CSS variables to support the same degree of customization. Read on <a class="reference internal" href="index.html#custom-user-interface-colors"><span class="std std-ref">Custom user interface colors</span></a>. This feature was developed by Joshua Marantz.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added support for Python 3.9</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_IMAGE_FORM_BASE</span></code> and <code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_DOCUMENT_FORM_BASE</span></code> settings to customise the forms for images and documents (Dan Braghis)</li>
<li>Switch pagination icons to use SVG instead of icon fonts (Scott Cranfill)</li>
<li>Added string representation to image Format class (Andreas Nüßlein)</li>
<li>Support returning None from <code class="docutils literal notranslate"><span class="pre">register_page_action_menu_item</span></code> and <code class="docutils literal notranslate"><span class="pre">register_snippet_action_menu_item</span></code> to skip registering an item (Vadim Karpenko)</li>
<li>Fields on a custom image model can now be defined as required / <code class="docutils literal notranslate"><span class="pre">blank=False</span></code> (Matt Westcott)</li>
<li>Add combined index for Postgres search backend (Will Giddens)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">Page.specific_deferred</span></code> property for accessing specific page instance without up-front database queries (Andy Babic)</li>
<li>Add hash lookup to embeds to support URLs longer than 255 characters (Coen van der Kamp)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Stop menu icon overlapping the breadcrumb on small viewport widths in page editor (Karran Besen)</li>
<li>Make sure document chooser pagination preserves the selected collection when moving between pages (Alex Sa)</li>
<li>Gracefully handle oEmbed endpoints returning non-JSON responses (Matt Westcott)</li>
<li>Fix unique constraint on WorkflowState for SQL Server compatibility (David Beitey)</li>
<li>Reinstate chevron on collection dropdown (Mike Brown)</li>
<li>Prevent delete button showing on collection / workflow edit views when delete permission is absent (Helder Correia)</li>
<li>Move labels above the form field in the image format chooser, to avoid styling issues at tablet size (Helen Chapman)</li>
<li><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">with</span> <span class="pre">context</span> <span class="pre">%}</span></code> now passes local variables into the block template (Jonny Scholes)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="removed-support-for-elasticsearch-2">
<h6>Removed support for Elasticsearch 2<a class="headerlink" href="#removed-support-for-elasticsearch-2" title="Permalink to this headline">¶</a></h6>
<p>Elasticsearch version 2 is no longer supported as of this release; please upgrade to Elasticsearch 5 or above before upgrading Wagtail.</p>
</div>
<div class="section" id="stream-data-on-streamfield-values-is-deprecated">
<h6><code class="docutils literal notranslate"><span class="pre">stream_data</span></code> on StreamField values is deprecated<a class="headerlink" href="#stream-data-on-streamfield-values-is-deprecated" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">stream_data</span></code> property of StreamValue is commonly used to access the underlying data of a StreamField. However, this is discouraged, as it is an undocumented internal attribute and has different data representations depending on whether the value originated from the database or in memory, typically leading to errors on preview if this has not been properly accounted for. As such, <code class="docutils literal notranslate"><span class="pre">stream_data</span></code> is now deprecated.</p>
<p>The recommended alternative is to index the StreamField value directly as a list; for example, <code class="docutils literal notranslate"><span class="pre">page.body[0].block_type</span></code> and <code class="docutils literal notranslate"><span class="pre">page.body[0].value</span></code> instead of <code class="docutils literal notranslate"><span class="pre">page.body.stream_data[0]['type']</span></code> and <code class="docutils literal notranslate"><span class="pre">page.body.stream_data[0]['value']</span></code>. This has the advantage that it will return the same Python objects as when the StreamField is used in template code (such as Page instances for <code class="docutils literal notranslate"><span class="pre">PageChooserBlock</span></code>). However, in most cases, existing code using <code class="docutils literal notranslate"><span class="pre">stream_data</span></code> is written to expect the raw JSON-like representation of the data, and for this the new property <code class="docutils literal notranslate"><span class="pre">raw_data</span></code> (added in Wagtail 2.12) can be used as a drop-in replacement for <code class="docutils literal notranslate"><span class="pre">stream_data</span></code>.</p>
</div>
</div>
</div>
<span id="document-releases/2.11.8"></span><div class="section" id="wagtail-2-11-8-release-notes">
<h4>Wagtail 2.11.8 release notes<a class="headerlink" href="#wagtail-2-11-8-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="cve-2021-32681-improper-escaping-of-html-cross-site-scripting-in-wagtail-streamfield-blocks">
<h6>CVE-2021-32681: Improper escaping of HTML (‘Cross-site Scripting’) in Wagtail StreamField blocks<a class="headerlink" href="#cve-2021-32681-improper-escaping-of-html-cross-site-scripting-in-wagtail-streamfield-blocks" title="Permalink to this headline">¶</a></h6>
<p>This release addresses a cross-site scripting (XSS) vulnerability in StreamField. When the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> template tag is used to output the value of a plain-text StreamField block (<code class="docutils literal notranslate"><span class="pre">CharBlock</span></code>, <code class="docutils literal notranslate"><span class="pre">TextBlock</span></code> or a similar user-defined block derived from <code class="docutils literal notranslate"><span class="pre">FieldBlock</span></code>), and that block does not specify a template for rendering, the tag output is not properly escaped as HTML. This could allow users to insert arbitrary HTML or scripting. This vulnerability is only exploitable by users with the ability to author StreamField content (i.e. users with ‘editor’ access to the Wagtail admin).</p>
<p>Site implementors who wish to retain the existing behaviour of allowing editors to insert HTML content in these blocks (and are willing to accept the risk of untrusted editors inserting arbitrary code) may disable the escaping by surrounding the relevant <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> tag in <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">autoescape</span> <span class="pre">off</span> <span class="pre">%}...{%</span> <span class="pre">endautoescape</span> <span class="pre">%}</span></code>.</p>
<p>Many thanks to Karen Tracey for reporting this issue. For further details, please see <a class="reference external" href="https://github.com/wagtail/wagtail/security/advisories/GHSA-xfrw-hxr5-ghqf">the CVE-2021-32681 security advisory</a>.</p>
</div>
</div>
</div>
<span id="document-releases/2.11.7"></span><div class="section" id="wagtail-2-11-7-release-notes">
<h4>Wagtail 2.11.7 release notes<a class="headerlink" href="#wagtail-2-11-7-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="cve-2021-29434-improper-validation-of-urls-cross-site-scripting-in-rich-text-fields">
<h6>CVE-2021-29434: Improper validation of URLs (‘Cross-site Scripting’) in rich text fields<a class="headerlink" href="#cve-2021-29434-improper-validation-of-urls-cross-site-scripting-in-rich-text-fields" title="Permalink to this headline">¶</a></h6>
<p>This release addresses a cross-site scripting (XSS) vulnerability in rich text fields. When saving the contents of a rich text field in the admin interface, Wagtail did not apply server-side checks to ensure that link URLs use a valid protocol. A malicious user with access to the admin interface could thus craft a POST request to publish content with javascript: URLs containing arbitrary code. The vulnerability is not exploitable by an ordinary site visitor without access to the Wagtail admin.</p>
<p>Many thanks to Kevin Breen for reporting this issue.</p>
</div>
</div>
</div>
<span id="document-releases/2.11.6"></span><div class="section" id="wagtail-2-11-6-release-notes">
<h4>Wagtail 2.11.6 release notes<a class="headerlink" href="#wagtail-2-11-6-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Un-pin django-treebeard following upstream fix for migration issue (Matt Westcott)</li>
<li>Prevent crash when copying an alias page (Karl Hobley)</li>
<li>Prevent errors on page editing after changing LANGUAGE_CODE (Matt Westcott)</li>
<li>Correctly handle model inheritance and <code class="docutils literal notranslate"><span class="pre">ClusterableModel</span></code> on <code class="docutils literal notranslate"><span class="pre">copy_for_translation</span></code> (Karl Hobley)</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<span id="document-releases/2.11.5"></span><div class="section" id="wagtail-2-11-5-release-notes">
<h4>Wagtail 2.11.5 release notes<a class="headerlink" href="#wagtail-2-11-5-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><ul class="simple">
<li>Pin django-treebeard to &lt;4.5 to prevent migration conflicts (Matt Westcott)</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<span id="document-releases/2.11.4"></span><div class="section" id="wagtail-2-11-4-release-notes">
<h4>Wagtail 2.11.4 release notes<a class="headerlink" href="#wagtail-2-11-4-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Prevent delete button showing on collection / workflow edit views when delete permission is absent (Helder Correia)</li>
<li>Ensure aliases are published when the source page is published (Karl Hobley)</li>
<li>Make page privacy rules apply to aliases (Karl Hobley)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.11.3"></span><div class="section" id="wagtail-2-11-3-release-notes">
<h4>Wagtail 2.11.3 release notes<a class="headerlink" href="#wagtail-2-11-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Updated project template migrations to ensure that initial homepage creation runs before addition of locale field (Dan Braghis)</li>
<li>Restore ability to use translatable strings in <code class="docutils literal notranslate"><span class="pre">LANGUAGES</span></code> / <code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code> settings (Andreas Morgenstern)</li>
<li>Allow <code class="docutils literal notranslate"><span class="pre">locale</span></code> / <code class="docutils literal notranslate"><span class="pre">translation_of</span></code> API filters to be used in combination with search (Matt Westcott)</li>
<li>Prevent error on <code class="docutils literal notranslate"><span class="pre">create_log_entries_from_revisions</span></code> when checking publish state on a revision that cannot be restored (Kristin Riebe)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="run-before-declaration-needed-in-initial-homepage-migration">
<h6><code class="docutils literal notranslate"><span class="pre">run_before</span></code> declaration needed in initial homepage migration<a class="headerlink" href="#run-before-declaration-needed-in-initial-homepage-migration" title="Permalink to this headline">¶</a></h6>
<p>The migration that creates the initial site homepage needs to be updated to ensure that will continue working under Wagtail 2.11. If you have kept the <code class="docutils literal notranslate"><span class="pre">home</span></code> app from the original project layout generated by the <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">start</span></code> command, this will be <code class="docutils literal notranslate"><span class="pre">home/migrations/0002_create_homepage.py</span></code>. Inside the <code class="docutils literal notranslate"><span class="pre">Migration</span></code> class, add the line <code class="docutils literal notranslate"><span class="pre">run_before</span> <span class="pre">=</span> <span class="pre">[('wagtailcore',</span> <span class="pre">'0053_locale_model')]</span></code> - for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>

<span class="k">class</span> <span class="nc">Migration</span><span class="p">(</span><span class="n">migrations</span><span class="o">.</span><span class="n">Migration</span><span class="p">):</span>

    <span class="n">run_before</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;wagtailcore&#39;</span><span class="p">,</span> <span class="s1">&#39;0053_locale_model&#39;</span><span class="p">),</span>  <span class="c1"># added for Wagtail 2.11 compatibility</span>
    <span class="p">]</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;0001_initial&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">migrations</span><span class="o">.</span><span class="n">RunPython</span><span class="p">(</span><span class="n">create_homepage</span><span class="p">,</span> <span class="n">remove_homepage</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>This fix applies to any migration that creates page instances programmatically. If you installed Wagtail into an existing Django project by following the instructions at <a class="reference internal" href="index.html#document-getting_started/integrating_into_django"><span class="doc">Integrating Wagtail into a Django project</span></a>, you most likely created the initial homepage manually, and no change is required in this case.</p>
<p><strong>Further background:</strong> Wagtail 2.11 adds a <code class="docutils literal notranslate"><span class="pre">locale</span></code> field to the Page model, and since the existing migrations in your project pre-date this, they are designed to run against a version of the Page model that has no <code class="docutils literal notranslate"><span class="pre">locale</span></code> field. As a result, they need to run before the new migrations that have been added to <code class="docutils literal notranslate"><span class="pre">wagtailcore</span></code> within Wagtail 2.11. However, in the old version of the homepage migration, there is nothing to ensure that this sequence is followed. The actual order chosen is an internal implementation detail of Django, and in particular is liable to change as you continue developing your project under Wagtail 2.11 and create new migrations that depend on the current state of <code class="docutils literal notranslate"><span class="pre">wagtailcore</span></code>. In this situation, a user installing your project on a clean database may encounter the following error when running <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">migrate</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">django</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span> <span class="n">NOT</span> <span class="n">NULL</span> <span class="n">constraint</span> <span class="n">failed</span><span class="p">:</span> <span class="n">wagtailcore_page</span><span class="o">.</span><span class="n">locale_id</span>
</pre></div>
</div>
<p>Adding the <code class="docutils literal notranslate"><span class="pre">run_before</span></code> directive will ensure that the migrations run in the intended order, avoiding this error.</p>
</div>
</div>
</div>
<span id="document-releases/2.11.2"></span><div class="section" id="wagtail-2-11-2-release-notes">
<h4>Wagtail 2.11.2 release notes<a class="headerlink" href="#wagtail-2-11-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="facebook-and-instagram-embed-finders">
<h6>Facebook and Instagram embed finders<a class="headerlink" href="#facebook-and-instagram-embed-finders" title="Permalink to this headline">¶</a></h6>
<p>Two new embed finders have been added for Facebook and Instagram, to replace the previous configuration
using Facebook’s public oEmbed endpoint which was retired in October 2020. These require a Facebook
developer API key - for details of configuring this, see <a class="reference internal" href="index.html#facebook-and-instagram-embeds"><span class="std std-ref">Facebook and Instagram</span></a>.
This feature was developed by Cynthia Kiser and Luis Nell.</p>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Improve performance of permission check on translations for edit page (Karl Hobley)</li>
<li>Gracefully handle missing Locale records on <code class="docutils literal notranslate"><span class="pre">Locale.get_active</span></code> and <code class="docutils literal notranslate"><span class="pre">.localized</span></code> (Matt Westcott)</li>
<li>Handle <code class="docutils literal notranslate"><span class="pre">get_supported_language_variant</span></code> returning a language variant not in <code class="docutils literal notranslate"><span class="pre">LANGUAGES</span></code> (Matt Westcott)</li>
<li>Reinstate missing icon on settings edit view (Jérôme Lebleu)</li>
<li>Avoid performance and pagination logic issues with a large number of languages (Karl Hobley)</li>
<li>Allow deleting the default locale (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.11.1"></span><div class="section" id="wagtail-2-11-1-release-notes">
<h4>Wagtail 2.11.1 release notes<a class="headerlink" href="#wagtail-2-11-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Ensure that cached <code class="docutils literal notranslate"><span class="pre">wagtail_site_root_paths</span></code> structures from older Wagtail versions are invalidated (Sævar Öfjörð Magnússon)</li>
<li>Avoid circular import between wagtail.admin.auth and custom user models (Matt Westcott)</li>
<li>Prevent error on resolving page URLs when a locale outside of <code class="docutils literal notranslate"><span class="pre">WAGTAIL_CONTENT_LANGUAGES</span></code> is active (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.11"></span><div class="section" id="wagtail-2-11-release-notes">
<h4>Wagtail 2.11 release notes<a class="headerlink" href="#wagtail-2-11-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<p>Wagtail 2.11 is designated a Long Term Support (LTS) release. Long Term Support releases will continue to receive maintenance updates as necessary to address security and data-loss related issues, up until the next LTS release (typically a period of 12 months).</p>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="multi-lingual-content">
<h6>Multi-lingual content<a class="headerlink" href="#multi-lingual-content" title="Permalink to this headline">¶</a></h6>
<p>With this release, Wagtail now has official support for authoring content
for multiple languages/regions.</p>
<p>To find out more about this feature, see <a class="reference internal" href="index.html#multi-language-content"><span class="std std-ref">Multi-language content</span></a>.</p>
<p>We have also developed a new plugin for translating content between different
locales called <code class="docutils literal notranslate"><span class="pre">wagtail-localize</span></code>. You can find details about <code class="docutils literal notranslate"><span class="pre">wagtail-localize</span></code>
on its <a class="reference external" href="https://github.com/wagtail/wagtail-localize">GitHub page</a>.</p>
<p>This feature was sponsored by The Mozilla Foundation and Torchbox.</p>
</div>
<div class="section" id="page-aliases">
<h6>Page aliases<a class="headerlink" href="#page-aliases" title="Permalink to this headline">¶</a></h6>
<p>This release introduces support for creating page aliases.</p>
<p>Page aliases are exact copies of another page that sit in another part of the tree.
They remain in sync with the original page until this link is removed by converting them into a regular page, or deleting the original page.</p>
<p>A page alias can be created through the “Copy Page” UI by selecting the “Alias” checkbox when creating a page copy.</p>
<p>This feature was sponsored by The Mozilla Foundation.</p>
</div>
<div class="section" id="collections-hierarchy">
<h6>Collections hierarchy<a class="headerlink" href="#collections-hierarchy" title="Permalink to this headline">¶</a></h6>
<p>Collections (for organising images, documents or other media) can now be managed as a hierarchy rather than a flat list. This feature was developed by Robert Rollins.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Add <code class="docutils literal notranslate"><span class="pre">before_edit_snippet</span></code>, <code class="docutils literal notranslate"><span class="pre">before_create_snippet</span></code> and <code class="docutils literal notranslate"><span class="pre">before_delete_snippet</span></code> hooks and documentation (Karl Hobley. Sponsored by the Mozilla Foundation)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">register_snippet_listing_buttons</span></code> and <code class="docutils literal notranslate"><span class="pre">construct_snippet_listing_buttons</span></code> hooks and documentation (Karl Hobley. Sponsored by the Mozilla Foundation)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">--version</span></code> to available Wagtail CLI commands (Kalob Taulien)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">hooks.register_temporarily</span></code> utility function for testing hooks (Karl Hobley. Sponsored by the Mozilla Foundation)</li>
<li>Remove <code class="docutils literal notranslate"><span class="pre">unidecode</span></code> and use <code class="docutils literal notranslate"><span class="pre">anyascii</span></code> in for Unicode to ASCII conversion (Robbie Mackay)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">render</span></code> helper to <code class="docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code> to support serving template responses according to Wagtail conventions (Andy Babic)</li>
<li>Specify minimum Python version in setup.py (Vince Salvino)</li>
<li>Extend treebeard’s <code class="docutils literal notranslate"><span class="pre">fix_tree</span></code> method with the ability to non-destructively fix path issues and add a –full option to apply path fixes (Matt Westcott)</li>
<li>Add support for hierarchical/nested Collections (Robert Rollins)</li>
<li>Show user’s full name in report views (Matt Westcott)</li>
<li>Improve Wagtail admin page load performance by caching SVG icons sprite in localStorage (Coen van der Kamp)</li>
<li>Support SVG icons in ModelAdmin menu items (Scott Cranfill)</li>
<li>Support SVG icons in admin breadcrumbs (Coen van der Kamp)</li>
<li>Serve PDFs inline in the browser (Matt Westcott)</li>
<li>Make document <code class="docutils literal notranslate"><span class="pre">content-type</span></code> and <code class="docutils literal notranslate"><span class="pre">content-disposition</span></code> configurable via <code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_CONTENT_TYPES</span></code> and <code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_INLINE_CONTENT_TYPES</span></code> (Matt Westcott)</li>
<li>Slug generation no longer removes stopwords (Andy Chosak, Scott Cranfill)</li>
<li>Add check to disallow StreamField block names that do not match Python variable syntax (François Poulain)</li>
<li>The <code class="docutils literal notranslate"><span class="pre">BASE_URL</span></code> setting is now converted to a string, if it isn’t already, when constructing API URLs (thenewguy)</li>
<li>Preview from ‘pages awaiting moderation’ now opens in a new window (Cynthia Kiser)</li>
<li>Add document extension validation if <code class="docutils literal notranslate"><span class="pre">WAGTAIL_DOCS_EXTENSIONS</span></code> is set to a list of allowed extensions (Meghana Bhange)</li>
<li>Use <code class="docutils literal notranslate"><span class="pre">django-admin</span></code> command in place of <code class="docutils literal notranslate"><span class="pre">django-admin.py</span></code> (minusf)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">register_snippet_action_menu_item</span></code> and <code class="docutils literal notranslate"><span class="pre">construct_snippet_action_menu</span></code> hooks to modify the actions available when creating / editing a snippet (Karl Hobley)</li>
<li>Moved <code class="docutils literal notranslate"><span class="pre">generate_signature</span></code> and <code class="docutils literal notranslate"><span class="pre">verify_signature</span></code> functions into <code class="docutils literal notranslate"><span class="pre">wagtail.images.utils</span></code> (Noah H)</li>
<li>Implement <code class="docutils literal notranslate"><span class="pre">bulk_to_python</span></code> on all structural StreamField block types (Matt Westcott)</li>
<li>Add natural key support to <code class="docutils literal notranslate"><span class="pre">GroupCollectionPermission</span></code> (Jim Jazwiecki)</li>
<li>Implement <code class="docutils literal notranslate"><span class="pre">prepopulated_fields</span></code> for <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.modeladmin</span></code> (David Bramwell)</li>
<li>Change <code class="docutils literal notranslate"><span class="pre">classname</span></code> keyword argument on basic StreamField blocks to <code class="docutils literal notranslate"><span class="pre">form_classname</span></code> (Meghana Bhange)</li>
<li>Replace page explorer pushPage/popPage with gotoPage for more flexible explorer navigation (Karl Hobley)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Make page-level actions accessible to keyboard users in page listing tables (Jesse Menn)</li>
<li><code class="docutils literal notranslate"><span class="pre">WAGTAILFRONTENDCACHE_LANGUAGES</span></code> was being interpreted incorrectly. It now accepts a list of strings, as documented (Karl Hobley)</li>
<li>Update oEmbed endpoints to use https where available (Matt Westcott)</li>
<li>Revise <code class="docutils literal notranslate"><span class="pre">edit_handler</span></code> bind order in ModelAdmin views and fix duplicate form instance creation (Jérôme Lebleu)</li>
<li>Properly distinguish child blocks when comparing revisions with nested StreamBlocks (Martin Mena)</li>
<li>Correctly handle Turkish ‘İ’ characters in client-side slug generation (Matt Westcott)</li>
<li>Page chooser widgets now reflect custom <code class="docutils literal notranslate"><span class="pre">get_admin_display_title</span></code> methods (Saptak Sengupta)</li>
<li><code class="docutils literal notranslate"><span class="pre">Page.copy()</span></code> now raises an error if the page being copied is unsaved (Anton Zhyltsou)</li>
<li><code class="docutils literal notranslate"><span class="pre">Page.copy()</span></code> now triggers a <code class="docutils literal notranslate"><span class="pre">page_published</span></code> if the copied page is live (Anton Zhyltsou)</li>
<li>The Elasticsearch <code class="docutils literal notranslate"><span class="pre">URLS</span></code> setting can now take a string on its own instead of a list (Sævar Öfjörð Magnússon)</li>
<li>Avoid retranslating month / weekday names that Django already provides (Matt Westcott)</li>
<li>Fixed padding around checkbox and radio inputs (Cole Maclean)</li>
<li>Fix spacing around the privacy indicator panel (Sævar Öfjörð Magnússon, Dan Braghis)</li>
<li>Consistently redirect to admin home on permission denied (Matt Westcott, Anton Zhyltsou)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="run-before-declaration-needed-in-initial-homepage-migration">
<h6><code class="docutils literal notranslate"><span class="pre">run_before</span></code> declaration needed in initial homepage migration<a class="headerlink" href="#run-before-declaration-needed-in-initial-homepage-migration" title="Permalink to this headline">¶</a></h6>
<p>The migration that creates the initial site homepage needs to be updated to ensure that will continue working under Wagtail 2.11. If you have kept the <code class="docutils literal notranslate"><span class="pre">home</span></code> app from the original project layout generated by the <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">start</span></code> command, this will be <code class="docutils literal notranslate"><span class="pre">home/migrations/0002_create_homepage.py</span></code>. Inside the <code class="docutils literal notranslate"><span class="pre">Migration</span></code> class, add the line <code class="docutils literal notranslate"><span class="pre">run_before</span> <span class="pre">=</span> <span class="pre">[('wagtailcore',</span> <span class="pre">'0053_locale_model')]</span></code> - for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>

<span class="k">class</span> <span class="nc">Migration</span><span class="p">(</span><span class="n">migrations</span><span class="o">.</span><span class="n">Migration</span><span class="p">):</span>

    <span class="n">run_before</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;wagtailcore&#39;</span><span class="p">,</span> <span class="s1">&#39;0053_locale_model&#39;</span><span class="p">),</span>  <span class="c1"># added for Wagtail 2.11 compatibility</span>
    <span class="p">]</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;0001_initial&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">migrations</span><span class="o">.</span><span class="n">RunPython</span><span class="p">(</span><span class="n">create_homepage</span><span class="p">,</span> <span class="n">remove_homepage</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>This fix applies to any migration that creates page instances programmatically. If you installed Wagtail into an existing Django project by following the instructions at <a class="reference internal" href="index.html#document-getting_started/integrating_into_django"><span class="doc">Integrating Wagtail into a Django project</span></a>, you most likely created the initial homepage manually, and no change is required in this case.</p>
<p><strong>Further background:</strong> Wagtail 2.11 adds a <code class="docutils literal notranslate"><span class="pre">locale</span></code> field to the Page model, and since the existing migrations in your project pre-date this, they are designed to run against a version of the Page model that has no <code class="docutils literal notranslate"><span class="pre">locale</span></code> field. As a result, they need to run before the new migrations that have been added to <code class="docutils literal notranslate"><span class="pre">wagtailcore</span></code> within Wagtail 2.11. However, in the old version of the homepage migration, there is nothing to ensure that this sequence is followed. The actual order chosen is an internal implementation detail of Django, and in particular is liable to change as you continue developing your project under Wagtail 2.11 and create new migrations that depend on the current state of <code class="docutils literal notranslate"><span class="pre">wagtailcore</span></code>. In this situation, a user installing your project on a clean database may encounter the following error when running <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">migrate</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">django</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span> <span class="n">NOT</span> <span class="n">NULL</span> <span class="n">constraint</span> <span class="n">failed</span><span class="p">:</span> <span class="n">wagtailcore_page</span><span class="o">.</span><span class="n">locale_id</span>
</pre></div>
</div>
<p>Adding the <code class="docutils literal notranslate"><span class="pre">run_before</span></code> directive will ensure that the migrations run in the intended order, avoiding this error.</p>
</div>
<div class="section" id="ie11-support-being-phased-out">
<h6>IE11 support being phased out<a class="headerlink" href="#ie11-support-being-phased-out" title="Permalink to this headline">¶</a></h6>
<p>This release begins the process of phasing out support for Internet Explorer. Please see <a class="reference internal" href="index.html#ie11"><span class="std std-ref">IE11</span></a> for details of the timeline over which support will be dropped.</p>
</div>
<div class="section" id="sitemiddleware-moved-to-wagtail-contrib-legacy">
<h6>SiteMiddleware moved to <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.legacy</span></code><a class="headerlink" href="#sitemiddleware-moved-to-wagtail-contrib-legacy" title="Permalink to this headline">¶</a></h6>
<p>The SiteMiddleware class (which provides the <code class="docutils literal notranslate"><span class="pre">request.site</span></code> property, and has been deprecated since Wagtail 2.9) has been moved to the <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.legacy</span></code> namespace. On projects where this is still in use, the <code class="docutils literal notranslate"><span class="pre">'wagtail.core.middleware.SiteMiddleware'</span></code> entry in <code class="docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code> should be changed to <code class="docutils literal notranslate"><span class="pre">'wagtail.contrib.legacy.sitemiddleware.SiteMiddleware'</span></code>.</p>
</div>
<div class="section" id="collection-model-enforces-alphabetical-ordering">
<h6>Collection model enforces alphabetical ordering<a class="headerlink" href="#collection-model-enforces-alphabetical-ordering" title="Permalink to this headline">¶</a></h6>
<p>As part of the hierarchical collections support, the <code class="docutils literal notranslate"><span class="pre">path</span></code> field on the Collection model now enforces alphabetical ordering. Previously, collections were stored in the order in which they were created - and then sorted by name where displayed in the CMS. This change will be handled automatically through migrations when upgrading to Wagtail 2.11.</p>
<p>However, if your project creates new collections programmatically after migrations have run, and assigns the <code class="docutils literal notranslate"><span class="pre">path</span></code> field directly - for example, by loading from a fixture file - this code will need to be updated to insert them in alphabetical order. Otherwise, errors may occur when subsequently adding new collections through the Wagtail admin. This can be done as follows:</p>
<ul>
<li><p class="first">Update paths to match alphabetical order. For example, if you have a fixture that creates the collections <code class="docutils literal notranslate"><span class="pre">Zebras</span></code> and <code class="docutils literal notranslate"><span class="pre">Aardvarks</span></code> with paths <code class="docutils literal notranslate"><span class="pre">00010001</span></code> and <code class="docutils literal notranslate"><span class="pre">00010002</span></code> respectively, these paths should be swapped.</p>
</li>
<li><p class="first"><em>Alternatively</em>, after creating the collections, run the Python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Collection</span>
<span class="n">Collection</span><span class="o">.</span><span class="n">fix_tree</span><span class="p">(</span><span class="n">fix_paths</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>or the management command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python manage.py fixtree --full</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="site-get-site-root-paths-now-returns-language-code">
<h6><code class="docutils literal notranslate"><span class="pre">Site.get_site_root_paths</span></code> now returns language code<a class="headerlink" href="#site-get-site-root-paths-now-returns-language-code" title="Permalink to this headline">¶</a></h6>
<p>In previous releases, <code class="docutils literal notranslate"><span class="pre">Site.get_site_root_paths</span></code> returned a list of <code class="docutils literal notranslate"><span class="pre">(site_id,</span> <span class="pre">root_path,</span> <span class="pre">root_url)</span></code> tuples. To support the new internationalisation model, this has now been changed to a list of named tuples with the fields: <code class="docutils literal notranslate"><span class="pre">site_id</span></code>, <code class="docutils literal notranslate"><span class="pre">root_path</span></code>, <code class="docutils literal notranslate"><span class="pre">root_url</span></code> and <code class="docutils literal notranslate"><span class="pre">language_code</span></code>. Existing code that handled this as a 3-tuple should be updated accordingly.</p>
</div>
<div class="section" id="classname-argument-on-streamfield-blocks-is-now-form-classname">
<h6><code class="docutils literal notranslate"><span class="pre">classname</span></code> argument on StreamField blocks is now <code class="docutils literal notranslate"><span class="pre">form_classname</span></code><a class="headerlink" href="#classname-argument-on-streamfield-blocks-is-now-form-classname" title="Permalink to this headline">¶</a></h6>
<p>Basic StreamField block types such as CharBlock previously accepted a <code class="docutils literal notranslate"><span class="pre">classname</span></code> keyword argument, to specify a <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute to appear on the page editing form. For consistency with StructBlock, this has now been changed to <code class="docutils literal notranslate"><span class="pre">form_classname</span></code>. The <code class="docutils literal notranslate"><span class="pre">classname</span></code> argument is still recognised, but deprecated.</p>
</div>
</div>
</div>
<span id="document-releases/2.10.2"></span><div class="section" id="wagtail-2-10-2-release-notes">
<h4>Wagtail 2.10.2 release notes<a class="headerlink" href="#wagtail-2-10-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Avoid use of <code class="docutils literal notranslate"><span class="pre">icon</span></code> class name on userbar icon to prevent clashes with front-end styles (Karran Besen)</li>
<li>Prevent focused button labels from displaying as white on white (Karran Bessen)</li>
<li>Avoid showing preview button on moderation dashboard for page types with preview disabled (Dino Perovic)</li>
<li>Prevent oversized buttons in moderation dashboard panel (Dan Braghis)</li>
<li><code class="docutils literal notranslate"><span class="pre">create_log_entries_from_revisions</span></code> now handles revisions that cannot be restored due to foreign key constraints (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.10.1"></span><div class="section" id="wagtail-2-10-1-release-notes">
<h4>Wagtail 2.10.1 release notes<a class="headerlink" href="#wagtail-2-10-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Prevent <code class="docutils literal notranslate"><span class="pre">create_log_entries_from_revisions</span></code> command from failing when page model classes are missing (Dan Braghis)</li>
<li>Prevent page audit log views from failing for user models without a <code class="docutils literal notranslate"><span class="pre">username</span></code> field (Vyacheslav Matyukhin)</li>
<li>Fix icon alignment on menu items (Coen van der Kamp)</li>
<li>Page editor header bar now correctly shows ‘Published’ or ‘Draft’ status when no revisions exist (Matt Westcott)</li>
<li>Prevent page editor from failing when <code class="docutils literal notranslate"><span class="pre">USE_TZ</span></code> is false (Matt Westcott)</li>
<li>Ensure whitespace between block-level elements is preserved when stripping tags from rich text for search indexing (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.10"></span><div class="section" id="wagtail-2-10-release-notes">
<h4>Wagtail 2.10 release notes<a class="headerlink" href="#wagtail-2-10-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id2">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id3">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id2">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="moderation-workflow">
<h6>Moderation workflow<a class="headerlink" href="#moderation-workflow" title="Permalink to this headline">¶</a></h6>
<p>This release introduces a configurable moderation workflow system to replace the single-step “submit for moderation” feature. Workflows can be set up on specific subsections of the page tree and consist of any number of tasks to be completed by designated user groups. To support this, numerous UI improvements have been made to Wagtail’s page editor, including a new log viewer to track page history.</p>
<p>For further details, see <a class="reference internal" href="index.html#managing-workflows"><span class="std std-ref">Managing Workflows</span></a> and <a class="reference internal" href="index.html#document-extending/custom_tasks"><span class="doc">Adding new Task types</span></a>.</p>
<p>This feature was developed by Jacob Topp-Mugglestone, Karl Hobley, Matt Westcott and Dan Braghis, and sponsored by <a class="reference external" href="https://www.fool.com/">The Motley Fool</a>.</p>
</div>
<div class="section" id="django-3-1-support">
<h6>Django 3.1 support<a class="headerlink" href="#django-3-1-support" title="Permalink to this headline">¶</a></h6>
<p>This release adds support for Django 3.1. Compatibility fixes were contributed by Matt Westcott and Karl Hobley.</p>
</div>
<div class="section" id="search-query-expressions">
<h6>Search query expressions<a class="headerlink" href="#search-query-expressions" title="Permalink to this headline">¶</a></h6>
<p>Search queries can now be constructed as structured expressions in the manner of the Django ORM’s <code class="docutils literal notranslate"><span class="pre">Q()</span></code> values, allowing for complex queries that combine individual terms, phrases and boosting. A helper function <code class="docutils literal notranslate"><span class="pre">parse_query_string</span></code> is provided to convert “natural” queries containing quoted phrases into these expressions. For complete documentation, see <a class="reference internal" href="index.html#wagtailsearch-complex-queries"><span class="std std-ref">Complex search queries</span></a>. This feature was developed by Karl Hobley and sponsored by <a class="reference external" href="https://www.fool.com/">The Motley Fool</a>.</p>
</div>
<div class="section" id="redirect-importing">
<h6>Redirect importing<a class="headerlink" href="#redirect-importing" title="Permalink to this headline">¶</a></h6>
<p>Redirects can now be imported from an uploaded CSV, TSV, XLS or XLSX file. This feature was developed by Martin Sandström.</p>
</div>
<div class="section" id="accessibility-and-usability">
<h6>Accessibility and usability<a class="headerlink" href="#accessibility-and-usability" title="Permalink to this headline">¶</a></h6>
<p>This release contains a number of improvements to the accessibility and general usability of the Wagtail admin, fixing long-standing issues. Some of the changes come from our January 2020 sprint in Bristol, and some from our brand new <a class="reference external" href="https://github.com/wagtail/wagtail/wiki/Accessibility-team">accessibility team</a>:</p>
<ul class="simple">
<li>Remove sticky footer on small devices, so that content is not blocked and more easily editable (Saeed Tahmasebi)</li>
<li>Add SVG icons to resolve accessibility and customisation issues and start using them in a subset of Wagtail’s admin (Coen van der Kamp, Scott Cranfill, Thibaud Colas, Dan Braghis)</li>
<li>Switch userbar and header H1s to use SVG icons (Coen van der Kamp)</li>
<li>Add skip link for keyboard users to bypass Wagtail navigation in the admin (Martin Coote)</li>
<li>Add missing dropdown icons to image upload, document upload, and site settings screens (Andreas Bernacca)</li>
<li>Prevent snippets’ bulk delete button from being present for screen reader users when it’s absent for sighted users (LB (Ben Johnston))</li>
</ul>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added <code class="docutils literal notranslate"><span class="pre">webpquality</span></code> and <code class="docutils literal notranslate"><span class="pre">format-webp-lossless</span></code> image filters and <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_WEBP_QUALITY</span></code> setting. See <a class="reference internal" href="index.html#output-image-format"><span class="std std-ref">Output image format</span></a> and <a class="reference internal" href="index.html#image-quality"><span class="std std-ref">Image quality</span></a> (Nikolay Lukyanov)</li>
<li>Reorganised Dockerfile in project template to follow best practices (Tomasz Knapik, Jannik Wempe)</li>
<li>Added filtering to locked pages report (Karl Hobley)</li>
<li>Adds ability to view a group’s users via standalone admin URL and a link to this on the group edit view (Karran Besen)</li>
<li>Redirect to previous url when deleting/copying/unpublish a page and modify this url via the relevant hooks (Ascani Carlo)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">next_url</span></code> keyword argument on <code class="docutils literal notranslate"><span class="pre">register_page_listing_buttons</span></code> and <code class="docutils literal notranslate"><span class="pre">register_page_listing_more_buttons</span></code> hooks (Ascani Carlo, Matt Westcott, LB (Ben Johnston))</li>
<li><code class="docutils literal notranslate"><span class="pre">AbstractEmailForm</span></code> will use <code class="docutils literal notranslate"><span class="pre">SHORT_DATETIME_FORMAT</span></code> and <code class="docutils literal notranslate"><span class="pre">SHORT_DATE_FORMAT</span></code> Django settings to format date/time values in email (Haydn Greatnews)</li>
<li><code class="docutils literal notranslate"><span class="pre">AbstractEmailForm</span></code> now has a separate method (<code class="docutils literal notranslate"><span class="pre">render_email</span></code>) to build up email content on submission emails. See <a class="reference internal" href="index.html#form-builder-render-email"><span class="std std-ref">Custom render_email method</span></a>. (Haydn Greatnews)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">pre_page_move</span></code> and <code class="docutils literal notranslate"><span class="pre">post_page_move</span></code> signals. (Andy Babic)</li>
<li>Add ability to sort search promotions on listing page (Chris Ranjana, LB (Ben Johnston))</li>
<li>Upgrade internal JS tooling; Node v10, Gulp v4 &amp; Jest v23 (Jim Jazwiecki, Kim LaRocca, Thibaud Colas)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">after_publish_page</span></code>, <code class="docutils literal notranslate"><span class="pre">before_publish_page</span></code>, <code class="docutils literal notranslate"><span class="pre">after_unpublish_page</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">before_unpublish_page</span></code> hooks (Jonatas Baldin, Coen van der Kamp)</li>
<li>Add convenience <code class="docutils literal notranslate"><span class="pre">page_url</span></code> shortcut to improve how page URLs can be accessed from site settings in Django templates (Andy Babic)</li>
<li>Show more granular error messages from Pillow when uploading images (Rick van Hattem)</li>
<li>Add ordering to <code class="docutils literal notranslate"><span class="pre">Site</span></code> object, so that index page and <code class="docutils literal notranslate"><span class="pre">Site</span></code> switcher will be sorted consistently (Coen van der Kamp, Tim Leguijt)</li>
<li>Add Reddit to oEmbed provider list (Luke Hardwick)</li>
<li>Add ability to replace the default Wagtail logo in the userbar, via <code class="docutils literal notranslate"><span class="pre">branding_logo</span></code> block (Meteor0id)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">alt</span></code> property to <code class="docutils literal notranslate"><span class="pre">ImageRenditionField</span></code> api representation (Liam Mullens)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">purge_revisions</span></code> management command to purge old page revisions (Jacob Topp-Mugglestone, Tom Dyson)</li>
<li>Render the Wagtail User Bar on non <code class="docutils literal notranslate"><span class="pre">Page</span></code> views (Caitlin White, Coen van der Kamp)</li>
<li>Add ability to define <code class="docutils literal notranslate"><span class="pre">form_classname</span></code> on <code class="docutils literal notranslate"><span class="pre">ListBlock</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> (LB (Ben Johnston))</li>
<li>Add documentation about how to use <code class="docutils literal notranslate"><span class="pre">Rustface</span></code> for image feature detection (Neal Todd)</li>
<li>Improve performance of public/not_public queries in <code class="docutils literal notranslate"><span class="pre">PageQuerySet</span></code> (Timothy Bautista)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">add_redirect</span></code> static method to <code class="docutils literal notranslate"><span class="pre">Redirect</span></code> class for programmatic redirect creation (Brylie Christopher Oxley, Lacey Williams Henschel)</li>
<li>Add reference documentation for <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.redirects</span></code> See <a class="reference internal" href="index.html#redirects"><span class="std std-ref">Redirects</span></a>. (LB (Ben Johnston))</li>
<li><code class="docutils literal notranslate"><span class="pre">bulk_delete</span></code> page permission is no longer required to move pages, even if those pages have children (Robert Rollins, LB (Ben Johnston))</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">after_edit_snippet</span></code>, <code class="docutils literal notranslate"><span class="pre">after_create_snippet</span></code> and <code class="docutils literal notranslate"><span class="pre">after_delete_snippet</span></code> hooks and documentation (Kalob Taulien)</li>
<li>Improve performance of empty search results by avoiding downloading the entire search index in these scenarios (Lars van de Kerkhof, Coen van der Kamp)</li>
<li>Replace <code class="docutils literal notranslate"><span class="pre">gulp-sass</span></code> with <code class="docutils literal notranslate"><span class="pre">gulp-dart-sass</span></code> to improve core development across different platforms (Thibaud Colas)</li>
<li>Remove markup around rich text rendering by default, provide a way to use old behaviour via <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.legacy.richtext</span></code>. See <a class="reference internal" href="index.html#document-reference/contrib/legacy_richtext"><span class="doc">Legacy richtext</span></a>. (Coen van der Kamp, Dan Braghis)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">WAGTAIL_TIME_FORMAT</span></code> setting (Jacob Topp-Mugglestone)</li>
<li>Apply title length normalisation to improve ranking on PostgreSQL search (Karl Hobley)</li>
<li>Allow omitting the default editor from <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_RICH_TEXT_EDITORS</span></code> (Gassan Gousseinov)</li>
<li>Disable password auto-completion on user creation form (Samir Shah)</li>
<li>Upgrade jQuery to version 3.5.1 to reduce penetration testing false positives (Matt Westcott)</li>
<li>Add ability to extend <code class="docutils literal notranslate"><span class="pre">EditHandler</span></code> without a children attribute (Seb Brown)</li>
<li><code class="docutils literal notranslate"><span class="pre">Page.objects.specific</span></code> now gracefully handles pages with missing specific records (Andy Babic)</li>
<li>StreamField ‘add’ buttons are now disabled when maximum count is reached (Max Gabrielsson)</li>
<li>Use underscores for form builder field names to allow use as template variables (Ashia Zawaduk, LB (Ben Johnston))</li>
<li>Deprecate use of unidecode within form builder field names (Michael van Tellingen, LB (Ben Johnston))</li>
<li>Improve error feedback when editing a page with a missing model class (Andy Babic)</li>
<li>Change Wagtail tabs implementation to only allow slug-formatted tab identifiers, reducing false positives from security audits (Matt Westcott)</li>
<li>Ensure errors during Postgres search indexing are left uncaught to assist troubleshooting (Karl Hobley)</li>
<li>Add ability to edit images and embeds in rich text editor (Maylon Pedroso, Samuel Mendes, Gabriel Peracio)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Ensure link to add a new user works when no users are visible in the users list (LB (Ben Johnston))</li>
<li><code class="docutils literal notranslate"><span class="pre">AbstractEmailForm</span></code> saved submission fields are now aligned with the email content fields, <code class="docutils literal notranslate"><span class="pre">form.cleaned_data</span></code> will be used instead of <code class="docutils literal notranslate"><span class="pre">form.fields</span></code> (Haydn Greatnews)</li>
<li>Removed ARIA <code class="docutils literal notranslate"><span class="pre">role=&quot;table&quot;</span></code> from TableBlock output (Thibaud Colas)</li>
<li>Set Cache-Control header to prevent page preview responses from being cached (Tomas Walch)</li>
<li>Accept unicode characters in slugs on the “copy page” form (François Poulain)</li>
<li>Support IPv6 domain (Alex Gleason, Coen van der Kamp)</li>
<li>Remove top padding when <code class="docutils literal notranslate"><span class="pre">FieldRowPanel</span></code> is used inside a <code class="docutils literal notranslate"><span class="pre">MultiFieldPanel</span></code> (Jérôme Lebleu)</li>
<li>Add Wagtail User Bar back to page previews and ensure moderation actions are available (Coen van der Kamp)</li>
<li>Fix issue where queryset annotations were lost (e.g. <code class="docutils literal notranslate"><span class="pre">.annotate_score()</span></code>) when using specific models in page query (Dan Bentley)</li>
<li>Prevent date/time picker from losing an hour on losing focus when 12-hour times are in use (Jacob Topp-Mugglestone)</li>
<li>Strip out HTML tags from <code class="docutils literal notranslate"><span class="pre">RichTextField</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">RichTextBlock</span></code> search index content (Timothy Bautista)</li>
<li>Avoid using null on string <code class="docutils literal notranslate"><span class="pre">Site.site_name</span></code> blank values to avoid different values for no name (Coen van der Kamp)</li>
<li>Fix deprecation warnings on Elasticsearch 7 (Yngve Høiseth)</li>
<li>Remove use of Node.forEach for IE 11 compatibility in admin menu items (Thibaud Colas)</li>
<li>Fix incorrect method name in SiteMiddleware deprecation warning (LB (Ben Johnston))</li>
<li><code class="docutils literal notranslate"><span class="pre">wagtail.contrib.sitemaps</span></code> no longer depends on SiteMiddleware (Matt Westcott)</li>
<li>Purge image renditions cache when renditions are deleted (Pascal Widdershoven, Matt Westcott)</li>
<li>Image / document forms now display non-field errors such as <code class="docutils literal notranslate"><span class="pre">unique_together</span></code> constraints (Matt Westcott)</li>
<li>Make “Site” chooser in site settings translatable (Andreas Bernacca)</li>
<li>Fix group permission checkboxes not being clickable in IE11 (LB (Ben Johnston))</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id3">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="removed-support-for-python-3-5">
<h6>Removed support for Python 3.5<a class="headerlink" href="#removed-support-for-python-3-5" title="Permalink to this headline">¶</a></h6>
<p>Python 3.5 is no longer supported as of this release; please upgrade to Python 3.6 or above before upgrading Wagtail.</p>
</div>
<div class="section" id="move-to-new-configurable-moderation-system-workflow">
<h6>Move to new configurable moderation system (workflow)<a class="headerlink" href="#move-to-new-configurable-moderation-system-workflow" title="Permalink to this headline">¶</a></h6>
<p>A new workflow system has been introduced for moderation. Task types are defined as models in code, and instances - tasks - are created in the Wagtail Admin,
then chained together to form workflows: sequences of moderation stages through which a page must pass prior to publication.</p>
<p>Key points:</p>
<ul class="simple">
<li>Prior to 2.10, moderation in Wagtail was performed on a per-revision basis: once submitted, the moderator would approve or reject
the submitted revision only, which would not include subsequent changes. Moderation is now performed per page, with moderators
always seeing the latest revision.</li>
<li><code class="docutils literal notranslate"><span class="pre">PageRevision.submitted_for_moderation</span></code> will return <code class="docutils literal notranslate"><span class="pre">True</span></code> for revisions passing through the old moderation system, but not for the new system</li>
<li>Pages undergoing moderation in the old system will not have their moderation halted, and can still be approved/rejected. As a result, you may see
two sets of moderation dashboard panels until there are no longer any pages in moderation in the old system</li>
<li>No pages can be submitted for moderation in the old system: “Submit for moderation” now submits to the new Workflow system</li>
<li>You no longer need the publish permission to perform moderation actions on a page - actions available to each user are now configured per task.
With the built in <code class="docutils literal notranslate"><span class="pre">GroupApprovalTask</span></code>, anybody in a specific set of groups can approve or reject the task.</li>
<li>A data migration is provided to recreate your existing publish-permission based moderation workflow in the new system. If you have made no permissions changes,
this should simply create a task approvable by anybody in the <cite>Moderators</cite> group, and assign a workflow with this task to the root page, creating a standard workflow
for the entire page tree. However, if you have a complex nested set of publish page permissions, the created set of workflows will be more complex as well - you may wish to
inspect the created workflows and tasks in the new <code class="docutils literal notranslate"><span class="pre">Settings/Workflows</span></code> admin area and potentially simplify them.
See <a class="reference internal" href="index.html#managing-workflows"><span class="std std-ref">Managing Workflows</span></a> for the administrator guide.</li>
</ul>
</div>
<div class="section" id="div-class-rich-text-wrappers-removed-from-rich-text">
<h6><code class="docutils literal notranslate"><span class="pre">&lt;div</span> <span class="pre">class=&quot;rich-text&quot;&gt;</span></code> wrappers removed from rich text<a class="headerlink" href="#div-class-rich-text-wrappers-removed-from-rich-text" title="Permalink to this headline">¶</a></h6>
<p>In previous releases, rich text values were enclosed in a <code class="docutils literal notranslate"><span class="pre">&lt;div</span> <span class="pre">class=&quot;rich-text&quot;&gt;</span></code> element when rendered; this element has now been removed.
To restore the old behaviour, see <a class="reference internal" href="index.html#document-reference/contrib/legacy_richtext"><span class="doc">Legacy richtext</span></a>.</p>
</div>
<div class="section" id="prepopulating-data-for-site-history-report">
<h6>Prepopulating data for site history report<a class="headerlink" href="#prepopulating-data-for-site-history-report" title="Permalink to this headline">¶</a></h6>
<p>This release introduces logging of user actions, viewable through the “Site history” report. To pre-populate these logs with data from page revision history, run the management command: <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">create_log_entries_from_revisions</span></code>.</p>
</div>
<div class="section" id="clean-name-field-added-to-form-builder-form-field-models">
<h6><code class="docutils literal notranslate"><span class="pre">clean_name</span></code> field added to form builder form field models<a class="headerlink" href="#clean-name-field-added-to-form-builder-form-field-models" title="Permalink to this headline">¶</a></h6>
<p>A <code class="docutils literal notranslate"><span class="pre">clean_name</span></code> field has been added to form field models that extend <code class="docutils literal notranslate"><span class="pre">AbstractForm</span></code>. This is used as the name attribute of the HTML form field, and the dictionary key that the submitted form data is stored under. Storing this on the model (rather than calculating it on-the-fly as was done previously) ensures that if the algorithm for generating the clean name changes in future, the existing data will not become inaccessible. A future version of Wagtail will drop the <code class="docutils literal notranslate"><span class="pre">unidecode</span></code> library currently used for this.</p>
<p>For forms created through the Wagtail admin interface, no action is required, as the new field will be populated on server startup. However, any process that creates form pages through direct insertion on the database (such as loading from fixtures) should now be updated to populate <code class="docutils literal notranslate"><span class="pre">clean_name</span></code>.</p>
</div>
<div class="section" id="new-next-url-keyword-argument-on-register-page-listing-buttons-and-register-page-listing-more-buttons-hooks">
<h6>New <code class="docutils literal notranslate"><span class="pre">next_url</span></code> keyword argument on <code class="docutils literal notranslate"><span class="pre">register_page_listing_buttons</span></code> and <code class="docutils literal notranslate"><span class="pre">register_page_listing_more_buttons</span></code> hooks<a class="headerlink" href="#new-next-url-keyword-argument-on-register-page-listing-buttons-and-register-page-listing-more-buttons-hooks" title="Permalink to this headline">¶</a></h6>
<p>Functions registered through the hooks <code class="docutils literal notranslate"><span class="pre">register_page_listing_buttons</span></code> and <code class="docutils literal notranslate"><span class="pre">register_page_listing_more_buttons</span></code> now accept an additional keyword argument <code class="docutils literal notranslate"><span class="pre">next_url</span></code>. A hook function currently written as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_page_listing_buttons&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_listing_more_buttons</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">page_perms</span><span class="p">,</span> <span class="n">is_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">wagtailadmin_widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
        <span class="s1">&#39;My button&#39;</span><span class="p">,</span> <span class="s1">&#39;/goes/to/a/url/&#39;</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">60</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>should now become:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_page_listing_buttons&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_listing_more_buttons</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">page_perms</span><span class="p">,</span> <span class="n">is_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">next_url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">wagtailadmin_widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
        <span class="s1">&#39;My button&#39;</span><span class="p">,</span> <span class="s1">&#39;/goes/to/a/url/&#39;</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">60</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">next_url</span></code> argument specifies a URL to redirect back to after the action is complete, and can be passed as a query parameter to the linked URL, if the view supports it.</p>
</div>
</div>
</div>
<span id="document-releases/2.9.3"></span><div class="section" id="wagtail-2-9-3-release-notes">
<h4>Wagtail 2.9.3 release notes<a class="headerlink" href="#wagtail-2-9-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="section" id="cve-2020-15118-html-injection-through-form-field-help-text">
<h5>CVE-2020-15118: HTML injection through form field help text<a class="headerlink" href="#cve-2020-15118-html-injection-through-form-field-help-text" title="Permalink to this headline">¶</a></h5>
<p>This release addresses an HTML injection vulnerability through help text in the <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.forms</span></code> form builder app. When a form page type is made available to Wagtail editors, and the page template is built using Django’s standard form rendering helpers such as <code class="docutils literal notranslate"><span class="pre">form.as_p</span></code> <a class="reference internal" href="index.html#form-builder-usage"><span class="std std-ref">(as directed in the documentation)</span></a>, any HTML tags used within a form field’s help text will be rendered unescaped in the page. Allowing HTML within help text is <a class="reference external" href="https://docs.djangoproject.com/en/3.0/ref/models/fields/#django.db.models.Field.help_text">an intentional design decision by Django</a>; however, as a matter of policy Wagtail does not allow editors to insert arbitrary HTML by default, as this could potentially be used to carry out cross-site scripting attacks, including privilege escalation. This functionality should therefore not have been made available to editor-level users.</p>
<p>The vulnerability is not exploitable by an ordinary site visitor without access to the Wagtail admin.</p>
<p>Site owners who wish to re-enable the use of HTML within help text (and are willing to accept the risk of this being exploited by editors) may set <code class="docutils literal notranslate"><span class="pre">WAGTAILFORMS_HELP_TEXT_ALLOW_HTML</span> <span class="pre">=</span> <span class="pre">True</span></code> in their configuration settings.</p>
<p>Many thanks to Timothy Bautista for reporting this issue.</p>
</div>
</div>
<span id="document-releases/2.9.2"></span><div class="section" id="wagtail-2-9-2-release-notes">
<h4>Wagtail 2.9.2 release notes<a class="headerlink" href="#wagtail-2-9-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Prevent startup failure when <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.sitemaps</span></code> is in <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.9.1"></span><div class="section" id="wagtail-2-9-1-release-notes">
<h4>Wagtail 2.9.1 release notes<a class="headerlink" href="#wagtail-2-9-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Fix incorrect method name in SiteMiddleware deprecation warning (LB (Ben Johnston))</li>
<li><code class="docutils literal notranslate"><span class="pre">wagtail.contrib.sitemaps</span></code> no longer depends on SiteMiddleware (Matt Westcott)</li>
<li>Purge image renditions cache when renditions are deleted (Pascal Widdershoven, Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.9"></span><div class="section" id="wagtail-2-9-release-notes">
<h4>Wagtail 2.9 release notes<a class="headerlink" href="#wagtail-2-9-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="report-data-exports">
<h6>Report data exports<a class="headerlink" href="#report-data-exports" title="Permalink to this headline">¶</a></h6>
<p>Data from reports, form submissions and ModelAdmin can now be exported to both XLSX and CSV format. For ModelAdmin, this is enabled by specifying a <code class="docutils literal notranslate"><span class="pre">list_export</span></code> attribute on the ModelAdmin class. This feature was developed by Jacob Topp-Mugglestone and sponsored by <a class="reference external" href="https://www.fool.com/">The Motley Fool</a>.</p>
</div>
<div class="section" id="cve-2020-11037-potential-timing-attack-on-password-protected-private-pages">
<h6>CVE-2020-11037: Potential timing attack on password-protected private pages<a class="headerlink" href="#cve-2020-11037-potential-timing-attack-on-password-protected-private-pages" title="Permalink to this headline">¶</a></h6>
<p>This release addresses a potential timing attack on pages or documents that have been protected with a shared password through Wagtail’s “Privacy” controls. This password check is performed through a character-by-character string comparison, and so an attacker who is able to measure the time taken by this check to a high degree of accuracy could potentially use timing differences to gain knowledge of the password. (This is <a class="reference external" href="https://groups.google.com/d/msg/django-developers/iAaq0pvHXuA/fpUuwjK3i2wJ">understood to be feasible on a local network, but not on the public internet</a>.)</p>
<p>Many thanks to Thibaud Colas for reporting this issue.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added support for creating custom reports (Jacob Topp-Mugglestone)</li>
<li>Skip page validation when unpublishing a page (Samir Shah)</li>
<li>Added <a class="reference internal" href="index.html#streamfield-multiplechoiceblock"><span class="std std-ref">MultipleChoiceBlock</span></a> block type for StreamField (James O’Toole)</li>
<li>ChoiceBlock now accepts a <code class="docutils literal notranslate"><span class="pre">widget</span></code> keyword argument (James O’Toole)</li>
<li>Reduced contrast of rich text toolbar (Jack Paine)</li>
<li>Support the rel attribute on custom ModelAdmin buttons (Andy Chosak)</li>
<li>Server-side page slug generation now respects <code class="docutils literal notranslate"><span class="pre">WAGTAIL_ALLOW_UNICODE_SLUGS</span></code> (Arkadiusz Michał Ryś)</li>
<li>Wagtail admin no longer depends on SiteMiddleware, avoiding incompatibility with Django sites framework and redundant database queries (aritas1, timmysmalls, Matt Westcott)</li>
<li>Tag field autocompletion now handles custom tag models (Matt Westcott)</li>
<li><code class="docutils literal notranslate"><span class="pre">wagtail_serve</span></code> URL route can now be omitted for headless sites (Storm Heg)</li>
<li>Allow free tagging to be disabled on custom tag models (Matt Westcott)</li>
<li>Allow disabling page preview by setting <code class="docutils literal notranslate"><span class="pre">preview_modes</span></code> to an empty list (Casper Timmers)</li>
<li>Add Vidyard to oEmbed provider list (Steve Lyall)</li>
<li>Optimise compiling media definitions for complex StreamBlocks (pimarc)</li>
<li>FieldPanel now accepts a ‘heading’ argument (Jacob Topp-Mugglestone)</li>
<li>Replaced deprecated <code class="docutils literal notranslate"><span class="pre">ugettext</span></code> / <code class="docutils literal notranslate"><span class="pre">ungettext</span></code> calls with <code class="docutils literal notranslate"><span class="pre">gettext</span></code> / <code class="docutils literal notranslate"><span class="pre">ngettext</span></code> (Mohamed Feddad)</li>
<li>ListBlocks now call child block <code class="docutils literal notranslate"><span class="pre">bulk_to_python</span></code> if defined (Andy Chosak)</li>
<li>Site settings are now identifiable/cacheable by request as well as site (Andy Babic)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">select_related</span></code> attribute to site settings to enable more efficient fetching of foreign key values (Andy Babic)</li>
<li>Add caching of image renditions (Tom Dyson, Tim Kamanin)</li>
<li>Add documentation for reporting security issues and internationalisation (Matt Westcott)</li>
<li>Fields on a custom image model can now be defined as required <code class="docutils literal notranslate"><span class="pre">blank=False</span></code> (Matt Westcott)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added ARIA alert role to live search forms in the admin (Casper Timmers)</li>
<li>Reordered login form elements to match expected tab order (Kjartan Sverrisson)</li>
<li>Re-added ‘Close Explorer’ button on mobile viewports (Sævar Öfjörð Magnússon)</li>
<li>Added a more descriptive label to Password reset link for screen reader users (Casper Timmers, Martin Coote)</li>
<li>Improved Wagtail logo contrast by adding a background (Brian Edelman, Simon Evans, Ben Enright)</li>
<li>Prevent duplicate notification messages on page locking (Jacob Topp-Mugglestone)</li>
<li>Rendering of non field errors for InlinePanel items (Storm Heg)</li>
<li><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">...</span> <span class="pre">as</span> <span class="pre">var</span> <span class="pre">%}</span></code> now clears the context variable when passed None as an image (Maylon Pedroso)</li>
<li><code class="docutils literal notranslate"><span class="pre">refresh_index</span></code> method on Elasticsearch no longer fails (Lars van de Kerkhof)</li>
<li>Document tags no longer fail to update when replacing the document file at the same time (Matt Westcott)</li>
<li>Prevent error from very tall / wide images being resized to 0 pixels (Fidel Ramos)</li>
<li>Remove excess margin when editing snippets (Quadric)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">scope</span></code> attribute to table headers in TableBlock output (Quadric)</li>
<li>Prevent KeyError when accessing a StreamField on a deferred queryset (Paulo Alvarado)</li>
<li>Hide empty ‘view live’ links (Karran Besen)</li>
<li>Mark up a few strings for translation (Luiz Boaretto)</li>
<li>Invalid focal_point attribute on image edit view (Michał (Quadric) Sieradzki)</li>
<li>No longer expose the <code class="docutils literal notranslate"><span class="pre">.delete()</span></code> method on the default Page.objects manager (Nick Smith)</li>
<li><code class="docutils literal notranslate"><span class="pre">exclude_fields_in_copy</span></code> on Page models will now work for for modelcluster parental / many to many relations (LB (Ben Johnston))</li>
<li>Response header (content disposition) now correctly handles filenames with non-ascii characters when using a storage backend (Rich Brennan)</li>
<li>Improved accessibility fixes for <code class="docutils literal notranslate"><span class="pre">main</span></code>, <code class="docutils literal notranslate"><span class="pre">header</span></code> and <code class="docutils literal notranslate"><span class="pre">footer</span></code> elements in the admin page layout (Mitchel Cabuloy)</li>
<li>Prevent version number from obscuring long settings menus (Naomi Morduch Toubman)</li>
<li>Admin views using TemplateResponse now respect the user’s language setting (Jacob Topp-Mugglestone)</li>
<li>Fixed incorrect language code for Japanese in language setting dropdown (Tomonori Tanabe)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="removed-support-for-django-2-1">
<h6>Removed support for Django 2.1<a class="headerlink" href="#removed-support-for-django-2-1" title="Permalink to this headline">¶</a></h6>
<p>Django 2.1 is no longer supported as of this release; please upgrade to Django 2.2 or above before upgrading Wagtail.</p>
</div>
<div class="section" id="sitemiddleware-and-request-site-deprecated">
<h6><code class="docutils literal notranslate"><span class="pre">SiteMiddleware</span></code> and <code class="docutils literal notranslate"><span class="pre">request.site</span></code> deprecated<a class="headerlink" href="#sitemiddleware-and-request-site-deprecated" title="Permalink to this headline">¶</a></h6>
<p>Wagtail’s <code class="xref py py-class docutils literal notranslate"><span class="pre">SiteMiddleware</span></code>, which makes the current site object available as the property <code class="docutils literal notranslate"><span class="pre">request.site</span></code>, is now deprecated as it clashes with Django’s sites framework and makes unnecessary database queries on non-Wagtail views. References to <code class="docutils literal notranslate"><span class="pre">request.site</span></code> in your code should be removed; the recommended way of retrieving the current site is <code class="docutils literal notranslate"><span class="pre">Site.find_for_request(request)</span></code> in Python code, and the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">wagtail_site</span> <span class="pre">%}</span></code> tag within Django templates.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># old version</span>

<span class="k">def</span> <span class="nf">get_menu_items</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">root_page</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span><span class="o">.</span><span class="n">live</span><span class="p">()</span>

<span class="c1"># new version</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Site</span>

<span class="k">def</span> <span class="nf">get_menu_items</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Site</span><span class="o">.</span><span class="n">find_for_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">root_page</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span><span class="o">.</span><span class="n">live</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="c">{# old version #}</span>

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome to the <span class="cp">{{</span> <span class="nv">request.site.site_name</span> <span class="cp">}}</span> website!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>


<span class="c">{# new version #}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailcore_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">wagtail_site</span> <span class="k">as</span> <span class="nv">current_site</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome to the <span class="cp">{{</span> <span class="nv">current_site.site_name</span> <span class="cp">}}</span> website!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Once these are removed, <code class="docutils literal notranslate"><span class="pre">'wagtail.core.middleware.SiteMiddleware'</span></code> can be removed from your project’s <code class="docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code> setting.</p>
</div>
<div class="section" id="page-collection-managers-no-longer-expose-a-delete-method">
<h6>Page / Collection managers no longer expose a <code class="docutils literal notranslate"><span class="pre">delete</span></code> method<a class="headerlink" href="#page-collection-managers-no-longer-expose-a-delete-method" title="Permalink to this headline">¶</a></h6>
<p>For <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/db/queries/#deleting-objects">consistency with standard Django models</a>, the <code class="docutils literal notranslate"><span class="pre">delete()</span></code> method is no longer available on the default Page and Collection managers. Code such as <code class="docutils literal notranslate"><span class="pre">Page.objects.delete()</span></code> should be changed to <code class="docutils literal notranslate"><span class="pre">Page.objects.all().delete()</span></code>.</p>
</div>
</div>
</div>
<span id="document-releases/2.8.2"></span><div class="section" id="wagtail-2-8-2-release-notes">
<h4>Wagtail 2.8.2 release notes<a class="headerlink" href="#wagtail-2-8-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="section" id="cve-2020-11037-potential-timing-attack-on-password-protected-private-pages">
<h5>CVE-2020-11037: Potential timing attack on password-protected private pages<a class="headerlink" href="#cve-2020-11037-potential-timing-attack-on-password-protected-private-pages" title="Permalink to this headline">¶</a></h5>
<p>This release addresses a potential timing attack on pages or documents that have been protected with a shared password through Wagtail’s “Privacy” controls. This password check is performed through a character-by-character string comparison, and so an attacker who is able to measure the time taken by this check to a high degree of accuracy could potentially use timing differences to gain knowledge of the password. (This is <a class="reference external" href="https://groups.google.com/d/msg/django-developers/iAaq0pvHXuA/fpUuwjK3i2wJ">understood to be feasible on a local network, but not on the public internet</a>.)</p>
<p>Many thanks to Thibaud Colas for reporting this issue.</p>
</div>
</div>
<span id="document-releases/2.8.1"></span><div class="section" id="wagtail-2-8-1-release-notes">
<h4>Wagtail 2.8.1 release notes<a class="headerlink" href="#wagtail-2-8-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="section" id="cve-2020-11001-possible-xss-attack-via-page-revision-comparison-view">
<h5>CVE-2020-11001: Possible XSS attack via page revision comparison view<a class="headerlink" href="#cve-2020-11001-possible-xss-attack-via-page-revision-comparison-view" title="Permalink to this headline">¶</a></h5>
<p>This release addresses a cross-site scripting (XSS) vulnerability on the page revision comparison view within the Wagtail admin interface. A user with a limited-permission editor account for the Wagtail admin could potentially craft a page revision history that, when viewed by a user with higher privileges, could perform actions with that user’s credentials. The vulnerability is not exploitable by an ordinary site visitor without access to the Wagtail admin.</p>
<p>Many thanks to Vlad Gerasimenko for reporting this issue.</p>
</div>
</div>
<span id="document-releases/2.8"></span><div class="section" id="wagtail-2-8-release-notes">
<h4>Wagtail 2.8 release notes<a class="headerlink" href="#wagtail-2-8-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="django-3-0-support">
<h6>Django 3.0 support<a class="headerlink" href="#django-3-0-support" title="Permalink to this headline">¶</a></h6>
<p>This release is compatible with Django 3.0. Compatibility fixes were contributed by Matt Westcott and Mads Jensen.</p>
</div>
<div class="section" id="improved-page-locking">
<h6>Improved page locking<a class="headerlink" href="#improved-page-locking" title="Permalink to this headline">¶</a></h6>
<p>The page locking feature has been revised so that the editor locking a page is given exclusive edit access to it, rather than it becoming read-only to everyone. A new Reports menu allows admin / moderator level users to see the currently locked pages, and unlock them if required.</p>
<p>This feature was developed by Karl Hobley and Jacob Topp-Mugglestone. Thanks to <a class="reference external" href="https://www.fool.com/">The Motley Fool</a> for sponsoring this feature.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Removed leftover Python 2.x compatibility code (Sergey Fedoseev)</li>
<li>Combine flake8 configurations (Sergey Fedoseev)</li>
<li>Improve diffing behavior for text fields (Aliosha Padovani)</li>
<li>Improve contrast of disabled inputs (Nick Smith)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">get_document_model_string</span></code> function (Andrey Smirnov)</li>
<li>Added support for Cloudflare API tokens for frontend cache invalidation (Tom Usher)</li>
<li>Cloudflare frontend cache invalidation requests are now sent in chunks of 30 to fit within API limits (Tom Usher)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">ancestors</span></code> field to the pages endpoint in admin API (Karl Hobley)</li>
<li>Removed Django admin management of <code class="docutils literal notranslate"><span class="pre">Page</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">Site</span></code> models (Andreas Bernacca)</li>
<li>Cleaned up Django docs URLs in documentation (Pete Andrew)</li>
<li>Add StreamFieldPanel to available panel types in documentation (Dan Swain)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">block.super</span> <span class="pre">}}</span></code> example to ModelAdmin customisation in documentation (Dan Swain)</li>
<li>Add ability to filter image index by a tag (Benedikt Willi)</li>
<li>Add partial experimental support for nested InlinePanels (Matt Westcott, Sam Costigan, Andy Chosak, Scott Cranfill)</li>
<li>Added cache control headers when serving documents (Johannes Vogel)</li>
<li>Use <code class="docutils literal notranslate"><span class="pre">sensitive_post_parameters</span></code> on password reset form (Dan Braghis)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">WAGTAILEMBEDS_RESPONSIVE_HTML</span></code> setting to remove automatic addition of <code class="docutils literal notranslate"><span class="pre">responsive-object</span></code> around embeds (Kalob Taulien)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Rename documents listing column ‘uploaded’ to ‘created’ (LB (Ben Johnston))</li>
<li>Unbundle the l18n library as it was bundled to avoid installation errors which have been resolved (Matt Westcott)</li>
<li>Prevent error when comparing pages that reference a model with a custom primary key (Fidel Ramos)</li>
<li>Moved <code class="docutils literal notranslate"><span class="pre">get_document_model</span></code> location so it can be imported when Models are not yet loaded (Andrey Smirnov)</li>
<li>Use correct HTML escaping of Jinja2 form templates for StructBlocks (Brady Moe)</li>
<li>All templates with wagtailsettings and modeladmin now use <code class="docutils literal notranslate"><span class="pre">block.super</span></code> for <code class="docutils literal notranslate"><span class="pre">extra_js</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">extra_css</span></code> (Timothy Bautista)</li>
<li>Layout issue when using <code class="docutils literal notranslate"><span class="pre">FieldRowPanel</span></code> with a heading (Andreas Bernacca)</li>
<li><code class="docutils literal notranslate"><span class="pre">file_size</span></code> and <code class="docutils literal notranslate"><span class="pre">file_hash</span></code> now updated when Document file changed (Andreas Bernacca)</li>
<li>Fixed order of URLs in project template so that static / media URLs are not blocked (Nick Smith)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">verbose_name_plural</span></code> to form submission model (Janneke Janssen)</li>
<li>Prevent <code class="docutils literal notranslate"><span class="pre">update_index</span></code> failures and incorrect front-end rendering on blank <code class="docutils literal notranslate"><span class="pre">TableBlock</span></code> (Carlo Ascani)</li>
<li>Dropdown initialisation on the search page after AJAX call (Eric Sherman)</li>
<li>Make sure all modal chooser search results correspond to the latest search by cancelling previous requests (Esper Kuijs)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="removed-support-for-django-2-0">
<h6>Removed support for Django 2.0<a class="headerlink" href="#removed-support-for-django-2-0" title="Permalink to this headline">¶</a></h6>
<p>Django 2.0 is no longer supported as of this release; please upgrade to Django 2.1 or above before upgrading Wagtail.</p>
</div>
<div class="section" id="edit-locking-behaviour-changed">
<h6>Edit locking behaviour changed<a class="headerlink" href="#edit-locking-behaviour-changed" title="Permalink to this headline">¶</a></h6>
<p>The behaviour of the page locking feature in the admin interface has been changed.
In past versions, the page lock would apply to all users including the user who
locked the page. Now, the user who locked the page can still edit it but all other
users cannot.</p>
<p>Pages that were locked before this release will continue to be locked in the same
way as before, so this only applies to newly locked pages. If you would like to
restore the previous behaviour, you can set the
<code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_GLOBAL_PAGE_EDIT_LOCK</span></code> setting to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</div>
<div class="section" id="responsive-html-for-embeds-no-longer-added-by-default">
<h6>Responsive HTML for embeds no longer added by default<a class="headerlink" href="#responsive-html-for-embeds-no-longer-added-by-default" title="Permalink to this headline">¶</a></h6>
<p>In previous versions of Wagtail, embedded media elements were given
a class name of <code class="docutils literal notranslate"><span class="pre">responsive-object</span></code> and an inline <code class="docutils literal notranslate"><span class="pre">padding-bottom</span></code> style to assist
in styling them responsively. These are no longer added by default. To restore the previous
behaviour, add <code class="docutils literal notranslate"><span class="pre">WAGTAILEMBEDS_RESPONSIVE_HTML</span> <span class="pre">=</span> <span class="pre">True</span></code> to your project settings.</p>
</div>
<div class="section" id="api-endpoint-classes-have-moved">
<h6>API endpoint classes have moved<a class="headerlink" href="#api-endpoint-classes-have-moved" title="Permalink to this headline">¶</a></h6>
<p>For consistency with Django REST Framework, the <code class="docutils literal notranslate"><span class="pre">PagesAPIEndpoint</span></code>, <code class="docutils literal notranslate"><span class="pre">ImagesAPIEndpoint</span></code> and <code class="docutils literal notranslate"><span class="pre">DocumentsAPIEndpoint</span></code> classes have been renamed to <code class="docutils literal notranslate"><span class="pre">PagesAPIViewSet</span></code>, <code class="docutils literal notranslate"><span class="pre">ImagesAPIViewSet</span></code> and <code class="docutils literal notranslate"><span class="pre">DocumentsAPIViewSet</span></code> and moved to the <code class="docutils literal notranslate"><span class="pre">views</span></code> module in their respective packages. Projects using the Wagtail API should update their registration code accordingly.</p>
<p>Old code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.api.v2.endpoints</span> <span class="kn">import</span> <span class="n">PagesAPIEndpoint</span>
<span class="kn">from</span> <span class="nn">wagtail.api.v2.router</span> <span class="kn">import</span> <span class="n">WagtailAPIRouter</span>
<span class="kn">from</span> <span class="nn">wagtail.images.api.v2.endpoints</span> <span class="kn">import</span> <span class="n">ImagesAPIEndpoint</span>
<span class="kn">from</span> <span class="nn">wagtail.documents.api.v2.endpoints</span> <span class="kn">import</span> <span class="n">DocumentsAPIEndpoint</span>

<span class="n">api_router</span> <span class="o">=</span> <span class="n">WagtailAPIRouter</span><span class="p">(</span><span class="s1">&#39;wagtailapi&#39;</span><span class="p">)</span>
<span class="n">api_router</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span><span class="s1">&#39;pages&#39;</span><span class="p">,</span> <span class="n">PagesAPIEndpoint</span><span class="p">)</span>
<span class="n">api_router</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="n">ImagesAPIEndpoint</span><span class="p">)</span>
<span class="n">api_router</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">,</span> <span class="n">DocumentsAPIEndpoint</span><span class="p">)</span>
</pre></div>
</div>
<p>New code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.api.v2.views</span> <span class="kn">import</span> <span class="n">PagesAPIViewSet</span>
<span class="kn">from</span> <span class="nn">wagtail.api.v2.router</span> <span class="kn">import</span> <span class="n">WagtailAPIRouter</span>
<span class="kn">from</span> <span class="nn">wagtail.images.api.v2.views</span> <span class="kn">import</span> <span class="n">ImagesAPIViewSet</span>
<span class="kn">from</span> <span class="nn">wagtail.documents.api.v2.views</span> <span class="kn">import</span> <span class="n">DocumentsAPIViewSet</span>

<span class="n">api_router</span> <span class="o">=</span> <span class="n">WagtailAPIRouter</span><span class="p">(</span><span class="s1">&#39;wagtailapi&#39;</span><span class="p">)</span>
<span class="n">api_router</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span><span class="s1">&#39;pages&#39;</span><span class="p">,</span> <span class="n">PagesAPIViewSet</span><span class="p">)</span>
<span class="n">api_router</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="n">ImagesAPIViewSet</span><span class="p">)</span>
<span class="n">api_router</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">,</span> <span class="n">DocumentsAPIViewSet</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="wagtail-documents-models-get-document-model-has-moved">
<h6><code class="docutils literal notranslate"><span class="pre">wagtail.documents.models.get_document_model</span></code> has moved<a class="headerlink" href="#wagtail-documents-models-get-document-model-has-moved" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">get_document_model</span></code> function should now be imported from <code class="docutils literal notranslate"><span class="pre">wagtail.documents</span></code> rather than <code class="docutils literal notranslate"><span class="pre">wagtail.documents.models</span></code>. See <a class="reference internal" href="index.html#custom-document-model"><span class="std std-ref">Custom document model</span></a>.</p>
</div>
<div class="section" id="removed-page-and-site-models-from-django-admin">
<h6>Removed <code class="docutils literal notranslate"><span class="pre">Page</span></code> and <code class="docutils literal notranslate"><span class="pre">Site</span></code> models from Django admin<a class="headerlink" href="#removed-page-and-site-models-from-django-admin" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">Page</span></code> and <code class="docutils literal notranslate"><span class="pre">Site</span></code> models are no longer editable through the Django admin backend. If required these models can be re-registered within your own project using <a class="reference external" href="https://docs.djangoproject.com/en/2.2/ref/contrib/admin/#modeladmin-objects">Django’s ModelAdmin</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_app/admin.py</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="kn">from</span> <span class="nn">wagtail.core.models</span> <span class="kn">import</span> <span class="n">Page</span><span class="p">,</span> <span class="n">Site</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-releases/2.7.4"></span><div class="section" id="wagtail-2-7-4-release-notes">
<h4>Wagtail 2.7.4 release notes<a class="headerlink" href="#wagtail-2-7-4-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="section" id="cve-2020-15118-html-injection-through-form-field-help-text">
<h5>CVE-2020-15118: HTML injection through form field help text<a class="headerlink" href="#cve-2020-15118-html-injection-through-form-field-help-text" title="Permalink to this headline">¶</a></h5>
<p>This release addresses an HTML injection vulnerability through help text in the <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.forms</span></code> form builder app. When a form page type is made available to Wagtail editors, and the page template is built using Django’s standard form rendering helpers such as <code class="docutils literal notranslate"><span class="pre">form.as_p</span></code> <a class="reference internal" href="index.html#form-builder-usage"><span class="std std-ref">(as directed in the documentation)</span></a>, any HTML tags used within a form field’s help text will be rendered unescaped in the page. Allowing HTML within help text is <a class="reference external" href="https://docs.djangoproject.com/en/3.0/ref/models/fields/#django.db.models.Field.help_text">an intentional design decision by Django</a>; however, as a matter of policy Wagtail does not allow editors to insert arbitrary HTML by default, as this could potentially be used to carry out cross-site scripting attacks, including privilege escalation. This functionality should therefore not have been made available to editor-level users.</p>
<p>The vulnerability is not exploitable by an ordinary site visitor without access to the Wagtail admin.</p>
<p>Site owners who wish to re-enable the use of HTML within help text (and are willing to accept the risk of this being exploited by editors) may set <code class="docutils literal notranslate"><span class="pre">WAGTAILFORMS_HELP_TEXT_ALLOW_HTML</span> <span class="pre">=</span> <span class="pre">True</span></code> in their configuration settings.</p>
<p>Many thanks to Timothy Bautista for reporting this issue.</p>
</div>
<div class="section" id="additional-fixes">
<h5>Additional fixes<a class="headerlink" href="#additional-fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Expand Pillow dependency range to include 7.x (Harris Lapiroff, Matt Westcott)</li>
</ul>
</div>
</div>
<span id="document-releases/2.7.3"></span><div class="section" id="wagtail-2-7-3-release-notes">
<h4>Wagtail 2.7.3 release notes<a class="headerlink" href="#wagtail-2-7-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="section" id="cve-2020-11037-potential-timing-attack-on-password-protected-private-pages">
<h5>CVE-2020-11037: Potential timing attack on password-protected private pages<a class="headerlink" href="#cve-2020-11037-potential-timing-attack-on-password-protected-private-pages" title="Permalink to this headline">¶</a></h5>
<p>This release addresses a potential timing attack on pages or documents that have been protected with a shared password through Wagtail’s “Privacy” controls. This password check is performed through a character-by-character string comparison, and so an attacker who is able to measure the time taken by this check to a high degree of accuracy could potentially use timing differences to gain knowledge of the password. (This is <a class="reference external" href="https://groups.google.com/d/msg/django-developers/iAaq0pvHXuA/fpUuwjK3i2wJ">understood to be feasible on a local network, but not on the public internet</a>.)</p>
<p>Many thanks to Thibaud Colas for reporting this issue.</p>
</div>
</div>
<span id="document-releases/2.7.2"></span><div class="section" id="wagtail-2-7-2-release-notes">
<h4>Wagtail 2.7.2 release notes<a class="headerlink" href="#wagtail-2-7-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="section" id="cve-2020-11001-possible-xss-attack-via-page-revision-comparison-view">
<h5>CVE-2020-11001: Possible XSS attack via page revision comparison view<a class="headerlink" href="#cve-2020-11001-possible-xss-attack-via-page-revision-comparison-view" title="Permalink to this headline">¶</a></h5>
<p>This release addresses a cross-site scripting (XSS) vulnerability on the page revision comparison view within the Wagtail admin interface. A user with a limited-permission editor account for the Wagtail admin could potentially craft a page revision history that, when viewed by a user with higher privileges, could perform actions with that user’s credentials. The vulnerability is not exploitable by an ordinary site visitor without access to the Wagtail admin.</p>
<p>Many thanks to Vlad Gerasimenko for reporting this issue.</p>
</div>
</div>
<span id="document-releases/2.7.1"></span><div class="section" id="wagtail-2-7-1-release-notes">
<h4>Wagtail 2.7.1 release notes<a class="headerlink" href="#wagtail-2-7-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Management command startup checks under <code class="docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code> no longer fail if <code class="docutils literal notranslate"><span class="pre">collectstatic</span></code> has not been run first (Alex Tomkins)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.7"></span><div class="section" id="wagtail-2-7-release-notes">
<h4>Wagtail 2.7 release notes<a class="headerlink" href="#wagtail-2-7-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id2">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id3">Upgrade considerations</a></li>
</ul>
</div>
<p>Wagtail 2.7 is designated a Long Term Support (LTS) release. Long Term Support releases will continue to receive maintenance updates as necessary to address security and data-loss related issues, up until the next LTS release (typically a period of 12 months).</p>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id2">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="improved-streamfield-design">
<h6>Improved StreamField design<a class="headerlink" href="#improved-streamfield-design" title="Permalink to this headline">¶</a></h6>
<img alt="_images/releasenotes_2_7_streamfield_styles.png" src="_images/releasenotes_2_7_streamfield_styles.png" />
<p>The design of the StreamField user interface has been updated to improve clarity and usability, including better handling of nested blocks. This work was completed by Bertrand Bordage as part of the <a class="reference external" href="https://www.kickstarter.com/projects/noripyt/wagtails-first-hatch">Wagtail’s First Hatch</a> crowdfunding campaign. We would like to thank all <a class="reference external" href="https://wagtail.io/blog/wagtails-first-hatch-backers/">supporters of the campaign</a>.</p>
</div>
<div class="section" id="webp-image-support">
<h6>WebP image support<a class="headerlink" href="#webp-image-support" title="Permalink to this headline">¶</a></h6>
<p>Images can now be uploaded and rendered in <a class="reference external" href="https://developers.google.com/speed/webp">WebP</a> format; see <a class="reference internal" href="index.html#image-file-formats"><span class="std std-ref">Image file formats</span></a> for details. This feature was developed by frmdstryr, Karl Hobley and Matt Westcott.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added Elasticsearch 7 support (pySilver)</li>
<li>Added Python 3.8 support (John Carter, Matt Westcott)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">construct_page_listing_buttons</span></code> hook (Michael van Tellingen)</li>
<li>Added more detailed documentation and troubleshooting for installing OpenCV for feature detection (Daniele Procida)</li>
<li>Move and refactor upgrade notification JS (Jonny Scholes)</li>
<li>Remove need for Elasticsearch <code class="docutils literal notranslate"><span class="pre">update_all_types</span></code> workaround, upgrade minimum release to 6.4.0 or above (Jonathan Liuti)</li>
<li>Add ability to insert internal anchor links/links with fragment identifiers in Draftail (rich text) fields (Iman Syed)</li>
<li>Added Table Block caption for accessibility (Rahmi Pruitt)</li>
<li>Add ability for users to change their own name via the account settings page (Kevin Howbrook)</li>
<li>Add ability to insert telephone numbers as links in Draftail (rich text) fields (Mikael Engström and Liam Brenner)</li>
<li>Increase delay before search in the snippet chooser, to prevent redundant search request round trips (Robert Rollins)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">WAGTAIL_EMAIL_MANAGEMENT_ENABLED</span></code> setting to determine whether users can change their email address (Janne Alatalo)</li>
<li>Recognise Soundcloud artist URLs as embeddable (Kiril Staikov)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_SERVE_METHOD</span></code> setting to determine how document downloads will be linked to and served (Tobias McNulty, Matt Westcott)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">WAGTAIL_MODERATION_ENABLED</span></code> setting to enable / disable the ‘Submit for Moderation’ option (Jacob Topp-Mugglestone) - thanks to <a class="reference external" href="https://www.fool.com/">The Motley Fool</a> for sponsoring this feature</li>
<li>Added settings to customise pagination page size for the Images admin area (Brian Whitton)</li>
<li>Added ARIA role to TableBlock output (Matt Westcott)</li>
<li>Added cache-busting query parameters to static files within the Wagtail admin (Matt Westcott)</li>
<li>Allow <code class="docutils literal notranslate"><span class="pre">register_page_action_menu_item</span></code> and <code class="docutils literal notranslate"><span class="pre">construct_page_action_menu</span></code> hooks to override the default menu action (Rahmi Pruitt, Matt Westcott) - thanks to <a class="reference external" href="https://www.fool.com/">The Motley Fool</a> for sponsoring review of this feature</li>
<li><code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_MAX_IMAGE_PIXELS</span></code> limit now takes the number of animation frames into account (Karl Hobley)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added line breaks to long filenames on multiple image / document uploader (Kevin Howbrook)</li>
<li>Added https support for Scribd oEmbed provider (Rodrigo)</li>
<li>Changed StreamField group label color so labels are visible (Catherine Farman)</li>
<li>Prevented images with a very wide aspect ratio from being displayed distorted in the rich text editor (Iman Syed)</li>
<li>Prevent exception when deleting a model with a protected One-to-one relationship (Neal Todd)</li>
<li>Added labels to snippet bulk edit checkboxes for screen reader users (Martey Dodoo)</li>
<li>Middleware responses during page preview are now properly returned to the user (Matt Westcott)</li>
<li>Default text of page links in rich text uses the public page title rather than the admin display title (Andy Chosak)</li>
<li>Specific page permission checks are now enforced when viewing a page revision (Andy Chosak)</li>
<li><code class="docutils literal notranslate"><span class="pre">pageurl</span></code> and <code class="docutils literal notranslate"><span class="pre">slugurl</span></code> tags no longer fail when <code class="docutils literal notranslate"><span class="pre">request.site</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code> (Samir Shah)</li>
<li>Output form media on add/edit image forms with custom models (Matt Westcott)</li>
<li>Output form media on add/edit document forms with custom models (Sergey Fedoseev)</li>
<li>Fixes layout for the clear checkbox in default FileField widget (Mikalai Radchuk)</li>
<li>Remove ASCII conversion from Postgres search backend, to support stemming in non-Latin alphabets (Pavel Denisov)</li>
<li>Prevent tab labels on page edit view from being cut off on very narrow screens (Kevin Howbrook)</li>
<li>Very long words in page listings are now broken where necessary (Kevin Howbrook)</li>
<li>Language chosen in user preferences no longer persists on subsequent requests (Bojan Mihelac)</li>
<li>Prevent new block IDs from being assigned on repeated calls to <code class="docutils literal notranslate"><span class="pre">StreamBlock.get_prep_value</span></code> (Colin Klein)</li>
<li>Prevent broken images in notification emails when static files are hosted on a remote domain (Eduard Luca)</li>
<li>Replace styleguide example avatar with default image to avoid issues when custom user model is used (Matt Westcott)</li>
<li><code class="docutils literal notranslate"><span class="pre">DraftailRichTextArea</span></code> is no longer treated as a hidden field by Django’s form logic (Sergey Fedoseev)</li>
<li>Replace format() placeholders in translatable strings with % formatting (Matt Westcott)</li>
<li>Altering Django REST Framework’s <code class="docutils literal notranslate"><span class="pre">DEFAULT_AUTHENTICATION_CLASSES</span></code> setting no longer breaks the page explorer menu and admin API (Matt Westcott)</li>
<li>Regression - missing label for external link URL field in link chooser (Stefani Castellanos)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id3">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="query-strings-added-to-static-file-urls-within-the-admin">
<h6>Query strings added to static file URLs within the admin<a class="headerlink" href="#query-strings-added-to-static-file-urls-within-the-admin" title="Permalink to this headline">¶</a></h6>
<p>To avoid problems caused by outdated cached JavaScript / CSS files following a Wagtail upgrade, URLs to static files within the Wagtail admin now include a version-specific query parameter of the form <code class="docutils literal notranslate"><span class="pre">?v=1a2b3c4d</span></code>. Under certain front-end cache configurations (such as <a class="reference external" href="https://support.cloudflare.com/hc/en-us/articles/200168256-What-are-Cloudflare-s-caching-levels-">Cloudflare’s ‘No Query String’ caching level</a>), the presence of this parameter may prevent the file from being cached at all. If you are using such a setup, and have some other method in place to expire outdated files (e.g. clearing the cache on deployment), you can disable the query parameter by setting <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_STATIC_FILE_VERSION_STRINGS</span></code> to False in your project settings. (Note that this is automatically disabled when <code class="docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code> is in use.)</p>
</div>
<div class="section" id="page-dummy-request-is-deprecated">
<h6><code class="docutils literal notranslate"><span class="pre">Page.dummy_request</span></code> is deprecated<a class="headerlink" href="#page-dummy-request-is-deprecated" title="Permalink to this headline">¶</a></h6>
<p>The internal <code class="docutils literal notranslate"><span class="pre">Page.dummy_request</span></code> method (which generates an HTTP request object simulating a real page request, for use in previews) has been deprecated, as it did not correctly handle errors generated during middleware processing. Any code that calls this method to render page previews should be updated to use the new method <code class="docutils literal notranslate"><span class="pre">Page.make_preview_request(original_request=None,</span> <span class="pre">preview_mode=None)</span></code>, which builds the request and calls <code class="docutils literal notranslate"><span class="pre">Page.serve_preview</span></code> as a single operation.</p>
</div>
<div class="section" id="changes-to-document-serving-on-remote-storage-backends-amazon-s3-etc">
<h6>Changes to document serving on remote storage backends (Amazon S3 etc)<a class="headerlink" href="#changes-to-document-serving-on-remote-storage-backends-amazon-s3-etc" title="Permalink to this headline">¶</a></h6>
<p>This release introduces a new setting <a class="reference internal" href="index.html#wagtaildocs-serve-method"><span class="std std-ref">WAGTAILDOCS_SERVE_METHOD</span></a> to control how document downloads are served. On previous versions of Wagtail, document files would always be served through a Django view, to allow permission checks to be applied. When using a remote storage backend such as Amazon S3, this meant that the document would be downloaded to the Django server on every download request.</p>
<p>In Wagtail 2.7, the default behaviour on remote storage backends is to redirect to the storage’s underlying URL after performing the permission check. If this is unsuitable for your project (for example, your storage provider is configured to block public access, or revealing its URL would be a security risk) you can revert to the previous behaviour by setting <code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_SERVE_METHOD</span></code> to <code class="docutils literal notranslate"><span class="pre">'serve_view'</span></code>.</p>
</div>
<div class="section" id="template-change-for-page-action-menu-hooks">
<h6>Template change for page action menu hooks<a class="headerlink" href="#template-change-for-page-action-menu-hooks" title="Permalink to this headline">¶</a></h6>
<p>When customising the action menu on the page edit view through the <a class="reference internal" href="index.html#register-page-action-menu-item"><span class="std std-ref">register_page_action_menu_item</span></a> or <a class="reference internal" href="index.html#construct-page-action-menu"><span class="std std-ref">construct_page_action_menu</span></a> hook, the <code class="docutils literal notranslate"><span class="pre">ActionMenuItem</span></code> object’s <code class="docutils literal notranslate"><span class="pre">template</span></code> attribute or <code class="docutils literal notranslate"><span class="pre">render_html</span></code> method can be overridden to customise the menu item’s HTML. As of Wagtail 2.7, the HTML returned from these should <em>not</em> include the enclosing <code class="docutils literal notranslate"><span class="pre">&lt;li&gt;</span></code> element.</p>
<p>Any add-on library that uses this feature and needs to preserve backward compatibility with previous Wagtail versions can conditionally reinsert the <code class="docutils literal notranslate"><span class="pre">&lt;li&gt;</span></code> wrapper through its <code class="docutils literal notranslate"><span class="pre">render_html</span></code> method - for example:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>
<span class="kn">from</span> <span class="nn">wagtail</span> <span class="kn">import</span> <span class="n">VERSION</span> <span class="k">as</span> <span class="n">WAGTAIL_VERSION</span>
<span class="kn">from</span> <span class="nn">wagtail.admin.action_menu</span> <span class="kn">import</span> <span class="n">ActionMenuItem</span>

<span class="k">class</span> <span class="nc">CustomMenuItem</span><span class="p">(</span><span class="n">ActionMenuItem</span><span class="p">):</span>
    <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;myapp/my_menu_item.html&#39;</span>

    <span class="k">def</span> <span class="nf">render_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">parent_context</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">render_html</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">parent_context</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">WAGTAIL_VERSION</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">format_html</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;</span><span class="si">{}</span><span class="s1">&lt;/li&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="wagtail-admin-utils-and-wagtail-admin-decorators-modules-deprecated">
<h6><code class="docutils literal notranslate"><span class="pre">wagtail.admin.utils</span></code> and <code class="docutils literal notranslate"><span class="pre">wagtail.admin.decorators</span></code> modules deprecated<a class="headerlink" href="#wagtail-admin-utils-and-wagtail-admin-decorators-modules-deprecated" title="Permalink to this headline">¶</a></h6>
<p>The modules <code class="docutils literal notranslate"><span class="pre">wagtail.admin.utils</span></code> and <code class="docutils literal notranslate"><span class="pre">wagtail.admin.decorators</span></code> have been deprecated. The helper functions defined here exist primarily for Wagtail’s internal use; however, some of them (particularly <code class="docutils literal notranslate"><span class="pre">send_mail</span></code> and <code class="docutils literal notranslate"><span class="pre">permission_required</span></code>) may be found in user code, and import lines will need to be updated. The new locations for these definitions are as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="30%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Definition</th>
<th class="head">Old location</th>
<th class="head">New location</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>any_permission_required</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.auth</td>
</tr>
<tr class="row-odd"><td>permission_denied</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.auth</td>
</tr>
<tr class="row-even"><td>permission_required</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.auth</td>
</tr>
<tr class="row-odd"><td>PermissionPolicyChecker</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.auth</td>
</tr>
<tr class="row-even"><td>user_has_any_page_permission</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.auth</td>
</tr>
<tr class="row-odd"><td>user_passes_test</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.auth</td>
</tr>
<tr class="row-even"><td>users_with_page_permission</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.auth</td>
</tr>
<tr class="row-odd"><td>reject_request</td>
<td>wagtail.admin.decorators</td>
<td>wagtail.admin.auth</td>
</tr>
<tr class="row-even"><td>require_admin_access</td>
<td>wagtail.admin.decorators</td>
<td>wagtail.admin.auth</td>
</tr>
<tr class="row-odd"><td>get_available_admin_languages</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.localization</td>
</tr>
<tr class="row-even"><td>get_available_admin_time_zones</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.localization</td>
</tr>
<tr class="row-odd"><td>get_js_translation_strings</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.localization</td>
</tr>
<tr class="row-even"><td>WAGTAILADMIN_PROVIDED_LANGUAGES</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.localization</td>
</tr>
<tr class="row-odd"><td>send_mail</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.mail</td>
</tr>
<tr class="row-even"><td>send_notification</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.mail</td>
</tr>
<tr class="row-odd"><td>get_object_usage</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.models</td>
</tr>
<tr class="row-even"><td>popular_tags_for_model</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.models</td>
</tr>
<tr class="row-odd"><td>get_site_for_user</td>
<td>wagtail.admin.utils</td>
<td>wagtail.admin.navigation</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<span id="document-releases/2.6.3"></span><div class="section" id="wagtail-2-6-3-release-notes">
<h4>Wagtail 2.6.3 release notes<a class="headerlink" href="#wagtail-2-6-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Altering Django REST Framework’s <code class="docutils literal notranslate"><span class="pre">DEFAULT_AUTHENTICATION_CLASSES</span></code> setting no longer breaks the page explorer menu and admin API (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.6.2"></span><div class="section" id="wagtail-2-6-2-release-notes">
<h4>Wagtail 2.6.2 release notes<a class="headerlink" href="#wagtail-2-6-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Prevent search indexing failures on Postgres 9.4 and Django &gt;= 2.2.1 (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.6.1"></span><div class="section" id="wagtail-2-6-1-release-notes">
<h4>Wagtail 2.6.1 release notes<a class="headerlink" href="#wagtail-2-6-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Prevent JavaScript errors caused by unescaped quote characters in translation strings (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.6"></span><div class="section" id="wagtail-2-6-release-notes">
<h4>Wagtail 2.6 release notes<a class="headerlink" href="#wagtail-2-6-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="accessibility-targets-and-improvements">
<h6>Accessibility targets and improvements<a class="headerlink" href="#accessibility-targets-and-improvements" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now has official accessibility support targets: we are aiming for compliance with <a class="reference external" href="https://www.w3.org/TR/WCAG21/">WCAG2.1</a>, AA level. WCAG 2.1 is the international standard which underpins many national accessibility laws.</p>
<p>Wagtail isn’t fully compliant just yet, but we have made many changes to the admin interface to get there. We thank the UK Government (in particular the CMS team at the Department for International Trade), who commissioned many of these improvements.</p>
<p>Here are changes which should make Wagtail more usable for all users regardless of abilities:</p>
<ul class="simple">
<li>Increase font-size across the whole admin (Beth Menzies, Katie Locke)</li>
<li>Improved text color contrast across the whole admin (Beth Menzies, Katie Locke)</li>
<li>Added consistent focus outline styles across the whole admin (Thibaud Colas)</li>
<li>Ensured the ‘add child page’ button displays when focused (Helen Chapman, Katie Locke)</li>
</ul>
<p>This release also contains many big improvements for screen reader users:</p>
<ul class="simple">
<li>Added more ARIA landmarks across the admin interface and welcome page for screen reader users to navigate the CMS more easily (Beth Menzies)</li>
<li>Improved heading structure for screen reader users navigating the CMS admin (Beth Menzies, Helen Chapman)</li>
<li>Make icon font implementation more screen-reader-friendly (Thibaud Colas)</li>
<li>Removed buggy tab order customisations in the CMS admin (Jordan Bauer)</li>
<li>Screen readers now treat page-level action dropdowns as navigation instead of menus (Helen Chapman)</li>
<li>Fixed occurrences of invalid HTML across the CMS admin (Thibaud Colas)</li>
<li>Add empty alt attributes to all images in the CMS admin (Andreas Bernacca)</li>
<li>Fixed focus not moving to the pages explorer menu when open (Helen Chapman)</li>
</ul>
<p>We’ve also had a look at how controls are labelled across the UI for screen reader users:</p>
<ul class="simple">
<li>Add image dimensions in image gallery and image choosers for screen reader users (Helen Chapman)</li>
<li>Add more contextual information for screen readers in the explorer menu’s links (Helen Chapman)</li>
<li>Make URL generator preview image alt translatable (Thibaud Colas)</li>
<li>Screen readers now announce “Dashboard” for the main nav’s logo link instead of Wagtail’s version number (Thibaud Colas)</li>
<li>Remove duplicate labels in image gallery and image choosers for screen reader users (Helen Chapman)</li>
<li>Added a label to the modals’ “close” button for screen reader users (Helen Chapman, Katie Locke)</li>
<li>Added labels to permission checkboxes for screen reader users (Helen Chapman, Katie Locke)</li>
<li>Improve screen-reader labels for action links in page listing (Helen Chapman, Katie Locke)</li>
<li>Add screen-reader labels for table headings in page listing (Helen Chapman, Katie Locke)</li>
<li>Add screen reader labels for page privacy toggle, edit lock, status tag in page explorer &amp; edit views (Helen Chapman, Katie Locke)</li>
<li>Add screen-reader labels for dashboard summary cards (Helen Chapman, Katie Locke)</li>
<li>Add screen-reader labels for privacy toggle of collections (Helen Chapman, Katie Locke)</li>
</ul>
<p>Again, this is still a work in progress –&nbsp;if you are aware of other existing accessibility issues, please do <a class="reference external" href="https://github.com/wagtail/wagtail/issues?q=is%3Aopen+is%3Aissue+label%3AAccessibility">open an issue</a> if there isn’t one already.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added support for <code class="docutils literal notranslate"><span class="pre">short_description</span></code> for field labels in modeladmin’s <code class="docutils literal notranslate"><span class="pre">InspectView</span></code> (Wesley van Lee)</li>
<li>Rearranged SCSS folder structure to the client folder and split them approximately according to ITCSS. (Naomi Morduch Toubman, Jonny Scholes, Janneke Janssen, Hugo van den Berg)</li>
<li>Added support for specifying cell alignment on TableBlock (Samuel Mendes)</li>
<li>Added more informative error when a non-image object is passed to the <code class="docutils literal notranslate"><span class="pre">image</span></code> template tag (Deniz Dogan)</li>
<li>Added ButtonHelper examples in the modelAdmin primer page within documentation (Kalob Taulien)</li>
<li>Multiple clarifications, grammar and typo fixes throughout documentation (Dan Swain)</li>
<li>Use correct URL in API example in documentation (Michael Bunsen)</li>
<li>Move datetime widget initialiser JS into the widget’s form media instead of page editor media (Matt Westcott)</li>
<li>Add form field prefixes for input forms in chooser modals (Matt Westcott)</li>
<li>Removed version number from the logo link’s title. The version can now be found under the Settings menu (Thibaud Colas)</li>
<li>Added “don’t delete” option to confirmation screen when deleting images, documents and modeladmin models (Kevin Howbrook)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">branding_title</span></code> template block for the admin title prefix (Dillen Meijboom)</li>
<li>Added support for custom search handler classes to modeladmin’s IndexView, and added a class that uses the default Wagtail search backend for searching (Seb Brown, Andy Babic)</li>
<li>Update group edit view to expose the <code class="docutils literal notranslate"><span class="pre">Permission</span></code> object for each checkbox (George Hickman)</li>
<li>Improve performance of Pages for Moderation panel (Fidel Ramos)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">process_child_object</span></code> and <code class="docutils literal notranslate"><span class="pre">exclude_fields</span></code> arguments to <code class="docutils literal notranslate"><span class="pre">Page.copy()</span></code> to make it easier for third-party apps to customise copy behavior (Karl Hobley)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">Page.with_content_json()</span></code>, allowing revision content loading behaviour to be customised on a per-model basis (Karl Hobley)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">construct_settings_menu</span></code> hook (Jordan Bauer, Quadric)</li>
<li>Fixed compatibility of date / time choosers with wagtail-react-streamfield (Mike Hearn)</li>
<li>Performance optimization of several admin functions, including breadcrumbs, home and index pages (Fidel Ramos)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>ModelAdmin no longer fails when filtering over a foreign key relation (Jason Dilworth, Matt Westcott)</li>
<li>The Wagtail version number is now visible within the Settings menu (Kevin Howbrook)</li>
<li>Scaling images now rounds values to an integer so that images render without errors (Adrian Brunyate)</li>
<li>Revised test decorator to ensure TestPageEditHandlers test cases run correctly (Alex Tomkins)</li>
<li>Wagtail bird animation in admin now ends correctly on all browsers (Deniz Dogan)</li>
<li>Explorer menu no longer shows sibling pages for which the user does not have access (Mike Hearn)</li>
<li>Admin HTML now includes the correct <code class="docutils literal notranslate"><span class="pre">dir</span></code> attribute for the active language (Andreas Bernacca)</li>
<li>Fix type error when using <code class="docutils literal notranslate"><span class="pre">--chunk_size</span></code> argument on <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">update_index</span></code> (Seb Brown)</li>
<li>Avoid rendering entire form in EditHandler’s <code class="docutils literal notranslate"><span class="pre">repr</span></code> method (Alex Tomkins)</li>
<li>Add empty alt attributes to HTML output of Embedly and oEmbed embed finders (Andreas Bernacca)</li>
<li>Clear pending AJAX request if error occurs on page chooser (Matt Westcott)</li>
<li>Prevent text from overlapping in focal point editing UI (Beth Menzies)</li>
<li>Restore custom “Date” icon for scheduled publishing panel in Edit page’s Settings tab (Helen Chapman)</li>
<li>Added missing form media to user edit form template (Matt Westcott)</li>
<li><code class="docutils literal notranslate"><span class="pre">Page.copy()</span></code> no longer copies child objects when the accessor name is included in <code class="docutils literal notranslate"><span class="pre">exclude_fields_in_copy</span></code> (Karl Hobley)</li>
<li>Clicking the privacy toggle while the page is still loading no longer loads the wrong data in the page (Helen Chapman)</li>
<li>Added missing <code class="docutils literal notranslate"><span class="pre">is_stored_locally</span></code> method to <code class="docutils literal notranslate"><span class="pre">AbstractDocument</span></code> (jonny5532)</li>
<li>Query model no longer removes punctuation as part of string normalisation (William Blackie)</li>
<li>Make login test helper work with user models with non-default username fields (Andrew Miller)</li>
<li>Delay dirty form check to prevent “unsaved changes” warning from being wrongly triggered (Thibaud Colas)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="removed-support-for-python-3-4">
<h6>Removed support for Python 3.4<a class="headerlink" href="#removed-support-for-python-3-4" title="Permalink to this headline">¶</a></h6>
<p>Python 3.4 is no longer supported as of this release; please upgrade to Python 3.5 or above before upgrading Wagtail.</p>
</div>
<div class="section" id="icon-font-implementation-changes">
<h6>Icon font implementation changes<a class="headerlink" href="#icon-font-implementation-changes" title="Permalink to this headline">¶</a></h6>
<p>The icon font implementation has been changed to be invisible for screen-reader users, by switching to using <a class="reference external" href="https://en.wikipedia.org/wiki/Private_Use_Areas">Private Use Areas</a> Unicode code points. All of the icon classes (<code class="docutils literal notranslate"><span class="pre">icon-user</span></code>, <code class="docutils literal notranslate"><span class="pre">icon-search</span></code>, etc) should still work the same, except for two which have been removed because they were duplicates:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">icon-picture</span></code> is removed. Use <code class="docutils literal notranslate"><span class="pre">icon-image</span></code> instead (same visual).</li>
<li><code class="docutils literal notranslate"><span class="pre">icon-file-text-alt</span></code> is removed. Use <code class="docutils literal notranslate"><span class="pre">icon-doc-full</span></code> instead (same visual).</li>
</ul>
<p>For a list of all available icons, please see the <a class="reference internal" href="index.html#styleguide"><span class="std std-ref">UI Styleguide</span></a>.</p>
</div>
</div>
</div>
<span id="document-releases/2.5.2"></span><div class="section" id="wagtail-2-5-2-release-notes">
<h4>Wagtail 2.5.2 release notes<a class="headerlink" href="#wagtail-2-5-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Delay dirty form check to prevent “unsaved changes” warning from being wrongly triggered (Thibaud Colas)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.5.1"></span><div class="section" id="wagtail-2-5-1-release-notes">
<h4>Wagtail 2.5.1 release notes<a class="headerlink" href="#wagtail-2-5-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Prevent crash when comparing StructBlocks in revision history (Adrian Turjak, Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.5"></span><div class="section" id="wagtail-2-5-release-notes">
<h4>Wagtail 2.5 release notes<a class="headerlink" href="#wagtail-2-5-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="django-2-2-support">
<h6>Django 2.2 support<a class="headerlink" href="#django-2-2-support" title="Permalink to this headline">¶</a></h6>
<p>This release is compatible with Django 2.2.  Compatibility fixes were contributed by Matt Westcott and Andy Babic.</p>
</div>
<div class="section" id="new-markdown-shortcuts-in-rich-text">
<h6>New Markdown shortcuts in rich text<a class="headerlink" href="#new-markdown-shortcuts-in-rich-text" title="Permalink to this headline">¶</a></h6>
<p>Wagtail’s rich text editor now supports using Markdown shortcuts for inline formatting:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">**</span></code> for bold</li>
<li><code class="docutils literal notranslate"><span class="pre">_</span></code> for italic</li>
<li><code class="docutils literal notranslate"><span class="pre">~</span></code> for strikethrough (if enabled)</li>
<li><code class="docutils literal notranslate"><span class="pre">`</span></code> for code (if enabled)</li>
</ul>
<p>To learn other shortcuts, have a look at the <a class="reference external" href="https://www.draftail.org/docs/keyboard-shortcuts">keyboard shortcuts</a> reference.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added support for customising EditHandler-based forms on a per-request basis (Bertrand Bordage)</li>
<li>Added more informative error message when <code class="docutils literal notranslate"><span class="pre">|richtext</span></code> filter is applied to a non-string value (mukesh5)</li>
<li>Automatic search indexing can now be disabled on a per-model basis via the <code class="docutils literal notranslate"><span class="pre">search_auto_update</span></code> attribute (Karl Hobley)</li>
<li>Improved diffing of StreamFields when comparing page revisions (Karl Hobley)</li>
<li>Highlight broken links to pages and missing documents in rich text (Brady Moe)</li>
<li>Preserve links when copy-pasting rich text content from Wagtail to other tools (Thibaud Colas)</li>
<li>Rich text to contentstate conversion now prioritises more specific rules, to accommodate <code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;br&gt;</span></code> elements with attributes (Matt Westcott)</li>
<li>Added limit image upload size by number of pixels (Thomas Elliott)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">wagtail_update_index</span></code> alias to avoid clashes with <code class="docutils literal notranslate"><span class="pre">update_index</span></code> commands from other packages (Matt Westcott)</li>
<li>Renamed <code class="docutils literal notranslate"><span class="pre">target_model</span></code> argument on <code class="docutils literal notranslate"><span class="pre">PageChooserBlock</span></code> to <code class="docutils literal notranslate"><span class="pre">page_type</span></code> (Loic Teixeira)</li>
<li><code class="docutils literal notranslate"><span class="pre">edit_handler</span></code> and <code class="docutils literal notranslate"><span class="pre">panels</span></code> can now be defined on a <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> definition (Thomas Kremmel)</li>
<li>Add Learn Wagtail to third-party tutorials in documentation (Matt Westcott)</li>
<li>Add a Django setting <code class="docutils literal notranslate"><span class="pre">TAG_LIMIT</span></code> to limit number of tags that can be added to any taggit model (Mani)</li>
<li>Added instructions on how to generate urls for <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> to documentation (LB (Ben Johnston), Andy Babic)</li>
<li>Added option to specify a fallback URL on <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">pageurl</span> <span class="pre">%}</span></code> (Arthur Holzner)</li>
<li>Add support for more rich text formats, disabled by default: <code class="docutils literal notranslate"><span class="pre">blockquote</span></code>, <code class="docutils literal notranslate"><span class="pre">superscript</span></code>, <code class="docutils literal notranslate"><span class="pre">subscript</span></code>, <code class="docutils literal notranslate"><span class="pre">strikethrough</span></code>, <code class="docutils literal notranslate"><span class="pre">code</span></code> (Md Arifin Ibne Matin)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">max_count_per_parent</span></code> option on page models to limit the number of pages of a given type that can be created under one parent page (Wesley van Lee)</li>
<li><code class="docutils literal notranslate"><span class="pre">StreamField</span></code> field blocks now accept a <code class="docutils literal notranslate"><span class="pre">validators</span></code> argument (Tom Usher)</li>
<li>Added edit / delete buttons to snippet index and “don’t delete” option to confirmation screen, for consistency with pages (Kevin Howbrook)</li>
<li>Added name attributes to all built-in page action menu items (LB (Ben Johnston))</li>
<li>Added validation on the filter string to the Jinja2 image template tag (Jonny Scholes)</li>
<li>Changed the pages reordering UI toggle to make it easier to find (Katie Locke, Thibaud Colas)</li>
<li>Added support for rich text link rewrite handlers for <code class="docutils literal notranslate"><span class="pre">external</span></code> and <code class="docutils literal notranslate"><span class="pre">email</span></code> links (Md Arifin Ibne Matin)</li>
<li>Clarify installation instructions in documentation, especially regarding virtual environments. (Naomi Morduch Toubman)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Set <code class="docutils literal notranslate"><span class="pre">SERVER_PORT</span></code> to 443 in <code class="docutils literal notranslate"><span class="pre">Page.dummy_request()</span></code> for HTTPS sites (Sergey Fedoseev)</li>
<li>Include port number in <code class="docutils literal notranslate"><span class="pre">Host</span></code> header of <code class="docutils literal notranslate"><span class="pre">Page.dummy_request()</span></code> (Sergey Fedoseev)</li>
<li>Validation error messages in <code class="docutils literal notranslate"><span class="pre">InlinePanel</span></code> no longer count towards <code class="docutils literal notranslate"><span class="pre">max_num</span></code> when disabling the ‘add’ button (Todd Dembrey, Thibaud Colas)</li>
<li>Rich text to contentstate conversion now ignores stray closing tags (frmdstryr)</li>
<li>Escape backslashes in <code class="docutils literal notranslate"><span class="pre">postgres_search</span></code> queries (Hammy Goonan)</li>
<li>Parent page link in page chooser search results no longer navigates away (Asanka Lihiniyagoda, Sævar Öfjörð Magnússon)</li>
<li><code class="docutils literal notranslate"><span class="pre">routablepageurl</span></code> tag now correctly omits domain part when multiple sites exist at the same root (Gassan Gousseinov)</li>
<li>Added missing collection column specifier on document listing template (Sergey Fedoseev)</li>
<li>Page Copy will now also copy ParentalManyToMany field relations (LB (Ben Johnston))</li>
<li>Admin HTML header now includes correct language code (Matt Westcott)</li>
<li>Unclear error message when saving image after focal point edit (Hugo van den Berg)</li>
<li>Increase max length on <code class="docutils literal notranslate"><span class="pre">Embed.thumbnail_url</span></code> to 255 characters (Kevin Howbrook)</li>
<li><code class="docutils literal notranslate"><span class="pre">send_mail</span></code> now correctly uses the <code class="docutils literal notranslate"><span class="pre">html_message</span></code> kwarg for HTML messages (Tiago Requeijo)</li>
<li>Page copying no longer allowed if page model has reached its <code class="docutils literal notranslate"><span class="pre">max_count</span></code> (Andy Babic)</li>
<li>Don’t show page type on page chooser button when multiple types are allowed (Thijs Kramer)</li>
<li>Make sure page chooser search results correspond to the latest search by cancelling previous requests (Esper Kuijs)</li>
<li>Inform user when moving a page from one parent to another where there is an already existing page with the same slug (Casper Timmers)</li>
<li>User add/edit forms now support form widgets with JS/CSS media (Damian Grinwis)</li>
<li>Rich text processing now preserves non-breaking spaces instead of converting them to normal spaces (Wesley van Lee)</li>
<li>Prevent autocomplete dropdowns from appearing over date choosers on Chrome (Kevin Howbrook)</li>
<li>Prevent crash when logging HTTP errors on Cloudflare cache purging (Kevin Howbrook)</li>
<li>Prevent rich text editor crash when filtering copy-pasted content and the last block is to be removed, e.g. unsupported image (Thibaud Colas)</li>
<li>Removing rich text links / documents now also works when the text selection is backwards (Thibaud Colas)</li>
<li>Prevent the rich text editor from crashing when copy-paste filtering removes all of its content (Thibaud Colas)</li>
<li>Page chooser now respects custom <code class="docutils literal notranslate"><span class="pre">get_admin_display_title</span></code> methods on parent page and breadcrumb (Haydn Greatnews)</li>
<li>Added consistent whitespace around sortable table headings (Matt Westcott)</li>
<li>Moved locale names for Chinese (Simplified) and Chinese (Traditional) to <code class="docutils literal notranslate"><span class="pre">zh_Hans</span></code> and <code class="docutils literal notranslate"><span class="pre">zh_Hant</span></code> (Matt Westcott)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="edithandler-bind-to-model-and-edithandler-bind-to-instance-deprecated">
<h6><code class="docutils literal notranslate"><span class="pre">EditHandler.bind_to_model</span></code> and <code class="docutils literal notranslate"><span class="pre">EditHandler.bind_to_instance</span></code> deprecated<a class="headerlink" href="#edithandler-bind-to-model-and-edithandler-bind-to-instance-deprecated" title="Permalink to this headline">¶</a></h6>
<p>The internal <code class="docutils literal notranslate"><span class="pre">EditHandler</span></code> methods <code class="docutils literal notranslate"><span class="pre">bind_to_model</span></code> and <code class="docutils literal notranslate"><span class="pre">bind_to_instance</span></code> have been deprecated, in favour of a new combined <code class="docutils literal notranslate"><span class="pre">bind_to</span></code> method which accepts <code class="docutils literal notranslate"><span class="pre">model</span></code>, <code class="docutils literal notranslate"><span class="pre">instance</span></code>, <code class="docutils literal notranslate"><span class="pre">request</span></code> and <code class="docutils literal notranslate"><span class="pre">form</span></code> as optional keyword arguments. Any user code which calls <code class="docutils literal notranslate"><span class="pre">EditHandler.bind_to_model(model)</span></code> should be updated to use <code class="docutils literal notranslate"><span class="pre">EditHandler.bind_to(model=model)</span></code> instead; any user code which calls <code class="docutils literal notranslate"><span class="pre">EditHandler.bind_to_instance(instance,</span> <span class="pre">request,</span> <span class="pre">form)</span></code> should be updated to use <code class="docutils literal notranslate"><span class="pre">EditHandler.bind_to(instance=instance,</span> <span class="pre">request=request,</span> <span class="pre">form=form)</span></code>.</p>
</div>
<div class="section" id="changes-to-admin-pagination-helpers">
<h6>Changes to admin pagination helpers<a class="headerlink" href="#changes-to-admin-pagination-helpers" title="Permalink to this headline">¶</a></h6>
<p>A number of changes have been made to pagination handling within the Wagtail admin; these are internal API changes, but may affect applications and third-party packages that add new paginated object listings, including chooser modals, to the admin. The <code class="docutils literal notranslate"><span class="pre">paginate</span></code> function in <code class="docutils literal notranslate"><span class="pre">wagtail.utils.pagination</span></code> has been deprecated in favour of the <code class="docutils literal notranslate"><span class="pre">django.core.paginator.Paginator.get_page</span></code> method introduced in Django 2.0 - a call such as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.utils.pagination</span> <span class="kn">import</span> <span class="n">paginate</span>

<span class="n">paginator</span><span class="p">,</span> <span class="n">page</span> <span class="o">=</span> <span class="n">paginate</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
<p>should be replaced with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>

<span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">object_list</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Additionally, the <code class="docutils literal notranslate"><span class="pre">is_ajax</span></code> flag on the template <code class="docutils literal notranslate"><span class="pre">wagtailadmin/shared/pagination_nav.html</span></code> has been deprecated in favour of a new template <code class="docutils literal notranslate"><span class="pre">wagtailadmin/shared/ajax_pagination_nav.html</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;wagtailadmin/shared/pagination_nav.html&quot;</span> <span class="k">with</span> <span class="nv">items</span><span class="o">=</span><span class="nv">page_obj</span> <span class="nv">is_ajax</span><span class="o">=</span><span class="m">1</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>should become:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;wagtailadmin/shared/ajax_pagination_nav.html&quot;</span> <span class="k">with</span> <span class="nv">items</span><span class="o">=</span><span class="nv">page_obj</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="new-rich-text-formats">
<h6>New rich text formats<a class="headerlink" href="#new-rich-text-formats" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now has built-in support for new rich text formats, disabled by default:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">blockquote</span></code>, using the <code class="docutils literal notranslate"><span class="pre">blockquote</span></code> Draft.js block type, saved as a <code class="docutils literal notranslate"><span class="pre">&lt;blockquote&gt;</span></code> tag.</li>
<li><code class="docutils literal notranslate"><span class="pre">superscript</span></code>, using the <code class="docutils literal notranslate"><span class="pre">SUPERSCRIPT</span></code> Draft.js inline style, saved as a <code class="docutils literal notranslate"><span class="pre">&lt;sup&gt;</span></code> tag.</li>
<li><code class="docutils literal notranslate"><span class="pre">subscript</span></code>, using the <code class="docutils literal notranslate"><span class="pre">SUBSCRIPT</span></code> Draft.js inline style, saved as a <code class="docutils literal notranslate"><span class="pre">&lt;sub&gt;</span></code> tag.</li>
<li><code class="docutils literal notranslate"><span class="pre">strikethrough</span></code>, using the <code class="docutils literal notranslate"><span class="pre">STRIKETHROUGH</span></code> Draft.js inline style, saved as a <code class="docutils literal notranslate"><span class="pre">&lt;s&gt;</span></code> tag.</li>
<li><code class="docutils literal notranslate"><span class="pre">code</span></code>, using the <code class="docutils literal notranslate"><span class="pre">CODE</span></code> Draft.js inline style, saved as a <code class="docutils literal notranslate"><span class="pre">&lt;code&gt;</span></code> tag.</li>
</ul>
<p>Projects already using those exact Draft.js type and HTML tag combinations can safely replace their feature definitions with the new built-ins. Projects that use the same feature identifier can keep their existing feature definitions as overrides. Finally, if the Draft.js types / HTML tags are used but with a different combination, do not enable the new feature definitions to avoid conflicts in storage or editor behavior.</p>
</div>
<div class="section" id="register-link-type-and-register-embed-type-methods-for-rich-text-tag-rewriting-have-changed">
<h6><code class="docutils literal notranslate"><span class="pre">register_link_type</span></code> and <code class="docutils literal notranslate"><span class="pre">register_embed_type</span></code> methods for rich text tag rewriting have changed<a class="headerlink" href="#register-link-type-and-register-embed-type-methods-for-rich-text-tag-rewriting-have-changed" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">FeatureRegistry.register_link_type</span></code> and <code class="docutils literal notranslate"><span class="pre">FeatureRegistry.register_embed_type</span></code> methods, which define how links and embedded media in rich text are converted to HTML, now accept a handler class. Previously, they were passed an identifier string and a rewrite function. For details of updating your code to the new convention, see <a class="reference internal" href="index.html#rich-text-rewrite-handlers"><span class="std std-ref">Rewrite handlers</span></a>.</p>
</div>
<div class="section" id="chinese-language-locales-changed-to-zh-hans-and-zh-hant">
<h6>Chinese language locales changed to <code class="docutils literal notranslate"><span class="pre">zh_Hans</span></code> and <code class="docutils literal notranslate"><span class="pre">zh_Hant</span></code><a class="headerlink" href="#chinese-language-locales-changed-to-zh-hans-and-zh-hant" title="Permalink to this headline">¶</a></h6>
<p>The translations for Chinese (Simplified) and Chinese (Traditional) are now available under the locale names <code class="docutils literal notranslate"><span class="pre">zh_Hans</span></code> and <code class="docutils literal notranslate"><span class="pre">zh_Hant</span></code> respectively, rather than <code class="docutils literal notranslate"><span class="pre">zh_CN</span></code> and <code class="docutils literal notranslate"><span class="pre">zh_TW</span></code>. Projects that currently use the old names for the <code class="docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code> setting may need to update the settings file to use the new names.</p>
</div>
</div>
</div>
<span id="document-releases/2.4"></span><div class="section" id="wagtail-2-4-release-notes">
<h4>Wagtail 2.4 release notes<a class="headerlink" href="#wagtail-2-4-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="new-welcome-to-your-wagtail-site-starter-page">
<h6>New “Welcome to your Wagtail site” Starter Page<a class="headerlink" href="#new-welcome-to-your-wagtail-site-starter-page" title="Permalink to this headline">¶</a></h6>
<p>When using the <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">start</span></code> command to make a new site, users will now be greeted with a proper starter page. Thanks to Timothy Allen and Scott Cranfill for pulling this off!</p>
<blockquote>
<div><div class="figure">
<img alt="Wagtail welcome message" src="_images/tutorial_11.png" />
</div>
</div></blockquote>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added support for Python 3.7 (Matt Westcott)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">max_count</span></code> option on page models to limit the number of pages of a particular type that can be created (Dan Braghis)</li>
<li>Document and image choosers now show the document / image’s collection (Alejandro Garza, Janneke Janssen)</li>
<li>New <code class="docutils literal notranslate"><span class="pre">image_url</span></code> template tag allows to generate dynamic image URLs, so image renditions are being created outside the main request which improves performance. Requires extra configuration, see <a class="reference internal" href="index.html#document-advanced_topics/images/image_serve_view"><span class="doc">Dynamic image serve view</span></a> (Yannick Chabbert, Dan Braghis).</li>
<li>Added ability to run individual tests through tox (Benjamin Bach)</li>
<li>Collection listings are now ordered by name (Seb Brown)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">file_hash</span></code> field to documents (Karl Hobley, Dan Braghis)</li>
<li>Added last login to the user overview (Noah B Johnson)</li>
<li>Changed design of image editing page (Janneke Janssen, Ben Enright)</li>
<li>Added Slovak character map for JavaScript slug generation (Andy Chosak)</li>
<li>Make documentation links on welcome page work for prereleases (Matt Westcott)</li>
<li>Allow overridden <code class="docutils literal notranslate"><span class="pre">copy()</span></code> methods in <code class="docutils literal notranslate"><span class="pre">Page</span></code> subclasses to be called from the page copy view (Robert Rollins)</li>
<li>Users without a preferred language set on their profile now use language selected by Django’s <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> (Benjamin Bach)</li>
<li>Added hooks to customise the actions menu on the page create/edit views (Matt Westcott)</li>
<li>Cleanup: Use <code class="docutils literal notranslate"><span class="pre">functools.partial()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">django.utils.functional.curry()</span></code> (Sergey Fedoseev)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">before_move_page</span></code> and <code class="docutils literal notranslate"><span class="pre">after_move_page</span></code> hooks (Maylon Pedroso)</li>
<li>Bulk deletion button for snippets is now hidden until items are selected (Karl Hobley)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Query objects returned from <code class="docutils literal notranslate"><span class="pre">PageQuerySet.type_q</span></code> can now be merged with <code class="docutils literal notranslate"><span class="pre">|</span></code> (Brady Moe)</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">rel=&quot;noopener</span> <span class="pre">noreferrer&quot;</span></code> to target blank links (Anselm Bradford)</li>
<li>Additional fields on custom document models now show on the multiple document upload view (Robert Rollins, Sergey Fedoseev)</li>
<li>Help text does not overflow when using a combination of BooleanField and FieldPanel in page model (Dzianis Sheka)</li>
<li>Document chooser now displays more useful help message when there are no documents in Wagtail document library (gmmoraes, Stas Rudakou)</li>
<li>Allow custom logos of any height in the admin menu (Meteor0id)</li>
<li>Allow nav menu to take up all available space instead of scrolling (Meteor0id)</li>
<li>Users without the edit permission no longer see “Edit” links in list of pages waiting for moderation (Justin Focus, Fedor Selitsky)</li>
<li>Redirects now return 404 when destination is unspecified or a page with no site (Hillary Jeffrey)</li>
<li>Refactor all breakpoint definitions, removing style overlaps (Janneke Janssen)</li>
<li>Updated draftjs_exporter to 2.1.5 to fix bug in handling adjacent entities (Thibaud Colas)</li>
<li>Page titles consisting only of stopwords now generate a non-empty default slug (Andy Chosak, Janneke Janssen)</li>
<li>Sitemap generator now allows passing a sitemap instance in the URL configuration (Mitchel Cabuloy, Dan Braghis)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="removed-support-for-django-1-11">
<h6>Removed support for Django 1.11<a class="headerlink" href="#removed-support-for-django-1-11" title="Permalink to this headline">¶</a></h6>
<p>Django 1.11 is no longer supported in this release; please upgrade your project to Django 2.0 or 2.1 before upgrading to Wagtail 2.4.</p>
</div>
<div class="section" id="custom-image-model-migrations-created-on-wagtail-1-8-may-fail">
<h6>Custom image model migrations created on Wagtail &lt;1.8 may fail<a class="headerlink" href="#custom-image-model-migrations-created-on-wagtail-1-8-may-fail" title="Permalink to this headline">¶</a></h6>
<p>Projects with a custom image model (see <a class="reference internal" href="index.html#custom-image-model"><span class="std std-ref">Custom image models</span></a>) created on Wagtail 1.7 or earlier are likely to have one or more migrations that refer to the (now-deleted) <code class="docutils literal notranslate"><span class="pre">wagtailimages.Filter</span></code> model. In Wagtail 2.4, the migrations that defined this model have been squashed, which may result in the error <code class="docutils literal notranslate"><span class="pre">ValueError:</span> <span class="pre">Related</span> <span class="pre">model</span> <span class="pre">'wagtailimages.Filter'</span> <span class="pre">cannot</span> <span class="pre">be</span> <span class="pre">resolved</span></code> when bringing up a new instance of the database. To rectify this, check your project’s migrations for <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> references to <code class="docutils literal notranslate"><span class="pre">wagtailimages.Filter</span></code>, and change them to <code class="docutils literal notranslate"><span class="pre">IntegerField</span></code> definitions. For example, the line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">django</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">deletion</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s1">&#39;wagtailimages.Filter&#39;</span><span class="p">)),</span>
</pre></div>
</div>
<p>should become:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-releases/2.3"></span><div class="section" id="wagtail-2-3-release-notes">
<h4>Wagtail 2.3 release notes<a class="headerlink" href="#wagtail-2-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<p>Wagtail 2.3 is designated a Long Term Support (LTS) release. Long Term Support releases will continue to receive maintenance updates as necessary to address security and data-loss related issues, up until the next LTS release (typically a period of 8 months).</p>
<p>Note that Wagtail 2.3 will be the last release branch to support Django 1.11.</p>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="added-django-2-1-support">
<h6>Added Django 2.1 support<a class="headerlink" href="#added-django-2-1-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail is now compatible with Django 2.1.  Compatibility fixes were contributed by Ryan Verner and Matt Westcott.</p>
</div>
<div class="section" id="improved-colour-contrast">
<h6>Improved colour contrast<a class="headerlink" href="#improved-colour-contrast" title="Permalink to this headline">¶</a></h6>
<p>Colour contrast within the admin interface has been improved, and now complies with WCAG 2 level AA. This was completed by Coen van der Kamp and Naomi Morduch Toubman based on earlier work from Edd Baldry, Naa Marteki Reed and Ben Enright.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added ‘scale’ image filter (Oliver Wilkerson)</li>
<li>Added meta tag to prevent search engines from indexing admin pages (Karl Hobley)</li>
<li>EmbedBlock now validates against recognised embed providers on save (Bertrand Bordage)</li>
<li>Made cache control headers on Wagtail admin consistent with Django admin (Tomasz Knapik)</li>
<li>Notification emails now include an “Auto-Submitted: auto-generated” header (Dan Braghis)</li>
<li>Image chooser panels now show alt text as title (Samir Shah)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">download_url</span></code> field to images in the API (Michael Harrison)</li>
<li>Dummy requests for preview now preserve the HTTP Authorization header (Ben Dickinson)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Respect next param on login (Loic Teixeira)</li>
<li>InlinePanel now handles relations that specify a related_query_name (Aram Dulyan)</li>
<li>before_delete_page / after_delete_page hooks now run within the same database transaction as the page deletion (Tomasz Knapik)</li>
<li>Seek to the beginning of image files when uploading, to restore compatibility with django-storages Google Cloud and Azure backends (Mikalai Radchuk)</li>
<li>Snippet chooser modal no longer fails on snippet models with UUID primary keys (Sævar Öfjörð Magnússon)</li>
<li>Restored localisation in date/time pickers (David Moore, Thibaud Colas)</li>
<li>Tag input field no longer treats ‘б’ on Russian keyboards as a comma (Michael Borisov)</li>
<li>Disabled autocomplete dropdowns on date/time chooser fields (Janneke Janssen)</li>
<li>Split up <code class="docutils literal notranslate"><span class="pre">wagtail.admin.forms</span></code> to make it less prone to circular imports (Matt Westcott)</li>
<li>Disable linking to root page in rich text, making the page non-functional (Matt Westcott)</li>
<li>Pages should be editable and save-able even if there are broken page or document links in rich text (Matt Westcott)</li>
<li>Avoid redundant round-trips of JSON StreamField data on save, improving performance and preventing consistency issues on fixture loading (Andy Chosak, Matt Westcott)</li>
<li>Users are not logged out when changing their own password through the Users area (Matt Westcott)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="wagtail-admin-forms-reorganised">
<h6><code class="docutils literal notranslate"><span class="pre">wagtail.admin.forms</span></code> reorganised<a class="headerlink" href="#wagtail-admin-forms-reorganised" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">wagtail.admin.forms</span></code> module has been split up into submodules to make it less prone to producing circular imports, particularly when a custom user model is in use. The following (undocumented) definitions have now been moved to new locations:</p>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Definition</th>
<th class="head">New location</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>LoginForm</td>
<td>wagtail.admin.forms.auth</td>
</tr>
<tr class="row-odd"><td>PasswordResetForm</td>
<td>wagtail.admin.forms.auth</td>
</tr>
<tr class="row-even"><td>URLOrAbsolutePathValidator</td>
<td>wagtail.admin.forms.choosers</td>
</tr>
<tr class="row-odd"><td>URLOrAbsolutePathField</td>
<td>wagtail.admin.forms.choosers</td>
</tr>
<tr class="row-even"><td>ExternalLinkChooserForm</td>
<td>wagtail.admin.forms.choosers</td>
</tr>
<tr class="row-odd"><td>EmailLinkChooserForm</td>
<td>wagtail.admin.forms.choosers</td>
</tr>
<tr class="row-even"><td>CollectionViewRestrictionForm</td>
<td>wagtail.admin.forms.collections</td>
</tr>
<tr class="row-odd"><td>CollectionForm</td>
<td>wagtail.admin.forms.collections</td>
</tr>
<tr class="row-even"><td>BaseCollectionMemberForm</td>
<td>wagtail.admin.forms.collections</td>
</tr>
<tr class="row-odd"><td>BaseGroupCollectionMemberPermissionFormSet</td>
<td>wagtail.admin.forms.collections</td>
</tr>
<tr class="row-even"><td>collection_member_permission_formset_factory</td>
<td>wagtail.admin.forms.collections</td>
</tr>
<tr class="row-odd"><td>CopyForm</td>
<td>wagtail.admin.forms.pages</td>
</tr>
<tr class="row-even"><td>PageViewRestrictionForm</td>
<td>wagtail.admin.forms.pages</td>
</tr>
<tr class="row-odd"><td>SearchForm</td>
<td>wagtail.admin.forms.search</td>
</tr>
<tr class="row-even"><td>BaseViewRestrictionForm</td>
<td>wagtail.admin.forms.view_restrictions</td>
</tr>
</tbody>
</table>
<p>The following definitions remain in <code class="docutils literal notranslate"><span class="pre">wagtail.admin.forms</span></code>: <code class="docutils literal notranslate"><span class="pre">FORM_FIELD_OVERRIDES</span></code>, <code class="docutils literal notranslate"><span class="pre">DIRECT_FORM_FIELD_OVERRIDES</span></code>, <code class="docutils literal notranslate"><span class="pre">formfield_for_dbfield</span></code>, <code class="docutils literal notranslate"><span class="pre">WagtailAdminModelFormMetaclass</span></code>, <code class="docutils literal notranslate"><span class="pre">WagtailAdminModelForm</span></code> and <code class="docutils literal notranslate"><span class="pre">WagtailAdminPageForm</span></code>.</p>
</div>
</div>
</div>
<span id="document-releases/2.2.2"></span><div class="section" id="wagtail-2-2-2-release-notes">
<h4>Wagtail 2.2.2 release notes<a class="headerlink" href="#wagtail-2-2-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Seek to the beginning of image files when uploading, to restore compatibility with django-storages Google Cloud and Azure backends (Mikalai Radchuk)</li>
<li>Respect next param on login (Loic Teixeira)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.2.1"></span><div class="section" id="wagtail-2-2-1-release-notes">
<h4>Wagtail 2.2.1 release notes<a class="headerlink" href="#wagtail-2-2-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Pin Beautiful Soup to 4.6.0 due to further regressions in formatting empty elements (Matt Westcott)</li>
<li>Prevent AppRegistryNotReady error when wagtail.contrib.sitemaps is in INSTALLED_APPS (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.2"></span><div class="section" id="wagtail-2-2-release-notes">
<h4>Wagtail 2.2 release notes<a class="headerlink" href="#wagtail-2-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="faceted-search">
<h6>Faceted search<a class="headerlink" href="#faceted-search" title="Permalink to this headline">¶</a></h6>
<p>Wagtail search now includes support for facets, allowing you to display search result counts broken down by a particular field value. For further details, see <a class="reference internal" href="index.html#wagtailsearch-faceted-search"><span class="std std-ref">Faceted search</span></a>. This feature was developed by Karl Hobley.</p>
</div>
<div class="section" id="improved-admin-page-search">
<h6>Improved admin page search<a class="headerlink" href="#improved-admin-page-search" title="Permalink to this headline">¶</a></h6>
<p>The page search in the Wagtail admin now supports filtering by page type and ordering search results by title, creation date and status. This feature was developed by Karl Hobley.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added another valid AudioBoom oEmbed pattern (Bertrand Bordage)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">annotate_score</span></code> support to PostgreSQL search backend (Bertrand Bordage)</li>
<li>Pillow’s image optimisation is now applied when saving PNG images (Dmitry Vasilev)</li>
<li>JS / CSS media files can now be associated with Draftail feature definitions (Matt Westcott)</li>
<li>The <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">slugurl</span> <span class="pre">%}</span></code> template tag is now site-aware (Samir Shah)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">file_size</span></code> field to documents (Karl Hobley)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">file_hash</span></code> field to images (Karl Hobley)</li>
<li>Update documentation (configuring Django for Wagtail) to contain all current settings options (Matt Westcott, LB (Ben Johnston))</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">defer</span></code> flag to <code class="docutils literal notranslate"><span class="pre">PageQuerySet.specific</span></code> (Karl Hobley)</li>
<li>Snippets can now be deleted from the listing view (LB (Ben Johnston))</li>
<li>Increased max length of redirect URL field to 255 (Michael Harrison)</li>
<li>Added documentation for new JS/CSS media files association with Draftail feature definitions (Ed Henderson)</li>
<li>Added accessible colour contrast guidelines to the style guide (Catherine Farman)</li>
<li>Admin modal views no longer rely on JavaScript <code class="docutils literal notranslate"><span class="pre">eval()</span></code>, for better CSP compliance (Matt Westcott)</li>
<li>Update editor guide for embeds and documents in rich text (Kevin Howbrook)</li>
<li>Improved performance of sitemap generation (Michael van Tellingen, Bertrand Bordage)</li>
<li>Added an internal API for autocomplete (Karl Hobley)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Handle all exceptions from <code class="docutils literal notranslate"><span class="pre">Image.get_file_size</span></code> (Andrew Plummer)</li>
<li>Fix display of breadcrumbs in ModelAdmin (LB (Ben Johnston))</li>
<li>Remove duplicate border radius of avatars (Benjamin Thurm)</li>
<li>Site.get_site_root_paths() preferring other sites over the default when some sites share the same root_page (Andy Babic)</li>
<li>Pages with missing model definitions no longer crash the API (Abdulmalik Abdulwahab)</li>
<li>Rich text image chooser no longer skips format selection after a validation error (Matt Westcott)</li>
<li>Null characters in URLs no longer crash the redirect middleware on PostgreSQL (Andrew Crewdson, Matt Westcott)</li>
<li>Permission checks no longer prevent a non-live page from being unscheduled (Abdulmalik Abdulwahab)</li>
<li>Copy-paste between Draftail editors now preserves all formatting/content (Thibaud Colas)</li>
<li>Fix alignment of checkboxes and radio buttons on Firefox (Matt Westcott)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="javascript-templates-in-modal-workflows-are-deprecated">
<h6>JavaScript templates in modal workflows are deprecated<a class="headerlink" href="#javascript-templates-in-modal-workflows-are-deprecated" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">wagtail.admin.modal_workflow</span></code> module (used internally by Wagtail to handle modal popup interfaces such as the page chooser) has been updated to avoid returning JavaScript code as part of HTTP responses. User code that relies on this functionality can be updated as follows:</p>
<ul class="simple">
<li>Eliminate template tags from the .js template. Any dynamic data needed by the template can instead be passed in a dict to <code class="docutils literal notranslate"><span class="pre">render_modal_workflow</span></code>, as a keyword argument <code class="docutils literal notranslate"><span class="pre">json_data</span></code>; this data will then be available as the second parameter of the JavaScript function.</li>
<li>At the point where you call the <code class="docutils literal notranslate"><span class="pre">ModalWorkflow</span></code> constructor, add an <code class="docutils literal notranslate"><span class="pre">onload</span></code> option - a dictionary of functions to be called on loading each step of the workflow. Move the code from the .js template into this dictionary. Then, on the call to <code class="docutils literal notranslate"><span class="pre">render_modal_workflow</span></code>, rather than passing the .js template name (which should now be replaced by <code class="docutils literal notranslate"><span class="pre">None</span></code>), pass a <code class="docutils literal notranslate"><span class="pre">step</span></code> item in the <code class="docutils literal notranslate"><span class="pre">json_data</span></code> dictionary to indicate the <code class="docutils literal notranslate"><span class="pre">onload</span></code> function to be called.</li>
</ul>
<p>Additionally, if your code calls <code class="docutils literal notranslate"><span class="pre">loadResponseText</span></code> as part of a jQuery AJAX callback, this should now be passed all three arguments from the callback (the response data, status string and XMLHttpRequest object).</p>
</div>
<div class="section" id="page-get-sitemap-urls-now-accepts-an-optional-request-keyword-argument">
<h6><code class="docutils literal notranslate"><span class="pre">Page.get_sitemap_urls()</span></code> now accepts an optional <code class="docutils literal notranslate"><span class="pre">request</span></code> keyword argument<a class="headerlink" href="#page-get-sitemap-urls-now-accepts-an-optional-request-keyword-argument" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">Page.get_sitemap_urls()</span></code> method used by the <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.sitemaps</span></code> module has been updated to receive an optional <code class="docutils literal notranslate"><span class="pre">request</span></code> keyword argument. If you have overridden this method in your page models, you will need to update the method signature to accept this argument (and pass it on when calling <code class="docutils literal notranslate"><span class="pre">super</span></code>, if applicable).</p>
</div>
</div>
</div>
<span id="document-releases/2.1.3"></span><div class="section" id="wagtail-2-1-3-release-notes">
<h4>Wagtail 2.1.3 release notes<a class="headerlink" href="#wagtail-2-1-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Pin Beautiful Soup to 4.6.0 due to further regressions in formatting empty elements (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.1.2"></span><div class="section" id="wagtail-2-1-2-release-notes">
<h4>Wagtail 2.1.2 release notes<a class="headerlink" href="#wagtail-2-1-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Bundle the l18n package to avoid installation issues on systems with a non-Unicode locale (Matt Westcott)</li>
<li>Mark Beautiful Soup 4.6.1 as incompatible due to bug in formatting empty elements (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.1.1"></span><div class="section" id="wagtail-2-1-1-release-notes">
<h4>Wagtail 2.1.1 release notes<a class="headerlink" href="#wagtail-2-1-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Fix <code class="docutils literal notranslate"><span class="pre">Site.get_site_root_paths()</span></code> preferring other sites over the default when some sites share the same root_page (Andy Babic)</li>
<li>Rich text image chooser no longer skips format selection after a validation error (Matt Westcott)</li>
<li>Null characters in URLs no longer crash the redirect middleware on PostgreSQL (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.1"></span><div class="section" id="wagtail-2-1-release-notes">
<h4>Wagtail 2.1 release notes<a class="headerlink" href="#wagtail-2-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="new-helppanel">
<h6>New <code class="docutils literal notranslate"><span class="pre">HelpPanel</span></code><a class="headerlink" href="#new-helppanel" title="Permalink to this headline">¶</a></h6>
<p>A new panel type <code class="docutils literal notranslate"><span class="pre">HelpPanel</span></code> allows to easily add HTML within an edit form.
This new feature was developed by Kevin Chung.</p>
</div>
<div class="section" id="profile-picture-upload">
<h6>Profile picture upload<a class="headerlink" href="#profile-picture-upload" title="Permalink to this headline">¶</a></h6>
<p>Users can now upload profile pictures directly through the Account Settings menu, rather than using Gravatar. Gravatar is still used as a fallback if no profile picture has been uploaded directly; a new setting <a class="reference internal" href="index.html#wagtail-gravatar-provider-url"><span class="std std-ref">WAGTAIL_GRAVATAR_PROVIDER_URL</span></a> has been added to specify an alternative provider, or disable the use of external avatars completely. This feature was developed by Daniel Chimeno, Pierre Geier and Matt Westcott.</p>
</div>
<div class="section" id="api-lookup-by-page-path">
<h6>API lookup by page path<a class="headerlink" href="#api-lookup-by-page-path" title="Permalink to this headline">¶</a></h6>
<p>The API now includes an endpoint for finding pages by path; see <a class="reference internal" href="index.html#apiv2-finding-pages-by-path"><span class="std std-ref">Finding pages by HTML path</span></a>. This feature was developed by Karl Hobley.</p>
</div>
<div class="section" id="user-time-zone-setting">
<h6>User time zone setting<a class="headerlink" href="#user-time-zone-setting" title="Permalink to this headline">¶</a></h6>
<p>Users can now set their current time zone through the Account Settings menu, which will then be reflected in date / time fields throughout the admin (such as go-live / expiry dates). The list of available time zones can be configured via the <a class="reference internal" href="index.html#wagtail-user-time-zones"><span class="std std-ref">WAGTAIL_USER_TIME_ZONES</span></a> setting. This feature was developed by David Moore.</p>
</div>
<div class="section" id="elasticsearch-6-support">
<h6>Elasticsearch 6 support<a class="headerlink" href="#elasticsearch-6-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now supports Elasticsearch 6. See <a class="reference internal" href="index.html#wagtailsearch-backends-elasticsearch"><span class="std std-ref">Elasticsearch Backend</span></a> for configuration details. This feature was developed by Karl Hobley.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Persist tab hash in URL to allow direct navigation to tabs in the admin interface (Ben Weatherman)</li>
<li>Animate the chevron icon when opening sub-menus in the admin (Carlo Ascani)</li>
<li>Look through the target link and target page slug (in addition to the old slug) when searching for redirects in the admin (Michael Harrison)</li>
<li>Remove support for IE6 to IE9 from project template (Samir Shah)</li>
<li>Remove outdated X-UA-Compatible meta from admin template  (Thibaud Colas)</li>
<li>Add JavaScript source maps in production build for packaged Wagtail (Thibaud Colas)</li>
<li>Removed <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements from Wagtail API (Kim Chee Leong)</li>
<li>Update <cite>jquery-datetimepicker</cite> dependency to make Wagtail more CSP-friendly (<cite>unsafe-eval</cite>) (Pomax)</li>
<li>Added error notification when running the <code class="docutils literal notranslate"><span class="pre">wagtail</span></code> command on Python &lt;3.4 (Matt Westcott)</li>
<li><code class="docutils literal notranslate"><span class="pre">update_index</span></code> management command now accepts a <code class="docutils literal notranslate"><span class="pre">--chunk_size</span></code> option to determine the number of items to load at once (Dave Bell)</li>
<li>Added hook <cite>register_account_menu_item</cite> to add new account preference items (Michael van Tellingen)</li>
<li>Added change email functionality from the account settings (Alejandro Garza, Alexs Mathilda)</li>
<li>Add request parameter to edit handlers (Rajeev J Sebastian)</li>
<li>ImageChooser now sets a default title based on filename (Coen van der Kamp)</li>
<li>Added error handling to the Draftail editor (Thibaud Colas)</li>
<li>Add new <cite>wagtail_icon</cite> template tag to facilitate making admin icons accessible (Sander Tuit)</li>
<li>Set <cite>ALLOWED_HOSTS</cite> in the project template to allow any host in development (Tom Dyson)</li>
<li>Expose reusable client-side code to build Draftail extensions (Thibaud Colas)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">WAGTAILFRONTENDCACHE_LANGUAGES</span></code> setting to specify the languages whose URLs are to be purged when using <code class="docutils literal notranslate"><span class="pre">i18n_patterns</span></code> (PyMan Claudio Marinozzi)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">extra_footer_actions</span></code> template blocks for customising the add/edit page views (Arthur Holzner)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Status button on ‘edit page’ now links to the correct URL when live and draft slug differ (LB (Ben Johnston))</li>
<li>Image title text in the gallery and in the chooser now wraps for long filenames (LB (Ben Johnston), Luiz Boaretto)</li>
<li>Move image editor action buttons to the bottom of the form on mobile (Julian Gallo)</li>
<li>StreamField icons are now correctly sorted into groups on the ‘append’ menu (Tim Heap)</li>
<li>Draftail now supports features specified via the <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_RICH_TEXT_EDITORS</span></code> setting (Todd Dembrey)</li>
<li>Password reset form no longer indicates whether the email is recognised, as per standard Django behaviour (Bertrand Bordage)</li>
<li><code class="docutils literal notranslate"><span class="pre">UserAttributeSimilarityValidator</span></code> is now correctly enforced on user creation / editing forms (Tim Heap)</li>
<li>Focal area removal not working in IE11 and MS Edge (Thibaud Colas)</li>
<li>Rewrite password change feedback message to be more user-friendly (Casper Timmers)</li>
<li>Correct dropdown arrow styling in Firefox, IE11 (Janneke Janssen, Alexs Mathilda)</li>
<li>Password reset no indicates specific validation errors on certain password restrictions (Lucas Moeskops)</li>
<li>Confirmation page on page deletion now respects custom <code class="docutils literal notranslate"><span class="pre">get_admin_display_title</span></code> methods (Kim Chee Leong)</li>
<li>Adding external link with selected text now includes text in link chooser (Tony Yates, Thibaud Colas, Alexs Mathilda)</li>
<li>Editing setting object with no site configured no longer crashes (Harm Zeinstra)</li>
<li>Creating a new object with inlines while mandatory fields are empty no longer crashes (Bertrand Bordage)</li>
<li>Localization of image and apps verbose names</li>
<li>Draftail editor no longer crashes after deleting image/embed using DEL key (Thibaud Colas)</li>
<li>Breadcrumb navigation now respects custom <code class="docutils literal notranslate"><span class="pre">get_admin_display_title</span></code> methods (Arthur Holzner, Wietze Helmantel, Matt Westcott)</li>
<li>Inconsistent order of heading features when adding h1, h5 or h6 as default feature for Hallo RichText editor (Loic Teixeira)</li>
<li>Add invalid password reset link error message (Coen van der Kamp)</li>
<li>Bypass select/prefetch related optimisation on <code class="docutils literal notranslate"><span class="pre">update_index</span></code> for <code class="docutils literal notranslate"><span class="pre">ParentalManyToManyField</span></code> to fix crash (Tim Kamanin)</li>
<li>‘Add user’ is now rendered as a button due to the use of quotes within translations (Benoît Vogel)</li>
<li>Menu icon no longer overlaps with title in Modeladmin on mobile (Coen van der Kamp)</li>
<li>Background color overflow within the Wagtail documentation (Sergey Fedoseev)</li>
<li>Page count on homepage summary panel now takes account of user permissions (Andy Chosak)</li>
<li>Explorer view now prevents navigating outside of the common ancestor of the user’s permissions (Andy Chosak)</li>
<li>Generate URL for the current site when multiple sites share the same root page (Codie Roelf)</li>
<li>Restored ability to use non-model fields with FieldPanel (Matt Westcott, LB (Ben Johnston))</li>
<li>Stop revision comparison view from crashing when non-model FieldPanels are in use (LB (Ben Johnston))</li>
<li>Ordering in the page explorer now respects custom <code class="docutils literal notranslate"><span class="pre">get_admin_display_title</span></code> methods when sorting &lt;100 pages (Matt Westcott)</li>
<li>Use index-specific Elasticsearch endpoints for bulk insertion, for compatibility with providers that lock down the root endpoint (Karl Hobley)</li>
<li>Fix usage URL on the document edit page (Jérôme Lebleu)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="image-format-image-to-html-method-has-been-updated">
<h6>Image format <code class="docutils literal notranslate"><span class="pre">image_to_html</span></code> method has been updated<a class="headerlink" href="#image-format-image-to-html-method-has-been-updated" title="Permalink to this headline">¶</a></h6>
<p>The internal API for rich text image format objects (see <a class="reference internal" href="index.html#rich-text-image-formats"><span class="std std-ref">Image Formats in the Rich Text Editor</span></a>) has been updated; the <code class="docutils literal notranslate"><span class="pre">Format.image_to_html</span></code> method now receives the <code class="docutils literal notranslate"><span class="pre">extra_attributes</span></code> keyword argument as a dictionary of attributes, rather than a string. If you have defined any custom format objects that override this method, these will need to be updated.</p>
</div>
</div>
</div>
<span id="document-releases/2.0.2"></span><div class="section" id="wagtail-2-0-2-release-notes">
<h4>Wagtail 2.0.2 release notes<a class="headerlink" href="#wagtail-2-0-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Restored ability to use non-model fields with FieldPanel (Matt Westcott, LB (Ben Johnston))</li>
<li>Fix usage URL on the document edit page (Jérôme Lebleu)</li>
<li>Pin Beautiful Soup to 4.6.0 due to further regressions in formatting empty elements (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.0.1"></span><div class="section" id="wagtail-2-0-1-release-notes">
<h4>Wagtail 2.0.1 release notes<a class="headerlink" href="#wagtail-2-0-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Added error notification when running the <code class="docutils literal notranslate"><span class="pre">wagtail</span></code> command on Python &lt;3.4 (Matt Westcott)</li>
<li>Added error handling to the Draftail editor (Thibaud Colas)</li>
</ul>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Draftail now supports features specified via the <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_RICH_TEXT_EDITORS</span></code> setting (Todd Dembrey)</li>
<li>Password reset form no longer indicates whether the email is recognised, as per standard Django behaviour (Bertrand Bordage)</li>
<li><code class="docutils literal notranslate"><span class="pre">UserAttributeSimilarityValidator</span></code> is now correctly enforced on user creation / editing forms (Tim Heap)</li>
<li>Editing setting object with no site configured no longer crashes (Harm Zeinstra)</li>
<li>Creating a new object with inlines while mandatory fields are empty no longer crashes (Bertrand Bordage)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/2.0"></span><div class="section" id="wagtail-2-0-release-notes">
<h4>Wagtail 2.0 release notes<a class="headerlink" href="#wagtail-2-0-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="added-django-2-0-support">
<h6>Added Django 2.0 support<a class="headerlink" href="#added-django-2-0-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail is now compatible with Django 2.0. Compatibility fixes were contributed by Matt Westcott, Karl Hobley, LB (Ben Johnston) and Mads Jensen.</p>
</div>
<div class="section" id="new-rich-text-editor">
<h6>New rich text editor<a class="headerlink" href="#new-rich-text-editor" title="Permalink to this headline">¶</a></h6>
<p>Wagtail’s rich text editor has now been replaced with <a class="reference external" href="https://github.com/springload/draftail">Draftail</a>, a new editor based on <a class="reference external" href="https://draftjs.org/">Draft.js</a>, fixing numerous bugs and providing an improved editing experience, better support for current browsers, and more consistent HTML output. This feature was developed by Thibaud Colas, Loïc Teixeira and Matt Westcott.</p>
</div>
<div class="section" id="reorganised-modules">
<h6>Reorganised modules<a class="headerlink" href="#reorganised-modules" title="Permalink to this headline">¶</a></h6>
<p>The modules that make up Wagtail have been renamed and reorganised, to avoid the repetition in names like <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailcore.models</span></code> (originally an artefact of app naming limitations in Django 1.6) and to improve consistency. While this will require some up-front work to upgrade existing Wagtail sites, we believe that this will be a long-term improvement to the developer experience, improving readability of code and reducing errors. This change was implemented by Karl Hobley and Matt Westcott.</p>
</div>
<div class="section" id="scheduled-page-revisions">
<h6>Scheduled page revisions<a class="headerlink" href="#scheduled-page-revisions" title="Permalink to this headline">¶</a></h6>
<p>The behaviour of scheduled publishing has been revised so that pages are no longer unpublished at the point of setting a future go-live date, making it possible to schedule updates to an existing published page. This feature was developed by Patrick Woods.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Moved Wagtail API v1 implementation (<code class="docutils literal notranslate"><span class="pre">wagtail.contrib.api</span></code>) to an <a class="reference external" href="https://github.com/wagtail/wagtailapi_legacy">external app</a> (Karl Hobley)</li>
<li>The page chooser now searches all fields of a page, instead of just the title (Bertrand Bordage)</li>
<li>Implement ordering by date in form submission view (LB (Ben Johnston))</li>
<li>Elasticsearch scroll API is now used when fetching more than 100 search results (Karl Hobley)</li>
<li>Added hidden field to the form builder (Ross Crawford-d’Heureuse)</li>
<li>Usage count now shows on delete confirmation page when WAGTAIL_USAGE_COUNT_ENABLED is active (Kees Hink)</li>
<li>Added usage count to snippets (Kees Hink)</li>
<li>Moved usage count to the sidebar on the edit page (Kees Hink)</li>
<li>Explorer menu now reflects customisations to the page listing made via the <cite>construct_explorer_page_queryset</cite> hook and <cite>ModelAdmin.exclude_from_explorer</cite> property (Tim Heap)</li>
<li>“Choose another image” button changed to “Change image” to avoid ambiguity (Edd Baldry)</li>
<li>Added hooks <code class="docutils literal notranslate"><span class="pre">before_create_user</span></code>, <code class="docutils literal notranslate"><span class="pre">after_create_user</span></code>, <code class="docutils literal notranslate"><span class="pre">before_delete_user</span></code>, <code class="docutils literal notranslate"><span class="pre">after_delete_user</span></code>, <code class="docutils literal notranslate"><span class="pre">before_edit_user</span></code>, <code class="docutils literal notranslate"><span class="pre">after_edit_user</span></code> (Jon Carmack)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">exclude_fields_in_copy</span></code> property to Page to define fields that should not be included on page copy (LB (Ben Johnston))</li>
<li>Improved error message on incorrect <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag syntax (LB (Ben Johnston))</li>
<li>Optimized preview data storage (Bertrand Bordage)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">render_landing_page</span></code> method to <code class="docutils literal notranslate"><span class="pre">AbstractForm</span></code> to be easily overridden and pass <code class="docutils literal notranslate"><span class="pre">form_submission</span></code> to landing page context (Stein Strindhaug)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">heading</span></code> kwarg to <code class="docutils literal notranslate"><span class="pre">InlinePanel</span></code> to allow heading to be set independently of button label (Adrian Turjak)</li>
<li>The value type returned from a <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> can now be customised. See <a class="reference internal" href="index.html#custom-value-class-for-structblock"><span class="std std-ref">Additional methods and properties on StructBlock values</span></a> (LB (Ben Johnston))</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">bgcolor</span></code> image operation (Karl Hobley)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_USER_LOGIN_FORM</span></code> setting for overriding the admin login form (Mike Dingjan)</li>
<li>Snippets now support custom primary keys (Sævar Öfjörð Magnússon)</li>
<li>Upgraded jQuery to version 3.2.1 (Janneke Janssen)</li>
<li>Update autoprefixer configuration to better match browser support targets (Janneke Janssen)</li>
<li>Update React and related dependencies to latest versions (Janneke Janssen, Hugo van den Berg)</li>
<li>Remove Hallo editor <code class="docutils literal notranslate"><span class="pre">.richtext</span></code> CSS class in favour of more explicit extension points (Thibaud Colas)</li>
<li>Updated documentation styling (LB (Ben Johnston))</li>
<li>Rich text fields now take feature lists into account when whitelisting HTML elements (Matt Westcott)</li>
<li>FormPage lists and Form submission lists in admin now use class based views for easy overriding (Johan Arensman)</li>
<li>Form submission csv exports now have the export date in the filename and can be customized (Johan Arensman)</li>
<li>FormBuilder class now uses bound methods for field generation, adding custom fields is now easier and documented (LB (Ben Johnston))</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_NOTIFICATION_INCLUDE_SUPERUSERS</span></code> setting to determine whether superusers are included in moderation email notifications (Bruno Alla)</li>
<li>Added a basic Dockerfile to the project template (Tom Dyson)</li>
<li>StreamField blocks now allow custom <code class="docutils literal notranslate"><span class="pre">get_template</span></code> methods for overriding templates in instances (Christopher Bledsoe)</li>
<li>Simplified edit handler API (Florent Osmont, Bertrand Bordage)</li>
<li>Made ‘add/change/delete collection’ permissions configurable from the group edit page (Matt Westcott)</li>
<li>Expose React-related dependencies as global variables for extension in the admin interface (Thibaud Colas)</li>
<li>Added helper functions for constructing form data for use with <code class="docutils literal notranslate"><span class="pre">assertCanCreate</span></code>. See <a class="reference internal" href="index.html#form-data-test-helpers"><span class="std std-ref">Form data helpers</span></a> (Tim Heap, Matt Westcott)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Do not remove stopwords when generating slugs from non-ASCII titles, to avoid issues with incorrect word boundaries (Sævar Öfjörð Magnússon)</li>
<li>The PostgreSQL search backend now preserves ordering of the <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> when searching with <code class="docutils literal notranslate"><span class="pre">order_by_relevance=False</span></code> (Bertrand Bordage)</li>
<li>Using <code class="docutils literal notranslate"><span class="pre">modeladmin_register</span></code> as a decorator no longer replaces the decorated class with <code class="docutils literal notranslate"><span class="pre">None</span></code> (Tim Heap)</li>
<li>Fixed crash in XML sitemap generator when all pages on the site are private (Stein Strindhaug)</li>
<li>The <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">routablepageurl</span> <span class="pre">%}</span></code> template tag no longer generates invalid URLs when the <code class="docutils literal notranslate"><span class="pre">WAGTAIL_APPEND_SLASH</span></code> setting was set to <code class="docutils literal notranslate"><span class="pre">False</span></code> (Venelin Stoykov)</li>
<li>The “View live” button is no longer shown if the page doesn’t have a routable URL (Tim Heap)</li>
<li>API listing views no longer fail when no site records are defined (Karl Hobley)</li>
<li>Fixed rendering of border on dropdown arrow buttons on Chrome (Bertrand Bordage)</li>
<li>Fixed incorrect z-index on userbar causing it to appear behind page content (Stein Strindhaug)</li>
<li>Form submissions pagination no longer looses date filter when changing page (Bertrand Bordage)</li>
<li>PostgreSQL search backend now removes duplicate page instances from the database (Bertrand Bordage)</li>
<li><code class="docutils literal notranslate"><span class="pre">FormSubmissionsPanel</span></code> now recognises custom form submission classes (LB (Ben Johnston))</li>
<li>Prevent the footer and revisions link from unnecessarily collapsing on mobile (Jack Paine)</li>
<li>Empty searches were activated when paginating through images and documents (LB (Ben Johnston))</li>
<li>Summary numbers of pages, images and documents were not responsive when greater than 4 digits (Michael Palmer)</li>
<li>Project template now has password validators enabled by default (Matt Westcott)</li>
<li>Alignment options correctly removed from <code class="docutils literal notranslate"><span class="pre">TableBlock</span></code> context menu (LB (Ben Johnston))</li>
<li>Fix support of <code class="docutils literal notranslate"><span class="pre">ATOMIC_REBUILD</span></code> for projects with Elasticsearch client <code class="docutils literal notranslate"><span class="pre">&gt;=1.7.0</span></code> (Mikalai Radchuk)</li>
<li>Fixed error on Elasticsearch backend when passing a QuerySet as an <code class="docutils literal notranslate"><span class="pre">__in</span></code> filter (Karl Hobley, Matt Westcott)</li>
<li><code class="docutils literal notranslate"><span class="pre">__isnull</span></code> filters no longer fail on Elasticsearch 5 (Karl Hobley)</li>
<li>Prevented intermittent failures on Postgres search backend when a field is defined as both a <code class="docutils literal notranslate"><span class="pre">SearchField</span></code> and a <code class="docutils literal notranslate"><span class="pre">FilterField</span></code> (Matt Westcott)</li>
<li>Alt text of images in rich text is no longer truncated on double-quote characters (Matt Westcott)</li>
<li>Ampersands in embed URLs within rich text are no longer double-escaped (Matt Westcott)</li>
<li>Using RGBA images no longer crashes with Pillow &gt;= 4.2.0 (Karl Hobley)</li>
<li>Copying a page with PostgreSQL search enabled no longer crashes (Bertrand Bordage)</li>
<li>Style of the page unlock button was broken (Bertrand Bordage)</li>
<li>Admin search no longer floods browser history (Bertrand Bordage)</li>
<li>Version comparison now handles custom primary keys on inline models correctly (LB (Ben Johnston))</li>
<li>Fixed error when inserting chooser panels into FieldRowPanel (Florent Osmont, Bertrand Bordage)</li>
<li>Reinstated missing error reporting on image upload (Matt Westcott)</li>
<li>Only load Hallo CSS if Hallo is in use (Thibaud Colas)</li>
<li>Prevent style leak of Wagtail panel icons in widgets using <code class="docutils literal notranslate"><span class="pre">h2</span></code> elements (Thibaud Colas)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="removed-support-for-python-2-7-django-1-8-and-django-1-10">
<h6>Removed support for Python 2.7, Django 1.8 and Django 1.10<a class="headerlink" href="#removed-support-for-python-2-7-django-1-8-and-django-1-10" title="Permalink to this headline">¶</a></h6>
<p>Python 2.7, Django 1.8 and Django 1.10 are no longer supported in this release. You are advised to upgrade your project to Python 3 and Django 1.11 before upgrading to Wagtail 2.0.</p>
</div>
<div class="section" id="added-support-for-django-2-0">
<h6>Added support for Django 2.0<a class="headerlink" href="#added-support-for-django-2-0" title="Permalink to this headline">¶</a></h6>
<p>Before upgrading to Django 2.0, you are advised to review the <a class="reference external" href="https://docs.djangoproject.com/en/stable/releases/2.0/">release notes</a>, especially the <a class="reference external" href="https://docs.djangoproject.com/en/stable/releases/2.0/#backwards-incompatible-changes-in-2-0">backwards incompatible changes</a> and <a class="reference external" href="https://docs.djangoproject.com/en/stable/releases/2.0/#features-removed-in-2-0">removed features</a>.</p>
</div>
<div class="section" id="wagtail-module-path-updates">
<h6>Wagtail module path updates<a class="headerlink" href="#wagtail-module-path-updates" title="Permalink to this headline">¶</a></h6>
<p>Many of the module paths within Wagtail have been reorganised to reduce duplication - for example, <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailcore.models</span></code> is now <code class="docutils literal notranslate"><span class="pre">wagtail.core.models</span></code>. As a result, <code class="docutils literal notranslate"><span class="pre">import</span></code> lines and other references to Wagtail modules will need to be updated when you upgrade to Wagtail 2.0. A new command has been added to assist with this - from the root of your project’s code base:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>wagtail updatemodulepaths --list  <span class="c1"># list the files to be changed without updating them</span>
<span class="gp">$ </span>wagtail updatemodulepaths --diff  <span class="c1"># show the changes to be made, without updating files</span>
<span class="gp">$ </span>wagtail updatemodulepaths  <span class="c1"># actually update the files</span>
</pre></div>
</div>
<p>Or, to run from a different location:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>wagtail updatemodulepaths /path/to/project --list
<span class="gp">$ </span>wagtail updatemodulepaths /path/to/project --diff
<span class="gp">$ </span>wagtail updatemodulepaths /path/to/project
</pre></div>
</div>
<p>For the full list of command line options, enter <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">help</span> <span class="pre">updatemodulepaths</span></code>.</p>
<p>You are advised to take a backup of your project codebase before running this command. The command will perform a search-and-replace over all *.py files for the affected module paths; while this should catch the vast majority of module references, it will not be able to fix instances that do not use the dotted path directly, such as <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">wagtail</span> <span class="pre">import</span> <span class="pre">wagtailcore</span></code>.</p>
<p>The full list of modules to be renamed is as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="32%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old name</th>
<th class="head">New name</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>wagtail.wagtailcore</td>
<td>wagtail.core</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>wagtail.wagtailadmin</td>
<td>wagtail.admin</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>wagtail.wagtaildocs</td>
<td>wagtail.documents</td>
<td>‘documents’ no longer abbreviated</td>
</tr>
<tr class="row-odd"><td>wagtail.wagtailembeds</td>
<td>wagtail.embeds</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>wagtail.wagtailimages</td>
<td>wagtail.images</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>wagtail.wagtailsearch</td>
<td>wagtail.search</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>wagtail.wagtailsites</td>
<td>wagtail.sites</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>wagtail.wagtailsnippets</td>
<td>wagtail.snippets</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>wagtail.wagtailusers</td>
<td>wagtail.users</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>wagtail.wagtailforms</td>
<td>wagtail.contrib.forms</td>
<td>Moved into ‘contrib’</td>
</tr>
<tr class="row-even"><td>wagtail.wagtailredirects</td>
<td>wagtail.contrib.redirects</td>
<td>Moved into ‘contrib’</td>
</tr>
<tr class="row-odd"><td>wagtail.contrib.wagtailapi</td>
<td><em>removed</em></td>
<td>API v1, removed in this release</td>
</tr>
<tr class="row-even"><td>wagtail.contrib.wagtailfrontendcache</td>
<td>wagtail.contrib.frontend_cache</td>
<td>Underscore added</td>
</tr>
<tr class="row-odd"><td>wagtail.contrib.wagtailroutablepage</td>
<td>wagtail.contrib.routable_page</td>
<td>Underscore added</td>
</tr>
<tr class="row-even"><td>wagtail.contrib.wagtailsearchpromotions</td>
<td>wagtail.contrib.search_promotions</td>
<td>Underscore added</td>
</tr>
<tr class="row-odd"><td>wagtail.contrib.wagtailsitemaps</td>
<td>wagtail.contrib.sitemaps</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>wagtail.contrib.wagtailstyleguide</td>
<td>wagtail.contrib.styleguide</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>Places these should be updated include:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">import</span></code> lines</li>
<li>Paths specified in settings, such as <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>, <code class="docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code> and <code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_BACKENDS</span></code></li>
<li>Fields and blocks referenced within migrations, such as <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailcore.fields.StreamField</span></code> and <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailcore.blocks.RichTextBlock</span></code></li>
</ul>
<p>However, note that this only applies to dotted module paths beginning with <code class="docutils literal notranslate"><span class="pre">wagtail.</span></code>. App names that are <em>not</em> part of a dotted module path should be left unchanged - in this case, the <code class="docutils literal notranslate"><span class="pre">wagtail</span></code> prefix is still required to avoid clashing with other apps that might exist in the project with names such as <code class="docutils literal notranslate"><span class="pre">admin</span></code> or <code class="docutils literal notranslate"><span class="pre">images</span></code>. The following should be left unchanged:</p>
<ul class="simple">
<li>Foreign keys specifying a model as <code class="docutils literal notranslate"><span class="pre">'app_name.ModelName'</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">models.ForeignKey('wagtailimages.Image',...)</span></code></li>
<li>App labels used in database table names, content types or permissions</li>
<li>Paths to templates and static files, e.g. when <a class="reference internal" href="index.html#custom-branding"><span class="std std-ref">overriding admin templates with custom branding</span></a></li>
<li>Template tag library names, e.g. <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">wagtailcore_tags</span> <span class="pre">%}</span></code></li>
</ul>
</div>
<div class="section" id="hallo-js-customisations-are-unavailable-on-the-draftail-rich-text-editor">
<h6>Hallo.js customisations are unavailable on the Draftail rich text editor<a class="headerlink" href="#hallo-js-customisations-are-unavailable-on-the-draftail-rich-text-editor" title="Permalink to this headline">¶</a></h6>
<p>The Draftail rich text editor has a substantially different API from Hallo.js, including the use of a non-HTML format for its internal data representation; as a result, functionality added through Hallo.js plugins will be unavailable. If your project is dependent on Hallo.js-specific behaviour, you can revert to the original Hallo-based editor by adding the following to your settings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILADMIN_RICH_TEXT_EDITORS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;WIDGET&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.admin.rich_text.HalloRichTextArea&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="data-format-for-rich-text-fields-in-assertcancreate-tests-has-been-updated">
<h6>Data format for rich text fields in <code class="docutils literal notranslate"><span class="pre">assertCanCreate</span></code> tests has been updated<a class="headerlink" href="#data-format-for-rich-text-fields-in-assertcancreate-tests-has-been-updated" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">assertCanCreate</span></code> test method (see <a class="reference internal" href="index.html#document-advanced_topics/testing"><span class="doc">Testing your Wagtail site</span></a>) requires data to be passed in the same format that the page edit form would submit. The Draftail rich text editor posts this data in a non-HTML format, and so any existing <code class="docutils literal notranslate"><span class="pre">assertCanCreate</span></code> tests involving rich text fields will fail when Draftail is in use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">assertCanCreate</span><span class="p">(</span><span class="n">root_page</span><span class="p">,</span> <span class="n">ContentPage</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;About us&#39;</span><span class="p">,</span>
    <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;p&gt;Lorem ipsum dolor sit amet&lt;/p&gt;&#39;</span><span class="p">,</span>  <span class="c1"># will not work</span>
<span class="p">})</span>
</pre></div>
</div>
<p>Wagtail now provides a set of helper functions for constructing form data: see <a class="reference internal" href="index.html#form-data-test-helpers"><span class="std std-ref">Form data helpers</span></a>. The above assertion can now be rewritten as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.tests.utils.form_data</span> <span class="kn">import</span> <span class="n">rich_text</span>

<span class="bp">self</span><span class="o">.</span><span class="n">assertCanCreate</span><span class="p">(</span><span class="n">root_page</span><span class="p">,</span> <span class="n">ContentPage</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;About us&#39;</span><span class="p">,</span>
    <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">rich_text</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;Lorem ipsum dolor sit amet&lt;/p&gt;&#39;</span><span class="p">),</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="removed-support-for-elasticsearch-1-x">
<h6>Removed support for Elasticsearch 1.x<a class="headerlink" href="#removed-support-for-elasticsearch-1-x" title="Permalink to this headline">¶</a></h6>
<p>Elasticsearch 1.x is no longer supported in this release. Please upgrade to a 2.x or 5.x release of Elasticsearch before upgrading to Wagtail 2.0.</p>
</div>
<div class="section" id="removed-version-1-of-the-wagtail-api">
<h6>Removed version 1 of the Wagtail API<a class="headerlink" href="#removed-version-1-of-the-wagtail-api" title="Permalink to this headline">¶</a></h6>
<p>Version 1 of the Wagtail API (<code class="docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailapi</span></code>) has been removed from Wagtail.</p>
<p>If you’re using version 1, you will need to migrate to version 2. Please see
<a class="reference internal" href="index.html#document-advanced_topics/api/v2/configuration"><span class="doc">Wagtail API v2 Configuration Guide</span></a> and <a class="reference internal" href="index.html#document-advanced_topics/api/v2/usage"><span class="doc">Wagtail API v2 Usage Guide</span></a>.</p>
<p>If migrating to version 2 is not an option right now (if you have API clients that you don’t
have direct control over, such as a mobile app), you can find the implementation of the
version 1 API in the new <a class="reference external" href="https://github.com/wagtail/wagtailapi_legacy">wagtailapi_legacy</a> repository.</p>
<p>This repository has been created to provide a place for the community to collaborate on supporting
legacy versions of the API until everyone has migrated to an officially supported version.</p>
</div>
<div class="section" id="construct-whitelister-element-rules-hook-is-deprecated">
<h6><code class="docutils literal notranslate"><span class="pre">construct_whitelister_element_rules</span></code> hook is deprecated<a class="headerlink" href="#construct-whitelister-element-rules-hook-is-deprecated" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">construct_whitelister_element_rules</span></code> hook, used to specify additional HTML elements to be permitted in rich text, is deprecated. The recommended way of whitelisting elements is now to use rich text features - see <a class="reference internal" href="index.html#whitelisting-rich-text-elements"><span class="std std-ref">Whitelisting rich text elements</span></a>. For example, a whitelist rule that was previously defined as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">wagtail.core.whitelist</span> <span class="kn">import</span> <span class="n">allow_without_attributes</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_whitelister_element_rules&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">whitelist_blockquote</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;blockquote&#39;</span><span class="p">:</span> <span class="n">allow_without_attributes</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>can be rewritten as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.admin.rich_text.converters.editor_html</span> <span class="kn">import</span> <span class="n">WhitelistRule</span>
<span class="kn">from</span> <span class="nn">wagtail.core</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">wagtail.core.whitelist</span> <span class="kn">import</span> <span class="n">allow_without_attributes</span>

<span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;register_rich_text_features&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">blockquote_feature</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>

    <span class="c1"># register a feature &#39;blockquote&#39; which whitelists the &lt;blockquote&gt; element</span>
    <span class="n">features</span><span class="o">.</span><span class="n">register_converter_rule</span><span class="p">(</span><span class="s1">&#39;editorhtml&#39;</span><span class="p">,</span> <span class="s1">&#39;blockquote&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="n">WhitelistRule</span><span class="p">(</span><span class="s1">&#39;blockquote&#39;</span><span class="p">,</span> <span class="n">allow_without_attributes</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="c1"># add &#39;blockquote&#39; to the default feature set</span>
    <span class="n">features</span><span class="o">.</span><span class="n">default_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;blockquote&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Please note that the new Draftail rich text editor uses a different mechanism to process rich text content, and does not apply whitelist rules; they only take effect when the Hallo.js editor is in use.</p>
</div>
<div class="section" id="wagtail-images-views-serve-generate-signature-now-returns-a-string">
<h6><code class="docutils literal notranslate"><span class="pre">wagtail.images.views.serve.generate_signature</span></code> now returns a string<a class="headerlink" href="#wagtail-images-views-serve-generate-signature-now-returns-a-string" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">generate_signature</span></code> function in <code class="docutils literal notranslate"><span class="pre">wagtail.images.views.serve</span></code>, used to build URLs for the <a class="reference internal" href="index.html#using-images-outside-wagtail"><span class="std std-ref">dynamic image serve view</span></a>, now returns a string rather than a byte string. This ensures that any existing user code that builds up the final image URL with <code class="docutils literal notranslate"><span class="pre">reverse</span></code> will continue to work on Django 2.0 (which no longer allows byte strings to be passed to <code class="docutils literal notranslate"><span class="pre">reverse</span></code>). Any code that expects a byte string as the return value of <code class="docutils literal notranslate"><span class="pre">generate_string</span></code> - for example, calling <code class="docutils literal notranslate"><span class="pre">decode()</span></code> on the result - will need to be updated. (Apps that need to preserve compatibility with earlier versions of Wagtail can call <code class="docutils literal notranslate"><span class="pre">django.utils.encoding.force_text</span></code> instead of <code class="docutils literal notranslate"><span class="pre">decode</span></code>.)</p>
</div>
<div class="section" id="deprecated-search-view">
<h6>Deprecated search view<a class="headerlink" href="#deprecated-search-view" title="Permalink to this headline">¶</a></h6>
<p>Wagtail has always included a bundled view for frontend search. However, this view isn’t easy to customise so
defining this view per project is usually preferred. If you have used this bundled view (check for an import
from  <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailsearch.urls</span></code> in your project’s <code class="docutils literal notranslate"><span class="pre">urls.py</span></code>), you will need to replace this with your
own implementation.</p>
<p>See the search view in Wagtail demo for a guide: <a class="reference external" href="https://github.com/wagtail/wagtaildemo/blob/master/demo/views.py">https://github.com/wagtail/wagtaildemo/blob/master/demo/views.py</a></p>
</div>
<div class="section" id="new-hallo-editor-extension-points">
<h6>New Hallo editor extension points<a class="headerlink" href="#new-hallo-editor-extension-points" title="Permalink to this headline">¶</a></h6>
<p>With the introduction of a new editor, we want to make sure existing editor plugins meant for Hallo only target
Hallo editors for extension.</p>
<ul class="simple">
<li>The existing <code class="docutils literal notranslate"><span class="pre">.richtext</span></code> CSS class is no longer applied to the Hallo editor’s DOM element.</li>
<li>In JavaScript, use the <code class="docutils literal notranslate"><span class="pre">[data-hallo-editor]</span></code> attribute selector to target the editor, eg. <code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">$editor</span> <span class="pre">=</span> <span class="pre">$('[data-hallo-editor]');</span></code>.</li>
<li>In CSS, use the <code class="docutils literal notranslate"><span class="pre">.halloeditor</span></code> class selector.</li>
</ul>
<p>For example,</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span>/* JS */
<span class="gd">- var widget = $(elem).parent(&#39;.richtext&#39;).data(&#39;IKS-hallo&#39;);</span>
<span class="gi">+ var widget = $(elem).parent(&#39;[data-hallo-editor]&#39;).data(&#39;IKS-hallo&#39;);</span>

[...]

/* Styles */
<span class="gd">- .richtext {</span>
<span class="gi">+ .halloeditor {</span>
    font-family: monospace;
}
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-releases/1.13.4"></span><div class="section" id="wagtail-1-13-4-release-notes">
<h4>Wagtail 1.13.4 release notes<a class="headerlink" href="#wagtail-1-13-4-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Pin Beautiful Soup to 4.6.0 due to further regressions in formatting empty elements (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.13.3"></span><div class="section" id="wagtail-1-13-3-release-notes">
<h4>Wagtail 1.13.3 release notes<a class="headerlink" href="#wagtail-1-13-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Pin django-taggit to &lt;0.23 to restore Django 1.8 compatibility (Matt Westcott)</li>
<li>Mark Beautiful Soup 4.6.1 as incompatible due to bug in formatting empty elements (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.13.2"></span><div class="section" id="wagtail-1-13-2-release-notes">
<h4>Wagtail 1.13.2 release notes<a class="headerlink" href="#wagtail-1-13-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Fix support of <code class="docutils literal notranslate"><span class="pre">ATOMIC_REBUILD</span></code> for projects with Elasticsearch client <code class="docutils literal notranslate"><span class="pre">&gt;=1.7.0</span></code> (Mikalai Radchuk)</li>
<li>Logging an indexing failure on an object with a non-ASCII representation no longer crashes on Python 2 (Aram Dulyan)</li>
<li>Rich text image chooser no longer skips format selection after a validation error (Matt Westcott)</li>
<li>Null characters in URLs no longer crash the redirect middleware on PostgreSQL (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.13.1"></span><div class="section" id="wagtail-1-13-1-release-notes">
<h4>Wagtail 1.13.1 release notes<a class="headerlink" href="#wagtail-1-13-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>API listing views no longer fail when no site records are defined (Karl Hobley)</li>
<li>Fixed crash in XML sitemap generator when all pages on the site are private (Stein Strindhaug)</li>
<li>Fixed incorrect z-index on userbar causing it to appear behind page content (Stein Strindhaug)</li>
<li>Fixed error in Postgres search backend when searching specific fields of a <code class="docutils literal notranslate"><span class="pre">specific()</span></code> Page QuerySet (Bertrand Bordage, Matt Westcott)</li>
<li>Fixed error on Elasticsearch backend when passing a QuerySet as an <code class="docutils literal notranslate"><span class="pre">__in</span></code> filter (Karl Hobley, Matt Westcott)</li>
<li><code class="docutils literal notranslate"><span class="pre">__isnull</span></code> filters no longer fail on Elasticsearch 5 (Karl Hobley)</li>
<li>Prevented intermittent failures on Postgres search backend when a field is defined as both a <code class="docutils literal notranslate"><span class="pre">SearchField</span></code> and a <code class="docutils literal notranslate"><span class="pre">FilterField</span></code> (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.13"></span><div class="section" id="wagtail-1-13-release-notes">
<h4>Wagtail 1.13 release notes<a class="headerlink" href="#wagtail-1-13-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<p>Wagtail 1.13 is designated a Long Term Support (LTS) release. Long Term Support releases will continue to receive maintenance updates as necessary to address security and data-loss related issues, up until the next LTS release (typically a period of 8 months). Please note that Wagtail 1.13 will be the last LTS release to support Python 2.</p>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="new-features">
<h6>New features<a class="headerlink" href="#new-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Front-end cache invalidator now supports purging URLs as a batch - see <a class="reference internal" href="index.html#frontend-cache-invalidating-urls"><span class="std std-ref">Invalidating URLs</span></a> (Karl Hobley)</li>
<li><a class="reference internal" href="index.html#document-advanced_topics/documents/custom_document_model"><span class="doc">Custom document model</span></a> is now documented (Emily Horsman)</li>
<li>Use minified versions of CSS in the admin by adding minification to the front-end tooling (Vincent Audebert, Thibaud Colas)</li>
<li>Wagtailforms serve view now passes <code class="docutils literal notranslate"><span class="pre">request.FILES</span></code>, for use in custom form handlers (LB (Ben Johnston))</li>
<li>Documents and images are now given new filenames on re-uploading, to avoid old versions being kept in cache (Bertrand Bordage)</li>
<li>Added custom 404 page for admin interface (Jack Paine)</li>
<li>Breadcrumb navigation now uses globe icon to indicate tree root, rather than home icon (Matt Westcott)</li>
<li>Wagtail now uses React 15.6.2 and above, released under the MIT license (Janneke Janssen)</li>
<li>User search in the Wagtail admin UI now works across multiple fields (Will Giddens)</li>
<li><code class="docutils literal notranslate"><span class="pre">Page.last_published_at</span></code> is now a filterable field for search (Mikalai Radchuk)</li>
<li>Page search results and usage listings now include navigation links (Matt Westcott)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>“Open Link in New Tab” on a right arrow in page explorer should open page list (Emily Horsman)</li>
<li>Using <code class="docutils literal notranslate"><span class="pre">order_by_relevance=False</span></code> when searching with PostgreSQL now works (Mitchel Cabuloy)</li>
<li>Inline panel first and last sorting arrows correctly hidden in non-default tabs (Matt Westcott)</li>
<li><code class="docutils literal notranslate"><span class="pre">WAGTAILAPI_LIMIT_MAX</span></code> now accepts None to disable limiting (jcronyn)</li>
<li>In PostgreSQL, new default ordering when ranking of objects is the same (Bertrand Bordage)</li>
<li>Fixed overlapping header elements on form submissions view on mobile (Jack Paine)</li>
<li>Fixed avatar position in footer on mobile (Jack Paine)</li>
<li>Custom document models no longer require their own post-delete signal handler (Gordon Pendleton)</li>
<li>Deletion of image / document files now only happens when database transaction has completed (Gordon Pendleton)</li>
<li>Fixed Node build scripts to work on Windows (Mikalai Radchuk)</li>
<li>Stop breadcrumb home icon from showing as ellipsis in Chrome 60 (Matt Westcott)</li>
<li>Prevent <code class="docutils literal notranslate"><span class="pre">USE_THOUSAND_SEPARATOR</span> <span class="pre">=</span> <span class="pre">True</span></code> from breaking the image focal point chooser (Sævar Öfjörð Magnússon)</li>
<li>Removed deprecated <code class="docutils literal notranslate"><span class="pre">SessionAuthenticationMiddleware</span></code> from project template (Samir Shah)</li>
<li>Custom display page titles defined with <code class="docutils literal notranslate"><span class="pre">get_admin_display_title</span></code> are now shown in search results (Ben Sturmfels, Matt Westcott)</li>
<li>Custom PageManagers now return the correct PageQuerySet subclass (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.12.6"></span><div class="section" id="wagtail-1-12-6-release-notes">
<h4>Wagtail 1.12.6 release notes<a class="headerlink" href="#wagtail-1-12-6-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Pin Beautiful Soup to 4.6.0 due to further regressions in formatting empty elements (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.12.5"></span><div class="section" id="wagtail-1-12-5-release-notes">
<h4>Wagtail 1.12.5 release notes<a class="headerlink" href="#wagtail-1-12-5-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Pin django-taggit to &lt;0.23 to restore Django 1.8 compatibility (Matt Westcott)</li>
<li>Mark Beautiful Soup 4.6.1 as incompatible due to bug in formatting empty elements (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.12.4"></span><div class="section" id="wagtail-1-12-4-release-notes">
<h4>Wagtail 1.12.4 release notes<a class="headerlink" href="#wagtail-1-12-4-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Fix support of <code class="docutils literal notranslate"><span class="pre">ATOMIC_REBUILD</span></code> for projects with Elasticsearch client <code class="docutils literal notranslate"><span class="pre">&gt;=1.7.0</span></code> (Mikalai Radchuk)</li>
<li>Logging an indexing failure on an object with a non-ASCII representation no longer crashes on Python 2 (Aram Dulyan)</li>
<li>Rich text image chooser no longer skips format selection after a validation error (Matt Westcott)</li>
<li>Null characters in URLs no longer crash the redirect middleware on PostgreSQL (Andrew Crewdson, Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.12.3"></span><div class="section" id="wagtail-1-12-3-release-notes">
<h4>Wagtail 1.12.3 release notes<a class="headerlink" href="#wagtail-1-12-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>API listing views no longer fail when no site records are defined (Karl Hobley)</li>
<li>Pinned Django REST Framework to &lt;3.7 to restore Django 1.8 compatibility (Matt Westcott)</li>
<li>Fixed crash in XML sitemap generator when all pages on the site are private (Stein Strindhaug)</li>
<li>Fixed error in Postgres search backend when searching specific fields of a <code class="docutils literal notranslate"><span class="pre">specific()</span></code> Page QuerySet (Bertrand Bordage, Matt Westcott)</li>
<li>Fixed error on Elasticsearch backend when passing a QuerySet as an <code class="docutils literal notranslate"><span class="pre">__in</span></code> filter (Karl Hobley, Matt Westcott)</li>
<li><code class="docutils literal notranslate"><span class="pre">__isnull</span></code> filters no longer fail on Elasticsearch 5 (Karl Hobley)</li>
<li>Prevented intermittent failures on Postgres search backend when a field is defined as both a <code class="docutils literal notranslate"><span class="pre">SearchField</span></code> and a <code class="docutils literal notranslate"><span class="pre">FilterField</span></code> (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.12.2"></span><div class="section" id="wagtail-1-12-2-release-notes">
<h4>Wagtail 1.12.2 release notes<a class="headerlink" href="#wagtail-1-12-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Migration for addition of <code class="docutils literal notranslate"><span class="pre">Page.draft_title</span></code> field is now reversible (Venelin Stoykov)</li>
<li>Fixed failure on application startup when <code class="docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code> is in use and <code class="docutils literal notranslate"><span class="pre">collectstatic</span></code> has not yet been run (Matt Westcott)</li>
<li>Fixed handling of Vimeo and other oEmbed providers with a format parameter in the endpoint URL (Mitchel Cabuloy)</li>
<li>Fixed regression in rendering save button in wagtail.contrib.settings edit view (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.12.1"></span><div class="section" id="wagtail-1-12-1-release-notes">
<h4>Wagtail 1.12.1 release notes<a class="headerlink" href="#wagtail-1-12-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Prevent home page draft title from displaying as blank (Mikalai Radchuk, Matt Westcott)</li>
<li>Fix regression on styling of preview button with more than one preview mode (Jack Paine)</li>
<li>Enabled translations within date-time chooser widget (Lucas Moeskops)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.12"></span><div class="section" id="wagtail-1-12-release-notes">
<h4>Wagtail 1.12 release notes<a class="headerlink" href="#wagtail-1-12-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<p>Wagtail 1.12 is designated a Long Term Support (LTS) release. Long Term Support releases will continue to receive maintenance updates as necessary to address security and data-loss related issues, up until the next LTS release (typically a period of 8 months).</p>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="configurable-rich-text-features">
<h6>Configurable rich text features<a class="headerlink" href="#configurable-rich-text-features" title="Permalink to this headline">¶</a></h6>
<p>The feature set provided by the rich text editor can now be configured on a per-field basis, by passing a <code class="docutils literal notranslate"><span class="pre">features</span></code> keyword argument; for example, a field can be configured to allow bold / italic formatting and links, but not headings or embedded images or media. For further information, see <a class="reference internal" href="index.html#rich-text-features"><span class="std std-ref">Limiting features in a rich text field</span></a>. This feature was developed by Matt Westcott.</p>
</div>
<div class="section" id="improved-embed-configuration">
<h6>Improved embed configuration<a class="headerlink" href="#improved-embed-configuration" title="Permalink to this headline">¶</a></h6>
<p>New configuration options for embedded media have been added, to give greater control over how media URLs are converted to embeds, and to make it possible to specify additional media providers beyond the ones built in to Wagtail. For further information, see <a class="reference internal" href="index.html#embedded-content"><span class="std std-ref">Embedded content</span></a>. This feature was developed by Karl Hobley.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>The admin interface now displays a title of the latest draft (Mikalai Radchuk)</li>
<li><code class="docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code> now has a default “index” route (Andreas Nüßlein, Matt Westcott)</li>
<li>Added multi-select form field to the form builder (dwasyl)</li>
<li>Improved performance of sitemap generation (Levi Adler)</li>
<li>StreamField now respects the <code class="docutils literal notranslate"><span class="pre">blank</span></code> setting; StreamBlock accepts a <code class="docutils literal notranslate"><span class="pre">required</span></code> setting (Loic Teixeira)</li>
<li>StreamBlock now accepts <code class="docutils literal notranslate"><span class="pre">min_num</span></code>, <code class="docutils literal notranslate"><span class="pre">max_num</span></code> and <code class="docutils literal notranslate"><span class="pre">block_counts</span></code> settings to control the minimum and maximum numbers of blocks (Edwar Baron, Matt Westcott)</li>
<li>Users can no longer remove their own active / superuser flags through Settings -&gt; Users (Stein Strindhaug, Huub Bouma)</li>
<li>The <code class="docutils literal notranslate"><span class="pre">process_form_submission</span></code> method of form pages now return the created form submission object (Christine Ho)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">WAGTAILUSERS_PASSWORD_ENABLED</span></code> and <code class="docutils literal notranslate"><span class="pre">WAGTAILUSERS_PASSWORD_REQUIRED</span></code> settings to permit creating users with no Django-side passwords, to support external authentication setups (Matt Westcott)</li>
<li>Added help text parameter to <code class="docutils literal notranslate"><span class="pre">DecimalBlock</span></code> and <code class="docutils literal notranslate"><span class="pre">RegexBlock</span></code> (Tomasz Knapik)</li>
<li>Optimised caudal oscillation parameters on logo (Jack Paine)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>FieldBlocks in StreamField now call the field’s <code class="docutils literal notranslate"><span class="pre">prepare_value</span></code> method (Tim Heap)</li>
<li>Initial disabled state of InlinePanel add button is now set correctly on non-default tabs (Matthew Downey)</li>
<li>Redirects with unicode characters now work (Rich Brennan)</li>
<li>Prevent explorer view from crashing when page model definitions are missing, allowing the offending pages to be deleted (Matt Westcott)</li>
<li>Hide the userbar from printed page representation (Eugene Morozov)</li>
<li>Prevent the page editor footer content from collapsing into two lines unnecessarily (Jack Paine)</li>
<li>StructBlock values no longer render HTML templates as their <code class="docutils literal notranslate"><span class="pre">str</span></code> representation, to prevent infinite loops in debugging / logging tools (Matt Westcott)</li>
<li>Removed deprecated jQuery <code class="docutils literal notranslate"><span class="pre">load</span></code> call from TableBlock initialisation (Jack Paine)</li>
<li>Position of options in mobile nav-menu (Jack Paine)</li>
<li>Center page editor footer regardless of screen width (Jack Paine)</li>
<li>Change the design of the navbar toggle icon so that it no longer obstructs page headers (Jack Paine)</li>
<li>Document add/edit forms no longer render container elements for hidden fields (Jeffrey Chau)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="streamfield-now-defaults-to-blank-false">
<h6>StreamField now defaults to <code class="docutils literal notranslate"><span class="pre">blank=False</span></code><a class="headerlink" href="#streamfield-now-defaults-to-blank-false" title="Permalink to this headline">¶</a></h6>
<p>StreamField now respects the <code class="docutils literal notranslate"><span class="pre">blank</span></code> field setting; when this is false, at least one block must be supplied for the field to pass validation. To match the behaviour of other model fields, <code class="docutils literal notranslate"><span class="pre">blank</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>; if you wish to allow a StreamField to be left empty, you must now add <code class="docutils literal notranslate"><span class="pre">blank=True</span></code> to the field.</p>
<p>When passing an explicit <code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> as the top-level block of a StreamField definition, note that the StreamField’s <code class="docutils literal notranslate"><span class="pre">blank</span></code> keyword argument always takes precedence over the block’s <code class="docutils literal notranslate"><span class="pre">required</span></code> property, including when it is left as the default value of <code class="docutils literal notranslate"><span class="pre">blank=False</span></code>. Consequently, setting <code class="docutils literal notranslate"><span class="pre">required=False</span></code> on a top-level <code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> has no effect.</p>
</div>
<div class="section" id="old-configuration-settings-for-embeds-are-deprecated">
<h6>Old configuration settings for embeds are deprecated<a class="headerlink" href="#old-configuration-settings-for-embeds-are-deprecated" title="Permalink to this headline">¶</a></h6>
<p>The configuration settings <code class="docutils literal notranslate"><span class="pre">WAGTAILEMBEDS_EMBED_FINDER</span></code> and <code class="docutils literal notranslate"><span class="pre">WAGTAILEMBEDS_EMBEDLY_KEY</span></code> have been deprecated in favour of the new <code class="docutils literal notranslate"><span class="pre">WAGTAILEMBEDS_FINDERS</span></code> setting. Please see <a class="reference internal" href="index.html#configuring-embed-finders"><span class="std std-ref">Configuring embed “finders”</span></a> for the new configuration to use.</p>
</div>
<div class="section" id="registering-custom-hallo-js-plugins-directly-is-deprecated">
<h6>Registering custom hallo.js plugins directly is deprecated<a class="headerlink" href="#registering-custom-hallo-js-plugins-directly-is-deprecated" title="Permalink to this headline">¶</a></h6>
<p>The ability to enable / disable <code class="docutils literal notranslate"><span class="pre">hallo.js</span></code> plugins by calling <code class="docutils literal notranslate"><span class="pre">registerHalloPlugin</span></code> or modifying the <code class="docutils literal notranslate"><span class="pre">halloPlugins</span></code> list has been deprecated, and will be removed in Wagtail 1.14. The recommended way of customising the hallo.js editor is now through <a class="reference internal" href="index.html#rich-text-features"><span class="std std-ref">rich text features</span></a>. For details of how to define a hallo.js plugin as a rich text feature, see <a class="reference internal" href="index.html#document-extending/extending_hallo"><span class="doc">Extending the Hallo Editor</span></a>.</p>
</div>
<div class="section" id="custom-get-admin-display-title-methods-should-use-draft-title">
<h6>Custom <code class="docutils literal notranslate"><span class="pre">get_admin_display_title</span></code> methods should use <code class="docutils literal notranslate"><span class="pre">draft_title</span></code><a class="headerlink" href="#custom-get-admin-display-title-methods-should-use-draft-title" title="Permalink to this headline">¶</a></h6>
<p>This release introduces a new <code class="docutils literal notranslate"><span class="pre">draft_title</span></code> field on page models, so that page titles as used across the admin interface will correctly reflect any changes that exist in draft. If any of your page models override the <code class="docutils literal notranslate"><span class="pre">get_admin_display_title</span></code> method, to customise the display of page titles in the admin, it is recommended that you now update these to base their output on <code class="docutils literal notranslate"><span class="pre">draft_title</span></code> rather than <code class="docutils literal notranslate"><span class="pre">title</span></code>. Alternatively, to preserve backwards compatibility, you can invoke <code class="docutils literal notranslate"><span class="pre">super</span></code> on the method, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_admin_display_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%(title)s</span><span class="s2"> (</span><span class="si">%(lang)s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="nb">super</span><span class="p">(</span><span class="n">TranslatablePage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_admin_display_title</span><span class="p">(),</span>
        <span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_code</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="fixtures-for-loading-pages-should-include-draft-title">
<h6>Fixtures for loading pages should include <code class="docutils literal notranslate"><span class="pre">draft_title</span></code><a class="headerlink" href="#fixtures-for-loading-pages-should-include-draft-title" title="Permalink to this headline">¶</a></h6>
<p>In most situations, the new <code class="docutils literal notranslate"><span class="pre">draft_title</span></code> field on page models will automatically be populated from the page title. However, this is not the case for pages that are created from fixtures. Projects that use fixtures to load initial data should therefore ensure that a <code class="docutils literal notranslate"><span class="pre">draft_title</span></code> field is specified.</p>
</div>
<div class="section" id="routablepagemixin-now-has-a-default-index-route">
<h6><code class="docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code> now has a default index route<a class="headerlink" href="#routablepagemixin-now-has-a-default-index-route" title="Permalink to this headline">¶</a></h6>
<p>If you’ve used <code class="docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code> on a Page model, you may have had to manually define an index route to serve the page at its main URL (<code class="docutils literal notranslate"><span class="pre">r'^$'</span></code>) so it behaves like a normal page. Wagtail now defines a default index route so this is no longer required.</p>
</div>
</div>
</div>
<span id="document-releases/1.11.1"></span><div class="section" id="wagtail-1-11-1-release-notes">
<h4>Wagtail 1.11.1 release notes<a class="headerlink" href="#wagtail-1-11-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Custom display page titles defined with <code class="docutils literal notranslate"><span class="pre">get_admin_display_title</span></code> are now shown within the page explorer menu (Matt Westcott, Janneke Janssen)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.11"></span><div class="section" id="wagtail-1-11-release-notes">
<h4>Wagtail 1.11 release notes<a class="headerlink" href="#wagtail-1-11-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="explorer-menu-built-with-the-admin-api-and-react">
<h6>Explorer menu built with the admin API and React<a class="headerlink" href="#explorer-menu-built-with-the-admin-api-and-react" title="Permalink to this headline">¶</a></h6>
<p>After more than a year of work, the new explorer menu has finally landed! It comes with the following improvements:</p>
<ul class="simple">
<li>View all pages - not just the ones with child pages.</li>
<li>Better performance, no matter the number of pages or levels in the hierarchy.</li>
<li>Navigate the menu via keyboard.</li>
<li>View Draft pages, and go to page editing, directly from the menu.</li>
</ul>
<p>Beyond features, the explorer is built with the new admin API and React components.
This will facilitate further evolutions to make it even faster and user-friendly.
This work is the product of <code class="docutils literal notranslate"><span class="pre">4</span></code> Wagtail sprints, and the efforts of <code class="docutils literal notranslate"><span class="pre">16</span></code> people, listed here by order of first involvement:</p>
<ul class="simple">
<li>Karl Hobley (Cape town sprint, admin API)</li>
<li>Josh Barr (Cape town sprint, prototype UI)</li>
<li>Thibaud Colas (Ede sprint, Reykjavík sprint)</li>
<li>Janneke Janssen (Ede sprint, Reykjavík sprint, Wagtail Space sprint)</li>
<li>Rob Moorman (Ede sprint, eslint-config-wagtail, ES6+React+Redux styleguide)</li>
<li>Maurice Bartnig (Ede sprint, i18n and bug fixes)</li>
<li>Jonny Scholes (code review)</li>
<li>Matt Westcott (Reykjavík sprint, refactorings)</li>
<li>Sævar Öfjörð Magnússon (Reykjavík sprint)</li>
<li>Eirikur Ingi Magnusson (Reykjavík sprint)</li>
<li>Harris Lapiroff (Reykjavík sprint, tab-accessible navigation)</li>
<li>Hugo van den Berg (testing, Wagtail Space sprint)</li>
<li>Olly Willans (UI, UX, Wagtail Space sprint)</li>
<li>Andy Babic (UI, UX)</li>
<li>Ben Enright (UI, UX)</li>
<li>Bertrand Bordage (testing, documentation)</li>
</ul>
</div>
<div class="section" id="privacy-settings-on-documents">
<h6>Privacy settings on documents<a class="headerlink" href="#privacy-settings-on-documents" title="Permalink to this headline">¶</a></h6>
<p>Privacy settings can now be configured on collections, to restrict access to documents either by shared password or by user account. See: <a class="reference internal" href="index.html#private-pages"><span class="std std-ref">Private pages</span></a>.</p>
<p>This feature was developed by Ulrich Wagner and Matt Westcott. Thank you to <a class="reference external" href="https://www.WhartonWRDS.com/">Wharton Research Data Services</a> of <a class="reference external" href="https://www.wharton.upenn.edu">The Wharton School</a> for sponsoring this feature.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Optimised page URL generation by caching site paths in the request scope (Tobias McNulty, Matt Westcott)</li>
<li>The current live version of a page is now tracked on the revision listing view (Matheus Bratfisch)</li>
<li>Each block created in a <code class="docutils literal notranslate"><span class="pre">StreamField</span></code> is now assigned a globally unique identifier (Matt Westcott)</li>
<li>Mixcloud oEmbed pattern has been updated (Alice Rose)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">last_published_at</span></code> field to the Page model (Matt Westcott)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">show_in_menus_default</span></code> flag on page models, to allow “show in menus” to be checked by default (LB (Ben Johnston))</li>
<li>“Copy page” form now validates against copying to a destination where the user does not have permission (Henk-Jan van Hasselaar)</li>
<li>Allows reverse relations in <code class="docutils literal notranslate"><span class="pre">RelatedFields</span></code> for elasticsearch &amp; PostgreSQL search backends (Lucas Moeskops, Bertrand Bordage)</li>
<li>Added oEmbed support for Facebook (Mikalai Radchuk)</li>
<li>Added oEmbed support for Tumblr (Mikalai Radchuk)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Unauthenticated AJAX requests to admin views now return 403 rather than redirecting to the login page (Karl Hobley)</li>
<li><code class="docutils literal notranslate"><span class="pre">TableBlock</span></code> options <code class="docutils literal notranslate"><span class="pre">afterChange</span></code>, <code class="docutils literal notranslate"><span class="pre">afterCreateCol</span></code>, <code class="docutils literal notranslate"><span class="pre">afterCreateRow</span></code>, <code class="docutils literal notranslate"><span class="pre">afterRemoveCol</span></code>, <code class="docutils literal notranslate"><span class="pre">afterRemoveRow</span></code> and <code class="docutils literal notranslate"><span class="pre">contextMenu</span></code> can now be overridden (Loic Teixeira)</li>
<li>The lastmod field returned by wagtailsitemaps now shows the last published date rather than the date of the last draft edit (Matt Westcott)</li>
<li>Document chooser upload form no longer renders container elements for hidden fields (Jeffrey Chau)</li>
<li>Prevented exception when visiting a preview URL without initiating the preview (Paul Kamp)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="browser-requirements-for-the-new-explorer-menu">
<h6>Browser requirements for the new explorer menu<a class="headerlink" href="#browser-requirements-for-the-new-explorer-menu" title="Permalink to this headline">¶</a></h6>
<p>The new explorer menu does not support IE8, IE9, and IE10. The fallback experience is a link pointing to the explorer pages.</p>
</div>
<div class="section" id="caching-of-site-level-url-information-throughout-the-request-cycle">
<h6>Caching of site-level URL information throughout the request cycle<a class="headerlink" href="#caching-of-site-level-url-information-throughout-the-request-cycle" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">get_url_parts</span></code> and <code class="docutils literal notranslate"><span class="pre">relative_url</span></code> methods on <code class="docutils literal notranslate"><span class="pre">Page</span></code> now accept an optional <code class="docutils literal notranslate"><span class="pre">request</span></code> keyword argument.
Additionally, two new methods have been added, <code class="docutils literal notranslate"><span class="pre">get_url</span></code> (analogous to the <code class="docutils literal notranslate"><span class="pre">url</span></code> property) and <code class="docutils literal notranslate"><span class="pre">get_full_url</span></code>
(analogous to the <code class="docutils literal notranslate"><span class="pre">full_url</span></code>) property. Whenever possible, these methods should be used instead of the property
versions, and the request passed to each method. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">page_url</span> <span class="o">=</span> <span class="n">my_page</span><span class="o">.</span><span class="n">url</span>
</pre></div>
</div>
<p>would become:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">page_url</span> <span class="o">=</span> <span class="n">my_page</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
<p>This enables caching of underlying site-level URL information throughout the request cycle, thereby significantly
reducing the number of cache or SQL queries your site will generate for a given page load. A common use case for these
methods is any custom template tag your project may include for generating navigation menus. For more information,
please refer to <a class="reference internal" href="index.html#id1"><span class="std std-ref">Page URLs</span></a>.</p>
<p>Furthermore, if you have overridden <code class="docutils literal notranslate"><span class="pre">get_url_parts</span></code> or <code class="docutils literal notranslate"><span class="pre">relative_url</span></code> on any of your page models, you will need to
update the method signature to support this keyword argument; most likely, this will involve changing the line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_url_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_url_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</pre></div>
</div>
<p>and passing those through at the point where you are calling <code class="docutils literal notranslate"><span class="pre">get_url_parts</span></code> on <code class="docutils literal notranslate"><span class="pre">super</span></code> (if applicable).</p>
<p>See also: <a class="reference internal" href="index.html#wagtail.core.models.Page.get_url_parts" title="wagtail.core.models.Page.get_url_parts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wagtail.core.models.Page.get_url_parts()</span></code></a>, <a class="reference internal" href="index.html#wagtail.core.models.Page.get_url" title="wagtail.core.models.Page.get_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wagtail.core.models.Page.get_url()</span></code></a>,
<a class="reference internal" href="index.html#wagtail.core.models.Page.get_full_url" title="wagtail.core.models.Page.get_full_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wagtail.core.models.Page.get_full_url()</span></code></a>, and <a class="reference internal" href="index.html#wagtail.core.models.Page.relative_url" title="wagtail.core.models.Page.relative_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wagtail.core.models.Page.relative_url()</span></code></a></p>
</div>
<div class="section" id="password-required-template-for-documents">
<h6>“Password required” template for documents<a class="headerlink" href="#password-required-template-for-documents" title="Permalink to this headline">¶</a></h6>
<p>This release adds the ability to password-protect documents as well as pages. The template used for the “password required” form is distinct from the one used for pages; if you have previously overridden the default template through the <code class="docutils literal notranslate"><span class="pre">PASSWORD_REQUIRED_TEMPLATE</span></code> setting, you may wish to provide a corresponding template for documents through the setting <code class="docutils literal notranslate"><span class="pre">DOCUMENT_PASSWORD_REQUIRED_TEMPLATE</span></code>. See: <a class="reference internal" href="index.html#private-pages"><span class="std std-ref">Private pages</span></a></p>
</div>
<div class="section" id="elasticsearch-5-4-is-incompatible-with-atomic-rebuild">
<h6>Elasticsearch 5.4 is incompatible with <code class="docutils literal notranslate"><span class="pre">ATOMIC_REBUILD</span></code><a class="headerlink" href="#elasticsearch-5-4-is-incompatible-with-atomic-rebuild" title="Permalink to this headline">¶</a></h6>
<p>While not specific to Wagtail 1.11, users of Elasticsearch should be aware that the <code class="docutils literal notranslate"><span class="pre">ATOMIC_REBUILD</span></code> option is not compatible with Elasticsearch 5.4.x due to <a class="reference external" href="https://github.com/elastic/elasticsearch/issues/24644">a bug in the handling of aliases</a>. If you wish to use this feature, please use Elasticsearch 5.3.x or 5.5.x (when available).</p>
</div>
</div>
</div>
<span id="document-releases/1.10.1"></span><div class="section" id="wagtail-1-10-1-release-notes">
<h4>Wagtail 1.10.1 release notes<a class="headerlink" href="#wagtail-1-10-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Fix admin page preview that was broken 24 hours after previewing a page (Martin Hill)</li>
<li>Removed territory-specific translations for Spanish, Polish, Swedish, Russian and Chinese (Taiwan) that block more complete translations from being used (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.10"></span><div class="section" id="wagtail-1-10-release-notes">
<h4>Wagtail 1.10 release notes<a class="headerlink" href="#wagtail-1-10-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="postgresql-search-engine">
<h6>PostgreSQL search engine<a class="headerlink" href="#postgresql-search-engine" title="Permalink to this headline">¶</a></h6>
<p>A new search engine has been added to Wagtail which uses PostgreSQL’s built-in
full-text search functionality. This means that if you use PostgreSQL to manage
your database, you can now get a good quality search engine without needing
to install Elasticsearch.</p>
<p>To get started, see <a class="reference internal" href="index.html#postgres-search"><span class="std std-ref">PostgreSQL search engine</span></a>.</p>
<p>This feature was developed at the Arnhem sprint by Bertrand Bordage, Jaap Roes,
Arne de Laat and Ramon de Jezus.</p>
</div>
<div class="section" id="django-1-11-and-python-3-6-support">
<h6>Django 1.11 and Python 3.6 support<a class="headerlink" href="#django-1-11-and-python-3-6-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail is now compatible with Django 1.11 and Python 3.6. Compatibility fixes were contributed by Tim Graham, Matt Westcott, Mikalai Radchuk and Bertrand Bordage.</p>
</div>
<div class="section" id="user-language-preference">
<h6>User language preference<a class="headerlink" href="#user-language-preference" title="Permalink to this headline">¶</a></h6>
<p>Users can now set their preferred language for the Wagtail admin interface under Account Settings → Language Preferences. The list of available languages can be configured via the <a class="reference internal" href="index.html#wagtailadmin-permitted-languages"><span class="std std-ref">WAGTAILADMIN_PERMITTED_LANGUAGES</span></a> setting. This feature was developed by Daniel Chimeno.</p>
</div>
<div class="section" id="new-admin-preview">
<h6>New admin preview<a class="headerlink" href="#new-admin-preview" title="Permalink to this headline">¶</a></h6>
<p>Previewing pages in Wagtail admin interface was rewritten
to make it more robust. In previous versions, preview was broken in several
scenarios so users often ended up on a blank page with an infinite spinner.</p>
<p>An additional setting was created: <a class="reference internal" href="index.html#wagtail-auto-update-preview"><span class="std std-ref">WAGTAIL_AUTO_UPDATE_PREVIEW</span></a>.
It allows users to see changes done in the editor by refreshing the preview tab
without having to click again on the preview button.</p>
<p>This was developed by Bertrand Bordage.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Use minified versions of jQuery and jQuery UI in the admin. Total savings without compression 371 KB (Tom Dyson)</li>
<li>Hooks can now specify the order in which they are run (Gagaro)</li>
<li>Added a <code class="docutils literal notranslate"><span class="pre">submit_buttons</span></code> block to login template (Gagaro)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">construct_image_chooser_queryset</span></code>, <code class="docutils literal notranslate"><span class="pre">construct_document_chooser_queryset</span></code> and <code class="docutils literal notranslate"><span class="pre">construct_page_chooser_queryset</span></code> hooks (Gagaro)</li>
<li>The homepage created in the project template is now titled “Home” rather than “Homepage” (Karl Hobley)</li>
<li>Signal receivers for custom <code class="docutils literal notranslate"><span class="pre">Image</span></code> and <code class="docutils literal notranslate"><span class="pre">Rendition</span></code> models are connected automatically (Mike Dingjan)</li>
<li><code class="docutils literal notranslate"><span class="pre">PageChooserBlock</span></code> can now accept a list/tuple of page models as <code class="docutils literal notranslate"><span class="pre">target_model</span></code> (Mikalai Radchuk)</li>
<li>Styling tweaks for the ModelAdmin’s <code class="docutils literal notranslate"><span class="pre">IndexView</span></code> to be more inline with the Wagtail styleguide (Andy Babic)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">.nvmrc</span></code> to the project root for Node versioning support (Janneke Janssen)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">form_fields_exclude</span></code> property to ModelAdmin views (Matheus Bratfisch)</li>
<li>User creation / edit form now enforces password validators set in <code class="docutils literal notranslate"><span class="pre">AUTH_PASSWORD_VALIDATORS</span></code> (Bertrand Bordage)</li>
<li>Added support for displaying <code class="docutils literal notranslate"><span class="pre">non_field_errors</span></code> when validation fails in the page editor (Matt Westcott)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">WAGTAILADMIN_RECENT_EDITS_LIMIT</span></code> setting to to define the number of your most recent edits on the dashboard (Maarten Kling)</li>
<li>Added link to the full Elasticsearch setup documentation from the Performance page (Matt Westcott)</li>
<li>Tag input fields now accept spaces in tags by default, and can be overridden with the <code class="docutils literal notranslate"><span class="pre">TAG_SPACES_ALLOWED</span></code> setting (Kees Hink, Alex Gleason)</li>
<li>Page chooser widgets now display the required page type where relevant (Christine Ho)</li>
<li>Site root pages are now indicated with a globe icon in the explorer listing (Nick Smith, Huub Bouma)</li>
<li>Draft page view is now restricted to users with edit / publish permission over the page (Kees Hink)</li>
<li>Added the option to delete a previously saved focal point on a image (Maarten Kling)</li>
<li>Page explorer menu item, search and summary panel are now hidden for users with no page permissions (Tim Heap)</li>
<li>Added support for custom date and datetime formats in input fields (Bojan Mihelac)</li>
<li>Added support for custom Django REST framework serialiser fields in <code class="docutils literal notranslate"><span class="pre">Page.api_fields</span></code> using a new <code class="docutils literal notranslate"><span class="pre">APIField</span></code> class (Karl Hobley)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">classname</span></code> argument to <code class="docutils literal notranslate"><span class="pre">StreamFieldPanel</span></code> (Christine Ho)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">group</span></code> keyword argument to StreamField blocks for grouping related blocks together in the block menu (Andreas Nüßlein)</li>
<li>Update the sitemap generator to use the Django sitemap module (Michael van Tellingen, Mike Dingjan)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Marked ‘Date from’ / ‘Date to’ strings in wagtailforms for translation (Vorlif)</li>
<li>“File” field label on image edit form is now translated (Stein Strindhaug)</li>
<li>Unreliable preview is now reliable by always opening in a new window (Kjartan Sverrisson)</li>
<li>Fixed placement of <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">block.super</span> <span class="pre">}}</span></code> in <code class="docutils literal notranslate"><span class="pre">snippets/type_index.html</span></code> (LB (Ben Johnston))</li>
<li>Optimised database queries on group edit page (Ashia Zawaduk)</li>
<li>Choosing a popular search term for promoted search results now works correctly after pagination (Janneke Janssen)</li>
<li>IDs used in tabbed interfaces are now namespaced to avoid collisions with other page elements (Janneke Janssen)</li>
<li>Page title not displaying page name when moving a page (Trent Holliday)</li>
<li>The ModelAdmin module can now work without the wagtailimages and wagtaildocs apps installed (Andy Babic)</li>
<li>Cloudflare error handling now handles non-string error responses correctly (hdnpl)</li>
<li>Search indexing now uses a defined query ordering to prevent objects from being skipped (Christian Peters)</li>
<li>Ensure that number localisation is not applied to object IDs within admin templates (Tom Hendrikx)</li>
<li>Paginating with a search present was always returning the 1st page in Internet Explorer 10 &amp; 11 (Ralph Jacobs)</li>
<li>RoutablePageMixin and wagtailforms previews now set the <code class="docutils literal notranslate"><span class="pre">request.is_preview</span></code> flag (Wietze Helmantel)</li>
<li>The save and preview buttons in the page editor are now mobile-friendly (Maarten Kling)</li>
<li>Page links within rich text now respect custom URLs defined on specific page models (Gary Krige, Huub Bouma)</li>
<li>Default avatar no longer visible when using a transparent gravatar image (Thijs Kramer)</li>
<li>Scrolling within the datetime picker is now usable again for touchpads (Ralph Jacobs)</li>
<li>List-based fields within form builder form submissions are now displayed as comma-separated strings rather than as Python lists (Christine Ho, Matt Westcott)</li>
<li>The page type usage listing now have a translatable page title (Ramon de Jezus)</li>
<li>Styles for submission filtering form now have a consistent height. (Thijs Kramer)</li>
<li>Slicing a search result set no longer loses the annotation added by <code class="docutils literal notranslate"><span class="pre">annotate_score</span></code> (Karl Hobley)</li>
<li>String-based primary keys are now escaped correctly in ModelAdmin URLs (Andreas Nüßlein)</li>
<li>Empty search in the API now works (Morgan Aubert)</li>
<li><code class="docutils literal notranslate"><span class="pre">RichTextBlock</span></code> toolbar now correctly positioned within <code class="docutils literal notranslate"><span class="pre">StructBlock</span></code> (Janneke Janssen)</li>
<li>Fixed display of ManyToMany fields and False values on the ModelAdmin inspect view (Andy Babic)</li>
<li>Prevent pages from being recursively copied into themselves (Matheus Bratfisch)</li>
<li>Specifying the full file name in documents URL is mandatory (Morgan Aubert)</li>
<li>Reordering inline forms now works correctly when moving past a deleted form (Janneke Janssen)</li>
<li>Removed erroneous <cite>|safe</cite> filter from search results template in project template (Karl Hobley)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="django-1-9-and-python-3-3-support-dropped">
<h6>Django 1.9 and Python 3.3 support dropped<a class="headerlink" href="#django-1-9-and-python-3-3-support-dropped" title="Permalink to this headline">¶</a></h6>
<p>Support for Django 1.9 and Python 3.3 has been dropped in this release; please upgrade from these before upgrading Wagtail. Note that the Django 1.8 release series is still supported, as a Long Term Support release.</p>
</div>
<div class="section" id="dropped-support-for-generating-static-sites-using-django-medusa">
<h6>Dropped support for generating static sites using <code class="docutils literal notranslate"><span class="pre">django-medusa</span></code><a class="headerlink" href="#dropped-support-for-generating-static-sites-using-django-medusa" title="Permalink to this headline">¶</a></h6>
<p>Django-medusa is no longer maintained, and is incompatible with Django 1.8 and above. An alternative module based on the <cite>django-bakery</cite> package is available as a third-party contribution: <a class="reference external" href="https://github.com/moorinteractive/wagtail-bakery">https://github.com/moorinteractive/wagtail-bakery</a>.</p>
</div>
<div class="section" id="signals-on-custom-image-and-rendition-models-connected-automatically">
<h6>Signals on custom <code class="docutils literal notranslate"><span class="pre">Image</span></code> and <code class="docutils literal notranslate"><span class="pre">Rendition</span></code> models connected automatically<a class="headerlink" href="#signals-on-custom-image-and-rendition-models-connected-automatically" title="Permalink to this headline">¶</a></h6>
<p>Projects using <a class="reference internal" href="index.html#custom-image-model"><span class="std std-ref">custom image models</span></a> no longer need to set up signal receivers to handle deletion of image files and image feature detection, as these are now handled automatically by Wagtail. The following lines of code should be removed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete the source image file when an image is deleted</span>
<span class="nd">@receiver</span><span class="p">(</span><span class="n">post_delete</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">CustomImage</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">image_delete</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># Delete the rendition image file when a rendition is deleted</span>
<span class="nd">@receiver</span><span class="p">(</span><span class="n">post_delete</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">CustomRendition</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rendition_delete</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># Perform image feature detection (if enabled)</span>
<span class="nd">@receiver</span><span class="p">(</span><span class="n">pre_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">CustomImage</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">image_feature_detection</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="o">.</span><span class="n">has_focal_point</span><span class="p">():</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">set_focal_point</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">get_suggested_focal_point</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-editing-users-through-wagtail-admin-no-longer-sets-is-staff-flag">
<h6>Adding / editing users through Wagtail admin no longer sets <code class="docutils literal notranslate"><span class="pre">is_staff</span></code> flag<a class="headerlink" href="#adding-editing-users-through-wagtail-admin-no-longer-sets-is-staff-flag" title="Permalink to this headline">¶</a></h6>
<p>Previously, the <code class="docutils literal notranslate"><span class="pre">is_staff</span></code> flag (which grants access to the Django admin interface) was automatically set for superusers, and reset for other users, when creating and updating users through the Wagtail admin. This behaviour has now been removed, since Wagtail is designed to work independently of the Django admin. If you need to reinstate the old behaviour, you can set up a <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/signals/#django.db.models.signals.pre_save">pre_save signal handler</a> on the User model to set the flag appropriately.</p>
</div>
<div class="section" id="specifying-the-full-file-name-in-documents-url-is-mandatory">
<h6>Specifying the full file name in documents URL is mandatory<a class="headerlink" href="#specifying-the-full-file-name-in-documents-url-is-mandatory" title="Permalink to this headline">¶</a></h6>
<p>In previous releases, it was possible to download a document using
the primary key and a fraction of its file name, or even without file name.
You could get the same document at the addresses
<code class="docutils literal notranslate"><span class="pre">/documents/1/your-file-name.pdf</span></code>, <code class="docutils literal notranslate"><span class="pre">/documents/1/you</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">/documents/1/</span></code>.</p>
<p>This feature was supposed to allow shorter URLs but was not used in Wagtail.
For security reasons, we removed it, so only the full URL works:
<code class="docutils literal notranslate"><span class="pre">/documents/1/your-file-name.pdf</span></code></p>
<p>If any of your applications relied on the previous behaviour, you will have to
rewrite it to take this into account.</p>
</div>
</div>
</div>
<span id="document-releases/1.9.1"></span><div class="section" id="wagtail-1-9-1-release-notes">
<h4>Wagtail 1.9.1 release notes<a class="headerlink" href="#wagtail-1-9-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Removed erroneous <code class="docutils literal notranslate"><span class="pre">|safe</span></code> filter from search results template in project template (Karl Hobley)</li>
<li>Prevent pages from being recursively copied into themselves (Matheus Bratfisch)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.9"></span><div class="section" id="wagtail-1-9-release-notes">
<h4>Wagtail 1.9 release notes<a class="headerlink" href="#wagtail-1-9-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="revision-comparisons">
<h6>Revision comparisons<a class="headerlink" href="#revision-comparisons" title="Permalink to this headline">¶</a></h6>
<img alt="_images/releasenotes_1_9_revisioncomparison.png" src="_images/releasenotes_1_9_revisioncomparison.png" />
<p>Wagtail now provides the ability to view differences between revisions of a page, from the revisions listing page and when reviewing a page in moderation. This feature was developed by Karl Hobley, Janneke Janssen and Matt Westcott. Thank you to Blackstone Chambers for sponsoring this feature.</p>
</div>
<div class="section" id="many-to-many-relations-on-page-models">
<h6>Many-to-many relations on page models<a class="headerlink" href="#many-to-many-relations-on-page-models" title="Permalink to this headline">¶</a></h6>
<img alt="_images/releasenotes_1_9_m2m.png" src="_images/releasenotes_1_9_m2m.png" />
<p>Wagtail now supports a new field type <code class="docutils literal notranslate"><span class="pre">ParentalManyToManyField</span></code> that can be used to set up many-to-many relations on pages. For details, see the <a class="reference internal" href="index.html#tutorial-categories"><span class="std std-ref">Categories</span></a> section of the tutorial. This feature was developed by Thejaswi Puthraya and Matt Westcott.</p>
</div>
<div class="section" id="bulk-deletion-of-form-submissions">
<h6>Bulk-deletion of form submissions<a class="headerlink" href="#bulk-deletion-of-form-submissions" title="Permalink to this headline">¶</a></h6>
<p>Form builder form submissions can now be deleted in bulk from the form submissions index page. This feature was sponsored by St John’s College, Oxford and developed by Karl Hobley.</p>
</div>
<div class="section" id="accessing-parent-context-from-streamfield-block-get-context-methods">
<h6>Accessing parent context from StreamField block <code class="docutils literal notranslate"><span class="pre">get_context</span></code> methods<a class="headerlink" href="#accessing-parent-context-from-streamfield-block-get-context-methods" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">get_context</span></code> method on StreamField blocks now receives a <code class="docutils literal notranslate"><span class="pre">parent_context</span></code> keyword argument, consisting of the dict of variables passed in from the calling template. For example, this makes it possible to perform pagination logic within <code class="docutils literal notranslate"><span class="pre">get_context</span></code>, retrieving the current page number from <code class="docutils literal notranslate"><span class="pre">parent_context['request'].GET</span></code>. See <a class="reference internal" href="index.html#streamfield-get-context"><span class="std std-ref">get_context on StreamField blocks</span></a>. This feature was developed by Mikael Svensson and Peter Baumgartner.</p>
</div>
<div class="section" id="welcome-message-customisation-for-multi-tenanted-installations">
<h6>Welcome message customisation for multi-tenanted installations<a class="headerlink" href="#welcome-message-customisation-for-multi-tenanted-installations" title="Permalink to this headline">¶</a></h6>
<p>The welcome message on the admin dashboard has been updated to be more suitable for multi-tenanted installations. Users whose page permissions lie within a single site will now see that site name in the welcome message, rather than the installation-wide <code class="docutils literal notranslate"><span class="pre">WAGTAIL_SITE_NAME</span></code>. As before, this message can be customised, and additional template variables have been provided for this purpose - see <a class="reference internal" href="index.html#custom-branding"><span class="std std-ref">Custom branding</span></a>. This feature was developed by Jeffrey Chau.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Changed text of “Draft” and “Live” buttons to “View draft” and “View live” (Dan Braghis)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">get_api_representation</span></code> method to streamfield blocks allowing the JSON representation in the API to be customised (Marco Fucci)</li>
<li>Added <a class="reference internal" href="index.html#before-copy-page"><span class="std std-ref">before_copy_page</span></a> and <a class="reference internal" href="index.html#after-copy-page"><span class="std std-ref">after_copy_page</span></a> hooks (Matheus Bratfisch)</li>
<li>View live / draft links in the admin now consistently open in a new window (Marco Fucci)</li>
<li><code class="docutils literal notranslate"><span class="pre">ChoiceBlock</span></code> now omits the blank option if the block is required and has a default value (Andreas Nüßlein)</li>
<li>The <code class="docutils literal notranslate"><span class="pre">add_subpage</span></code> view now maintains a <code class="docutils literal notranslate"><span class="pre">next</span></code> URL parameter to specify where to redirect to after completing page creation (Robert Rollins)</li>
<li>The <code class="docutils literal notranslate"><span class="pre">wagtailforms</span></code> module now allows to define custom form submission model, add custom data to CSV export and some other customisations. See <a class="reference internal" href="index.html#document-reference/contrib/forms/customisation"><span class="doc">Form builder customisation</span></a> (Mikalai Radchuk)</li>
<li>The Webpack configuration is now in a subfolder to declutter the project root, and uses environment-specific configurations for smaller bundles in production and easier debugging in development (Janneke Janssen, Thibaud Colas)</li>
<li>Added page titles to title text on action buttons in the explorer, for improved accessibility (Matt Westcott)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Help text for StreamField is now visible and does not cover block controls (Stein Strindhaug)</li>
<li>“X minutes ago” timestamps are now marked for translation (Janneke Janssen, Matt Westcott)</li>
<li>Avoid indexing unsaved field content on <cite>save(update_fields=[…])</cite> operations (Matt Westcott)</li>
<li>Corrected ordering of arguments passed to ModelAdmin <code class="docutils literal notranslate"><span class="pre">get_extra_class_names_for_field_col</span></code> / <code class="docutils literal notranslate"><span class="pre">get_extra_attrs_for_field_col</span></code> methods (Andy Babic)</li>
<li><code class="docutils literal notranslate"><span class="pre">pageurl</span></code> / <code class="docutils literal notranslate"><span class="pre">slugurl</span></code> tags now function when request.site is not available (Tobias McNulty, Matt Westcott)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="django-modelcluster-and-django-taggit-dependencies-updated">
<h6><code class="docutils literal notranslate"><span class="pre">django-modelcluster</span></code> and <code class="docutils literal notranslate"><span class="pre">django-taggit</span></code> dependencies updated<a class="headerlink" href="#django-modelcluster-and-django-taggit-dependencies-updated" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now requires version 3.0 or later of <code class="docutils literal notranslate"><span class="pre">django-modelcluster</span></code> and version 0.20 or later of <code class="docutils literal notranslate"><span class="pre">django-taggit</span></code>; earlier versions are unsupported. In normal circumstances these packages will be upgraded automatically when upgrading Wagtail; however, if your Wagtail project has a requirements file that explicitly specifies an older version, this will need to be updated.</p>
</div>
<div class="section" id="get-context-methods-on-streamfield-blocks-need-updating">
<h6><code class="docutils literal notranslate"><span class="pre">get_context</span></code> methods on StreamField blocks need updating<a class="headerlink" href="#get-context-methods-on-streamfield-blocks-need-updating" title="Permalink to this headline">¶</a></h6>
<p>Previously, <code class="docutils literal notranslate"><span class="pre">get_context</span></code> methods on StreamField blocks returned a dict of variables which would be merged into the calling template’s context before rendering the block template. <code class="docutils literal notranslate"><span class="pre">get_context</span></code> methods now receive a <code class="docutils literal notranslate"><span class="pre">parent_context</span></code> dict, and are responsible for returning the final context dictionary with any new variables merged into it. The old calling convention is now deprecated, and will be phased out in Wagtail 1.11.</p>
<p>In most cases, the method will be calling <code class="docutils literal notranslate"><span class="pre">get_context</span></code> on the superclass, and can be updated by passing the new <code class="docutils literal notranslate"><span class="pre">parent_context</span></code> keyword argument to it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyBlock</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">MyBlock</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">context</span>
</pre></div>
</div>
<p>becomes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyBlock</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parent_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">MyBlock</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">parent_context</span><span class="o">=</span><span class="n">parent_context</span><span class="p">)</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">context</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">get_context</span></code> methods on page models are unaffected by this change.</p>
</div>
</div>
</div>
<span id="document-releases/1.8.2"></span><div class="section" id="wagtail-1-8-2-release-notes">
<h4>Wagtail 1.8.2 release notes<a class="headerlink" href="#wagtail-1-8-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Removed erroneous <code class="docutils literal notranslate"><span class="pre">|safe</span></code> filter from search results template in project template (Karl Hobley)</li>
<li>Avoid indexing unsaved field content on <code class="docutils literal notranslate"><span class="pre">save(update_fields=[...])</span></code> operations (Matt Westcott)</li>
<li>Prevent pages from being recursively copied into themselves (Matheus Bratfisch)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.8.1"></span><div class="section" id="wagtail-1-8-1-release-notes">
<h4>Wagtail 1.8.1 release notes<a class="headerlink" href="#wagtail-1-8-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Reduced <code class="docutils literal notranslate"><span class="pre">Rendition.focal_point_key</span></code> field length to prevent migration failure when upgrading to Wagtail 1.8 on MySQL with <code class="docutils literal notranslate"><span class="pre">utf8</span></code> character encoding (Andy Chosak, Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.8"></span><div class="section" id="wagtail-1-8-release-notes">
<h4>Wagtail 1.8 release notes<a class="headerlink" href="#wagtail-1-8-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<p>Wagtail 1.8 is designated a Long Term Support (LTS) release. Long Term Support releases will continue to receive maintenance updates as necessary to address security and data-loss related issues, up until the next LTS release (typically a period of 8 months).</p>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="new-page-privacy-options">
<h6>New page privacy options<a class="headerlink" href="#new-page-privacy-options" title="Permalink to this headline">¶</a></h6>
<img alt="_images/releasenotes_1_8_pageprivacy.png" src="_images/releasenotes_1_8_pageprivacy.png" />
<p>Access to pages can now be restricted based on user accounts and group membership, rather than just through a shared password. This makes it possible to set up intranet-style sites via the admin, with no additional coding. This feature was developed by Shawn Makinson, Tom Miller, Luca Perico and Matt Westcott.</p>
<p>See: <a class="reference internal" href="index.html#private-pages"><span class="std std-ref">Private pages</span></a></p>
</div>
<div class="section" id="restrictions-on-bulk-deletion-of-pages">
<h6>Restrictions on bulk-deletion of pages<a class="headerlink" href="#restrictions-on-bulk-deletion-of-pages" title="Permalink to this headline">¶</a></h6>
<p>Previously, any user with edit permission over a page and its descendants was able to delete them all as a single action, which led to the risk of accidental deletions. To guard against this, the permission rules have been revised so that a user with basic permissions can only delete pages that have no children; in order to delete a whole subtree, they must individually delete each child page first. A new “bulk delete” permission type has been added which allows a user to delete pages with children, as before; superusers receive this permission implicitly, and so there is no change of behaviour for them.</p>
<p>See: <a class="reference internal" href="index.html#permissions"><span class="std std-ref">Permissions</span></a></p>
<p>This feature was developed by Matt Westcott.</p>
</div>
<div class="section" id="elasticsearch-5-support">
<h6>Elasticsearch 5 support<a class="headerlink" href="#elasticsearch-5-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now supports Elasticsearch 5. See <a class="reference internal" href="index.html#wagtailsearch-backends-elasticsearch"><span class="std std-ref">Elasticsearch Backend</span></a> for configuration details. This feature was developed by Karl Hobley.</p>
</div>
<div class="section" id="permission-limited-admin-breadcrumb">
<h6>Permission-limited admin breadcrumb<a class="headerlink" href="#permission-limited-admin-breadcrumb" title="Permalink to this headline">¶</a></h6>
<p>Breadcrumb links within the admin are now limited to the portion of the page tree that covers all pages the user has permission over. As with the changes to the explorer sidebar menu in Wagtail 1.6, this is a step towards supporting full multi-tenancy (where multiple sites on the same Wagtail installation can be fully isolated from each other through permission configuration). This feature was developed by Jeffrey Chau, Robert Rollins and Matt Westcott.</p>
</div>
<div class="section" id="updated-tutorial">
<h6>Updated tutorial<a class="headerlink" href="#updated-tutorial" title="Permalink to this headline">¶</a></h6>
<p>The “<a class="reference internal" href="index.html#document-getting_started/tutorial"><span class="doc">Your first Wagtail site</span></a>” tutorial has been extensively updated to cover concepts such as dynamic page listings, template context variables, and tagging. This update was contributed by Scot Hacker, with additions from Matt Westcott.</p>
</div>
<div class="section" id="other-features">
<h6>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added support of a custom <code class="docutils literal notranslate"><span class="pre">edit_handler</span></code> for site settings. See <a class="reference internal" href="index.html#edit-handlers-settings"><span class="std std-ref">docs for the site settings module</span></a>. (Axel Haustant)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">get_landing_page_template</span></code> getter method to <code class="docutils literal notranslate"><span class="pre">AbstractForm</span></code> (Gagaro)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">Page.get_admin_display_title</span></code> method to override how the title is displayed in the admin (Henk-Jan van Hasselaar)</li>
<li>Added support for specifying custom HTML attributes for table rows on ModelAdmin index pages. See <a class="reference internal" href="index.html#modeladmin-get-extra-attrs-for-row"><span class="std std-ref">ModelAdmin.get_extra_attrs_for_row()</span></a> (Andy Babic)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">first_common_ancestor</span></code> method to <code class="docutils literal notranslate"><span class="pre">PageQuerySet</span></code> (Tim Heap)</li>
<li>Page chooser now opens at the deepest ancestor page that covers all the pages of the required page type (Tim Heap)</li>
<li><code class="docutils literal notranslate"><span class="pre">PageChooserBlock</span></code> now accepts a <code class="docutils literal notranslate"><span class="pre">target_model</span></code> option to specify the required page type (Tim Heap)</li>
<li>Modeladmin forms now respect <code class="docutils literal notranslate"><span class="pre">fields</span></code> / <code class="docutils literal notranslate"><span class="pre">exclude</span></code> options passed on custom model forms (Thejaswi Puthraya)</li>
<li>Added new StreamField block type <code class="docutils literal notranslate"><span class="pre">StaticBlock</span></code> for blocks that occupy a position in a stream but otherwise have no configuration; see <a class="reference internal" href="index.html#streamfield-staticblock"><span class="std std-ref">StaticBlock</span></a> (Benoît Vogel)</li>
<li>Added new StreamField block type <code class="docutils literal notranslate"><span class="pre">BlockQuoteBlock</span></code> (Scot Hacker)</li>
<li>Updated Cloudflare cache module to use the v4 API (Albert O’Connor)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">exclude_from_explorer</span></code> attribute to the <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> class to allow hiding instances of a page type from Wagtail’s explorer views (Andy Babic)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">above_login</span></code>, <code class="docutils literal notranslate"><span class="pre">below_login</span></code>, <code class="docutils literal notranslate"><span class="pre">fields</span></code> and <code class="docutils literal notranslate"><span class="pre">login_form</span></code> customisation blocks to the login page template - see <a class="reference internal" href="index.html#document-advanced_topics/customisation/admin_templates"><span class="doc">Customising admin templates</span></a> (Tim Heap)</li>
<li><code class="docutils literal notranslate"><span class="pre">ChoiceBlock</span></code> now accepts a callable as the choices list (Mikalai Radchuk)</li>
<li>Redundant action buttons are now omitted from the root page in the explorer (Nick Smith)</li>
<li>Locked pages are now disabled from editing at the browser level (Edd Baldry)</li>
<li>Added <a class="reference internal" href="index.html#wagtail.core.query.PageQuerySet.in_site" title="wagtail.core.query.PageQuerySet.in_site"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wagtail.core.query.PageQuerySet.in_site()</span></code></a> method for filtering page QuerySets to pages within the specified site (Chris Rogers)</li>
<li>Added the ability to override the default index settings for Elasticsearch. See <a class="reference internal" href="index.html#wagtailsearch-backends-elasticsearch"><span class="std std-ref">Elasticsearch Backend</span></a> (PyMan Claudio Marinozzi)</li>
<li>Extra options for the Elasticsearch constructor should be now defined with the new key <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> of the <code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_BACKENDS</span></code> setting (PyMan Claudio Marinozzi)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">AbstractForm</span></code> now respects custom <code class="docutils literal notranslate"><span class="pre">get_template</span></code> methods on the page model (Gagaro)</li>
<li>Use specific page model for the parent page in the explore index (Gagaro)</li>
<li>Remove responsive styles in embed when there is no ratio available (Gagaro)</li>
<li>Parent page link in page search modal no longer disappears on hover (Dan Braghis)</li>
<li>ModelAdmin views now consistently call <code class="docutils literal notranslate"><span class="pre">get_context_data</span></code> (Andy Babic)</li>
<li>Header for search results on the redirects index page now shows the correct count when the listing is paginated (Nick Smith)</li>
<li><code class="docutils literal notranslate"><span class="pre">set_url_paths</span></code> management command is now compatible with Django 1.10 (Benjamin Bach)</li>
<li>Form builder email notifications now output multiple values correctly (Sævar Öfjörð Magnússon)</li>
<li>Closing ‘more’ dropdown on explorer no longer jumps to the top of the page (Ducky)</li>
<li>Users with only publish permission are no longer given implicit permission to delete pages (Matt Westcott)</li>
<li><code class="docutils literal notranslate"><span class="pre">search_garbage_collect</span></code> management command now works when wagtailsearchpromotions is not installed (Morgan Aubert)</li>
<li><code class="docutils literal notranslate"><span class="pre">wagtail.contrib.settings</span></code> context processor no longer fails when <code class="docutils literal notranslate"><span class="pre">request.site</span></code> is unavailable (Diederik van der Boor)</li>
<li><code class="docutils literal notranslate"><span class="pre">TableBlock</span></code> content is now indexed for search (Morgan Aubert)</li>
<li><code class="docutils literal notranslate"><span class="pre">Page.copy()</span></code> is now marked as <code class="docutils literal notranslate"><span class="pre">alters_data</span></code>, to prevent template code from triggering it (Diederik van der Boor)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="unique-together-constraint-on-custom-image-rendition-models-needs-updating">
<h6><code class="docutils literal notranslate"><span class="pre">unique_together</span></code> constraint on custom image rendition models needs updating<a class="headerlink" href="#unique-together-constraint-on-custom-image-rendition-models-needs-updating" title="Permalink to this headline">¶</a></h6>
<p>If your project is using a custom image model (see <a class="reference internal" href="index.html#custom-image-model"><span class="std std-ref">Custom image models</span></a>), you will need to
update the <code class="docutils literal notranslate"><span class="pre">unique_together</span></code> option on the corresponding Rendition model when upgrading to Wagtail 1.8. Change the line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="s1">&#39;focal_point_key&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;filter_spec&#39;</span><span class="p">,</span> <span class="s1">&#39;focal_point_key&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>You will then be able to run <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">makemigrations</span></code> and <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">migrate</span></code> as normal.</p>
<p>Additionally, third-party code that accesses the Filter and Rendition models directly should note the following and make updates where applicable:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Filter</span></code> will no longer be a Django model as of Wagtail 1.9, and as such, ORM operations on it (such as <code class="docutils literal notranslate"><span class="pre">save()</span></code> and <code class="docutils literal notranslate"><span class="pre">Filter.objects</span></code>) are deprecated. It should be instantiated and used as an in-memory object instead - for example, <code class="docutils literal notranslate"><span class="pre">flt,</span> <span class="pre">created</span> <span class="pre">=</span> <span class="pre">Filter.objects.get_or_create(spec='fill-100x100')</span></code> should become <code class="docutils literal notranslate"><span class="pre">flt</span> <span class="pre">=</span> <span class="pre">Filter(spec='fill-100x100')</span></code>.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">filter</span></code> field of Rendition models is no longer in use; lookups should instead be performed on the <code class="docutils literal notranslate"><span class="pre">filter_spec</span></code> field, which contains a filter spec string such as <code class="docutils literal notranslate"><span class="pre">'fill-100x100'</span></code>.</li>
</ul>
</div>
<div class="section" id="wagtail-wagtailimages-models-get-image-model-has-moved">
<h6><code class="docutils literal notranslate"><span class="pre">wagtail.wagtailimages.models.get_image_model</span></code> has moved<a class="headerlink" href="#wagtail-wagtailimages-models-get-image-model-has-moved" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">get_image_model</span></code> function should now be imported from <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailimages</span></code> rather than <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailimages.models</span></code>. See <a class="reference internal" href="index.html#custom-image-model-referring-to-image-model"><span class="std std-ref">Referring to the image model</span></a>.</p>
</div>
<div class="section" id="non-administrators-now-need-bulk-delete-permission-to-delete-pages-with-children">
<h6>Non-administrators now need ‘bulk delete’ permission to delete pages with children<a class="headerlink" href="#non-administrators-now-need-bulk-delete-permission-to-delete-pages-with-children" title="Permalink to this headline">¶</a></h6>
<p>As a precaution against accidental data loss, this release introduces a new “bulk delete” permission on pages, which can be set through the Settings -&gt; Groups area. Non-administrator users must have this permission in order to delete pages that have children; a user without this permission would have to delete each child individually before deleting the parent. By default, no groups are assigned this new permission. If you wish to restore the previous behaviour, and don’t want to configure permissions manually through the admin interface, you can do so with a data migration. Create an empty migration using <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">makemigrations</span> <span class="pre">myapp</span> <span class="pre">--empty</span> <span class="pre">--name</span> <span class="pre">assign_bulk_delete_permission</span></code> (replacing <code class="docutils literal notranslate"><span class="pre">myapp</span></code> with the name of one of your project’s apps) and edit the migration file to contain the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">migrations</span>


<span class="k">def</span> <span class="nf">add_bulk_delete_permission</span><span class="p">(</span><span class="n">apps</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find all groups with add/edit page permissions, and assign them bulk_delete permission&quot;&quot;&quot;</span>
    <span class="n">GroupPagePermission</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s1">&#39;wagtailcore&#39;</span><span class="p">,</span> <span class="s1">&#39;GroupPagePermission&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">page_id</span> <span class="ow">in</span> <span class="n">GroupPagePermission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">permission_type__in</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;edit&#39;</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;page&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">():</span>
        <span class="n">GroupPagePermission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">group_id</span><span class="o">=</span><span class="n">group_id</span><span class="p">,</span> <span class="n">page_id</span><span class="o">=</span><span class="n">page_id</span><span class="p">,</span> <span class="n">permission_type</span><span class="o">=</span><span class="s1">&#39;bulk_delete&#39;</span>
        <span class="p">)</span>


<span class="k">def</span> <span class="nf">remove_bulk_delete_permission</span><span class="p">(</span><span class="n">apps</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">):</span>
    <span class="n">GroupPagePermission</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s1">&#39;wagtailcore&#39;</span><span class="p">,</span> <span class="s1">&#39;GroupPagePermission&#39;</span><span class="p">)</span>
    <span class="n">GroupPagePermission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">permission_type</span><span class="o">=</span><span class="s1">&#39;bulk_delete&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Migration</span><span class="p">(</span><span class="n">migrations</span><span class="o">.</span><span class="n">Migration</span><span class="p">):</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># keep the original dependencies line</span>
    <span class="p">]</span>

    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">migrations</span><span class="o">.</span><span class="n">RunPython</span><span class="p">(</span><span class="n">add_bulk_delete_permission</span><span class="p">,</span> <span class="n">remove_bulk_delete_permission</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="cloudflare-cache-module-now-requires-a-zoneid-setting">
<h6>Cloudflare cache module now requires a <code class="docutils literal notranslate"><span class="pre">ZONEID</span></code> setting<a class="headerlink" href="#cloudflare-cache-module-now-requires-a-zoneid-setting" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailfrontendcache.backends.CloudflareBackend</span></code> module has been updated to use Cloudflare’s v4 API, replacing the previous v1 implementation (which is <a class="reference external" href="https://www.cloudflare.com/docs/client-api/">unsupported as of November 9th, 2016</a>). The new API requires users to supply a <em>zone identifier</em>, which should be passed as the <code class="docutils literal notranslate"><span class="pre">ZONEID</span></code> field of the <code class="docutils literal notranslate"><span class="pre">WAGTAILFRONTENDCACHE</span></code> setting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILFRONTENDCACHE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cloudflare&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.contrib.wagtailfrontendcache.backends.CloudflareBackend&#39;</span><span class="p">,</span>
        <span class="s1">&#39;EMAIL&#39;</span><span class="p">:</span> <span class="s1">&#39;your-cloudflare-email-address@example.com&#39;</span><span class="p">,</span>
        <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="s1">&#39;your cloudflare api token&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ZONEID&#39;</span><span class="p">:</span> <span class="s1">&#39;your cloudflare domain zone id&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For details of how to obtain the zone identifier, see <a class="reference external" href="https://api.cloudflare.com/#getting-started-resource-ids">the Cloudflare API documentation</a>.</p>
</div>
<div class="section" id="extra-options-for-the-elasticsearch-constructor-should-be-now-defined-with-the-new-key-options-of-the-wagtailsearch-backends-setting">
<h6>Extra options for the Elasticsearch constructor should be now defined with the new key <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> of the <code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_BACKENDS</span></code> setting<a class="headerlink" href="#extra-options-for-the-elasticsearch-constructor-should-be-now-defined-with-the-new-key-options-of-the-wagtailsearch-backends-setting" title="Permalink to this headline">¶</a></h6>
<p>For the Elasticsearch backend, all extra keys defined in <code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_BACKENDS</span></code> are passed directly to the Elasticsearch constructor. All these keys now should be moved inside the new <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> dictionary. The old behaviour is still supported, but deprecated.</p>
<p>For example, the following configuration changes the connection class that the Elasticsearch <a class="reference external" href="https://elasticsearch-py.readthedocs.io/en/5.0.0/api.html#elasticsearch">connector</a> uses:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">elasticsearch</span> <span class="kn">import</span> <span class="n">RequestsHttpConnection</span>

<span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.wagtailsearch.backends.elasticsearch&#39;</span><span class="p">,</span>
        <span class="s1">&#39;connection_class&#39;</span><span class="p">:</span> <span class="n">RequestsHttpConnection</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As <code class="docutils literal notranslate"><span class="pre">connection_class</span></code> needs to be passed through to the Elasticsearch <a class="reference external" href="https://elasticsearch-py.readthedocs.io/en/5.0.0/api.html#elasticsearch">connector</a>,  it should be moved to the new <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> dictionary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">elasticsearch</span> <span class="kn">import</span> <span class="n">RequestsHttpConnection</span>

<span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.wagtailsearch.backends.elasticsearch&#39;</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;connection_class&#39;</span><span class="p">:</span> <span class="n">RequestsHttpConnection</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-releases/1.7"></span><div class="section" id="wagtail-1-7-release-notes">
<h4>Wagtail 1.7 release notes<a class="headerlink" href="#wagtail-1-7-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="elasticsearch-2-support">
<h6>Elasticsearch 2 support<a class="headerlink" href="#elasticsearch-2-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now supports Elasticsearch 2. Note that you need to change backend in <code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_BACKENDS</span></code>, if you wish to switch to Elasticsearch 2. This feature was developed by Karl Hobley.</p>
<p>See: <a class="reference internal" href="index.html#wagtailsearch-backends-elasticsearch"><span class="std std-ref">Elasticsearch Backend</span></a></p>
</div>
<div class="section" id="new-image-tag-options-for-file-type-and-jpeg-compression-level">
<h6>New image tag options for file type and JPEG compression level<a class="headerlink" href="#new-image-tag-options-for-file-type-and-jpeg-compression-level" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag now supports extra parameters for specifying the image file type and JPEG compression level on a per-tag basis. See <a class="reference internal" href="index.html#output-image-format"><span class="std std-ref">Output image format</span></a> and <a class="reference internal" href="index.html#image-quality"><span class="std std-ref">Image quality</span></a>. This feature was developed by Karl Hobley.</p>
</div>
<div class="section" id="aws-cloudfront-support-added-to-cache-invalidation-module">
<h6>AWS CloudFront support added to cache invalidation module<a class="headerlink" href="#aws-cloudfront-support-added-to-cache-invalidation-module" title="Permalink to this headline">¶</a></h6>
<p>Wagtail’s cache invalidation module can now invalidate pages cached in AWS CloudFront when they are updated or unpublished.
This feature was developed by Rob Moorman.</p>
<p>See: <a class="reference internal" href="index.html#frontendcache-aws-cloudfront"><span class="std std-ref">Amazon CloudFront</span></a></p>
</div>
<div class="section" id="unpublishing-subpages">
<h6>Unpublishing subpages<a class="headerlink" href="#unpublishing-subpages" title="Permalink to this headline">¶</a></h6>
<p>Unpublishing a page now gives the option to unpublish its subpages at the same time. This feature was developed by Jordi Joan.</p>
</div>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">|embed</span></code> filter has been converted into a templatetag <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">embed</span> <span class="pre">%}</span></code> (Janneke Janssen)</li>
<li>The <code class="docutils literal notranslate"><span class="pre">wagtailforms</span></code> module now provides a <code class="docutils literal notranslate"><span class="pre">FormSubmissionPanel</span></code> for displaying details of form submissions; see <a class="reference internal" href="index.html#wagtailforms-formsubmissionpanel"><span class="std std-ref">Displaying form submission information</span></a> for documentation. (João Luiz Lorencetti)</li>
<li>The Wagtail version number can now be obtained as a tuple using <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">wagtail</span> <span class="pre">import</span> <span class="pre">VERSION</span></code> (Tim Heap)</li>
<li><code class="docutils literal notranslate"><span class="pre">send_mail</span></code> logic has been moved from <code class="docutils literal notranslate"><span class="pre">AbstractEmailForm.process_form_submission</span></code> into <code class="docutils literal notranslate"><span class="pre">AbstractEmailForm.send_mail</span></code>. Now it’s easier to override this logic (Tim Leguijt)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">before_create_page</span></code>, <code class="docutils literal notranslate"><span class="pre">before_edit_page</span></code>, <code class="docutils literal notranslate"><span class="pre">before_delete_page</span></code> hooks (Karl Hobley)</li>
<li>Updated font sizes and colours to improve legibility of admin menu and buttons (Stein Strindhaug)</li>
<li>Added pagination to “choose destination” view when moving pages (Nick Smith, Žan Anderle)</li>
<li>Added ability to annotate search results with score - see <a class="reference internal" href="index.html#wagtailsearch-annotating-results-with-score"><span class="std std-ref">Annotating results with score</span></a> (Karl Hobley)</li>
<li>Added ability to limit access to form submissions - see <a class="reference internal" href="index.html#filter-form-submissions-for-user"><span class="std std-ref">filter_form_submissions_for_user</span></a> (Mikalai Radchuk)</li>
<li>Added the ability to configure the number of days search logs are kept for, through the <a class="reference internal" href="index.html#wagtailsearch-hits-max-age"><span class="std std-ref">WAGTAILSEARCH_HITS_MAX_AGE</span></a> setting (Stephen Rice)</li>
<li><code class="docutils literal notranslate"><span class="pre">SnippetChooserBlock</span></code> now supports passing the model name as a string (Nick Smith)</li>
<li>Redesigned account settings / logout area in the sidebar for better clarity (Janneke Janssen)</li>
<li>Pillow’s image optimisation is now applied when saving JPEG images (Karl Hobley)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Migrations for wagtailcore and project template are now reversible (Benjamin Bach)</li>
<li>Migrations no longer depend on wagtailcore and taggit’s <code class="docutils literal notranslate"><span class="pre">__latest__</span></code> migration, logically preventing those apps from receiving new migrations (Matt Westcott)</li>
<li>The default image format label text (‘Full width’, ‘Left-aligned’, ‘Right-aligned’) is now localised (Mikalai Radchuk)</li>
<li>Text on the front-end ‘password required’ form is now marked for translation (Janneke Janssen)</li>
<li>Text on the page view restriction form is now marked for translation (Luiz Boaretto)</li>
<li>Fixed toggle behaviour of userbar on mobile (Robert Rollins)</li>
<li>Image rendition / document file deletion now happens on a post_delete signal, so that files are not lost if the deletion does not proceed (Janneke Janssen)</li>
<li>“Your recent edits” list on dashboard no longer leaves out pages that another user has subsequently edited (Michael Cordover, Kees Hink, João Luiz Lorencetti)</li>
<li><code class="docutils literal notranslate"><span class="pre">InlinePanel</span></code> now accepts a <code class="docutils literal notranslate"><span class="pre">classname</span></code> parameter as per the documentation (emg36, Matt Westcott)</li>
<li>Disabled use of escape key to revert content of rich text fields, which could cause accidental data loss (Matt Westcott)</li>
<li>Setting <code class="docutils literal notranslate"><span class="pre">USE_THOUSAND_SEPARATOR</span> <span class="pre">=</span> <span class="pre">True</span></code> no longer breaks the rendering of numbers in JS code for InlinePanel (Mattias Loverot, Matt Westcott)</li>
<li>Images / documents pagination now preserves GET parameters (Bojan Mihelac)</li>
<li>Wagtail’s UserProfile model now sets a related_name of <code class="docutils literal notranslate"><span class="pre">wagtail_userprofile</span></code> to avoid naming collisions with other user profile models (Matt Westcott)</li>
<li>Non-text content is now preserved when adding or editing a link within rich text (Matt Westcott)</li>
<li>Fixed preview when <code class="docutils literal notranslate"><span class="pre">SECURE_SSL_REDIRECT</span> <span class="pre">=</span> <span class="pre">True</span></code> (Aymeric Augustin)</li>
<li>Prevent hang when truncating an image filename without an extension (Ricky Robinett)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="project-template-s-initial-migration-should-not-depend-on-wagtailcore-latest">
<h6>Project template’s initial migration should not depend on <code class="docutils literal notranslate"><span class="pre">wagtailcore.__latest__</span></code><a class="headerlink" href="#project-template-s-initial-migration-should-not-depend-on-wagtailcore-latest" title="Permalink to this headline">¶</a></h6>
<p>On projects created under previous releases of Wagtail, the <code class="docutils literal notranslate"><span class="pre">home/migrations/0001_initial.py</span></code> migration created by the <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">start</span></code> command contains the following dependency line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;wagtailcore&#39;</span><span class="p">,</span> <span class="s1">&#39;__latest__&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This may produce <code class="docutils literal notranslate"><span class="pre">InconsistentMigrationHistory</span></code> errors under Django 1.10 when upgrading Wagtail, since Django interprets this to mean that no new migrations can legally be added to wagtailcore after this migration is applied. This line should be changed to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;wagtailcore&#39;</span><span class="p">,</span> <span class="s1">&#39;0029_unicode_slugfield_dj19&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-image-models-require-a-data-migration-for-the-new-filter-spec-field">
<span id="filter-spec-migration"></span><h6>Custom image models require a data migration for the new <code class="docutils literal notranslate"><span class="pre">filter_spec</span></code> field<a class="headerlink" href="#custom-image-models-require-a-data-migration-for-the-new-filter-spec-field" title="Permalink to this headline">¶</a></h6>
<p>The data model for image renditions will be changed in Wagtail 1.8 to eliminate <code class="docutils literal notranslate"><span class="pre">Filter</span></code> as a model. Wagtail sites using a custom image model (see <a class="reference internal" href="index.html#custom-image-model"><span class="std std-ref">Custom image models</span></a>) need to have a schema and data migration in place prior to upgrading to Wagtail 1.8. To create these migrations:</p>
<ul>
<li><p class="first">Run <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">makemigrations</span></code> to create the schema migration</p>
</li>
<li><p class="first">Run <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">makemigrations</span> <span class="pre">--empty</span> <span class="pre">myapp</span></code> (replacing <code class="docutils literal notranslate"><span class="pre">myapp</span></code> with the name of the app containing the custom image model) to create an empty migration</p>
</li>
<li><p class="first">Edit the created migration to contain:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.wagtailimages.utils</span> <span class="kn">import</span> <span class="n">get_fill_filter_spec_migrations</span>
</pre></div>
</div>
<p>and, for the <code class="docutils literal notranslate"><span class="pre">operations</span></code> list:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">forward</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="n">get_fill_filter_spec_migrations</span><span class="p">(</span><span class="s1">&#39;myapp&#39;</span><span class="p">,</span> <span class="s1">&#39;CustomRendition&#39;</span><span class="p">)</span>
<span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">migrations</span><span class="o">.</span><span class="n">RunPython</span><span class="p">(</span><span class="n">forward</span><span class="p">,</span> <span class="n">reverse</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>replacing <code class="docutils literal notranslate"><span class="pre">myapp</span></code> and <code class="docutils literal notranslate"><span class="pre">CustomRendition</span></code> with the app and model name for the custom rendition model.</p>
</li>
</ul>
</div>
<div class="section" id="embed-template-filter-is-now-a-template-tag">
<h6><code class="docutils literal notranslate"><span class="pre">embed</span></code> template filter is now a template tag<a class="headerlink" href="#embed-template-filter-is-now-a-template-tag" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">embed</span></code> template filter, used to translate the URL of a media resource (such as a YouTube video) into a corresponding embeddable HTML fragment, has now been converted to a template tag. Any template code such as:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailembeds_tags</span> <span class="cp">%}</span>
...
<span class="cp">{{</span> <span class="nv">my_media_url</span><span class="o">|</span><span class="nf">embed</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>should now be rewritten as:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">wagtailembeds_tags</span> <span class="cp">%}</span>
...
<span class="cp">{%</span> <span class="k">embed</span> <span class="nv">my_media_url</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-releases/1.6.3"></span><div class="section" id="wagtail-1-6-3-release-notes">
<h4>Wagtail 1.6.3 release notes<a class="headerlink" href="#wagtail-1-6-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Restore compatibility with django-debug-toolbar 1.5 (Matt Westcott)</li>
<li>Edits to StreamFields are no longer ignored in page edits on Django &gt;=1.10.1 when a default value exists (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.6.2"></span><div class="section" id="wagtail-1-6-2-release-notes">
<h4>Wagtail 1.6.2 release notes<a class="headerlink" href="#wagtail-1-6-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Initial values of checkboxes on group permission edit form now are visible on Django 1.10 (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.6.1"></span><div class="section" id="wagtail-1-6-1-release-notes">
<h4>Wagtail 1.6.1 release notes<a class="headerlink" href="#wagtail-1-6-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added <code class="docutils literal notranslate"><span class="pre">WAGTAIL_ALLOW_UNICODE_SLUGS</span></code> setting to make Unicode support optional in page slugs (Matt Westcott)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Wagtail’s middleware classes are now compatible with Django 1.10’s <a class="reference external" href="https://docs.djangoproject.com/en/stable/releases/1.10/#new-style-middleware">new-style middleware</a> (Karl Hobley)</li>
<li>The <a class="reference internal" href="index.html#wagtail.core.models.Page.can_create_at" title="wagtail.core.models.Page.can_create_at"><code class="xref py py-meth docutils literal notranslate"><span class="pre">can_create_at()</span></code></a> method is now checked in the create page view (Mikalai Radchuk)</li>
<li>Fixed regression on Django 1.10.1 causing Page subclasses to fail to use PageManager (Matt Westcott)</li>
<li>ChoiceBlocks with lazy translations as option labels no longer break Elasticsearch indexing (Matt Westcott)</li>
<li>The page editor no longer fails to load JavaScript files with <code class="docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code> (Matt Westcott)</li>
<li>Django 1.10 enables client-side validation for all forms by default, but it fails to handle all the nuances of how forms are used in Wagtail. The client-side validation has been disabled for the Wagtail UI (Matt Westcott)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="multi-level-inheritance-and-custom-managers">
<h6>Multi-level inheritance and custom managers<a class="headerlink" href="#multi-level-inheritance-and-custom-managers" title="Permalink to this headline">¶</a></h6>
<p>The inheritance rules for <a class="reference internal" href="index.html#id2"><span class="std std-ref">Custom Page managers</span></a> have been updated to match Django’s standard behaviour. In the vast majority of scenarios there will be no change. However, in the specific case where a page model with a custom <code class="docutils literal notranslate"><span class="pre">objects</span></code> manager is subclassed further, the subclass will be assigned a plain <code class="docutils literal notranslate"><span class="pre">Manager</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">PageManager</span></code>, and will now need to explicitly override this with a <code class="docutils literal notranslate"><span class="pre">PageManager</span></code> to function correctly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EventPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="n">EventManager</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">SpecialEventPage</span><span class="p">(</span><span class="n">EventPage</span><span class="p">):</span>
    <span class="c1"># Previously SpecialEventPage.objects would be set to a PageManager automatically;</span>
    <span class="c1"># this now needs to be set explicitly</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="n">PageManager</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-releases/1.6"></span><div class="section" id="wagtail-1-6-release-notes">
<h4>Wagtail 1.6 release notes<a class="headerlink" href="#wagtail-1-6-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="django-1-10-support">
<h6>Django 1.10 support<a class="headerlink" href="#django-1-10-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail is now compatible with Django 1.10. Thanks to Mikalai Radchuk and Paul J Stevens for developing this, and to Tim Graham for reviewing and additional Django core assistance.</p>
</div>
<div class="section" id="include-block-tag-for-improved-streamfield-template-inclusion">
<h6><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">%}</span></code> tag for improved StreamField template inclusion<a class="headerlink" href="#include-block-tag-for-improved-streamfield-template-inclusion" title="Permalink to this headline">¶</a></h6>
<p>In previous releases, the standard way of rendering the HTML content of a StreamField was through a simple variable template tag, such as <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">page.body</span> <span class="pre">}}</span></code>. This had the drawback that any templates used in the StreamField rendering would not inherit variables from the parent template’s context, such as <code class="docutils literal notranslate"><span class="pre">page</span></code> and <code class="docutils literal notranslate"><span class="pre">request</span></code>. To address this, a new template tag <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include_block</span> <span class="pre">page.body</span> <span class="pre">%}</span></code> has been introduced as the new recommended way of outputting Streamfield content - this replicates the behaviour of Django’s <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">%}</span></code> tag, passing on the full template context by default. For full documentation, see <a class="reference internal" href="index.html#streamfield-template-rendering"><span class="std std-ref">Template rendering</span></a>. This feature was developed by Matt Westcott, and additionally ported to Jinja2 (see: <a class="reference internal" href="index.html#document-reference/jinja2"><span class="doc">Jinja2 template support</span></a>) by Mikalai Radchuk.</p>
</div>
<div class="section" id="unicode-page-slugs">
<h6>Unicode page slugs<a class="headerlink" href="#unicode-page-slugs" title="Permalink to this headline">¶</a></h6>
<p>Page URL slugs can now contain Unicode characters, when using Django 1.9 or above. This feature was developed by Behzad Nategh.</p>
</div>
<div class="section" id="permission-limited-explorer-menu">
<h6>Permission-limited explorer menu<a class="headerlink" href="#permission-limited-explorer-menu" title="Permalink to this headline">¶</a></h6>
<p>The explorer sidebar menu now limits the displayed pages to the ones the logged-in user has permission for. For example, if a user has permission over the pages MegaCorp / Departments / Finance and MegaCorp / Departments / HR, then their menu will begin at “Departments”. This reduces the amount of “drilling-down” the user has to do, and is an initial step towards supporting fully independent sites on the same Wagtail installation. This feature was developed by Matt Westcott and Robert Rollins, California Institute of Technology.</p>
</div>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Image upload form in image chooser now performs client side validation so that the selected file is not lost in the submission (Jack Paine)</li>
<li>oEmbed URL for audioBoom was updated (Janneke Janssen)</li>
<li>Remember tree location in page chooser when switching between Internal / External / Email link (Matt Westcott)</li>
<li><code class="docutils literal notranslate"><span class="pre">FieldRowPanel</span></code> now creates equal-width columns automatically if <code class="docutils literal notranslate"><span class="pre">col*</span></code> classnames are not specified (Chris Rogers)</li>
<li>Form builder now validates against multiple fields with the same name (Richard McMillan)</li>
<li>The ‘choices’ field on the form builder no longer has a maximum length (Johannes Spielmann)</li>
<li>Multiple ChooserBlocks inside a StreamField are now prefetched in bulk, for improved performance (Michael van Tellingen, Roel Bruggink, Matt Westcott)</li>
<li>Added new EmailBlock and IntegerBlock (Oktay Altay)</li>
<li>Added a new FloatBlock, DecimalBlock and a RegexBlock (Oktay Altay, Andy Babic)</li>
<li>Wagtail version number is now shown on the settings menu (Chris Rogers)</li>
<li>Added a system check to validate that fields listed in <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> are defined on the model (Josh Schneier)</li>
<li>Added formal APIs for customising the display of StructBlock forms within the page editor - see <a class="reference internal" href="index.html#custom-editing-interfaces-for-structblock"><span class="std std-ref">Custom editing interfaces for StructBlock</span></a> (Matt Westcott)</li>
<li><code class="docutils literal notranslate"><span class="pre">wagtailforms.models.AbstractEmailForm</span></code> now supports multiple email recipients (Serafeim Papastefanos)</li>
<li>Added ability to delete users through Settings -&gt; Users (Vincent Audebert; thanks also to Ludolf Takens and Tobias Schmidt for alternative implementations)</li>
<li>Page previews now pass additional HTTP headers, to simulate the page being viewed by the logged-in user and avoid clashes with middleware (Robert Rollins)</li>
<li>Added back buttons to page delete and unpublish confirmation screens (Matt Westcott)</li>
<li>Recognise Flickr embed URLs using HTTPS (Danielle Madeley)</li>
<li>Success message when publishing a page now correctly respects custom URLs defined on the specific page class (Chris Darko)</li>
<li>Required blocks inside StreamField are now indicated with asterisks (Stephen Rice)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Email templates and document uploader now support custom <code class="docutils literal notranslate"><span class="pre">STATICFILES_STORAGE</span></code> (Jonny Scholes)</li>
<li>Removed alignment options (deprecated in HTML and not rendered by Wagtail) from <code class="docutils literal notranslate"><span class="pre">TableBlock</span></code> context menu (Moritz Pfeiffer)</li>
<li>Fixed incorrect CSS path on ModelAdmin’s “choose a parent page” view</li>
<li>Prevent empty redirect by overnormalisation</li>
<li>“Remove link” button in rich text editor didn’t trigger “edit” event, leading to the change to sometimes not be persisted (Matt Westcott)</li>
<li><code class="docutils literal notranslate"><span class="pre">RichText</span></code> values can now be correctly evaluated as booleans (Mike Dingjan, Bertrand Bordage)</li>
<li>wagtailforms no longer assumes an .html extension when determining the landing page template filename (kakulukia)</li>
<li>Fixed styling glitch on bi-colour icon + text buttons in Chrome (Janneke Janssen)</li>
<li>StreamField can now be used in an InlinePanel (Gagaro)</li>
<li>StreamField block renderings using templates no longer undergo double escaping when using Jinja2 (Aymeric Augustin)</li>
<li>RichText objects no longer undergo double escaping when using Jinja2 (Aymeric Augustin, Matt Westcott)</li>
<li>Saving a page by pressing enter key no longer triggers a “Changes may not be saved message” (Sean Muck, Matt Westcott)</li>
<li>RoutablePageMixin no longer breaks in the presence of instance-only attributes such as those generated by FileFields (Fábio Macêdo Mendes)</li>
<li>The <code class="docutils literal notranslate"><span class="pre">--schema-only</span></code> flag on update_index no longer expects an argument (Karl Hobley)</li>
<li>Added file handling to support custom user add/edit forms with images/files (Eraldo Energy)</li>
<li>Placeholder text in modeladmin search now uses the correct template variable (Adriaan Tijsseling)</li>
<li>Fixed bad SQL syntax for updating URL paths on Microsoft SQL Server (Jesse Legg)</li>
<li>Added workaround for Django 1.10 bug <a class="reference external" href="https://code.djangoproject.com/ticket/27037">https://code.djangoproject.com/ticket/27037</a> causing forms with file upload fields to fail validation (Matt Westcott)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="form-builder-formfield-models-require-a-migration">
<h6>Form builder <code class="docutils literal notranslate"><span class="pre">FormField</span></code> models require a migration<a class="headerlink" href="#form-builder-formfield-models-require-a-migration" title="Permalink to this headline">¶</a></h6>
<p>There are some changes in the <code class="docutils literal notranslate"><span class="pre">wagtailforms.models.AbstractFormField</span></code> model:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">choices</span></code> field has been changed from a <code class="docutils literal notranslate"><span class="pre">CharField</span></code> to a <code class="docutils literal notranslate"><span class="pre">TextField</span></code>, to allow it to be of unlimited length;</li>
<li>The help text for the <code class="docutils literal notranslate"><span class="pre">to_address</span></code> field has been changed: it now gives more information on how to specify multiple addresses.</li>
</ul>
<p>These changes require migration. If you are using the <code class="docutils literal notranslate"><span class="pre">wagtailforms</span></code> module in your project, you will need to run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">makemigrations</span></code> and <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></code> after upgrading, in order to apply changes to your form page models.</p>
</div>
<div class="section" id="tagsearchable-needs-removing-from-custom-image-document-model-migrations">
<h6><code class="docutils literal notranslate"><span class="pre">TagSearchable</span></code> needs removing from custom image / document model migrations<a class="headerlink" href="#tagsearchable-needs-removing-from-custom-image-document-model-migrations" title="Permalink to this headline">¶</a></h6>
<p>The mixin class <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailadmin.taggable.TagSearchable</span></code>, used internally by image and document models, has been deprecated. If you are using custom image or document models in your project, the migration(s) which created them will contain frozen references to <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailadmin.taggable.TagSearchable</span></code>, which must now be removed. The line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">wagtail.wagtailadmin.taggable</span>
</pre></div>
</div>
<p>should be replaced by:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">wagtail.wagtailsearch.index</span>
</pre></div>
</div>
<p>and the line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bases</span><span class="o">=</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">wagtail</span><span class="o">.</span><span class="n">wagtailadmin</span><span class="o">.</span><span class="n">taggable</span><span class="o">.</span><span class="n">TagSearchable</span><span class="p">),</span>
</pre></div>
</div>
<p>should be updated to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bases</span><span class="o">=</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">wagtail</span><span class="o">.</span><span class="n">wagtailsearch</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">Indexed</span><span class="p">),</span>
</pre></div>
</div>
</div>
<div class="section" id="render-and-render-basic-methods-on-streamfield-blocks-now-accept-a-context-keyword-argument">
<h6><code class="docutils literal notranslate"><span class="pre">render</span></code> and <code class="docutils literal notranslate"><span class="pre">render_basic</span></code> methods on StreamField blocks now accept a <code class="docutils literal notranslate"><span class="pre">context</span></code> keyword argument<a class="headerlink" href="#render-and-render-basic-methods-on-streamfield-blocks-now-accept-a-context-keyword-argument" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">render</span></code> and <code class="docutils literal notranslate"><span class="pre">render_basic</span></code> methods on <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailcore.blocks.Block</span></code> have been updated to accept an optional <code class="docutils literal notranslate"><span class="pre">context</span></code> keyword argument, a template context to use when rendering the block. If you have defined any custom StreamField blocks that override either of these methods, the method signature now needs to be updated to include this keyword argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyBlock</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">render_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>should now become:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyBlock</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">render_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-releases/1.5.3"></span><div class="section" id="wagtail-1-5-3-release-notes">
<h4>Wagtail 1.5.3 release notes<a class="headerlink" href="#wagtail-1-5-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Pin html5lib to version 0.999999 to prevent breakage caused by internal API changes (Liam Brenner)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.5.2"></span><div class="section" id="wagtail-1-5-2-release-notes">
<h4>Wagtail 1.5.2 release notes<a class="headerlink" href="#wagtail-1-5-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Fixed regression in 1.5.1 on editing external links (Stephen Rice)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.5.1"></span><div class="section" id="wagtail-1-5-1-release-notes">
<h4>Wagtail 1.5.1 release notes<a class="headerlink" href="#wagtail-1-5-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>When editing a document link in rich text, the document ID is no longer erroneously interpreted as a page ID (Stephen Rice)</li>
<li>Removing embedded media from rich text by mouse click action now gets correctly registered as a change to the field (Loic Teixeira)</li>
<li>Rich text editor is no longer broken in InlinePanels (Matt Westcott, Gagaro)</li>
<li>Rich text editor is no longer broken in settings (Matt Westcott)</li>
<li>Link tooltip now shows correct urls for newly inserted document links (Matt Westcott)</li>
<li>Now page chooser (in a rich text editor) opens up at the link’s parent page, rather than at the page itself (Matt Westcott)</li>
<li>Reverted fix for explorer menu scrolling with page content, as it blocked access to menus that exceed screen height</li>
<li>Image listing in the image chooser no longer becomes unpaginated after an invalid upload form submission (Stephen Rice)</li>
<li>Confirmation message on the ModelAdmin delete view no longer errors if the model’s string representation depends on the primary key (Yannick Chabbert)</li>
<li>Applied correct translation tags for ‘permanent’ / ‘temporary’ labels on redirects (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.5"></span><div class="section" id="wagtail-1-5-release-notes">
<h4>Wagtail 1.5 release notes<a class="headerlink" href="#wagtail-1-5-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="reorganised-page-explorer-actions">
<h6>Reorganised page explorer actions<a class="headerlink" href="#reorganised-page-explorer-actions" title="Permalink to this headline">¶</a></h6>
<img alt="_images/releasenotes_1_5_explorermenu.png" src="_images/releasenotes_1_5_explorermenu.png" />
<p>The action buttons on the page explorer have been reorganised to reduce clutter, and lesser-used actions have been moved to a “More” dropdown. A new hook <a class="reference internal" href="index.html#register-page-listing-buttons"><span class="std std-ref">register_page_listing_buttons</span></a> has been added for adding custom action buttons to the page explorer.</p>
</div>
<div class="section" id="modeladmin">
<h6>ModelAdmin<a class="headerlink" href="#modeladmin" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now includes an app <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.modeladmin</span></code> (previously available separately as the <a class="reference external" href="https://github.com/rkhleics/wagtailmodeladmin">wagtailmodeladmin</a> package) which allows you to configure arbitrary Django models to be listed, added and edited through the Wagtail admin.</p>
<img alt="_images/releasenotes_1_5_modeladmin.png" src="_images/releasenotes_1_5_modeladmin.png" />
<p>See <a class="reference internal" href="index.html#document-reference/contrib/modeladmin/index"><span class="doc">ModelAdmin</span></a> for full documentation. This feature was developed by Andy Babic.</p>
</div>
<div class="section" id="tableblock">
<h6>TableBlock<a class="headerlink" href="#tableblock" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">TableBlock</span></code>, a new StreamField block type for editing table-based content, is now available through the <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.table_block</span></code> module.</p>
<img alt="_images/screen40_table_block1.png" src="_images/screen40_table_block1.png" />
<p>See <a class="reference internal" href="index.html#document-reference/contrib/table_block"><span class="doc">TableBlock</span></a> for documentation. This feature was developed by Moritz Pfeiffer, David Seddon and Brad Busenius.</p>
</div>
<div class="section" id="improved-link-handling-in-rich-text">
<h6>Improved link handling in rich text<a class="headerlink" href="#improved-link-handling-in-rich-text" title="Permalink to this headline">¶</a></h6>
<img alt="_images/releasenotes_1_5_unlink.gif" src="_images/releasenotes_1_5_unlink.gif" />
<p>The user experience around inserting, editing and removing links inside rich text areas has been greatly improved: link destinations are shown as tooltips, and existing links can be edited as well as unlinked. This feature was developed by Loic Teixeira.</p>
</div>
<div class="section" id="improvements-to-the-image-serve-view">
<h6>Improvements to the “Image serve view”<a class="headerlink" href="#improvements-to-the-image-serve-view" title="Permalink to this headline">¶</a></h6>
<p><a class="reference internal" href="index.html#using-images-outside-wagtail"><span class="std std-ref">Dynamic image serve view</span></a></p>
<p>This view, which is used for requesting image thumbnails from an external app, has had some improvements made to it in this release.</p>
<ul class="simple">
<li>A <a class="reference internal" href="index.html#image-serve-view-redirect-action"><span class="std std-ref">“redirect” action</span></a> has been added which will redirect the user to where the resized image is hosted rather than serving it from the app. This may be beneficial for performance if the images are hosted externally (eg, S3)</li>
<li>It now takes an optional extra path component which can be used for appending a filename to the end of the URL</li>
<li>The key is now configurable on the view so you don’t have to use your project’s <code class="docutils literal notranslate"><span class="pre">SECRET_KEY</span></code></li>
<li>It’s been refactored into a class based view and you can now create multiple serve views with different image models and/or keys</li>
<li>It now supports <a class="reference internal" href="index.html#image-serve-view-sendfile"><span class="std std-ref">serving image files using django-sendfile</span></a> (Thanks to Yannick Chabbert for implementing this)</li>
</ul>
</div>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Password reset email now reminds the user of their username (Matt Westcott)</li>
<li>Added <a class="reference internal" href="index.html#settings-tag-jinja2"><span class="std std-ref">jinja2 support</span></a> for the  <code class="docutils literal notranslate"><span class="pre">settings</span></code> template tag (Tim Heap)</li>
<li>Added ‘revisions’ action to pages list (Roel Bruggink)</li>
<li>Added a hook <a class="reference internal" href="index.html#insert-global-admin-js"><span class="std std-ref">insert_global_admin_js</span></a> for inserting custom JavaScript throughout the admin backend (Tom Dyson)</li>
<li>Recognise instagram embed URLs with <code class="docutils literal notranslate"><span class="pre">www</span></code> prefix (Matt Westcott)</li>
<li>The type of the <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> attribute on <code class="docutils literal notranslate"><span class="pre">Page</span></code> models (and other searchable models) has changed from a tuple to a list (see upgrade consideration below) (Tim Heap)</li>
<li>Use <cite>PasswordChangeForm</cite> when user changes their password, requiring the user to enter their current password (Matthijs Melissen)</li>
<li>Highlight current day in date picker (Jonas Lergell)</li>
<li>Eliminated the deprecated <code class="docutils literal notranslate"><span class="pre">register.assignment_tag</span></code> on Django 1.9 (Josh Schneier)</li>
<li>Increased size of Save button on site settings (Liam Brenner)</li>
<li>Optimised Site.find_for_request to only perform one database query (Matthew Downey)</li>
<li>Notification messages on creating / editing sites now include the site name if specified (Chris Rogers)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">--schema-only</span></code> option to <code class="docutils literal notranslate"><span class="pre">update_index</span></code> management command</li>
<li>Added meaningful default icons to <code class="docutils literal notranslate"><span class="pre">StreamField</span></code> blocks (Benjamin Bach)</li>
<li>Added title text to action buttons in the page explorer (Liam Brenner)</li>
<li>Changed project template to explicitly import development settings via <code class="docutils literal notranslate"><span class="pre">settings.dev</span></code> (Tomas Olander)</li>
<li>Improved L10N and I18N for revisions list (Roel Bruggink)</li>
<li>The multiple image uploader now displays details of server errors (Nigel Fletton)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">WAGTAIL_APPEND_SLASH</span></code> setting to determine whether page URLs end in a trailing slash - see <a class="reference internal" href="index.html#append-slash"><span class="std std-ref">Append Slash</span></a> (Andrew Tork Baker)</li>
<li>Added auto resizing text field, richtext field, and snippet chooser to styleguide (Liam Brenner)</li>
<li>Support field widget media inside <code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> blocks (Karl Hobley)</li>
<li>Spinner was added to Save button on site settings (Liam Brenner)</li>
<li>Added success message after logout from Admin (Liam Brenner)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">get_upload_to</span></code> method to <code class="docutils literal notranslate"><span class="pre">AbstractRendition</span></code> which, when overridden, allows control over where image renditions are stored (Rob Moggach and Matt Westcott)</li>
<li>Added a mechanism to customise the add / edit user forms for custom user models - see <a class="reference internal" href="index.html#document-advanced_topics/customisation/custom_user_models"><span class="doc">Custom user models</span></a> (Nigel Fletton)</li>
<li>Added internal provision for swapping in alternative rich text editors (Karl Hobley)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>The currently selected day is now highlighted only in the correct month in date pickers (Jonas Lergell)</li>
<li>Fixed crash when an image without a source file was resized with the “dynamic serve view”</li>
<li>Registered settings admin menu items now show active correctly (Matthew Downey)</li>
<li>Direct usage of <code class="docutils literal notranslate"><span class="pre">Document</span></code> model replaced with <code class="docutils literal notranslate"><span class="pre">get_document_model</span></code> function in <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailmedusa</span></code> and in <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailapi</span></code></li>
<li>Failures on sending moderation notification emails now produce a warning, rather than crashing the admin page outright (Matt Fozard)</li>
<li>All admin forms that could potentially include file upload fields now specify <code class="docutils literal notranslate"><span class="pre">multipart/form-data</span></code> where appropriate (Tim Heap)</li>
<li>REM units in Wagtailuserbar caused incorrect spacing (Vincent Audebert)</li>
<li>Explorer menu no longer scrolls with page content (Vincent Audebert)</li>
<li><code class="docutils literal notranslate"><span class="pre">decorate_urlpatterns</span></code> now uses <code class="docutils literal notranslate"><span class="pre">functools.update_wrapper</span></code> to keep view names and docstrings (Mario César)</li>
<li>StreamField block controls are no longer hidden by the StreamField menu when prepending a new block (Vincent Audebert)</li>
<li>Removed invalid use of <code class="docutils literal notranslate"><span class="pre">__</span></code> alias that prevented strings getting picked up for translation (Juha Yrjölä)</li>
<li><a class="reference internal" href="index.html#routable-page-mixin"><span class="std std-ref">Routable pages</span></a> without a main view no longer raise a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> (Bojan Mihelac)</li>
<li>Fixed UnicodeEncodeError in wagtailforms when downloading a CSV for a form containing non-ASCII field labels on Python 2 (Mikalai Radchuk)</li>
<li>Server errors during search indexing on creating / updating / deleting a model are now logged, rather than causing the overall operation to fail (Karl Hobley)</li>
<li>Objects are now correctly removed from search indexes on deletion (Karl Hobley)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="buttons-in-admin-now-require-class-button">
<h6>Buttons in admin now require <code class="docutils literal notranslate"><span class="pre">class=&quot;button&quot;</span></code><a class="headerlink" href="#buttons-in-admin-now-require-class-button" title="Permalink to this headline">¶</a></h6>
<p>The Wagtail admin CSS has been refactored for maintainability, and buttons now require an explicit <code class="docutils literal notranslate"><span class="pre">button</span></code> class. (Previously, the styles were applied on all inputs of type <code class="docutils literal notranslate"><span class="pre">&quot;submit&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;reset&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;button&quot;</span></code>.) If you have created any apps that extend the Wagtail admin with new views / templates, you will need to add this class to all buttons.</p>
</div>
<div class="section" id="the-search-fields-attribute-on-models-should-now-be-set-to-a-list">
<h6>The <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> attribute on models should now be set to a list<a class="headerlink" href="#the-search-fields-attribute-on-models-should-now-be-set-to-a-list" title="Permalink to this headline">¶</a></h6>
<p>On searchable models (eg, <code class="docutils literal notranslate"><span class="pre">Page</span></code> or custom <code class="docutils literal notranslate"><span class="pre">Image</span></code> models) the <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> attribute should now be a list instead of a tuple.</p>
<p>For example, the following <code class="docutils literal notranslate"><span class="pre">Page</span></code> model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">search_fields</span> <span class="o">+</span> <span class="p">(</span>
        <span class="n">indexed</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Should be changed to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">search_fields</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">indexed</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>To ease the burden on third-party modules, adding tuples to <code class="docutils literal notranslate"><span class="pre">Page.search_fields</span></code> will still work. But this backwards-compatibility fix will be removed in Wagtail 1.7.</p>
</div>
<div class="section" id="elasticsearch-backend-now-defaults-to-verifying-ssl-certs">
<h6>Elasticsearch backend now defaults to verifying SSL certs<a class="headerlink" href="#elasticsearch-backend-now-defaults-to-verifying-ssl-certs" title="Permalink to this headline">¶</a></h6>
<p>Previously, if you used the Elasticsearch backend, configured with the URLS property like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.wagtailsearch.backends.elasticsearch&#39;</span><span class="p">,</span>
        <span class="s1">&#39;URLS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;https://example.com/&#39;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Elasticsearch would not be configured to verify SSL certificates for HTTPS URLs. This has been changed so that SSL certificates are verified for HTTPS connections by default.</p>
<p>If you need the old behaviour back, where SSL certificates are not verified for your HTTPS connection, you can configure the Elasticsearch backend with the <code class="docutils literal notranslate"><span class="pre">HOSTS</span></code> option, like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAILSEARCH_BACKENDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;wagtail.wagtailsearch.backends.elasticsearch&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HOSTS&#39;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="s1">&#39;host&#39;</span><span class="p">:</span> <span class="s1">&#39;example.com&#39;</span>
            <span class="s1">&#39;use_ssl&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;verify_certs&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}],</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="http://elasticsearch-py.readthedocs.org/en/stable/#ssl-and-authentication">Elasticsearch-py documentation</a> for more configuration options.</p>
</div>
<div class="section" id="project-template-now-imports-settings-dev-explicitly">
<h6>Project template now imports <code class="docutils literal notranslate"><span class="pre">settings.dev</span></code> explicitly<a class="headerlink" href="#project-template-now-imports-settings-dev-explicitly" title="Permalink to this headline">¶</a></h6>
<p>In previous releases, the project template’s <code class="docutils literal notranslate"><span class="pre">settings/__init__.py</span></code> file was set up to import the development settings (<code class="docutils literal notranslate"><span class="pre">settings/dev.py</span></code>), so that these would be picked up as the default (i.e. whenever a settings module was not specified explicitly). However, in some setups this meant that the development settings were being inadvertently imported in production mode.</p>
<p>For this reason, the import in <code class="docutils literal notranslate"><span class="pre">settings/__init__.py</span></code> has now been removed, and commands must now specify <code class="docutils literal notranslate"><span class="pre">myproject.settings.dev</span></code> or <code class="docutils literal notranslate"><span class="pre">myproject.settings.production</span></code> as appropriate; the supporting scripts (such as <code class="docutils literal notranslate"><span class="pre">manage.py</span></code>) have been updated accordingly. As this is a change to the project template, existing projects are not affected; however, if you have any common scripts or configuration files that rely on importing <code class="docutils literal notranslate"><span class="pre">myproject.settings</span></code> as the settings module, these will need to be updated in order to work on projects created under Wagtail 1.5.</p>
</div>
</div>
</div>
<span id="document-releases/1.4.6"></span><div class="section" id="wagtail-1-4-6-release-notes">
<h4>Wagtail 1.4.6 release notes<a class="headerlink" href="#wagtail-1-4-6-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Pin html5lib to version 0.999999 to prevent breakage caused by internal API changes (Liam Brenner)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.4.5"></span><div class="section" id="wagtail-1-4-5-release-notes">
<h4>Wagtail 1.4.5 release notes<a class="headerlink" href="#wagtail-1-4-5-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Paste / drag operations done entirely with the mouse are now correctly picked up as edits within the rich text editor (Matt Fozard)</li>
<li>Logic for cancelling the “unsaved changes” check on form submission has been fixed to work cross-browser (Stephen Rice)</li>
<li>The “unsaved changes” confirmation was erroneously shown on IE / Firefox when previewing a page with validation errors (Matt Westcott)</li>
<li>The up / down / delete controls on the “Promoted search results” form no longer trigger a form submission (Matt Westcott)</li>
<li>Opening preview window no longer performs user-agent sniffing, and now works correctly on IE11 (Matt Westcott)</li>
<li>Tree paths are now correctly assigned when previewing a newly-created page underneath a parent with deleted children (Matt Westcott)</li>
<li>Added BASE_URL setting back to project template</li>
<li>Clearing the search box in the page chooser now returns the user to the browse view (Matt Westcott)</li>
<li>The above fix also fixed an issue where Internet Explorer got stuck in the search view upon opening the page chooser (Matt Westcott)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.4.4"></span><div class="section" id="wagtail-1-4-4-release-notes">
<h4>Wagtail 1.4.4 release notes<a class="headerlink" href="#wagtail-1-4-4-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="translations">
<h6>Translations<a class="headerlink" href="#translations" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>New translation for Slovenian (Mitja Pagon)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">wagtailuserbar</span></code> template tag now gracefully handles situations where the <code class="docutils literal notranslate"><span class="pre">request</span></code> object is not in the template context (Matt Westcott)</li>
<li>Meta classes on StreamField blocks now handle multiple inheritance correctly (Tim Heap)</li>
<li>Now user can upload images / documents only into permitted collection from choosers</li>
<li>Keyboard shortcuts for save / preview on the page editor no longer incorrectly trigger the “unsaved changes” message (Jack Paine / Matt Westcott)</li>
<li>Redirects no longer fail when both a site-specific and generic redirect exist for the same URL path (Nick Smith, João Luiz Lorencetti)</li>
<li>Wagtail now checks that Group is registered with the Django admin before unregistering it (Jason Morrison)</li>
<li>Previewing inaccessible pages no longer fails with <code class="docutils literal notranslate"><span class="pre">ALLOWED_HOSTS</span> <span class="pre">=</span> <span class="pre">['*']</span></code> (Robert Rollins)</li>
<li>The submit button ‘spinner’ no longer activates if the form has client-side validation errors (Jack Paine, Matt Westcott)</li>
<li>Overriding <code class="docutils literal notranslate"><span class="pre">MESSAGE_TAGS</span></code> in project settings no longer causes messages in the Wagtail admin to lose their styling (Tim Heap)</li>
<li>Border added around explorer menu to stop it blending in with StreamField block listing; also fixes invisible explorer menu in Firefox 46 (Alex Gleason)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.4.3"></span><div class="section" id="wagtail-1-4-3-release-notes">
<h4>Wagtail 1.4.3 release notes<a class="headerlink" href="#wagtail-1-4-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Fixed regression introduced in 1.4.2 which caused Wagtail to query the database during a system check (Tim Heap)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.4.2"></span><div class="section" id="wagtail-1-4-2-release-notes">
<h4>Wagtail 1.4.2 release notes<a class="headerlink" href="#wagtail-1-4-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Streamfields no longer break on validation error</li>
<li>Number of validation errors in each tab in the editor is now correctly reported again</li>
<li>Userbar now opens on devices with both touch and mouse (Josh Barr)</li>
<li><code class="docutils literal notranslate"><span class="pre">wagtail.wagtailadmin.wagtail_hooks</span></code> no longer calls <code class="docutils literal notranslate"><span class="pre">static</span></code> during app load, so you can use <code class="docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code> without calling the <code class="docutils literal notranslate"><span class="pre">collectstatic</span></code> command</li>
<li>Fixed crash on page save when a custom <code class="docutils literal notranslate"><span class="pre">Page</span></code> edit handler has been specified using the <code class="docutils literal notranslate"><span class="pre">edit_handler</span></code> attribute (Tim Heap)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.4.1"></span><div class="section" id="wagtail-1-4-1-release-notes">
<h4>Wagtail 1.4.1 release notes<a class="headerlink" href="#wagtail-1-4-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Fixed erroneous rendering of up arrow icons (Rob Moorman)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.4"></span><div class="section" id="wagtail-1-4-release-notes">
<h4>Wagtail 1.4 release notes<a class="headerlink" href="#wagtail-1-4-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<p>Wagtail 1.4 is designated a Long Term Support (LTS) release. Long Term Support releases will continue to receive maintenance updates as necessary to address security and data-loss related issues, up until the next LTS release (typically a period of 8 months).</p>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="page-revision-management">
<h6>Page revision management<a class="headerlink" href="#page-revision-management" title="Permalink to this headline">¶</a></h6>
<div class="figure">
<a class="reference internal image-reference" href="_images/revision-ui.png"><img alt="_images/revision-ui.png" src="_images/revision-ui.png" style="width: 696px;" /></a>
</div>
<p>From the page editing interface, editors can now access a list of previous revisions of the page, and preview or roll back to any earlier revision.</p>
</div>
<div class="section" id="collections-for-image-document-organisation">
<h6>Collections for image / document organisation<a class="headerlink" href="#collections-for-image-document-organisation" title="Permalink to this headline">¶</a></h6>
<p>Images and documents can now be organised into collections, set up by administrators through the Settings -&gt; Collections menu item. User permissions can be set either globally (on the ‘Root’ collection) or on individual collections, allowing different user groups to keep their media items separated. Thank you to the University of South Wales for sponsoring this feature.</p>
</div>
<div class="section" id="redesigned-userbar">
<h6>Redesigned userbar<a class="headerlink" href="#redesigned-userbar" title="Permalink to this headline">¶</a></h6>
<div class="figure">
<a class="reference internal image-reference" href="_images/userbar-corner.png"><img alt="_images/userbar-corner.png" src="_images/userbar-corner.png" style="width: 272px;" /></a>
</div>
<p>The Wagtail userbar (which gives editors quick access to the admin from the site frontend) has been redesigned, and no longer depends on an iframe. The new design allows more flexibility in label text, more configurable positioning to avoid overlapping with site navigation, and adds a new “Show in Explorer” option. This feature was developed by Thomas Winter and Gareth Price.</p>
</div>
<div class="section" id="protection-against-unsaved-changes">
<h6>Protection against unsaved changes<a class="headerlink" href="#protection-against-unsaved-changes" title="Permalink to this headline">¶</a></h6>
<p>The page editor interface now produces a warning if the user attempts to navigate away while there are unsaved changes.</p>
</div>
<div class="section" id="multiple-document-uploader">
<h6>Multiple document uploader<a class="headerlink" href="#multiple-document-uploader" title="Permalink to this headline">¶</a></h6>
<p>The “Add a document” interface now supports uploading multiple documents at once, in the same way as uploading images.</p>
</div>
<div class="section" id="custom-document-models">
<h6>Custom document models<a class="headerlink" href="#custom-document-models" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">Document</span></code> model can now be overridden using the new <code class="docutils literal notranslate"><span class="pre">WAGTAILDOCS_DOCUMENT_MODEL</span></code> setting. This works in the same way that <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_IMAGE_MODEL</span></code> works for <code class="docutils literal notranslate"><span class="pre">Image</span></code>.</p>
</div>
<div class="section" id="removed-django-compressor-dependency">
<h6>Removed django-compressor dependency<a class="headerlink" href="#removed-django-compressor-dependency" title="Permalink to this headline">¶</a></h6>
<p>Wagtail no longer depends on the <a class="reference external" href="http://django-compressor.readthedocs.org/">django-compressor</a> library. While we highly recommend compressing and bundling the CSS and JavaScript on your sites, using django-compressor places additional installation and configuration demands on the developer, so this has now been made optional.</p>
</div>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>The page search interface now searches all fields instead of just the title (Kait Crawford)</li>
<li>Snippets now support a custom <code class="docutils literal notranslate"><span class="pre">edit_handler</span></code> property; this can be used to implement a tabbed interface, for example. See <a class="reference internal" href="index.html#customising-the-tabbed-interface"><span class="std std-ref">Customising the tabbed interface</span></a> (Mikalai Radchuk)</li>
<li>Date/time pickers now respect the locale’s ‘first day of week’ setting (Peter Quade)</li>
<li>Refactored the way forms are constructed for the page editor, to allow custom forms to be used</li>
<li>Notification message on publish now indicates whether the page is being published now or scheduled for publication in future (Chris Rogers)</li>
<li>Server errors when uploading images / documents through the chooser modal are now reported back to the user (Nigel Fletton)</li>
<li>Added a hook <a class="reference internal" href="index.html#insert-global-admin-css"><span class="std std-ref">insert_global_admin_css</span></a> for inserting custom CSS throughout the admin backend (Tom Dyson)</li>
<li>Added a hook <a class="reference internal" href="index.html#construct-explorer-page-queryset"><span class="std std-ref">construct_explorer_page_queryset</span></a> for customising the set of pages displayed in the page explorer</li>
<li>Page models now perform field validation, including testing slugs for uniqueness within a parent page, at the model level on saving</li>
<li>Page slugs are now auto-generated at the model level on page creation if one has not been specified explicitly</li>
<li>The <code class="docutils literal notranslate"><span class="pre">Page</span></code> model now has two new methods <code class="docutils literal notranslate"><span class="pre">get_site()</span></code> and <code class="docutils literal notranslate"><span class="pre">get_url_parts()</span></code> to aid with customising the page URL generation logic</li>
<li>Upgraded jQuery to 2.2.1 (Charlie Choiniere)</li>
<li>Multiple homepage summary items (<code class="docutils literal notranslate"><span class="pre">construct_homepage_summary_items</span></code> hook) now better vertically spaced (Nicolas Kuttler)</li>
<li>Email notifications can now be sent in HTML format. See <a class="reference internal" href="index.html#email-notifications"><span class="std std-ref">Email Notifications</span></a> (Mike Dingjan)</li>
<li><code class="docutils literal notranslate"><span class="pre">StreamBlock</span></code> now has provision for throwing non-field-specific validation errors</li>
<li>Wagtail now works with Willow 0.3, which supports auto-correcting the orientation of images based on EXIF data</li>
<li>New translations for Hungarian, Swedish (Sweden) and Turkish</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Custom page managers no longer raise an error when used on an abstract model</li>
<li>Wagtail’s migrations are now all reversible (Benjamin Bach)</li>
<li>Deleting a page content type now preserves existing pages as basic Page instances, to prevent tree corruption</li>
<li>The <code class="docutils literal notranslate"><span class="pre">Page.path</span></code> field is now explicitly given the “C” collation on PostgreSQL to prevent tree ordering issues when using a database created with the Slovak locale</li>
<li>Wagtail’s compiled static assets are now put into the correct directory on Windows (Aarni Koskela)</li>
<li><code class="docutils literal notranslate"><span class="pre">ChooserBlock</span></code> now correctly handles models with primary keys other than <code class="docutils literal notranslate"><span class="pre">id</span></code> (alexpilot11)</li>
<li>Fixed typo in Wistia oEmbed pattern (Josh Hurd)</li>
<li>Added more accurate help text for the Administrator flag on user accounts (Matt Fozard)</li>
<li>Tags added on the multiple image uploader are now saved correctly</li>
<li>Documents created by a user are no longer deleted when the user is deleted</li>
<li>Fixed a crash in <code class="docutils literal notranslate"><span class="pre">RedirectMiddleware</span></code> when a middleware class before <code class="docutils literal notranslate"><span class="pre">SiteMiddleware</span></code> returns a response (Josh Schneier)</li>
<li>Fixed error retrieving the moderator list on pages that are covered by multiple moderator permission records (Matt Fozard)</li>
<li>Ordering pages in the explorer by reverse ‘last updated’ time now puts pages with no revisions at the top</li>
<li>WagtailTestUtils now works correctly on custom user models without a <code class="docutils literal notranslate"><span class="pre">username</span></code> field (Adam Bolfik)</li>
<li>Logging in to the admin as a user with valid credentials but no admin access permission now displays an error message, rather than rejecting the user silently</li>
<li>StreamBlock HTML rendering now handles non-ASCII characters correctly on Python 2 (Mikalai Radchuk)</li>
<li>Fixed a bug preventing pages with a <code class="docutils literal notranslate"><span class="pre">OneToOneField</span></code> from being copied (Liam Brenner)</li>
<li>SASS compilation errors during Wagtail development no longer cause exit of Gulp process, instead throws error to console and continues (Thomas Winter)</li>
<li>Explorer page listing now uses specific page models, so that custom URL schemes defined on Page subclasses are respected</li>
<li>Made settings menu clickable again in Firefox 46.0a2 (Juha Kujala)</li>
<li>User management index view no longer assumes the presence of <code class="docutils literal notranslate"><span class="pre">username</span></code>, <code class="docutils literal notranslate"><span class="pre">first_name</span></code>, <code class="docutils literal notranslate"><span class="pre">last_name</span></code> and <code class="docutils literal notranslate"><span class="pre">email</span></code> fields on the user model (Eirik Krogstad)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="removal-of-django-compressor">
<h6>Removal of django-compressor<a class="headerlink" href="#removal-of-django-compressor" title="Permalink to this headline">¶</a></h6>
<p>As Wagtail no longer installs django-compressor automatically as a dependency, you may need to make changes to your site’s configuration when upgrading. If your project is actively using django-compressor (that is, your site templates contain <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">compress</span> <span class="pre">%}</span></code> tags), you should ensure that your project’s requirements explicitly include django-compressor, rather than indirectly relying on Wagtail to install it. If you are not actively using django-compressor on your site, you should update your settings file to remove the line <code class="docutils literal notranslate"><span class="pre">'compressor'</span></code> from <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>, and remove <code class="docutils literal notranslate"><span class="pre">'compressor.finders.CompressorFinder'</span></code> from <code class="docutils literal notranslate"><span class="pre">STATICFILES_FINDERS</span></code>.</p>
</div>
<div class="section" id="page-models-now-enforce-field-validation">
<h6>Page models now enforce field validation<a class="headerlink" href="#page-models-now-enforce-field-validation" title="Permalink to this headline">¶</a></h6>
<p>In previous releases, field validation on Page models was only applied at the form level, meaning that creating pages directly at the model level would bypass validation. For example, if <code class="docutils literal notranslate"><span class="pre">NewsPage</span></code> is a Page model with a required <code class="docutils literal notranslate"><span class="pre">body</span></code> field, then code such as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">news_page</span> <span class="o">=</span> <span class="n">NewsPage</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="n">parent_page</span> <span class="o">=</span> <span class="n">NewsIndex</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="n">parent_page</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">news_page</span><span class="p">)</span>
</pre></div>
</div>
<p>would create a page that does not comply with the validation rules. This is no longer possible, as validation is now enforced at the model level on <code class="docutils literal notranslate"><span class="pre">save()</span></code> and <code class="docutils literal notranslate"><span class="pre">save_revision()</span></code>; as a result, code that creates pages programmatically (such as unit tests, and import scripts) may need to be updated to ensure that it creates valid pages.</p>
</div>
</div>
</div>
<span id="document-releases/1.3.1"></span><div class="section" id="wagtail-1-3-1-release-notes">
<h4>Wagtail 1.3.1 release notes<a class="headerlink" href="#wagtail-1-3-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Applied workaround for failing <code class="docutils literal notranslate"><span class="pre">wagtailimages</span></code> migration on Django 1.8.8 / 1.9.1 with Postgres (see <a class="reference external" href="https://code.djangoproject.com/ticket/26034">Django issue #26034</a>)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/1.3"></span><div class="section" id="wagtail-1-3-release-notes">
<h4>Wagtail 1.3 release notes<a class="headerlink" href="#wagtail-1-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="django-1-9-support">
<h6>Django 1.9 support<a class="headerlink" href="#django-1-9-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail is now compatible with Django 1.9.</p>
</div>
<div class="section" id="indexing-fields-across-relations-in-elasticsearch">
<h6>Indexing fields across relations in Elasticsearch<a class="headerlink" href="#indexing-fields-across-relations-in-elasticsearch" title="Permalink to this headline">¶</a></h6>
<p>Fields on related objects can now be indexed in Elasticsearch using the new <code class="docutils literal notranslate"><span class="pre">indexed.RelatedFields</span></code> declaration type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">Indexed</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
        <span class="n">index</span><span class="o">.</span><span class="n">FilterField</span><span class="p">(</span><span class="s1">&#39;published_date&#39;</span><span class="p">),</span>

        <span class="n">index</span><span class="o">.</span><span class="n">RelatedFields</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="n">index</span><span class="o">.</span><span class="n">SearchField</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
            <span class="n">index</span><span class="o">.</span><span class="n">FilterField</span><span class="p">(</span><span class="s1">&#39;date_of_birth&#39;</span><span class="p">),</span>
        <span class="p">]),</span>
    <span class="p">]</span>

<span class="c1"># Search books where their author was born after 1950</span>
<span class="c1"># Both the book title and the authors name will be searched</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author__date_of_birth__gt</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">1950</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>See: <a class="reference internal" href="index.html#wagtailsearch-index-relatedfields"><span class="std std-ref">index.RelatedFields</span></a></p>
</div>
<div class="section" id="cross-linked-admin-search-ui">
<h6>Cross-linked admin search UI<a class="headerlink" href="#cross-linked-admin-search-ui" title="Permalink to this headline">¶</a></h6>
<p>The search interface in the Wagtail admin now includes a toolbar to quickly switch between different search types - pages, images, documents and users. A new <a class="reference internal" href="index.html#register-admin-search-area"><span class="std std-ref">register_admin_search_area</span></a> hook is provided for adding new search types to this toolbar.</p>
</div>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added <code class="docutils literal notranslate"><span class="pre">WagtailPageTests</span></code>, a helper module to simplify writing tests for Wagtail sites. See <a class="reference internal" href="index.html#document-advanced_topics/testing"><span class="doc">Testing your Wagtail site</span></a></li>
<li>Added system checks to check the <code class="docutils literal notranslate"><span class="pre">subpage_types</span></code> and <code class="docutils literal notranslate"><span class="pre">parent_page_types</span></code> attributes of page models</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">WAGTAIL_PASSWORD_RESET_ENABLED</span></code> setting to allow password resets to be disabled independently of the password management interface (John Draper)</li>
<li>Submit for moderation notification emails now include the editor name (Denis Voskvitsov)</li>
<li>Updated fonts for more comprehensive Unicode support</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">.alt</span></code> attribute to image renditions</li>
<li>The default <code class="docutils literal notranslate"><span class="pre">src</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">height</span></code> and <code class="docutils literal notranslate"><span class="pre">alt</span></code> attributes can now be overridden by attributes passed to the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag</li>
<li>Added keyboard shortcuts for preview and save in the page editor</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">Page</span></code> methods <code class="docutils literal notranslate"><span class="pre">can_exist_under</span></code>, <code class="docutils literal notranslate"><span class="pre">can_create_at</span></code>, <code class="docutils literal notranslate"><span class="pre">can_move_to</span></code> for customising page type business rules</li>
<li><code class="docutils literal notranslate"><span class="pre">wagtailadmin.utils.send_mail</span></code> now passes extra keyword arguments to Django’s <code class="docutils literal notranslate"><span class="pre">send_mail</span></code> function (Matthew Downey)</li>
<li><code class="docutils literal notranslate"><span class="pre">page_unpublish</span></code> signal is now fired for each page that was unpublished by a call to <code class="docutils literal notranslate"><span class="pre">PageQuerySet.unpublish()</span></code></li>
<li>Add <code class="docutils literal notranslate"><span class="pre">get_upload_to</span></code> method to <code class="docutils literal notranslate"><span class="pre">AbstractImage</span></code>, to allow overriding the default image upload path (Ben Emery)</li>
<li>Notification emails are now sent per user (Matthew Downey)</li>
<li>Added the ability to override the default manager on Page models</li>
<li>Added an optional human-friendly <code class="docutils literal notranslate"><span class="pre">site_name</span></code> field to sites (Timo Rieber)</li>
<li>Added a system check to warn developers who use a custom Wagtail build but forgot to build the admin css</li>
<li>Added success message after updating image from the image upload view (Christian Peters)</li>
<li>Added a <code class="docutils literal notranslate"><span class="pre">request.is_preview</span></code> variable for templates to distinguish between previewing and live (Denis Voskvitsov)</li>
<li>‘Pages’ link on site stats dashboard now links to the site homepage when only one site exists, rather than the root level</li>
<li>Added support for chaining multiple image operations on the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag (Christian Peters)</li>
<li>New translations for Arabic, Latvian and Slovak</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Images and page revisions created by a user are no longer deleted when the user is deleted (Rich Atkinson)</li>
<li>HTTP cache purge now works again on Python 2 (Mitchel Cabuloy)</li>
<li>Locked pages can no longer be unpublished (Alex Bridge)</li>
<li>Site records now implement <code class="docutils literal notranslate"><span class="pre">get_by_natural_key</span></code></li>
<li>Creating pages at the root level (and any other instances of the base <code class="docutils literal notranslate"><span class="pre">Page</span></code> model) now properly respects the <code class="docutils literal notranslate"><span class="pre">parent_page_types</span></code> setting</li>
<li>Settings menu now opens correctly from the page editor and styleguide views</li>
<li><code class="docutils literal notranslate"><span class="pre">subpage_types</span></code> / <code class="docutils literal notranslate"><span class="pre">parent_page_types</span></code> business rules are now enforced when moving pages</li>
<li>Multi-word tags on images and documents are now correctly preserved as a single tag (LKozlowski)</li>
<li>Changed verbose names to start with lower case where necessary (Maris Serzans)</li>
<li>Invalid images no longer crash the image listing (Maris Serzans)</li>
<li><code class="docutils literal notranslate"><span class="pre">MenuItem</span></code> <code class="docutils literal notranslate"><span class="pre">url</span></code> parameter can now take a lazy URL (Adon Metcalfe, rayrayndwiga)</li>
<li>Added missing translation tag to InlinePanel ‘Add’ button (jnns)</li>
<li>Added missing translation tag to ‘Signing in…’ button text (Eugene MechanisM)</li>
<li>Restored correct highlighting behaviour of rich text toolbar buttons</li>
<li>Rendering a missing image through ImageChooserBlock no longer breaks the whole page (Christian Peters)</li>
<li>Filtering by popular tag in the image chooser now works when using the database search backend</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="jinja2-template-tag-modules-have-changed-location">
<h6>Jinja2 template tag modules have changed location<a class="headerlink" href="#jinja2-template-tag-modules-have-changed-location" title="Permalink to this headline">¶</a></h6>
<p>Due to a change in the way template tags are imported in Django 1.9, it has been necessary to move the Jinja2 template tag modules from “templatetags” to a new location, “jinja2tags”. The correct configuration settings to enable Jinja2 templates are now as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.jinja2.Jinja2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;extensions&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;wagtail.core.jinja2tags.core&#39;</span><span class="p">,</span>
                <span class="s1">&#39;wagtail.wagtailadmin.jinja2tags.userbar&#39;</span><span class="p">,</span>
                <span class="s1">&#39;wagtail.wagtailimages.jinja2tags.images&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>See: <a class="reference internal" href="index.html#document-reference/jinja2"><span class="doc">Jinja2 template support</span></a></p>
</div>
<div class="section" id="contenttype-returning-methods-in-wagtailcore-are-deprecated">
<h6>ContentType-returning methods in wagtailcore are deprecated<a class="headerlink" href="#contenttype-returning-methods-in-wagtailcore-are-deprecated" title="Permalink to this headline">¶</a></h6>
<p>The following internal functions and methods in <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailcore.models</span></code>, which return a list of <code class="docutils literal notranslate"><span class="pre">ContentType</span></code> objects, have been deprecated. Any uses of these in your code should be replaced by the corresponding new function which returns a list of model classes instead:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">get_page_types()</span></code> - replaced by <code class="docutils literal notranslate"><span class="pre">get_page_models()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Page.clean_subpage_types()</span></code> - replaced by <code class="docutils literal notranslate"><span class="pre">Page.clean_subpage_models()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Page.clean_parent_page_types()</span></code> - replaced by <code class="docutils literal notranslate"><span class="pre">Page.clean_parent_page_models()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Page.allowed_parent_page_types()</span></code> - replaced by <code class="docutils literal notranslate"><span class="pre">Page.allowed_parent_page_models()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Page.allowed_subpage_types()</span></code> - replaced by <code class="docutils literal notranslate"><span class="pre">Page.allowed_subpage_models()</span></code></li>
</ul>
<p>In addition, note that these methods now return page types that are marked as <code class="docutils literal notranslate"><span class="pre">is_creatable</span> <span class="pre">=</span> <span class="pre">False</span></code>, including the base <code class="docutils literal notranslate"><span class="pre">Page</span></code> class. (Abstract models are not included, as before.)</p>
</div>
</div>
</div>
<span id="document-releases/1.2"></span><div class="section" id="wagtail-1-2-release-notes">
<h4>Wagtail 1.2 release notes<a class="headerlink" href="#wagtail-1-2-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="site-settings-module">
<h6>Site settings module<a class="headerlink" href="#site-settings-module" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now includes a contrib module (previously available as the <a class="reference external" href="https://pypi.python.org/pypi/wagtailsettings/">wagtailsettings</a> package) to allow administrators to edit site-specific settings.</p>
<p>See: <a class="reference internal" href="index.html#document-reference/contrib/settings"><span class="doc">Site settings</span></a></p>
</div>
<div class="section" id="jinja2-support">
<h6>Jinja2 support<a class="headerlink" href="#jinja2-support" title="Permalink to this headline">¶</a></h6>
<p>The core templatetags (<code class="docutils literal notranslate"><span class="pre">pageurl</span></code>, <code class="docutils literal notranslate"><span class="pre">slugurl</span></code>, <code class="docutils literal notranslate"><span class="pre">image</span></code>, <code class="docutils literal notranslate"><span class="pre">richtext</span></code> and <code class="docutils literal notranslate"><span class="pre">wagtailuserbar</span></code>) are now compatible with Jinja2 so it’s now possible to use Jinja2 as the template engine for your Wagtail site.</p>
<p>Note that the variable name <code class="docutils literal notranslate"><span class="pre">self</span></code> is reserved in Jinja2, and so Wagtail now provides alternative variable names where <code class="docutils literal notranslate"><span class="pre">self</span></code> was previously used: <code class="docutils literal notranslate"><span class="pre">page</span></code> to refer to page objects, and <code class="docutils literal notranslate"><span class="pre">value</span></code> to refer to StreamField blocks. All code examples in this documentation have now been updated to use the new variable names, for compatibility with Jinja2; however, users of the default Django template engine can continue to use <code class="docutils literal notranslate"><span class="pre">self</span></code>.</p>
<p>See: <a class="reference internal" href="index.html#document-reference/jinja2"><span class="doc">Jinja2 template support</span></a></p>
</div>
<div class="section" id="site-specific-redirects">
<h6>Site-specific redirects<a class="headerlink" href="#site-specific-redirects" title="Permalink to this headline">¶</a></h6>
<p>You can now create redirects for a particular site using the admin interface.</p>
</div>
<div class="section" id="search-api-improvements">
<h6>Search API improvements<a class="headerlink" href="#search-api-improvements" title="Permalink to this headline">¶</a></h6>
<p>Wagtail’s image and document models now provide a <code class="docutils literal notranslate"><span class="pre">search</span></code> method on their QuerySets, making it easy to perform searches on filtered data sets. In addition, search methods now accept two new keyword arguments:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">operator</span></code>, to determine whether multiple search terms will be treated as ‘or’ (any term may match) or ‘and’ (all terms must match);</li>
<li><code class="docutils literal notranslate"><span class="pre">order_by_relevance</span></code>, set to True (the default) to order by relevance or False to preserve the QuerySet’s original ordering.</li>
</ul>
<p>See: <a class="reference internal" href="index.html#wagtailsearch-searching"><span class="std std-ref">Searching</span></a></p>
</div>
<div class="section" id="max-num-and-min-num-parameters-on-inline-panels">
<h6><code class="docutils literal notranslate"><span class="pre">max_num</span></code> and <code class="docutils literal notranslate"><span class="pre">min_num</span></code> parameters on inline panels<a class="headerlink" href="#max-num-and-min-num-parameters-on-inline-panels" title="Permalink to this headline">¶</a></h6>
<p>Inline panels now accept the optional parameters <code class="docutils literal notranslate"><span class="pre">max_num</span></code> and <code class="docutils literal notranslate"><span class="pre">min_num</span></code>, to specify the maximum / minimum number of child items that must exist in order for the page to be valid.</p>
<p>See: <a class="reference internal" href="index.html#inline-panels"><span class="std std-ref">Inline Panels and Model Clusters</span></a></p>
</div>
<div class="section" id="get-context-on-streamfield-blocks">
<h6><code class="docutils literal notranslate"><span class="pre">get_context</span></code> on StreamField blocks<a class="headerlink" href="#get-context-on-streamfield-blocks" title="Permalink to this headline">¶</a></h6>
<p>StreamField blocks now <a class="reference internal" href="index.html#streamfield-get-context"><span class="std std-ref">provide a get_context method</span></a> that can be overridden to pass additional variables to the block’s template.</p>
</div>
<div class="section" id="browsable-api">
<h6>Browsable API<a class="headerlink" href="#browsable-api" title="Permalink to this headline">¶</a></h6>
<p>The Wagtail API now incorporates the browsable front-end provided by Django REST Framework. Note that this must be enabled by adding <code class="docutils literal notranslate"><span class="pre">'rest_framework'</span></code> to your project’s <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> setting.</p>
</div>
<div class="section" id="python-3-5-support">
<h6>Python 3.5 support<a class="headerlink" href="#python-3-5-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now supports Python 3.5 when run in conjunction with Django 1.8.6 or later.</p>
</div>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>WagtailRedirectMiddleware can now ignore the query string if there is no redirect that exactly matches it</li>
<li>Order of URL parameters now ignored by redirect middleware</li>
<li>Added SQL Server compatibility to image migration</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">class</span></code> attributes to Wagtail rich text editor buttons to aid custom styling</li>
<li>Simplified body_class in default homepage template</li>
<li>page_published signal now called with the revision object that was published</li>
<li>Added a favicon to the admin interface, customisable by overriding the <code class="docutils literal notranslate"><span class="pre">branding_favicon</span></code> block (see <a class="reference internal" href="index.html#custom-branding"><span class="std std-ref">Custom branding</span></a>).</li>
<li>Added spinner animations to long-running form submissions</li>
<li>The EMBEDLY_KEY setting has been renamed to WAGTAILEMBEDS_EMBEDLY_KEY</li>
<li>StreamField blocks are now added automatically, without showing the block types menu, if only one block type exists (Alex Gleason)</li>
<li>The <code class="docutils literal notranslate"><span class="pre">first_published_at</span></code> and <code class="docutils literal notranslate"><span class="pre">latest_revision_created_at</span></code> fields on page models are now available as filter fields on search queries</li>
<li>Wagtail admin now standardises on a single thumbnail image size, to reduce the overhead of creating multiple renditions</li>
<li>Rich text fields now strip out HTML comments</li>
<li>Page editor form now sets <code class="docutils literal notranslate"><span class="pre">enctype=&quot;multipart/form-data&quot;</span></code> as appropriate, allowing FileField to be used on page models (Petr Vacha)</li>
<li>Explorer navigation menu on a completely empty page tree now takes you to the root level, rather than doing nothing</li>
<li>Added animation and fixed display issues when focusing a rich text field (Alex Gleason)</li>
<li>Added a system check to warn if Pillow is compiled without JPEG / PNG support</li>
<li>Page chooser now prevents users from selecting the root node where this would be invalid</li>
<li>New translations for Dutch (Netherlands), Georgian, Swedish and Turkish (Turkey)</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Page slugs are no longer auto-updated from the page title if the page is already published</li>
<li>Deleting a page permission from the groups admin UI does not immediately submit the form</li>
<li>Wagtail userbar is shown on pages that do not pass a <code class="docutils literal notranslate"><span class="pre">page</span></code> variable to the template (e.g. because they override the <code class="docutils literal notranslate"><span class="pre">serve</span></code> method)</li>
<li><code class="docutils literal notranslate"><span class="pre">request.site</span></code> now set correctly on page preview when the page is not in the default site</li>
<li>Project template no longer raises a deprecation warning (Maximilian Stauss)</li>
<li><code class="docutils literal notranslate"><span class="pre">PageManager.sibling_of(page)</span></code> and <code class="docutils literal notranslate"><span class="pre">PageManager.not_sibling_of(page)</span></code> now default to inclusive (i.e. <code class="docutils literal notranslate"><span class="pre">page</span></code> is considered a sibling of itself), for consistency with other sibling methods</li>
<li>The “view live” button displayed after publishing a page now correctly reflects any changes made to the page slug (Ryan Pineo)</li>
<li>API endpoints now accept and ignore the <code class="docutils literal notranslate"><span class="pre">_</span></code> query parameter used by jQuery for cache-busting</li>
<li>Page slugs are no longer cut off when Unicode characters are expanded into multiple characters (Sævar Öfjörð Magnússon)</li>
<li>Searching a specific page model while filtering it by either ID or tree position no longer raises an error (Ashia Zawaduk)</li>
<li>Scrolling an over-long explorer menu no longer causes white background to show through (Alex Gleason)</li>
<li>Removed jitter when hovering over StreamField blocks (Alex Gleason)</li>
<li>Non-ASCII email addresses no longer throw errors when generating Gravatar URLs (Denis Voskvitsov, Kyle Stratis)</li>
<li>Dropdown for <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> s are now styled consistently (Ashia Zawaduk)</li>
<li>Date choosers now appear on top of StreamField menus (Sergey Nikitin)</li>
<li>Fixed a migration error that was raised when block-updating from 0.8 to 1.1+</li>
<li><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.copy()</span></code> no longer breaks on models with a <code class="docutils literal notranslate"><span class="pre">ClusterTaggableManager</span></code> or <code class="docutils literal notranslate"><span class="pre">ManyToManyField</span></code></li>
<li>Validation errors when inserting an embed into a rich text area are now reported back to the editor</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="pagemanager-sibling-of-page-and-pagemanager-not-sibling-of-page-have-changed-behaviour">
<h6><code class="docutils literal notranslate"><span class="pre">PageManager.sibling_of(page)</span></code> and <code class="docutils literal notranslate"><span class="pre">PageManager.not_sibling_of(page)</span></code> have changed behaviour<a class="headerlink" href="#pagemanager-sibling-of-page-and-pagemanager-not-sibling-of-page-have-changed-behaviour" title="Permalink to this headline">¶</a></h6>
<p>In previous versions of Wagtail, the <code class="docutils literal notranslate"><span class="pre">sibling_of</span></code> and <code class="docutils literal notranslate"><span class="pre">not_sibling_of</span></code> methods behaved inconsistently depending on whether they were called on a manager (e.g. <code class="docutils literal notranslate"><span class="pre">Page.objects.sibling_of(some_page)</span></code> or <code class="docutils literal notranslate"><span class="pre">EventPage.objects.sibling_of(some_page)</span></code>) or a QuerySet (e.g. <code class="docutils literal notranslate"><span class="pre">Page.objects.all().sibling_of(some_page)</span></code> or <code class="docutils literal notranslate"><span class="pre">EventPage.objects.live().sibling_of(some_page)</span></code>).</p>
<p>Previously, the manager methods behaved as <em>exclusive</em> by default; that is, they did not count the passed-in page object as a sibling of itself:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">event_1</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Event 1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">sibling_of</span><span class="p">(</span><span class="n">event_1</span><span class="p">)</span>
<span class="go">[&lt;EventPage: Event 2&gt;]  # OLD behaviour: Event 1 is not considered a sibling of itself</span>
</pre></div>
</div>
<p>This has now been changed to be <em>inclusive</em> by default; that is, the page is counted as a sibling of itself:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">event_1</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Event 1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">sibling_of</span><span class="p">(</span><span class="n">event_1</span><span class="p">)</span>
<span class="go">[&lt;EventPage: Event 1&gt;, &lt;EventPage: Event 2&gt;]  # NEW behaviour: Event 1 is considered a sibling of itself</span>
</pre></div>
</div>
<p>If the call to <code class="docutils literal notranslate"><span class="pre">sibling_of</span></code> or <code class="docutils literal notranslate"><span class="pre">not_sibling_of</span></code> is chained after another QuerySet method - such as <code class="docutils literal notranslate"><span class="pre">all()</span></code>, <code class="docutils literal notranslate"><span class="pre">filter()</span></code> or <code class="docutils literal notranslate"><span class="pre">live()</span></code> - behaviour is unchanged; this behaves as <em>inclusive</em>, as it did in previous versions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">event_1</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Event 1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">sibling_of</span><span class="p">(</span><span class="n">event_1</span><span class="p">)</span>
<span class="go">[&lt;EventPage: Event 1&gt;, &lt;EventPage: Event 2&gt;]  # OLD and NEW behaviour</span>
</pre></div>
</div>
<p>If your project includes queries that rely on the old (exclusive) behaviour, this behaviour can be restored by adding the keyword argument <code class="docutils literal notranslate"><span class="pre">inclusive=False</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">event_1</span> <span class="o">=</span> <span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Event 1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">EventPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">sibling_of</span><span class="p">(</span><span class="n">event_1</span><span class="p">,</span> <span class="n">inclusive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">[&lt;EventPage: Event 2&gt;]  # passing inclusive=False restores the OLD behaviour</span>
</pre></div>
</div>
</div>
<div class="section" id="image-search-and-document-search-methods-are-deprecated">
<h6><code class="docutils literal notranslate"><span class="pre">Image.search</span></code> and <code class="docutils literal notranslate"><span class="pre">Document.search</span></code> methods are deprecated<a class="headerlink" href="#image-search-and-document-search-methods-are-deprecated" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">Image.search</span></code> and <code class="docutils literal notranslate"><span class="pre">Document.search</span></code> methods have been deprecated in favour of the new QuerySet-based search mechanism - see <a class="reference internal" href="index.html#wagtailsearch-images-documents-custom-models"><span class="std std-ref">Searching Images, Documents and custom models</span></a>. Code using the old <code class="docutils literal notranslate"><span class="pre">search</span></code> methods should be updated to search on QuerySets instead; for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;uploaded_by_user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">})</span>
</pre></div>
</div>
<p>can be rewritten as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">uploaded_by_user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="wagtail-api-requires-adding-rest-framework-to-installed-apps">
<h6>Wagtail API requires adding <code class="docutils literal notranslate"><span class="pre">rest_framework</span></code> to INSTALLED_APPS<a class="headerlink" href="#wagtail-api-requires-adding-rest-framework-to-installed-apps" title="Permalink to this headline">¶</a></h6>
<p>If you have the Wagtail API (<code class="docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailapi</span></code>) enabled, you must now add <code class="docutils literal notranslate"><span class="pre">'rest_framework'</span></code> to your project’s <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> setting. In the current version the API will continue to function without this app, but the browsable front-end will not be available; this ability will be dropped in a future release.</p>
</div>
<div class="section" id="page-get-latest-revision-as-page-now-returns-live-page-object-when-there-are-no-draft-changes">
<h6><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.get_latest_revision_as_page()</span></code> now returns live page object when there are no draft changes<a class="headerlink" href="#page-get-latest-revision-as-page-now-returns-live-page-object-when-there-are-no-draft-changes" title="Permalink to this headline">¶</a></h6>
<p>If you have any application code that makes direct updates to page data, at the model or database level, be aware that the way these edits are reflected in the page editor has changed.</p>
<p>Previously, the <code class="docutils literal notranslate"><span class="pre">get_latest_revision_as_page</span></code> method - used by the page editor to return the current page revision for editing - always retrieved data from the page’s revision history. Now, it will only do so if the page has unpublished changes (i.e. the page is in <code class="docutils literal notranslate"><span class="pre">live</span> <span class="pre">+</span> <span class="pre">draft</span></code> state) - pages which have received no draft edits since being published will return the page’s live data instead.</p>
<p>As a result, any changes made directly to a live page object will be immediately reflected in the editor without needing to update the latest revision record (but note, the old behaviour is still used for pages in <code class="docutils literal notranslate"><span class="pre">live</span> <span class="pre">+</span> <span class="pre">draft</span></code> state).</p>
</div>
</div>
</div>
<span id="document-releases/1.1"></span><div class="section" id="wagtail-1-1-release-notes">
<h4>Wagtail 1.1 release notes<a class="headerlink" href="#wagtail-1-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="specific-method-on-pagequeryset">
<h6><code class="docutils literal notranslate"><span class="pre">specific()</span></code> method on PageQuerySet<a class="headerlink" href="#specific-method-on-pagequeryset" title="Permalink to this headline">¶</a></h6>
<p>Usually, an operation that retrieves a QuerySet of pages (such as <code class="docutils literal notranslate"><span class="pre">homepage.get_children()</span></code>) will return them as basic Page instances, which only include the core page data such as title. The <code class="docutils literal notranslate"><span class="pre">specific()</span></code> method (e.g. <code class="docutils literal notranslate"><span class="pre">homepage.get_children().specific()</span></code>) now allows them to be retrieved as their most specific type, using the minimum number of queries.</p>
</div>
<div class="section" id="promoted-search-results-has-moved-into-its-own-module">
<h6>“Promoted search results” has moved into its own module<a class="headerlink" href="#promoted-search-results-has-moved-into-its-own-module" title="Permalink to this headline">¶</a></h6>
<p>Previously, this was implemented in <code class="xref py py-mod docutils literal notranslate"><span class="pre">wagtailsearch</span></code> but now has
been moved into a separate module: <code class="xref py py-mod docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailsearchpromotions</span></code></p>
</div>
<div class="section" id="atomic-rebuilding-of-elasticsearch-indexes">
<h6>Atomic rebuilding of Elasticsearch indexes<a class="headerlink" href="#atomic-rebuilding-of-elasticsearch-indexes" title="Permalink to this headline">¶</a></h6>
<p>The Elasticsearch search backend now accepts an experimental <code class="docutils literal notranslate"><span class="pre">ATOMIC_REBUILD</span></code> flag which ensures that the existing search index continues to be available while the <code class="docutils literal notranslate"><span class="pre">update_index</span></code> task is running. See <a class="reference internal" href="index.html#wagtailsearch-backends-atomic-rebuild"><span class="std std-ref">ATOMIC_REBUILD</span></a>.</p>
</div>
<div class="section" id="the-wagtailapi-module-now-uses-django-rest-framework">
<h6>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">wagtailapi</span></code> module now uses Django REST Framework<a class="headerlink" href="#the-wagtailapi-module-now-uses-django-rest-framework" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">wagtailapi</span></code> module is now built on Django REST Framework and it now also has a <a class="reference external" href="https://github.com/wagtail/wagtail/blob/stable/1.1.x/wagtail/contrib/wagtailapi/serializers.py">library of serialisers</a> that you can use in your own REST Framework based APIs. No user-facing changes have been made.</p>
<p>We hope to support more REST framework features, such as a browsable API, in future releases.</p>
</div>
<div class="section" id="permissions-fixes-in-the-admin-interface">
<h6>Permissions fixes in the admin interface<a class="headerlink" href="#permissions-fixes-in-the-admin-interface" title="Permalink to this headline">¶</a></h6>
<p>A number of inconsistencies around permissions in the admin interface were fixed in this release:</p>
<ul class="simple">
<li>Removed all permissions for “User profile” (not used)</li>
<li>Removed “delete” permission for Images and documents (not used)</li>
<li>Users can now access images and documents when they only have the “change” permission (previously required “add” permission as well)</li>
<li>Permissions for Users now taken from custom user model, if set (previously always used permissions on Django’s builtin User model)</li>
<li>Groups and Users now respond consistently to their respective “add”, “change” and “delete” permissions</li>
</ul>
</div>
<div class="section" id="searchable-snippets">
<h6>Searchable snippets<a class="headerlink" href="#searchable-snippets" title="Permalink to this headline">¶</a></h6>
<p>Snippets that inherit from <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailsearch.index.Indexed</span></code> are now given a search box on the snippet chooser and listing pages. See <a class="reference internal" href="index.html#wagtailsnippets-making-snippets-searchable"><span class="std std-ref">Making Snippets Searchable</span></a>.</p>
</div>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Implemented deletion of form submissions</li>
<li>Implemented pagination in the page chooser modal</li>
<li>Changed INSTALLED_APPS in project template to list apps in precedence order</li>
<li>The <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag now supports filters on the image variable, e.g. <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">primary_img|default:secondary_img</span> <span class="pre">width-500</span> <span class="pre">%}</span></code></li>
<li>Moved the style guide menu item into the Settings sub-menu</li>
<li>Search backends can now be specified by module (e.g. <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailsearch.backends.elasticsearch</span></code>), rather than a specific class (<code class="docutils literal notranslate"><span class="pre">wagtail.wagtailsearch.backends.elasticsearch.ElasticSearch</span></code>)</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">descendant_of</span></code> filter to the API</li>
<li>Added optional directory argument to “wagtail start” command</li>
<li>Non-superusers can now view/edit/delete sites if they have the correct permissions</li>
<li>Image file size is now stored in the database, to avoid unnecessary filesystem lookups</li>
<li>Page URL lookups hit the cache/database less often</li>
<li>Updated URLs within the admin backend to use namespaces</li>
<li>The <code class="docutils literal notranslate"><span class="pre">update_index</span></code> task now indexes objects in batches of 1000, to indicate progress and avoid excessive memory use</li>
<li>Added database indexes on PageRevision and Image to improve performance on large sites</li>
<li>Search in page chooser now uses Wagtail’s search framework, to order results by relevance</li>
<li><code class="docutils literal notranslate"><span class="pre">PageChooserPanel</span></code> now supports passing a list (or tuple) of accepted page types</li>
<li>The snippet type parameter of <code class="docutils literal notranslate"><span class="pre">SnippetChooserPanel</span></code> can now be omitted, or passed as a model name string rather than a model class</li>
<li>Added aliases for the <code class="docutils literal notranslate"><span class="pre">self</span></code> template variable to accommodate Jinja as a templating engine: <code class="docutils literal notranslate"><span class="pre">page</span></code> for pages, <code class="docutils literal notranslate"><span class="pre">field_panel</span></code> for field panels / edit handlers, and <code class="docutils literal notranslate"><span class="pre">value</span></code> for blocks</li>
<li>Added signposting text to the explorer to steer editors away from creating pages at the root level unless they are setting up new sites</li>
<li>“Clear choice” and “Edit this page” buttons are no longer shown on the page field of the group page permissions form</li>
<li>Altered styling of stream controls to be more like all other buttons</li>
<li>Added ability to mark page models as not available for creation using the flag <code class="docutils literal notranslate"><span class="pre">is_creatable</span></code>; pages that are abstract Django models are automatically made non-creatable</li>
<li>New translations for Norwegian Bokmål and Icelandic</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Text areas in the non-default tab of the page editor now resize to the correct height</li>
<li>Tabs in “insert link” modal in the rich text editor no longer disappear (Tim Heap)</li>
<li>H2 elements in rich text fields were accidentally given a click() binding when put insite a collapsible multi field panel</li>
<li>The <code class="docutils literal notranslate"><span class="pre">wagtailimages</span></code> module is now compatible with remote storage backends that do not allow reopening closed files</li>
<li>Search no longer crashes when auto-indexing a model that doesn’t have an <code class="docutils literal notranslate"><span class="pre">id</span></code> field</li>
<li>The <code class="docutils literal notranslate"><span class="pre">wagtailfrontendcache</span></code> module’s HTTP backend has been rewritten to reliably direct requests to the configured cache hostname</li>
<li>Resizing single pixel images with the “fill” filter no longer raises <code class="docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code> or “tile cannot extend outside image”</li>
<li>The QuerySet returned from <code class="docutils literal notranslate"><span class="pre">search</span></code> operations when using the database search backend now correctly preserves additional properties of the original query, such as <code class="docutils literal notranslate"><span class="pre">prefetch_related</span></code> / <code class="docutils literal notranslate"><span class="pre">select_related</span></code></li>
<li>Responses from the external image URL generator are correctly marked as streaming and will no longer fail when used with Django’s cache middleware</li>
<li>Page copy now works with pages that use multiple inheritance</li>
<li>Form builder pages now pick up template variables defined in the <code class="docutils literal notranslate"><span class="pre">get_context</span></code> method</li>
<li>When copying a page, IDs of child objects within page revision records were not remapped to the new objects; this would cause those objects to be lost from the original page when editing the new one</li>
<li>Newly added redirects now take effect on all sites, rather than just the site that the Wagtail admin backend was accessed through</li>
<li>Add user form no longer throws a hard error on validation failure</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="promoted-search-results-no-longer-in-wagtailsearch">
<h6>“Promoted search results” no longer in <code class="xref py py-mod docutils literal notranslate"><span class="pre">wagtailsearch</span></code><a class="headerlink" href="#promoted-search-results-no-longer-in-wagtailsearch" title="Permalink to this headline">¶</a></h6>
<p>This feature has moved into a contrib module so is no longer enabled by default.</p>
<p>To re-enable it, add <code class="xref py py-mod docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailsearchpromotions</span></code> to your <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>

    <span class="s1">&#39;wagtail.contrib.wagtailsearchpromotions&#39;</span><span class="p">,</span>

    <span class="o">...</span>
</pre></div>
</div>
<p>If you have references to the <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailsearch.models.EditorsPick</span></code> model in your
project, you will need to update these to point to the <code class="xref py py-mod docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailsearchpromotions.models.SearchPromotion</span></code> model instead.</p>
<p>If you created your project using the <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">start</span></code> command with Wagtail 1.0,
you will probably have references to this model in the <code class="docutils literal notranslate"><span class="pre">search/views.py</span></code> file.</p>
</div>
<div class="section" id="is-abstract-flag-on-page-models-has-been-replaced-by-is-creatable">
<h6><code class="docutils literal notranslate"><span class="pre">is_abstract</span></code> flag on page models has been replaced by <code class="docutils literal notranslate"><span class="pre">is_creatable</span></code><a class="headerlink" href="#is-abstract-flag-on-page-models-has-been-replaced-by-is-creatable" title="Permalink to this headline">¶</a></h6>
<p>Previous versions of Wagtail provided an undocumented <code class="docutils literal notranslate"><span class="pre">is_abstract</span></code> flag on page models - not to be confused with Django’s <code class="docutils literal notranslate"><span class="pre">abstract</span></code> Meta flag - to indicate that it should not be included in the list of available page types for creation. (Typically this would be used on model classes that were designed to be subclassed to create new page types, rather than used directly.) To avoid confusion with Django’s distinct concept of abstract models, this has now been replaced by a new flag, <code class="docutils literal notranslate"><span class="pre">is_creatable</span></code>.</p>
<p>If you have used <code class="docutils literal notranslate"><span class="pre">is_abstract</span> <span class="pre">=</span> <span class="pre">True</span></code> on any of your models, you should now change this to <code class="docutils literal notranslate"><span class="pre">is_creatable</span> <span class="pre">=</span> <span class="pre">False</span></code>.</p>
<p>It is not necessary to include this flag if the model is abstract in the Django sense (i.e. it has <code class="docutils literal notranslate"><span class="pre">abstract</span> <span class="pre">=</span> <span class="pre">True</span></code> in the model’s <code class="docutils literal notranslate"><span class="pre">Meta</span></code> class), since it would never be valid to create pages of that type.</p>
</div>
</div>
</div>
<span id="document-releases/1.0"></span><div class="section" id="wagtail-1-0-release-notes">
<h4>Wagtail 1.0 release notes<a class="headerlink" href="#wagtail-1-0-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="streamfield-a-field-type-for-freeform-content">
<h6>StreamField - a field type for freeform content<a class="headerlink" href="#streamfield-a-field-type-for-freeform-content" title="Permalink to this headline">¶</a></h6>
<p>StreamField provides an editing model for freeform content such as blog posts and news stories, allowing diverse content types such as text, images, headings, video and more specialised types such as maps and charts to be mixed in any order. See <a class="reference internal" href="index.html#streamfield"><span class="std std-ref">How to use StreamField for mixed content</span></a>.</p>
</div>
<div class="section" id="wagtail-api-a-restful-api-for-your-wagtail-site">
<h6>Wagtail API - A RESTful API for your Wagtail site<a class="headerlink" href="#wagtail-api-a-restful-api-for-your-wagtail-site" title="Permalink to this headline">¶</a></h6>
<p>When installed, the new Wagtail API module provides a RESTful web API to your
Wagtail site. You can use this for accessing your raw field content for your
sites pages, images and documents in JSON format.</p>
</div>
<div class="section" id="mysql-support">
<h6>MySQL support<a class="headerlink" href="#mysql-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now officially supports MySQL as a database backend.</p>
</div>
<div class="section" id="django-1-8-support">
<h6>Django 1.8 support<a class="headerlink" href="#django-1-8-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now officially supports running under Django 1.8.</p>
</div>
<div class="section" id="vanilla-project-template">
<h6>Vanilla project template<a class="headerlink" href="#vanilla-project-template" title="Permalink to this headline">¶</a></h6>
<p>The built-in project template is more like the Django built-in one with several
Wagtail-specific additions. It includes bare minimum settings and two apps (home and search).</p>
</div>
<div class="section" id="minor-changes">
<h6>Minor changes<a class="headerlink" href="#minor-changes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Dropped Django 1.6 support</li>
<li>Dropped Python 2.6 and 3.2 support</li>
<li>Dropped Elasticsearch 0.90.x support</li>
<li>Removed dependency on <code class="docutils literal notranslate"><span class="pre">libsass</span></code></li>
<li>Users without usernames can now be created and edited in the admin interface</li>
<li>Added new translations for Croatian and Finnish</li>
</ul>
<div class="section" id="core">
<h7>Core<a class="headerlink" href="#core" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>The Page model now records the date/time that a page was first published, as the field <code class="docutils literal notranslate"><span class="pre">first_published_at</span></code></li>
<li>Increased the maximum length of a page slug from 50 to 255 characters</li>
<li>Added hooks <code class="docutils literal notranslate"><span class="pre">register_rich_text_embed_handler</span></code> and <code class="docutils literal notranslate"><span class="pre">register_rich_text_link_handler</span></code> for customising link / embed handling within rich text fields</li>
<li>Page URL paths can now be longer than 255 characters</li>
</ul>
</div>
<div class="section" id="admin">
<h7>Admin<a class="headerlink" href="#admin" title="Permalink to this headline">¶</a></h7>
<p><strong>UI</strong></p>
<ul class="simple">
<li>Improvements to the layout of the left-hand menu footer</li>
<li>Menu items of custom apps are now highlighted when being used</li>
<li>Added thousands separator for counters on dashboard</li>
<li>Added contextual links to admin notification messages</li>
<li>When copying pages, it is now possible to specify a place to copy to</li>
<li>Added pagination to the snippets listing and chooser</li>
<li>Page / document / image / snippet choosers now include a link to edit the chosen item</li>
<li>Plain text fields in the page editor now use auto-expanding text areas</li>
<li>Added “Add child page” button to admin userbar</li>
<li>Added update notifications (See: <a class="reference internal" href="index.html#update-notifications"><span class="std std-ref">Wagtail update notifications</span></a>)</li>
</ul>
<p><strong>Page editor</strong></p>
<ul class="simple">
<li>JavaScript includes in the admin backend have been moved to the HTML header, to accommodate form widgets that render inline scripts that depend on libraries such as jQuery</li>
<li>The external link chooser in rich text areas now accepts URLs of the form ‘/some/local/path’, to allow linking to non-Wagtail-controlled URLs within the local site</li>
<li>Bare text entered in rich text areas is now automatically wrapped in a paragraph element</li>
</ul>
<p><strong>Edit handlers API</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">FieldPanel</span></code> now accepts an optional <code class="docutils literal notranslate"><span class="pre">widget</span></code> parameter to override the field’s default form widget</li>
<li>Page model fields without a <code class="docutils literal notranslate"><span class="pre">FieldPanel</span></code> are no longer displayed in the form</li>
<li>No longer need to specify the base model on <code class="docutils literal notranslate"><span class="pre">InlinePanel</span></code> definitions</li>
<li>Page classes can specify an edit_handler property to override the default Content / Promote / Settings tabbed interface. See <a class="reference internal" href="index.html#customising-the-tabbed-interface"><span class="std std-ref">Customising the tabbed interface</span></a>.</li>
</ul>
<p><strong>Other admin changes</strong></p>
<ul class="simple">
<li>SCSS files in wagtailadmin now use absolute imports, to permit overriding by user stylesheets</li>
<li>Removed the dependency on <code class="docutils literal notranslate"><span class="pre">LOGIN_URL</span></code> and <code class="docutils literal notranslate"><span class="pre">LOGIN_REDIRECT_URL</span></code> settings</li>
<li>Password reset view names namespaced to wagtailadmin</li>
<li>Removed the need to add permission check on admin views (now automated)</li>
<li>Reversing <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.admin.login</span></code> will no longer lead to Wagtails login view (making it easier to have frontend login views)</li>
<li>Added cache-control headers to all admin views. This allows Varnish/Squid/CDN to run on vanilla settings in front of a Wagtail site</li>
<li>Date / time pickers now consistently use times without seconds, to prevent JavasSript behaviour glitches when focusing / unfocusing fields</li>
<li>Added hook <code class="docutils literal notranslate"><span class="pre">construct_homepage_summary_items</span></code> for customising the site summary panel on the admin homepage</li>
<li>Renamed the <code class="docutils literal notranslate"><span class="pre">construct_wagtail_edit_bird</span></code> hook to <code class="docutils literal notranslate"><span class="pre">construct_wagtail_userbar</span></code></li>
<li>‘static’ template tags are now used throughout the admin templates, in place of <code class="docutils literal notranslate"><span class="pre">STATIC_URL</span></code></li>
</ul>
</div>
<div class="section" id="docs">
<h7>Docs<a class="headerlink" href="#docs" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Support for <code class="docutils literal notranslate"><span class="pre">django-sendfile</span></code> added</li>
<li>Documents now served with correct mime-type</li>
<li>Support for <code class="docutils literal notranslate"><span class="pre">If-Modified-Since</span></code> HTTP header</li>
</ul>
</div>
<div class="section" id="search">
<h7>Search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Search view accepts “page” GET parameter in line with pagination</li>
<li>Added <a class="reference internal" href="index.html#wagtailsearch-backends-auto-update"><span class="std std-ref">AUTO_UPDATE</span></a> flag to search backend settings to enable/disable automatically updating the search index on model changes</li>
</ul>
</div>
<div class="section" id="routable-pages">
<h7>Routable pages<a class="headerlink" href="#routable-pages" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Added a new decorator-based syntax for RoutablePage, compatible with Django 1.8</li>
</ul>
</div>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">document_served</span></code> signal now correctly passes the Document class as <code class="docutils literal notranslate"><span class="pre">sender</span></code> and the document as <code class="docutils literal notranslate"><span class="pre">instance</span></code></li>
<li>Image edit page no longer throws <code class="docutils literal notranslate"><span class="pre">OSError</span></code> when the original image is missing</li>
<li>Collapsible blocks stay open on any form error</li>
<li>Document upload modal no longer switches tabs on form errors</li>
<li><code class="docutils literal notranslate"><span class="pre">with_metaclass</span></code> is now imported from Django’s bundled copy of the <code class="docutils literal notranslate"><span class="pre">six</span></code> library, to avoid errors on Mac OS X from an outdated system copy of the library being imported</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="support-for-older-django-python-elasticsearch-versions-dropped">
<h6>Support for older Django/Python/Elasticsearch versions dropped<a class="headerlink" href="#support-for-older-django-python-elasticsearch-versions-dropped" title="Permalink to this headline">¶</a></h6>
<p>This release drops support for Django 1.6, Python 2.6/3.2 and Elasticsearch 0.90.x. Please make sure these are updated before upgrading.</p>
<p>If you are upgrading from Elasticsearch 0.90.x, you may also need to update the <code class="docutils literal notranslate"><span class="pre">elasticsearch</span></code> pip package to a version greater than <code class="docutils literal notranslate"><span class="pre">1.0</span></code> as well.</p>
</div>
<div class="section" id="wagtail-version-upgrade-notifications-are-enabled-by-default">
<h6>Wagtail version upgrade notifications are enabled by default<a class="headerlink" href="#wagtail-version-upgrade-notifications-are-enabled-by-default" title="Permalink to this headline">¶</a></h6>
<p>Starting from Wagtail 1.0, the admin dashboard will (for admin users only) perform a check to see if newer releases are available. This also provides the Wagtail team with the hostname of your Wagtail site. If you’d rather not receive update notifications, or if you’d like your site to remain unknown, you can disable it by adding this line to your settings file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WAGTAIL_ENABLE_UPDATE_CHECK</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="section" id="inlinepanel-definitions-no-longer-need-to-specify-the-base-model">
<h6><code class="docutils literal notranslate"><span class="pre">InlinePanel</span></code> definitions no longer need to specify the base model<a class="headerlink" href="#inlinepanel-definitions-no-longer-need-to-specify-the-base-model" title="Permalink to this headline">¶</a></h6>
<p>In previous versions of Wagtail, inline child blocks on a page or snippet were defined using a declaration like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">InlinePanel</span><span class="p">(</span><span class="n">HomePage</span><span class="p">,</span> <span class="s1">&#39;carousel_items&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Carousel items&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>It is no longer necessary to pass the base model as a parameter, so this declaration should be changed to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">InlinePanel</span><span class="p">(</span><span class="s1">&#39;carousel_items&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Carousel items&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The old format is now deprecated; all existing <code class="docutils literal notranslate"><span class="pre">InlinePanel</span></code> declarations should be updated to the new format.</p>
<div class="section" id="custom-image-models-should-now-set-the-admin-form-fields-attribute">
<h7>Custom image models should now set the <code class="docutils literal notranslate"><span class="pre">admin_form_fields</span></code> attribute<a class="headerlink" href="#custom-image-models-should-now-set-the-admin-form-fields-attribute" title="Permalink to this headline">¶</a></h7>
<p>Django 1.8 now requires that all the fields in a <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> must be defined in its <code class="docutils literal notranslate"><span class="pre">Meta.fields</span></code> attribute.</p>
<p>As Wagtail uses Django’s <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> for creating image model forms, we’ve added a new attribute called <code class="docutils literal notranslate"><span class="pre">admin_form_fields</span></code>
that should be set to a <code class="docutils literal notranslate"><span class="pre">tuple</span></code> of field names on the image model.</p>
<p>See <a class="reference internal" href="index.html#custom-image-model"><span class="std std-ref">Custom image models</span></a> for an example.</p>
</div>
</div>
<div class="section" id="you-no-longer-need-login-url-and-login-redirect-url-to-point-to-wagtail-admin">
<h6>You no longer need <code class="docutils literal notranslate"><span class="pre">LOGIN_URL</span></code> and <code class="docutils literal notranslate"><span class="pre">LOGIN_REDIRECT_URL</span></code> to point to Wagtail admin.<a class="headerlink" href="#you-no-longer-need-login-url-and-login-redirect-url-to-point-to-wagtail-admin" title="Permalink to this headline">¶</a></h6>
<p>If you are upgrading from an older version of Wagtail, you probably want to remove these from your project settings.</p>
<p>Previously, these two settings needed to be set to <code class="docutils literal notranslate"><span class="pre">wagtailadmin_login</span></code> and <code class="docutils literal notranslate"><span class="pre">wagtailadmin_dashboard</span></code>
respectively or Wagtail would become very tricky to log in to. This is no longer the case and Wagtail
should work fine without them.</p>
</div>
<div class="section" id="routablepage-now-uses-decorator-syntax-for-defining-views">
<h6><code class="docutils literal notranslate"><span class="pre">RoutablePage</span></code> now uses decorator syntax for defining views<a class="headerlink" href="#routablepage-now-uses-decorator-syntax-for-defining-views" title="Permalink to this headline">¶</a></h6>
<p>In previous versions of Wagtail, page types that used the <code class="xref py py-class docutils literal notranslate"><span class="pre">RoutablePageMixin</span></code> had endpoints configured by setting their <code class="xref py py-attr docutils literal notranslate"><span class="pre">subpage_urls</span></code> attribute to a list of urls with view names. This will not work on Django 1.8 as view names can no longer be passed into a url (see: <a class="reference external" href="https://docs.djangoproject.com/en/stable/releases/1.8/#django-conf-urls-patterns">https://docs.djangoproject.com/en/stable/releases/1.8/#django-conf-urls-patterns</a>).</p>
<p>Wagtail 1.0 introduces a new syntax where each view function is annotated with a <code class="docutils literal notranslate"><span class="pre">&#64;route</span></code> decorator - see <a class="reference internal" href="index.html#routable-page-mixin"><span class="std std-ref">RoutablePageMixin</span></a>.</p>
<p>The old <code class="docutils literal notranslate"><span class="pre">subpage_urls</span></code> convention will continue to work on Django versions prior to 1.8, but this is now deprecated; all existing <code class="docutils literal notranslate"><span class="pre">RoutablePage</span></code> definitions should be updated to the decorator-based convention.</p>
</div>
<div class="section" id="upgrading-from-the-external-wagtailapi-module">
<h6>Upgrading from the external <code class="docutils literal notranslate"><span class="pre">wagtailapi</span></code> module.<a class="headerlink" href="#upgrading-from-the-external-wagtailapi-module" title="Permalink to this headline">¶</a></h6>
<p>If you were previously using the external <code class="docutils literal notranslate"><span class="pre">wagtailapi</span></code> module (which has now become <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailapi</span></code>). Please be aware of the following backwards-incompatible changes:</p>
<p><strong>1. Representation of foreign keys has changed</strong></p>
<p>Foreign keys were previously represented by just the value of their primary key.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;feed_image&quot;</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>This has now been changed to add some <code class="docutils literal notranslate"><span class="pre">meta</span></code> information:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;feed_image&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;wagtailimages.Image&quot;</span><span class="p">,</span>
        <span class="s2">&quot;detail_url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://api.example.com/api/v1/images/1/&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>2. On the page detail view, the “parent” field has been moved out of meta</strong></p>
<p>Previously, there was a “parent” field in the “meta” section on the page detail
view:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;demo.BlogPage&quot;</span><span class="p">,</span>
         <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">},</span>

    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This has now been moved to the top level. Also, the above change to how foreign
keys are represented applies to this field too:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;demo.BlogPage&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
         <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
             <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;demo.BlogIndexPage&quot;</span>
         <span class="p">}</span>
    <span class="p">}</span>

    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="celery-no-longer-automatically-used-for-sending-notification-emails">
<h6>Celery no longer automatically used for sending notification emails<a class="headerlink" href="#celery-no-longer-automatically-used-for-sending-notification-emails" title="Permalink to this headline">¶</a></h6>
<p>Previously, Wagtail would try to use Celery whenever the <code class="docutils literal notranslate"><span class="pre">djcelery</span></code> module was
installed, even if Celery wasn’t actually set up. This could cause a very hard
to track down problem where notification emails would not be sent so this
functionality has now been removed.</p>
<p>If you would like to keep using Celery for sending notification emails, have a
look at: <a class="reference external" href="https://pypi.python.org/pypi/django-celery-email">django-celery-email</a></p>
</div>
<div class="section" id="login-password-reset-views-renamed">
<h6>Login/Password reset views renamed<a class="headerlink" href="#login-password-reset-views-renamed" title="Permalink to this headline">¶</a></h6>
<p>It was previously possible to reverse the Wagtail login view using <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.views.login</span></code>.
This is no longer possible. Update any references to <code class="docutils literal notranslate"><span class="pre">wagtailadmin_login</span></code>.</p>
<p>Password reset view name has changed from <code class="docutils literal notranslate"><span class="pre">password_reset</span></code> to <code class="docutils literal notranslate"><span class="pre">wagtailadmin_password_reset</span></code>.</p>
</div>
<div class="section" id="javascript-includes-in-admin-backend-have-been-moved">
<h6>JavaScript includes in admin backend have been moved<a class="headerlink" href="#javascript-includes-in-admin-backend-have-been-moved" title="Permalink to this headline">¶</a></h6>
<p>To improve compatibility with third-party form widgets, pages within the Wagtail admin backend now output their JavaScript includes in the HTML header, rather than at the end of the page. If your project extends the admin backend (through the <code class="docutils literal notranslate"><span class="pre">register_admin_menu_item</span></code> hook, for example) you will need to ensure that all associated JavaScript code runs correctly from the new location. In particular, any code that accesses HTML elements will need to be contained in an ‘onload’ handler (e.g. jQuery’s <code class="docutils literal notranslate"><span class="pre">$(document).ready()</span></code>).</p>
</div>
<div class="section" id="edithandler-internal-api-has-changed">
<h6>EditHandler internal API has changed<a class="headerlink" href="#edithandler-internal-api-has-changed" title="Permalink to this headline">¶</a></h6>
<p>While it is not an official Wagtail API, it has been possible for Wagtail site implementers to define their own <code class="docutils literal notranslate"><span class="pre">EditHandler</span></code> subclasses for use in panel definitions, to customise the behaviour of the page / snippet editing forms. If you have made use of this facility, you will need to update your custom EditHandlers, as this mechanism has been refactored (to allow EditHandler classes to keep a persistent reference to their corresponding model). If you have only used Wagtail’s built-in panel types (<code class="docutils literal notranslate"><span class="pre">FieldPanel</span></code>, <code class="docutils literal notranslate"><span class="pre">InlinePanel</span></code>, <code class="docutils literal notranslate"><span class="pre">PageChooserPanel</span></code> and so on), you are unaffected by this change.</p>
<p>Previously, functions like <code class="docutils literal notranslate"><span class="pre">FieldPanel</span></code> acted as ‘factory’ functions, where a call such as <code class="docutils literal notranslate"><span class="pre">FieldPanel('title')</span></code> constructed and returned an <code class="docutils literal notranslate"><span class="pre">EditHandler</span></code> subclass tailored to work on a ‘title’ field. These functions now return an object with a <code class="docutils literal notranslate"><span class="pre">bind_to_model</span></code> method instead; the EditHandler subclass can be obtained by calling this with the model class as a parameter. As a guide to updating your custom EditHandler code, you may wish to refer to <a class="reference external" href="https://github.com/wagtail/wagtail/commit/121c01c7f7db6087a985fa8dc9957bc78b9f6a6a">the relevant change to the Wagtail codebase</a>.</p>
</div>
<div class="section" id="chooser-panel-templates-are-obsolete">
<h6>chooser_panel templates are obsolete<a class="headerlink" href="#chooser-panel-templates-are-obsolete" title="Permalink to this headline">¶</a></h6>
<p>If you have added your own custom admin views to the Wagtail admin (e.g. through the <code class="docutils literal notranslate"><span class="pre">register_admin_urls</span></code> hook), you may have used one of the following template includes to incorporate a chooser element for pages, documents, images or snippets into your forms:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">wagtailadmin/edit_handlers/chooser_panel.html</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">wagtailadmin/edit_handlers/page_chooser_panel.html</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">wagtaildocs/edit_handlers/document_chooser_panel.html</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">wagtailimages/edit_handlers/image_chooser_panel.html</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">wagtailsnippets/edit_handlers/snippet_chooser_panel.html</span></code></li>
</ul>
<p>All of these templates are now deprecated. Wagtail now provides a set of Django form widgets for this purpose - <code class="docutils literal notranslate"><span class="pre">AdminPageChooser</span></code>, <code class="docutils literal notranslate"><span class="pre">AdminDocumentChooser</span></code>, <code class="docutils literal notranslate"><span class="pre">AdminImageChooser</span></code> and <code class="docutils literal notranslate"><span class="pre">AdminSnippetChooser</span></code> - which can be used in place of the <code class="docutils literal notranslate"><span class="pre">HiddenInput</span></code> widget that these form fields were previously using. The field can then be rendered using the regular <code class="docutils literal notranslate"><span class="pre">wagtailadmin/shared/field.html</span></code> or <code class="docutils literal notranslate"><span class="pre">wagtailadmin/shared/field_as_li.html</span></code> template.</p>
</div>
<div class="section" id="document-served-signal-arguments-have-changed">
<h6><code class="docutils literal notranslate"><span class="pre">document_served</span></code> signal arguments have changed<a class="headerlink" href="#document-served-signal-arguments-have-changed" title="Permalink to this headline">¶</a></h6>
<p>Previously, the <code class="docutils literal notranslate"><span class="pre">document_served</span></code> signal (which is fired whenever a user downloads a document) passed the document instance as the <code class="docutils literal notranslate"><span class="pre">sender</span></code>. This has now been changed to correspond the behaviour of Django’s built-in signals; <code class="docutils literal notranslate"><span class="pre">sender</span></code> is now the <code class="docutils literal notranslate"><span class="pre">Document</span></code> class, and the document instance is passed as the argument <code class="docutils literal notranslate"><span class="pre">instance</span></code>. Any existing signal listeners that expect to receive the document instance in <code class="docutils literal notranslate"><span class="pre">sender</span></code> must now be updated to check the <code class="docutils literal notranslate"><span class="pre">instance</span></code> argument instead.</p>
</div>
<div class="section" id="custom-image-models-must-specify-an-admin-form-fields-list">
<h6>Custom image models must specify an <code class="docutils literal notranslate"><span class="pre">admin_form_fields</span></code> list<a class="headerlink" href="#custom-image-models-must-specify-an-admin-form-fields-list" title="Permalink to this headline">¶</a></h6>
<p>Previously, the forms for creating and editing images followed Django’s default behaviour of showing all fields defined on the model; this would include any custom fields specific to your project that you defined by subclassing <code class="docutils literal notranslate"><span class="pre">AbstractImage</span></code> and setting <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_IMAGE_MODEL</span></code>. This behaviour is risky as it may lead to fields being unintentionally exposed to the user, and so Django has deprecated this, for removal in Django 1.8. Accordingly, if you create your own custom subclass of <code class="docutils literal notranslate"><span class="pre">AbstractImage</span></code>, you must now provide an <code class="docutils literal notranslate"><span class="pre">admin_form_fields</span></code> property, listing the fields that should appear on the image creation / editing form - for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wagtail.wagtailimages.models</span> <span class="kn">import</span> <span class="n">AbstractImage</span><span class="p">,</span> <span class="n">Image</span>

<span class="k">class</span> <span class="nc">MyImage</span><span class="p">(</span><span class="n">AbstractImage</span><span class="p">):</span>
    <span class="n">photographer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">has_legal_approval</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>

    <span class="n">admin_form_fields</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">admin_form_fields</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;photographer&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="construct-wagtail-edit-bird-hook-has-been-renamed">
<h6><code class="docutils literal notranslate"><span class="pre">construct_wagtail_edit_bird</span></code> hook has been renamed<a class="headerlink" href="#construct-wagtail-edit-bird-hook-has-been-renamed" title="Permalink to this headline">¶</a></h6>
<p>Previously you could customize the Wagtail userbar using the <code class="docutils literal notranslate"><span class="pre">construct_wagtail_edit_bird</span></code> hook.
The hook has been renamed to <code class="docutils literal notranslate"><span class="pre">construct_wagtail_userbar</span></code>.</p>
<p>The old hook is now deprecated; all existing <code class="docutils literal notranslate"><span class="pre">construct_wagtail_edit_bird</span></code> declarations should be updated to the new hook.</p>
</div>
<div class="section" id="image-compression-quality-setting-has-been-renamed">
<h6><code class="docutils literal notranslate"><span class="pre">IMAGE_COMPRESSION_QUALITY</span></code> setting has been renamed<a class="headerlink" href="#image-compression-quality-setting-has-been-renamed" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">IMAGE_COMPRESSION_QUALITY</span></code> setting, which determines the quality of saved JPEG images as a value from 1 to 100, has been renamed to <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_JPEG_QUALITY</span></code>. If you have used this setting, please update your settings file accordingly.</p>
</div>
</div>
</div>
<span id="document-releases/0.8.10"></span><div class="section" id="wagtail-0-8-10-release-notes">
<h4>Wagtail 0.8.10 release notes<a class="headerlink" href="#wagtail-0-8-10-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>When copying a page, IDs of child objects within page revision records were not remapped to the new objects; this would cause those objects to be lost from the original page when editing the new one</li>
<li>Search no longer crashes when auto-indexing a model that doesn’t have an id field (Scot Hacker)</li>
<li>Resizing single pixel images with the “fill” filter no longer raises <code class="docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code> or “tile cannot extend outside image”</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/0.8.8"></span><div class="section" id="wagtail-0-8-8-release-notes">
<h4>Wagtail 0.8.8 release notes<a class="headerlink" href="#wagtail-0-8-8-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Form builder no longer raises a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> when submitting unchecked boolean field</li>
<li>Image upload form no longer breaks when using i10n thousand separators</li>
<li>Multiple image uploader now escapes HTML in filenames</li>
<li>Retrieving an individual item from a sliced <code class="docutils literal notranslate"><span class="pre">BaseSearchResults</span></code> object now properly takes the slice offset into account</li>
<li>Removed dependency on unicodecsv which fixes a crash on Python 3</li>
<li>Submitting unicode text in form builder form no longer crashes with <code class="docutils literal notranslate"><span class="pre">UnicodeEncodeError</span></code> on Python 2</li>
<li>Creating a proxy model from a Page class no longer crashes in the system check</li>
<li>Unrecognised embed URLs passed to the <code class="docutils literal notranslate"><span class="pre">|embed</span></code> filter no longer cause the whole page to crash with an <code class="docutils literal notranslate"><span class="pre">EmbedNotFoundException</span></code></li>
<li>Underscores no longer get stripped from page slugs</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/0.8.7"></span><div class="section" id="wagtail-0-8-7-release-notes">
<h4>Wagtail 0.8.7 release notes<a class="headerlink" href="#wagtail-0-8-7-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-changed" id="id1">What’s changed</a></li>
</ul>
</div>
<div class="section" id="what-s-changed">
<h5><a class="toc-backref" href="#id1">What’s changed</a><a class="headerlink" href="#what-s-changed" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">wagtailfrontendcache</span></code> no longer tries to purge pages that are not in a site</li>
<li>The contents of <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code> elements in the rich text editor were not being whitelisted</li>
<li>Due to the above issue, embeds/images in a rich text field would sometimes be saved into the database in their editor representation</li>
<li>RoutablePage now prevents <code class="docutils literal notranslate"><span class="pre">subpage_urls</span></code> from being defined as a property, which would cause a memory leak</li>
<li>Added validation to prevent pages being created with only whitespace characters in their title fields</li>
<li>Users are no longer logged out on changing password when SessionAuthenticationMiddleware (added in Django 1.7) is in use</li>
<li>Added a workaround for a Python / Django issue that prevented documents with certain non-ASCII filenames from being served</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/0.8.6"></span><div class="section" id="wagtail-0-8-6-release-notes">
<h4>Wagtail 0.8.6 release notes<a class="headerlink" href="#wagtail-0-8-6-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Translations updated, including new translations for Czech, Italian and Japanese</li>
<li>The “fixtree” command can now delete orphaned pages</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>django-taggit library updated to 0.12.3, to fix a bug with migrations on SQLite on Django 1.7.2 and above (<a class="reference external" href="https://github.com/alex/django-taggit/issues/285">https://github.com/alex/django-taggit/issues/285</a>)</li>
<li>Fixed a bug that caused children of a deleted page to not be deleted if they had a different type</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="orphaned-pages-may-need-deleting">
<h6>Orphaned pages may need deleting<a class="headerlink" href="#orphaned-pages-may-need-deleting" title="Permalink to this headline">¶</a></h6>
<p>This release fixes a bug with page deletion introduced in 0.8, where deleting a page with child pages will result in those child pages being left behind in the database (unless the child pages are of the same type as the parent). This may cause errors later on when creating new pages in the same position. To identify and delete these orphaned pages, it is recommended that you run the following command (from the project root) after upgrading to 0.8.6:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./manage.py fixtree
</pre></div>
</div>
<p>This will output a list of any orphaned pages found, and request confirmation before deleting them.</p>
<p>Since this now makes <code class="docutils literal notranslate"><span class="pre">fixtree</span></code> an interactive command, a <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">fixtree</span> <span class="pre">--noinput</span></code> option has been added to restore the previous non-interactive behaviour. With this option enabled, deleting orphaned pages is always skipped.</p>
</div>
</div>
</div>
<span id="document-releases/0.8.5"></span><div class="section" id="wagtail-0-8-5-release-notes">
<h4>Wagtail 0.8.5 release notes<a class="headerlink" href="#wagtail-0-8-5-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>On adding a new page, the available page types are ordered by the displayed verbose name</li>
<li>Active admin submenus were not properly closed when activating another</li>
<li><code class="docutils literal notranslate"><span class="pre">get_sitemap_urls</span></code> is now called on the specific page class so it can now be overridden</li>
<li>(Firefox and IE) Fixed preview window hanging and not refocusing when “Preview” button is clicked again</li>
<li>Storage backends that return raw ContentFile objects are now handled correctly when resizing images</li>
<li>Punctuation characters are no longer stripped when performing search queries</li>
<li>When adding tags where there were none before, it is now possible to save a single tag with multiple words in it</li>
<li><code class="docutils literal notranslate"><span class="pre">richtext</span></code> template tag no longer raises <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> if <code class="docutils literal notranslate"><span class="pre">None</span></code> is passed into it</li>
<li>Serving documents now uses a streaming HTTP response and will no longer break Django’s cache middleware</li>
<li>User admin area no longer fails in the presence of negative user IDs (as used by <code class="docutils literal notranslate"><span class="pre">django-guardian</span></code>’s default settings)</li>
<li>Password reset emails now use the <code class="docutils literal notranslate"><span class="pre">BASE_URL</span></code> setting for the reset URL</li>
<li><code class="docutils literal notranslate"><span class="pre">BASE_URL</span></code> is now included in the project template’s default settings file</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/0.8.4"></span><div class="section" id="wagtail-0-8-4-release-notes">
<h4>Wagtail 0.8.4 release notes<a class="headerlink" href="#wagtail-0-8-4-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>It is no longer possible to have the explorer and settings menu open at the same time</li>
<li>Page IDs in page revisions were not updated on page copy, causing subsequent edits to be committed to the original page instead</li>
<li>Copying a page now creates a new page revision, ensuring that changes to the title/slug are correctly reflected in the editor (and also ensuring that the user performing the copy is logged)</li>
<li>Prevent a race condition when creating Filter objects</li>
<li>On adding a new page, the available page types are ordered by the displayed verbose name</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/0.8.3"></span><div class="section" id="wagtail-0-8-3-release-notes">
<h4>Wagtail 0.8.3 release notes<a class="headerlink" href="#wagtail-0-8-3-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Added missing jQuery UI sprite files, causing collectstatic to throw errors (most reported on Heroku)</li>
<li>Page system check for on_delete actions of ForeignKeys was throwing false positives when page class descends from an abstract class (Alejandro Giacometti)</li>
<li>Page system check for on_delete actions of ForeignKeys now only raises warnings, not errors</li>
<li>Fixed a regression where form builder submissions containing a number field would fail with a JSON serialisation error</li>
<li>Resizing an image with a focal point equal to the image size would result in a divide-by-zero error</li>
<li>Focal point indicator would sometimes be positioned incorrectly for small or thin images</li>
<li>Fix: Focal point chooser background colour changed to grey to make working with transparent images easier</li>
<li>Elasticsearch configuration now supports specifying HTTP authentication parameters as part of the URL, and defaults to ports 80 (HTTP) and 443 (HTTPS) if port number not specified</li>
<li>Fixed a TypeError when previewing pages that use RoutablePageMixin</li>
<li>Rendering image with missing file in rich text no longer crashes the entire page</li>
<li>IOErrors thrown by underlying image libraries that are not reporting a missing image file are no longer caught</li>
<li>Fix: Minimum Pillow version bumped to 2.6.1 to work around a crash when using images with transparency</li>
<li>Fix: Images with transparency are now handled better when being used in feature detection</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="port-number-must-be-specified-when-running-elasticsearch-on-port-9200">
<h6>Port number must be specified when running Elasticsearch on port 9200<a class="headerlink" href="#port-number-must-be-specified-when-running-elasticsearch-on-port-9200" title="Permalink to this headline">¶</a></h6>
<p>In previous versions, an Elasticsearch connection URL in <code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_BACKENDS</span></code> without an explicit port number (e.g. <code class="docutils literal notranslate"><span class="pre">http://localhost/</span></code>) would be treated as port 9200 (the Elasticsearch default) whereas the correct behaviour would be to use the default http/https port of 80/443. This behaviour has now been fixed, so sites running Elasticsearch on port 9200 must now specify this explicitly - e.g. <code class="docutils literal notranslate"><span class="pre">http://localhost:9200</span></code>. (Projects using the default settings, or the settings given in the Wagtail documentation, are unaffected.)</p>
</div>
</div>
</div>
<span id="document-releases/0.8.1"></span><div class="section" id="wagtail-0-8-1-release-notes">
<h4>Wagtail 0.8.1 release notes<a class="headerlink" href="#wagtail-0-8-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Fixed a regression where images would fail to save when feature detection is active</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/0.8"></span><div class="section" id="wagtail-0-8-release-notes">
<h4>Wagtail 0.8 release notes<a class="headerlink" href="#wagtail-0-8-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<p>Wagtail 0.8 is designated a Long Term Support (LTS) release. Long Term Support releases will continue to receive maintenance updates as necessary to address security and data-loss related issues, up until the next LTS release (typically a period of 8 months).</p>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Page operations (creation, publishing, copying etc) are now logged via Python’s <code class="docutils literal notranslate"><span class="pre">logging</span></code> framework; to configure this, add a logger entry for <code class="docutils literal notranslate"><span class="pre">'wagtail'</span></code> or <code class="docutils literal notranslate"><span class="pre">'wagtail.core'</span></code> to the <code class="docutils literal notranslate"><span class="pre">LOGGING</span></code> setup in your settings file.</li>
<li>The save button on the page edit page now redirects the user back to the edit page instead of the explorer</li>
<li>Signal handlers for <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailsearch</span></code> and <code class="docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailfrontendcache</span></code> are now automatically registered when using Django 1.7 or above.</li>
<li>Added a Django 1.7 system check to ensure that foreign keys from Page models are set to <code class="docutils literal notranslate"><span class="pre">on_delete=SET_NULL</span></code>, to prevent inadvertent (and tree-breaking) page deletions</li>
<li>Improved error reporting on image upload, including ability to set a maximum file size via a new setting <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_MAX_UPLOAD_SIZE</span></code></li>
<li>The external image URL generator now keeps persistent image renditions, rather than regenerating them on each request, so it no longer requires a front-end cache.</li>
<li>Added Dutch translation</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Replaced references of .username with .get_username() on users for better custom user model support</li>
<li>Unpinned dependency versions for six and requests to help prevent dependency conflicts</li>
<li>Fixed TypeError when getting embed HTML with oembed on Python 3</li>
<li>Made HTML whitelisting in rich text fields more robust at catching disallowed URL schemes such as <code class="docutils literal notranslate"><span class="pre">jav\tascript:</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">created_at</span></code> timestamps on page revisions were not being preserved on page copy, causing revisions to get out of sequence</li>
<li>When copying pages recursively, revisions of sub-pages were being copied regardless of the <code class="docutils literal notranslate"><span class="pre">copy_revisions</span></code> flag</li>
<li>Updated the migration dependencies within the project template to ensure that Wagtail’s own migrations consistently apply first</li>
<li>The cache of site root paths is now cleared when a site is deleted</li>
<li>Search indexing now prevents pages from being indexed multiple times, as both the base Page model and the specific subclass</li>
<li>Search indexing now avoids trying to index abstract models</li>
<li>Fixed references to “username” in login form help text for better custom user model support</li>
<li>Later items in a model’s search_field list now consistently override earlier items, allowing subclasses to redefine rules from the parent</li>
<li>Image uploader now accepts JPEG images that PIL reports as being in MPO format</li>
<li>Multiple checkbox fields on form-builder forms did not correctly save multiple values</li>
<li>Editing a page’s slug and saving it without publishing could sometimes cause the URL paths of child pages to be corrupted</li>
<li><code class="docutils literal notranslate"><span class="pre">latest_revision_created_at</span></code> was being cleared on page publish, causing the page to drop to the bottom of explorer listings</li>
<li>Searches on partial_match fields were wrongly applying prefix analysis to the search query as well as the document (causing e.g. a query for “water” to match against “wagtail”)</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="corrupted-url-paths-may-need-fixing">
<h6>Corrupted URL paths may need fixing<a class="headerlink" href="#corrupted-url-paths-may-need-fixing" title="Permalink to this headline">¶</a></h6>
<p>This release fixes a bug in Wagtail 0.7 where editing a parent page’s slug could cause the URL paths of child pages to become corrupted. To ensure that your database does not contain any corrupted URL paths, it is recommended that you run <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">set_url_paths</span></code> after upgrading.</p>
</div>
<div class="section" id="automatic-registration-of-signal-handlers-django-1-7">
<h6>Automatic registration of signal handlers (Django 1.7+)<a class="headerlink" href="#automatic-registration-of-signal-handlers-django-1-7" title="Permalink to this headline">¶</a></h6>
<p>Signal handlers for the <code class="docutils literal notranslate"><span class="pre">wagtailsearch</span></code> core app and <code class="docutils literal notranslate"><span class="pre">wagtailfrontendcache</span></code> contrib app are automatically registered when using Django 1.7. Calls to <code class="docutils literal notranslate"><span class="pre">register_signal_handlers</span></code> from your <code class="docutils literal notranslate"><span class="pre">urls.py</span></code> can be removed.</p>
</div>
<div class="section" id="change-to-search-api-when-using-database-backend">
<h6>Change to search API when using database backend<a class="headerlink" href="#change-to-search-api-when-using-database-backend" title="Permalink to this headline">¶</a></h6>
<p>When using the database backend, calling search (either through <code class="docutils literal notranslate"><span class="pre">Page.objects.search()</span></code> or on the backend directly) will now return a <code class="docutils literal notranslate"><span class="pre">SearchResults</span></code> object rather than a Django <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> to make the database backend work more like the Elasticsearch backend.</p>
<p>This change shouldn’t affect most people as <code class="docutils literal notranslate"><span class="pre">SearchResults</span></code> behaves very similarly to <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code>. But it may cause issues if you are calling <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> specific methods after calling <code class="docutils literal notranslate"><span class="pre">.search()</span></code>. Eg: <code class="docutils literal notranslate"><span class="pre">Page.objects.search(&quot;Hello&quot;).filter(foo=&quot;Bar&quot;)</span></code> (in this case, <code class="docutils literal notranslate"><span class="pre">.filter()</span></code> should be moved before <code class="docutils literal notranslate"><span class="pre">.search()</span></code> and it would work as before).</p>
</div>
<div class="section" id="removal-of-validate-image-format-from-custom-image-model-migrations-django-1-7">
<h6>Removal of validate_image_format from custom image model migrations (Django 1.7+)<a class="headerlink" href="#removal-of-validate-image-format-from-custom-image-model-migrations-django-1-7" title="Permalink to this headline">¶</a></h6>
<p>If your project is running on Django 1.7, and you have defined a custom image model (by extending the <code class="docutils literal notranslate"><span class="pre">wagtailimages.AbstractImage</span></code> class), the migration that creates this model will probably have a reference to <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailimages.utils.validators.validate_image_format</span></code>. This module has now been removed, which will cause <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">migrate</span></code> to fail with an <code class="docutils literal notranslate"><span class="pre">ImportError</span></code> (even if the migration has already been applied). You will need to edit the migration file to remove the line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">wagtail.wagtailimages.utils.validators</span>
</pre></div>
</div>
<p>and the <code class="docutils literal notranslate"><span class="pre">validators</span></code> attribute of the ‘file’ field - that is, the line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="n">wagtail</span><span class="o">.</span><span class="n">wagtailimages</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get_upload_to</span><span class="p">,</span>
    <span class="n">width_field</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">height_field</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">wagtail</span><span class="o">.</span><span class="n">wagtailimages</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">validate_image_format</span><span class="p">],</span>
    <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;File&#39;</span><span class="p">)),</span>
</pre></div>
</div>
<p>should become:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="n">wagtail</span><span class="o">.</span><span class="n">wagtailimages</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get_upload_to</span><span class="p">,</span>
    <span class="n">width_field</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">height_field</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;File&#39;</span><span class="p">)),</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-releases/0.7"></span><div class="section" id="wagtail-0-7-release-notes">
<h4>Wagtail 0.7 release notes<a class="headerlink" href="#wagtail-0-7-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="new-interface-for-choosing-image-focal-point">
<h6>New interface for choosing image focal point<a class="headerlink" href="#new-interface-for-choosing-image-focal-point" title="Permalink to this headline">¶</a></h6>
<div class="figure">
<a class="reference internal image-reference" href="_images/focal-point-adjustment.jpg"><img alt="_images/focal-point-adjustment.jpg" src="_images/focal-point-adjustment.jpg" style="width: 332px; height: 353px;" /></a>
</div>
<p>When editing images, users can now specify a ‘focal point’ region that cropped versions of the image will be centred on. Previously the focal point could only be set automatically, through image feature detection.</p>
</div>
<div class="section" id="groups-and-sites-administration-interfaces">
<h6>Groups and Sites administration interfaces<a class="headerlink" href="#groups-and-sites-administration-interfaces" title="Permalink to this headline">¶</a></h6>
<div class="figure">
<a class="reference internal image-reference" href="_images/editor-management.png"><img alt="_images/editor-management.png" src="_images/editor-management.png" style="width: 696px;" /></a>
</div>
<p>The main navigation menu has been reorganised, placing site configuration options in a ‘Settings’ submenu. This includes two new items, which were previously only available through the Django admin backend: ‘Groups’, for setting up user groups with a specific set of permissions, and ‘Sites’, for managing the list of sites served by this Wagtail instance.</p>
</div>
<div class="section" id="page-locking">
<h6>Page locking<a class="headerlink" href="#page-locking" title="Permalink to this headline">¶</a></h6>
<div class="figure">
<a class="reference internal image-reference" href="_images/page-locking.png"><img alt="_images/page-locking.png" src="_images/page-locking.png" style="width: 696px;" /></a>
</div>
<p>Moderators and administrators now have the ability to lock a page, preventing further edits from being made to that page until it is unlocked again.</p>
</div>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">content_type</span></code> template filter has been removed from the project template, as the same thing can be accomplished with <code class="docutils literal notranslate"><span class="pre">self.get_verbose_name|slugify</span></code>.</li>
<li>Page copy operations now also copy the page revision history.</li>
<li>Page models now support a <code class="docutils literal notranslate"><span class="pre">parent_page_types</span></code> property in addition to <code class="docutils literal notranslate"><span class="pre">subpage</span> <span class="pre">types</span></code>, to restrict the types of page they can be created under.</li>
<li><code class="docutils literal notranslate"><span class="pre">register_snippet</span></code> can now be invoked as a decorator.</li>
<li>The project template (used when running <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">start</span></code>) has been updated to Django 1.7.</li>
<li>The ‘boost’ applied to the title field on searches has been reduced from 100 to 2.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">type</span></code> method of <code class="docutils literal notranslate"><span class="pre">PageQuerySet</span></code> (used to filter the QuerySet to a specific page type) now includes subclasses of the given page type.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">update_index</span></code> management command now updates all backends listed in <code class="docutils literal notranslate"><span class="pre">WAGTAILSEARCH_BACKENDS</span></code>, or a specific one passed on the command line, rather than just the default backend.</li>
<li>The ‘fill’ image resize method now supports an additional parameter defining the closeness of the crop. See <a class="reference internal" href="index.html#image-tag"><span class="std std-ref">How to use images in templates</span></a></li>
<li>Added support for invalidating Cloudflare caches. See <a class="reference internal" href="index.html#frontend-cache-purging"><span class="std std-ref">Frontend cache invalidator</span></a></li>
<li>Pages in the explorer can now be ordered by last updated time.</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>The ‘wagtail start’ command now works on Windows and other environments where the <code class="docutils literal notranslate"><span class="pre">django-admin.py</span></code> executable is not readily accessible.</li>
<li>The external image URL generator no longer stores generated images in Django’s cache; this was an unintentional side-effect of setting cache control headers.</li>
<li>The Elasticsearch backend can now search QuerySets that have been filtered with an ‘in’ clause of a non-list type (such as a <code class="docutils literal notranslate"><span class="pre">ValuesListQuerySet</span></code>).</li>
<li>Logic around the <code class="docutils literal notranslate"><span class="pre">has_unpublished_changes</span></code> flag has been fixed, to prevent issues with the ‘View draft’ button failing to show in some cases.</li>
<li>It is now easier to move pages to the beginning and end of their section</li>
<li>Image rendering no longer creates erroneous duplicate Rendition records when the focal point is blank.</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="addition-of-wagtailsites-app">
<h6>Addition of <code class="docutils literal notranslate"><span class="pre">wagtailsites</span></code> app<a class="headerlink" href="#addition-of-wagtailsites-app" title="Permalink to this headline">¶</a></h6>
<p>The Sites administration interface is contained within a new app, <code class="docutils literal notranslate"><span class="pre">wagtailsites</span></code>. To enable this on an existing Wagtail project, add the line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;wagtail.wagtailsites&#39;</span><span class="p">,</span>
</pre></div>
</div>
<p>to the <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> list in your project’s settings file.</p>
</div>
<div class="section" id="title-boost-on-search-reduced-to-2">
<h6>Title boost on search reduced to 2<a class="headerlink" href="#title-boost-on-search-reduced-to-2" title="Permalink to this headline">¶</a></h6>
<p>Wagtail’s search interface applies a ‘boost’ value to give extra weighting to matches on the title field. The original boost value of 100 was found to be excessive, and in Wagtail 0.7 this has been reduced to 2. If you have used comparable boost values on other fields, to give them similar weighting to title, you may now wish to reduce these accordingly. See <a class="reference internal" href="index.html#wagtailsearch-indexing"><span class="std std-ref">Indexing</span></a>.</p>
</div>
<div class="section" id="addition-of-locked-field-to-page-model">
<h6>Addition of <code class="docutils literal notranslate"><span class="pre">locked</span></code> field to Page model<a class="headerlink" href="#addition-of-locked-field-to-page-model" title="Permalink to this headline">¶</a></h6>
<p>The page locking mechanism adds a <code class="docutils literal notranslate"><span class="pre">locked</span></code> field to wagtailcore.Page, defaulting to False. Any application code working with Page objects should be unaffected, but any code that creates page records using direct SQL, or within existing South migrations using South’s frozen ORM, will fail as this code will be unaware of the new database column. To fix a South migration that fails in this way, add the following line to the <code class="docutils literal notranslate"><span class="pre">'wagtailcore.page'</span></code> entry at the bottom of the migration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;locked&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;django.db.models.fields.BooleanField&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;False&#39;</span><span class="p">}),</span>
</pre></div>
</div>
</div>
<div class="section" id="update-to-focal-point-key-field-on-custom-rendition-models">
<h6>Update to <code class="docutils literal notranslate"><span class="pre">focal_point_key</span></code> field on custom Rendition models<a class="headerlink" href="#update-to-focal-point-key-field-on-custom-rendition-models" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">focal_point_key</span></code> field on wagtailimages.Rendition has been changed to <code class="docutils literal notranslate"><span class="pre">null=False</span></code>, to fix an issue with duplicate renditions being created. If you have defined a custom Rendition model in your project (by extending the <code class="docutils literal notranslate"><span class="pre">wagtailimages.AbstractRendition</span></code> class), you will need to apply a migration to make the corresponding change on your custom model. Unfortunately neither South nor Django 1.7’s migration system are able to generate this automatically - you will need to customise the migration produced by <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">schemamigration</span></code> / <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">makemigrations</span></code>, using the wagtailimages migration as a guide:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/wagtail/wagtail/blob/stable/0.7.x/wagtail/wagtailimages/south_migrations/0004_auto__chg_field_rendition_focal_point_key.py">https://github.com/wagtail/wagtail/blob/stable/0.7.x/wagtail/wagtailimages/south_migrations/0004_auto__chg_field_rendition_focal_point_key.py</a> (for South / Django 1.6)</li>
<li><a class="reference external" href="https://github.com/wagtail/wagtail/blob/stable/0.7.x/wagtail/wagtailimages/migrations/0004_make_focal_point_key_not_nullable.py">https://github.com/wagtail/wagtail/blob/stable/0.7.x/wagtail/wagtailimages/migrations/0004_make_focal_point_key_not_nullable.py</a> (for Django 1.7)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/0.6"></span><div class="section" id="wagtail-0-6-release-notes">
<h4>Wagtail 0.6 release notes<a class="headerlink" href="#wagtail-0-6-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
<li><a class="reference internal" href="#deprecated-features" id="id3">Deprecated features</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="project-template-and-start-project-command">
<h6>Project template and start project command<a class="headerlink" href="#project-template-and-start-project-command" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now has a basic project template built in to make starting new projects much easier.</p>
<p>To use it, install <code class="docutils literal notranslate"><span class="pre">wagtail</span></code> onto your machine and run <code class="docutils literal notranslate"><span class="pre">wagtail</span> <span class="pre">start</span> <span class="pre">project_name</span></code>.</p>
</div>
<div class="section" id="django-1-7-support">
<h6>Django 1.7 support<a class="headerlink" href="#django-1-7-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail can now be used with Django 1.7.</p>
</div>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>A new template tag has been added for reversing URLs inside routable pages. See <a class="reference internal" href="index.html#routablepageurl-template-tag"><span class="std std-ref">The routablepageurl template tag</span></a>.</li>
<li>RoutablePage can now be used as a mixin. See <code class="xref py py-class docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailroutablepage.models.RoutablePageMixin</span></code>.</li>
<li>MenuItems can now have bundled JavaScript</li>
<li>Added the <code class="docutils literal notranslate"><span class="pre">register_admin_menu_item</span></code> hook for registering menu items at startup. See <a class="reference internal" href="index.html#admin-hooks"><span class="std std-ref">Hooks</span></a></li>
<li>Added a version indicator into the admin interface (hover over the wagtail to see it)</li>
<li>Added Russian translation</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Page URL generation now returns correct URLs for sites that have the main ‘serve’ view rooted somewhere other than ‘/’.</li>
<li>Search results in the page chooser now respect the page_type parameter on PageChooserPanel.</li>
<li>Rendition filenames are now prevented from going over 60 chars, even with a large focal_point_key.</li>
<li>Child relations that are defined on a model’s superclass (such as the base Page model) are now picked up correctly by the page editing form, page copy operations and the replace_text management command.</li>
<li>Tags on images and documents are now committed to the search index immediately on saving.</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="all-features-deprecated-in-0-4-have-been-removed">
<h6>All features deprecated in 0.4 have been removed<a class="headerlink" href="#all-features-deprecated-in-0-4-have-been-removed" title="Permalink to this headline">¶</a></h6>
<p>See: <a class="reference internal" href="index.html#deprecated-features"><span class="std std-ref">Deprecated features</span></a></p>
</div>
<div class="section" id="search-signal-handlers-have-been-moved">
<h6>Search signal handlers have been moved<a class="headerlink" href="#search-signal-handlers-have-been-moved" title="Permalink to this headline">¶</a></h6>
<p>If you have an import in your <code class="docutils literal notranslate"><span class="pre">urls.py</span></code> file like <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">wagtail.wagtailsearch</span> <span class="pre">import</span> <span class="pre">register_signal_handlers</span></code>, this must now be changed to <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">wagtail.wagtailsearch.signal_handlers</span> <span class="pre">import</span> <span class="pre">register_signal_handlers</span></code></p>
</div>
</div>
<div class="section" id="deprecated-features">
<h5><a class="toc-backref" href="#id3">Deprecated features</a><a class="headerlink" href="#deprecated-features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailsearch.indexed</span></code> module has been renamed to <code class="docutils literal notranslate"><span class="pre">wagtail.wagtailsearch.index</span></code></li>
</ul>
</div>
</div>
<span id="document-releases/0.5"></span><div class="section" id="wagtail-0-5-release-notes">
<h4>Wagtail 0.5 release notes<a class="headerlink" href="#wagtail-0-5-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id1">What’s new</a></li>
<li><a class="reference internal" href="#upgrade-considerations" id="id2">Upgrade considerations</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id1">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="multiple-image-uploader">
<h6>Multiple image uploader<a class="headerlink" href="#multiple-image-uploader" title="Permalink to this headline">¶</a></h6>
<p>The image uploader UI has been improved to allow multiple images to be uploaded at once.</p>
</div>
<div class="section" id="image-feature-detection">
<h6>Image feature detection<a class="headerlink" href="#image-feature-detection" title="Permalink to this headline">¶</a></h6>
<p>Wagtail can now apply face and feature detection on images using <a class="reference external" href="http://opencv.org/">OpenCV</a>, and use this to intelligently crop images.</p>
<p><a class="reference internal" href="index.html#image-feature-detection"><span class="std std-ref">Feature Detection</span></a></p>
</div>
<div class="section" id="using-images-outside-wagtail">
<h6>Using images outside Wagtail<a class="headerlink" href="#using-images-outside-wagtail" title="Permalink to this headline">¶</a></h6>
<p>In normal use, Wagtail will generate resized versions of images at the point that they are referenced on a template, which means that those images are not easily accessible for use outside of Wagtail, such as displaying them on external sites. Wagtail now provides a way to obtain URLs to your images, at any size.</p>
<p><a class="reference internal" href="index.html#using-images-outside-wagtail"><span class="std std-ref">Dynamic image serve view</span></a></p>
</div>
<div class="section" id="routablepage">
<h6>RoutablePage<a class="headerlink" href="#routablepage" title="Permalink to this headline">¶</a></h6>
<p>A <code class="docutils literal notranslate"><span class="pre">RoutablePage</span></code> model has been added to allow embedding Django-style URL routing within a page.</p>
<p><a class="reference internal" href="index.html#routable-page-mixin"><span class="std std-ref">RoutablePageMixin</span></a></p>
</div>
<div class="section" id="usage-stats-for-images-documents-and-snippets">
<h6>Usage stats for images, documents and snippets<a class="headerlink" href="#usage-stats-for-images-documents-and-snippets" title="Permalink to this headline">¶</a></h6>
<p>It’s now easier to find where a particular image, document or snippet is being used on your site.</p>
<p>Set the <code class="docutils literal notranslate"><span class="pre">WAGTAIL_USAGE_COUNT_ENABLED</span></code> setting to <code class="docutils literal notranslate"><span class="pre">True</span></code> and an icon will appear on the edit page showing you which pages they have been used on.</p>
</div>
<div class="section" id="copy-page-action">
<h6>Copy Page action<a class="headerlink" href="#copy-page-action" title="Permalink to this headline">¶</a></h6>
<p>The explorer interface now offers the ability to copy pages, with or without subpages.</p>
</div>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<div class="section" id="core">
<h7>Core<a class="headerlink" href="#core" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Hooks can now be defined using decorator syntax:</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@hooks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;construct_main_menu&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">construct_main_menu</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">menu_items</span><span class="p">):</span>
    <span class="n">menu_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">MenuItem</span><span class="p">(</span><span class="s1">&#39;Kittens!&#39;</span><span class="p">,</span> <span class="s1">&#39;/kittens/&#39;</span><span class="p">,</span> <span class="n">classnames</span><span class="o">=</span><span class="s1">&#39;icon icon-folder-inverse&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>The lxml library (used for whitelisting and rewriting of rich text fields) has been replaced with the pure-python html5lib library, to simplify installation.</li>
<li>A <code class="docutils literal notranslate"><span class="pre">page_unpublished</span></code> signal has been added.</li>
</ul>
</div>
<div class="section" id="admin">
<h7>Admin<a class="headerlink" href="#admin" title="Permalink to this headline">¶</a></h7>
<ul>
<li><p class="first">Explorer nav now rendered separately and fetched with AJAX when needed.</p>
<p>This improves the general performance of the admin interface for large sites.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Updates to tag fields are now properly committed to the database when publishing directly from the page edit interface.</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-considerations">
<h5><a class="toc-backref" href="#id2">Upgrade considerations</a><a class="headerlink" href="#upgrade-considerations" title="Permalink to this headline">¶</a></h5>
<div class="section" id="urlconf-entries-for-admin-images-admin-embeds-etc-need-to-be-removed">
<h6>Urlconf entries for <code class="docutils literal notranslate"><span class="pre">/admin/images/</span></code>, <code class="docutils literal notranslate"><span class="pre">/admin/embeds/</span></code> etc need to be removed<a class="headerlink" href="#urlconf-entries-for-admin-images-admin-embeds-etc-need-to-be-removed" title="Permalink to this headline">¶</a></h6>
<p>If you created a Wagtail project prior to the release of Wagtail 0.3, it is likely to contain the following entries in its <code class="docutils literal notranslate"><span class="pre">urls.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO: some way of getting wagtailimages to register itself within wagtailadmin so that we</span>
<span class="c1"># don&#39;t have to define it separately here</span>
<span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/images/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtailimages_urls</span><span class="p">)),</span>
<span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/embeds/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtailembeds_urls</span><span class="p">)),</span>
<span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/documents/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtaildocs_admin_urls</span><span class="p">)),</span>
<span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/snippets/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtailsnippets_urls</span><span class="p">)),</span>
<span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/search/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtailsearch_admin_urls</span><span class="p">)),</span>
<span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/users/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtailusers_urls</span><span class="p">)),</span>
<span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/redirects/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">wagtailredirects_urls</span><span class="p">)),</span>
</pre></div>
</div>
<p>These entries (and the corresponding <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">wagtail.wagtail*</span> <span class="pre">import</span> <span class="pre">...</span></code> lines) need to be removed from <code class="docutils literal notranslate"><span class="pre">urls.py</span></code>. (The entry for <code class="docutils literal notranslate"><span class="pre">/admin/</span></code> should be left in, however.)</p>
<p>Since Wagtail 0.3, the wagtailadmin module automatically takes care of registering these URL subpaths, so these entries are redundant, and these urlconf modules are not guaranteed to remain stable and backwards-compatible in future. Leaving these entries in place will now cause an <code class="docutils literal notranslate"><span class="pre">ImproperlyConfigured</span></code> exception to be thrown.</p>
</div>
<div class="section" id="new-fields-on-image-and-rendition-models">
<h6>New fields on Image and Rendition models<a class="headerlink" href="#new-fields-on-image-and-rendition-models" title="Permalink to this headline">¶</a></h6>
<p>Several new fields have been added to the Image and Rendition models to support <a class="reference internal" href="index.html#image-feature-detection"><span class="std std-ref">Feature Detection</span></a>. These will be added to the database when you run <code class="docutils literal notranslate"><span class="pre">./manage.py</span> <span class="pre">migrate</span></code>. If you have defined a custom image model (by extending the <code class="docutils literal notranslate"><span class="pre">wagtailimages.AbstractImage</span></code> and <code class="docutils literal notranslate"><span class="pre">wagtailimages.AbstractRendition</span></code> classes and specifying <code class="docutils literal notranslate"><span class="pre">WAGTAILIMAGES_IMAGE_MODEL</span></code> in settings), the change needs to be applied to that model’s database table too. Running the command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./manage.py schemamigration myapp --auto add_image_focal_point_fields
</pre></div>
</div>
<p>(with ‘myapp’ replaced with your app name) will generate the necessary migration file.</p>
</div>
<div class="section" id="south-upgraded-to-1-0">
<h6>South upgraded to 1.0<a class="headerlink" href="#south-upgraded-to-1-0" title="Permalink to this headline">¶</a></h6>
<p>In preparation for Django 1.7 support in a future release, Wagtail now depends on South 1.0, and its migration files have been moved from <code class="docutils literal notranslate"><span class="pre">migrations</span></code> to <code class="docutils literal notranslate"><span class="pre">south_migrations</span></code>. Older versions of South will fail to find the migrations in the new location.</p>
<p>If your project’s requirements file (most commonly requirements.txt or requirements/base.txt) references a specific older version of South, this must be updated to South 1.0.</p>
</div>
</div>
</div>
<span id="document-releases/0.4.1"></span><div class="section" id="wagtail-0-4-1-release-notes">
<h4>Wagtail 0.4.1 release notes<a class="headerlink" href="#wagtail-0-4-1-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="section" id="bug-fixes">
<h5>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Elasticsearch backend now respects the backward-compatible URLS configuration setting, in addition to HOSTS</li>
<li>Documentation fixes</li>
</ul>
</div>
</div>
<span id="document-releases/0.4"></span><div class="section" id="wagtail-0-4-release-notes">
<h4>Wagtail 0.4 release notes<a class="headerlink" href="#wagtail-0-4-release-notes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-s-new" id="id2">What’s new</a></li>
<li><a class="reference internal" href="#backwards-incompatible-changes" id="id3">Backwards-incompatible changes</a></li>
<li><a class="reference internal" href="#deprecated-features" id="id4">Deprecated features</a></li>
</ul>
</div>
<div class="section" id="what-s-new">
<h5><a class="toc-backref" href="#id2">What’s new</a><a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h5>
<div class="section" id="private-pages">
<h6>Private Pages<a class="headerlink" href="#private-pages" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now supports password protecting pages on the frontend, allowing sections of your website to be made private.</p>
<p><a class="reference internal" href="index.html#private-pages"><span class="std std-ref">Private pages</span></a></p>
</div>
<div class="section" id="python-3-support">
<h6>Python 3 support<a class="headerlink" href="#python-3-support" title="Permalink to this headline">¶</a></h6>
<p>Wagtail now supports Python 3.2, 3.3 and 3.4.</p>
</div>
<div class="section" id="scheduled-publishing">
<h6>Scheduled publishing<a class="headerlink" href="#scheduled-publishing" title="Permalink to this headline">¶</a></h6>
<p>Editors can now schedule pages to be published or unpublished at specified times.</p>
<p>A new management command has been added (<a class="reference internal" href="index.html#publish-scheduled-pages"><span class="std std-ref">publish_scheduled_pages</span></a>) to publish pages that have been scheduled by an editor.</p>
</div>
<div class="section" id="search-on-queryset-with-elasticsearch">
<h6>Search on QuerySet with Elasticsearch<a class="headerlink" href="#search-on-queryset-with-elasticsearch" title="Permalink to this headline">¶</a></h6>
<p>It’s now possible to perform searches with Elasticsearch on <code class="docutils literal notranslate"><span class="pre">PageQuerySet</span></code> objects:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt; from wagtail.core.models import Page</span>
<span class="go">&gt;&gt;&gt; Page.objects.live().descendant_of(events_index).search(&quot;Hello&quot;)</span>
<span class="go">[&lt;Page: Event 1&gt;, &lt;Page: Event 2&gt;]</span>
</pre></div>
</div>
</div>
<div class="section" id="sitemap-generation">
<h6>Sitemap generation<a class="headerlink" href="#sitemap-generation" title="Permalink to this headline">¶</a></h6>
<p>A new module has been added (<code class="docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailsitemaps</span></code>) which produces XML sitemaps for Wagtail sites.</p>
<p><a class="reference internal" href="index.html#sitemap-generation"><span class="std std-ref">Sitemap generator</span></a></p>
</div>
<div class="section" id="front-end-cache-invalidation">
<h6>Front-end cache invalidation<a class="headerlink" href="#front-end-cache-invalidation" title="Permalink to this headline">¶</a></h6>
<p>A new module has been added (<code class="docutils literal notranslate"><span class="pre">wagtail.contrib.wagtailfrontendcache</span></code>) which invalidates pages in a frontend cache when they are updated or deleted in Wagtail.</p>
<p><a class="reference internal" href="index.html#frontend-cache-purging"><span class="std std-ref">Frontend cache invalidator</span></a></p>
</div>
<div class="section" id="notification-preferences">
<h6>Notification preferences<a class="headerlink" href="#notification-preferences" title="Permalink to this headline">¶</a></h6>
<p>Users can now decide which notifications they receive from Wagtail using a new “Notification preferences” section located in the account settings.</p>
</div>
<div class="section" id="minor-features">
<h6>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h6>
<div class="section" id="core">
<h7>Core<a class="headerlink" href="#core" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Any extra arguments given to <code class="docutils literal notranslate"><span class="pre">Page.serve</span></code> are now passed through to <code class="docutils literal notranslate"><span class="pre">get_context</span></code> and <code class="docutils literal notranslate"><span class="pre">get_template</span></code></li>
<li>Added <code class="docutils literal notranslate"><span class="pre">in_menu</span></code> and <code class="docutils literal notranslate"><span class="pre">not_in_menu</span></code> methods to <code class="docutils literal notranslate"><span class="pre">PageQuerySet</span></code></li>
<li>Added <code class="docutils literal notranslate"><span class="pre">search</span></code> method to <code class="docutils literal notranslate"><span class="pre">PageQuerySet</span></code></li>
<li>Added <code class="docutils literal notranslate"><span class="pre">get_next_siblings</span></code> and <code class="docutils literal notranslate"><span class="pre">get_prev_siblings</span></code> to <code class="docutils literal notranslate"><span class="pre">Page</span></code></li>
<li>Added <code class="docutils literal notranslate"><span class="pre">page_published</span></code> signal</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">copy</span></code> method to <code class="docutils literal notranslate"><span class="pre">Page</span></code> to allow copying of pages</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">construct_whitelister_element_rules</span></code> hook for customising the HTML whitelist used when saving <code class="docutils literal notranslate"><span class="pre">RichText</span></code> fields</li>
<li>Support for setting a <code class="docutils literal notranslate"><span class="pre">subpage_types</span></code> property on <code class="docutils literal notranslate"><span class="pre">Page</span></code> models, to define which page types are allowed as subpages</li>
</ul>
</div>
<div class="section" id="admin">
<h7>Admin<a class="headerlink" href="#admin" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Removed the “More” section from the menu</li>
<li>Added pagination to page listings</li>
<li>Added a new datetime picker widget</li>
<li>Updated <code class="docutils literal notranslate"><span class="pre">hallo.js</span></code> to version 1.0.4</li>
<li>Aesthetic improvements to preview experience</li>
<li>Login screen redirects to dashboard if user is already logged in</li>
<li>Snippets are now ordered alphabetically</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">init_new_page</span></code> signal</li>
</ul>
</div>
<div class="section" id="search">
<h7>Search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Added a new way to configure searchable/filterable fields on models</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">get_indexed_objects</span></code> allowing developers to customise which objects get added to the search index</li>
<li>Major refactor of Elasticsearch backend</li>
<li>Use <code class="docutils literal notranslate"><span class="pre">match</span></code> instead of <code class="docutils literal notranslate"><span class="pre">query_string</span></code> queries</li>
<li>Fields are now indexed in Elasticsearch with their correct type</li>
<li>Filter fields are no longer included in <code class="docutils literal notranslate"><span class="pre">_all</span></code></li>
<li>Fields with partial matching are now indexed together into <code class="docutils literal notranslate"><span class="pre">_partials</span></code></li>
</ul>
</div>
<div class="section" id="images">
<h7>Images<a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Added <code class="docutils literal notranslate"><span class="pre">original</span></code> as a resizing rule supported by the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">image</span> <span class="pre">%}</span></code> tag</li>
<li><code class="docutils literal notranslate"><span class="pre">image</span></code> tag now accepts extra keyword arguments to be output as attributes on the <code class="docutils literal notranslate"><span class="pre">img</span></code> tag</li>
<li>Added an <code class="docutils literal notranslate"><span class="pre">attrs</span></code> property to image rendition objects to output <code class="docutils literal notranslate"><span class="pre">src</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">height</span></code> and <code class="docutils literal notranslate"><span class="pre">alt</span></code> attributes all in one go</li>
</ul>
</div>
<div class="section" id="other">
<h7>Other<a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Added styleguide, for Wagtail developers</li>
</ul>
</div>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Animated GIFs are now coalesced before resizing</li>
<li>The Wand backend clones images before modifying them</li>
<li>The admin breadcrumb is now positioned correctly on mobile</li>
<li>The page chooser breadcrumb now updates the chooser modal instead of linking to Explorer</li>
<li>Embeds - fixed crash when no HTML field is sent back from the embed provider</li>
<li>Multiple sites with same hostname but different ports are now allowed</li>
<li>It is no longer possible to create multiple sites with <code class="docutils literal notranslate"><span class="pre">is_default_site</span> <span class="pre">=</span> <span class="pre">True</span></code></li>
</ul>
</div>
</div>
<div class="section" id="backwards-incompatible-changes">
<h5><a class="toc-backref" href="#id3">Backwards-incompatible changes</a><a class="headerlink" href="#backwards-incompatible-changes" title="Permalink to this headline">¶</a></h5>
<div class="section" id="elasticutils-replaced-with-elasticsearch-py">
<h6>ElasticUtils replaced with elasticsearch-py<a class="headerlink" href="#elasticutils-replaced-with-elasticsearch-py" title="Permalink to this headline">¶</a></h6>
<p>If you are using the Elasticsearch backend, you must install the <code class="docutils literal notranslate"><span class="pre">elasticsearch</span></code> module into your environment.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are using an older version of Elasticsearch (&lt; 1.0) you must install <code class="docutils literal notranslate"><span class="pre">elasticsearch</span></code> version 0.4.x.</p>
</div>
</div>
<div class="section" id="addition-of-expired-column-may-break-old-data-migrations-involving-pages">
<h6>Addition of <code class="docutils literal notranslate"><span class="pre">expired</span></code> column may break old data migrations involving pages<a class="headerlink" href="#addition-of-expired-column-may-break-old-data-migrations-involving-pages" title="Permalink to this headline">¶</a></h6>
<p>The scheduled publishing mechanism adds an <code class="docutils literal notranslate"><span class="pre">expired</span></code> field to wagtailcore.Page, defaulting to False. Any application code working with Page objects should be unaffected, but any code that creates page records using direct SQL, or within existing South migrations using South’s frozen ORM, will fail as this code will be unaware of the <code class="docutils literal notranslate"><span class="pre">expired</span></code> database column. To fix a South migration that fails in this way, add the following line to the <code class="docutils literal notranslate"><span class="pre">'wagtailcore.page'</span></code> entry at the bottom of the migration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;expired&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;django.db.models.fields.BooleanField&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;False&#39;</span><span class="p">}),</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="deprecated-features">
<span id="id1"></span><h5><a class="toc-backref" href="#id4">Deprecated features</a><a class="headerlink" href="#deprecated-features" title="Permalink to this headline">¶</a></h5>
<div class="section" id="template-tag-libraries-renamed">
<h6>Template tag libraries renamed<a class="headerlink" href="#template-tag-libraries-renamed" title="Permalink to this headline">¶</a></h6>
<p>The following template tag libraries have been renamed:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">pageurl</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">wagtailcore_tags</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">rich_text</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">wagtailcore_tags</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">embed_filters</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">wagtailembeds_tags</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">image_tags</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">wagtailimages_tags</span></code></li>
</ul>
<p>The old names will continue to work, but output a <code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> - you are advised to update any <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">%}</span></code> tags in your templates to refer to the new names.</p>
</div>
<div class="section" id="new-search-field-configuration-format">
<h6>New search field configuration format<a class="headerlink" href="#new-search-field-configuration-format" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">indexed_fields</span></code> is now deprecated and has been replaced by a new search field configuration format called <code class="docutils literal notranslate"><span class="pre">search_fields</span></code>. See <a class="reference internal" href="index.html#wagtailsearch-indexing"><span class="std std-ref">Indexing</span></a> for how to define a <code class="docutils literal notranslate"><span class="pre">search_fields</span></code> property on your models.</p>
</div>
<div class="section" id="page-route-method-should-now-return-a-routeresult">
<h6><code class="docutils literal notranslate"><span class="pre">Page.route</span></code> method should now return a <code class="docutils literal notranslate"><span class="pre">RouteResult</span></code><a class="headerlink" href="#page-route-method-should-now-return-a-routeresult" title="Permalink to this headline">¶</a></h6>
<p>Previously, the <code class="docutils literal notranslate"><span class="pre">route</span></code> method called <code class="docutils literal notranslate"><span class="pre">serve</span></code> and returned an <code class="docutils literal notranslate"><span class="pre">HttpResponse</span></code> object. This has now been split up so <code class="docutils literal notranslate"><span class="pre">serve</span></code> is called separately and <code class="docutils literal notranslate"><span class="pre">route</span></code> must now return a RouteResult object.</p>
<p>If you are overriding <code class="docutils literal notranslate"><span class="pre">Page.route</span></code> on any of your page models, you will need to update the method to return a <code class="docutils literal notranslate"><span class="pre">RouteResult</span></code> object. The old method of returning an <code class="docutils literal notranslate"><span class="pre">HttpResponse</span></code> will continue to work, but this will throw a <code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> and bypass the <code class="docutils literal notranslate"><span class="pre">before_serve_page</span></code> hook, which means in particular that <a class="reference internal" href="index.html#private-pages"><span class="std std-ref">Private pages</span></a> will not work on those page types. See <a class="reference internal" href="index.html#overriding-route-method"><span class="std std-ref">Adding Endpoints with Custom route() Methods</span></a>.</p>
</div>
<div class="section" id="wagtailadmins-hooks-module-has-moved-to-wagtailcore">
<h6>Wagtailadmins <code class="docutils literal notranslate"><span class="pre">hooks</span></code> module has moved to wagtailcore<a class="headerlink" href="#wagtailadmins-hooks-module-has-moved-to-wagtailcore" title="Permalink to this headline">¶</a></h6>
<p>If you use any <code class="docutils literal notranslate"><span class="pre">wagtail_hooks.py</span></code> files in your project, you may have an import like: <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">wagtail.wagtailadmin</span> <span class="pre">import</span> <span class="pre">hooks</span></code></p>
<p>Change this to: <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">wagtail.core</span> <span class="pre">import</span> <span class="pre">hooks</span></code></p>
</div>
<div class="section" id="miscellaneous">
<h6>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Page.show_as_mode</span></code>  replaced with <code class="docutils literal notranslate"><span class="pre">Page.serve_preview</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Page.get_page_modes</span></code> method replaced with <code class="docutils literal notranslate"><span class="pre">Page.preview_modes</span></code> property</li>
<li><code class="docutils literal notranslate"><span class="pre">Page.get_other_siblings</span></code> replaced with <code class="docutils literal notranslate"><span class="pre">Page.get_siblings(inclusive=False)</span></code></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


                    </article>
                    
                        <nav class="col-12 col-lg-3 pb-4 toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-getting_started/index">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-getting_started/tutorial">Your first Wagtail site</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-getting_started/demo_site">Demo site</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-getting_started/integrating_into_django">Integrating Wagtail into a Django project</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-getting_started/the_zen_of_wagtail">The Zen of Wagtail</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-topics/index">Usage guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/pages">Page models</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/writing_templates">Writing templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/images">How to use images in templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/search/index">Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/snippets">Snippets</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/streamfield">How to use StreamField for mixed content</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-topics/permissions">Permissions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-advanced_topics/index">Advanced topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/images/index">Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/documents/index">Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/embeds">Embedded content</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/add_to_django_project">How to add Wagtail into an existing Django project</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/deploying">Deploying Wagtail</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/performance">Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/i18n">Internationalisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/privacy">Private pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/customisation/index">Customising Wagtail</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/third_party_tutorials">Third-party tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/testing">Testing your Wagtail site</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/api/index">Wagtail API</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/amp">How to build a site with AMP support</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/accessibility_considerations">Accessibility considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/boundblocks_and_values">About StreamField BoundBlocks and values</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-advanced_topics/multi_site_multi_instance_multi_tenancy">Multi-site, multi-instance and multi-tenancy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-extending/index">Extending Wagtail</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/admin_views">Creating admin views</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/template_components">Template components</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/adding_reports">Adding reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/custom_tasks">Adding new Task types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/audit_log">Audit log</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/custom_account_settings">Customising the user account settings form</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/customising_group_views">Customising group edit/create views</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/rich_text_internals">Rich text internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/extending_draftail">Extending the Draftail Editor</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-extending/extending_hallo">Extending the Hallo Editor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-reference/index">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/pages/index">Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/streamfield/index">StreamField reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/contrib/index">Contrib modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/management_commands">Management commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/hooks">Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/signals">Signals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/settings">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/project_template">The project template</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-reference/jinja2">Jinja2 template support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-support">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-editor_manual/index">Using Wagtail: an Editor’s guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/intro">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/getting_started">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/finding_your_way_around/index">Finding your way around</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/new_pages/index">Creating new pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/editing_existing_pages">Editing existing pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/copying_aliasing_existing_pages">Copying and creating aliases to existing pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/documents_images_snippets/index">Managing documents, images, snippets and collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/managing_redirects">Managing Redirects</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/administrator_tasks/index">Administrator tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-editor_manual/browser_issues">Browser issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-contributing/index">Contributing to Wagtail</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/issue_tracking">Issue tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/developing">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/committing">Committing code</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/styleguide">UI Styleguide</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/general_guidelines">General coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/python_guidelines">Python coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/html_guidelines">HTML coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/css_guidelines">CSS coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/javascript_guidelines">JavaScript coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/documentation_guidelines">Documentation guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/documentation-modes">Writing documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/security">Reporting security issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contributing/release_process">Wagtail’s release process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-releases/index">Release notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/upgrading">Upgrading Wagtail</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.15">Wagtail 2.15 release notes - IN DEVELOPMENT</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.14.1">Wagtail 2.14.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.14">Wagtail 2.14 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.13.4">Wagtail 2.13.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.13.3">Wagtail 2.13.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.13.2">Wagtail 2.13.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.13.1">Wagtail 2.13.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.13">Wagtail 2.13 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12.6">Wagtail 2.12.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12.5">Wagtail 2.12.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12.4">Wagtail 2.12.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12.3">Wagtail 2.12.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12.2">Wagtail 2.12.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12.1">Wagtail 2.12.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.12">Wagtail 2.12 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.8">Wagtail 2.11.8 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.7">Wagtail 2.11.7 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.6">Wagtail 2.11.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.5">Wagtail 2.11.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.4">Wagtail 2.11.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.3">Wagtail 2.11.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.2">Wagtail 2.11.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11.1">Wagtail 2.11.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.11">Wagtail 2.11 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.10.2">Wagtail 2.10.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.10.1">Wagtail 2.10.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.10">Wagtail 2.10 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.9.3">Wagtail 2.9.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.9.2">Wagtail 2.9.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.9.1">Wagtail 2.9.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.9">Wagtail 2.9 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.8.2">Wagtail 2.8.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.8.1">Wagtail 2.8.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.8">Wagtail 2.8 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.7.4">Wagtail 2.7.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.7.3">Wagtail 2.7.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.7.2">Wagtail 2.7.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.7.1">Wagtail 2.7.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.7">Wagtail 2.7 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.6.3">Wagtail 2.6.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.6.2">Wagtail 2.6.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.6.1">Wagtail 2.6.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.6">Wagtail 2.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.5.2">Wagtail 2.5.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.5.1">Wagtail 2.5.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.5">Wagtail 2.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.4">Wagtail 2.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.3">Wagtail 2.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.2.2">Wagtail 2.2.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.2.1">Wagtail 2.2.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.2">Wagtail 2.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.1.3">Wagtail 2.1.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.1.2">Wagtail 2.1.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.1.1">Wagtail 2.1.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.1">Wagtail 2.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.0.2">Wagtail 2.0.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.0.1">Wagtail 2.0.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/2.0">Wagtail 2.0 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.13.4">Wagtail 1.13.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.13.3">Wagtail 1.13.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.13.2">Wagtail 1.13.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.13.1">Wagtail 1.13.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.13">Wagtail 1.13 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12.6">Wagtail 1.12.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12.5">Wagtail 1.12.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12.4">Wagtail 1.12.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12.3">Wagtail 1.12.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12.2">Wagtail 1.12.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12.1">Wagtail 1.12.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.12">Wagtail 1.12 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.11.1">Wagtail 1.11.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.11">Wagtail 1.11 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.10.1">Wagtail 1.10.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.10">Wagtail 1.10 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.9.1">Wagtail 1.9.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.9">Wagtail 1.9 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.8.2">Wagtail 1.8.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.8.1">Wagtail 1.8.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.8">Wagtail 1.8 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.7">Wagtail 1.7 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.6.3">Wagtail 1.6.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.6.2">Wagtail 1.6.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.6.1">Wagtail 1.6.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.6">Wagtail 1.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.5.3">Wagtail 1.5.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.5.2">Wagtail 1.5.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.5.1">Wagtail 1.5.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.5">Wagtail 1.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4.6">Wagtail 1.4.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4.5">Wagtail 1.4.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4.4">Wagtail 1.4.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4.3">Wagtail 1.4.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4.2">Wagtail 1.4.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4.1">Wagtail 1.4.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.4">Wagtail 1.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.3.1">Wagtail 1.3.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.3">Wagtail 1.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.2">Wagtail 1.2 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.1">Wagtail 1.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/1.0">Wagtail 1.0 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.10">Wagtail 0.8.10 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.8">Wagtail 0.8.8 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.7">Wagtail 0.8.7 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.6">Wagtail 0.8.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.5">Wagtail 0.8.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.4">Wagtail 0.8.4 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.3">Wagtail 0.8.3 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8.1">Wagtail 0.8.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.8">Wagtail 0.8 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.7">Wagtail 0.7 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.6">Wagtail 0.6 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.5">Wagtail 0.5 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.4.1">Wagtail 0.4.1 release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/0.4">Wagtail 0.4 release notes</a></li>
</ul>
</li>
</ul>

                        </nav>
                    
                </div>
            </main>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.io/features/">Features</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.io/about-wagtail/"> About Wagtail</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.io/services/"> Services</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.io/blog/"> Blog</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.io/packages/"> Packages</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.io/developers/"> Developers</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                <p style="display: none">
                    <a class="text-light" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Wagtail Sphinx Theme 5.0.4
                    </a>
                </p>
            </div>
        </div>
    </div>
        </div>
    </footer>

    
        <script type="text/javascript">
            var DOCUMENTATION_OPTIONS = {
                URL_ROOT: './',
                VERSION: '2.15a0',
                COLLAPSE_INDEX: false,
                FILE_SUFFIX: '.html',
                HAS_SOURCE: true
            };
        </script>
        <script type="text/javascript" src="_static/dist/jquery.min.js"></script>
        <script type="text/javascript" src="_static/dist/theme.js"></script>
        <script type="text/javascript" src="_static/dist/vendor.js"></script>
        <script type="text/javascript" src="_static/dist/underscore.min.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/dist/doctools.js"></script>
        <script type="text/javascript" src="_static/js/banner.js"></script>
<script async defer data-domain="docs.wagtail.io" src="https://plausible.io/js/plausible.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  /**
   * Get version of the currently served docs.
   *
   * PR builds have their version set to the PR ID (e.g. "6753").
   * If the docs are built for a PR, use the "latest" search index.
   * Otherwise, use the search index for the current version.
   */
  function getReadTheDocsVersion() {
    const rtd_version = (window.READTHEDOCS_DATA || {}).version || 'latest'
    const version = rtd_version.match(/^\d+$/) ? 'latest' : rtd_version
    return version
  }

  function getVersionFacetFilter() {
    return `version:${getReadTheDocsVersion()}`;
  }

  /**
   * Return true (debug: on) for local builds or Read the Docs PR previews.
   *
   * The debug mode allows inspection of the dropodown.
   */
  function getSearchDebugMode() {
    let debug = false
    if (window.READTHEDOCS_DATA === undefined) {
      // When developing locally, the `window.READTHEDOCS_DATA` object does not exist.
      debug = true
    } else {
      // When PR preview on Readthedocs, then the version can be converted into
      // a number. This does not work for the production version identifiers
      // like 'stable', 'latest', 'v2.12', etc. In that case `Number()` is `NaN`.
      const versionNumber = Number(window.READTHEDOCS_DATA.version)
      debug = !isNaN(versionNumber)
    }
    return debug
  }

  function docSearchReady() {
    /**
    * Configure Algolia DocSearch.
    * See https://github.com/algolia/docsearch-configs/blob/master/configs/wagtail.json for index configuration.
    */
    const search = docsearch({
      apiKey: '8325c57d16798633e29d211c26c7b6f9',
      indexName: 'wagtail',
      inputSelector: '#searchbox [name="q"]',
      algoliaOptions: {
        facetFilters: [getVersionFacetFilter()],
      },
      autocompleteOptions: {
        // Do NOT automatically select the first suggestion in the dropdown.
        // https://github.com/algolia/autocomplete/blob/45fa32d008620cf52bf4a90530be338543dfba7f/README.md#global-options
        autoSelect: false
      },
      debug: getSearchDebugMode(),
    })

    // Change page styles when the dropdown is open, to lock scrolling.
    search.autocomplete.on('autocomplete:updated', function (event) {
      const isOpen = event.target.value.trim() !== '';
      document.body.classList.toggle('body--autocomplete-open', isOpen);
    });
    search.autocomplete.on('autocomplete:closed', function (event) {
      document.body.classList.toggle('body--autocomplete-open', false);
    });
    return search
  }

  docSearchReady();
</script>
</body>
</html>